(self.webpackChunkstreet_viewer_app=self.webpackChunkstreet_viewer_app||[]).push([[179],{8527:function(xn){xn.exports=function(){"use strict";var It=function(k,q){var he={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},pt={on:function(je,At,Cn){if(void 0===he[je])throw new Error("Invalid event type: "+je);he[je].push({selector:At,fn:Cn})},render:function(je){q.store.featureChanged(je)}},Bt=function(je,At){for(var Cn=he[je],vn=Cn.length;vn--;){var jn=Cn[vn];if(jn.selector(At)){jn.fn.call(pt,At)||q.store.render(),q.ui.updateMapClasses();break}}};return k.start.call(pt),{render:k.render,stop:function(){k.stop&&k.stop()},trash:function(){k.trash&&(k.trash(),q.store.render())},combineFeatures:function(){k.combineFeatures&&k.combineFeatures()},uncombineFeatures:function(){k.uncombineFeatures&&k.uncombineFeatures()},drag:function(je){Bt("drag",je)},click:function(je){Bt("click",je)},mousemove:function(je){Bt("mousemove",je)},mousedown:function(je){Bt("mousedown",je)},mouseup:function(je){Bt("mouseup",je)},mouseout:function(je){Bt("mouseout",je)},keydown:function(je){Bt("keydown",je)},keyup:function(je){Bt("keyup",je)},touchstart:function(je){Bt("touchstart",je)},touchmove:function(je){Bt("touchmove",je)},touchend:function(je){Bt("touchend",je)},tap:function(je){Bt("tap",je)}}};function Te(k){var q=0;if(k&&k.length>0){q+=Math.abs(Ue(k[0]));for(var he=1;he<k.length;he++)q-=Math.abs(Ue(k[he]))}return q}function Ue(k){var q,he,pt,Bt,je,At,Cn=0,vn=k.length;if(vn>2){for(At=0;At<vn;At++)At===vn-2?(pt=vn-2,Bt=vn-1,je=0):At===vn-1?(pt=vn-1,Bt=0,je=1):(pt=At,Bt=At+1,je=At+2),q=k[pt],he=k[Bt],Cn+=(ft(k[je][0])-ft(q[0]))*Math.sin(ft(he[1]));Cn=6378137*Cn*6378137/2}return Cn}function ft(k){return k*Math.PI/180}var p_geometry=function k(q){var he,pt=0;switch(q.type){case"Polygon":return Te(q.coordinates);case"MultiPolygon":for(he=0;he<q.coordinates.length;he++)pt+=Te(q.coordinates[he]);return pt;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(he=0;he<q.geometries.length;he++)pt+=k(q.geometries[he]);return pt}},Me="mapbox-gl-draw-hot",de="mapbox-gl-draw-cold",Q="add",fe="move",pe="pointer",le="none",we={POLYGON:"polygon",LINE:"line_string",POINT:"point"},J="Feature",_t="Polygon",Ge="LineString",$e="Point",ue="FeatureCollection",Ee={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},it="draw.create",Re="draw.update",zn="feature",wn="midpoint",pr="vertex",Jr="true",ki="false",_r=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Or={Point:0,LineString:1,Polygon:2};function St(k,q){var he=Or[k.geometry.type]-Or[q.geometry.type];return 0===he&&k.geometry.type===_t?k.area-q.area:he}function ve(k){if(this._items={},this._nums={},this._length=k?k.length:0,k)for(var q=0,he=k.length;q<he;q++)this.add(k[q]),void 0!==k[q]&&("string"==typeof k[q]?this._items[k[q]]=q:this._nums[k[q]]=q)}ve.prototype.add=function(k){return this.has(k)||(this._length++,"string"==typeof k?this._items[k]=this._length:this._nums[k]=this._length),this},ve.prototype.delete=function(k){return!1===this.has(k)||(this._length--,delete this._items[k],delete this._nums[k]),this},ve.prototype.has=function(k){return!("string"!=typeof k&&"number"!=typeof k||void 0===this._items[k]&&void 0===this._nums[k])},ve.prototype.values=function(){var k=this,q=[];return Object.keys(this._items).forEach(function(he){q.push({k:he,v:k._items[he]})}),Object.keys(this._nums).forEach(function(he){q.push({k:JSON.parse(he),v:k._nums[he]})}),q.sort(function(he,pt){return he.v-pt.v}).map(function(he){return he.k})},ve.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var me=[zn,wn,pr],se={click:function(k,q,he){return Ve(k,q,he,he.options.clickBuffer)},touch:function(k,q,he){return Ve(k,q,he,he.options.touchBuffer)}};function Ve(k,q,he,pt){if(null===he.map)return[];var jn,wt,Bt=k?(void 0===(wt=pt)&&(wt=0),[[(jn=k).point.x-wt,jn.point.y-wt],[jn.point.x+wt,jn.point.y+wt]]):q,je={};he.options.styles&&(je.layers=he.options.styles.map(function(jn){return jn.id}));var At=he.map.queryRenderedFeatures(Bt,je).filter(function(jn){return-1!==me.indexOf(jn.properties.meta)}),Cn=new ve,vn=[];return At.forEach(function(jn){var wt=jn.properties.id;Cn.has(wt)||(Cn.add(wt),vn.push(jn))}),function(jn){return jn.map(function(wt){return wt.geometry.type===_t&&(wt.area=p_geometry({type:J,property:{},geometry:wt.geometry})),wt}).sort(St).map(function(wt){return delete wt.area,wt})}(vn)}function mt(k,q){var he=se.click(k,null,q),pt={mouse:le};return he[0]&&(pt.mouse=he[0].properties.active===Jr?fe:pe,pt.feature=he[0].properties.meta),-1!==q.events.currentModeName().indexOf("draw")&&(pt.mouse=Q),q.ui.queueMapClasses(pt),q.ui.updateMapClasses(),he[0]}function qt(k,q){var he=k.x-q.x,pt=k.y-q.y;return Math.sqrt(he*he+pt*pt)}function pn(k,q,he){void 0===he&&(he={});var pt=null!=he.fineTolerance?he.fineTolerance:4,Bt=null!=he.grossTolerance?he.grossTolerance:12,je=null!=he.interval?he.interval:500;k.point=k.point||q.point,k.time=k.time||q.time;var At=qt(k.point,q.point);return At<pt||At<Bt&&q.time-k.time<je}function yn(k,q,he){void 0===he&&(he={});var pt=null!=he.tolerance?he.tolerance:25,Bt=null!=he.interval?he.interval:250;return k.point=k.point||q.point,k.time=k.time||q.time,qt(k.point,q.point)<pt&&q.time-k.time<Bt}function Kt(k,q){return k(q={exports:{}},q.exports),q.exports}var Pr=Kt(function(k){var q=k.exports=function(he,pt){if(pt||(pt=16),void 0===he&&(he=128),he<=0)return"0";for(var Bt=Math.log(Math.pow(2,he))/Math.log(pt),je=2;Bt===1/0;je*=2)Bt=Math.log(Math.pow(2,he/je))/Math.log(pt)*je;var At=Bt-Math.floor(Bt),Cn="";for(je=0;je<Math.floor(Bt);je++)Cn=Math.floor(Math.random()*pt).toString(pt)+Cn;if(At){var vn=Math.pow(pt,At);Cn=Math.floor(Math.random()*vn).toString(pt)+Cn}var jn=parseInt(Cn,pt);return jn!==1/0&&jn>=Math.pow(2,he)?q(he,pt):Cn};q.rack=function(he,pt,Bt){var je=function(Cn){var vn=0;do{if(vn++>10){if(!Bt)throw new Error("too many ID collisions, use more bits");he+=Bt}var jn=q(he,pt)}while(Object.hasOwnProperty.call(At,jn));return At[jn]=Cn,jn},At=je.hats={};return je.get=function(Cn){return je.hats[Cn]},je.set=function(Cn,vn){return je.hats[Cn]=vn,je},je.bits=he||128,je.base=pt||16,je}}),lr=function(k,q){this.ctx=k,this.properties=q.properties||{},this.coordinates=q.geometry.coordinates,this.id=q.id||Pr(),this.type=q.geometry.type};lr.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},lr.prototype.incomingCoords=function(k){this.setCoordinates(k)},lr.prototype.setCoordinates=function(k){this.coordinates=k,this.changed()},lr.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},lr.prototype.setProperty=function(k,q){this.properties[k]=q},lr.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:J,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},lr.prototype.internal=function(k){var q={id:this.id,meta:zn,"meta:type":this.type,active:ki,mode:k};if(this.ctx.options.userProperties)for(var he in this.properties)q["user_"+he]=this.properties[he];return{type:J,properties:q,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var On=function(k,q){lr.call(this,k,q)};(On.prototype=Object.create(lr.prototype)).isValid=function(){return"number"==typeof this.coordinates[0]&&"number"==typeof this.coordinates[1]},On.prototype.updateCoordinate=function(k,q,he){this.coordinates=3===arguments.length?[q,he]:[k,q],this.changed()},On.prototype.getCoordinate=function(){return this.getCoordinates()};var Lr=function(k,q){lr.call(this,k,q)};(Lr.prototype=Object.create(lr.prototype)).isValid=function(){return this.coordinates.length>1},Lr.prototype.addCoordinate=function(k,q,he){this.changed();var pt=parseInt(k,10);this.coordinates.splice(pt,0,[q,he])},Lr.prototype.getCoordinate=function(k){var q=parseInt(k,10);return JSON.parse(JSON.stringify(this.coordinates[q]))},Lr.prototype.removeCoordinate=function(k){this.changed(),this.coordinates.splice(parseInt(k,10),1)},Lr.prototype.updateCoordinate=function(k,q,he){var pt=parseInt(k,10);this.coordinates[pt]=[q,he],this.changed()};var _i=function(k,q){lr.call(this,k,q),this.coordinates=this.coordinates.map(function(he){return he.slice(0,-1)})};(_i.prototype=Object.create(lr.prototype)).isValid=function(){return 0!==this.coordinates.length&&this.coordinates.every(function(k){return k.length>2})},_i.prototype.incomingCoords=function(k){this.coordinates=k.map(function(q){return q.slice(0,-1)}),this.changed()},_i.prototype.setCoordinates=function(k){this.coordinates=k,this.changed()},_i.prototype.addCoordinate=function(k,q,he){this.changed();var pt=k.split(".").map(function(Bt){return parseInt(Bt,10)});this.coordinates[pt[0]].splice(pt[1],0,[q,he])},_i.prototype.removeCoordinate=function(k){this.changed();var q=k.split(".").map(function(pt){return parseInt(pt,10)}),he=this.coordinates[q[0]];he&&(he.splice(q[1],1),he.length<3&&this.coordinates.splice(q[0],1))},_i.prototype.getCoordinate=function(k){var q=k.split(".").map(function(pt){return parseInt(pt,10)});return JSON.parse(JSON.stringify(this.coordinates[q[0]][q[1]]))},_i.prototype.getCoordinates=function(){return this.coordinates.map(function(k){return k.concat([k[0]])})},_i.prototype.updateCoordinate=function(k,q,he){this.changed();var pt=k.split("."),Bt=parseInt(pt[0],10),je=parseInt(pt[1],10);void 0===this.coordinates[Bt]&&(this.coordinates[Bt]=[]),this.coordinates[Bt][je]=[q,he]};var vi={MultiPoint:On,MultiLineString:Lr,MultiPolygon:_i},Pi=function(k,q,he,pt,Bt){var je=he.split("."),At=parseInt(je[0],10),Cn=je[1]?je.slice(1).join("."):null;return k[At][q](Cn,pt,Bt)},Ri=function(k,q){if(lr.call(this,k,q),delete this.coordinates,this.model=vi[q.geometry.type],void 0===this.model)throw new TypeError(q.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(q.geometry.coordinates)};function Sr(k){this.map=k.map,this.drawConfig=JSON.parse(JSON.stringify(k.options||{})),this._ctx=k}(Ri.prototype=Object.create(lr.prototype))._coordinatesToFeatures=function(k){var q=this,he=this.model.bind(this);return k.map(function(pt){return new he(q.ctx,{id:Pr(),type:J,properties:{},geometry:{coordinates:pt,type:q.type.replace("Multi","")}})})},Ri.prototype.isValid=function(){return this.features.every(function(k){return k.isValid()})},Ri.prototype.setCoordinates=function(k){this.features=this._coordinatesToFeatures(k),this.changed()},Ri.prototype.getCoordinate=function(k){return Pi(this.features,"getCoordinate",k)},Ri.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(k){return k.type===_t?k.getCoordinates():k.coordinates})))},Ri.prototype.updateCoordinate=function(k,q,he){Pi(this.features,"updateCoordinate",k,q,he),this.changed()},Ri.prototype.addCoordinate=function(k,q,he){Pi(this.features,"addCoordinate",k,q,he),this.changed()},Ri.prototype.removeCoordinate=function(k){Pi(this.features,"removeCoordinate",k),this.changed()},Ri.prototype.getFeatures=function(){return this.features},Sr.prototype.setSelected=function(k){return this._ctx.store.setSelected(k)},Sr.prototype.setSelectedCoordinates=function(k){var q=this;this._ctx.store.setSelectedCoordinates(k),k.reduce(function(he,pt){return void 0===he[pt.feature_id]&&(he[pt.feature_id]=!0,q._ctx.store.get(pt.feature_id).changed()),he},{})},Sr.prototype.getSelected=function(){return this._ctx.store.getSelected()},Sr.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Sr.prototype.isSelected=function(k){return this._ctx.store.isSelected(k)},Sr.prototype.getFeature=function(k){return this._ctx.store.get(k)},Sr.prototype.select=function(k){return this._ctx.store.select(k)},Sr.prototype.deselect=function(k){return this._ctx.store.deselect(k)},Sr.prototype.deleteFeature=function(k,q){return void 0===q&&(q={}),this._ctx.store.delete(k,q)},Sr.prototype.addFeature=function(k){return this._ctx.store.add(k)},Sr.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Sr.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Sr.prototype.setActionableState=function(k){return void 0===k&&(k={}),this._ctx.events.actionable({trash:k.trash||!1,combineFeatures:k.combineFeatures||!1,uncombineFeatures:k.uncombineFeatures||!1})},Sr.prototype.changeMode=function(k,q,he){return void 0===q&&(q={}),void 0===he&&(he={}),this._ctx.events.changeMode(k,q,he)},Sr.prototype.updateUIClasses=function(k){return this._ctx.ui.queueMapClasses(k)},Sr.prototype.activateUIButton=function(k){return this._ctx.ui.setActiveButton(k)},Sr.prototype.featuresAt=function(k,q,he){if(void 0===he&&(he="click"),"click"!==he&&"touch"!==he)throw new Error("invalid buffer type");return se[he](k,q,this._ctx)},Sr.prototype.newFeature=function(k){var q=k.geometry.type;return q===$e?new On(this._ctx,k):q===Ge?new Lr(this._ctx,k):q===_t?new _i(this._ctx,k):new Ri(this._ctx,k)},Sr.prototype.isInstanceOf=function(k,q){if(k===$e)return q instanceof On;if(k===Ge)return q instanceof Lr;if(k===_t)return q instanceof _i;if("MultiFeature"===k)return q instanceof Ri;throw new Error("Unknown feature class: "+k)},Sr.prototype.doRender=function(k){return this._ctx.store.featureChanged(k)},Sr.prototype.onSetup=function(){},Sr.prototype.onDrag=function(){},Sr.prototype.onClick=function(){},Sr.prototype.onMouseMove=function(){},Sr.prototype.onMouseDown=function(){},Sr.prototype.onMouseUp=function(){},Sr.prototype.onMouseOut=function(){},Sr.prototype.onKeyUp=function(){},Sr.prototype.onKeyDown=function(){},Sr.prototype.onTouchStart=function(){},Sr.prototype.onTouchMove=function(){},Sr.prototype.onTouchEnd=function(){},Sr.prototype.onTap=function(){},Sr.prototype.onStop=function(){},Sr.prototype.onTrash=function(){},Sr.prototype.onCombineFeature=function(){},Sr.prototype.onUncombineFeature=function(){},Sr.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var ds={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},Ko=Object.keys(ds);function Ci(k){return[].concat(k).filter(function(q){return void 0!==q})}function Ys(){var k=this;if(!k.ctx.map||void 0===k.ctx.map.getSource(Me))return vn();var q=k.ctx.events.currentModeName();k.ctx.ui.queueMapClasses({mode:q});var he=[],pt=[];k.isDirty?pt=k.getAllIds():(he=k.getChangedIds().filter(function(jn){return void 0!==k.get(jn)}),pt=k.sources.hot.filter(function(jn){return jn.properties.id&&-1===he.indexOf(jn.properties.id)&&void 0!==k.get(jn.properties.id)}).map(function(jn){return jn.properties.id})),k.sources.hot=[];var Bt=k.sources.cold.length;k.sources.cold=k.isDirty?[]:k.sources.cold.filter(function(jn){return-1===he.indexOf(jn.properties.id||jn.properties.parent)});var je=Bt!==k.sources.cold.length||pt.length>0;function At(jn,wt){var Sn=k.get(jn).internal(q);k.ctx.events.currentModeRender(Sn,function(Pn){k.sources[wt].push(Pn)})}if(he.forEach(function(jn){return At(jn,"hot")}),pt.forEach(function(jn){return At(jn,"cold")}),je&&k.ctx.map.getSource(de).setData({type:ue,features:k.sources.cold}),k.ctx.map.getSource(Me).setData({type:ue,features:k.sources.hot}),k._emitSelectionChange&&(k.ctx.map.fire("draw.selectionchange",{features:k.getSelected().map(function(jn){return jn.toGeoJSON()}),points:k.getSelectedCoordinates().map(function(jn){return{type:J,properties:{},geometry:{type:$e,coordinates:jn.coordinates}}})}),k._emitSelectionChange=!1),k._deletedFeaturesToEmit.length){var Cn=k._deletedFeaturesToEmit.map(function(jn){return jn.toGeoJSON()});k._deletedFeaturesToEmit=[],k.ctx.map.fire("draw.delete",{features:Cn})}function vn(){k.isDirty=!1,k.clearChangedIds()}vn(),k.ctx.map.fire("draw.render",{})}function oi(k){var q,he=this;this._features={},this._featureIds=new ve,this._selectedFeatureIds=new ve,this._selectedCoordinates=[],this._changedFeatureIds=new ve,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=k,this.sources={hot:[],cold:[]},this.render=function(){q||(q=requestAnimationFrame(function(){q=null,Ys.call(he)}))},this.isDirty=!1}function An(k,q){var he=k._selectedCoordinates.filter(function(pt){return k._selectedFeatureIds.has(pt.feature_id)});k._selectedCoordinates.length===he.length||q.silent||(k._emitSelectionChange=!0),k._selectedCoordinates=he}oi.prototype.createRenderBatch=function(){var k=this,q=this.render,he=0;return this.render=function(){he++},function(){k.render=q,he>0&&k.render()}},oi.prototype.setDirty=function(){return this.isDirty=!0,this},oi.prototype.featureChanged=function(k){return this._changedFeatureIds.add(k),this},oi.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},oi.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},oi.prototype.getAllIds=function(){return this._featureIds.values()},oi.prototype.add=function(k){return this.featureChanged(k.id),this._features[k.id]=k,this._featureIds.add(k.id),this},oi.prototype.delete=function(k,q){var he=this;return void 0===q&&(q={}),Ci(k).forEach(function(pt){he._featureIds.has(pt)&&(he._featureIds.delete(pt),he._selectedFeatureIds.delete(pt),q.silent||-1===he._deletedFeaturesToEmit.indexOf(he._features[pt])&&he._deletedFeaturesToEmit.push(he._features[pt]),delete he._features[pt],he.isDirty=!0)}),An(this,q),this},oi.prototype.get=function(k){return this._features[k]},oi.prototype.getAll=function(){var k=this;return Object.keys(this._features).map(function(q){return k._features[q]})},oi.prototype.select=function(k,q){var he=this;return void 0===q&&(q={}),Ci(k).forEach(function(pt){he._selectedFeatureIds.has(pt)||(he._selectedFeatureIds.add(pt),he._changedFeatureIds.add(pt),q.silent||(he._emitSelectionChange=!0))}),this},oi.prototype.deselect=function(k,q){var he=this;return void 0===q&&(q={}),Ci(k).forEach(function(pt){he._selectedFeatureIds.has(pt)&&(he._selectedFeatureIds.delete(pt),he._changedFeatureIds.add(pt),q.silent||(he._emitSelectionChange=!0))}),An(this,q),this},oi.prototype.clearSelected=function(k){return void 0===k&&(k={}),this.deselect(this._selectedFeatureIds.values(),{silent:k.silent}),this},oi.prototype.setSelected=function(k,q){var he=this;return void 0===q&&(q={}),k=Ci(k),this.deselect(this._selectedFeatureIds.values().filter(function(pt){return-1===k.indexOf(pt)}),{silent:q.silent}),this.select(k.filter(function(pt){return!he._selectedFeatureIds.has(pt)}),{silent:q.silent}),this},oi.prototype.setSelectedCoordinates=function(k){return this._selectedCoordinates=k,this._emitSelectionChange=!0,this},oi.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},oi.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},oi.prototype.getSelected=function(){var k=this;return this._selectedFeatureIds.values().map(function(q){return k.get(q)})},oi.prototype.getSelectedCoordinates=function(){var k=this;return this._selectedCoordinates.map(function(q){return{coordinates:k.get(q.feature_id).getCoordinate(q.coord_path)}})},oi.prototype.isSelected=function(k){return this._selectedFeatureIds.has(k)},oi.prototype.setFeatureProperty=function(k,q,he){this.get(k).setProperty(q,he),this.featureChanged(k)},oi.prototype.storeMapConfig=function(){var k=this;_r.forEach(function(q){k.ctx.map[q]&&(k._mapInitialConfig[q]=k.ctx.map[q].isEnabled())})},oi.prototype.restoreMapConfig=function(){var k=this;Object.keys(this._mapInitialConfig).forEach(function(q){k._mapInitialConfig[q]?k.ctx.map[q].enable():k.ctx.map[q].disable()})},oi.prototype.getInitialConfigValue=function(k){return void 0===this._mapInitialConfig[k]||this._mapInitialConfig[k]};var Ks=function(){for(var k=arguments,q={},he=0;he<arguments.length;he++){var pt=k[he];for(var Bt in pt)as.call(pt,Bt)&&(q[Bt]=pt[Bt])}return q},as=Object.prototype.hasOwnProperty,$r=["mode","feature","mouse"];function Ha(k){var q=null,he=null,pt={onRemove:function(){return k.map.off("load",pt.connect),clearInterval(he),pt.removeLayers(),k.store.restoreMapConfig(),k.ui.removeButtons(),k.events.removeEventListeners(),k.ui.clearMapClasses(),k.map=null,k.container=null,k.store=null,q&&q.parentNode&&q.parentNode.removeChild(q),q=null,this},connect:function(){k.map.off("load",pt.connect),clearInterval(he),pt.addLayers(),k.store.storeMapConfig(),k.events.addEventListeners()},onAdd:function(Bt){var je=Bt.fire;return Bt.fire=function(At,Cn){var vn=arguments;return 1===je.length&&1!==arguments.length&&(vn=[Ks({},{type:At},Cn)]),je.apply(Bt,vn)},k.map=Bt,k.events=function(At){var Cn=Object.keys(At.options.modes).reduce(function(sn,qn){return sn[qn]=function Ns(k){var q=Object.keys(k);return function(he,pt){void 0===pt&&(pt={});var Bt={},je=q.reduce(function(At,Cn){return At[Cn]=k[Cn],At},new Sr(he));return{start:function(){var At=this;Bt=je.onSetup(pt),Ko.forEach(function(Cn){var vn,jn=ds[Cn],wt=function(){return!1};k[jn]&&(wt=function(){return!0}),At.on(Cn,wt,(vn=jn,function(Sn){return je[vn](Bt,Sn)}))})},stop:function(){je.onStop(Bt)},trash:function(){je.onTrash(Bt)},combineFeatures:function(){je.onCombineFeatures(Bt)},uncombineFeatures:function(){je.onUncombineFeatures(Bt)},render:function(At,Cn){je.toDisplayFeatures(Bt,At,Cn)}}}}(At.options.modes[qn]),sn},{}),vn={},jn={},wt={},Sn=null,Pn=null;wt.drag=function(sn,qn){qn({point:sn.point,time:(new Date).getTime()})?(At.ui.queueMapClasses({mouse:"drag"}),Pn.drag(sn)):sn.originalEvent.stopPropagation()},wt.mousedrag=function(sn){wt.drag(sn,function(qn){return!pn(vn,qn)})},wt.touchdrag=function(sn){wt.drag(sn,function(qn){return!yn(jn,qn)})},wt.mousemove=function(sn){if(1===(void 0!==sn.originalEvent.buttons?sn.originalEvent.buttons:sn.originalEvent.which))return wt.mousedrag(sn);var qn=mt(sn,At);sn.featureTarget=qn,Pn.mousemove(sn)},wt.mousedown=function(sn){vn={time:(new Date).getTime(),point:sn.point};var qn=mt(sn,At);sn.featureTarget=qn,Pn.mousedown(sn)},wt.mouseup=function(sn){var qn=mt(sn,At);sn.featureTarget=qn,pn(vn,{point:sn.point,time:(new Date).getTime()})?Pn.click(sn):Pn.mouseup(sn)},wt.mouseout=function(sn){Pn.mouseout(sn)},wt.touchstart=function(sn){if(sn.originalEvent.preventDefault(),At.options.touchEnabled){jn={time:(new Date).getTime(),point:sn.point};var qn=se.touch(sn,null,At)[0];sn.featureTarget=qn,Pn.touchstart(sn)}},wt.touchmove=function(sn){if(sn.originalEvent.preventDefault(),At.options.touchEnabled)return Pn.touchmove(sn),wt.touchdrag(sn)},wt.touchend=function(sn){if(sn.originalEvent.preventDefault(),At.options.touchEnabled){var qn=se.touch(sn,null,At)[0];sn.featureTarget=qn,yn(jn,{time:(new Date).getTime(),point:sn.point})?Pn.tap(sn):Pn.touchend(sn)}};var $n=function(sn){return!(8===sn||46===sn||sn>=48&&sn<=57)};function Ar(sn,qn,Si){void 0===Si&&(Si={}),Pn.stop();var ar=Cn[sn];if(void 0===ar)throw new Error(sn+" is not valid");Sn=sn;var Rr=ar(At,qn);Pn=It(Rr,At),Si.silent||At.map.fire("draw.modechange",{mode:sn}),At.store.setDirty(),At.store.render()}wt.keydown=function(sn){"mapboxgl-canvas"===(sn.srcElement||sn.target).classList[0]&&(8!==sn.keyCode&&46!==sn.keyCode||!At.options.controls.trash?$n(sn.keyCode)?Pn.keydown(sn):49===sn.keyCode&&At.options.controls.point?Ar(Ee.DRAW_POINT):50===sn.keyCode&&At.options.controls.line_string?Ar(Ee.DRAW_LINE_STRING):51===sn.keyCode&&At.options.controls.polygon&&Ar(Ee.DRAW_POLYGON):(sn.preventDefault(),Pn.trash()))},wt.keyup=function(sn){$n(sn.keyCode)&&Pn.keyup(sn)},wt.zoomend=function(){At.store.changeZoom()},wt.data=function(sn){if("style"===sn.dataType){var qn=At.setup,Si=At.map,Rr=At.store;At.options.styles.some(function(Zn){return Si.getLayer(Zn.id)})||(qn.addLayers(),Rr.setDirty(),Rr.render())}};var $s={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){Pn=It(Cn[Sn=At.options.defaultMode](At),At)},changeMode:Ar,actionable:function(sn){var qn=!1;Object.keys(sn).forEach(function(Si){if(void 0===$s[Si])throw new Error("Invalid action type");$s[Si]!==sn[Si]&&(qn=!0),$s[Si]=sn[Si]}),qn&&At.map.fire("draw.actionable",{actions:$s})},currentModeName:function(){return Sn},currentModeRender:function(sn,qn){return Pn.render(sn,qn)},fire:function(sn,qn){wt[sn]&&wt[sn](qn)},addEventListeners:function(){At.map.on("mousemove",wt.mousemove),At.map.on("mousedown",wt.mousedown),At.map.on("mouseup",wt.mouseup),At.map.on("data",wt.data),At.map.on("touchmove",wt.touchmove),At.map.on("touchstart",wt.touchstart),At.map.on("touchend",wt.touchend),At.container.addEventListener("mouseout",wt.mouseout),At.options.keybindings&&(At.container.addEventListener("keydown",wt.keydown),At.container.addEventListener("keyup",wt.keyup))},removeEventListeners:function(){At.map.off("mousemove",wt.mousemove),At.map.off("mousedown",wt.mousedown),At.map.off("mouseup",wt.mouseup),At.map.off("data",wt.data),At.map.off("touchmove",wt.touchmove),At.map.off("touchstart",wt.touchstart),At.map.off("touchend",wt.touchend),At.container.removeEventListener("mouseout",wt.mouseout),At.options.keybindings&&(At.container.removeEventListener("keydown",wt.keydown),At.container.removeEventListener("keyup",wt.keyup))},trash:function(sn){Pn.trash(sn)},combineFeatures:function(){Pn.combineFeatures()},uncombineFeatures:function(){Pn.uncombineFeatures()},getMode:function(){return Sn}}}(k),k.ui=function(At){var Cn={},vn=null,jn={mode:null,feature:null,mouse:null},wt={mode:null,feature:null,mouse:null};function Sn(sn){wt=Ks(wt,sn)}function Pn(){var sn,qn;if(At.container){var Si=[],ar=[];$r.forEach(function(Rr){wt[Rr]!==jn[Rr]&&(Si.push(Rr+"-"+jn[Rr]),null!==wt[Rr]&&ar.push(Rr+"-"+wt[Rr]))}),Si.length>0&&(sn=At.container.classList).remove.apply(sn,Si),ar.length>0&&(qn=At.container.classList).add.apply(qn,ar),jn=Ks(jn,wt)}}function $n(sn,qn){void 0===qn&&(qn={});var Si=document.createElement("button");return Si.className="mapbox-gl-draw_ctrl-draw-btn "+qn.className,Si.setAttribute("title",qn.title),qn.container.appendChild(Si),Si.addEventListener("click",function(ar){if(ar.preventDefault(),ar.stopPropagation(),ar.target===vn)return Ar(),void qn.onDeactivate();$s(sn),qn.onActivate()},!0),Si}function Ar(){vn&&(vn.classList.remove("active"),vn=null)}function $s(sn){Ar();var qn=Cn[sn];qn&&qn&&"trash"!==sn&&(qn.classList.add("active"),vn=qn)}return{setActiveButton:$s,queueMapClasses:Sn,updateMapClasses:Pn,clearMapClasses:function(){Sn({mode:null,feature:null,mouse:null}),Pn()},addButtons:function(){var sn=At.options.controls,qn=document.createElement("div");return qn.className="mapboxgl-ctrl-group mapboxgl-ctrl",sn&&(sn[we.LINE]&&(Cn[we.LINE]=$n(we.LINE,{container:qn,className:"mapbox-gl-draw_line",title:"LineString tool "+(At.options.keybindings?"(l)":""),onActivate:function(){return At.events.changeMode(Ee.DRAW_LINE_STRING)},onDeactivate:function(){return At.events.trash()}})),sn[we.POLYGON]&&(Cn[we.POLYGON]=$n(we.POLYGON,{container:qn,className:"mapbox-gl-draw_polygon",title:"Polygon tool "+(At.options.keybindings?"(p)":""),onActivate:function(){return At.events.changeMode(Ee.DRAW_POLYGON)},onDeactivate:function(){return At.events.trash()}})),sn[we.POINT]&&(Cn[we.POINT]=$n(we.POINT,{container:qn,className:"mapbox-gl-draw_point",title:"Marker tool "+(At.options.keybindings?"(m)":""),onActivate:function(){return At.events.changeMode(Ee.DRAW_POINT)},onDeactivate:function(){return At.events.trash()}})),sn.trash&&(Cn.trash=$n("trash",{container:qn,className:"mapbox-gl-draw_trash",title:"Delete",onActivate:function(){At.events.trash()}})),sn.combine_features&&(Cn.combine_features=$n("combineFeatures",{container:qn,className:"mapbox-gl-draw_combine",title:"Combine",onActivate:function(){At.events.combineFeatures()}})),sn.uncombine_features&&(Cn.uncombine_features=$n("uncombineFeatures",{container:qn,className:"mapbox-gl-draw_uncombine",title:"Uncombine",onActivate:function(){At.events.uncombineFeatures()}}))),qn},removeButtons:function(){Object.keys(Cn).forEach(function(sn){var qn=Cn[sn];qn.parentNode&&qn.parentNode.removeChild(qn),delete Cn[sn]})}}}(k),k.container=Bt.getContainer(),k.store=new oi(k),q=k.ui.addButtons(),k.options.boxSelect&&(Bt.boxZoom.disable(),Bt.dragPan.disable(),Bt.dragPan.enable()),Bt.loaded()?pt.connect():(Bt.on("load",pt.connect),he=setInterval(function(){Bt.loaded()&&pt.connect()},16)),k.events.start(),q},addLayers:function(){k.map.addSource(de,{data:{type:ue,features:[]},type:"geojson"}),k.map.addSource(Me,{data:{type:ue,features:[]},type:"geojson"}),k.options.styles.forEach(function(Bt){k.map.addLayer(Bt)}),k.store.setDirty(!0),k.store.render()},removeLayers:function(){k.options.styles.forEach(function(Bt){k.map.getLayer(Bt.id)&&k.map.removeLayer(Bt.id)}),k.map.getSource(de)&&k.map.removeSource(de),k.map.getSource(Me)&&k.map.removeSource(Me)}};return k.setup=pt,pt}function ns(k){return function(q){var he=q.featureTarget;return!!he&&!!he.properties&&he.properties.meta===k}}function Oe(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.active===Jr&&k.featureTarget.properties.meta===zn}function Y(k){return!!k.featureTarget&&!!k.featureTarget.properties&&k.featureTarget.properties.active===ki&&k.featureTarget.properties.meta===zn}function ie(k){return void 0===k.featureTarget}function ke(k){var q=k.featureTarget;return!!q&&!!q.properties&&q.properties.meta===pr}function Ye(k){return!!k.originalEvent&&!0===k.originalEvent.shiftKey}function ot(k){return 27===k.keyCode}function Mt(k){return 13===k.keyCode}var Ct=lt;function lt(k,q){this.x=k,this.y=q}function ht(k,q){var he=q.getBoundingClientRect();return new Ct(k.clientX-he.left-(q.clientLeft||0),k.clientY-he.top-(q.clientTop||0))}function nn(k,q,he,pt){return{type:J,properties:{meta:pr,parent:k,coord_path:he,active:pt?Jr:ki},geometry:{type:$e,coordinates:q}}}function Rn(k,q,he){void 0===q&&(q={}),void 0===he&&(he=null);var pt,Bt=k.geometry,je=Bt.type,At=Bt.coordinates,Cn=k.properties&&k.properties.id,vn=[];function jn(Sn,Pn){var $n="",Ar=null;Sn.forEach(function($s,sn){var qn=null!=Pn?Pn+"."+sn:String(sn),Si=nn(Cn,$s,qn,wt(qn));if(q.midpoints&&Ar){var ar=function(Zn,Yu,eu){var bn=Yu.geometry.coordinates,ao=eu.geometry.coordinates;if(bn[1]>85||bn[1]<-85||ao[1]>85||ao[1]<-85)return null;var Jo={lng:(bn[0]+ao[0])/2,lat:(bn[1]+ao[1])/2};return{type:J,properties:{meta:wn,parent:Zn,lng:Jo.lng,lat:Jo.lat,coord_path:eu.properties.coord_path},geometry:{type:$e,coordinates:[Jo.lng,Jo.lat]}}}(Cn,Ar,Si);ar&&vn.push(ar)}Ar=Si;var Rr=JSON.stringify($s);$n!==Rr&&vn.push(Si),0===sn&&($n=Rr)})}function wt(Sn){return!!q.selectedPaths&&-1!==q.selectedPaths.indexOf(Sn)}return je===$e?vn.push(nn(Cn,At,he,wt(he))):je===_t?At.forEach(function(Sn,Pn){jn(Sn,null!==he?he+"."+Pn:String(Pn))}):je===Ge?jn(At,he):0===je.indexOf("Multi")&&(pt=je.replace("Multi",""),At.forEach(function(Sn,Pn){vn=vn.concat(Rn({type:J,properties:k.properties,geometry:{type:pt,coordinates:Sn}},q,Pn))})),vn}lt.prototype={clone:function(){return new lt(this.x,this.y)},add:function(k){return this.clone()._add(k)},sub:function(k){return this.clone()._sub(k)},multByPoint:function(k){return this.clone()._multByPoint(k)},divByPoint:function(k){return this.clone()._divByPoint(k)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(k){return this.clone()._rotate(k)},rotateAround:function(k,q){return this.clone()._rotateAround(k,q)},matMult:function(k){return this.clone()._matMult(k)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(k){return this.x===k.x&&this.y===k.y},dist:function(k){return Math.sqrt(this.distSqr(k))},distSqr:function(k){var q=k.x-this.x,he=k.y-this.y;return q*q+he*he},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(k){return Math.atan2(this.y-k.y,this.x-k.x)},angleWith:function(k){return this.angleWithSep(k.x,k.y)},angleWithSep:function(k,q){return Math.atan2(this.x*q-this.y*k,this.x*k+this.y*q)},_matMult:function(k){var he=k[2]*this.x+k[3]*this.y;return this.x=k[0]*this.x+k[1]*this.y,this.y=he,this},_add:function(k){return this.x+=k.x,this.y+=k.y,this},_sub:function(k){return this.x-=k.x,this.y-=k.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_multByPoint:function(k){return this.x*=k.x,this.y*=k.y,this},_divByPoint:function(k){return this.x/=k.x,this.y/=k.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var k=this.y;return this.y=this.x,this.x=-k,this},_rotate:function(k){var q=Math.cos(k),he=Math.sin(k),Bt=he*this.x+q*this.y;return this.x=q*this.x-he*this.y,this.y=Bt,this},_rotateAround:function(k,q){var he=Math.cos(k),pt=Math.sin(k),je=q.y+pt*(this.x-q.x)+he*(this.y-q.y);return this.x=q.x+he*(this.x-q.x)-pt*(this.y-q.y),this.y=je,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},lt.convert=function(k){return k instanceof lt?k:Array.isArray(k)?new lt(k[0],k[1]):k};var cn=function(k){setTimeout(function(){k.map&&k.map.doubleClickZoom&&k._ctx&&k._ctx.store&&k._ctx.store.getInitialConfigValue&&k._ctx.store.getInitialConfigValue("doubleClickZoom")&&k.map.doubleClickZoom.enable()},0)},rr=function(k){setTimeout(function(){k.map&&k.map.doubleClickZoom&&k.map.doubleClickZoom.disable()},0)},cr=function(k){if(!k||!k.type)return null;var q=ir[k.type];return q?"geometry"===q?{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:k}]}:"feature"===q?{type:"FeatureCollection",features:[k]}:"featurecollection"===q?k:void 0:null},ir={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function Mr(k){switch(k&&k.type||null){case"FeatureCollection":return k.features=k.features.reduce(function(q,he){return q.concat(Mr(he))},[]),k;case"Feature":return k.geometry?Mr(k.geometry).map(function(q){var he={type:"Feature",properties:JSON.parse(JSON.stringify(k.properties)),geometry:q};return void 0!==k.id&&(he.id=k.id),he}):[k];case"MultiPoint":return k.coordinates.map(function(q){return{type:"Point",coordinates:q}});case"MultiPolygon":return k.coordinates.map(function(q){return{type:"Polygon",coordinates:q}});case"MultiLineString":return k.coordinates.map(function(q){return{type:"LineString",coordinates:q}});case"GeometryCollection":return k.geometries.map(Mr).reduce(function(q,he){return q.concat(he)},[]);case"Point":case"Polygon":case"LineString":return[k]}}var ji=Kt(function(k){var q=k.exports=function(wt){return new he(wt)};function he(wt){this.value=wt}function pt(wt,Sn,Pn){var $n=[],Ar=[],$s=!0;return function sn(qn){var Si=Pn?Bt(qn):qn,ar={},Rr=!0,Zn={node:Si,node_:qn,path:[].concat($n),parent:Ar[Ar.length-1],parents:Ar,key:$n.slice(-1)[0],isRoot:0===$n.length,level:$n.length,circular:null,update:function(bn,ao){Zn.isRoot||(Zn.parent.node[Zn.key]=bn),Zn.node=bn,ao&&(Rr=!1)},delete:function(bn){delete Zn.parent.node[Zn.key],bn&&(Rr=!1)},remove:function(bn){Cn(Zn.parent.node)?Zn.parent.node.splice(Zn.key,1):delete Zn.parent.node[Zn.key],bn&&(Rr=!1)},keys:null,before:function(bn){ar.before=bn},after:function(bn){ar.after=bn},pre:function(bn){ar.pre=bn},post:function(bn){ar.post=bn},stop:function(){$s=!1},block:function(){Rr=!1}};if(!$s)return Zn;function Yu(){if("object"==typeof Zn.node&&null!==Zn.node){Zn.keys&&Zn.node_===Zn.node||(Zn.keys=je(Zn.node)),Zn.isLeaf=0==Zn.keys.length;for(var bn=0;bn<Ar.length;bn++)if(Ar[bn].node_===qn){Zn.circular=Ar[bn];break}}else Zn.isLeaf=!0,Zn.keys=null;Zn.notLeaf=!Zn.isLeaf,Zn.notRoot=!Zn.isRoot}Yu();var eu=Sn.call(Zn,Zn.node);return void 0!==eu&&Zn.update&&Zn.update(eu),ar.before&&ar.before.call(Zn,Zn.node),Rr&&("object"!=typeof Zn.node||null===Zn.node||Zn.circular||(Ar.push(Zn),Yu(),vn(Zn.keys,function(bn,ao){$n.push(bn),ar.pre&&ar.pre.call(Zn,Zn.node[bn],bn);var Jo=sn(Zn.node[bn]);Pn&&jn.call(Zn.node,bn)&&(Zn.node[bn]=Jo.node),Jo.isLast=ao==Zn.keys.length-1,Jo.isFirst=0==ao,ar.post&&ar.post.call(Zn,Jo),$n.pop()}),Ar.pop()),ar.after&&ar.after.call(Zn,Zn.node)),Zn}(wt).node}function Bt(wt){if("object"==typeof wt&&null!==wt){var Sn;if(Cn(wt))Sn=[];else if("[object Date]"===At(wt))Sn=new Date(wt.getTime?wt.getTime():wt);else if("[object RegExp]"===At(wt))Sn=new RegExp(wt);else if("[object Error]"===At(wt))Sn={message:wt.message};else if(function(Ar){return"[object Boolean]"===At(Ar)}(wt))Sn=new Boolean(wt);else if(function(Ar){return"[object Number]"===At(Ar)}(wt))Sn=new Number(wt);else if(function(Ar){return"[object String]"===At(Ar)}(wt))Sn=new String(wt);else if(Object.create&&Object.getPrototypeOf)Sn=Object.create(Object.getPrototypeOf(wt));else if(wt.constructor===Object)Sn={};else{var $n=function(){};$n.prototype=wt.constructor&&wt.constructor.prototype||wt.__proto__||{},Sn=new $n}return vn(je(wt),function(Ar){Sn[Ar]=wt[Ar]}),Sn}return wt}he.prototype.get=function(wt){for(var Sn=this.value,Pn=0;Pn<wt.length;Pn++){var $n=wt[Pn];if(!Sn||!jn.call(Sn,$n)){Sn=void 0;break}Sn=Sn[$n]}return Sn},he.prototype.has=function(wt){for(var Sn=this.value,Pn=0;Pn<wt.length;Pn++){var $n=wt[Pn];if(!Sn||!jn.call(Sn,$n))return!1;Sn=Sn[$n]}return!0},he.prototype.set=function(wt,Sn){for(var Pn=this.value,$n=0;$n<wt.length-1;$n++){var Ar=wt[$n];jn.call(Pn,Ar)||(Pn[Ar]={}),Pn=Pn[Ar]}return Pn[wt[$n]]=Sn,Sn},he.prototype.map=function(wt){return pt(this.value,wt,!0)},he.prototype.forEach=function(wt){return this.value=pt(this.value,wt,!1),this.value},he.prototype.reduce=function(wt,Sn){var Pn=1===arguments.length,$n=Pn?this.value:Sn;return this.forEach(function(Ar){this.isRoot&&Pn||($n=wt.call(this,$n,Ar))}),$n},he.prototype.paths=function(){var wt=[];return this.forEach(function(Sn){wt.push(this.path)}),wt},he.prototype.nodes=function(){var wt=[];return this.forEach(function(Sn){wt.push(this.node)}),wt},he.prototype.clone=function(){var wt=[],Sn=[];return function Pn($n){for(var Ar=0;Ar<wt.length;Ar++)if(wt[Ar]===$n)return Sn[Ar];if("object"==typeof $n&&null!==$n){var $s=Bt($n);return wt.push($n),Sn.push($s),vn(je($n),function(sn){$s[sn]=Pn($n[sn])}),wt.pop(),Sn.pop(),$s}return $n}(this.value)};var je=Object.keys||function(wt){var Sn=[];for(var Pn in wt)Sn.push(Pn);return Sn};function At(wt){return Object.prototype.toString.call(wt)}var Cn=Array.isArray||function(wt){return"[object Array]"===Object.prototype.toString.call(wt)},vn=function(wt,Sn){if(wt.forEach)return wt.forEach(Sn);for(var Pn=0;Pn<wt.length;Pn++)Sn(wt[Pn],Pn,wt)};vn(je(he.prototype),function(wt){q[wt]=function(Sn){var Pn=[].slice.call(arguments,1),$n=new he(Sn);return $n[wt].apply($n,Pn)}});var jn=Object.hasOwnProperty||function(wt,Sn){return Sn in wt}}),tr=gr;function gr(k){if(!(this instanceof gr))return new gr(k);this._bbox=k||[1/0,1/0,-1/0,-1/0],this._valid=!!k}gr.prototype.include=function(k){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],k[0]),this._bbox[1]=Math.min(this._bbox[1],k[1]),this._bbox[2]=Math.max(this._bbox[2],k[0]),this._bbox[3]=Math.max(this._bbox[3],k[1]),this},gr.prototype.equals=function(k){var q;return q=k instanceof gr?k.bbox():k,this._bbox[0]==q[0]&&this._bbox[1]==q[1]&&this._bbox[2]==q[2]&&this._bbox[3]==q[3]},gr.prototype.center=function(k){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},gr.prototype.union=function(k){var q;return this._valid=!0,q=k instanceof gr?k.bbox():k,this._bbox[0]=Math.min(this._bbox[0],q[0]),this._bbox[1]=Math.min(this._bbox[1],q[1]),this._bbox[2]=Math.max(this._bbox[2],q[2]),this._bbox[3]=Math.max(this._bbox[3],q[3]),this},gr.prototype.bbox=function(){return this._valid?this._bbox:null},gr.prototype.contains=function(k){if(!k)return this._fastContains();if(!this._valid)return null;var q=k[0],he=k[1];return this._bbox[0]<=q&&this._bbox[1]<=he&&this._bbox[2]>=q&&this._bbox[3]>=he},gr.prototype.intersect=function(k){return this._valid?(q=k instanceof gr?k.bbox():k,!(this._bbox[0]>q[2]||this._bbox[2]<q[0]||this._bbox[3]<q[1]||this._bbox[1]>q[3])):null;var q},gr.prototype._fastContains=function(){return this._valid?new Function("ll","return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]"):new Function("return null;")},gr.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var Gi={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},ks=Object.keys(Gi),ia=function(k){return zt(k).bbox()};function zt(k){for(var q=tr(),he=function(k){if(!k)return[];var q=Mr(cr(k)),he=[];return q.features.forEach(function(pt){pt.geometry&&(he=he.concat(function Bt(je){return Array.isArray(je)&&je.length&&"number"==typeof je[0]?[je]:je.reduce(function(At,Cn){return Array.isArray(Cn)&&Array.isArray(Cn[0])?At.concat(Bt(Cn)):(At.push(Cn),At)},[])}(pt.geometry.coordinates)))}),he}(k),pt=0;pt<he.length;pt++)q.include(he[pt]);return q}function Na(k,q){var he=-90,pt=90,Bt=-90,je=90,At=270,Cn=-270;k.forEach(function(jn){var wt=ia(jn),Sn=wt[1],Pn=wt[3],$n=wt[0],Ar=wt[2];Sn>he&&(he=Sn),Pn<pt&&(pt=Pn),Pn>Bt&&(Bt=Pn),Sn<je&&(je=Sn),$n<At&&(At=$n),Ar>Cn&&(Cn=Ar)});var vn=q;return he+vn.lat>85&&(vn.lat=85-he),Bt+vn.lat>90&&(vn.lat=90-Bt),pt+vn.lat<-85&&(vn.lat=-85-pt),je+vn.lat<-90&&(vn.lat=-90-je),At+vn.lng<=-270&&(vn.lng+=360*Math.ceil(Math.abs(vn.lng)/360)),Cn+vn.lng>=270&&(vn.lng-=360*Math.ceil(Math.abs(vn.lng)/360)),vn}function so(k,q){var he=Na(k.map(function(pt){return pt.toGeoJSON()}),q);k.forEach(function(pt){var Bt,je=pt.getCoordinates(),At=function(vn){var jn={lng:vn[0]+he.lng,lat:vn[1]+he.lat};return[jn.lng,jn.lat]},Cn=function(vn){return vn.map(function(jn){return At(jn)})};pt.type===$e?Bt=At(je):pt.type===Ge||"MultiPoint"===pt.type?Bt=je.map(At):pt.type===_t||"MultiLineString"===pt.type?Bt=je.map(Cn):"MultiPolygon"===pt.type&&(Bt=je.map(function(vn){return vn.map(function(jn){return Cn(jn)})})),pt.incomingCoords(Bt)})}ia.polygon=function(k){return zt(k).polygon()},ia.bboxify=function(k){return ji(k).map(function(q){q&&ks.some(function(he){return!!q[he]&&-1!==Gi[he].indexOf(q.type)})&&(q.bbox=zt(q).bbox(),this.update(q))})};var Hi={onSetup:function(k){var q=this,he={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:k.featureIds||[]};return this.setSelected(he.initiallySelectedFeatureIds.filter(function(pt){return void 0!==q.getFeature(pt)})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),he},fireUpdate:function(){this.map.fire(Re,{action:"move",features:this.getSelected().map(function(k){return k.toGeoJSON()})})},fireActionable:function(){var k=this,q=this.getSelected(),he=q.filter(function(Cn){return k.isInstanceOf("MultiFeature",Cn)}),pt=!1;if(q.length>1){pt=!0;var Bt=q[0].type.replace("Multi","");q.forEach(function(Cn){Cn.type.replace("Multi","")!==Bt&&(pt=!1)})}this.setActionableState({combineFeatures:pt,uncombineFeatures:he.length>0,trash:q.length>0})},getUniqueIds:function(k){return k.length?k.map(function(q){return q.properties.id}).filter(function(q){return void 0!==q}).reduce(function(q,he){return q.add(he),q},new ve).values():[]},stopExtendedInteractions:function(k){k.boxSelectElement&&(k.boxSelectElement.parentNode&&k.boxSelectElement.parentNode.removeChild(k.boxSelectElement),k.boxSelectElement=null),this.map.dragPan.enable(),k.boxSelecting=!1,k.canBoxSelect=!1,k.dragMoving=!1,k.canDragMove=!1},onStop:function(){cn(this)},onMouseMove:function(k){return this.stopExtendedInteractions(k),!0},onMouseOut:function(k){return!k.dragMoving||this.fireUpdate()}};Hi.onTap=Hi.onClick=function(k,q){return ie(q)?this.clickAnywhere(k,q):ns(pr)(q)?this.clickOnVertex(k,q):(he=q).featureTarget&&he.featureTarget.properties&&he.featureTarget.properties.meta===zn?this.clickOnFeature(k,q):void 0;var he},Hi.clickAnywhere=function(k){var q=this,he=this.getSelectedIds();he.length&&(this.clearSelectedFeatures(),he.forEach(function(pt){return q.doRender(pt)})),cn(this),this.stopExtendedInteractions(k)},Hi.clickOnVertex=function(k,q){this.changeMode(Ee.DIRECT_SELECT,{featureId:q.featureTarget.properties.parent,coordPath:q.featureTarget.properties.coord_path,startPos:q.lngLat}),this.updateUIClasses({mouse:fe})},Hi.startOnActiveFeature=function(k,q){this.stopExtendedInteractions(k),this.map.dragPan.disable(),this.doRender(q.featureTarget.properties.id),k.canDragMove=!0,k.dragMoveLocation=q.lngLat},Hi.clickOnFeature=function(k,q){var he=this;rr(this),this.stopExtendedInteractions(k);var pt=Ye(q),Bt=this.getSelectedIds(),je=q.featureTarget.properties.id,At=this.isSelected(je);if(!pt&&At&&this.getFeature(je).type!==$e)return this.changeMode(Ee.DIRECT_SELECT,{featureId:je});At&&pt?(this.deselect(je),this.updateUIClasses({mouse:pe}),1===Bt.length&&cn(this)):!At&&pt?(this.select(je),this.updateUIClasses({mouse:fe})):At||pt||(Bt.forEach(function(Cn){return he.doRender(Cn)}),this.setSelected(je),this.updateUIClasses({mouse:fe})),this.doRender(je)},Hi.onMouseDown=function(k,q){return Oe(q)?this.startOnActiveFeature(k,q):this.drawConfig.boxSelect&&(he=q).originalEvent&&he.originalEvent.shiftKey&&0===he.originalEvent.button?this.startBoxSelect(k,q):void 0;var he},Hi.startBoxSelect=function(k,q){this.stopExtendedInteractions(k),this.map.dragPan.disable(),k.boxSelectStartLocation=ht(q.originalEvent,this.map.getContainer()),k.canBoxSelect=!0},Hi.onTouchStart=function(k,q){if(Oe(q))return this.startOnActiveFeature(k,q)},Hi.onDrag=function(k,q){return k.canDragMove?this.dragMove(k,q):this.drawConfig.boxSelect&&k.canBoxSelect?this.whileBoxSelect(k,q):void 0},Hi.whileBoxSelect=function(k,q){k.boxSelecting=!0,this.updateUIClasses({mouse:Q}),k.boxSelectElement||(k.boxSelectElement=document.createElement("div"),k.boxSelectElement.classList.add("mapbox-gl-draw_boxselect"),this.map.getContainer().appendChild(k.boxSelectElement));var he=ht(q.originalEvent,this.map.getContainer()),pt=Math.min(k.boxSelectStartLocation.x,he.x),Bt=Math.max(k.boxSelectStartLocation.x,he.x),je=Math.min(k.boxSelectStartLocation.y,he.y),At=Math.max(k.boxSelectStartLocation.y,he.y),Cn="translate("+pt+"px, "+je+"px)";k.boxSelectElement.style.transform=Cn,k.boxSelectElement.style.WebkitTransform=Cn,k.boxSelectElement.style.width=Bt-pt+"px",k.boxSelectElement.style.height=At-je+"px"},Hi.dragMove=function(k,q){k.dragMoving=!0,q.originalEvent.stopPropagation();var he={lng:q.lngLat.lng-k.dragMoveLocation.lng,lat:q.lngLat.lat-k.dragMoveLocation.lat};so(this.getSelected(),he),k.dragMoveLocation=q.lngLat},Hi.onMouseUp=function(k,q){var he=this;if(k.dragMoving)this.fireUpdate();else if(k.boxSelecting){var pt=[k.boxSelectStartLocation,ht(q.originalEvent,this.map.getContainer())],Bt=this.featuresAt(null,pt,"click"),je=this.getUniqueIds(Bt).filter(function(At){return!he.isSelected(At)});je.length&&(this.select(je),je.forEach(function(At){return he.doRender(At)}),this.updateUIClasses({mouse:fe}))}this.stopExtendedInteractions(k)},Hi.toDisplayFeatures=function(k,q,he){q.properties.active=this.isSelected(q.properties.id)?Jr:ki,he(q),this.fireActionable(),q.properties.active===Jr&&q.geometry.type!==$e&&Rn(q).forEach(he)},Hi.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Hi.onCombineFeatures=function(){var k=this.getSelected();if(!(0===k.length||k.length<2)){for(var q=[],he=[],pt=k[0].type.replace("Multi",""),Bt=0;Bt<k.length;Bt++){var je=k[Bt];if(je.type.replace("Multi","")!==pt)return;je.type.includes("Multi")?je.getCoordinates().forEach(function(Cn){q.push(Cn)}):q.push(je.getCoordinates()),he.push(je.toGeoJSON())}if(he.length>1){var At=this.newFeature({type:J,properties:he[0].properties,geometry:{type:"Multi"+pt,coordinates:q}});this.addFeature(At),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([At.id]),this.map.fire("draw.combine",{createdFeatures:[At.toGeoJSON()],deletedFeatures:he})}this.fireActionable()}},Hi.onUncombineFeatures=function(){var k=this,q=this.getSelected();if(0!==q.length){for(var he=[],pt=[],Bt=function(At){var Cn=q[At];k.isInstanceOf("MultiFeature",Cn)&&(Cn.getFeatures().forEach(function(vn){k.addFeature(vn),vn.properties=Cn.properties,he.push(vn.toGeoJSON()),k.select([vn.id])}),k.deleteFeature(Cn.id,{silent:!0}),pt.push(Cn.toGeoJSON()))},je=0;je<q.length;je++)Bt(je);he.length>1&&this.map.fire("draw.uncombine",{createdFeatures:he,deletedFeatures:pt}),this.fireActionable()}};var Ki=ns(pr),du=ns(wn),Ea={fireUpdate:function(){this.map.fire(Re,{action:"change_coordinates",features:this.getSelected().map(function(k){return k.toGeoJSON()})})},fireActionable:function(k){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:k.selectedCoordPaths.length>0})},startDragging:function(k,q){this.map.dragPan.disable(),k.canDragMove=!0,k.dragMoveLocation=q.lngLat},stopDragging:function(k){this.map.dragPan.enable(),k.dragMoving=!1,k.canDragMove=!1,k.dragMoveLocation=null},onVertex:function(k,q){this.startDragging(k,q);var he=q.featureTarget.properties,pt=k.selectedCoordPaths.indexOf(he.coord_path);Ye(q)||-1!==pt?Ye(q)&&-1===pt&&k.selectedCoordPaths.push(he.coord_path):k.selectedCoordPaths=[he.coord_path];var Bt=this.pathsToCoordinates(k.featureId,k.selectedCoordPaths);this.setSelectedCoordinates(Bt)},onMidpoint:function(k,q){this.startDragging(k,q);var he=q.featureTarget.properties;k.feature.addCoordinate(he.coord_path,he.lng,he.lat),this.fireUpdate(),k.selectedCoordPaths=[he.coord_path]},pathsToCoordinates:function(k,q){return q.map(function(he){return{feature_id:k,coord_path:he}})},onFeature:function(k,q){0===k.selectedCoordPaths.length?this.startDragging(k,q):this.stopDragging(k)},dragFeature:function(k,q,he){so(this.getSelected(),he),k.dragMoveLocation=q.lngLat},dragVertex:function(k,q,he){for(var pt=k.selectedCoordPaths.map(function(Cn){return k.feature.getCoordinate(Cn)}),Bt=Na(pt.map(function(Cn){return{type:J,properties:{},geometry:{type:$e,coordinates:Cn}}}),he),je=0;je<pt.length;je++){var At=pt[je];k.feature.updateCoordinate(k.selectedCoordPaths[je],At[0]+Bt.lng,At[1]+Bt.lat)}},clickNoTarget:function(){this.changeMode(Ee.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(Ee.SIMPLE_SELECT)},clickActiveFeature:function(k){k.selectedCoordPaths=[],this.clearSelectedCoordinates(),k.feature.changed()},onSetup:function(k){var q=k.featureId,he=this.getFeature(q);if(!he)throw new Error("You must provide a featureId to enter direct_select mode");if(he.type===$e)throw new TypeError("direct_select mode doesn't handle point features");var pt={featureId:q,feature:he,dragMoveLocation:k.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:k.coordPath?[k.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(q,pt.selectedCoordPaths)),this.setSelected(q),rr(this),this.setActionableState({trash:!0}),pt},onStop:function(){cn(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(k,q,he){k.featureId===q.properties.id?(q.properties.active=Jr,he(q),Rn(q,{map:this.map,midpoints:!0,selectedPaths:k.selectedCoordPaths}).forEach(he)):(q.properties.active=ki,he(q)),this.fireActionable(k)},onTrash:function(k){k.selectedCoordPaths.sort(function(q,he){return he.localeCompare(q,"en",{numeric:!0})}).forEach(function(q){return k.feature.removeCoordinate(q)}),this.fireUpdate(),k.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(k),!1===k.feature.isValid()&&(this.deleteFeature([k.featureId]),this.changeMode(Ee.SIMPLE_SELECT,{}))},onMouseMove:function(k,q){var he=Oe(q),pt=Ki(q),Bt=0===k.selectedCoordPaths.length;return this.updateUIClasses(he&&Bt||pt&&!Bt?{mouse:fe}:{mouse:le}),this.stopDragging(k),!0},onMouseOut:function(k){return k.dragMoving&&this.fireUpdate(),!0}};Ea.onTouchStart=Ea.onMouseDown=function(k,q){return Ki(q)?this.onVertex(k,q):Oe(q)?this.onFeature(k,q):du(q)?this.onMidpoint(k,q):void 0},Ea.onDrag=function(k,q){if(!0===k.canDragMove){k.dragMoving=!0,q.originalEvent.stopPropagation();var he={lng:q.lngLat.lng-k.dragMoveLocation.lng,lat:q.lngLat.lat-k.dragMoveLocation.lat};k.selectedCoordPaths.length>0?this.dragVertex(k,q,he):this.dragFeature(k,q,he),k.dragMoveLocation=q.lngLat}},Ea.onClick=function(k,q){return ie(q)?this.clickNoTarget(k,q):Oe(q)?this.clickActiveFeature(k,q):Y(q)?this.clickInactive(k,q):void this.stopDragging(k)},Ea.onTap=function(k,q){return ie(q)?this.clickNoTarget(k,q):Oe(q)?this.clickActiveFeature(k,q):Y(q)?this.clickInactive(k,q):void 0},Ea.onTouchEnd=Ea.onMouseUp=function(k){k.dragMoving&&this.fireUpdate(),this.stopDragging(k)};var Ca={};function Fi(k,q){return!!k.lngLat&&k.lngLat.lng===q[0]&&k.lngLat.lat===q[1]}Ca.onSetup=function(){var k=this.newFeature({type:J,properties:{},geometry:{type:$e,coordinates:[]}});return this.addFeature(k),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Q}),this.activateUIButton(we.POINT),this.setActionableState({trash:!0}),{point:k}},Ca.stopDrawingAndRemove=function(k){this.deleteFeature([k.point.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT)},Ca.onTap=Ca.onClick=function(k,q){this.updateUIClasses({mouse:fe}),k.point.updateCoordinate("",q.lngLat.lng,q.lngLat.lat),this.map.fire(it,{features:[k.point.toGeoJSON()]}),this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.point.id]})},Ca.onStop=function(k){this.activateUIButton(),k.point.getCoordinate().length||this.deleteFeature([k.point.id],{silent:!0})},Ca.toDisplayFeatures=function(k,q,he){var pt=q.properties.id===k.point.id;if(q.properties.active=pt?Jr:ki,!pt)return he(q)},Ca.onTrash=Ca.stopDrawingAndRemove,Ca.onKeyUp=function(k,q){if(ot(q)||Mt(q))return this.stopDrawingAndRemove(k,q)};var gn={onSetup:function(){var k=this.newFeature({type:J,properties:{},geometry:{type:_t,coordinates:[[]]}});return this.addFeature(k),this.clearSelectedFeatures(),rr(this),this.updateUIClasses({mouse:Q}),this.activateUIButton(we.POLYGON),this.setActionableState({trash:!0}),{polygon:k,currentVertexPosition:0}},clickAnywhere:function(k,q){if(k.currentVertexPosition>0&&Fi(q,k.polygon.coordinates[0][k.currentVertexPosition-1]))return this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.polygon.id]});this.updateUIClasses({mouse:Q}),k.polygon.updateCoordinate("0."+k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat),k.currentVertexPosition++,k.polygon.updateCoordinate("0."+k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat)},clickOnVertex:function(k){return this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.polygon.id]})},onMouseMove:function(k,q){k.polygon.updateCoordinate("0."+k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat),ke(q)&&this.updateUIClasses({mouse:pe})}};gn.onTap=gn.onClick=function(k,q){return ke(q)?this.clickOnVertex(k,q):this.clickAnywhere(k,q)},gn.onKeyUp=function(k,q){ot(q)?(this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT)):Mt(q)&&this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.polygon.id]})},gn.onStop=function(k){this.updateUIClasses({mouse:le}),cn(this),this.activateUIButton(),void 0!==this.getFeature(k.polygon.id)&&(k.polygon.removeCoordinate("0."+k.currentVertexPosition),k.polygon.isValid()?this.map.fire(it,{features:[k.polygon.toGeoJSON()]}):(this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT,{},{silent:!0})))},gn.toDisplayFeatures=function(k,q,he){var pt=q.properties.id===k.polygon.id;if(q.properties.active=pt?Jr:ki,!pt)return he(q);if(0!==q.geometry.coordinates.length){var Bt=q.geometry.coordinates[0].length;if(!(Bt<3)){if(q.properties.meta=zn,he(nn(k.polygon.id,q.geometry.coordinates[0][0],"0.0",!1)),Bt>3){var je=q.geometry.coordinates[0].length-3;he(nn(k.polygon.id,q.geometry.coordinates[0][je],"0."+je,!1))}if(Bt<=4&&(he({type:J,properties:q.properties,geometry:{coordinates:[[q.geometry.coordinates[0][0][0],q.geometry.coordinates[0][0][1]],[q.geometry.coordinates[0][1][0],q.geometry.coordinates[0][1][1]]],type:Ge}}),3===Bt))return;return he(q)}}},gn.onTrash=function(k){this.deleteFeature([k.polygon.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT)};var or={onSetup:function(k){var q,he,pt=(k=k||{}).featureId,Bt="forward";if(pt){if(!(q=this.getFeature(pt)))throw new Error("Could not find a feature with the provided featureId");var je=k.from;if(je&&"Feature"===je.type&&je.geometry&&"Point"===je.geometry.type&&(je=je.geometry),je&&"Point"===je.type&&je.coordinates&&2===je.coordinates.length&&(je=je.coordinates),!je||!Array.isArray(je))throw new Error("Please use the `from` property to indicate which point to continue the line from");var At=q.coordinates.length-1;if(q.coordinates[At][0]===je[0]&&q.coordinates[At][1]===je[1])q.addCoordinate.apply(q,[he=At+1].concat(q.coordinates[At]));else{if(q.coordinates[0][0]!==je[0]||q.coordinates[0][1]!==je[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");Bt="backwards",q.addCoordinate.apply(q,[he=0].concat(q.coordinates[0]))}}else q=this.newFeature({type:J,properties:{},geometry:{type:Ge,coordinates:[]}}),he=0,this.addFeature(q);return this.clearSelectedFeatures(),rr(this),this.updateUIClasses({mouse:Q}),this.activateUIButton(we.LINE),this.setActionableState({trash:!0}),{line:q,currentVertexPosition:he,direction:Bt}},clickAnywhere:function(k,q){if(k.currentVertexPosition>0&&Fi(q,k.line.coordinates[k.currentVertexPosition-1])||"backwards"===k.direction&&Fi(q,k.line.coordinates[k.currentVertexPosition+1]))return this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.line.id]});this.updateUIClasses({mouse:Q}),k.line.updateCoordinate(k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat),"forward"===k.direction?(k.currentVertexPosition++,k.line.updateCoordinate(k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat)):k.line.addCoordinate(0,q.lngLat.lng,q.lngLat.lat)},clickOnVertex:function(k){return this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.line.id]})},onMouseMove:function(k,q){k.line.updateCoordinate(k.currentVertexPosition,q.lngLat.lng,q.lngLat.lat),ke(q)&&this.updateUIClasses({mouse:pe})}};or.onTap=or.onClick=function(k,q){if(ke(q))return this.clickOnVertex(k,q);this.clickAnywhere(k,q)},or.onKeyUp=function(k,q){Mt(q)?this.changeMode(Ee.SIMPLE_SELECT,{featureIds:[k.line.id]}):ot(q)&&(this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT))},or.onStop=function(k){cn(this),this.activateUIButton(),void 0!==this.getFeature(k.line.id)&&(k.line.removeCoordinate(""+k.currentVertexPosition),k.line.isValid()?this.map.fire(it,{features:[k.line.toGeoJSON()]}):(this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT,{},{silent:!0})))},or.onTrash=function(k){this.deleteFeature([k.line.id],{silent:!0}),this.changeMode(Ee.SIMPLE_SELECT)},or.toDisplayFeatures=function(k,q,he){var pt=q.properties.id===k.line.id;if(q.properties.active=pt?Jr:ki,!pt)return he(q);q.geometry.coordinates.length<2||(q.properties.meta=zn,he(nn(k.line.id,q.geometry.coordinates["forward"===k.direction?q.geometry.coordinates.length-2:1],""+("forward"===k.direction?q.geometry.coordinates.length-2:1),!1)),he(q))};var Vr={simple_select:Hi,direct_select:Ea,draw_point:Ca,draw_polygon:gn,draw_line_string:or},Eu={defaultMode:Ee.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}],modes:Vr,controls:{},userProperties:!1},sl={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},hn={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Wu(k,q){return k.map(function(he){return he.source?he:Ks(he,{id:he.id+"."+q,source:"hot"===q?Me:de})})}var oa=Kt(function(k,q){var he="[object Arguments]",pt="[object Map]",Bt="[object Object]",je="[object Set]",At=/^\[object .+?Constructor\]$/,Cn=/^(?:0|[1-9]\d*)$/,vn={};vn["[object Float32Array]"]=vn["[object Float64Array]"]=vn["[object Int8Array]"]=vn["[object Int16Array]"]=vn["[object Int32Array]"]=vn["[object Uint8Array]"]=vn["[object Uint8ClampedArray]"]=vn["[object Uint16Array]"]=vn["[object Uint32Array]"]=!0,vn[he]=vn["[object Array]"]=vn["[object ArrayBuffer]"]=vn["[object Boolean]"]=vn["[object DataView]"]=vn["[object Date]"]=vn["[object Error]"]=vn["[object Function]"]=vn[pt]=vn["[object Number]"]=vn[Bt]=vn["[object RegExp]"]=vn[je]=vn["[object String]"]=vn["[object WeakMap]"]=!1;var jn="object"==typeof global&&global&&global.Object===Object&&global,wt="object"==typeof self&&self&&self.Object===Object&&self,Sn=jn||wt||Function("return this")(),Pn=q&&!q.nodeType&&q,$n=Pn&&k&&!k.nodeType&&k,Ar=$n&&$n.exports===Pn,$s=Ar&&jn.process,sn=function(){try{return $s&&$s.binding&&$s.binding("util")}catch{}}(),qn=sn&&sn.isTypedArray;function Si(Et,en){for(var En=-1,hr=null==Et?0:Et.length;++En<hr;)if(en(Et[En],En,Et))return!0;return!1}function ar(Et){var en=-1,En=Array(Et.size);return Et.forEach(function(hr,Nr){En[++en]=[Nr,hr]}),En}function Rr(Et){var en=-1,En=Array(Et.size);return Et.forEach(function(hr){En[++en]=hr}),En}var Zn,Yu,eu,bn=Array.prototype,Jo=Object.prototype,ca=Sn["__core-js_shared__"],pu=Function.prototype.toString,Ss=Jo.hasOwnProperty,yl=(Zn=/[^.]+$/.exec(ca&&ca.keys&&ca.keys.IE_PROTO||""))?"Symbol(src)_1."+Zn:"",vs=Jo.toString,al=RegExp("^"+pu.call(Ss).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),us=Ar?Sn.Buffer:void 0,uo=Sn.Symbol,jo=Sn.Uint8Array,kl=Jo.propertyIsEnumerable,Xr=bn.splice,Fs=uo?uo.toStringTag:void 0,Hc=Object.getOwnPropertySymbols,ka=us?us.isBuffer:void 0,sa=(Yu=Object.keys,eu=Object,function(Et){return Yu(eu(Et))}),Cu=zs(Sn,"DataView"),li=zs(Sn,"Map"),Ku=zs(Sn,"Promise"),tu=zs(Sn,"Set"),Su=zs(Sn,"WeakMap"),Xi=zs(Object,"create"),vr=qs(Cu),_l=qs(li),Fl=qs(Ku),xs=qs(tu),gi=qs(Su),nu=uo?uo.prototype:void 0,ru=nu?nu.valueOf:void 0;function Sa(Et){var en=-1,En=null==Et?0:Et.length;for(this.clear();++en<En;){var hr=Et[en];this.set(hr[0],hr[1])}}function gu(Et){var en=-1,En=null==Et?0:Et.length;for(this.clear();++en<En;){var hr=Et[en];this.set(hr[0],hr[1])}}function Gn(Et){var en=-1,En=null==Et?0:Et.length;for(this.clear();++en<En;){var hr=Et[en];this.set(hr[0],hr[1])}}function Ia(Et){var en=-1,En=null==Et?0:Et.length;for(this.__data__=new Gn;++en<En;)this.add(Et[en])}function xr(Et){var en=this.__data__=new gu(Et);this.size=en.size}function Is(Et,en){for(var En=Et.length;En--;)if(Js(Et[En][0],en))return En;return-1}function Ta(Et){return null==Et?void 0===Et?"[object Undefined]":"[object Null]":Fs&&Fs in Object(Et)?function(en){var En=Ss.call(en,Fs),hr=en[Fs];try{en[Fs]=void 0;var Nr=!0}catch{}var mr=vs.call(en);return Nr&&(En?en[Fs]=hr:delete en[Fs]),mr}(Et):vs.call(Et)}function ci(Et){return Zs(Et)&&Ta(Et)==he}function Ii(Et,en,En,hr,Nr){return Et===en||(null==Et||null==en||!Zs(Et)&&!Zs(en)?Et!=Et&&en!=en:function(mr,xi,zi,Ms,hi,Kn){var Ur=ou(mr),Zi=ou(xi),rs=Ur?"[object Array]":Wr(mr),Fa=Zi?"[object Array]":Wr(xi),Vo=(rs=rs==he?Bt:rs)==Bt,Hs=(Fa=Fa==he?Bt:Fa)==Bt,fi=rs==Fa;if(fi&&ul(mr)){if(!ul(xi))return!1;Ur=!0,Vo=!1}if(fi&&!Vo)return Kn||(Kn=new xr),Ur||Ma(mr)?Qo(mr,xi,zi,Ms,hi,Kn):function(Qi,Vi,ha,eo,is,fo,$i){switch(ha){case"[object DataView]":if(Qi.byteLength!=Vi.byteLength||Qi.byteOffset!=Vi.byteOffset)return!1;Qi=Qi.buffer,Vi=Vi.buffer;case"[object ArrayBuffer]":return!(Qi.byteLength!=Vi.byteLength||!fo(new jo(Qi),new jo(Vi)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Js(+Qi,+Vi);case"[object Error]":return Qi.name==Vi.name&&Qi.message==Vi.message;case"[object RegExp]":case"[object String]":return Qi==Vi+"";case pt:var su=ar;case je:if(su||(su=Rr),Qi.size!=Vi.size&&!(1&eo))return!1;var qi=$i.get(Qi);if(qi)return qi==Vi;eo|=2,$i.set(Qi,Vi);var Go=Qo(su(Qi),su(Vi),eo,is,fo,$i);return $i.delete(Qi),Go;case"[object Symbol]":if(ru)return ru.call(Qi)==ru.call(Vi)}return!1}(mr,xi,rs,zi,Ms,hi,Kn);if(!(1&zi)){var Xa=Vo&&Ss.call(mr,"__wrapped__"),ls=Hs&&Ss.call(xi,"__wrapped__");if(Xa||ls){var Qr=Xa?mr.value():mr,Qu=ls?xi.value():xi;return Kn||(Kn=new xr),hi(Qr,Qu,zi,Ms,Kn)}}return!!fi&&(Kn||(Kn=new xr),function(Qi,Vi,ha,eo,is,fo){var $i=1&ha,su=vl(Qi),Za=su.length;if(Za!=vl(Vi).length&&!$i)return!1;for(var Go=Za;Go--;){var no=su[Go];if(!($i?no in Vi:Ss.call(Vi,no)))return!1}var za=fo.get(Qi);if(za&&fo.get(Vi))return za==Vi;var os=!0;fo.set(Qi,Vi),fo.set(Vi,Qi);for(var yu=$i;++Go<Za;){var Ba=Qi[no=su[Go]],Wi=Vi[no];if(eo)var ei=$i?eo(Wi,Ba,no,Vi,Qi,fo):eo(Ba,Wi,no,Qi,Vi,fo);if(!(void 0===ei?Ba===Wi||is(Ba,Wi,ha,eo,fo):ei)){os=!1;break}yu||(yu="constructor"==no)}if(os&&!yu){var ps=Qi.constructor,ro=Vi.constructor;ps==ro||!("constructor"in Qi)||!("constructor"in Vi)||"function"==typeof ps&&ps instanceof ps&&"function"==typeof ro&&ro instanceof ro||(os=!1)}return fo.delete(Qi),fo.delete(Vi),os}(mr,xi,zi,Ms,hi,Kn))}(Et,en,En,hr,Ii,Nr))}function Qo(Et,en,En,hr,Nr,mr){var xi=1&En,zi=Et.length,Ms=en.length;if(zi!=Ms&&!(xi&&Ms>zi))return!1;var hi=mr.get(Et);if(hi&&mr.get(en))return hi==en;var Kn=-1,Ur=!0,Zi=2&En?new Ia:void 0;for(mr.set(Et,en),mr.set(en,Et);++Kn<zi;){var rs=Et[Kn],Fa=en[Kn];if(hr)var Vo=xi?hr(Fa,rs,Kn,en,Et,mr):hr(rs,Fa,Kn,Et,en,mr);if(void 0!==Vo){if(Vo)continue;Ur=!1;break}if(Zi){if(!Si(en,function(Hs,fi){if(!Zi.has(fi)&&(rs===Hs||Nr(rs,Hs,En,hr,mr)))return Zi.push(fi)})){Ur=!1;break}}else if(rs!==Fa&&!Nr(rs,Fa,En,hr,mr)){Ur=!1;break}}return mr.delete(Et),mr.delete(en),Ur}function vl(Et){return hr=mi,Nr=function Qs(Et){return null!=(en=Et)&&Ts(en.length)&&!Ju(en)?function Fu(Et,en){var En=ou(Et),hr=!En&&Bs(Et),Nr=!En&&!hr&&ul(Et),mr=!En&&!hr&&!Nr&&Ma(Et),xi=En||hr||Nr||mr,zi=xi?function(Kn,Ur){for(var Zi=-1,rs=Array(Kn);++Zi<Kn;)rs[Zi]=Ur(Zi);return rs}(Et.length,String):[],Ms=zi.length;for(var hi in Et)!en&&!Ss.call(Et,hi)||xi&&("length"==hi||Nr&&("offset"==hi||"parent"==hi)||mr&&("buffer"==hi||"byteLength"==hi||"byteOffset"==hi)||zu(hi,Ms))||zi.push(hi);return zi}(Et):function iu(Et){if(En=(en=Et)&&en.constructor,en!==("function"==typeof En&&En.prototype||Jo))return sa(Et);var en,En,Nr=[];for(var mr in Object(Et))Ss.call(Et,mr)&&"constructor"!=mr&&Nr.push(mr);return Nr}(Et);var en}(en=Et),ou(en)?Nr:function(mr,xi){for(var zi=-1,Ms=xi.length,hi=mr.length;++zi<Ms;)mr[hi+zi]=xi[zi];return mr}(Nr,hr(en));var en,hr,Nr}function zl(Et,en){var En,hr,Nr=Et.__data__;return("string"==(hr=typeof(En=en))||"number"==hr||"symbol"==hr||"boolean"==hr?"__proto__"!==En:null===En)?Nr["string"==typeof en?"string":"hash"]:Nr.map}function zs(Et,en){var En=Et?.[en];return function Ji(Et){return!(!mu(Et)||(en=Et,yl&&yl in en))&&(Ju(Et)?al:At).test(qs(Et));var en}(En)?En:void 0}Sa.prototype.clear=function(){this.__data__=Xi?Xi(null):{},this.size=0},Sa.prototype.delete=function(Et){var en=this.has(Et)&&delete this.__data__[Et];return this.size-=en?1:0,en},Sa.prototype.get=function(Et){var en=this.__data__;if(Xi){var En=en[Et];return"__lodash_hash_undefined__"===En?void 0:En}return Ss.call(en,Et)?en[Et]:void 0},Sa.prototype.has=function(Et){var en=this.__data__;return Xi?void 0!==en[Et]:Ss.call(en,Et)},Sa.prototype.set=function(Et,en){var En=this.__data__;return this.size+=this.has(Et)?0:1,En[Et]=Xi&&void 0===en?"__lodash_hash_undefined__":en,this},gu.prototype.clear=function(){this.__data__=[],this.size=0},gu.prototype.delete=function(Et){var en=this.__data__,En=Is(en,Et);return!(En<0||(En==en.length-1?en.pop():Xr.call(en,En,1),--this.size,0))},gu.prototype.get=function(Et){var en=this.__data__,En=Is(en,Et);return En<0?void 0:en[En][1]},gu.prototype.has=function(Et){return Is(this.__data__,Et)>-1},gu.prototype.set=function(Et,en){var En=this.__data__,hr=Is(En,Et);return hr<0?(++this.size,En.push([Et,en])):En[hr][1]=en,this},Gn.prototype.clear=function(){this.size=0,this.__data__={hash:new Sa,map:new(li||gu),string:new Sa}},Gn.prototype.delete=function(Et){var en=zl(this,Et).delete(Et);return this.size-=en?1:0,en},Gn.prototype.get=function(Et){return zl(this,Et).get(Et)},Gn.prototype.has=function(Et){return zl(this,Et).has(Et)},Gn.prototype.set=function(Et,en){var En=zl(this,Et),hr=En.size;return En.set(Et,en),this.size+=En.size==hr?0:1,this},Ia.prototype.add=Ia.prototype.push=function(Et){return this.__data__.set(Et,"__lodash_hash_undefined__"),this},Ia.prototype.has=function(Et){return this.__data__.has(Et)},xr.prototype.clear=function(){this.__data__=new gu,this.size=0},xr.prototype.delete=function(Et){var en=this.__data__,En=en.delete(Et);return this.size=en.size,En},xr.prototype.get=function(Et){return this.__data__.get(Et)},xr.prototype.has=function(Et){return this.__data__.has(Et)},xr.prototype.set=function(Et,en){var En=this.__data__;if(En instanceof gu){var hr=En.__data__;if(!li||hr.length<199)return hr.push([Et,en]),this.size=++En.size,this;En=this.__data__=new Gn(hr)}return En.set(Et,en),this.size=En.size,this};var mi=Hc?function(Et){return null==Et?[]:(Et=Object(Et),function(en,En){for(var hr=-1,Nr=null==en?0:en.length,mr=0,xi=[];++hr<Nr;){var zi=en[hr];En(zi)&&(xi[mr++]=zi)}return xi}(Hc(Et),function(en){return kl.call(Et,en)}))}:function(){return[]},Wr=Ta;function zu(Et,en){return!!(en=en??9007199254740991)&&("number"==typeof Et||Cn.test(Et))&&Et>-1&&Et%1==0&&Et<en}function qs(Et){if(null!=Et){try{return pu.call(Et)}catch{}try{return Et+""}catch{}}return""}function Js(Et,en){return Et===en||Et!=Et&&en!=en}(Cu&&"[object DataView]"!=Wr(new Cu(new ArrayBuffer(1)))||li&&Wr(new li)!=pt||Ku&&"[object Promise]"!=Wr(Ku.resolve())||tu&&Wr(new tu)!=je||Su&&"[object WeakMap]"!=Wr(new Su))&&(Wr=function(Et){var en=Ta(Et),En=en==Bt?Et.constructor:void 0,hr=En?qs(En):"";if(hr)switch(hr){case vr:return"[object DataView]";case _l:return pt;case Fl:return"[object Promise]";case xs:return je;case gi:return"[object WeakMap]"}return en});var Bs=ci(function(){return arguments}())?ci:function(Et){return Zs(Et)&&Ss.call(Et,"callee")&&!kl.call(Et,"callee")},ou=Array.isArray,ul=ka||function(){return!1};function Ju(Et){if(!mu(Et))return!1;var en=Ta(Et);return"[object Function]"==en||"[object GeneratorFunction]"==en||"[object AsyncFunction]"==en||"[object Proxy]"==en}function Ts(Et){return"number"==typeof Et&&Et>-1&&Et%1==0&&Et<=9007199254740991}function mu(Et){var en=typeof Et;return null!=Et&&("object"==en||"function"==en)}function Zs(Et){return null!=Et&&"object"==typeof Et}var Et,Ma=qn?(Et=qn,function(en){return Et(en)}):function(Et){return Zs(Et)&&Ts(Et.length)&&!!vn[Ta(Et)]};k.exports=function(Et,en){return Ii(Et,en)}}),Nl={Polygon:_i,LineString:Lr,Point:On,MultiPolygon:Ri,MultiLineString:Ri,MultiPoint:Ri};var Fn=function(k,q){var he={options:k=function(Bt){void 0===Bt&&(Bt={});var je=Ks(Bt);return Bt.controls||(je.controls={}),je.controls=Ks(!1===Bt.displayControlsDefault?hn:sl,Bt.controls),(je=Ks(Eu,je)).styles=Wu(je.styles,"cold").concat(Wu(je.styles,"hot")),je}(k)};q=function Br(k,q){return q.modes=Ee,q.getFeatureIdsAt=function(he){return se.click({point:he},null,k).map(function(pt){return pt.properties.id})},q.getSelectedIds=function(){return k.store.getSelectedIds()},q.getSelected=function(){return{type:ue,features:k.store.getSelectedIds().map(function(he){return k.store.get(he)}).map(function(he){return he.toGeoJSON()})}},q.getSelectedPoints=function(){return{type:ue,features:k.store.getSelectedCoordinates().map(function(he){return{type:J,properties:{},geometry:{type:$e,coordinates:he.coordinates}}})}},q.set=function(he){if(void 0===he.type||he.type!==ue||!Array.isArray(he.features))throw new Error("Invalid FeatureCollection");var pt=k.store.createRenderBatch(),Bt=k.store.getAllIds().slice(),je=q.add(he),At=new ve(je);return(Bt=Bt.filter(function(Cn){return!At.has(Cn)})).length&&q.delete(Bt),pt(),je},q.add=function(he){var pt=JSON.parse(JSON.stringify(cr(he))).features.map(function(Bt){if(Bt.id=Bt.id||Pr(),null===Bt.geometry)throw new Error("Invalid geometry: null");if(void 0===k.store.get(Bt.id)||k.store.get(Bt.id).type!==Bt.geometry.type){var je=Nl[Bt.geometry.type];if(void 0===je)throw new Error("Invalid geometry type: "+Bt.geometry.type+".");var At=new je(k,Bt);k.store.add(At)}else{var Cn=k.store.get(Bt.id);Cn.properties=Bt.properties,oa(Cn.getCoordinates(),Bt.geometry.coordinates)||Cn.incomingCoords(Bt.geometry.coordinates)}return Bt.id});return k.store.render(),pt},q.get=function(he){var pt=k.store.get(he);if(pt)return pt.toGeoJSON()},q.getAll=function(){return{type:ue,features:k.store.getAll().map(function(he){return he.toGeoJSON()})}},q.delete=function(he){return k.store.delete(he,{silent:!0}),q.getMode()!==Ee.DIRECT_SELECT||k.store.getSelectedIds().length?k.store.render():k.events.changeMode(Ee.SIMPLE_SELECT,void 0,{silent:!0}),q},q.deleteAll=function(){return k.store.delete(k.store.getAllIds(),{silent:!0}),q.getMode()===Ee.DIRECT_SELECT?k.events.changeMode(Ee.SIMPLE_SELECT,void 0,{silent:!0}):k.store.render(),q},q.changeMode=function(he,pt){return void 0===pt&&(pt={}),he===Ee.SIMPLE_SELECT&&q.getMode()===Ee.SIMPLE_SELECT?(Bt=pt.featureIds||[],je=k.store.getSelectedIds(),Bt.length===je.length&&JSON.stringify(Bt.map(function(At){return At}).sort())===JSON.stringify(je.map(function(At){return At}).sort())||(k.store.setSelected(pt.featureIds,{silent:!0}),k.store.render()),q):(he===Ee.DIRECT_SELECT&&q.getMode()===Ee.DIRECT_SELECT&&pt.featureId===k.store.getSelectedIds()[0]||k.events.changeMode(he,pt,{silent:!0}),q);var Bt,je},q.getMode=function(){return k.events.getMode()},q.trash=function(){return k.events.trash({silent:!0}),q},q.combineFeatures=function(){return k.events.combineFeatures({silent:!0}),q},q.uncombineFeatures=function(){return k.events.uncombineFeatures({silent:!0}),q},q.setFeatureProperty=function(he,pt,Bt){return k.store.setFeatureProperty(he,pt,Bt),q},q}(he,q),he.api=q;var pt=Ha(he);return q.onAdd=pt.onAdd,q.onRemove=pt.onRemove,q.types=we,q.options=k,q};function Cc(k){Fn(k,this)}return Cc.modes=Vr,Cc}()},7521:(xn,It,He)=>{"use strict";function Te(e){return"function"==typeof e}function Ue(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const ft=Ue(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class Ce{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(Te(r))try{r()}catch(c){t=c instanceof ft?c.errors:[c]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const c of o)try{yt(c)}catch(d){t=t??[],d instanceof ft?t=[...t,...d.errors]:t.push(d)}}if(t)throw new ft(t)}}add(t){var n;if(t&&t!==this)if(this.closed)yt(t);else{if(t instanceof Ce){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof Ce&&t._removeParent(this)}}Ce.EMPTY=(()=>{const e=new Ce;return e.closed=!0,e})();const We=Ce.EMPTY;function dt(e){return e instanceof Ce||e&&"closed"in e&&Te(e.remove)&&Te(e.add)&&Te(e.unsubscribe)}function yt(e){Te(e)?e():e.unsubscribe()}const Lt={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},un={setTimeout(e,t,...n){const{delegate:r}=un;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=un;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Gt(e){un.setTimeout(()=>{const{onUnhandledError:t}=Lt;if(!t)throw e;t(e)})}function Tt(){}const Xt=Me("C",void 0,void 0);function Me(e,t,n){return{kind:e,value:t,error:n}}let de=null;function Q(e){if(Lt.useDeprecatedSynchronousErrorHandling){const t=!de;if(t&&(de={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=de;if(de=null,n)throw r}}else e()}class ze extends Ce{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,dt(t)&&t.add(this)):this.destination=ue}static create(t,n,r){return new J(t,n,r)}next(t){this.isStopped?$e(function ge(e){return Me("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?$e(function Dn(e){return Me("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?$e(Xt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const pe=Function.prototype.bind;function le(e,t){return pe.call(e,t)}class we{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){_t(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){_t(r)}else _t(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){_t(n)}}}class J extends ze{constructor(t,n,r){let o;if(super(),Te(t)||!t)o={next:t??void 0,error:n??void 0,complete:r??void 0};else{let c;this&&Lt.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&le(t.next,c),error:t.error&&le(t.error,c),complete:t.complete&&le(t.complete,c)}):o=t}this.destination=new we(o)}}function _t(e){Lt.useDeprecatedSynchronousErrorHandling?function fe(e){Lt.useDeprecatedSynchronousErrorHandling&&de&&(de.errorThrown=!0,de.error=e)}(e):Gt(e)}function $e(e,t){const{onStoppedNotification:n}=Lt;n&&un.setTimeout(()=>n(e,t))}const ue={closed:!0,next:Tt,error:function Ge(e){throw e},complete:Tt},on="function"==typeof Symbol&&Symbol.observable||"@@observable";function kt(e){return e}function gt(e){return 0===e.length?kt:1===e.length?e[0]:function(n){return e.reduce((r,o)=>o(r),n)}}let Ee=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,o){const c=function Re(e){return e&&e instanceof ze||function vt(e){return e&&Te(e.next)&&Te(e.error)&&Te(e.complete)}(e)&&dt(e)}(n)?n:new J(n,r,o);return Q(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=it(r))((o,c)=>{const d=new J({next:_=>{try{n(_)}catch(E){c(E),d.unsubscribe()}},error:c,complete:o});this.subscribe(d)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[on](){return this}pipe(...n){return gt(n)(this)}toPromise(n){return new(n=it(n))((r,o)=>{let c;this.subscribe(d=>c=d,d=>o(d),()=>r(c))})}}return e.create=t=>new e(t),e})();function it(e){var t;return null!==(t=e??Lt.Promise)&&void 0!==t?t:Promise}const Yt=Ue(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let $t=(()=>{class e extends Ee{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new Mn(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Yt}next(n){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Q(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:o,observers:c}=this;return r||o?We:(this.currentObservers=null,c.push(n),new Ce(()=>{this.currentObservers=null,p(c,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:o,isStopped:c}=this;r?n.error(o):c&&n.complete()}asObservable(){const n=new Ee;return n.source=this,n}}return e.create=(t,n)=>new Mn(t,n),e})();class Mn extends $t{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:We}}function jt(e){return Te(e?.lift)}function Xn(e){return t=>{if(jt(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Qn(e,t,n,r,o){return new sr(e,t,n,r,o)}class sr extends ze{constructor(t,n,r,o,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(E){t.error(E)}}:super._next,this._error=o?function(_){try{o(_)}catch(E){t.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function kn(e,t){return Xn((n,r)=>{let o=0;n.subscribe(Qn(r,c=>{r.next(e.call(t,c,o++))}))})}function Kt(e){return this instanceof Kt?(this.v=e,this):new Kt(e)}function Pr(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),c=[];return o={},d("next"),d("throw"),d("return"),o[Symbol.asyncIterator]=function(){return this},o;function d(N){r[N]&&(o[N]=function(B){return new Promise(function(te,ne){c.push([N,B,te,ne])>1||_(N,B)})})}function _(N,B){try{!function E(N){N.value instanceof Kt?Promise.resolve(N.value.v).then(C,D):L(c[0][2],N)}(r[N](B))}catch(te){L(c[0][3],te)}}function C(N){_("next",N)}function D(N){_("throw",N)}function L(N,B){N(B),c.shift(),c.length&&_(c[0][0],c[0][1])}}function On(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function Ve(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=e[c]&&function(d){return new Promise(function(_,E){!function o(c,d,_,E){Promise.resolve(E).then(function(C){c({value:C,done:_})},d)}(_,E,(d=e[c](d)).done,d.value)})}}}const Ko=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function Ns(e){return Te(e?.then)}function Ci(e){return Te(e[on])}function Ys(e){return Symbol.asyncIterator&&Te(e?.[Symbol.asyncIterator])}function oi(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const Ks=function An(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function as(e){return Te(e?.[Ks])}function $r(e){return Pr(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:o}=yield Kt(n.read());if(o)return yield Kt(void 0);yield yield Kt(r)}}finally{n.releaseLock()}})}function Ha(e){return Te(e?.getReader)}function ns(e){if(e instanceof Ee)return e;if(null!=e){if(Ci(e))return function Oe(e){return new Ee(t=>{const n=e[on]();if(Te(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(Ko(e))return function Y(e){return new Ee(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(Ns(e))return function ie(e){return new Ee(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Gt)})}(e);if(Ys(e))return Ye(e);if(as(e))return function ke(e){return new Ee(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Ha(e))return function ot(e){return Ye($r(e))}(e)}throw oi(e)}function Ye(e){return new Ee(t=>{(function Mt(e,t){var n,r,o,c;return function St(e,t,n,r){return new(n||(n=Promise))(function(c,d){function _(D){try{C(r.next(D))}catch(L){d(L)}}function E(D){try{C(r.throw(D))}catch(L){d(L)}}function C(D){D.done?c(D.value):function o(c){return c instanceof n?c:new n(function(d){d(c)})}(D.value).then(_,E)}C((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=On(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(d){o={error:d}}finally{try{r&&!r.done&&(c=n.return)&&(yield c.call(n))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function Ct(e,t,n,r=0,o=!1){const c=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(c),!o)return c}function ht(e,t,n=1/0){return Te(t)?ht((r,o)=>kn((c,d)=>t(r,c,o,d))(ns(e(r,o))),n):("number"==typeof t&&(n=t),Xn((r,o)=>function lt(e,t,n,r,o,c,d,_){const E=[];let C=0,D=0,L=!1;const N=()=>{L&&!E.length&&!C&&t.complete()},B=ne=>C<r?te(ne):E.push(ne),te=ne=>{c&&t.next(ne),C++;let Pe=!1;ns(n(ne,D++)).subscribe(Qn(t,xe=>{o?.(xe),c?B(xe):t.next(xe)},()=>{Pe=!0},void 0,()=>{if(Pe)try{for(C--;E.length&&C<r;){const xe=E.shift();d?Ct(t,d,()=>te(xe)):te(xe)}N()}catch(xe){t.error(xe)}}))};return e.subscribe(Qn(t,B,()=>{L=!0,N()})),()=>{_?.()}}(r,o,e,n)))}function nn(e=1/0){return ht(kt,e)}const Rn=new Ee(e=>e.complete());function ir(e){return e[e.length-1]}function Dr(e){return function cr(e){return e&&Te(e.schedule)}(ir(e))?e.pop():void 0}function tr(e,t=0){return Xn((n,r)=>{n.subscribe(Qn(r,o=>Ct(r,e,()=>r.next(o),t),()=>Ct(r,e,()=>r.complete(),t),o=>Ct(r,e,()=>r.error(o),t)))})}function gr(e,t=0){return Xn((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Na(e,t){if(!e)throw new Error("Iterable cannot be null");return new Ee(n=>{Ct(n,t,()=>{const r=e[Symbol.asyncIterator]();Ct(n,t,()=>{r.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function Ki(e,t){return t?function Hi(e,t){if(null!=e){if(Ci(e))return function Gi(e,t){return ns(e).pipe(gr(t),tr(t))}(e,t);if(Ko(e))return function ia(e,t){return new Ee(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(Ns(e))return function ks(e,t){return ns(e).pipe(gr(t),tr(t))}(e,t);if(Ys(e))return Na(e,t);if(as(e))return function zt(e,t){return new Ee(n=>{let r;return Ct(n,t,()=>{r=e[Ks](),Ct(n,t,()=>{let o,c;try{({value:o,done:c}=r.next())}catch(d){return void n.error(d)}c?n.complete():n.next(o)},0,!0)}),()=>Te(r?.return)&&r.return()})}(e,t);if(Ha(e))return function so(e,t){return Na($r(e),t)}(e,t)}throw oi(e)}(e,t):ns(e)}function Ca(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new J({next:()=>{r.unsubscribe(),e()}});return t(...n).subscribe(r)}function Fi(e){for(let t in e)if(e[t]===Fi)return t;throw Error("Could not find renamed property on target object.")}function or(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(or).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function Vr(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Eu=Fi({__forward_ref__:Fi});function sl(e){return e.__forward_ref__=sl,e.toString=function(){return or(this())},e}function hn(e){return Wu(e)?e():e}function Wu(e){return"function"==typeof e&&e.hasOwnProperty(Eu)&&e.__forward_ref__===sl}function oa(e){return e&&!!e.\u0275providers}class Fn extends Error{constructor(t,n){super(function Cc(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function k(e){return"string"==typeof e?e:null==e?"":String(e)}function je(e,t){throw new Fn(-201,!1)}function ar(e,t){null==e&&function Rr(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function bn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Jo(e){return{providers:e.providers||[],imports:e.imports||[]}}function ca(e){return Ss(e,us)||Ss(e,jo)}function Ss(e,t){return e.hasOwnProperty(t)?e[t]:null}function al(e){return e&&(e.hasOwnProperty(uo)||e.hasOwnProperty(kl))?e[uo]:null}const us=Fi({\u0275prov:Fi}),uo=Fi({\u0275inj:Fi}),jo=Fi({ngInjectableDef:Fi}),kl=Fi({ngInjectorDef:Fi});var Xr=(()=>((Xr=Xr||{})[Xr.Default=0]="Default",Xr[Xr.Host=1]="Host",Xr[Xr.Self=2]="Self",Xr[Xr.SkipSelf=4]="SkipSelf",Xr[Xr.Optional=8]="Optional",Xr))();let Fs;function ka(e){const t=Fs;return Fs=e,t}function sa(e,t,n){const r=ca(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&Xr.Optional?null:void 0!==t?t:void je(or(e))}const li=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Xi={},vr="__NG_DI_FLAG__",_l="ngTempTokenPath",xs=/\n/gm,nu="__source";let ru;function Sa(e){const t=ru;return ru=e,t}function gu(e,t=Xr.Default){if(void 0===ru)throw new Fn(-203,!1);return null===ru?sa(e,void 0,t):ru.get(e,t&Xr.Optional?null:void 0,t)}function Gn(e,t=Xr.Default){return(function Hc(){return Fs}()||gu)(hn(e),t)}function xr(e,t=Xr.Default){return Gn(e,Fu(t))}function Fu(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Is(e){const t=[];for(let n=0;n<e.length;n++){const r=hn(e[n]);if(Array.isArray(r)){if(0===r.length)throw new Fn(900,!1);let o,c=Xr.Default;for(let d=0;d<r.length;d++){const _=r[d],E=ci(_);"number"==typeof E?-1===E?o=_.token:c|=E:o=_}t.push(Gn(o,c))}else t.push(Gn(r))}return t}function Ta(e,t){return e[vr]=t,e.prototype[vr]=t,e}function ci(e){return e[vr]}function iu(e){return{toString:e}.toString()}var Qo=(()=>((Qo=Qo||{})[Qo.OnPush=0]="OnPush",Qo[Qo.Default=1]="Default",Qo))(),zs=(()=>{return(e=zs||(zs={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",zs;var e})();const mi={},Wr=[],zu=Fi({\u0275cmp:Fi}),qs=Fi({\u0275dir:Fi}),Js=Fi({\u0275pipe:Fi}),Bs=Fi({\u0275mod:Fi}),ou=Fi({\u0275fac:Fi}),ul=Fi({__NG_ELEMENT_ID__:Fi});let Ju=0;function Ts(e){return iu(()=>{const n=!0===e.standalone,r={},o={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Qo.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||Wr,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||zs.Emulated,id:"c"+Ju++,styles:e.styles||Wr,_:null,setInput:null,schemas:e.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},c=e.dependencies,d=e.features;return o.inputs=en(e.inputs,r),o.outputs=en(e.outputs),d&&d.forEach(_=>_(o)),o.directiveDefs=c?()=>("function"==typeof c?c():c).map(Zs).filter(Ma):null,o.pipeDefs=c?()=>("function"==typeof c?c():c).map(xi).filter(Ma):null,o})}function Zs(e){return Nr(e)||mr(e)}function Ma(e){return null!==e}function Qs(e){return iu(()=>({type:e.type,bootstrap:e.bootstrap||Wr,declarations:e.declarations||Wr,imports:e.imports||Wr,exports:e.exports||Wr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function en(e,t){if(null==e)return mi;const n={};for(const r in e)if(e.hasOwnProperty(r)){let o=e[r],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),n[o]=r,t&&(t[o]=c)}return n}const En=Ts;function Nr(e){return e[zu]||null}function mr(e){return e[qs]||null}function xi(e){return e[Js]||null}function Ms(e,t){const n=e[Bs]||null;if(!n&&!0===t)throw new Error(`Type ${or(e)} does not have '\u0275mod' property.`);return n}function ps(e){return Array.isArray(e)&&"object"==typeof e[1]}function ro(e){return Array.isArray(e)&&!0===e[1]}function Xc(e){return 0!=(4&e.flags)}function aa(e){return e.componentOffset>-1}function Xs(e){return 1==(1&e.flags)}function Us(e){return null!==e.template}function xl(e){return 0!=(256&e[2])}function cl(e,t){return e.hasOwnProperty(ou)?e[ou]:null}class Da{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function na(){return jl}function jl(e){return e.type.prototype.ngOnChanges&&(e.setInput=Hh),ud}function ud(){const e=ac(this),t=e?.current;if(t){const n=e.previous;if(n===mi)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function Hh(e,t,n,r){const o=this.declaredInputs[n],c=ac(e)||function Vl(e,t){return e[Tu]=t}(e,{previous:mi,current:null}),d=c.current||(c.current={}),_=c.previous,E=_[o];d[o]=new Da(E&&E.currentValue,t,_===mi),e[r]=t}na.ngInherit=!0;const Tu="__ngSimpleChanges__";function ac(e){return e[Tu]||null}function Vs(e){for(;Array.isArray(e);)e=e[0];return e}function Aa(e,t){return Vs(t[e.index])}function ga(e,t){return e.data[t]}function gs(e,t){const n=t[e];return ps(n)?n:n[0]}function ma(e){return 64==(64&e[2])}function u(e,t){return null==t?null:e[t]}function h(e){e[18]=0}function y(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const x={lFrame:b(null),bindingsEnabled:!0};function st(){return x.bindingsEnabled}function xt(){return x.lFrame.lView}function mn(){return x.lFrame.tView}function ur(e){return x.lFrame.contextLView=e,e[8]}function Cr(e){return x.lFrame.contextLView=null,e}function ti(){let e=bs();for(;null!==e&&64===e.type;)e=e.parent;return e}function bs(){return x.lFrame.currentTNode}function ra(e,t){const n=x.lFrame;n.currentTNode=e,n.isParent=t}function _u(){return x.lFrame.isParent}function yh(){return x.lFrame.bindingIndex++}function qp(e,t){const n=x.lFrame;n.bindingIndex=n.bindingRootIndex=e,cd(t)}function cd(e){x.lFrame.currentDirectiveIndex=e}function Qd(){return x.lFrame.currentQueryIndex}function Xh(e){x.lFrame.currentQueryIndex=e}function Pf(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function v(e,t,n){if(n&Xr.SkipSelf){let o=t,c=e;for(;!(o=o.parent,null!==o||n&Xr.Host||(o=Pf(c),null===o||(c=c[15],10&o.type))););if(null===o)return!1;t=o,e=c}const r=x.lFrame=g();return r.currentTNode=t,r.lView=e,!0}function l(e){const t=g(),n=e[1];x.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function g(){const e=x.lFrame,t=null===e?null:e.child;return null===t?b(e):t}function b(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function I(){const e=x.lFrame;return x.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const A=I;function O(){const e=I();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function H(){return x.lFrame.selectedIndex}function X(e){x.lFrame.selectedIndex=e}function Be(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:E,ngAfterViewChecked:C,ngOnDestroy:D}=c;d&&(e.contentHooks||(e.contentHooks=[])).push(-n,d),_&&((e.contentHooks||(e.contentHooks=[])).push(n,_),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,_)),E&&(e.viewHooks||(e.viewHooks=[])).push(-n,E),C&&((e.viewHooks||(e.viewHooks=[])).push(n,C),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,C)),null!=D&&(e.destroyHooks||(e.destroyHooks=[])).push(n,D)}}function Ae(e,t,n){Ze(e,t,3,n)}function et(e,t,n,r){(3&e[2])===n&&Ze(e,t,n,r)}function rt(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Ze(e,t,n,r){const c=r??-1,d=t.length-1;let _=0;for(let E=void 0!==r?65535&e[18]:0;E<d;E++)if("number"==typeof t[E+1]){if(_=t[E],null!=r&&_>=r)break}else t[E]<0&&(e[18]+=65536),(_<c||-1==c)&&(ut(e,n,t,E),e[18]=(4294901760&e[18])+E+2),E++}function ut(e,t,n,r){const o=n[r]<0,c=n[r+1],_=e[o?-n[r]:n[r]];if(o){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{c.call(_)}finally{}}}else try{c.call(_)}finally{}}class Wt{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function Nn(e,t,n){let r=0;for(;r<n.length;){const o=n[r];if("number"==typeof o){if(0!==o)break;r++;const c=n[r++],d=n[r++],_=n[r++];e.setAttribute(t,d,_,c)}else{const c=o,d=n[++r];Bn(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),r++}}return r}function Vn(e){return 3===e||4===e||6===e}function Bn(e){return 64===e.charCodeAt(0)}function fr(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const o=t[r];"number"==typeof o?n=o:0===n||qr(e,n,o,null,-1===n||2===n?t[++r]:null)}}return e}function qr(e,t,n,r,o){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n){if(null===r)return void(null!==o&&(e[c+1]=o));if(r===e[c+1])return void(e[c+2]=o)}c++,null!==r&&c++,null!==o&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==r&&e.splice(c++,0,r),null!==o&&e.splice(c++,0,o)}function kr(e){return-1!==e}function wr(e){return 32767&e}function Zr(e,t){let n=function Un(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let wi=!0;function $o(e){const t=wi;return wi=e,t}let Uu=0;const Wa={};function Ps(e,t){const n=ya(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,lo(r.data,e),lo(t,null),lo(r.blueprint,null));const o=uu(e,t),c=e.injectorIndex;if(kr(o)){const d=wr(o),_=Zr(o,t),E=_[1].data;for(let C=0;C<8;C++)t[c+C]=_[d+C]|E[d+C]}return t[c+8]=o,c}function lo(e,t){e.push(0,0,0,0,0,0,0,0,t)}function ya(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function uu(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,o=t;for(;null!==o;){if(r=Om(o),null===r)return-1;if(n++,o=o[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function cs(e,t,n){!function As(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(ul)&&(r=n[ul]),null==r&&(r=n[ul]=Uu++);const o=255&r;t.data[e+(o>>5)]|=1<<o}(e,t,n)}function Wc(e,t,n){if(n&Xr.Optional||void 0!==e)return e;je()}function El(e,t,n,r){if(n&Xr.Optional&&void 0===r&&(r=null),0==(n&(Xr.Self|Xr.Host))){const o=e[9],c=ka(void 0);try{return o?o.get(t,r,n&Xr.Optional):sa(t,r,n&Xr.Optional)}finally{ka(c)}}return Wc(r,0,n)}function Du(e,t,n,r=Xr.Default,o){if(null!==e){if(1024&t[2]){const d=function Rm(e,t,n,r,o){let c=e,d=t;for(;null!==c&&null!==d&&1024&d[2]&&!(256&d[2]);){const _=_h(c,d,n,r|Xr.Self,Wa);if(_!==Wa)return _;let E=c.parent;if(!E){const C=d[21];if(C){const D=C.get(n,Wa,r);if(D!==Wa)return D}E=Om(d),d=d[15]}c=E}return o}(e,t,n,r,Wa);if(d!==Wa)return d}const c=_h(e,t,n,r,Wa);if(c!==Wa)return c}return El(t,n,r,o)}function _h(e,t,n,r,o){const c=function Kc(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(ul)?e[ul]:void 0;return"number"==typeof t?t>=0?255&t:yv:t}(n);if("function"==typeof c){if(!v(t,e,r))return r&Xr.Host?Wc(o,0,r):El(t,n,r,o);try{const d=c(r);if(null!=d||r&Xr.Optional)return d;je()}finally{A()}}else if("number"==typeof c){let d=null,_=ya(e,t),E=-1,C=r&Xr.Host?t[16][6]:null;for((-1===_||r&Xr.SkipSelf)&&(E=-1===_?uu(e,t):t[_+8],-1!==E&&hd(r,!1)?(d=t[1],_=wr(E),t=Zr(E,t)):_=-1);-1!==_;){const D=t[1];if(Cl(c,_,D.data)){const L=Yc(_,t,n,d,r,C);if(L!==Wa)return L}E=t[_+8],-1!==E&&hd(r,t[1].data[_+8]===C)&&Cl(c,_,t)?(d=D,_=wr(E),t=Zr(E,t)):_=-1}}return o}function Yc(e,t,n,r,o,c){const d=t[1],_=d.data[e+8],D=Va(_,d,n,null==r?aa(_)&&wi:r!=d&&0!=(3&_.type),o&Xr.Host&&c===_);return null!==D?Au(t,d,D,_):Wa}function Va(e,t,n,r,o){const c=e.providerIndexes,d=t.data,_=1048575&c,E=e.directiveStart,D=c>>20,N=o?_+D:e.directiveEnd;for(let B=r?_:_+D;B<N;B++){const te=d[B];if(B<E&&n===te||B>=E&&te.type===n)return B}if(o){const B=d[E];if(B&&Us(B)&&B.type===n)return E}return null}function Au(e,t,n,r){let o=e[n];const c=t.data;if(function Vt(e){return e instanceof Wt}(o)){const d=o;d.resolving&&function he(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new Fn(-200,`Circular dependency in DI detected for ${e}${n}`)}(function q(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():k(e)}(c[n]));const _=$o(d.canSeeViewProviders);d.resolving=!0;const E=d.injectImpl?ka(d.injectImpl):null;v(e,r,Xr.Default);try{o=e[n]=d.factory(void 0,c,e,r),t.firstCreatePass&&n>=r.directiveStart&&function Se(e,t,n){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:c}=t.type.prototype;if(r){const d=jl(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d)}o&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,o),c&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,c),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,c))}(n,c[n],t)}finally{null!==E&&ka(E),$o(_),d.resolving=!1,A()}}return o}function Cl(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function hd(e,t){return!(e&Xr.Self||e&Xr.Host&&t)}class vh{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return Du(this._tNode,this._lView,t,Fu(r),n)}}function yv(){return new vh(ti(),xt())}function Xp(e){return Wu(e)?()=>{const t=Xp(hn(e));return t&&t()}:cl(e)}function Om(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}const Rf="__parameters__";function Nf(e,t,n){return iu(()=>{const r=function Zp(e){return function(...n){if(e){const r=e(...n);for(const o in r)this[o]=r[o]}}}(t);function o(...c){if(this instanceof o)return r.apply(this,c),this;const d=new o(...c);return _.annotation=d,_;function _(E,C,D){const L=E.hasOwnProperty(Rf)?E[Rf]:Object.defineProperty(E,Rf,{value:[]})[Rf];for(;L.length<=D;)L.push(null);return(L[D]=L[D]||[]).push(d),E}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}class Ti{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=bn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Zh(e,t){e.forEach(n=>Array.isArray(n)?Zh(n,t):t(n))}function vv(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Yp(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const jr=Ta(Nf("Optional"),8),Yh=Ta(Nf("SkipSelf"),4);var Sl=(()=>((Sl=Sl||{})[Sl.Important=1]="Important",Sl[Sl.DashCase=2]="DashCase",Sl))();const dc=new Map;let Zm=0;const ap="__ngContext__";function ju(e,t){ps(t)?(e[ap]=t[20],function sp(e){dc.set(e[20],e)}(t)):e[ap]=t}function va(e,t){return undefined(e,t)}function Eh(e){const t=e[3];return ro(t)?t[3]:t}function Jm(e){return Qm(e[13])}function ig(e){return Qm(e[4])}function Qm(e){for(;null!==e&&!ro(e);)e=e[4];return e}function gc(e,t,n,r,o){if(null!=r){let c,d=!1;ro(r)?c=r:ps(r)&&(d=!0,r=r[0]);const _=Vs(r);0===e&&null!==n?null==o?pl(t,n,_):dl(t,n,_,o||null,!0):1===e&&null!==n?dl(t,n,_,o||null,!0):2===e?function ly(e,t,n){const r=lg(e,t);r&&function sy(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function Ed(e,t,n,r,o){const c=n[7];c!==Vs(n)&&gc(t,e,r,c,o);for(let _=10;_<n.length;_++){const E=n[_];hp(E[1],E,e,t,r,c)}}(t,e,c,n,o)}}function sg(e,t,n){return e.createElement(t,n)}function Rv(e,t){const n=e[9],r=n.indexOf(t),o=t[3];512&t[2]&&(t[2]&=-513,y(o,-1)),n.splice(r,1)}function ag(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const o=r[17];null!==o&&o!==e&&Rv(o,r),t>0&&(e[n-1][4]=r[4]);const c=Yp(e,10+t);!function Qx(e,t){hp(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const d=c[19];null!==d&&d.detachView(c[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function Ov(e,t){if(!(128&t[2])){const n=t[11];n.destroyNode&&hp(e,t,n,3,null,null),function ry(e){let t=e[13];if(!t)return iy(e[1],e);for(;t;){let n=null;if(ps(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)ps(t)&&iy(t[1],t),t=t[3];null===t&&(t=e),ps(t)&&iy(t[1],t),n=t&&t[4]}t=n}}(t)}}function iy(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function kv(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const o=t[n[r]];if(!(o instanceof Wt)){const c=n[r+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=o[c[d]],E=c[d+1];try{E.call(_)}finally{}}else try{c.call(o)}finally{}}}}(e,t),function Nv(e,t){const n=e.cleanup,r=t[7];let o=-1;if(null!==n)for(let c=0;c<n.length-1;c+=2)if("string"==typeof n[c]){const d=n[c+3];d>=0?r[o=d]():r[o=-d].unsubscribe(),c+=2}else{const d=r[o=n[c+1]];n[c].call(d)}if(null!==r){for(let c=o+1;c<r.length;c++)(0,r[c])();t[7]=null}}(e,t),1===t[1].type&&t[11].destroy();const n=t[17];if(null!==n&&ro(t[3])){n!==t[3]&&Rv(n,t);const r=t[19];null!==r&&r.detachView(e)}!function Wm(e){dc.delete(e[20])}(t)}}function oy(e,t,n){return function ug(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:c}=e.data[r.directiveStart+o];if(c===zs.None||c===zs.Emulated)return null}return Aa(r,n)}}(e,t.parent,n)}function dl(e,t,n,r,o){e.insertBefore(t,n,r,o)}function pl(e,t,n){e.appendChild(t,n)}function Fv(e,t,n,r,o){null!==r?dl(e,t,n,r,o):pl(e,t,n)}function lg(e,t){return e.parentNode(t)}let dp,ay=function cp(e,t,n){return 40&e.type?Aa(e,n):null};function cg(e,t,n,r){const o=oy(e,r,t),c=t[11],_=function wd(e,t,n){return ay(e,t,n)}(r.parent||t[6],r,t);if(null!=o)if(Array.isArray(n))for(let E=0;E<n.length;E++)Fv(c,o,n[E],_,!1);else Fv(c,o,n,_,!1)}function hg(e,t){if(null!==t){const n=t.type;if(3&n)return Aa(t,e);if(4&n)return uy(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return hg(e,r);{const o=e[t.index];return ro(o)?uy(-1,o):Vs(o)}}if(32&n)return va(t,e)()||Vs(e[t.index]);{const r=zv(e,t);return null!==r?Array.isArray(r)?r[0]:hg(Eh(e[16]),r):hg(e,t.next)}}return null}function zv(e,t){return null!==t?e[16][6].projection[t.projection]:null}function uy(e,t){const n=10+e+1;if(n<t.length){const r=t[n],o=r[1].firstChild;if(null!==o)return hg(r,o)}return t[7]}function cy(e,t,n,r,o,c,d){for(;null!=n;){const _=r[n.index],E=n.type;if(d&&0===t&&(_&&ju(Vs(_),r),n.flags|=2),32!=(32&n.flags))if(8&E)cy(e,t,n.child,r,o,c,!1),gc(t,e,o,_,c);else if(32&E){const C=va(n,r);let D;for(;D=C();)gc(t,e,o,D,c);gc(t,e,o,_,c)}else 16&E?Bv(e,t,r,n,o,c):gc(t,e,o,_,c);n=d?n.projectionNext:n.next}}function hp(e,t,n,r,o,c){cy(n,r,e.firstChild,t,o,c,!1)}function Bv(e,t,n,r,o,c){const d=n[16],E=d[6].projection[r.projection];if(Array.isArray(E))for(let C=0;C<E.length;C++)gc(t,e,o,E[C],c);else cy(e,t,E,d[3],o,c,!0)}function fp(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function fy(e,t,n){const{mergedAttrs:r,classes:o,styles:c}=n;null!==r&&Nn(e,t,r),null!==o&&fp(e,t,o),null!==c&&function Ra(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}const bg=new Ti("ENVIRONMENT_INITIALIZER"),vy=new Ti("INJECTOR",-1),xy=new Ti("INJECTOR_DEF_TYPES");class wy{get(t,n=Xi){if(n===Xi){const r=new Error(`NullInjectorError: No provider for ${or(t)}!`);throw r.name="NullInjectorError",r}return n}}function gw(...e){return{\u0275providers:r0(0,e),\u0275fromNgModule:!0}}function r0(e,...t){const n=[],r=new Set;let o;return Zh(t,c=>{const d=c;by(d,n,[],r)&&(o||(o=[]),o.push(d))}),void 0!==o&&o0(o,n),n}function o0(e,t){for(let n=0;n<e.length;n++){const{providers:o}=e[n];Ey(o,c=>{t.push(c)})}}function by(e,t,n,r){if(!(e=hn(e)))return!1;let o=null,c=al(e);const d=!c&&Nr(e);if(c||d){if(d&&!d.standalone)return!1;o=e}else{const E=e.ngModule;if(c=al(E),!c)return!1;o=E}const _=r.has(o);if(d){if(_)return!1;if(r.add(o),d.dependencies){const E="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const C of E)by(C,t,n,r)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let C;r.add(o);try{Zh(c.imports,D=>{by(D,t,n,r)&&(C||(C=[]),C.push(D))})}finally{}void 0!==C&&o0(C,t)}if(!_){const C=cl(o)||(()=>new o);t.push({provide:o,useFactory:C,deps:Wr},{provide:xy,useValue:o,multi:!0},{provide:bg,useValue:()=>Gn(o),multi:!0})}const E=c.providers;null==E||_||Ey(E,D=>{t.push(D)})}}return o!==e&&void 0!==e.providers}function Ey(e,t){for(let n of e)oa(n)&&(n=n.\u0275providers),Array.isArray(n)?Ey(n,t):t(n)}const Pu=Fi({provide:String,useValue:Fi});function mc(e){return null!==e&&"object"==typeof e&&Pu in e}function yc(e){return"function"==typeof e}const Cy=new Ti("Set Injector scope."),rf={},_w={};let Sy;function sf(){return void 0===Sy&&(Sy=new wy),Sy}class th{}class Iy extends th{constructor(t,n,r,o){super(),this.parent=n,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Dy(t,d=>this.processProvider(d)),this.records.set(vy,Tl(void 0,this)),o.has("environment")&&this.records.set(th,Tl(void 0,this));const c=this.records.get(Cy);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(xy.multi,Wr,Xr.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=Sa(this),r=ka(void 0);try{return t()}finally{Sa(n),ka(r)}}get(t,n=Xi,r=Xr.Default){this.assertNotDestroyed(),r=Fu(r);const o=Sa(this),c=ka(void 0);try{if(!(r&Xr.SkipSelf)){let _=this.records.get(t);if(void 0===_){const E=function vw(e){return"function"==typeof e||"object"==typeof e&&e instanceof Ti}(t)&&ca(t);_=E&&this.injectableDefInScope(E)?Tl(hs(t),rf):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(r&Xr.Self?sf():this.parent).get(t,n=r&Xr.Optional&&n===Xi?null:n)}catch(d){if("NullInjectorError"===d.name){if((d[_l]=d[_l]||[]).unshift(or(t)),o)throw d;return function Ii(e,t,n,r){const o=e[_l];throw t[nu]&&o.unshift(t[nu]),e.message=function Ji(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=or(t);if(Array.isArray(t))o=t.map(or).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):or(_)))}o=`{${c.join(", ")}}`}return`${n}${r?"("+r+")":""}[${o}]: ${e.replace(xs,"\n  ")}`}("\n"+e.message,o,n,r),e.ngTokenPath=o,e[_l]=null,e}(d,t,"R3InjectorError",this.source)}throw d}finally{ka(c),Sa(o)}}resolveInjectorInitializers(){const t=Sa(this),n=ka(void 0);try{const r=this.get(bg.multi,Wr,Xr.Self);for(const o of r)o()}finally{Sa(t),ka(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(or(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Fn(205,!1)}processProvider(t){let n=yc(t=hn(t))?t:hn(t&&t.provide);const r=function s0(e){return mc(e)?Tl(void 0,e.useValue):Tl(function My(e,t,n){let r;if(yc(e)){const o=hn(e);return cl(o)||hs(o)}if(mc(e))r=()=>hn(e.useValue);else if(function _p(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Is(e.deps||[]));else if(function Eg(e){return!(!e||!e.useExisting)}(e))r=()=>Gn(hn(e.useExisting));else{const o=hn(e&&(e.useClass||e.provide));if(!function Md(e){return!!e.deps}(e))return cl(o)||hs(o);r=()=>new o(...Is(e.deps))}return r}(e),rf)}(t);if(yc(t)||!0!==t.multi)this.records.get(n);else{let o=this.records.get(n);o||(o=Tl(void 0,rf,!0),o.factory=()=>Is(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===rf&&(n.value=_w,n.value=n.factory()),"object"==typeof n.value&&n.value&&function a0(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=hn(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function hs(e){const t=ca(e),n=null!==t?t.factory:cl(e);if(null!==n)return n;if(e instanceof Ti)throw new Fn(204,!1);if(e instanceof Function)return function Ty(e){const t=e.length;if(t>0)throw function rp(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new Fn(204,!1);const n=function yl(e){const t=e&&(e[us]||e[jo]);if(t){const n=function vs(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new Fn(204,!1)}function Tl(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Dy(e,t){for(const n of e)Array.isArray(n)?Dy(n,t):n&&oa(n)?Dy(n.\u0275providers,t):t(n)}class xw{}class u0{}class bw{resolveComponentFactory(t){throw function ww(e){const t=Error(`No component factory found for ${or(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let vp=(()=>{class e{}return e.NULL=new bw,e})();function Cg(){return Rc(ti(),xt())}function Rc(e,t){return new Sh(Aa(e,t))}let Sh=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=Cg,e})();function Ew(e){return e instanceof Sh?e.nativeElement:e}class c0{}let Py=(()=>{class e{}return e.\u0275prov=bn({token:e,providedIn:"root",factory:()=>null}),e})();class xp{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Yl=new xp("15.0.4"),Vf={};function Dd(e){return e.ngOriginalError}class Ad{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Dd(t);for(;n&&Dd(n);)n=Dd(n);return n||null}}function Ry(e){return e.ownerDocument.defaultView}function nh(e){return e instanceof Function?e():e}function m0(e,t,n){let r=e.length;for(;;){const o=e.indexOf(t,n);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const c=t.length;if(o+c===r||e.charCodeAt(o+c)<=32)return o}n=o+1}}const ky="ng-template";function y0(e,t,n){let r=0;for(;r<e.length;){let o=e[r++];if(n&&"class"===o){if(o=e[r],-1!==m0(o.toLowerCase(),t,0))return!0}else if(1===o){for(;r<e.length&&"string"==typeof(o=e[r++]);)if(o.toLowerCase()===t)return!0;return!1}}return!1}function Ld(e){return 4===e.type&&e.value!==ky}function _0(e,t,n){return t===(4!==e.type||n?e.value:ky)}function v0(e,t,n){let r=4;const o=e.attrs||[],c=function x0(e){for(let t=0;t<e.length;t++)if(Vn(e[t]))return t;return e.length}(o);let d=!1;for(let _=0;_<t.length;_++){const E=t[_];if("number"!=typeof E){if(!d)if(4&r){if(r=2|1&r,""!==E&&!_0(e,E,n)||""===E&&1===t.length){if(Kl(r))return!1;d=!0}}else{const C=8&r?E:t[++_];if(8&r&&null!==e.attrs){if(!y0(e.attrs,C,n)){if(Kl(r))return!1;d=!0}continue}const L=Rd(8&r?"class":E,o,Ld(e),n);if(-1===L){if(Kl(r))return!1;d=!0;continue}if(""!==C){let N;N=L>c?"":o[L+1].toLowerCase();const B=8&r?N:null;if(B&&-1!==m0(B,C,0)||2&r&&C!==N){if(Kl(r))return!1;d=!0}}}}else{if(!d&&!Kl(r)&&!Kl(E))return!1;if(d&&Kl(E))continue;d=!1,r=E|1&r}}return Kl(r)||d}function Kl(e){return 0==(1&e)}function Rd(e,t,n,r){if(null===t)return-1;let o=0;if(r||!n){let c=!1;for(;o<t.length;){const d=t[o];if(d===e)return o;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++o];for(;"string"==typeof _;)_=t[++o];continue}if(4===d)break;if(0===d){o+=4;continue}}o+=c?1:2}return-1}return function Tg(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function Fy(e,t,n=!1){for(let r=0;r<t.length;r++)if(v0(e,t[r],n))return!0;return!1}function w0(e,t){return e?":not("+t.trim()+")":t}function Tw(e){let t=e[0],n=1,r=2,o="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&r){const _=e[++n];o+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&r?o+="."+d:4&r&&(o+=" "+d);else""!==o&&!Kl(d)&&(t+=w0(c,o),o=""),r=d,c=c||!Kl(r);n++}return""!==o&&(t+=w0(c,o)),t}const Bi={};function Oc(e){Dg(mn(),xt(),H()+e,!1)}function Dg(e,t,n,r){if(!r)if(3==(3&t[2])){const c=e.preOrderCheckHooks;null!==c&&Ae(t,c,n)}else{const c=e.preOrderHooks;null!==c&&et(t,c,0,n)}X(n)}function Pg(e,t=null,n=null,r){const o=I0(e,t,n,r);return o.resolveInjectorInitializers(),o}function I0(e,t=null,n=null,r,o=new Set){const c=[n||Wr,gw(e)];return r=r||("object"==typeof e?void 0:or(e)),new Iy(c,t||sf(),r||null,o)}let rh=(()=>{class e{static create(n,r){if(Array.isArray(n))return Pg({name:""},r,n,"");{const o=n.name??"";return Pg({name:o},n.parent,n.providers,o)}}}return e.THROW_IF_NOT_FOUND=Xi,e.NULL=new wy,e.\u0275prov=bn({token:e,providedIn:"any",factory:()=>Gn(vy)}),e.__NG_ELEMENT_ID__=-1,e})();function bi(e,t=Xr.Default){const n=xt();return null===n?Gn(e,t):Du(ti(),n,hn(e),t)}function lf(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const o=n[r],c=n[r+1];if(-1!==c){const d=e.data[c];Xh(o),d.contentQueries(2,t[c],c)}}}function Ng(e,t,n,r,o,c,d,_,E,C,D){const L=t.blueprint.slice();return L[0]=o,L[2]=76|r,(null!==D||e&&1024&e[2])&&(L[2]|=1024),h(L),L[3]=L[15]=e,L[8]=n,L[10]=d||e&&e[10],L[11]=_||e&&e[11],L[12]=E||e&&e[12]||null,L[9]=C||e&&e[9]||null,L[6]=c,L[20]=function _d(){return Zm++}(),L[21]=D,L[16]=2==t.type?e[16]:L,L}function oh(e,t,n,r,o){let c=e.data[t];if(null===c)c=function $f(e,t,n,r,o){const c=bs(),d=_u(),E=e.data[t]=function Fw(e,t,n,r,o,c){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,r,o);return null===e.firstChild&&(e.firstChild=E),null!==c&&(d?null==c.child&&null!==E.parent&&(c.child=E):null===c.next&&(c.next=E)),E}(e,t,n,r,o),function Jd(){return x.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=r,c.attrs=o;const d=function Ws(){const e=x.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return ra(c,!0),c}function Dh(e,t,n,r){if(0===n)return-1;const o=t.length;for(let c=0;c<n;c++)t.push(r),e.blueprint.push(r),e.data.push(null);return o}function qf(e,t,n){l(t);try{const r=e.viewQuery;null!==r&&Tp(1,r,n);const o=e.template;null!==o&&O0(e,t,o,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&lf(e,t),e.staticViewQueries&&Tp(2,e.viewQuery,n);const c=e.components;null!==c&&function cf(e,t){for(let n=0;n<t.length;n++)uh(e,t[n])}(t,c)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,O()}}function Hf(e,t,n,r){const o=t[2];if(128!=(128&o)){l(t);try{h(t),function ld(e){return x.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&O0(e,t,n,2,r);const d=3==(3&o);if(d){const C=e.preOrderCheckHooks;null!==C&&Ae(t,C,null)}else{const C=e.preOrderHooks;null!==C&&et(t,C,0,null),rt(t,0)}if(function vc(e){for(let t=Jm(e);null!==t;t=ig(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const o=n[r],c=o[3];0==(512&o[2])&&y(c,1),o[2]|=512}}}(t),function V0(e){for(let t=Jm(e);null!==t;t=ig(t))for(let n=10;n<t.length;n++){const r=t[n],o=r[1];ma(r)&&Hf(o,r,o.template,r[8])}}(t),null!==e.contentQueries&&lf(e,t),d){const C=e.contentCheckHooks;null!==C&&Ae(t,C)}else{const C=e.contentHooks;null!==C&&et(t,C,1),rt(t,1)}!function R0(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const o=n[r];if(o<0)X(~o);else{const c=o,d=n[++r],_=n[++r];qp(d,c),_(2,t[c])}}}finally{X(-1)}}(e,t);const _=e.components;null!==_&&function Nw(e,t){for(let n=0;n<t.length;n++)sh(e,t[n])}(t,_);const E=e.viewQuery;if(null!==E&&Tp(2,E,r),d){const C=e.viewCheckHooks;null!==C&&Ae(t,C)}else{const C=e.viewHooks;null!==C&&et(t,C,2),rt(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,y(t[3],-1))}finally{O()}}}function O0(e,t,n,r,o){const c=H(),d=2&r;try{X(-1),d&&t.length>22&&Dg(e,t,22,!1),n(r,o)}finally{X(c)}}function Gy(e,t,n){if(Xc(t)){const o=t.directiveEnd;for(let c=t.directiveStart;c<o;c++){const d=e.data[c];d.contentQueries&&d.contentQueries(1,n[c],c)}}}function hf(e,t,n){!st()||(function Bw(e,t,n,r){const o=n.directiveStart,c=n.directiveEnd;aa(n)&&function Gw(e,t,n){const r=Aa(t,e),o=N0(n),c=e[10],d=Xf(e,Ng(e,o,null,n.onPush?32:16,r,t,c,c.createRenderer(r,n),null,null,null));e[t.index]=d}(t,n,e.data[o+n.componentOffset]),e.firstCreatePass||Ps(n,t),ju(r,t);const d=n.initialInputs;for(let _=o;_<c;_++){const E=e.data[_],C=Au(t,e,_,n);ju(C,t),null!==d&&$w(0,_-o,C,E,0,d),Us(E)&&(gs(n.index,t)[8]=Au(t,e,_,n))}}(e,t,n,Aa(n,t)),64==(64&n.flags)&&Bg(e,t,n))}function zd(e,t,n=Aa){const r=t.localNames;if(null!==r){let o=t.index+1;for(let c=0;c<r.length;c+=2){const d=r[c+1],_=-1===d?n(t,e):e[d];e[o++]=_}}}function N0(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=kg(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function kg(e,t,n,r,o,c,d,_,E,C){const D=22+r,L=D+o,N=function k0(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:Bi);return n}(D,L),B="function"==typeof C?C():C;return N[1]={type:e,blueprint:N,template:n,queries:null,viewQuery:_,declTNode:t,data:N.slice().fill(null,D),bindingStartIndex:D,expandoStartIndex:L,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:E,consts:B,incompleteFirstPass:!1}}function $y(e,t,n,r){const o=Jy(t);null===n?o.push(r):(o.push(n),e.firstCreatePass&&Qy(e).push(r,o.length-1))}function qy(e,t,n,r){for(let o in e)if(e.hasOwnProperty(o)){n=null===n?{}:n;const c=e[o];null===r?F0(n,t,o,c):r.hasOwnProperty(o)&&F0(n,t,r[o],c)}return n}function F0(e,t,n,r){e.hasOwnProperty(n)?e[n].push(t,r):e[n]=[t,r]}function Sp(e,t){const n=gs(t,e);16&n[2]||(n[2]|=32)}function Xy(e,t,n,r){let o=!1;if(st()){const c=null===r?null:{"":-1},d=function Ug(e,t){const n=e.directiveRegistry;let r=null,o=null;if(n)for(let c=0;c<n.length;c++){const d=n[c];if(Fy(t,d.selectors,!1))if(r||(r=[]),Us(d))if(null!==d.findHostDirectiveDefs){const _=[];o=o||new Map,d.findHostDirectiveDefs(d,_,o),r.unshift(..._,d),Wy(e,t,_.length)}else r.unshift(d),Wy(e,t,0);else o=o||new Map,d.findHostDirectiveDefs?.(d,r,o),r.push(d)}return null===r?null:[r,o]}(e,n);let _,E;null===d?_=E=null:[_,E]=d,null!==_&&(o=!0,zg(e,t,n,_,c,E)),c&&function Uw(e,t,n){if(t){const r=e.localNames=[];for(let o=0;o<t.length;o+=2){const c=n[t[o+1]];if(null==c)throw new Fn(-301,!1);r.push(t[o],c)}}}(n,r,c)}return n.mergedAttrs=fr(n.mergedAttrs,n.attrs),o}function zg(e,t,n,r,o,c){for(let C=0;C<r.length;C++)cs(Ps(n,t),e,r[C].type);!function Vw(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let C=0;C<r.length;C++){const D=r[C];D.providersResolver&&D.providersResolver(D)}let d=!1,_=!1,E=Dh(e,t,r.length,null);for(let C=0;C<r.length;C++){const D=r[C];n.mergedAttrs=fr(n.mergedAttrs,D.hostAttrs),Yy(e,n,t,E,D),jw(E,D,o),null!==D.contentQueries&&(n.flags|=4),(null!==D.hostBindings||null!==D.hostAttrs||0!==D.hostVars)&&(n.flags|=64);const L=D.type.prototype;!d&&(L.ngOnChanges||L.ngOnInit||L.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),d=!0),!_&&(L.ngOnChanges||L.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),_=!0),E++}!function z0(e,t,n){const o=t.directiveEnd,c=e.data,d=t.attrs,_=[];let E=null,C=null;for(let D=t.directiveStart;D<o;D++){const L=c[D],N=n?n.get(L):null,te=N?N.outputs:null;E=qy(L.inputs,D,E,N?N.inputs:null),C=qy(L.outputs,D,C,te);const ne=null===E||null===d||Ld(t)?null:U0(E,D,d);_.push(ne)}null!==E&&(E.hasOwnProperty("class")&&(t.flags|=8),E.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=_,t.inputs=E,t.outputs=C}(e,n,c)}function Bg(e,t,n){const r=n.directiveStart,o=n.directiveEnd,c=n.index,d=function Hp(){return x.lFrame.currentDirectiveIndex}();try{X(c);for(let _=r;_<o;_++){const E=e.data[_],C=t[_];cd(_),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&B0(E,C)}}finally{X(-1),cd(d)}}function B0(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Wy(e,t,n){t.componentOffset=n,(e.components||(e.components=[])).push(t.index)}function jw(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;Us(t)&&(n[""]=e)}}function Yy(e,t,n,r,o){e.data[r]=o;const c=o.factory||(o.factory=cl(o.type)),d=new Wt(c,Us(o),bi);e.blueprint[r]=d,n[r]=d,function Zy(e,t,n,r,o){const c=o.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function ff(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,r,c)}}(e,t,r,Dh(e,n,o.hostVars,Bi),o)}function $w(e,t,n,r,o,c){const d=c[t];if(null!==d){const _=r.setInput;for(let E=0;E<d.length;){const C=d[E++],D=d[E++],L=d[E++];null!==_?r.setInput(n,L,C,D):n[D]=L}}}function U0(e,t,n){let r=null,o=0;for(;o<n.length;){const c=n[o];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===r&&(r=[]);const d=e[c];for(let _=0;_<d.length;_+=2)if(d[_]===t){r.push(c,d[_+1],n[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function j0(e,t,n,r){return[e,!0,!1,t,null,0,r,n,null,null]}function sh(e,t){const n=gs(t,e);if(ma(n)){const r=n[1];48&n[2]?Hf(r,n,r.template,n[8]):n[5]>0&&ah(n)}}function ah(e){for(let r=Jm(e);null!==r;r=ig(r))for(let o=10;o<r.length;o++){const c=r[o];if(ma(c))if(512&c[2]){const d=c[1];Hf(d,c,d.template,c[8])}else c[5]>0&&ah(c)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const o=gs(n[r],e);ma(o)&&o[5]>0&&ah(o)}}function uh(e,t){const n=gs(t,e),r=n[1];(function df(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),qf(r,n,n[8])}function Xf(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function jg(e){for(;e;){e[2]|=32;const t=Eh(e);if(xl(e)&&!t)return e;e=t}return null}function Ip(e,t,n,r=!0){const o=t[10];o.begin&&o.begin();try{Hf(e,t,e.template,n)}catch(d){throw r&&t_(t,d),d}finally{o.end&&o.end()}}function Tp(e,t,n){Xh(0),t(e,n)}function Jy(e){return e[7]||(e[7]=[])}function Qy(e){return e.cleanup||(e.cleanup=[])}function t_(e,t){const n=e[9],r=n?n.get(Ad,null):null;r&&r.handleError(t)}function Vg(e,t,n,r,o){for(let c=0;c<n.length;){const d=n[c++],_=n[c++],E=t[d],C=e.data[d];null!==C.setInput?C.setInput(E,o,r,_):E[_]=o}}function lh(e,t,n){const r=function Ua(e,t){return Vs(t[e])}(t,e);!function ey(e,t,n){e.setValue(t,n)}(e[11],r,n)}function Mp(e,t,n){let r=n?e.styles:null,o=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?o=Vr(o,_):2==c&&(r=Vr(r,_+": "+t[++d]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=o:e.classesWithoutHost=o}function Fc(e,t,n,r,o=!1){for(;null!==n;){const c=t[n.index];if(null!==c&&r.push(Vs(c)),ro(c))for(let _=10;_<c.length;_++){const E=c[_],C=E[1].firstChild;null!==C&&Fc(E[1],E,C,r)}const d=n.type;if(8&d)Fc(e,t,n.child,r);else if(32&d){const _=va(n,t);let E;for(;E=_();)r.push(E)}else if(16&d){const _=zv(t,n);if(Array.isArray(_))r.push(..._);else{const E=Eh(t[16]);Fc(E[1],E,_,r,!0)}}n=o?n.projectionNext:n.next}return r}class Bd{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return Fc(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(ro(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(ag(t,r),Yp(n,r))}this._attachedToViewContainer=!1}Ov(this._lView[1],this._lView)}onDestroy(t){$y(this._lView[1],this._lView,null,t)}markForCheck(){jg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Ip(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Fn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ny(e,t){hp(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Fn(902,!1);this._appRef=t}}class Gg extends Bd{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Ip(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class G0 extends vp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=Nr(t);return new Dl(n,this.ngModule)}}function Zf(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class r_{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=Fu(r);const o=this.injector.get(t,Vf,r);return o!==Vf||n===Vf?o:this.parentInjector.get(t,n,r)}}class Dl extends u0{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Mw(e){return e.map(Tw).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Zf(this.componentDef.inputs)}get outputs(){return Zf(this.componentDef.outputs)}create(t,n,r,o){let c=(o=o||this.ngModule)instanceof th?o:o?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const d=c?new r_(t,c):t,_=d.get(c0,null);if(null===_)throw new Fn(407,!1);const E=d.get(Py,null),C=_.createRenderer(null,this.componentDef),D=this.componentDef.selectors[0][0]||"div",L=r?function kw(e,t,n){return e.selectRootElement(t,n===zs.ShadowDom)}(C,r,this.componentDef.encapsulation):sg(C,D,function n_(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(D)),N=this.componentDef.onPush?288:272,B=kg(0,null,null,1,0,null,null,null,null,null),te=Ng(null,B,null,N,null,null,_,C,E,d,null);let ne,Pe;l(te);try{const xe=this.componentDef;let ae,ce=null;xe.findHostDirectiveDefs?(ae=[],ce=new Map,xe.findHostDirectiveDefs(xe,ae,ce),ae.push(xe)):ae=[xe];const tt=function zc(e,t){const n=e[1];return e[22]=t,oh(n,22,2,"#host",null)}(te,L),ct=function Wf(e,t,n,r,o,c,d,_){const E=o[1];!function q0(e,t,n,r){for(const o of e)t.mergedAttrs=fr(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(Mp(t,t.mergedAttrs,!0),null!==n&&fy(r,n,t))}(r,e,t,d);const C=c.createRenderer(t,n),D=Ng(o,N0(n),null,n.onPush?32:16,o[e.index],e,c,C,_||null,null,null);return E.firstCreatePass&&Wy(E,e,r.length-1),Xf(o,D),o[e.index]=D}(tt,L,xe,ae,te,_,C);Pe=ga(B,22),L&&function Dp(e,t,n,r){if(r)Nn(e,n,["ng-version",Yl.full]);else{const{attrs:o,classes:c}=function Dw(e){const t=[],n=[];let r=1,o=2;for(;r<e.length;){let c=e[r];if("string"==typeof c)2===o?""!==c&&t.push(c,e[++r]):8===o&&n.push(c);else{if(!Kl(o))break;o=c}r++}return{attrs:t,classes:n}}(t.selectors[0]);o&&Nn(e,n,o),c&&c.length>0&&fp(e,n,c.join(" "))}}(C,xe,L,r),void 0!==n&&function $g(e,t,n){const r=e.projection=[];for(let o=0;o<t.length;o++){const c=n[o];r.push(null!=c?Array.from(c):null)}}(Pe,this.ngContentSelectors,n),ne=function H0(e,t,n,r,o,c){const d=ti(),_=o[1],E=Aa(d,o);zg(_,o,d,n,null,r);for(let D=0;D<n.length;D++)ju(Au(o,_,d.directiveStart+D,d),o);Bg(_,o,d),E&&ju(E,o);const C=Au(o,_,d.directiveStart+d.componentOffset,d);if(e[8]=o[8]=C,null!==c)for(const D of c)D(C,t);return Gy(_,d,e),C}(ct,xe,ae,ce,te,[X0]),qf(B,te,null)}finally{O()}return new i_(this.componentType,ne,Rc(Pe,te),te,Pe)}}class i_ extends xw{constructor(t,n,r,o,c){super(),this.location=r,this._rootLView=o,this._tNode=c,this.instance=n,this.hostView=this.changeDetectorRef=new Gg(o),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[t])){const c=this._rootLView;Vg(c[1],c,o,t,n),Sp(c,this._tNode.index)}}get injector(){return new vh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function X0(){const e=ti();Be(xt()[1],e)}let P=null;function R(){if(!P){const e=li.Symbol;if(e&&e.iterator)P=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(P=r)}}}return P}function V(e){return!!function W(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&R()in e)}function Ke(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function Ni(e){return function Gl(e,t){return e[t]}(function Tf(){return x.lFrame.contextLView}(),22+e)}function co(e,t,n){const r=xt();return Ke(r,yh(),t)&&function Jl(e,t,n,r,o,c,d,_){const E=Aa(t,n);let D,C=t.inputs;!_&&null!=C&&(D=C[r])?(Vg(e,n,D,r,o),aa(t)&&Sp(n,t.index)):3&t.type&&(r=function zw(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),o=null!=d?d(o,t.value||"",r):o,c.setProperty(E,r,o))}(mn(),function K(){const e=x.lFrame;return ga(e.tView,e.selectedIndex)}(),r,e,t,r[11],n,!1),co}function ys(e,t,n,r,o){const d=o?"class":"style";Vg(e,n,t.inputs[d],d,r)}function ni(e,t,n,r){const o=xt(),c=mn(),d=22+e,_=o[11],E=o[d]=sg(_,t,function De(){return x.lFrame.currentNamespace}()),C=c.firstCreatePass?function Es(e,t,n,r,o,c,d){const _=t.consts,C=oh(t,e,2,o,u(_,c));return Xy(t,n,C,u(_,d)),null!==C.attrs&&Mp(C,C.attrs,!1),null!==C.mergedAttrs&&Mp(C,C.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,C),C}(d,c,o,0,t,n,r):c.data[d];return ra(C,!0),fy(_,E,C),32!=(32&C.flags)&&cg(c,o,E,C),0===function $(){return x.lFrame.elementDepthCount}()&&ju(E,o),function ee(){x.lFrame.elementDepthCount++}(),Xs(C)&&(hf(c,o,C),Gy(c,C,o)),null!==r&&zd(o,C),ni}function ri(){let e=ti();_u()?function lc(){x.lFrame.isParent=!1}():(e=e.parent,ra(e,!1));const t=e;!function oe(){x.lFrame.elementDepthCount--}();const n=mn();return n.firstCreatePass&&(Be(n,e),Xc(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function fn(e){return 0!=(8&e.flags)}(t)&&ys(n,t,xt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Ft(e){return 0!=(16&e.flags)}(t)&&ys(n,t,xt(),t.stylesWithoutHost,!1),ri}function Ho(e,t,n,r){return ni(e,t,n,r),ri(),Ho}function Rs(e){return!!e&&"function"==typeof e.then}const ss=function Ga(e){return!!e&&"function"==typeof e.subscribe};function ho(e,t,n,r){const o=xt(),c=mn(),d=ti();return function lu(e,t,n,r,o,c,d){const _=Xs(r),C=e.firstCreatePass&&Qy(e),D=t[8],L=Jy(t);let N=!0;if(3&r.type||d){const ne=Aa(r,t),Pe=d?d(ne):ne,xe=L.length,ae=d?tt=>d(Vs(tt[r.index])):r.index;let ce=null;if(!d&&_&&(ce=function xu(e,t,n,r){const o=e.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const d=o[c];if(d===n&&o[c+1]===r){const _=t[7],E=o[c+2];return _.length>E?_[E]:null}"string"==typeof d&&(c+=2)}return null}(e,t,o,r.index)),null!==ce)(ce.__ngLastListenerFn__||ce).__ngNextListenerFn__=c,ce.__ngLastListenerFn__=c,N=!1;else{c=cu(r,t,D,c,!1);const tt=n.listen(Pe,o,c);L.push(c,tt),C&&C.push(o,ae,xe,xe+1)}}else c=cu(r,t,D,c,!1);const B=r.outputs;let te;if(N&&null!==B&&(te=B[o])){const ne=te.length;if(ne)for(let Pe=0;Pe<ne;Pe+=2){const ct=t[te[Pe]][te[Pe+1]].subscribe(c),Pt=L.length;L.push(c,ct),C&&C.push(o,r.index,Pt,-(Pt+1))}}}(c,o,o[11],d,e,t,r),ho}function Vu(e,t,n,r){try{return!1!==n(r)}catch(o){return t_(e,o),!1}}function cu(e,t,n,r,o){return function c(d){if(d===Function)return r;jg(e.componentOffset>-1?gs(e.index,t):t);let E=Vu(t,0,r,d),C=c.__ngNextListenerFn__;for(;C;)E=Vu(t,0,C,d)&&E,C=C.__ngNextListenerFn__;return o&&!1===E&&(d.preventDefault(),d.returnValue=!1),E}}function $u(e,t=""){const n=xt(),r=mn(),o=e+22,c=r.firstCreatePass?oh(r,o,1,t,null):r.data[o],d=n[o]=function og(e,t){return e.createText(t)}(n[11],t);cg(r,n,d,c),ra(c,!1)}function Ww(e){return e1("",e,""),Ww}function e1(e,t,n){const r=xt(),o=function Ot(e,t,n,r){return Ke(e,yh(),n)?t+k(n)+r:Bi}(r,e,t,n);return o!==Bi&&lh(r,H(),o),e1}const Qg="en-US";let JS=Qg;class em{}class CI{}class SI extends em{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new G0(this);const r=Ms(t);this._bootstrapComponents=nh(r.bootstrap),this._r3Injector=I0(t,n,[{provide:em,useValue:this},{provide:vp,useValue:this.componentFactoryResolver}],or(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class nb extends CI{constructor(t){super(),this.moduleType=t}create(t){return new SI(this.moduleType,t)}}class mR extends em{constructor(t,n,r){super(),this.componentFactoryResolver=new G0(this),this.instance=null;const o=new Iy([...t,{provide:em,useValue:this},{provide:vp,useValue:this.componentFactoryResolver}],n||sf(),r,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function o1(e,t,n=null){return new mR(e,t,n).injector}let yR=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=r0(0,n.type),o=r.length>0?o1([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,o)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=bn({token:e,providedIn:"environment",factory:()=>new e(Gn(th))}),e})();function II(e){e.getStandaloneInjector=t=>t.get(yR).getOrCreateStandaloneInjector(e)}function ib(e){return t=>{setTimeout(e,void 0,t)}}const Pl=class GR extends $t{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let o=t,c=n||(()=>null),d=r;if(t&&"object"==typeof t){const E=t;o=E.next?.bind(E),c=E.error?.bind(E),d=E.complete?.bind(E)}this.__isAsync&&(c=ib(c),o&&(o=ib(o)),d&&(d=ib(d)));const _=super.subscribe({next:o,error:c,complete:d});return t instanceof Ce&&t.add(_),_}};function $R(){return this._results[R()]()}class ob{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=R(),r=ob.prototype;r[n]||(r[n]=$R)}get changes(){return this._changes||(this._changes=new Pl)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const o=function ql(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function Wp(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let o=e[r],c=t[r];if(n&&(o=n(o),c=n(c)),c!==o)return!1}return!0}(r._results,o,n))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Yf=(()=>{class e{}return e.__NG_ELEMENT_ID__=XR,e})();const qR=Yf,HR=class extends qR{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,o=Ng(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);o[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(o[19]=d.createEmbeddedView(r)),qf(r,o,t),new Bd(o)}};function XR(){return s1(ti(),xt())}function s1(e,t){return 4&e.type?new HR(t,e,Rc(e,t)):null}let Oh=(()=>{class e{}return e.__NG_ELEMENT_ID__=ZR,e})();function ZR(){return UI(ti(),xt())}const WR=Oh,zI=class extends WR{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Rc(this._hostTNode,this._hostLView)}get injector(){return new vh(this._hostTNode,this._hostLView)}get parentInjector(){const t=uu(this._hostTNode,this._hostLView);if(kr(t)){const n=Zr(t,this._hostLView),r=wr(t);return new vh(n[1].data[r+8],n)}return new vh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=BI(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,r){let o,c;"number"==typeof r?o=r:null!=r&&(o=r.index,c=r.injector);const d=t.createEmbeddedView(n||{},c);return this.insert(d,o),d}createComponent(t,n,r,o,c){const d=t&&!function $l(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const L=n||{};_=L.index,r=L.injector,o=L.projectableNodes,c=L.environmentInjector||L.ngModuleRef}const E=d?t:new Dl(Nr(t)),C=r||this.parentInjector;if(!c&&null==E.ngModule){const N=(d?C:this.parentInjector).get(th,null);N&&(c=N)}const D=E.create(C,o,void 0,c);return this.insert(D.hostView,_),D}insert(t,n){const r=t._lView,o=r[1];if(function Tc(e){return ro(e[3])}(r)){const D=this.indexOf(t);if(-1!==D)this.detach(D);else{const L=r[3],N=new zI(L,L[6],L[3]);N.detach(N.indexOf(t))}}const c=this._adjustIndex(n),d=this._lContainer;!function nl(e,t,n,r){const o=10+r,c=n.length;r>0&&(n[o-1][4]=t),r<c-10?(t[4]=n[o],vv(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const d=t[17];null!==d&&n!==d&&function Lv(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(d,t);const _=t[19];null!==_&&_.insertView(e),t[2]|=64}(o,r,d,c);const _=uy(c,d),E=r[11],C=lg(E,d[7]);return null!==C&&function ty(e,t,n,r,o,c){r[0]=o,r[6]=t,hp(e,r,n,1,o,c)}(o,d[6],E,r,C,_),t.attachToViewContainerRef(),vv(sb(d),c,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=BI(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=ag(this._lContainer,n);r&&(Yp(sb(this._lContainer),n),Ov(r[1],r))}detach(t){const n=this._adjustIndex(t,-1),r=ag(this._lContainer,n);return r&&null!=Yp(sb(this._lContainer),n)?new Bd(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function BI(e){return e[8]}function sb(e){return e[8]||(e[8]=[])}function UI(e,t){let n;const r=t[e.index];if(ro(r))n=r;else{let o;if(8&e.type)o=Vs(r);else{const c=t[11];o=c.createComment("");const d=Aa(e,t);dl(c,lg(c,d),o,function ew(e,t){return e.nextSibling(t)}(c,d),!1)}t[e.index]=n=j0(r,t,o,e),Xf(t,n)}return new zI(n,e,t)}class ab{constructor(t){this.queryList=t,this.matches=null}clone(){return new ab(this.queryList)}setDirty(){this.queryList.setDirty()}}class ub{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,o=[];for(let c=0;c<r;c++){const d=n.getByIndex(c);o.push(this.queries[d.indexInDeclarationView].clone())}return new ub(o)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==HI(t,n).matches&&this.queries[n].setDirty()}}class jI{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class lb{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const o=null!==n?n.length:0,c=this.getByIndex(r).embeddedTView(t,o);c&&(c.indexInDeclarationView=r,null!==n?n.push(c):n=[c])}return null!==n?new lb(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class cb{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new cb(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const c=r[o];this.matchTNodeWithReadOption(t,n,YR(n,c)),this.matchTNodeWithReadOption(t,n,Va(n,t,c,!1,!1))}else r===Yf?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,Va(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===Sh||o===Oh||o===Yf&&4&n.type)this.addMatch(n.index,-2);else{const c=Va(n,t,o,!1,!1);null!==c&&this.addMatch(n.index,c)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function YR(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function JR(e,t,n,r){return-1===n?function KR(e,t){return 11&e.type?Rc(e,t):4&e.type?s1(e,t):null}(t,e):-2===n?function QR(e,t,n){return n===Sh?Rc(t,e):n===Yf?s1(t,e):n===Oh?UI(t,e):void 0}(e,t,r):Au(e,e[1],n,t)}function VI(e,t,n,r){const o=t[19].queries[r];if(null===o.matches){const c=e.data,d=n.matches,_=[];for(let E=0;E<d.length;E+=2){const C=d[E];_.push(C<0?null:JR(t,c[C],d[E+1],n.metadata.read))}o.matches=_}return o.matches}function hb(e,t,n,r){const o=e.queries.getByIndex(n),c=o.matches;if(null!==c){const d=VI(e,t,o,n);for(let _=0;_<c.length;_+=2){const E=c[_];if(E>0)r.push(d[_/2]);else{const C=c[_+1],D=t[-E];for(let L=10;L<D.length;L++){const N=D[L];N[17]===N[3]&&hb(N[1],N,C,r)}if(null!==D[9]){const L=D[9];for(let N=0;N<L.length;N++){const B=L[N];hb(B[1],B,C,r)}}}}}return r}function tm(e){const t=xt(),n=mn(),r=Qd();Xh(r+1);const o=HI(n,r);if(e.dirty&&function Ds(e){return 4==(4&e[2])}(t)===(2==(2&o.metadata.flags))){if(null===o.matches)e.reset([]);else{const c=o.crossesNgTemplate?hb(n,t,r,[]):VI(n,t,o,r);e.reset(c,Ew),e.notifyOnChanges()}return!0}return!1}function __(e,t,n){const r=mn();r.firstCreatePass&&(function qI(e,t,n){null===e.queries&&(e.queries=new lb),e.queries.track(new cb(t,n))}(r,new jI(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function $I(e,t,n){const r=new ob(4==(4&n));$y(e,t,r,r.destroy),null===t[19]&&(t[19]=new ub),t[19].queries.push(new ab(r))}(r,xt(),t)}function nm(){return function eO(e,t){return e[19].queries[t].queryList}(xt(),Qd())}function HI(e,t){return e.queries.getByIndex(t)}function u1(...e){}const x_=new Ti("Application Initializer");let l1=(()=>{class e{constructor(n){this.appInits=n,this.resolve=u1,this.reject=u1,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const c=this.appInits[o]();if(Rs(c))n.push(c);else if(ss(c)){const d=new Promise((_,E)=>{c.subscribe({complete:_,error:E})});n.push(d)}}Promise.all(n).then(()=>{r()}).catch(o=>{this.reject(o)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Gn(x_,8))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const w_=new Ti("AppId",{providedIn:"root",factory:function hT(){return`${mb()}${mb()}${mb()}`}});function mb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const fT=new Ti("Platform Initializer"),dT=new Ti("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),pT=new Ti("appBootstrapListener");let bO=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Kf=new Ti("LocaleId",{providedIn:"root",factory:()=>xr(Kf,Xr.Optional|Xr.SkipSelf)||function EO(){return typeof $localize<"u"&&$localize.locale||Qg}()});class SO{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let gT=(()=>{class e{compileModuleSync(n){return new nb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),c=nh(Ms(n).declarations).reduce((d,_)=>{const E=Nr(_);return E&&d.push(new Dl(E)),d},[]);return new SO(r,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const MO=(()=>Promise.resolve(0))();function yb(e){typeof Zone>"u"?MO.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class Ru{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Pl(!1),this.onMicrotaskEmpty=new Pl(!1),this.onStable=new Pl(!1),this.onError=new Pl(!1),typeof Zone>"u")throw new Fn(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&n,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function DO(){let e=li.requestAnimationFrame,t=li.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function LO(e){const t=()=>{!function PO(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(li,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,vb(e),e.isCheckStableRunning=!0,_b(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),vb(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,o,c,d,_)=>{try{return _T(e),n.invokeTask(o,c,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),vT(e)}},onInvoke:(n,r,o,c,d,_,E)=>{try{return _T(e),n.invoke(o,c,d,_,E)}finally{e.shouldCoalesceRunChangeDetection&&t(),vT(e)}},onHasTask:(n,r,o,c)=>{n.hasTask(o,c),r===o&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,vb(e),_b(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(n,r,o,c)=>(n.handleError(o,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ru.isInAngularZone())throw new Fn(909,!1)}static assertNotInAngularZone(){if(Ru.isInAngularZone())throw new Fn(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,o){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+o,t,AO,u1,u1);try{return c.runTask(d,n,r)}finally{c.cancelTask(d)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const AO={};function _b(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function vb(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function _T(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function vT(e){e._nesting--,_b(e)}class RO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Pl,this.onMicrotaskEmpty=new Pl,this.onStable=new Pl,this.onError=new Pl}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,o){return t.apply(n,r)}}const xT=new Ti(""),c1=new Ti("");let bb,xb=(()=>{class e{constructor(n,r,o){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,bb||(function OO(e){bb=e}(o),o.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ru.assertNotInAngularZone(),yb(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())yb(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,o){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==c),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:c,updateCb:o})}whenStable(n,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,o){return[]}}return e.\u0275fac=function(n){return new(n||e)(Gn(Ru),Gn(wb),Gn(c1))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})(),wb=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return bb?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),jd=null;const wT=new Ti("AllowMultipleToken"),Eb=new Ti("PlatformDestroyListeners");class bT{constructor(t,n){this.name=t,this.token=n}}function CT(e,t,n=[]){const r=`Platform: ${t}`,o=new Ti(r);return(c=[])=>{let d=Cb();if(!d||d.injector.get(wT,!1)){const _=[...n,...c,{provide:o,useValue:!0}];e?e(_):function FO(e){if(jd&&!jd.get(wT,!1))throw new Fn(400,!1);jd=e;const t=e.get(IT);(function ET(e){const t=e.get(fT,null);t&&t.forEach(n=>n())})(e)}(function ST(e=[],t){return rh.create({name:t,providers:[{provide:Cy,useValue:"platform"},{provide:Eb,useValue:new Set([()=>jd=null])},...e]})}(_,r))}return function BO(e){const t=Cb();if(!t)throw new Fn(401,!1);return t}()}}function Cb(){return jd?.get(IT)??null}let IT=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const o=function MT(e,t){let n;return n="noop"===e?new RO:("zone.js"===e?void 0:e)||new Ru(t),n}(r?.ngZone,function TT(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),c=[{provide:Ru,useValue:o}];return o.run(()=>{const d=rh.create({providers:c,parent:this.injector,name:n.moduleType.name}),_=n.create(d),E=_.injector.get(Ad,null);if(!E)throw new Fn(402,!1);return o.runOutsideAngular(()=>{const C=o.onError.subscribe({next:D=>{E.handleError(D)}});_.onDestroy(()=>{f1(this._modules,_),C.unsubscribe()})}),function DT(e,t,n){try{const r=n();return Rs(r)?r.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(E,o,()=>{const C=_.injector.get(l1);return C.runInitializers(),C.donePromise.then(()=>(function QS(e){ar(e,"Expected localeId to be defined"),"string"==typeof e&&(JS=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(Kf,Qg)||Qg),this._moduleDoBootstrap(_),_))})})}bootstrapModule(n,r=[]){const o=AT({},r);return function NO(e,t,n){const r=new nb(n);return Promise.resolve(r)}(0,0,n).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(n){const r=n.injector.get(h1);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new Fn(403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Fn(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(Eb,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Gn(rh))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function AT(e,t){return Array.isArray(t)?t.reduce(AT,e):{...e,...t}}let h1=(()=>{class e{constructor(n,r,o){this._zone=n,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const c=new Ee(_=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{_.next(this._stable),_.complete()})}),d=new Ee(_=>{let E;this._zone.runOutsideAngular(()=>{E=this._zone.onStable.subscribe(()=>{Ru.assertNotInAngularZone(),yb(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,_.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{Ru.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{_.next(!1)}))});return()=>{E.unsubscribe(),C.unsubscribe()}});this.isStable=function du(...e){const t=Dr(e),n=function ji(e,t){return"number"==typeof ir(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?ns(r[0]):nn(n)(Ki(r,t)):Rn}(c,d.pipe(function Ea(e={}){const{connector:t=(()=>new $t),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=e;return c=>{let d,_,E,C=0,D=!1,L=!1;const N=()=>{_?.unsubscribe(),_=void 0},B=()=>{N(),d=E=void 0,D=L=!1},te=()=>{const ne=d;B(),ne?.unsubscribe()};return Xn((ne,Pe)=>{C++,!L&&!D&&N();const xe=E=E??t();Pe.add(()=>{C--,0===C&&!L&&!D&&(_=Ca(te,o))}),xe.subscribe(Pe),!d&&C>0&&(d=new J({next:ae=>xe.next(ae),error:ae=>{L=!0,N(),_=Ca(B,n,ae),xe.error(ae)},complete:()=>{D=!0,N(),_=Ca(B,r),xe.complete()}}),ns(ne).subscribe(d))})(c)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const o=n instanceof u0;if(!this._injector.get(l1).done)throw!o&&function zi(e){const t=Nr(e)||mr(e)||xi(e);return null!==t&&t.standalone}(n),new Fn(405,false);let d;d=o?n:this._injector.get(vp).resolveComponentFactory(n),this.componentTypes.push(d.componentType);const _=function kO(e){return e.isBoundToModule}(d)?void 0:this._injector.get(em),C=d.create(rh.NULL,[],r||d.selector,_),D=C.location.nativeElement,L=C.injector.get(xT,null);return L?.registerApplication(D),C.onDestroy(()=>{this.detachView(C.hostView),f1(this.components,C),L?.unregisterApplication(D)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new Fn(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;f1(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(pT,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>f1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new Fn(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Gn(Ru),Gn(th),Gn(Ad))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function f1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Sb=(()=>{class e{}return e.__NG_ELEMENT_ID__=jO,e})();function jO(e){return function VO(e,t,n){if(aa(e)&&!n){const r=gs(e.index,t);return new Bd(r,r)}return 47&e.type?new Bd(t[16],t):null}(ti(),xt(),16==(16&e))}class NT{constructor(){}supports(t){return V(t)}create(t){return new ZO(t)}}const XO=(e,t)=>t;class ZO{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||XO}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,o=0,c=null;for(;n||r;){const d=!r||n&&n.currentIndex<FT(r,o,c)?n:r,_=FT(d,o,c),E=d.currentIndex;if(d===r)o--,r=r._nextRemoved;else if(n=n._next,null==d.previousIndex)o++;else{c||(c=[]);const C=_-o,D=E-o;if(C!=D){for(let N=0;N<C;N++){const B=N<c.length?c[N]:c[N]=0,te=B+N;D<=te&&te<C&&(c[N]=B+1)}c[d.previousIndex]=D-C}}_!==E&&t(d,_,E)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!V(t))throw new Fn(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let o,c,d,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let _=0;_<this.length;_++)c=t[_],d=this._trackByFn(_,c),null!==n&&Object.is(n.trackById,d)?(r&&(n=this._verifyReinsertion(n,c,d,_)),Object.is(n.item,c)||this._addIdentityChange(n,c)):(n=this._mismatch(n,c,d,_),r=!0),n=n._next}else o=0,function Z(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[R()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,_=>{d=this._trackByFn(o,_),null!==n&&Object.is(n.trackById,d)?(r&&(n=this._verifyReinsertion(n,_,d,o)),Object.is(n.item,_)||this._addIdentityChange(n,_)):(n=this._mismatch(n,_,d,o),r=!0),n=n._next,o++}),this.length=o;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,o){let c;return null===t?c=this._itTail:(c=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,c,o)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,c,o)):t=this._addAfter(new WO(n,r),c,o),t}_verifyReinsertion(t,n,r,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==c?t=this._reinsertAfter(c,t._prev,o):t.currentIndex!=o&&(t.currentIndex=o,this._addToMoves(t,o)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const o=t._prevRemoved,c=t._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const o=null===n?this._itHead:n._next;return t._next=o,t._prev=n,null===o?this._itTail=t:o._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new kT),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new kT),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class WO{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class YO{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class kT{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new YO,this.map.set(n,r)),r.add(t)}get(t,n){const o=this.map.get(t);return o?o.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function FT(e,t,n){const r=e.previousIndex;if(null===r)return r;let o=0;return n&&r<n.length&&(o=n[r]),r+t+o}function BT(){return new g1([new NT])}let g1=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const o=r.factories.slice();n=n.concat(o)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||BT()),deps:[[e,new Yh,new jr]]}}find(n){const r=this.factories.find(o=>o.supports(n));if(null!=r)return r;throw new Fn(901,!1)}}return e.\u0275prov=bn({token:e,providedIn:"root",factory:BT}),e})();const tN=CT(null,"core",[]);let nN=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Gn(h1))},e.\u0275mod=Qs({type:e}),e.\u0275inj=Jo({}),e})(),Pb=null;function Vd(){return Pb}class oN{}const xc=new Ti("DocumentToken");let Lb=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return function sN(){return Gn(jT)}()},providedIn:"platform"}),e})();const aN=new Ti("Location Initialized");let jT=(()=>{class e extends Lb{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Vd().getBaseHref(this._doc)}onPopState(n){const r=Vd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=Vd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,o){VT()?this._history.pushState(n,r,o):this.location.hash=o}replaceState(n,r,o){VT()?this._history.replaceState(n,r,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Gn(xc))},e.\u0275prov=bn({token:e,factory:function(){return function uN(){return new jT(Gn(xc))}()},providedIn:"platform"}),e})();function VT(){return!!window.history.pushState}function Rb(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function GT(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Qf(e){return e&&"?"!==e[0]?"?"+e:e}let Np=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return xr(qT)},providedIn:"root"}),e})();const $T=new Ti("appBaseHref");let qT=(()=>{class e extends Np{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??xr(xc).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Rb(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Qf(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${r}${o}`:r}pushState(n,r,o,c){const d=this.prepareExternalUrl(o+Qf(c));this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){const d=this.prepareExternalUrl(o+Qf(c));this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Gn(Lb),Gn($T,8))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),lN=(()=>{class e extends Np{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=Rb(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,o,c){let d=this.prepareExternalUrl(o+Qf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){let d=this.prepareExternalUrl(o+Qf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Gn(Lb),Gn($T,8))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})(),Ob=(()=>{class e{constructor(n){this._subject=new Pl,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function fN(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(GT(HT(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Qf(r))}normalize(n){return e.stripTrailingSlash(function hN(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._basePath,HT(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",o=null){this._locationStrategy.pushState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qf(r)),o)}replaceState(n,r="",o=null){this._locationStrategy.replaceState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Qf(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(o=>o(n,r))}subscribe(n,r,o){return this._subject.subscribe({next:n,error:r,complete:o})}}return e.normalizeQueryParams=Qf,e.joinWithSlash=Rb,e.stripTrailingSlash=GT,e.\u0275fac=function(n){return new(n||e)(Gn(Np))},e.\u0275prov=bn({token:e,factory:function(){return function cN(){return new Ob(Gn(Np))}()},providedIn:"root"}),e})();function HT(e){return e.replace(/\/index.html$/,"")}class JN{constructor(t,n,r,o){this.$implicit=t,this.ngForOf=n,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let rM=(()=>{class e{constructor(n,r,o){this._viewContainer=n,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((o,c,d)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new JN(o.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)r.remove(null===c?void 0:c);else if(null!==c){const _=r.get(c);r.move(_,d),iM(_,o)}});for(let o=0,c=r.length;o<c;o++){const _=r.get(o).context;_.index=o,_.count=c,_.ngForOf=this._ngForOf}n.forEachIdentityChange(o=>{iM(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(bi(Oh),bi(Yf),bi(g1))},e.\u0275dir=En({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function iM(e,t){e.context.$implicit=t.item}let Ak=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Qs({type:e}),e.\u0275inj=Jo({}),e})();let Ok=(()=>{class e{}return e.\u0275prov=bn({token:e,providedIn:"root",factory:()=>new Nk(Gn(xc),window)}),e})();class Nk{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function kk(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const c=o.shadowRoot;if(c){const d=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(d)return d}o=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],o-c[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=lM(this.window.history)||lM(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function lM(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class cF extends oN{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Yb extends cF{static makeCurrent(){!function iN(e){Pb||(Pb=e)}(new Yb)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function hF(){return I_=I_||document.querySelector("base"),I_?I_.getAttribute("href"):null}();return null==n?null:function fF(e){I1=I1||document.createElement("a"),I1.setAttribute("href",e);const t=I1.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){I_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function WN(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[o,c]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(o.trim()===t)return decodeURIComponent(c)}return null}(document.cookie,t)}}let I1,I_=null;const gM=new Ti("TRANSITION_ID"),pF=[{provide:x_,useFactory:function dF(e,t,n){return()=>{n.get(l1).donePromise.then(()=>{const r=Vd(),o=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let c=0;c<o.length;c++)r.remove(o[c])})}},deps:[gM,xc,rh],multi:!0}];let mF=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();const T1=new Ti("EventManagerPlugins");let M1=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(o=>o.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,o){return this._findPluginFor(r).addEventListener(n,r,o)}addGlobalEventListener(n,r,o){return this._findPluginFor(r).addGlobalEventListener(n,r,o)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const o=this._plugins;for(let c=0;c<o.length;c++){const d=o[c];if(d.supports(n))return this._eventNameToPlugin.set(n,d),d}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Gn(T1),Gn(Ru))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();class mM{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const o=Vd().getGlobalEventTarget(this._doc,t);if(!o)throw new Error(`Unsupported event target ${o} for event ${n}`);return this.addEventListener(o,n,r)}}let yM=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),r.add(o))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})(),T_=(()=>{class e extends yM{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,o){n.forEach(c=>{const d=this._doc.createElement("style");d.textContent=c,o.push(r.appendChild(d))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(_M),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,o)=>{this._addStylesToHost(n,o,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(_M))}}return e.\u0275fac=function(n){return new(n||e)(Gn(xc))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();function _M(e){Vd().remove(e)}const Kb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Jb=/%COMP%/g;function Qb(e,t){return t.flat(100).map(n=>n.replace(Jb,e))}function wM(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let eE=(()=>{class e{constructor(n,r,o){this.eventManager=n,this.sharedStylesHost=r,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new tE(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case zs.Emulated:{let o=this.rendererByCompId.get(r.id);return o||(o=new bF(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,o)),o.applyToHost(n),o}case 1:case zs.ShadowDom:return new EF(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const o=Qb(r.id,r.styles);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Gn(M1),Gn(T_),Gn(w_))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();class tE{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(Kb[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(EM(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(EM(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,o){if(o){n=o+":"+n;const c=Kb[o];c?t.setAttributeNS(c,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const o=Kb[r];o?t.removeAttributeNS(o,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,o){o&(Sl.DashCase|Sl.Important)?t.style.setProperty(n,r,o&Sl.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&Sl.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,wM(r)):this.eventManager.addEventListener(t,n,wM(r))}}function EM(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class bF extends tE{constructor(t,n,r,o){super(t),this.component=r;const c=Qb(o+"-"+r.id,r.styles);n.addStyles(c),this.contentAttr=function vF(e){return"_ngcontent-%COMP%".replace(Jb,e)}(o+"-"+r.id),this.hostAttr=function xF(e){return"_nghost-%COMP%".replace(Jb,e)}(o+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class EF extends tE{constructor(t,n,r,o){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=Qb(o.id,o.styles);for(let d=0;d<c.length;d++){const _=document.createElement("style");_.textContent=c[d],this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let CF=(()=>{class e extends mM{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,o){return n.addEventListener(r,o,!1),()=>this.removeEventListener(n,r,o)}removeEventListener(n,r,o){return n.removeEventListener(r,o)}}return e.\u0275fac=function(n){return new(n||e)(Gn(xc))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();const CM=["alt","control","meta","shift"],SF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},IF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let TF=(()=>{class e extends mM{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,o){const c=e.parseEventName(r),d=e.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Vd().onAndCancel(n,c.domEventName,d))}static parseEventName(n){const r=n.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const c=e._normalizeKey(r.pop());let d="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),d="code."),CM.forEach(C=>{const D=r.indexOf(C);D>-1&&(r.splice(D,1),d+=C+".")}),d+=c,0!=r.length||0===c.length)return null;const E={};return E.domEventName=o,E.fullKey=d,E}static matchEventFullKeyCode(n,r){let o=SF[n.key]||n.key,c="";return r.indexOf("code.")>-1&&(o=n.code,c="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),CM.forEach(d=>{d!==o&&(0,IF[d])(n)&&(c+=d+".")}),c+=o,c===r)}static eventCallback(n,r,o){return c=>{e.matchEventFullKeyCode(c,n)&&o.runGuarded(()=>r(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Gn(xc))},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();const PF=CT(tN,"browser",[{provide:dT,useValue:"browser"},{provide:fT,useValue:function MF(){Yb.makeCurrent()},multi:!0},{provide:xc,useFactory:function AF(){return function nw(e){dp=e}(document),document},deps:[]}]),TM=new Ti(""),MM=[{provide:c1,useClass:class gF{addToWindow(t){li.getAngularTestability=(r,o=!0)=>{const c=t.findTestabilityInTree(r,o);if(null==c)throw new Error("Could not find testability for element.");return c},li.getAllAngularTestabilities=()=>t.getAllTestabilities(),li.getAllAngularRootElements=()=>t.getAllRootElements(),li.frameworkStabilizers||(li.frameworkStabilizers=[]),li.frameworkStabilizers.push(r=>{const o=li.getAllAngularTestabilities();let c=o.length,d=!1;const _=function(E){d=d||E,c--,0==c&&r(d)};o.forEach(function(E){E.whenStable(_)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?Vd().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:xT,useClass:xb,deps:[Ru,wb,c1]},{provide:xb,useClass:xb,deps:[Ru,wb,c1]}],DM=[{provide:Cy,useValue:"root"},{provide:Ad,useFactory:function DF(){return new Ad},deps:[]},{provide:T1,useClass:CF,multi:!0,deps:[xc,Ru,dT]},{provide:T1,useClass:TF,multi:!0,deps:[xc]},{provide:eE,useClass:eE,deps:[M1,T_,w_]},{provide:c0,useExisting:eE},{provide:yM,useExisting:T_},{provide:T_,useClass:T_,deps:[xc]},{provide:M1,useClass:M1,deps:[T1,Ru]},{provide:class Fk{},useClass:mF,deps:[]},[]];let LF=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:w_,useValue:n.appId},{provide:gM,useExisting:w_},pF]}}}return e.\u0275fac=function(n){return new(n||e)(Gn(TM,12))},e.\u0275mod=Qs({type:e}),e.\u0275inj=Jo({providers:[...DM,...MM],imports:[Ak,nN]}),e})(),AM=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Gn(xc))},e.\u0275prov=bn({token:e,factory:function(n){let r=null;return r=n?new n:function OF(){return new AM(Gn(xc))}(),r},providedIn:"root"}),e})();function Ai(...e){return Ki(e,Dr(e))}typeof window<"u"&&window;class zh extends $t{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const D1=Ue(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:VF}=Array,{getPrototypeOf:GF,prototype:$F,keys:qF}=Object;const{isArray:ZF}=Array;function RM(...e){const t=Dr(e),n=function Mr(e){return Te(ir(e))?e.pop():void 0}(e),{args:r,keys:o}=function HF(e){if(1===e.length){const t=e[0];if(VF(t))return{args:t,keys:null};if(function XF(e){return e&&"object"==typeof e&&GF(e)===$F}(t)){const n=qF(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Ki([],t);const c=new Ee(function JF(e,t,n=kt){return r=>{OM(t,()=>{const{length:o}=e,c=new Array(o);let d=o,_=o;for(let E=0;E<o;E++)OM(t,()=>{const C=Ki(e[E],t);let D=!1;C.subscribe(Qn(r,L=>{c[E]=L,D||(D=!0,_--),_||r.next(n(c.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,t,o?d=>function KF(e,t){return e.reduce((n,r,o)=>(n[r]=t[o],n),{})}(o,d):kt));return n?c.pipe(function YF(e){return kn(t=>function WF(e,t){return ZF(t)?e(...t):e(t)}(e,t))}(n)):c}function OM(e,t,n){e?Ct(n,e,t):t()}function iE(...e){return function QF(){return nn(1)}()(Ki(e,Dr(e)))}function NM(e){return new Ee(t=>{ns(e()).subscribe(t)})}function M_(e,t){const n=Te(e)?e:()=>e,r=o=>o.error(n());return new Ee(t?o=>t.schedule(r,0,o):r)}function oE(){return Xn((e,t)=>{let n=null;e._refCount++;const r=Qn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const o=e._connection,c=n;n=null,o&&(!c||o===c)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class kM extends Ee{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,jt(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new Ce;const n=this.getSubject();t.add(this.source.subscribe(Qn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=Ce.EMPTY)}return t}refCount(){return oE()(this)}}function yf(e,t){return Xn((n,r)=>{let o=null,c=0,d=!1;const _=()=>d&&!o&&r.complete();n.subscribe(Qn(r,E=>{o?.unsubscribe();let C=0;const D=c++;ns(e(E,D)).subscribe(o=Qn(r,L=>r.next(t?t(E,L,D,C++):L),()=>{o=null,_()}))},()=>{d=!0,_()}))})}function D_(e){return e<=0?()=>Rn:Xn((t,n)=>{let r=0;t.subscribe(Qn(n,o=>{++r<=e&&(n.next(o),e<=r&&n.complete())}))})}function $d(e,t){return Xn((n,r)=>{let o=0;n.subscribe(Qn(r,c=>e.call(t,c,o++)&&r.next(c)))})}function A1(e){return Xn((t,n)=>{let r=!1;t.subscribe(Qn(n,o=>{r=!0,n.next(o)},()=>{r||n.next(e),n.complete()}))})}function FM(e=t3){return Xn((t,n)=>{let r=!1;t.subscribe(Qn(n,o=>{r=!0,n.next(o)},()=>r?n.complete():n.error(e())))})}function t3(){return new D1}function qd(e,t){const n=arguments.length>=2;return r=>r.pipe(e?$d((o,c)=>e(o,c,r)):kt,D_(1),n?A1(t):FM(()=>new D1))}function kp(e,t){return Te(t)?ht(e,t,1):ht(e,1)}function Ll(e,t,n){const r=Te(e)||t||n?{next:e,error:t,complete:n}:e;return r?Xn((o,c)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let _=!0;o.subscribe(Qn(c,E=>{var C;null===(C=r.next)||void 0===C||C.call(r,E),c.next(E)},()=>{var E;_=!1,null===(E=r.complete)||void 0===E||E.call(r),c.complete()},E=>{var C;_=!1,null===(C=r.error)||void 0===C||C.call(r,E),c.error(E)},()=>{var E,C;_&&(null===(E=r.unsubscribe)||void 0===E||E.call(r)),null===(C=r.finalize)||void 0===C||C.call(r)}))}):kt}function Hd(e){return Xn((t,n)=>{let c,r=null,o=!1;r=t.subscribe(Qn(n,void 0,void 0,d=>{c=ns(e(d,Hd(e)(t))),r?(r.unsubscribe(),r=null,c.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,c.subscribe(n))})}function n3(e,t,n,r,o){return(c,d)=>{let _=n,E=t,C=0;c.subscribe(Qn(d,D=>{const L=C++;E=_?e(E,D,L):(_=!0,D),r&&d.next(E)},o&&(()=>{_&&d.next(E),d.complete()})))}}function zM(e,t){return Xn(n3(e,t,arguments.length>=2,!0))}function sE(e){return e<=0?()=>Rn:Xn((t,n)=>{let r=[];t.subscribe(Qn(n,o=>{r.push(o),e<r.length&&r.shift()},()=>{for(const o of r)n.next(o);n.complete()},void 0,()=>{r=null}))})}function BM(e,t){const n=arguments.length>=2;return r=>r.pipe(e?$d((o,c)=>e(o,c,r)):kt,sE(1),n?A1(t):FM(()=>new D1))}function aE(e){return Xn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const go="primary",A_=Symbol("RouteTitle");class o3{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function om(e){return new o3(e)}function s3(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const o={};for(let c=0;c<r.length;c++){const d=r[c],_=e[c];if(d.startsWith(":"))o[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,r.length),posParams:o}}function _f(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let o;for(let c=0;c<n.length;c++)if(o=n[c],!UM(e[o],t[o]))return!1;return!0}function UM(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((o,c)=>r[c]===o)}return e===t}function jM(e){return Array.prototype.concat.apply([],e)}function VM(e){return e.length>0?e[e.length-1]:null}function gl(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Xd(e){return ss(e)?e:Rs(e)?Ki(Promise.resolve(e)):Ai(e)}const P1=!1,u3={exact:function qM(e,t,n){if(!zp(e.segments,t.segments)||!L1(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!qM(e.children[r],t.children[r],n))return!1;return!0},subset:HM},GM={exact:function l3(e,t){return _f(e,t)},subset:function c3(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>UM(e[n],t[n]))},ignored:()=>!0};function $M(e,t,n){return u3[n.paths](e.root,t.root,n.matrixParams)&&GM[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function HM(e,t,n){return XM(e,t,t.segments,n)}function XM(e,t,n,r){if(e.segments.length>n.length){const o=e.segments.slice(0,n.length);return!(!zp(o,n)||t.hasChildren()||!L1(o,n,r))}if(e.segments.length===n.length){if(!zp(e.segments,n)||!L1(e.segments,n,r))return!1;for(const o in t.children)if(!e.children[o]||!HM(e.children[o],t.children[o],r))return!1;return!0}{const o=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!(zp(e.segments,o)&&L1(e.segments,o,r)&&e.children[go])&&XM(e.children[go],t,c,r)}}function L1(e,t,n){return t.every((r,o)=>GM[n](e[o].parameters,r.parameters))}class Fp{constructor(t=new Zo([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=om(this.queryParams)),this._queryParamMap}toString(){return d3.serialize(this)}}class Zo{constructor(t,n){this.segments=t,this.children=n,this.parent=null,gl(n,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return R1(this)}}class P_{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=om(this.parameters)),this._parameterMap}toString(){return YM(this)}}function zp(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let L_=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return new uE},providedIn:"root"}),e})();class uE{parse(t){const n=new b3(t);return new Fp(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${R_(t.root,!0)}`,r=function m3(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(o=>`${O1(n)}=${O1(o)}`).join("&"):`${O1(n)}=${O1(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function p3(e){return encodeURI(e)}(t.fragment)}`:""}`}}const d3=new uE;function R1(e){return e.segments.map(t=>YM(t)).join("/")}function R_(e,t){if(!e.hasChildren())return R1(e);if(t){const n=e.children[go]?R_(e.children[go],!1):"",r=[];return gl(e.children,(o,c)=>{c!==go&&r.push(`${c}:${R_(o,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function f3(e,t){let n=[];return gl(e.children,(r,o)=>{o===go&&(n=n.concat(t(r,o)))}),gl(e.children,(r,o)=>{o!==go&&(n=n.concat(t(r,o)))}),n}(e,(r,o)=>o===go?[R_(e.children[go],!1)]:[`${o}:${R_(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[go]?`${R1(e)}/${n[0]}`:`${R1(e)}/(${n.join("//")})`}}function ZM(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function O1(e){return ZM(e).replace(/%3B/gi,";")}function lE(e){return ZM(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function N1(e){return decodeURIComponent(e)}function WM(e){return N1(e.replace(/\+/g,"%20"))}function YM(e){return`${lE(e.path)}${function g3(e){return Object.keys(e).map(t=>`;${lE(t)}=${lE(e[t])}`).join("")}(e.parameters)}`}const y3=/^[^\/()?;=#]+/;function k1(e){const t=e.match(y3);return t?t[0]:""}const _3=/^[^=?&#]+/,x3=/^[^&#]+/;class b3{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Zo([],{}):new Zo([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[go]=new Zo(t,n)),r}parseSegment(){const t=k1(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Fn(4009,P1);return this.capture(t),new P_(N1(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=k1(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const o=k1(this.remaining);o&&(r=o,this.capture(r))}t[N1(n)]=N1(r)}parseQueryParam(t){const n=function v3(e){const t=e.match(_3);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const d=function w3(e){const t=e.match(x3);return t?t[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const o=WM(n),c=WM(r);if(t.hasOwnProperty(o)){let d=t[o];Array.isArray(d)||(d=[d],t[o]=d),d.push(c)}else t[o]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=k1(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new Fn(4010,P1);let c;r.indexOf(":")>-1?(c=r.slice(0,r.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=go);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[go]:new Zo([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Fn(4011,P1)}}function cE(e){return e.segments.length>0?new Zo([],{[go]:e}):e}function F1(e){const t={};for(const r of Object.keys(e.children)){const c=F1(e.children[r]);(c.segments.length>0||c.hasChildren())&&(t[r]=c)}return function E3(e){if(1===e.numberOfChildren&&e.children[go]){const t=e.children[go];return new Zo(e.segments.concat(t.segments),t.children)}return e}(new Zo(e.segments,t))}function Bp(e){return e instanceof Fp}function I3(e,t,n,r,o){if(0===n.length)return sm(t.root,t.root,t.root,r,o);const c=function QM(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new JM(!0,0,e);let t=0,n=!1;const r=e.reduce((o,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return gl(c.outlets,(E,C)=>{_[C]="string"==typeof E?E.split("/"):E}),[...o,{outlets:_}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===d?(c.split("/").forEach((_,E)=>{0==E&&"."===_||(0==E&&""===_?n=!0:".."===_?t++:""!=_&&o.push(_))}),o):[...o,c]},[]);return new JM(n,t,r)}(n);return c.toRoot()?sm(t.root,t.root,new Zo([],{}),r,o):function d(E){const C=function M3(e,t,n,r){if(e.isAbsolute)return new am(t.root,!0,0);if(-1===r)return new am(n,n===t.root,0);return function eD(e,t,n){let r=e,o=t,c=n;for(;c>o;){if(c-=o,r=r.parent,!r)throw new Fn(4005,!1);o=r.segments.length}return new am(r,!1,o-c)}(n,r+(O_(e.commands[0])?0:1),e.numberOfDoubleDots)}(c,t,e.snapshot?._urlSegment,E),D=C.processChildren?k_(C.segmentGroup,C.index,c.commands):fE(C.segmentGroup,C.index,c.commands);return sm(t.root,C.segmentGroup,D,r,o)}(e.snapshot?._lastPathIndex)}function O_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function N_(e){return"object"==typeof e&&null!=e&&e.outlets}function sm(e,t,n,r,o){let d,c={};r&&gl(r,(E,C)=>{c[C]=Array.isArray(E)?E.map(D=>`${D}`):`${E}`}),d=e===t?n:KM(e,t,n);const _=cE(F1(d));return new Fp(_,c,o)}function KM(e,t,n){const r={};return gl(e.children,(o,c)=>{r[c]=o===t?n:KM(o,t,n)}),new Zo(e.segments,r)}class JM{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&O_(r[0]))throw new Fn(4003,!1);const o=r.find(N_);if(o&&o!==VM(r))throw new Fn(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class am{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function fE(e,t,n){if(e||(e=new Zo([],{})),0===e.segments.length&&e.hasChildren())return k_(e,t,n);const r=function A3(e,t,n){let r=0,o=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(r>=n.length)return c;const d=e.segments[o],_=n[r];if(N_(_))break;const E=`${_}`,C=r<n.length-1?n[r+1]:null;if(o>0&&void 0===E)break;if(E&&C&&"object"==typeof C&&void 0===C.outlets){if(!nD(E,C,d))return c;r+=2}else{if(!nD(E,{},d))return c;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(e,t,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const c=new Zo(e.segments.slice(0,r.pathIndex),{});return c.children[go]=new Zo(e.segments.slice(r.pathIndex),e.children),k_(c,0,o)}return r.match&&0===o.length?new Zo(e.segments,{}):r.match&&!e.hasChildren()?dE(e,t,n):r.match?k_(e,0,o):dE(e,t,n)}function k_(e,t,n){if(0===n.length)return new Zo(e.segments,{});{const r=function D3(e){return N_(e[0])?e[0].outlets:{[go]:e}}(n),o={};return gl(r,(c,d)=>{"string"==typeof c&&(c=[c]),null!==c&&(o[d]=fE(e.children[d],t,c))}),gl(e.children,(c,d)=>{void 0===r[d]&&(o[d]=c)}),new Zo(e.segments,o)}}function dE(e,t,n){const r=e.segments.slice(0,t);let o=0;for(;o<n.length;){const c=n[o];if(N_(c)){const E=P3(c.outlets);return new Zo(r,E)}if(0===o&&O_(n[0])){r.push(new P_(e.segments[t].path,tD(n[0]))),o++;continue}const d=N_(c)?c.outlets[go]:`${c}`,_=o<n.length-1?n[o+1]:null;d&&_&&O_(_)?(r.push(new P_(d,tD(_))),o+=2):(r.push(new P_(d,{})),o++)}return new Zo(r,{})}function P3(e){const t={};return gl(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=dE(new Zo([],{}),0,n))}),t}function tD(e){const t={};return gl(e,(n,r)=>t[r]=`${n}`),t}function nD(e,t,n){return e==n.path&&_f(t,n.parameters)}class td{constructor(t,n){this.id=t,this.url=n}}class pE extends td{constructor(t,n,r="imperative",o=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Up extends td{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class z1 extends td{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class rD extends td{constructor(t,n,r,o){super(t,n),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class L3 extends td{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class R3 extends td{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class O3 extends td{constructor(t,n,r,o,c){super(t,n),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class N3 extends td{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class k3 extends td{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F3{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class z3{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class B3{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U3{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j3{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class V3{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class iD{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let $3=(()=>{class e{createUrlTree(n,r,o,c,d,_){return I3(n||r.root,o,c,d,_)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})(),q3=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(t){return $3.\u0275fac(t)},providedIn:"root"}),e})();class oD{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=gE(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=gE(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=mE(t,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return mE(t,this._root).map(n=>n.value)}}function gE(e,t){if(e===t.value)return t;for(const n of t.children){const r=gE(e,n);if(r)return r}return null}function mE(e,t){if(e===t.value)return[t];for(const n of t.children){const r=mE(e,n);if(r.length)return r.unshift(t),r}return[]}class nd{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function um(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class sD extends oD{constructor(t,n){super(t),this.snapshot=n,yE(this,t)}toString(){return this.snapshot.toString()}}function aD(e,t){const n=function H3(e,t){const d=new B1([],{},{},"",{},go,t,null,e.root,-1,{});return new lD("",new nd(d,[]))}(e,t),r=new zh([new P_("",{})]),o=new zh({}),c=new zh({}),d=new zh({}),_=new zh(""),E=new lm(r,o,d,_,c,go,t,n.root);return E.snapshot=n.root,new sD(new nd(E,[]),n)}class lm{constructor(t,n,r,o,c,d,_,E){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.title=this.data?.pipe(kn(C=>C[A_]))??Ai(void 0),this._futureSnapshot=E}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(kn(t=>om(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(kn(t=>om(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function uD(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const o=n[r],c=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(c.component)break;r--}}return function X3(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class B1{constructor(t,n,r,o,c,d,_,E,C,D,L){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.routeConfig=E,this._urlSegment=C,this._lastPathIndex=D,this._resolve=L}get title(){return this.data?.[A_]}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=om(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=om(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class lD extends oD{constructor(t,n){super(n),this.url=t,yE(this,n)}toString(){return cD(this._root)}}function yE(e,t){t.value._routerState=e,t.children.forEach(n=>yE(e,n))}function cD(e){const t=e.children.length>0?` { ${e.children.map(cD).join(", ")} } `:"";return`${e.value}${t}`}function _E(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,_f(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),_f(t.params,n.params)||e.params.next(n.params),function a3(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!_f(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),_f(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function vE(e,t){const n=_f(e.params,t.params)&&function h3(e,t){return zp(e,t)&&e.every((n,r)=>_f(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||vE(e.parent,t.parent))}function F_(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const o=function W3(e,t,n){return t.children.map(r=>{for(const o of n.children)if(e.shouldReuseRoute(r.value,o.value.snapshot))return F_(e,r,o);return F_(e,r)})}(e,t,n);return new nd(r,o)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>F_(e,_)),d}}const r=function Y3(e){return new lm(new zh(e.url),new zh(e.params),new zh(e.queryParams),new zh(e.fragment),new zh(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(c=>F_(e,c));return new nd(r,o)}}const xE="ngNavigationCancelingError";function hD(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=Bp(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=fD(!1,0,t);return o.url=n,o.navigationBehaviorOptions=r,o}function fD(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[xE]=!0,r.cancellationCode=t,n&&(r.url=n),r}function dD(e){return pD(e)&&Bp(e.url)}function pD(e){return e&&e[xE]}class K3{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new z_,this.attachRef=null}}let z_=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const o=this.getOrCreateContext(n);o.outlet=r,this.contexts.set(n,o)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new K3,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const U1=!1;let wE=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=go,this.activateEvents=new Pl,this.deactivateEvents=new Pl,this.attachEvents=new Pl,this.detachEvents=new Pl,this.parentContexts=xr(z_),this.location=xr(Oh),this.changeDetector=xr(Sb),this.environmentInjector=xr(th)}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:o}=n.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Fn(4012,U1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Fn(4012,U1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Fn(4012,U1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new Fn(4013,U1);this._activatedRoute=n;const o=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,E=new J3(n,_,o.injector);if(r&&function Q3(e){return!!e.resolveComponentFactory}(r)){const C=r.resolveComponentFactory(d);this.activated=o.createComponent(C,o.length,E)}else this.activated=o.createComponent(d,{index:o.length,injector:E,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=En({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[na]}),e})();class J3{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===lm?this.route:t===z_?this.childContexts:this.parent.get(t,n)}}let bE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=Ts({type:e,selectors:[["ng-component"]],standalone:!0,features:[II],decls:1,vars:0,template:function(n,r){1&n&&Ho(0,"router-outlet")},dependencies:[wE],encapsulation:2}),e})();function gD(e,t){return e.providers&&!e._injector&&(e._injector=o1(e.providers,t,`Route: ${e.path}`)),e._injector??t}function CE(e){const t=e.children&&e.children.map(CE),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==go&&(n.component=bE),n}function dh(e){return e.outlet||go}function mD(e,t){const n=e.filter(r=>dh(r)===t);return n.push(...e.filter(r=>dh(r)!==t)),n}function B_(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class iz{constructor(t,n,r,o){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=o}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),_E(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const o=um(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,o[d],r),delete o[d]}),gl(o,(c,d)=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(o===c)if(o.component){const d=r.getContext(o.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,r);else c&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=um(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);if(r&&r.outlet){const d=r.outlet.detach(),_=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=um(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const o=um(n);t.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],r),this.forwardEvent(new V3(c.value.snapshot))}),t.children.length&&this.forwardEvent(new U3(t.value.snapshot))}activateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(_E(o),o===c)if(o.component){const d=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,r);else if(o.component){const d=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const _=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),_E(_.route.value),this.activateChildRoutes(t,null,d.children)}else{const _=B_(o.snapshot),E=_?.get(vp)??null;d.attachRef=null,d.route=o,d.resolver=E,d.injector=_,d.outlet&&d.outlet.activateWith(o,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,r)}}class yD{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class j1{constructor(t,n){this.component=t,this.route=n}}function oz(e,t,n){const r=e._root;return U_(r,t?t._root:null,n,[r.value])}function cm(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function pu(e){return null!==ca(e)}(e)?t.get(e):e:r}function U_(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=um(t);return e.children.forEach(d=>{(function az(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const E=function uz(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!zp(e.url,t.url);case"pathParamsOrQueryParamsChange":return!zp(e.url,t.url)||!_f(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!vE(e,t)||!_f(e.queryParams,t.queryParams);default:return!vE(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);E?o.canActivateChecks.push(new yD(r)):(c.data=d.data,c._resolvedData=d._resolvedData),U_(e,t,c.component?_?_.children:null:n,r,o),E&&_&&_.outlet&&_.outlet.isActivated&&o.canDeactivateChecks.push(new j1(_.outlet.component,d))}else d&&j_(t,_,o),o.canActivateChecks.push(new yD(r)),U_(e,null,c.component?_?_.children:null:n,r,o)})(d,c[d.value.outlet],n,r.concat([d.value]),o),delete c[d.value.outlet]}),gl(c,(d,_)=>j_(d,n.getContext(_),o)),o}function j_(e,t,n){const r=um(e),o=e.value;gl(r,(c,d)=>{j_(c,o.component?t?t.children.getContext(d):null:t,n)}),n.canDeactivateChecks.push(new j1(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function V_(e){return"function"==typeof e}function SE(e){return e instanceof D1||"EmptyError"===e?.name}const V1=Symbol("INITIAL_VALUE");function hm(){return yf(e=>RM(e.map(t=>t.pipe(D_(1),function e3(...e){const t=Dr(e);return Xn((n,r)=>{(t?iE(e,n,t):iE(e,n)).subscribe(r)})}(V1)))).pipe(kn(t=>{for(const n of t)if(!0!==n){if(n===V1)return V1;if(!1===n||n instanceof Fp)return n}return!0}),$d(t=>t!==V1),D_(1)))}function _D(e){return function Ne(...e){return gt(e)}(Ll(t=>{if(Bp(t))throw hD(0,t)}),kn(t=>!0===t))}const IE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function vD(e,t,n,r,o){const c=TE(e,t,n);return c.matched?function Sz(e,t,n,r){const o=t.canMatch;return o&&0!==o.length?Ai(o.map(d=>{const _=cm(d,e);return Xd(function pz(e){return e&&V_(e.canMatch)}(_)?_.canMatch(t,n):e.runInContext(()=>_(t,n)))})).pipe(hm(),_D()):Ai(!0)}(r=gD(t,r),t,n).pipe(kn(d=>!0===d?c:{...IE})):Ai(c)}function TE(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...IE}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const o=(t.matcher||s3)(n,e,t);if(!o)return{...IE};const c={};gl(o.posParams,(_,E)=>{c[E]=_.path});const d=o.consumed.length>0?{...c,...o.consumed[o.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:o.consumed,remainingSegments:n.slice(o.consumed.length),parameters:d,positionalParamSegments:o.posParams??{}}}function G1(e,t,n,r){if(n.length>0&&function Mz(e,t,n){return n.some(r=>$1(e,t,r)&&dh(r)!==go)}(e,n,r)){const c=new Zo(t,function Tz(e,t,n,r){const o={};o[go]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const c of n)if(""===c.path&&dh(c)!==go){const d=new Zo([],{});d._sourceSegment=e,d._segmentIndexShift=t.length,o[dh(c)]=d}return o}(e,t,r,new Zo(n,e.children)));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:[]}}if(0===n.length&&function Dz(e,t,n){return n.some(r=>$1(e,t,r))}(e,n,r)){const c=new Zo(e.segments,function Iz(e,t,n,r,o){const c={};for(const d of r)if($1(e,n,d)&&!o[dh(d)]){const _=new Zo([],{});_._sourceSegment=e,_._segmentIndexShift=t.length,c[dh(d)]=_}return{...o,...c}}(e,t,n,r,e.children));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:n}}const o=new Zo(e.segments,e.children);return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}function $1(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function xD(e,t,n,r){return!!(dh(e)===r||r!==go&&$1(t,n,e))&&("**"===e.path||TE(t,e,n).matched)}function wD(e,t,n){return 0===t.length&&!e.children[n]}const q1=!1;class H1{constructor(t){this.segmentGroup=t||null}}class bD{constructor(t){this.urlTree=t}}function G_(e){return M_(new H1(e))}function ED(e){return M_(new bD(e))}class Rz{constructor(t,n,r,o,c){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=o,this.config=c,this.allowRedirects=!0}apply(){const t=G1(this.urlTree.root,[],[],this.config).segmentGroup,n=new Zo(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,go).pipe(kn(c=>this.createUrlTree(F1(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Hd(c=>{if(c instanceof bD)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof H1?this.noMatchError(c):c}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,go).pipe(kn(o=>this.createUrlTree(F1(o),t.queryParams,t.fragment))).pipe(Hd(o=>{throw o instanceof H1?this.noMatchError(o):o}))}noMatchError(t){return new Fn(4002,q1)}createUrlTree(t,n,r){const o=cE(t);return new Fp(o,n,r)}expandSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(kn(c=>new Zo([],c))):this.expandSegment(t,r,n,r.segments,o,!0)}expandChildren(t,n,r){const o=[];for(const c of Object.keys(r.children))"primary"===c?o.unshift(c):o.push(c);return Ki(o).pipe(kp(c=>{const d=r.children[c],_=mD(n,c);return this.expandSegmentGroup(t,_,d,c).pipe(kn(E=>({segment:E,outlet:c})))}),zM((c,d)=>(c[d.outlet]=d.segment,c),{}),BM())}expandSegment(t,n,r,o,c,d){return Ki(r).pipe(kp(_=>this.expandSegmentAgainstRoute(t,n,r,_,o,c,d).pipe(Hd(C=>{if(C instanceof H1)return Ai(null);throw C}))),qd(_=>!!_),Hd((_,E)=>{if(SE(_))return wD(n,o,c)?Ai(new Zo([],{})):G_(n);throw _}))}expandSegmentAgainstRoute(t,n,r,o,c,d,_){return xD(o,n,c,d)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(t,n,o,c,d):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d):G_(n):G_(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,o,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o){const c=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?ED(c):this.lineralizeSegments(r,c).pipe(ht(d=>{const _=new Zo(d,{});return this.expandSegment(t,_,n,d,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){const{matched:_,consumedSegments:E,remainingSegments:C,positionalParamSegments:D}=TE(n,o,c);if(!_)return G_(n);const L=this.applyRedirectCommands(E,o.redirectTo,D);return o.redirectTo.startsWith("/")?ED(L):this.lineralizeSegments(o,L).pipe(ht(N=>this.expandSegment(t,n,r,N.concat(C),d,!1)))}matchSegmentAgainstRoute(t,n,r,o,c){return"**"===r.path?(t=gD(r,t),r.loadChildren?(r._loadedRoutes?Ai({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(kn(_=>(r._loadedRoutes=_.routes,r._loadedInjector=_.injector,new Zo(o,{})))):Ai(new Zo(o,{}))):vD(n,r,o,t).pipe(yf(({matched:d,consumedSegments:_,remainingSegments:E})=>d?this.getChildConfig(t=r._injector??t,r,o).pipe(ht(D=>{const L=D.injector??t,N=D.routes,{segmentGroup:B,slicedSegments:te}=G1(n,_,E,N),ne=new Zo(B.segments,B.children);if(0===te.length&&ne.hasChildren())return this.expandChildren(L,N,ne).pipe(kn(ce=>new Zo(_,ce)));if(0===N.length&&0===te.length)return Ai(new Zo(_,{}));const Pe=dh(r)===c;return this.expandSegment(L,ne,N,te,Pe?go:c,!0).pipe(kn(ae=>new Zo(_.concat(ae.segments),ae.children)))})):G_(n)))}getChildConfig(t,n,r){return n.children?Ai({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Ai({routes:n._loadedRoutes,injector:n._loadedInjector}):function Cz(e,t,n,r){const o=t.canLoad;return void 0===o||0===o.length?Ai(!0):Ai(o.map(d=>{const _=cm(d,e);return Xd(function cz(e){return e&&V_(e.canLoad)}(_)?_.canLoad(t,n):e.runInContext(()=>_(t,n)))})).pipe(hm(),_D())}(t,n,r).pipe(ht(o=>o?this.configLoader.loadChildren(t,n).pipe(Ll(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function Pz(e){return M_(fD(q1,3))}())):Ai({routes:[],injector:t})}lineralizeSegments(t,n){let r=[],o=n.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return Ai(r);if(o.numberOfChildren>1||!o.children[go])return M_(new Fn(4e3,q1));o=o.children[go]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,o){const c=this.createSegmentGroup(t,n.root,r,o);return new Fp(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return gl(t,(o,c)=>{if("string"==typeof o&&o.startsWith(":")){const _=o.substring(1);r[c]=n[_]}else r[c]=o}),r}createSegmentGroup(t,n,r,o){const c=this.createSegments(t,n.segments,r,o);let d={};return gl(n.children,(_,E)=>{d[E]=this.createSegmentGroup(t,_,r,o)}),new Zo(c,d)}createSegments(t,n,r,o){return n.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,o):this.findOrReturn(c,r))}findPosParam(t,n,r){const o=r[n.path.substring(1)];if(!o)throw new Fn(4001,q1);return o}findOrReturn(t,n){let r=0;for(const o of n){if(o.path===t.path)return n.splice(r),o;r++}return t}}class Nz{}class zz{constructor(t,n,r,o,c,d,_){this.injector=t,this.rootComponentType=n,this.config=r,this.urlTree=o,this.url=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_}recognize(){const t=G1(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,go).pipe(kn(n=>{if(null===n)return null;const r=new B1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},go,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new nd(r,n),c=new lD(this.url,o);return this.inheritParamsAndData(c._root),c}))}inheritParamsAndData(t){const n=t.value,r=uD(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,o)}processChildren(t,n,r){return Ki(Object.keys(r.children)).pipe(kp(o=>{const c=r.children[o],d=mD(n,o);return this.processSegmentGroup(t,d,c,o)}),zM((o,c)=>o&&c?(o.push(...c),o):null),function r3(e,t=!1){return Xn((n,r)=>{let o=0;n.subscribe(Qn(r,c=>{const d=e(c,o++);(d||t)&&r.next(c),!d&&r.complete()}))})}(o=>null!==o),A1(null),BM(),kn(o=>{if(null===o)return null;const c=SD(o);return function Bz(e){e.sort((t,n)=>t.value.outlet===go?-1:n.value.outlet===go?1:t.value.outlet.localeCompare(n.value.outlet))}(c),c}))}processSegment(t,n,r,o,c){return Ki(n).pipe(kp(d=>this.processSegmentAgainstRoute(d._injector??t,d,r,o,c)),qd(d=>!!d),Hd(d=>{if(SE(d))return wD(r,o,c)?Ai([]):Ai(null);throw d}))}processSegmentAgainstRoute(t,n,r,o,c){if(n.redirectTo||!xD(n,r,o,c))return Ai(null);let d;if("**"===n.path){const _=o.length>0?VM(o).parameters:{},E=TD(r)+o.length;d=Ai({snapshot:new B1(o,_,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MD(n),dh(n),n.component??n._loadedComponent??null,n,ID(r),E,DD(n)),consumedSegments:[],remainingSegments:[]})}else d=vD(r,n,o,t).pipe(kn(({matched:_,consumedSegments:E,remainingSegments:C,parameters:D})=>{if(!_)return null;const L=TD(r)+E.length;return{snapshot:new B1(E,D,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,MD(n),dh(n),n.component??n._loadedComponent??null,n,ID(r),L,DD(n)),consumedSegments:E,remainingSegments:C}}));return d.pipe(yf(_=>{if(null===_)return Ai(null);const{snapshot:E,consumedSegments:C,remainingSegments:D}=_;t=n._injector??t;const L=n._loadedInjector??t,N=function Uz(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:B,slicedSegments:te}=G1(r,C,D,N.filter(Pe=>void 0===Pe.redirectTo));if(0===te.length&&B.hasChildren())return this.processChildren(L,N,B).pipe(kn(Pe=>null===Pe?null:[new nd(E,Pe)]));if(0===N.length&&0===te.length)return Ai([new nd(E,[])]);const ne=dh(n)===c;return this.processSegment(L,N,B,te,ne?go:c).pipe(kn(Pe=>null===Pe?null:[new nd(E,Pe)]))}))}}function jz(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function SD(e){const t=[],n=new Set;for(const r of e){if(!jz(r)){t.push(r);continue}const o=t.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...r.children),n.add(o)):t.push(r)}for(const r of n){const o=SD(r.children);t.push(new nd(r.value,o))}return t.filter(r=>!n.has(r))}function ID(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function TD(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function MD(e){return e.data||{}}function DD(e){return e.resolve||{}}function AD(e){return"string"==typeof e.title||null===e.title}function ME(e){return yf(t=>{const n=e(t);return n?Ki(n).pipe(kn(()=>t)):Ai(t)})}const fm=new Ti("ROUTES");let DE=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Ai(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Xd(n.loadComponent()).pipe(kn(LD),Ll(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),aE(()=>{this.componentLoaders.delete(n)})),o=new kM(r,()=>new $t).pipe(oE());return this.componentLoaders.set(n,o),o}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ai({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const c=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(kn(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let E,C,D=!1;Array.isArray(_)?C=_:(E=_.create(n).injector,C=jM(E.get(fm,[],Xr.Self|Xr.Optional)));return{routes:C.map(CE),injector:E}}),aE(()=>{this.childrenLoaders.delete(r)})),d=new kM(c,()=>new $t).pipe(oE());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(n){return Xd(n()).pipe(kn(LD),ht(o=>o instanceof CI||Array.isArray(o)?Ai(o):Ki(this.compiler.compileModuleAsync(o))))}}return e.\u0275fac=function(n){return new(n||e)(Gn(rh),Gn(gT))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function LD(e){return function Yz(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let AE=(()=>{class e{constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new $t,this.configLoader=xr(DE),this.environmentInjector=xr(th),this.urlSerializer=xr(L_),this.rootContexts=xr(z_),this.navigationId=0,this.configLoader.onLoadEndListener=o=>this.events.next(new z3(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new F3(o))}get hasRequestedNavigation(){return 0!==this.navigationId}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new zh({id:0,targetPageId:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe($d(r=>0!==r.id),kn(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),yf(r=>{let o=!1,c=!1;return Ai(r).pipe(Ll(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),yf(d=>{const _=n.browserUrlTree.toString(),E=!n.navigated||d.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(("reload"===n.onSameUrlNavigation||E)&&n.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return OD(d.source)&&(n.browserUrlTree=d.extractedUrl),Ai(d).pipe(yf(D=>{const L=this.transitions?.getValue();return this.events.next(new pE(D.id,this.urlSerializer.serialize(D.extractedUrl),D.source,D.restoredState)),L!==this.transitions?.getValue()?Rn:Promise.resolve(D)}),function Oz(e,t,n,r){return yf(o=>function Lz(e,t,n,r,o){return new Rz(e,t,n,r,o).apply()}(e,t,n,o.extractedUrl,r).pipe(kn(c=>({...o,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,n.config),Ll(D=>{this.currentNavigation={...this.currentNavigation,finalUrl:D.urlAfterRedirects},r.urlAfterRedirects=D.urlAfterRedirects}),function Gz(e,t,n,r,o){return ht(c=>function Fz(e,t,n,r,o,c,d="emptyOnly"){return new zz(e,t,n,r,o,d,c).recognize().pipe(yf(_=>null===_?function kz(e){return new Ee(t=>t.error(e))}(new Nz):Ai(_)))}(e,t,n,c.urlAfterRedirects,r.serialize(c.urlAfterRedirects),r,o).pipe(kn(d=>({...c,targetSnapshot:d}))))}(this.environmentInjector,n.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),Ll(D=>{if(r.targetSnapshot=D.targetSnapshot,"eager"===n.urlUpdateStrategy){if(!D.extras.skipLocationChange){const N=n.urlHandlingStrategy.merge(D.urlAfterRedirects,D.rawUrl);n.setBrowserUrl(N,D)}n.browserUrlTree=D.urlAfterRedirects}const L=new L3(D.id,this.urlSerializer.serialize(D.extractedUrl),this.urlSerializer.serialize(D.urlAfterRedirects),D.targetSnapshot);this.events.next(L)}));if(E&&n.rawUrlTree&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:L,extractedUrl:N,source:B,restoredState:te,extras:ne}=d,Pe=new pE(L,this.urlSerializer.serialize(N),B,te);this.events.next(Pe);const xe=aD(N,n.rootComponentType).snapshot;return Ai(r={...d,targetSnapshot:xe,urlAfterRedirects:N,extras:{...ne,skipLocationChange:!1,replaceUrl:!1}})}return n.rawUrlTree=d.rawUrl,d.resolve(null),Rn}),Ll(d=>{const _=new R3(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),kn(d=>r={...d,guards:oz(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function mz(e,t){return ht(n=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?Ai({...n,guardsResult:!0}):function yz(e,t,n,r){return Ki(e).pipe(ht(o=>function Ez(e,t,n,r,o){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Ai(c.map(_=>{const E=B_(t)??o,C=cm(_,E);return Xd(function dz(e){return e&&V_(e.canDeactivate)}(C)?C.canDeactivate(e,t,n,r):E.runInContext(()=>C(e,t,n,r))).pipe(qd())})).pipe(hm()):Ai(!0)}(o.component,o.route,n,t,r)),qd(o=>!0!==o,!0))}(d,r,o,e).pipe(ht(_=>_&&function lz(e){return"boolean"==typeof e}(_)?function _z(e,t,n,r){return Ki(t).pipe(kp(o=>iE(function xz(e,t){return null!==e&&t&&t(new B3(e)),Ai(!0)}(o.route.parent,r),function vz(e,t){return null!==e&&t&&t(new j3(e)),Ai(!0)}(o.route,r),function bz(e,t,n){const r=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function sz(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>NM(()=>Ai(d.guards.map(E=>{const C=B_(d.node)??n,D=cm(E,C);return Xd(function fz(e){return e&&V_(e.canActivateChild)}(D)?D.canActivateChild(r,e):C.runInContext(()=>D(r,e))).pipe(qd())})).pipe(hm())));return Ai(c).pipe(hm())}(e,o.path,n),function wz(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Ai(!0);const o=r.map(c=>NM(()=>{const d=B_(t)??n,_=cm(c,d);return Xd(function hz(e){return e&&V_(e.canActivate)}(_)?_.canActivate(t,e):d.runInContext(()=>_(t,e))).pipe(qd())}));return Ai(o).pipe(hm())}(e,o.route,n))),qd(o=>!0!==o,!0))}(r,c,e,t):Ai(_)),kn(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),Ll(d=>{if(r.guardsResult=d.guardsResult,Bp(d.guardsResult))throw hD(0,d.guardsResult);const _=new O3(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),$d(d=>!!d.guardsResult||(n.restoreHistory(d),this.cancelNavigationTransition(d,"",3,n),!1)),ME(d=>{if(d.guards.canActivateChecks.length)return Ai(d).pipe(Ll(_=>{const E=new N3(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}),yf(_=>{let E=!1;return Ai(_).pipe(function $z(e,t){return ht(n=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=n;if(!o.length)return Ai(n);let c=0;return Ki(o).pipe(kp(d=>function qz(e,t,n,r){const o=e.routeConfig,c=e._resolve;return void 0!==o?.title&&!AD(o)&&(c[A_]=o.title),function Hz(e,t,n,r){const o=function Xz(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Ai({});const c={};return Ki(o).pipe(ht(d=>function Zz(e,t,n,r){const o=B_(t)??r,c=cm(e,o);return Xd(c.resolve?c.resolve(t,n):o.runInContext(()=>c(t,n)))}(e[d],t,n,r).pipe(qd(),Ll(_=>{c[d]=_}))),sE(1),function i3(e){return kn(()=>e)}(c),Hd(d=>SE(d)?Rn:M_(d)))}(c,e,t,r).pipe(kn(d=>(e._resolvedData=d,e.data=uD(e,n).resolve,o&&AD(o)&&(e.data[A_]=o.title),null)))}(d.route,r,e,t)),Ll(()=>c++),sE(1),ht(d=>c===o.length?Ai(n):Rn))})}(n.paramsInheritanceStrategy,this.environmentInjector),Ll({next:()=>E=!0,complete:()=>{E||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2,n))}}))}),Ll(_=>{const E=new k3(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}))}),ME(d=>{const _=E=>{const C=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(E.routeConfig).pipe(Ll(D=>{E.component=D}),kn(()=>{})));for(const D of E.children)C.push(..._(D));return C};return RM(_(d.targetSnapshot.root)).pipe(A1(),D_(1))}),ME(()=>n.afterPreactivation()),kn(d=>{const _=function Z3(e,t,n){const r=F_(e,t._root,n?n._root:void 0);return new sD(r,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:_}}),Ll(d=>{n.currentUrlTree=d.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),n.routerState=d.targetRouterState,"deferred"===n.urlUpdateStrategy&&(d.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,d),n.browserUrlTree=d.urlAfterRedirects)}),((e,t,n)=>kn(r=>(new iz(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d)),Ll({next:d=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new Up(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{o=!0}}),aE(()=>{o||c||this.cancelNavigationTransition(r,"",1,n),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Hd(d=>{if(c=!0,pD(d)){dD(d)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new z1(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(_),dD(d)){const E=n.urlHandlingStrategy.merge(d.url,n.rawUrlTree),C={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||OD(r.source)};n.scheduleNavigation(E,"imperative",null,C,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new rD(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(d))}catch(E){r.reject(E)}}return Rn}))}))}cancelNavigationTransition(n,r,o,c){const d=new z1(n.id,this.urlSerializer.serialize(n.extractedUrl),r,o);this.events.next(d),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function OD(e){return"imperative"!==e}let ND=(()=>{class e{buildTitle(n){let r,o=n.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(c=>c.outlet===go);return r}getResolvedTitleForRoute(n){return n.data[A_]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return xr(Kz)},providedIn:"root"}),e})(),Kz=(()=>{class e extends ND{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(Gn(AM))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Jz=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return xr(eB)},providedIn:"root"}),e})();class Qz{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let eB=(()=>{class e extends Qz{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function Lm(e){return iu(()=>{const t=e.prototype.constructor,n=t[ou]||Xp(t),r=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==r;){const c=o[ou]||Xp(o);if(c&&c!==n)return c;o=Object.getPrototypeOf(o)}return c=>new c})}(e)))(r||e)}}(),e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const X1=new Ti("",{providedIn:"root",factory:()=>({})});let nB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:function(){return xr(rB)},providedIn:"root"}),e})(),rB=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function iB(e){throw e}function oB(e,t,n){return t.parse("/")}const sB={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},aB={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Vc=(()=>{class e{constructor(){this.disposed=!1,this.currentPageId=0,this.console=xr(bO),this.isNgZoneEnabled=!1,this.options=xr(X1,{optional:!0})||{},this.errorHandler=this.options.errorHandler||iB,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||oB,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Ai(void 0),this.urlHandlingStrategy=xr(nB),this.routeReuseStrategy=xr(Jz),this.urlCreationStrategy=xr(q3),this.titleStrategy=xr(ND),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=jM(xr(fm,{optional:!0})??[]),this.navigationTransitions=xr(AE),this.urlSerializer=xr(L_),this.location=xr(Ob),this.rootComponentType=null,this.isNgZoneEnabled=xr(Ru)instanceof Ru&&Ru.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Fp,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=aD(this.currentUrlTree,this.rootComponentType),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const o={replaceUrl:!0},c=n.state?.navigationId?n.state:null;if(n.state){const _={...n.state};delete _.navigationId,delete _.\u0275routerPageId,0!==Object.keys(_).length&&(o.state=_)}const d=this.parseUrl(n.url);this.scheduleNavigation(d,r,c,o)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(n){this.config=n.map(CE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:o,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:E}=r,C=E?this.currentUrlTree.fragment:d;let D=null;switch(_){case"merge":D={...this.currentUrlTree.queryParams,...c};break;case"preserve":D=this.currentUrlTree.queryParams;break;default:D=c||null}return null!==D&&(D=this.removeEmptyProps(D)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,n,D,C??null)}navigateByUrl(n,r={skipLocationChange:!1}){const o=Bp(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function uB(e){for(let t=0;t<e.length;t++){if(null==e[t])throw new Fn(4008,!1)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return r}isActive(n,r){let o;if(o=!0===r?{...sB}:!1===r?{...aB}:r,Bp(n))return $M(this.currentUrlTree,n,o);const c=this.parseUrl(n);return $M(this.currentUrlTree,c,o)}removeEmptyProps(n){return Object.keys(n).reduce((r,o)=>{const c=n[o];return null!=c&&(r[o]=c),r},{})}scheduleNavigation(n,r,o,c,d){if(this.disposed)return Promise.resolve(!1);let _,E,C,D;return d?(_=d.resolve,E=d.reject,C=d.promise):C=new Promise((L,N)=>{_=L,E=N}),"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),D=o&&o.\u0275routerPageId?o.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):D=0,this.navigationTransitions.handleNavigationRequest({targetPageId:D,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:E,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(L=>Promise.reject(L))}setBrowserUrl(n,r){const o=this.urlSerializer.serialize(n),c={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",c):this.location.go(o,"",c)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===o?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class FD{}let hB=(()=>{class e{constructor(n,r,o,c,d){this.router=n,this.injector=o,this.preloadingStrategy=c,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe($d(n=>n instanceof Up),kp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const o=[];for(const c of r){c.providers&&!c._injector&&(c._injector=o1(c.providers,n,`Route: ${c.path}`));const d=c._injector??n,_=c._loadedInjector??d;c.loadChildren&&!c._loadedRoutes&&void 0===c.canLoad||c.loadComponent&&!c._loadedComponent?o.push(this.preloadConfig(d,c)):(c.children||c._loadedRoutes)&&o.push(this.processRoutes(_,c.children??c._loadedRoutes))}return Ki(o).pipe(nn())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Ai(null);const c=o.pipe(ht(d=>null===d?Ai(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??n,d.routes))));return r.loadComponent&&!r._loadedComponent?Ki([c,this.loader.loadComponent(r)]).pipe(nn()):c})}}return e.\u0275fac=function(n){return new(n||e)(Gn(Vc),Gn(gT),Gn(th),Gn(FD),Gn(DE))},e.\u0275prov=bn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const LE=new Ti("");let zD=(()=>{class e{constructor(n,r,o,c,d={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=o,this.zone=c,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof pE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Up&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof iD&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new iD(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function L0(){throw new Error("invalid")}()},e.\u0275prov=bn({token:e,factory:e.\u0275fac}),e})();function pm(e,t){return{\u0275kind:e,\u0275providers:t}}function UD(){const e=xr(rh);return t=>{const n=e.get(h1);if(t!==n.components[0])return;const r=e.get(Vc),o=e.get(jD);1===e.get(OE)&&r.initialNavigation(),e.get(VD,null,Xr.Optional)?.setUpPreloading(),e.get(LE,null,Xr.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),o.closed||(o.next(),o.unsubscribe())}}const jD=new Ti("",{factory:()=>new $t}),OE=new Ti("",{providedIn:"root",factory:()=>1});const VD=new Ti("");function mB(e){return pm(0,[{provide:VD,useExisting:hB},{provide:FD,useExisting:e}])}const GD=new Ti("ROUTER_FORROOT_GUARD"),yB=[Ob,{provide:L_,useClass:uE},Vc,z_,{provide:lm,useFactory:function BD(e){return e.routerState.root},deps:[Vc]},DE,[]];function _B(){return new bT("Router",Vc)}let $D=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[yB,[],{provide:fm,multi:!0,useValue:n},{provide:GD,useFactory:bB,deps:[[Vc,new jr,new Yh]]},{provide:X1,useValue:r||{}},r?.useHash?{provide:Np,useClass:lN}:{provide:Np,useClass:qT},{provide:LE,useFactory:()=>{const e=xr(Ok),t=xr(Ru),n=xr(X1),r=xr(AE),o=xr(L_);return n.scrollOffset&&e.setOffset(n.scrollOffset),new zD(o,r,e,t,n)}},r?.preloadingStrategy?mB(r.preloadingStrategy).\u0275providers:[],{provide:bT,multi:!0,useFactory:_B},r?.initialNavigation?EB(r):[],[{provide:qD,useFactory:UD},{provide:pT,multi:!0,useExisting:qD}]]}}static forChild(n){return{ngModule:e,providers:[{provide:fm,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Gn(GD,8))},e.\u0275mod=Qs({type:e}),e.\u0275inj=Jo({imports:[bE]}),e})();function bB(e){return"guarded"}function EB(e){return["disabled"===e.initialNavigation?pm(3,[{provide:x_,multi:!0,useFactory:()=>{const t=xr(Vc);return()=>{t.setUpLocationChangeListener()}}},{provide:OE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?pm(2,[{provide:OE,useValue:0},{provide:x_,multi:!0,deps:[rh],useFactory:t=>{const n=t.get(aN,Promise.resolve());return()=>n.then(()=>new Promise(o=>{const c=t.get(Vc),d=t.get(jD);(function r(o){t.get(Vc).events.pipe($d(d=>d instanceof Up||d instanceof z1||d instanceof rD),kn(d=>d instanceof Up||d instanceof z1&&(0===d.code||1===d.code)&&null),$d(d=>null!==d),D_(1)).subscribe(()=>{o()})})(()=>{o(!0)}),c.afterPreactivation=()=>(o(!0),d.closed?Ai(void 0):d),c.initialNavigation()}))}}]).\u0275providers:[]]}const qD=new Ti("");class gm{}gm.\u0275fac=function(t){return new(t||gm)},gm.\u0275mod=Qs({type:gm}),gm.\u0275inj=Jo({imports:[$D.forRoot([]),$D]});var tc=6371008.8,HD={centimeters:100*tc,centimetres:100*tc,degrees:tc/111325,feet:3.28084*tc,inches:39.37*tc,kilometers:tc/1e3,kilometres:tc/1e3,meters:tc,metres:tc,miles:tc/1609.344,millimeters:1e3*tc,millimetres:1e3*tc,nauticalmiles:tc/1852,radians:1,yards:1.0936*tc};function Bh(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function Uh(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!kE(e[0])||!kE(e[1]))throw new Error("coordinates must contain numbers");return Bh({type:"Point",coordinates:e},t,n)}function Z1(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var c=o[r];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}return Bh({type:"Polygon",coordinates:e},t,n)}function jh(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Bh({type:"LineString",coordinates:e},t,n)}function Vh(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function NE(e,t){void 0===t&&(t="kilometers");var n=HD[t];if(!n)throw new Error(t+" units is invalid");return e/n}function W1(e){return e%(2*Math.PI)*180/Math.PI}function Gh(e){return e%360*Math.PI/180}function kE(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function mm(e,t,n){if(null!==e)for(var r,o,c,d,_,E,C,N,D=0,L=0,B=e.type,te="FeatureCollection"===B,ne="Feature"===B,Pe=te?e.features.length:1,xe=0;xe<Pe;xe++){_=(N=!!(C=te?e.features[xe].geometry:ne?e.geometry:e)&&"GeometryCollection"===C.type)?C.geometries.length:1;for(var ae=0;ae<_;ae++){var ce=0,tt=0;if(null!==(d=N?C.geometries[ae]:C)){E=d.coordinates;var ct=d.type;switch(D=!n||"Polygon"!==ct&&"MultiPolygon"!==ct?0:1,ct){case null:break;case"Point":if(!1===t(E,L,xe,ce,tt))return!1;L++,ce++;break;case"LineString":case"MultiPoint":for(r=0;r<E.length;r++){if(!1===t(E[r],L,xe,ce,tt))return!1;L++,"MultiPoint"===ct&&ce++}"LineString"===ct&&ce++;break;case"Polygon":case"MultiLineString":for(r=0;r<E.length;r++){for(o=0;o<E[r].length-D;o++){if(!1===t(E[r][o],L,xe,ce,tt))return!1;L++}"MultiLineString"===ct&&ce++,"Polygon"===ct&&tt++}"Polygon"===ct&&ce++;break;case"MultiPolygon":for(r=0;r<E.length;r++){for(tt=0,o=0;o<E[r].length;o++){for(c=0;c<E[r][o].length-D;c++){if(!1===t(E[r][o][c],L,xe,ce,tt))return!1;L++}tt++}ce++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===mm(d.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function q_(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function Zd(e,t){!function KD(e,t){var n,r,o,c,d,_,E,C,D,L,N=0,B="FeatureCollection"===e.type,te="Feature"===e.type,ne=B?e.features.length:1;for(n=0;n<ne;n++){for(C=B?e.features[n].properties:te?e.properties:{},D=B?e.features[n].bbox:te?e.bbox:void 0,L=B?e.features[n].id:te?e.id:void 0,d=(E=!!(_=B?e.features[n].geometry:te?e.geometry:e)&&"GeometryCollection"===_.type)?_.geometries.length:1,o=0;o<d;o++)if(null!==(c=E?_.geometries[o]:_))switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(c,N,C,D,L))return!1;break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(!1===t(c.geometries[r],N,C,D,L))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,N,C,D,L))return!1;N++}}(e,function(n,r,o,c,d){var E,_=null===n?null:n.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Bh(n,o,{bbox:c,id:d}),r,0)&&void 0}switch(_){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon"}for(var C=0;C<n.coordinates.length;C++)if(!1===t(Bh({type:E,coordinates:n.coordinates[C]},o),r,C))return!1})}function FE(e){var t=[1/0,1/0,-1/0,-1/0];return mm(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}FE.default=FE;const JD=FE;function rd(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function vf(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function QD(e){return"Feature"===e.type?e.geometry:e}function zE(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}function r2(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=rd(e),o=QD(t),c=o.type,d=t.bbox,_=o.coordinates;if(d&&!1===function HB(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,d))return!1;"Polygon"===c&&(_=[_]);for(var E=!1,C=0;C<_.length&&!E;C++)if(i2(r,_[C][0],n.ignoreBoundary)){for(var D=!1,L=1;L<_[C].length&&!D;)i2(r,_[C][L],!n.ignoreBoundary)&&(D=!0),L++;D||(E=!0)}return E}function i2(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,c=t.length-1;o<t.length;c=o++){var d=t[o][0],_=t[o][1],E=t[c][0],C=t[c][1];if(e[1]*(d-E)+_*(E-e[0])+C*(e[0]-d)==0&&(d-e[0])*(E-e[0])<=0&&(_-e[1])*(C-e[1])<=0)return!n;_>e[1]!=C>e[1]&&e[0]<(E-d)*(e[1]-_)/(C-_)+d&&(r=!r)}return r}He(5943),He(1335);const id=function XB(e,t,n){void 0===n&&(n={});var r=rd(e),o=rd(t),c=Gh(o[1]-r[1]),d=Gh(o[0]-r[0]),_=Gh(r[1]),E=Gh(o[1]),C=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(_)*Math.cos(E);return function YD(e,t){void 0===t&&(t="kilometers");var n=HD[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)};var s2=new ArrayBuffer(16);new Float64Array(s2),new Uint32Array(s2),He(3544),function(){function e(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var n=0;n<this.length;n++)this.points[n].z=this.points[n].z||0;for(n=0;n<this.length-1;n++){var r=this.points[n],o=this.points[n+1];this.centers.push({x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:(r.z+o.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),n=0;n<this.centers.length-1;n++){var c=this.points[n+1].x-(this.centers[n].x+this.centers[n+1].x)/2,d=this.points[n+1].y-(this.centers[n].y+this.centers[n+1].y)/2,_=this.points[n+1].z-(this.centers[n].y+this.centers[n+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n].z+_)},{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n+1].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n+1].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n+1].z+_)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(t){var n=[],r=this.pos(0);n.push(0);for(var o=0;o<this.duration;o+=10){var c=this.pos(o);Math.sqrt((c.x-r.x)*(c.x-r.x)+(c.y-r.y)*(c.y-r.y)+(c.z-r.z)*(c.z-r.z))>t&&(n.push(o),r=c)}return n},e.prototype.vector=function(t){var n=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(n.y-r.y,n.x-r.x)/3.14,speed:Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)+(r.z-n.z)*(r.z-n.z))}},e.prototype.pos=function(t){var n=t-this.delay;n<0&&(n=0),n>this.duration&&(n=this.duration-1);var r=n/this.duration;if(r>=1)return this.points[this.length-1];var o=Math.floor((this.points.length-1)*r);return function l4(e,t,n,r,o){var c=function c4(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:o.x*c[0]+r.x*c[1]+n.x*c[2]+t.x*c[3],y:o.y*c[0]+r.y*c[1]+n.y*c[2]+t.y*c[3],z:o.z*c[0]+r.z*c[1]+n.z*c[2]+t.z*c[3]}}((this.length-1)*r-o,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}}();function $E(e,t,n,r){void 0===r&&(r={});var o=rd(e),c=Gh(o[0]),d=Gh(o[1]),_=Gh(n),E=NE(t,r.units),C=Math.asin(Math.sin(d)*Math.cos(E)+Math.cos(d)*Math.sin(E)*Math.cos(_));return Uh([W1(c+Math.atan2(Math.sin(_)*Math.sin(E)*Math.cos(d),Math.cos(E)-Math.sin(d)*Math.sin(C))),W1(C)],r.properties)}function qE(e,t,n){if(void 0===n&&(n={}),!0===n.final)return function y4(e,t){return(qE(t,e)+180)%360}(e,t);var r=rd(e),o=rd(t),c=Gh(r[0]),d=Gh(o[0]),_=Gh(r[1]),E=Gh(o[1]),C=Math.sin(d-c)*Math.cos(E),D=Math.cos(_)*Math.sin(E)-Math.sin(_)*Math.cos(E)*Math.cos(d-c);return W1(Math.atan2(C,D))}He(5469);const HE=function x4(e){if(!e)throw new Error("geojson is required");var t=[];return Zd(e,function(n){!function w4(e,t){var n=[],r=e.geometry;if(null!==r){switch(r.type){case"Polygon":n=vf(r);break;case"LineString":n=[vf(r)]}n.forEach(function(o){var c=function b4(e,t){var n=[];return e.reduce(function(r,o){var c=jh([r,o],t);return c.bbox=function E4(e,t){var n=e[0],r=e[1],o=t[0],c=t[1];return[n<o?n:o,r<c?r:c,n>o?n:o,r>c?r:c]}(r,o),n.push(c),o}),n}(o,e.properties);c.forEach(function(d){d.id=t.length,t.push(d)})})}}(n,t)}),Vh(t)};var XE=He(5406);function d2(e,t){var n=vf(e),r=vf(t);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],c=n[0][1],d=n[1][0],_=n[1][1],E=r[0][0],C=r[0][1],D=r[1][0],L=r[1][1],N=(L-C)*(d-o)-(D-E)*(_-c);if(0===N)return null;var ne=((D-E)*(c-C)-(L-C)*(o-E))/N,Pe=((d-o)*(c-C)-(_-c)*(o-E))/N;return ne>=0&&ne<=1&&Pe>=0&&Pe<=1?Uh([o+ne*(d-o),c+ne*(_-c)]):null}const p2=function C4(e,t){var n={},r=[];if("LineString"===e.type&&(e=Bh(e)),"LineString"===t.type&&(t=Bh(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var o=d2(e,t);return o&&r.push(o),Vh(r)}var c=XE();return c.load(HE(t)),q_(HE(e),function(d){q_(c.search(d),function(_){var E=d2(d,_);if(E){var C=vf(E).join(",");n[C]||(n[C]=!0,r.push(E))}})}),Vh(r)};function YE(e,t,n){void 0===n&&(n={});for(var o=QD(e).coordinates,c=0,d=0;d<o.length&&!(t>=c&&d===o.length-1);d++){if(c>=t){var _=t-c;if(_){var E=qE(o[d],o[d-1])-180;return $E(o[d],_,E,n)}return Uh(o[d])}c+=id(o[d],o[d+1],n)}return Uh(o[o.length-1])}function KE(e,t){return void 0===t&&(t={}),function RB(e,t,n){var r=n,o=!1;return function LB(e,t){Zd(e,function(n,r,o){var c=0;if(n.geometry){var d=n.geometry.type;if("Point"!==d&&"MultiPoint"!==d){var _,E=0,C=0,D=0;if(!1===mm(n,function(L,N,B,te,ne){if(void 0===_||r>E||te>C||ne>D)return _=L,E=r,C=te,D=ne,void(c=0);var Pe=jh([_,L],n.properties);if(!1===t(Pe,r,o,ne,c))return!1;c++,_=L}))return!1}}})}(e,function(c,d,_,E,C){r=!1===o&&void 0===n?c:t(r,c,d,_,E,C),o=!0}),r}(e,function(n,r){var o=r.geometry.coordinates;return n+id(o[0],o[1],t)},0)}var C2=Math.PI/180,S2=180/Math.PI,Z_=function(e,t){this.lon=e,this.lat=t,this.x=C2*e,this.y=C2*t};Z_.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},Z_.prototype.antipode=function(){return new Z_(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var I2=function(){this.coords=[],this.length=0};I2.prototype.move_to=function(e){this.length++,this.coords.push(e)};var JE=function(e){this.properties=e||{},this.geometries=[]};JE.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},JE.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(c){t+=c[0]+" "+c[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};var QE=function(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new Z_(e.x,e.y),this.end=new Z_(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,c=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(c)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};function T2(e,t){var n=[],r=XE();return Zd(t,function(o){if(n.forEach(function(_,E){_.id=E}),n.length){var c=r.search(o);if(c.features.length){var d=M2(o,c);n=n.filter(function(_){return _.id!==d.id}),r.remove(d),q_(eC(d,o),function(_){n.push(_),r.insert(_)})}}else(n=eC(e,o).features).forEach(function(_){_.bbox||(_.bbox=function g4(e){var t=e[0],n=e[1],r=e[2],o=e[3];if(id(e.slice(0,2),[r,n])>=id(e.slice(0,2),[t,o])){var _=(n+o)/2;return[t,_-(r-t)/2,r,_+(r-t)/2]}var E=(t+r)/2;return[E-(o-n)/2,n,E+(o-n)/2,o]}(JD(_)))}),r.load(Vh(n))}),Vh(n)}function eC(e,t){var n=[],r=vf(e)[0],o=vf(e)[e.geometry.coordinates.length-1];if(tC(r,rd(t))||tC(o,rd(t)))return Vh([e]);var c=XE(),d=HE(e);c.load(d);var _=c.search(t);if(!_.features.length)return Vh([e]);var E=M2(t,_),D=function PB(e,t,n){var r=n;return q_(e,function(o,c){r=0===c&&void 0===n?o:t(r,o,c)}),r}(d,function(L,N,B){var te=vf(N)[1],ne=rd(t);return B===E.id?(L.push(ne),n.push(jh(L)),tC(ne,te)?[ne]:[ne,te]):(L.push(te),L)},[r]);return D.length>1&&n.push(jh(D)),Vh(n)}function M2(e,t){if(!t.features.length)throw new Error("lines must contain features");if(1===t.features.length)return t.features[0];var n,r=1/0;return q_(t,function(o){var d=function S4(e,t,n){void 0===n&&(n={});var r=Uh([1/0,1/0],{dist:1/0}),o=0;return Zd(e,function(c){for(var d=vf(c),_=0;_<d.length-1;_++){var E=Uh(d[_]);E.properties.dist=id(t,E,n);var C=Uh(d[_+1]);C.properties.dist=id(t,C,n);var D=id(E,C,n),L=Math.max(E.properties.dist,C.properties.dist),N=qE(E,C),B=$E(t,L,N+90,n),te=$E(t,L,N-90,n),ne=p2(jh([B.geometry.coordinates,te.geometry.coordinates]),jh([E.geometry.coordinates,C.geometry.coordinates])),Pe=null;ne.features.length>0&&((Pe=ne.features[0]).properties.dist=id(t,Pe,n),Pe.properties.location=o+id(E,Pe,n)),E.properties.dist<r.properties.dist&&((r=E).properties.index=_,r.properties.location=o),C.properties.dist<r.properties.dist&&((r=C).properties.index=_+1,r.properties.location=o+D),Pe&&Pe.properties.dist<r.properties.dist&&((r=Pe).properties.index=_),o+=D}}),r}(o,e).properties.dist;d<r&&(n=o,r=d)}),n}function tC(e,t){return e[0]===t[0]&&e[1]===t[1]}QE.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),o=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),c=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),d=S2*Math.atan2(c,Math.sqrt(Math.pow(r,2)+Math.pow(o,2)));return[S2*Math.atan2(o,r),d]},QE.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),o=0;o<e;++o){var d=this.interpolate(r*o);n.push(d)}for(var _=!1,E=0,C=t&&t.offset?t.offset:10,D=180-C,L=-180+C,N=360-C,B=1;B<n.length;++B){var te=n[B-1][0],ne=n[B][0],Pe=Math.abs(ne-te);Pe>N&&(ne>D&&te<L||te>D&&ne<L)?_=!0:Pe>E&&(E=Pe)}var xe=[];if(_&&E<C){var ae=[];xe.push(ae);for(var ce=0;ce<n.length;++ce){var tt=parseFloat(n[ce][0]);if(ce>0&&Math.abs(tt-n[ce-1][0])>N){var ct=parseFloat(n[ce-1][0]),Pt=parseFloat(n[ce-1][1]),Nt=parseFloat(n[ce][0]),tn=parseFloat(n[ce][1]);if(ct>-180&&ct<L&&180===Nt&&ce+1<n.length&&n[ce-1][0]>-180&&n[ce-1][0]<L){ae.push([-180,n[ce][1]]),ce++,ae.push([n[ce][0],n[ce][1]]);continue}if(ct>D&&ct<180&&-180===Nt&&ce+1<n.length&&n[ce-1][0]>D&&n[ce-1][0]<180){ae.push([180,n[ce][1]]),ce++,ae.push([n[ce][0],n[ce][1]]);continue}if(ct<L&&Nt>D){var nt=ct;ct=Nt,Nt=nt;var ui=Pt;Pt=tn,tn=ui}if(ct>D&&Nt<L&&(Nt+=360),ct<=180&&Nt>=180&&ct<Nt){var br=(180-ct)/(Nt-ct),Li=br*tn+(1-br)*Pt;ae.push([n[ce-1][0]>D?180:-180,Li]),(ae=[]).push([n[ce-1][0]>D?-180:180,Li]),xe.push(ae)}else xe.push(ae=[]);ae.push([tt,n[ce][1]])}else ae.push([n[ce][0],n[ce][1]])}}else{var Ui=[];xe.push(Ui);for(var nr=0;nr<n.length;++nr)Ui.push([n[nr][0],n[nr][1]])}for(var ii=new JE(this.properties),zr=0;zr<xe.length;++zr){var _s=new I2;ii.geometries.push(_s);for(var fs=xe[zr],Yi=0;Yi<fs.length;++Yi)_s.move_to(fs[Yi])}return ii};const J4=function K4(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var n=zE(e),r=zE(t);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var o=function V4(e,t){void 0===t&&(t={});var n=t.precision,r=t.coordinates,o=t.mutate;if(n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");(!1===o||void 0===o)&&(e=JSON.parse(JSON.stringify(e)));var c=Math.pow(10,n);return mm(e,function(d){!function G4(e,t,n){e.length>n&&e.splice(n,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t}(d,c,r)}),e}(t,{precision:7});switch(r){case"Point":return eC(e,o);case"MultiPoint":return T2(e,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return T2(e,p2(e,o))}};He(6952);var mo=[],yo=[],_o=[],vo=[],xo=[],wo=[],bo=[],Eo=[],Co=[],So=[],Io=[],To=[],Mo=[],Do=[],Ao=[],Po=[],Lo=[],Ro=[],Oo=[],No=[],ko=[],Fo=[],zo=[],Bo=[];bo[85]=So[85]=-1,Eo[85]=Io[85]=0,Co[85]=To[85]=1,Oo[85]=Fo[85]=1,No[85]=zo[85]=0,ko[85]=Bo[85]=1,mo[85]=vo[85]=0,yo[85]=xo[85]=-1,_o[85]=Ao[85]=0,Po[85]=Mo[85]=0,Lo[85]=Do[85]=1,wo[85]=Ro[85]=1,Fo[1]=Fo[169]=0,zo[1]=zo[169]=-1,Bo[1]=Bo[169]=0,Mo[1]=Mo[169]=-1,Do[1]=Do[169]=0,Ao[1]=Ao[169]=0,So[4]=So[166]=0,Io[4]=Io[166]=-1,To[4]=To[166]=1,Po[4]=Po[166]=1,Lo[4]=Lo[166]=0,Ro[4]=Ro[166]=0,bo[16]=bo[154]=0,Eo[16]=Eo[154]=1,Co[16]=Co[154]=1,vo[16]=vo[154]=1,xo[16]=xo[154]=0,wo[16]=wo[154]=1,Oo[64]=Oo[106]=0,No[64]=No[106]=1,ko[64]=ko[106]=0,mo[64]=mo[106]=-1,yo[64]=yo[106]=0,_o[64]=_o[106]=1,Oo[2]=Oo[168]=0,No[2]=No[168]=-1,ko[2]=ko[168]=1,Fo[2]=Fo[168]=0,zo[2]=zo[168]=-1,Bo[2]=Bo[168]=0,Mo[2]=Mo[168]=-1,Do[2]=Do[168]=0,Ao[2]=Ao[168]=0,Po[2]=Po[168]=-1,Lo[2]=Lo[168]=0,Ro[2]=Ro[168]=1,bo[8]=bo[162]=0,Eo[8]=Eo[162]=-1,Co[8]=Co[162]=0,So[8]=So[162]=0,Io[8]=Io[162]=-1,To[8]=To[162]=1,Mo[8]=Mo[162]=1,Do[8]=Do[162]=0,Ao[8]=Ao[162]=1,Po[8]=Po[162]=1,Lo[8]=Lo[162]=0,Ro[8]=Ro[162]=0,bo[32]=bo[138]=0,Eo[32]=Eo[138]=1,Co[32]=Co[138]=1,So[32]=So[138]=0,Io[32]=Io[138]=1,To[32]=To[138]=0,mo[32]=mo[138]=1,yo[32]=yo[138]=0,_o[32]=_o[138]=0,vo[32]=vo[138]=1,xo[32]=xo[138]=0,wo[32]=wo[138]=1,Fo[128]=Fo[42]=0,zo[128]=zo[42]=1,Bo[128]=Bo[42]=1,Oo[128]=Oo[42]=0,No[128]=No[42]=1,ko[128]=ko[42]=0,mo[128]=mo[42]=-1,yo[128]=yo[42]=0,_o[128]=_o[42]=1,vo[128]=vo[42]=-1,xo[128]=xo[42]=0,wo[128]=wo[42]=0,So[5]=So[165]=-1,Io[5]=Io[165]=0,To[5]=To[165]=0,Fo[5]=Fo[165]=1,zo[5]=zo[165]=0,Bo[5]=Bo[165]=0,Po[20]=Po[150]=0,Lo[20]=Lo[150]=1,Ro[20]=Ro[150]=1,vo[20]=vo[150]=0,xo[20]=xo[150]=-1,wo[20]=wo[150]=1,bo[80]=bo[90]=-1,Eo[80]=Eo[90]=0,Co[80]=Co[90]=1,Oo[80]=Oo[90]=1,No[80]=No[90]=0,ko[80]=ko[90]=1,Mo[65]=Mo[105]=0,Do[65]=Do[105]=1,Ao[65]=Ao[105]=0,mo[65]=mo[105]=0,yo[65]=yo[105]=-1,_o[65]=_o[105]=0,bo[160]=bo[10]=-1,Eo[160]=Eo[10]=0,Co[160]=Co[10]=1,So[160]=So[10]=-1,Io[160]=Io[10]=0,To[160]=To[10]=0,Fo[160]=Fo[10]=1,zo[160]=zo[10]=0,Bo[160]=Bo[10]=0,Oo[160]=Oo[10]=1,No[160]=No[10]=0,ko[160]=ko[10]=1,Po[130]=Po[40]=0,Lo[130]=Lo[40]=1,Ro[130]=Ro[40]=1,Mo[130]=Mo[40]=0,Do[130]=Do[40]=1,Ao[130]=Ao[40]=0,mo[130]=mo[40]=0,yo[130]=yo[40]=-1,_o[130]=_o[40]=0,vo[130]=vo[40]=0,xo[130]=xo[40]=-1,wo[130]=wo[40]=1,So[37]=So[133]=0,Io[37]=Io[133]=1,To[37]=To[133]=1,Fo[37]=Fo[133]=0,zo[37]=zo[133]=1,Bo[37]=Bo[133]=0,mo[37]=mo[133]=-1,yo[37]=yo[133]=0,_o[37]=_o[133]=0,vo[37]=vo[133]=1,xo[37]=xo[133]=0,wo[37]=wo[133]=0,Po[148]=Po[22]=-1,Lo[148]=Lo[22]=0,Ro[148]=Ro[22]=0,Fo[148]=Fo[22]=0,zo[148]=zo[22]=-1,Bo[148]=Bo[22]=1,Oo[148]=Oo[22]=0,No[148]=No[22]=1,ko[148]=ko[22]=1,vo[148]=vo[22]=-1,xo[148]=xo[22]=0,wo[148]=wo[22]=1,bo[82]=bo[88]=0,Eo[82]=Eo[88]=-1,Co[82]=Co[88]=1,Po[82]=Po[88]=1,Lo[82]=Lo[88]=0,Ro[82]=Ro[88]=1,Mo[82]=Mo[88]=-1,Do[82]=Do[88]=0,Ao[82]=Ao[88]=1,Oo[82]=Oo[88]=0,No[82]=No[88]=-1,ko[82]=ko[88]=0,bo[73]=bo[97]=0,Eo[73]=Eo[97]=1,Co[73]=Co[97]=0,So[73]=So[97]=0,Io[73]=Io[97]=-1,To[73]=To[97]=0,Mo[73]=Mo[97]=1,Do[73]=Do[97]=0,Ao[73]=Ao[97]=0,mo[73]=mo[97]=1,yo[73]=yo[97]=0,_o[73]=_o[97]=1,bo[145]=bo[25]=0,Eo[145]=Eo[25]=-1,Co[145]=Co[25]=0,Mo[145]=Mo[25]=1,Do[145]=Do[25]=0,Ao[145]=Ao[25]=1,Fo[145]=Fo[25]=0,zo[145]=zo[25]=1,Bo[145]=Bo[25]=1,vo[145]=vo[25]=-1,xo[145]=xo[25]=0,wo[145]=wo[25]=0,So[70]=So[100]=0,Io[70]=Io[100]=1,To[70]=To[100]=0,Po[70]=Po[100]=-1,Lo[70]=Lo[100]=0,Ro[70]=Ro[100]=1,Oo[70]=Oo[100]=0,No[70]=No[100]=-1,ko[70]=ko[100]=1,mo[70]=mo[100]=1,yo[70]=yo[100]=0,_o[70]=_o[100]=0,So[101]=So[69]=0,Io[101]=Io[69]=1,To[101]=To[69]=0,mo[101]=mo[69]=1,yo[101]=yo[69]=0,_o[101]=_o[69]=0,Fo[149]=Fo[21]=0,zo[149]=zo[21]=1,Bo[149]=Bo[21]=1,vo[149]=vo[21]=-1,xo[149]=xo[21]=0,wo[149]=wo[21]=0,Po[86]=Po[84]=-1,Lo[86]=Lo[84]=0,Ro[86]=Ro[84]=1,Oo[86]=Oo[84]=0,No[86]=No[84]=-1,ko[86]=ko[84]=1,bo[89]=bo[81]=0,Eo[89]=Eo[81]=-1,Co[89]=Co[81]=0,Mo[89]=Mo[81]=1,Do[89]=Do[81]=0,Ao[89]=Ao[81]=1,bo[96]=bo[74]=0,Eo[96]=Eo[74]=1,Co[96]=Co[74]=0,So[96]=So[74]=-1,Io[96]=Io[74]=0,To[96]=To[74]=1,Oo[96]=Oo[74]=1,No[96]=No[74]=0,ko[96]=ko[74]=0,mo[96]=mo[74]=1,yo[96]=yo[74]=0,_o[96]=_o[74]=1,bo[24]=bo[146]=0,Eo[24]=Eo[146]=-1,Co[24]=Co[146]=1,Po[24]=Po[146]=1,Lo[24]=Lo[146]=0,Ro[24]=Ro[146]=1,Mo[24]=Mo[146]=0,Do[24]=Do[146]=1,Ao[24]=Ao[146]=1,vo[24]=vo[146]=0,xo[24]=xo[146]=-1,wo[24]=wo[146]=0,So[6]=So[164]=-1,Io[6]=Io[164]=0,To[6]=To[164]=1,Po[6]=Po[164]=-1,Lo[6]=Lo[164]=0,Ro[6]=Ro[164]=0,Fo[6]=Fo[164]=0,zo[6]=zo[164]=-1,Bo[6]=Bo[164]=1,Oo[6]=Oo[164]=1,No[6]=No[164]=0,ko[6]=ko[164]=0,Mo[129]=Mo[41]=0,Do[129]=Do[41]=1,Ao[129]=Ao[41]=1,Fo[129]=Fo[41]=0,zo[129]=zo[41]=1,Bo[129]=Bo[41]=0,mo[129]=mo[41]=-1,yo[129]=yo[41]=0,_o[129]=_o[41]=0,vo[129]=vo[41]=0,xo[129]=xo[41]=-1,wo[129]=wo[41]=0,Po[66]=Po[104]=0,Lo[66]=Lo[104]=1,Ro[66]=Ro[104]=0,Mo[66]=Mo[104]=-1,Do[66]=Do[104]=0,Ao[66]=Ao[104]=1,Oo[66]=Oo[104]=0,No[66]=No[104]=-1,ko[66]=ko[104]=0,mo[66]=mo[104]=0,yo[66]=yo[104]=-1,_o[66]=_o[104]=1,bo[144]=bo[26]=-1,Eo[144]=Eo[26]=0,Co[144]=Co[26]=0,Fo[144]=Fo[26]=1,zo[144]=zo[26]=0,Bo[144]=Bo[26]=1,Oo[144]=Oo[26]=0,No[144]=No[26]=1,ko[144]=ko[26]=1,vo[144]=vo[26]=-1,xo[144]=xo[26]=0,wo[144]=wo[26]=1,So[36]=So[134]=0,Io[36]=Io[134]=1,To[36]=To[134]=1,Po[36]=Po[134]=0,Lo[36]=Lo[134]=1,Ro[36]=Ro[134]=0,mo[36]=mo[134]=0,yo[36]=yo[134]=-1,_o[36]=_o[134]=1,vo[36]=vo[134]=1,xo[36]=xo[134]=0,wo[36]=wo[134]=0,bo[9]=bo[161]=-1,Eo[9]=Eo[161]=0,Co[9]=Co[161]=0,So[9]=So[161]=0,Io[9]=Io[161]=-1,To[9]=To[161]=0,Mo[9]=Mo[161]=1,Do[9]=Do[161]=0,Ao[9]=Ao[161]=0,Fo[9]=Fo[161]=1,zo[9]=zo[161]=0,Bo[9]=Bo[161]=1,bo[136]=0,Eo[136]=1,Co[136]=1,So[136]=0,Io[136]=1,To[136]=0,Po[136]=-1,Lo[136]=0,Ro[136]=1,Mo[136]=-1,Do[136]=0,Ao[136]=0,Fo[136]=0,zo[136]=-1,Bo[136]=0,Oo[136]=0,No[136]=-1,ko[136]=1,mo[136]=1,yo[136]=0,_o[136]=0,vo[136]=1,xo[136]=0,wo[136]=1,bo[34]=0,Eo[34]=-1,Co[34]=0,So[34]=0,Io[34]=-1,To[34]=1,Po[34]=1,Lo[34]=0,Ro[34]=0,Mo[34]=1,Do[34]=0,Ao[34]=1,Fo[34]=0,zo[34]=1,Bo[34]=1,Oo[34]=0,No[34]=1,ko[34]=0,mo[34]=-1,yo[34]=0,_o[34]=1,vo[34]=-1,xo[34]=0,wo[34]=0,bo[35]=0,Eo[35]=1,Co[35]=1,So[35]=0,Io[35]=-1,To[35]=1,Po[35]=1,Lo[35]=0,Ro[35]=0,Mo[35]=-1,Do[35]=0,Ao[35]=0,Fo[35]=0,zo[35]=-1,Bo[35]=0,Oo[35]=0,No[35]=1,ko[35]=0,mo[35]=-1,yo[35]=0,_o[35]=1,vo[35]=1,xo[35]=0,wo[35]=1,bo[153]=0,Eo[153]=1,Co[153]=1,Mo[153]=-1,Do[153]=0,Ao[153]=0,Fo[153]=0,zo[153]=-1,Bo[153]=0,vo[153]=1,xo[153]=0,wo[153]=1,So[102]=0,Io[102]=-1,To[102]=1,Po[102]=1,Lo[102]=0,Ro[102]=0,Oo[102]=0,No[102]=1,ko[102]=0,mo[102]=-1,yo[102]=0,_o[102]=1,bo[155]=0,Eo[155]=-1,Co[155]=0,Mo[155]=1,Do[155]=0,Ao[155]=1,Fo[155]=0,zo[155]=1,Bo[155]=1,vo[155]=-1,xo[155]=0,wo[155]=0,So[103]=0,Io[103]=1,To[103]=0,Po[103]=-1,Lo[103]=0,Ro[103]=1,Oo[103]=0,No[103]=-1,ko[103]=1,mo[103]=1,yo[103]=0,_o[103]=0,bo[152]=0,Eo[152]=1,Co[152]=1,Po[152]=-1,Lo[152]=0,Ro[152]=1,Mo[152]=-1,Do[152]=0,Ao[152]=0,Fo[152]=0,zo[152]=-1,Bo[152]=0,Oo[152]=0,No[152]=-1,ko[152]=1,vo[152]=1,xo[152]=0,wo[152]=1,bo[156]=0,Eo[156]=-1,Co[156]=1,Po[156]=1,Lo[156]=0,Ro[156]=1,Mo[156]=-1,Do[156]=0,Ao[156]=0,Fo[156]=0,zo[156]=-1,Bo[156]=0,Oo[156]=0,No[156]=1,ko[156]=1,vo[156]=-1,xo[156]=0,wo[156]=1,bo[137]=0,Eo[137]=1,Co[137]=1,So[137]=0,Io[137]=1,To[137]=0,Mo[137]=-1,Do[137]=0,Ao[137]=0,Fo[137]=0,zo[137]=-1,Bo[137]=0,mo[137]=1,yo[137]=0,_o[137]=0,vo[137]=1,xo[137]=0,wo[137]=1,bo[139]=0,Eo[139]=1,Co[139]=1,So[139]=0,Io[139]=-1,To[139]=0,Mo[139]=1,Do[139]=0,Ao[139]=0,Fo[139]=0,zo[139]=1,Bo[139]=0,mo[139]=-1,yo[139]=0,_o[139]=0,vo[139]=1,xo[139]=0,wo[139]=1,bo[98]=0,Eo[98]=-1,Co[98]=0,So[98]=0,Io[98]=-1,To[98]=1,Po[98]=1,Lo[98]=0,Ro[98]=0,Mo[98]=1,Do[98]=0,Ao[98]=1,Oo[98]=0,No[98]=1,ko[98]=0,mo[98]=-1,yo[98]=0,_o[98]=1,bo[99]=0,Eo[99]=1,Co[99]=0,So[99]=0,Io[99]=-1,To[99]=1,Po[99]=1,Lo[99]=0,Ro[99]=0,Mo[99]=-1,Do[99]=0,Ao[99]=1,Oo[99]=0,No[99]=-1,ko[99]=0,mo[99]=1,yo[99]=0,_o[99]=1,So[38]=0,Io[38]=-1,To[38]=1,Po[38]=1,Lo[38]=0,Ro[38]=0,Fo[38]=0,zo[38]=1,Bo[38]=1,Oo[38]=0,No[38]=1,ko[38]=0,mo[38]=-1,yo[38]=0,_o[38]=1,vo[38]=-1,xo[38]=0,wo[38]=0,So[39]=0,Io[39]=1,To[39]=1,Po[39]=-1,Lo[39]=0,Ro[39]=0,Fo[39]=0,zo[39]=-1,Bo[39]=1,Oo[39]=0,No[39]=1,ko[39]=0,mo[39]=-1,yo[39]=0,_o[39]=1,vo[39]=1,xo[39]=0,wo[39]=0;var rC=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},iC=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},oC=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},sC=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},aC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},uC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},lC=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},cC=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},Tr=[],Er=[],Kr=[],Hr=[],Ei=[],yi=[],Uo=[],Wo=[];Hr[1]=Ei[1]=18,Hr[169]=Ei[169]=18,Kr[4]=Er[4]=12,Kr[166]=Er[166]=12,Tr[16]=Wo[16]=4,Tr[154]=Wo[154]=4,yi[64]=Uo[64]=22,yi[106]=Uo[106]=22,Kr[2]=yi[2]=17,Hr[2]=Ei[2]=18,Kr[168]=yi[168]=17,Hr[168]=Ei[168]=18,Tr[8]=Hr[8]=9,Er[8]=Kr[8]=12,Tr[162]=Hr[162]=9,Er[162]=Kr[162]=12,Tr[32]=Wo[32]=4,Er[32]=Uo[32]=1,Tr[138]=Wo[138]=4,Er[138]=Uo[138]=1,Ei[128]=Wo[128]=21,yi[128]=Uo[128]=22,Ei[42]=Wo[42]=21,yi[42]=Uo[42]=22,Er[5]=Ei[5]=14,Er[165]=Ei[165]=14,Kr[20]=Wo[20]=6,Kr[150]=Wo[150]=6,Tr[80]=yi[80]=11,Tr[90]=yi[90]=11,Hr[65]=Uo[65]=3,Hr[105]=Uo[105]=3,Tr[160]=yi[160]=11,Er[160]=Ei[160]=14,Tr[10]=yi[10]=11,Er[10]=Ei[10]=14,Kr[130]=Wo[130]=6,Hr[130]=Uo[130]=3,Kr[40]=Wo[40]=6,Hr[40]=Uo[40]=3,Er[101]=Uo[101]=1,Er[69]=Uo[69]=1,Ei[149]=Wo[149]=21,Ei[21]=Wo[21]=21,Kr[86]=yi[86]=17,Kr[84]=yi[84]=17,Tr[89]=Hr[89]=9,Tr[81]=Hr[81]=9,Tr[96]=Uo[96]=0,Er[96]=yi[96]=15,Tr[74]=Uo[74]=0,Er[74]=yi[74]=15,Tr[24]=Kr[24]=8,Hr[24]=Wo[24]=7,Tr[146]=Kr[146]=8,Hr[146]=Wo[146]=7,Er[6]=yi[6]=15,Kr[6]=Ei[6]=16,Er[164]=yi[164]=15,Kr[164]=Ei[164]=16,Hr[129]=Wo[129]=7,Ei[129]=Uo[129]=20,Hr[41]=Wo[41]=7,Ei[41]=Uo[41]=20,Kr[66]=Uo[66]=2,Hr[66]=yi[66]=19,Kr[104]=Uo[104]=2,Hr[104]=yi[104]=19,Tr[144]=Ei[144]=10,yi[144]=Wo[144]=23,Tr[26]=Ei[26]=10,yi[26]=Wo[26]=23,Er[36]=Wo[36]=5,Kr[36]=Uo[36]=2,Er[134]=Wo[134]=5,Kr[134]=Uo[134]=2,Tr[9]=Ei[9]=10,Er[9]=Hr[9]=13,Tr[161]=Ei[161]=10,Er[161]=Hr[161]=13,Er[37]=Wo[37]=5,Ei[37]=Uo[37]=20,Er[133]=Wo[133]=5,Ei[133]=Uo[133]=20,Kr[148]=Ei[148]=16,yi[148]=Wo[148]=23,Kr[22]=Ei[22]=16,yi[22]=Wo[22]=23,Tr[82]=Kr[82]=8,Hr[82]=yi[82]=19,Tr[88]=Kr[88]=8,Hr[88]=yi[88]=19,Tr[73]=Uo[73]=0,Er[73]=Hr[73]=13,Tr[97]=Uo[97]=0,Er[97]=Hr[97]=13,Tr[145]=Hr[145]=9,Ei[145]=Wo[145]=21,Tr[25]=Hr[25]=9,Ei[25]=Wo[25]=21,Er[70]=Uo[70]=1,Kr[70]=yi[70]=17,Er[100]=Uo[100]=1,Kr[100]=yi[100]=17,Tr[34]=Hr[34]=9,Er[34]=Kr[34]=12,Ei[34]=Wo[34]=21,yi[34]=Uo[34]=22,Tr[136]=Wo[136]=4,Er[136]=Uo[136]=1,Kr[136]=yi[136]=17,Hr[136]=Ei[136]=18,Tr[35]=Wo[35]=4,Er[35]=Kr[35]=12,Hr[35]=Ei[35]=18,yi[35]=Uo[35]=22,Tr[153]=Wo[153]=4,Hr[153]=Ei[153]=18,Er[102]=Kr[102]=12,yi[102]=Uo[102]=22,Tr[155]=Hr[155]=9,Ei[155]=Wo[155]=23,Er[103]=Uo[103]=1,Kr[103]=yi[103]=17,Tr[152]=Wo[152]=4,Kr[152]=yi[152]=17,Hr[152]=Ei[152]=18,Tr[156]=Kr[156]=8,Hr[156]=Ei[156]=18,yi[156]=Wo[156]=23,Tr[137]=Wo[137]=4,Er[137]=Uo[137]=1,Hr[137]=Ei[137]=18,Tr[139]=Wo[139]=4,Er[139]=Hr[139]=13,Ei[139]=Uo[139]=20,Tr[98]=Hr[98]=9,Er[98]=Kr[98]=12,yi[98]=Uo[98]=22,Tr[99]=Uo[99]=0,Er[99]=Kr[99]=12,Hr[99]=yi[99]=19,Er[38]=Kr[38]=12,Ei[38]=Wo[38]=21,yi[38]=Uo[38]=22,Er[39]=Wo[39]=5,Kr[39]=Ei[39]=16,yi[39]=Uo[39]=22;var dr=[];function tx(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function fC(e,t){return e[0]*t[1]-t[0]*e[1]}function j2(e,t,n){var r=[],o=function TB(e,t){return W1(NE(e,t))}(t,n),c=vf(e),d=[];return c.forEach(function(_,E){if(E!==c.length-1){var C=function a6(e,t,n){var r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]));return[[e[0]+n*(t[1]-e[1])/r,e[1]+n*(e[0]-t[0])/r],[t[0]+n*(t[1]-e[1])/r,t[1]+n*(e[0]-t[0])/r]]}(_,c[E+1],o);if(r.push(C),E>0){var D=r[E-1],L=function o6(e,t){return!function i6(e,t){return 0===fC(tx(e),tx(t))}(e,t)&&function r6(e,t){var n=e[0],r=tx(e),o=t[0],c=tx(t),d=fC(r,c),_=function t6(e,t){return[e[0]-t[0],e[1]-t[1]]}(o,n),D=function e6(e,t){return[e[0]+t[0],e[1]+t[1]]}(n,function n6(e,t){return[e*t[0],e*t[1]]}(fC(_,c)/d,r));return D}(e,t)}(C,D);!1!==L&&(D[1]=L,C[0]=L),d.push(D[0]),E===c.length-2&&(d.push(C[0]),d.push(C[1]))}2===c.length&&(d.push(C[0]),d.push(C[1]))}}),jh(d,e.properties)}dr[1]=dr[169]=rC,dr[4]=dr[166]=iC,dr[16]=dr[154]=oC,dr[64]=dr[106]=sC,dr[168]=dr[2]=aC,dr[162]=dr[8]=uC,dr[138]=dr[32]=lC,dr[42]=dr[128]=cC,dr[5]=dr[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},dr[20]=dr[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},dr[80]=dr[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},dr[65]=dr[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},dr[160]=dr[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},dr[130]=dr[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},dr[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},dr[101]=dr[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},dr[149]=dr[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},dr[86]=dr[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},dr[89]=dr[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},dr[96]=dr[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},dr[24]=dr[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},dr[6]=dr[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},dr[129]=dr[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},dr[66]=dr[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},dr[144]=dr[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},dr[36]=dr[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},dr[9]=dr[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},dr[37]=dr[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},dr[148]=dr[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},dr[82]=dr[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},dr[73]=dr[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},dr[145]=dr[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},dr[70]=dr[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},dr[34]=function(e){return[cC(e),uC(e)]},dr[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},dr[136]=function(e){return[lC(e),aC(e)]},dr[153]=function(e){return[oC(e),rC(e)]},dr[102]=function(e){return[iC(e),sC(e)]},dr[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},dr[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},dr[152]=function(e){return[oC(e),aC(e)]},dr[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},dr[137]=function(e){return[lC(e),rC(e)]},dr[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},dr[98]=function(e){return[uC(e),sC(e)]},dr[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},dr[38]=function(e){return[iC(e),cC(e)]},dr[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};const V2=function s6(e,t,n){if(!function MB(e){return!!e&&e.constructor===Object}(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var o=zE(e),c=e.properties;switch(o){case"LineString":return j2(e,t,r);case"MultiLineString":var d=[];return Zd(e,function(_){d.push(j2(_,t,r).geometry.coordinates)}),function ZD(e,t,n){return void 0===n&&(n={}),Bh({type:"MultiLineString",coordinates:e},t,n)}(d,c);default:throw new Error("geometry "+o+" is not supported")}};function dC(e,t,n){return function u6(e){return(e>0)-(e<0)||+e}((t[0]-e[0])*(n[1]-t[1])-(n[0]-t[0])*(t[1]-e[1]))}function G2(e,t){return t.geometry.coordinates[0].every(function(n){return r2(Uh(n),e)})}const $2=function(){function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(t){return t.join(",")},e.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(n){return n.from.id!==t.from.id})},e.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(n){return n.to.id!==t.to.id})},e.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(n,r){var o=n.to,c=r.to;if(o.coordinates[0]-t.coordinates[0]>=0&&c.coordinates[0]-t.coordinates[0]<0)return 1;if(o.coordinates[0]-t.coordinates[0]<0&&c.coordinates[0]-t.coordinates[0]>=0)return-1;if(o.coordinates[0]-t.coordinates[0]==0&&c.coordinates[0]-t.coordinates[0]==0)return o.coordinates[1]-t.coordinates[1]>=0||c.coordinates[1]-t.coordinates[1]>=0?o.coordinates[1]-c.coordinates[1]:c.coordinates[1]-o.coordinates[1];var d=dC(t.coordinates,o.coordinates,c.coordinates);return d<0?1:d>0?-1:Math.pow(o.coordinates[0]-t.coordinates[0],2)+Math.pow(o.coordinates[1]-t.coordinates[1],2)-(Math.pow(c.coordinates[0]-t.coordinates[0],2)+Math.pow(c.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},e.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},e}(),d6=function(){function e(t,n){this.from=t,this.to=n,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return jh([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(t){return dC(t.from.coordinates,t.to.coordinates,this.to.coordinates)},e}(),g6=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},e.prototype.get=function(t){return this.edges[t]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(t){this.edges.forEach(t)},e.prototype.map=function(t){return this.edges.map(t)},e.prototype.some=function(t){return this.edges.some(t)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var t=this,n=this.edges.reduce(function(d,_,E){return _.from.coordinates[1]>t.edges[d].from.coordinates[1]&&(d=E),d},0),r=(0===n?this.length:n)-1,o=(n+1)%this.length,c=dC(this.edges[r].from.coordinates,this.edges[n].from.coordinates,this.edges[o].from.coordinates);return 0===c?this.edges[r].from.coordinates[0]>this.edges[o].from.coordinates[0]:c>0},e.prototype.toMultiPoint=function(){return function WD(e,t,n){return void 0===n&&(n={}),Bh({type:"MultiPoint",coordinates:e},t,n)}(this.edges.map(function(t){return t.from.coordinates}))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(n){return n.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=Z1([t])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function d4(e){return function f4(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),o=Number(e[2]),c=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var d=[n,r];return Z1([[d,[o,r],[o,c],[n,c],d]],t.properties,{bbox:e,id:t.id})}(JD(e))}(this.toPolygon())},e.findEdgeRingContaining=function(t,n){var o,c,r=t.getEnvelope();return n.forEach(function(d){var _=d.getEnvelope();if(c&&(o=c.getEnvelope()),!function l6(e,t){var n=e.geometry.coordinates[0].map(function(d){return d[0]}),r=e.geometry.coordinates[0].map(function(d){return d[1]}),o=t.geometry.coordinates[0].map(function(d){return d[0]}),c=t.geometry.coordinates[0].map(function(d){return d[1]});return Math.max.apply(null,n)===Math.max.apply(null,o)&&Math.max.apply(null,r)===Math.max.apply(null,c)&&Math.min.apply(null,n)===Math.min.apply(null,o)&&Math.min.apply(null,r)===Math.min.apply(null,c)}(_,r)&&G2(_,r)){for(var E=t.map(function(te){return te.from.coordinates}),C=void 0,D=function(te){d.some(function(ne){return function c6(e,t){return e[0]===t[0]&&e[1]===t[1]}(te,ne.from.coordinates)})||(C=te)},L=0,N=E;L<N.length;L++)D(N[L]);C&&d.inside(Uh(C))&&(!c||G2(o,_))&&(c=d)}}),c},e.prototype.inside=function(t){return r2(t,this.toPolygon())},e}();function Q2(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(t){!function m6(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var n=new e;return Zd(t,function(r){(function kB(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function DB(e,t,n,r){var o=n;mm(e,function(c,d,_,E,C){o=0===d&&void 0===n?c:t(o,c,d,_,E,C)},r)}(r,function(o,c){if(o){var d=n.getNode(o),_=n.getNode(c);n.addEdge(d,_)}return c})}),n},e.prototype.getNode=function(t){var n=$2.buildId(t),r=this.nodes[n];return r||(r=this.nodes[n]=new $2(t)),r},e.prototype.addEdge=function(t,n){var r=new d6(t,n),o=r.getSymetric();this.edges.push(r),this.edges.push(o)},e.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(n){return t.nodes[n]}).forEach(function(n){return t._removeIfDangle(n)})},e.prototype._removeIfDangle=function(t){var n=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(o){return o.to});this.removeNode(t),r.forEach(function(o){return n._removeIfDangle(o)})}},e.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(n){n.label===n.symetric.label&&(t.removeEdge(n.symetric),t.removeEdge(n))})},e.prototype._computeNextCWEdges=function(t){var n=this;typeof t>"u"?Object.keys(this.nodes).forEach(function(r){return n._computeNextCWEdges(n.nodes[r])}):t.getOuterEdges().forEach(function(r,o){t.getOuterEdge((0===o?t.getOuterEdges().length:o)-1).symetric.next=r})},e.prototype._computeNextCCWEdges=function(t,n){for(var o,c,r=t.getOuterEdges(),d=r.length-1;d>=0;--d){var _=r[d],E=_.symetric,C=void 0,D=void 0;_.label===n&&(C=_),E.label===n&&(D=E),C&&D&&(D&&(c=D),C&&(c&&(c.next=C,c=void 0),o||(o=C)))}c&&(c.next=o)},e.prototype._findLabeledEdgeRings=function(){var t=[],n=0;return this.edges.forEach(function(r){if(!(r.label>=0)){t.push(r);var o=r;do{o.label=n,o=o.next}while(!r.isEqual(o));n++}}),t},e.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){t._findIntersectionNodes(r).forEach(function(o){t._computeNextCCWEdges(o,r.label)})});var n=[];return this.edges.forEach(function(r){r.ring||n.push(t._findEdgeRing(r))}),n},e.prototype._findIntersectionNodes=function(t){var n=[],r=t,o=function(){var c=0;r.from.getOuterEdges().forEach(function(d){d.label===t.label&&++c}),c>1&&n.push(r.from),r=r.next};do{o()}while(!t.isEqual(r));return n},e.prototype._findEdgeRing=function(t){var n=t,r=new g6;do{r.push(n),n.ring=r,n=n.next}while(!t.isEqual(n));return r},e.prototype.removeNode=function(t){var n=this;t.getOuterEdges().forEach(function(r){return n.removeEdge(r)}),t.innerEdges.forEach(function(r){return n.removeEdge(r)}),delete this.nodes[t.id]},e.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(n){return!n.isEqual(t)}),t.deleteEdge()}}(),He(5013),He(7470),He(9475);var nx={search:function(e,t,n,r){e.cleanDirty();var o=(r=r||{}).heuristic||nx.heuristics.manhattan,c=r.closest||!1,d=function L6(){return new eA(function(e){return e.f})}(),_=t;for(t.h=o(t,n),d.push(t);d.size()>0;){var E=d.pop();if(E===n)return Q2(E);E.closed=!0;for(var C=e.neighbors(E),D=0,L=C.length;D<L;++D){var N=C[D];if(!N.closed&&!N.isWall()){var B=E.g+N.getCost(E),te=N.visited;(!te||B<N.g)&&(N.visited=!0,N.parent=E,N.h=N.h||o(N,n),N.g=B,N.f=N.g+N.h,e.markDirty(N),c&&(N.h<_.h||N.h===_.h&&N.g<_.g)&&(_=N),te?d.rescoreElement(N):d.push(N))}}}return c?Q2(_):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var r=Math.sqrt(2),o=Math.abs(t.x-e.x),c=Math.abs(t.y-e.y);return 1*(o+c)+(r-2)*Math.min(o,c)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function _m(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,o=e[n];r<o.length;r++){var c=new rx(n,r,o[r]);this.grid[n][r]=c,this.nodes.push(c)}}this.init()}function rx(e,t,n){this.x=e,this.y=t,this.weight=n}function eA(e){this.content=[],this.scoreFunction=e}function gC(){this._=null}function ix(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Y_(e,t){var n=t,r=t.R,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function K_(e,t){var n=t,r=t.L,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function tA(e){for(;e.L;)e=e.L;return e}_m.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)nx.cleanNode(this.nodes[e])},_m.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)nx.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},_m.prototype.markDirty=function(e){this.dirtyNodes.push(e)},_m.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,o=this.grid;return o[n-1]&&o[n-1][r]&&t.push(o[n-1][r]),o[n+1]&&o[n+1][r]&&t.push(o[n+1][r]),o[n]&&o[n][r-1]&&t.push(o[n][r-1]),o[n]&&o[n][r+1]&&t.push(o[n][r+1]),this.diagonal&&(o[n-1]&&o[n-1][r-1]&&t.push(o[n-1][r-1]),o[n+1]&&o[n+1][r-1]&&t.push(o[n+1][r-1]),o[n-1]&&o[n-1][r+1]&&t.push(o[n-1][r+1]),o[n+1]&&o[n+1][r+1]&&t.push(o[n+1][r+1])),t},_m.prototype.toString=function(){for(var n,r,o,c,e=[],t=this.grid,d=0,_=t.length;d<_;d++){for(n=[],o=0,c=(r=t[d]).length;o<c;o++)n.push(r[o].weight);e.push(n.join(" "))}return e.join("\n")},rx.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},rx.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},rx.prototype.isWall=function(){return 0===this.weight},eA.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var _,o=e+1<<1,c=o-1,d=null;if(c<t&&(_=this.scoreFunction(this.content[c]))<r&&(d=c),o<t&&this.scoreFunction(this.content[o])<(null===d?r:_)&&(d=o),null===d)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}},gC.prototype={constructor:gC,insert:function(e,t){var n,r,o;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=tA(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(o=r.R)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.R&&(Y_(this,n),n=(e=n).U),n.C=!1,r.C=!0,K_(this,r)):(o=r.L)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.L&&(K_(this,n),n=(e=n).U),n.C=!1,r.C=!0,Y_(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var n,c,d,t=e.U,r=e.L,o=e.R;if(c=r?o?tA(o):r:o,t?t.L===e?t.L=c:t.R=c:this._=c,r&&o?(d=c.C,c.C=e.C,c.L=r,r.U=c,c!==o?(t=c.U,c.U=e.U,t.L=e=c.R,c.R=o,o.U=c):(c.U=t,t=c,e=c.R)):(d=e.C,e=c),e&&(e.U=t),!d){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===t.L){if((n=t.R).C&&(n.C=!1,t.C=!0,Y_(this,t),n=t.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,K_(this,n),n=t.R),n.C=t.C,t.C=n.R.C=!1,Y_(this,t),e=this._;break}}else if((n=t.L).C&&(n.C=!1,t.C=!0,K_(this,t),n=t.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,Y_(this,n),n=t.L),n.C=t.C,t.C=n.L.C=!1,K_(this,t),e=this._;break}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};const nA=gC;function J_(e,t,n,r){var o=[null,null],c=Rl.push(o)-1;return o.left=e,o.right=t,n&&ox(o,e,t,n),r&&ox(o,t,e,r),Gc[e.index].halfedges.push(c),Gc[t.index].halfedges.push(c),o}function Q_(e,t,n){var r=[t,n];return r.left=e,r}function ox(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function O6(e,t,n,r,o){var ne,c=e[0],d=e[1],_=c[0],E=c[1],L=0,N=1,B=d[0]-_,te=d[1]-E;if(ne=t-_,B||!(ne>0)){if(ne/=B,B<0){if(ne<L)return;ne<N&&(N=ne)}else if(B>0){if(ne>N)return;ne>L&&(L=ne)}if(ne=r-_,B||!(ne<0)){if(ne/=B,B<0){if(ne>N)return;ne>L&&(L=ne)}else if(B>0){if(ne<L)return;ne<N&&(N=ne)}if(ne=n-E,te||!(ne>0)){if(ne/=te,te<0){if(ne<L)return;ne<N&&(N=ne)}else if(te>0){if(ne>N)return;ne>L&&(L=ne)}if(ne=o-E,te||!(ne<0)){if(ne/=te,te<0){if(ne>N)return;ne>L&&(L=ne)}else if(te>0){if(ne<L)return;ne<N&&(N=ne)}return!(L>0)&&!(N<1)||(L>0&&(e[0]=[_+L*B,E+L*te]),N<1&&(e[1]=[_+N*B,E+N*te])),!0}}}}}function N6(e,t,n,r,o){var c=e[1];if(c)return!0;var ne,Pe,d=e[0],_=e.left,E=e.right,C=_[0],D=_[1],L=E[0],N=E[1],B=(C+L)/2;if(N===D){if(B<t||B>=r)return;if(C>L){if(d){if(d[1]>=o)return}else d=[B,n];c=[B,o]}else{if(d){if(d[1]<n)return}else d=[B,o];c=[B,n]}}else if(Pe=(D+N)/2-(ne=(C-L)/(N-D))*B,ne<-1||ne>1)if(C>L){if(d){if(d[1]>=o)return}else d=[(n-Pe)/ne,n];c=[(o-Pe)/ne,o]}else{if(d){if(d[1]<n)return}else d=[(o-Pe)/ne,o];c=[(n-Pe)/ne,n]}else if(D<N){if(d){if(d[0]>=r)return}else d=[t,ne*t+Pe];c=[r,ne*r+Pe]}else{if(d){if(d[0]<t)return}else d=[r,ne*r+Pe];c=[t,ne*t+Pe]}return e[0]=d,e[1]=c,!0}function z6(e,t){var n=e.site,r=t.left,o=t.right;return n===o&&(o=r,r=n),o?Math.atan2(o[1]-r[1],o[0]-r[0]):(n===r?(r=t[1],o=t[0]):(r=t[0],o=t[1]),Math.atan2(r[0]-o[0],o[1]-r[1]))}function rA(e,t){return t[+(t.left!==e.site)]}function B6(e,t){return t[+(t.left===e.site)]}var mC,iA=[];function V6(){ix(this),this.x=this.y=this.arc=this.site=this.cy=null}function vm(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,o=e.site,c=n.site;if(r!==c){var d=o[0],_=o[1],E=r[0]-d,C=r[1]-_,D=c[0]-d,L=c[1]-_,N=2*(E*L-C*D);if(!(N>=-X6)){var B=E*E+C*C,te=D*D+L*L,ne=(L*B-C*te)/N,Pe=(E*te-D*B)/N,xe=iA.pop()||new V6;xe.arc=e,xe.site=o,xe.x=ne+d,xe.y=(xe.cy=Pe+_)+Math.sqrt(ne*ne+Pe*Pe),e.circle=xe;for(var ae=null,ce=ev._;ce;)if(xe.y<ce.y||xe.y===ce.y&&xe.x<=ce.x){if(!ce.L){ae=ce.P;break}ce=ce.L}else{if(!ce.R){ae=ce;break}ce=ce.R}ev.insert(ae,xe),ae||(mC=xe)}}}}function xm(e){var t=e.circle;t&&(t.P||(mC=t.N),ev.remove(t),iA.push(t),ix(t),e.circle=null)}var oA=[];function G6(){ix(this),this.edge=this.site=this.circle=null}function sA(e){var t=oA.pop()||new G6;return t.site=e,t}function yC(e){xm(e),wm.remove(e),oA.push(e),ix(e)}function $6(e){var t=e.circle,n=t.x,r=t.cy,o=[n,r],c=e.P,d=e.N,_=[e];yC(e);for(var E=c;E.circle&&Math.abs(n-E.circle.x)<$a&&Math.abs(r-E.circle.cy)<$a;)c=E.P,_.unshift(E),yC(E),E=c;_.unshift(E),xm(E);for(var C=d;C.circle&&Math.abs(n-C.circle.x)<$a&&Math.abs(r-C.circle.cy)<$a;)d=C.N,_.push(C),yC(C),C=d;_.push(C),xm(C);var L,D=_.length;for(L=1;L<D;++L)ox((C=_[L]).edge,(E=_[L-1]).site,C.site,o);(C=_[D-1]).edge=J_((E=_[0]).site,C.site,null,o),vm(E),vm(C)}function q6(e){for(var r,o,c,d,t=e[0],n=e[1],_=wm._;_;)if((c=aA(_,n)-t)>$a)_=_.L;else{if(!((d=t-H6(_,n))>$a)){c>-$a?(r=_.P,o=_):d>-$a?(r=_,o=_.N):r=o=_;break}if(!_.R){r=_;break}_=_.R}!function F6(e){Gc[e.index]={site:e,halfedges:[]}}(e);var E=sA(e);if(wm.insert(r,E),r||o){if(r===o)return xm(r),o=sA(r.site),wm.insert(E,o),E.edge=o.edge=J_(r.site,E.site),vm(r),void vm(o);if(!o)return void(E.edge=J_(r.site,E.site));xm(r),xm(o);var C=r.site,D=C[0],L=C[1],N=e[0]-D,B=e[1]-L,te=o.site,ne=te[0]-D,Pe=te[1]-L,xe=2*(N*Pe-B*ne),ae=N*N+B*B,ce=ne*ne+Pe*Pe,tt=[(Pe*ae-B*ce)/xe+D,(N*ce-ne*ae)/xe+L];ox(o.edge,C,te,tt),E.edge=J_(C,e,null,tt),o.edge=J_(e,te,null,tt),vm(r),vm(o)}}function aA(e,t){var n=e.site,r=n[0],o=n[1],c=o-t;if(!c)return r;var d=e.P;if(!d)return-1/0;var _=(n=d.site)[0],E=n[1],C=E-t;if(!C)return _;var D=_-r,L=1/c-1/C,N=D/C;return L?(-N+Math.sqrt(N*N-2*L*(D*D/(-2*C)-E+C/2+o-c/2)))/L+r:(r+_)/2}function H6(e,t){var n=e.N;if(n)return aA(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var wm,Gc,ev,Rl,$a=1e-6,X6=1e-12;function Z6(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function W6(e,t){return t[1]-e[1]||t[0]-e[0]}function uA(e,t){var r,o,c,n=e.sort(W6).pop();for(Rl=[],Gc=new Array(e.length),wm=new nA,ev=new nA;;)if(c=mC,n&&(!c||n[1]<c.y||n[1]===c.y&&n[0]<c.x))(n[0]!==r||n[1]!==o)&&(q6(n),r=n[0],o=n[1]),n=e.pop();else{if(!c)break;$6(c.arc)}if(function U6(){for(var n,r,o,c,e=0,t=Gc.length;e<t;++e)if((n=Gc[e])&&(c=(r=n.halfedges).length)){var d=new Array(c),_=new Array(c);for(o=0;o<c;++o)d[o]=o,_[o]=z6(n,Rl[r[o]]);for(d.sort(function(E,C){return _[C]-_[E]}),o=0;o<c;++o)_[o]=r[d[o]];for(o=0;o<c;++o)r[o]=_[o]}}(),t){var d=+t[0][0],_=+t[0][1],E=+t[1][0],C=+t[1][1];(function k6(e,t,n,r){for(var c,o=Rl.length;o--;)N6(c=Rl[o],e,t,n,r)&&O6(c,e,t,n,r)&&(Math.abs(c[0][0]-c[1][0])>$a||Math.abs(c[0][1]-c[1][1])>$a)||delete Rl[o]})(d,_,E,C),function j6(e,t,n,r){var c,d,_,E,C,D,L,N,B,te,ne,Pe,o=Gc.length,xe=!0;for(c=0;c<o;++c)if(d=Gc[c]){for(_=d.site,E=(C=d.halfedges).length;E--;)Rl[C[E]]||C.splice(E,1);for(E=0,D=C.length;E<D;)ne=(te=B6(d,Rl[C[E]]))[0],Pe=te[1],N=(L=rA(d,Rl[C[++E%D]]))[0],B=L[1],(Math.abs(ne-N)>$a||Math.abs(Pe-B)>$a)&&(C.splice(E,0,Rl.push(Q_(_,te,Math.abs(ne-e)<$a&&r-Pe>$a?[e,Math.abs(N-e)<$a?B:r]:Math.abs(Pe-r)<$a&&n-ne>$a?[Math.abs(B-r)<$a?N:n,r]:Math.abs(ne-n)<$a&&Pe-t>$a?[n,Math.abs(N-n)<$a?B:t]:Math.abs(Pe-t)<$a&&ne-e>$a?[Math.abs(B-t)<$a?N:e,t]:null))-1),++D);D&&(xe=!1)}if(xe){var ae,ce,tt,ct=1/0;for(c=0,xe=null;c<o;++c)(d=Gc[c])&&(tt=(ae=(_=d.site)[0]-e)*ae+(ce=_[1]-t)*ce)<ct&&(ct=tt,xe=d);if(xe){var Pt=[e,t],Nt=[e,r],tn=[n,r],nt=[n,t];xe.halfedges.push(Rl.push(Q_(_=xe.site,Pt,Nt))-1,Rl.push(Q_(_,Nt,tn))-1,Rl.push(Q_(_,tn,nt))-1,Rl.push(Q_(_,nt,Pt))-1)}}for(c=0;c<o;++c)(d=Gc[c])&&(d.halfedges.length||delete Gc[c])}(d,_,E,C)}this.edges=Rl,this.cells=Gc,wm=ev=Rl=Gc=null}function Wd(){return new sx}function sx(){this.reset()}uA.prototype={constructor:uA,polygons:function(){var e=this.edges;return this.cells.map(function(t){var n=t.halfedges.map(function(r){return rA(t,e[r])});return n.data=t.site.data,n})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(n,r){if(_=(c=n.halfedges).length)for(var c,_,E,o=n.site,d=-1,C=t[c[_-1]],D=C.left===o?C.right:C.left;++d<_;)E=D,D=(C=t[c[d]]).left===o?C.right:C.left,E&&D&&r<E.index&&r<D.index&&Z6(o,E,D)<0&&e.push([o.data,E.data,D.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,n){for(var o,_,r=this,c=r._found||0,d=r.cells.length;!(_=r.cells[c]);)if(++c>=d)return null;var E=e-_.site[0],C=t-_.site[1],D=E*E+C*C;do{_=r.cells[o=c],c=null,_.halfedges.forEach(function(L){var N=r.edges[L],B=N.left;if(B!==_.site&&B||(B=N.right)){var te=e-B[0],ne=t-B[1],Pe=te*te+ne*ne;Pe<D&&(D=Pe,c=B.index)}})}while(null!==c);return r._found=o,null==n||D<=n*n?_.site:null}},He(9855),He(770),sx.prototype={constructor:sx,reset:function(){this.s=this.t=0},add:function(e){vA(ax,e,this.t),vA(this,ax.s,this.s),this.s?this.t+=ax.t:this.s=ax.t},valueOf:function(){return this.s}};var ax=new sx;function vA(e,t,n){var r=e.s=t+n,o=r-t;e.t=t-(r-o)+(n-o)}var Ja=Math.PI,bc=Ja/2,bm=2*Ja,Oa=Ja/180,tv=(Math,Math.atan),Em=Math.atan2,Cs=Math.cos,Yo=(Math,Math,Math,Math,Math,Math.sin),od=(Math,Math.sqrt);Math;function Cm(e){return e>1?bc:e<-1?-bc:Math.asin(e)}function PC(e,t){return[e>Ja?e-bm:e<-Ja?e+bm:e,t]}function HA(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Wd(),Wd(),Wd(),PC.invert=PC,function TU(e){1===e.length&&(e=function MU(e){return function(t,n){return HA(e(t),n)}}(e))}(HA),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Wd();function YC(){}function _P(e){return function(t,n){var r=Cs(t),o=Cs(n),c=e(r*o);return[c*o*Yo(t),c*Yo(n)]}}function hv(e){return function(t,n){var r=od(t*t+n*n),o=e(r),c=Yo(o),d=Cs(o);return[Em(t*c,r*d),Cm(r&&n*c/r)]}}function JC(e,t){return[e,t]}Wd(),Wd(),Wd(),Wd(),function gP(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}(4.5),YC.prototype={constructor:YC,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Cs(30*Oa),function mP(e){return function(t){var n=new YC;for(var r in e)n[r]=e[r];return n.stream=t,n}}({point:function(e,t){this.stream.point(e*Oa,t*Oa)}}),_P(function(e){return od(2/(1+e))}).invert=hv(function(e){return 2*Cm(e/2)}),_P(function(e){return(e=function lU(e){return e>1?0:e<-1?Ja:Math.acos(e)}(e))&&e/Yo(e)}).invert=hv(function(e){return e}),JC.invert=JC,hv(tv),hv(Cm),hv(function(e){return 2*tv(e)});class Dm{constructor(){this.StaticResponsePath=[83.54592383995985,83.66604339094793,85.7233517978466,89.32372374481614,91.04418973655731,92.98289938848714,95.3677139742127,97.20158198158269,99.9977251166281,101.0136902480268,101.53611449006354,103.17964870998074,105.47952193583274,105.81562278287697,107.77017433246105,112.37052259177301,115.34722151762193,116.9826096413085,116.89600000023825,117.2085122003029,118.61518398344755,121.02803947102316,122.94015461237213,125.25119403364941,126.3546550978425,129.35773341664057,135.73747352721838,137.45696217567652,135.66942265080777,135.43113444140684,135.57729992807512,135.85339509155406,135.9206543484332,135.64389576618433,135.44337844896464,134.1951851617246,132.3355643845925,135.272216603538,137.82543000606438,141.29258740846504,140.13645524071362,139.26357700003066,141.07335452286245,143.9437645784251,142.44702003201496,143.01461074849522,142.579383399436,144.38194988405223,144.56343091244509,144.78798498369304,145.26871171758813,145.7374102677896,146.20411818299294,146.59360224427564,147.26271135960164,148.61135364922671,149.58585972931263,152.08393340830807,153.97959210014034,155.66931507086738,156.0769607781915,154.80205073061438,154.64873119122956,156.06025272007264,154.6690303278766,156.47867482779586,158.39990128706444,158.45348540477866,157.3040081616003,157.56535920824928,160.57822213634017,163.65572062158452,165.05181936718904,165.49193466366157,163.714863807246,167.343791200007,166.89316043812914,165.46018610336588,165.9352888453371,166.2542405121372,166.16149095691517,164.09418268195657,163.6690203024068,168.1920862622679,166.0508464706585,166.31442741389696,167.55717758222744,169.45074358467068,170.6106054071749,170.09592535725278,168.44520424174974,171.63947931046286,171.03663678749396,175.00095710831857,176.0120696909829,175.34137627532579,174.70280337474378,174.53385024923773,174.98008566321278,177.31513516938426],this.StaticResponseCrossSection=[123.01793489999773,123.47380200902535,123.92966911585381,124.3855362172335,124.8414033136255,125.29727040671742,125.75313749617635,126.20900458098049,126.66487165977378,127.12073873644295,127.57660580845732,128.03247287604745,128.48833994056668,128.94420699899865,129.4000740551537,129.855941106729,130.31180815301104,130.7676751957365,131.22354223388356,131.67940926888468,132.13527629859118,132.5911433238707,133.04701034600566,133.4964034392993,133.93403829469185,134.3715524280052,134.80894583932346,135.24621853027654,135.6833704992858,136.12040174689557,136.55731227577343,136.9941020853823,137.4307711750232,137.86731954660456,138.30374719991136,138.74005413592954,139.1762403545709,139.61230585841946,140.04825064367617,140.48407471440495,140.9197780689731,141.3553607105502,141.7908226376504,142.2261638500151,142.6613843494089,143.09648413575033,143.53146320947153,143.96632157306902,144.40105922366533,144.8356761630683,145.27017239309347,145.70454791287963,146.13880272424504,146.57293682500918,147.03999141350045,147.54646466255076,148.0530586212511,148.5597732875848,149.06660866184808,149.5735647459971,150.08064153545618,150.5878390322516,151.09515723743368,151.60259614656422,152.11015576152428,152.61783608112214,153.12563710484108,153.63355883380595,154.14160126509125,154.6497643999189,155.15804823765976,155.6664527763918,156.17497801793255,156.6836239603749,157.19239060381625,157.70127794548992,158.21028598725943,158.71941473044038,159.22866417029928,159.73803431055705,160.24752514659926,160.75713668129384,161.2668689115459,161.77672183949835,162.28669546212393,162.77879638131,163.25664928526055,163.7346228836427,164.21271717562632,164.6909321626637,165.1692678393532,165.64772421097751,166.126301272637,166.6049990275229,167.083817471397,167.56275660697116,168.04181643217936,168.52099694739337,169.00029815034057,169.47972004234413]}getElevation(t){const n=jh(t),r=KE(n);let o=0,c=r/100;return Array(100).fill(void 0).map(()=>{const E=YE(n,o).geometry.coordinates;return o+=c,[E[1],E[0]]}),Promise.resolve([])}}Dm.\u0275fac=function(t){return new(t||Dm)},Dm.\u0275prov=bn({token:Dm,factory:Dm.\u0275fac,providedIn:"root"});const QC_center=[-122.486052,37.830348];var w8=He(8527),b8=He(9898),AP=He.n(b8),Cf=(()=>{return(e=Cf||(Cf={})).getMidPoint=t=>YE(t,KE(t)/2),e.getCrossSectionCoordinates=(t,n)=>{const o=YE(t,KE(t)/2),c=e.getLineStringFeature([[o.geometry.coordinates[0],o.geometry.coordinates[1]-.001],[o.geometry.coordinates[0],o.geometry.coordinates[1]+.001]]),d=J4(t,c),_=d.features[0].geometry.coordinates.length-1,E=d.features[0];d.features[1].geometry.coordinates.shift(),E.geometry.coordinates=E.geometry.coordinates.concat(d.features[1].geometry.coordinates);const C=V2(E,-n,{units:"meters"}),D=V2(E,n,{units:"meters"});return[C.geometry.coordinates[_],D.geometry.coordinates[_]]},e.getPointFeature=(t,n)=>({geometry:{coordinates:t,type:"Point"},properties:n,type:"Feature"}),e.getLineStringFeature=t=>({type:"Feature",properties:{},geometry:{coordinates:t,type:"LineString"}}),Cf;var e})();class Am{constructor(){AP().accessToken="pk.eyJ1IjoiZGF4diIsImEiOiJjbGI0anR1dGgwb3lmM3ZwY2tiaThxaXViIn0.znSK1EzGg_qMEMZBEKGqdA"}onSelectionChange(t){this.onSelectionChangeListener=t}renderMap(t,n,r){this.map=new(AP().Map)({style:"mapbox://styles/mapbox/streets-v12",container:t,center:n,zoom:r}),this.map.on("load",()=>{this.setupBaseMap(),this.setupMapDraw()})}fetchImages(t){return Promise.all(t.map(n=>new Promise((r,o)=>{this.map.loadImage(n.url,(c,d)=>{if(c)throw c;this.map.addImage(n.id,d),r()})})))}setupMapDraw(){const t=new w8({controls:{point:!1,line_string:!0,polygon:!1,trash:!0,combine_features:!1,uncombine_features:!1}});this.map.addControl(t,"top-left"),this.map.on("draw.update",n=>{n.features.length&&this.lineSelected(n.features[0])}),this.map.on("draw.delete",n=>{this.selectionClear()}),this.map.on("draw.selectionchange",n=>{n.features.length?this.lineSelected(n.features[0]):this.selectionClear()})}setupBaseMap(){this.fetchImages([{url:"./assets/map/marker-a.png",id:"marker-a"},{url:"./assets/map/marker-b.png",id:"marker-b"},{url:"./assets/map/marker-c.png",id:"marker-c"},{url:"./assets/map/marker-d.png",id:"marker-d"},{url:"./assets/map/marker-road.png",id:"marker-road"}]),this.map.addSource("route",{type:"geojson",data:null}),this.map.addSource("markers",{type:"geojson",data:null}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#000","line-width":4}}),this.map.addLayer({id:"markers",type:"symbol",source:"markers",layout:{"icon-image":"{icon}","icon-anchor":"bottom"}})}lineSelected(t){const n=Cf.getMidPoint(t),r=Cf.getCrossSectionCoordinates(t,200);console.log(r),this.map.getSource("markers").setData({type:"FeatureCollection",features:[Cf.getPointFeature(t.geometry.coordinates[0],{icon:"marker-a"}),Cf.getPointFeature(t.geometry.coordinates[t.geometry.coordinates.length-1],{icon:"marker-b"}),Cf.getPointFeature(r[0],{icon:"marker-c"}),Cf.getPointFeature(r[1],{icon:"marker-d"}),Cf.getPointFeature(n.geometry.coordinates,{icon:"marker-road"})]}),this.map.getSource("route").setData(t),this.map.setLayoutProperty("markers","visibility","visible"),this.map.setLayoutProperty("route","visibility","visible"),this.onSelectionChangeListener?.({line:t})}selectionClear(){this.map.setLayoutProperty("markers","visibility","none"),this.map.setLayoutProperty("route","visibility","none"),this.onSelectionChangeListener?.({})}}Am.\u0275fac=function(t){return new(t||Am)},Am.\u0275prov=bn({token:Am,factory:Am.\u0275fac,providedIn:"root"});const E8=["container"];class fv{constructor(t){this.mapbox=t,this.selectionChange=new Pl}ngAfterViewInit(){this.mapbox.renderMap(this.container.nativeElement,QC_center,13.5),this.mapbox.onSelectionChange(t=>{this.selectionChange.emit(t)})}}fv.\u0275fac=function(t){return new(t||fv)(bi(Am))},fv.\u0275cmp=Ts({type:fv,selectors:[["app-map-view"]],viewQuery:function(t,n){if(1&t&&__(E8,5),2&t){let r;tm(r=nm())&&(n.container=r.first)}},outputs:{selectionChange:"selectionChange"},decls:2,vars:0,consts:[[2,"width","400px","height","200px"],["container",""]],template:function(t,n){1&t&&Ho(0,"div",0,1)},encapsulation:2});const C8=["canvas"];function S8(e,t){if(1&e&&(ni(0,"option",30),$u(1),ri()),2&e){const n=t.$implicit;co("value",n)("selected",100===n),Oc(1),e1("",n,"%")}}class dv{constructor(){this.contentWidth=0,this.scaleOptions=[];for(let t=.25;t<2;t+=.125)this.scaleOptions.push(100*t)}ngOnChanges(t){t.elevationProfile&&(this.elevationProfile=t.elevationProfile.currentValue,this.updateElevationProfile())}ngAfterViewInit(){this.updateElevationProfile()}updateElevationProfile(){this.canvas&&this.elevationProfile&&this.canvas.nativeElement.setElevationProfile(this.elevationProfile,50)}onSectionChange(){this.contentWidth=this.canvas.nativeElement.contentWidth}toggleElevationGrid(){this.canvas.nativeElement.elevationGrid=!this.canvas.nativeElement.elevationGrid}toggleOutline(){this.canvas.nativeElement.outline=!this.canvas.nativeElement.outline}toggleSeparator(){this.canvas.nativeElement.separator=!this.canvas.nativeElement.separator}toggleSurface(){this.canvas.nativeElement.hideSurface=!this.canvas.nativeElement.hideSurface}actionMirror(){this.canvas.nativeElement.mirror()}changeElevation(t){this.canvas.nativeElement.elevation=+t}changeScale(t){document.dispatchEvent(new CustomEvent("scalechange",{detail:+t}))}save(){localStorage.setItem("json",JSON.stringify(this.canvas.nativeElement.getJSON()))}load(){const t=localStorage.getItem("json");t&&this.canvas.nativeElement.loadJSON(JSON.parse(t))}}dv.\u0275fac=function(t){return new(t||dv)},dv.\u0275cmp=Ts({type:dv,selectors:[["app-street-canvas"]],viewQuery:function(t,n){if(1&t&&__(C8,5),2&t){let r;tm(r=nm())&&(n.canvas=r.first)}},inputs:{elevationProfile:"elevationProfile"},features:[na],decls:62,vars:2,consts:[[1,"controls"],["type","number","value","135",2,"width","80px",3,"change"],["elevationInput",""],[3,"change"],["scaleSelect",""],[3,"value","selected",4,"ngFor","ngForOf"],[3,"click"],[1,"controls__right"],["elevationGrid","","elevation","135","outline","","separator","",3,"sectionchange"],["canvas",""],["slot","canvas","width","3.2","elevation","0.6","type","sidewalk","color","concrete"],["slot","canvas","width","4.0","elevation","0.6","type","transitshelter","color","concrete"],["slot","canvas","width","5.4","elevation","0.8","slopeDirection","1","slopeHeight","0.5","title","Street A"],["slot","street","width","1.8","elevation","0.5","type","bike","direction","s","color","a"],["slot","street","width","3.6","elevation","0.8","type","bus","slopeDirection","1","slopeHeight","0.2","direction","sr","color","b","pattern","lines_45_black"],["slot","canvas","width","1.0","elevation","1.0","color","concrete","pattern","lines_45_black"],["slot","canvas","width","1.0","elevation","1.0","type","plantingstrip-flower","color","concrete"],["slot","canvas","width","0.5","elevation","1.0","type","tree","color","concrete"],["slot","canvas","width","1.0","elevation","1.0","color","concrete"],["slot","canvas","width","21","elevation","1.8","slopeDirection","1","slopeHeight","1","title","Street B"],["slot","street","width","2.6","elevation","1.0","type","drive","direction","sr","slopeDirection","1","slopeHeight","0.1"],["slot","street","width","2.6","elevation","1.0","type","drive","direction","s"],["slot","street","width","3.2","elevation","1.35","type","lightrail","direction","s","color","concrete","pattern","NETWORK-DENSITY-METRO2"],["slot","street","width","1","elevation","1.55","type","lamp","color","concrete"],["slot","street","width","3.2","elevation","1.45","type","streetcar","backward","","direction","s","color","concrete"],["slot","street","width","2.6","elevation","1.65","type","drive","backward","","direction","s","slopeDirection","1","slopeHeight","0.2"],["slot","street","width","2.6","elevation","1.65","type","drive","backward","","direction","sr","slopeDirection","-1","slopeHeight","0.0"],["slot","street","width","3.2","elevation","1.8","type","bus","backward","","direction","sr","slopeDirection","1","slopeHeight","0.15","color","b"],["slot","canvas","width","4.0","elevation","2.0","type","transitshelter","backward","","color","concrete"],["slot","canvas","width","1.4","elevation","2.0","type","sidewalk","color","concrete"],[3,"value","selected"]],template:function(t,n){if(1&t){const r=function io(){return xt()}();ni(0,"div",0)(1,"label"),$u(2,"Elevation:"),ri(),ni(3,"input",1,2),ho("change",function(){ur(r);const c=Ni(4);return Cr(n.changeElevation(c.value))}),ri(),ni(5,"label"),$u(6,"Scale:"),ri(),ni(7,"select",3,4),ho("change",function(){ur(r);const c=Ni(8);return Cr(n.changeScale(c.value))}),function Ls(e,t,n,r,o,c,d,_){const E=xt(),C=mn(),D=e+22,L=C.firstCreatePass?function ai(e,t,n,r,o,c,d,_,E){const C=t.consts,D=oh(t,e,4,d||null,u(C,_));Xy(t,n,D,u(C,E)),Be(t,D);const L=D.tViews=kg(2,D,r,o,c,t.directiveRegistry,t.pipeRegistry,null,t.schemas,C);return null!==t.queries&&(t.queries.template(t,D),L.queries=t.queries.embeddedTView(D)),D}(D,C,E,t,n,r,o,c,d):C.data[D];ra(L,!1);const N=E[11].createComment("");cg(C,E,N,L),ju(N,E),Xf(E,E[D]=j0(N,E,N,L)),Xs(L)&&hf(C,E,L),null!=d&&zd(E,L,_)}(9,S8,2,3,"option",5),ri(),ni(10,"label"),$u(11,"Toggle:"),ri(),ni(12,"button",6),ho("click",function(){return n.toggleElevationGrid()}),$u(13,"Elevation Grid"),ri(),ni(14,"button",6),ho("click",function(){return n.toggleOutline()}),$u(15,"Outline"),ri(),ni(16,"button",6),ho("click",function(){return n.toggleSeparator()}),$u(17,"Separator"),ri(),ni(18,"button",6),ho("click",function(){return n.toggleSurface()}),$u(19,"Surface"),ri(),ni(20,"label"),$u(21,"Tools:"),ri(),ni(22,"button",6),ho("click",function(){return n.actionMirror()}),$u(23,"Mirror"),ri(),ni(24,"button"),$u(25,"Add Street"),ri(),ni(26,"button"),$u(27,"Add Segment"),ri(),ni(28,"label"),$u(29,"Storage:"),ri(),ni(30,"button",6),ho("click",function(){return n.save()}),$u(31,"Save"),ri(),ni(32,"button",6),ho("click",function(){return n.load()}),$u(33,"Load"),ri(),ni(34,"div",7),$u(35," Section Width "),ni(36,"span"),$u(37),ri(),$u(38," m "),ri()(),ni(39,"ud-canvas",8,9),ho("sectionchange",function(){return n.onSectionChange()}),Ho(41,"ud-segment",10)(42,"ud-segment",11),ni(43,"ud-street",12),Ho(44,"ud-segment",13)(45,"ud-segment",14),ri(),Ho(46,"ud-segment",15)(47,"ud-segment",16)(48,"ud-segment",17)(49,"ud-segment",16)(50,"ud-segment",18),ni(51,"ud-street",19),Ho(52,"ud-segment",20)(53,"ud-segment",21)(54,"ud-segment",22)(55,"ud-segment",23)(56,"ud-segment",24)(57,"ud-segment",25)(58,"ud-segment",26)(59,"ud-segment",27),ri(),Ho(60,"ud-segment",28)(61,"ud-segment",29),ri()}2&t&&(Oc(9),co("ngForOf",n.scaleOptions),Oc(28),Ww(n.contentWidth))},dependencies:[rM],styles:[".controls[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;gap:10px;align-items:center;font-size:14px}.controls__right[_ngcontent-%COMP%]{margin-left:auto;color:gray}"]});const I8=["container"],T8=["canvas"];class pv{constructor(){this.style={strokeStyle:"black",lineWidth:2,yMargin:10}}onResize(){this.resize(),this.draw()}ngAfterViewInit(){this.canvasContext=this.canvas.nativeElement.getContext("2d"),this.resize(),this.draw()}ngOnChanges(t){t.ys&&this.updateYs(t.ys.currentValue)}resize(){this.width=this.container.nativeElement.offsetWidth,this.height=this.container.nativeElement.offsetHeight,this.canvas.nativeElement.width=this.width*devicePixelRatio,this.canvas.nativeElement.height=this.height*devicePixelRatio,this.canvas.nativeElement.style.width=this.width+"px",this.canvas.nativeElement.style.height=this.height+"px",this.canvasContext.scale(devicePixelRatio,devicePixelRatio)}updateYs(t){this.ys=t,this.ys&&(this.cubicSpline=new window.ud.CubicSpline(Array(this.ys.length).fill(void 0).map((n,r)=>r),this.ys)),this.draw()}draw(){if(!this.ys)return;const t=this.width-1,n=Array(this.width).fill(void 0).map((_,E)=>this.cubicSpline.at(window.ud.Utils.fitRange(t,this.ys.length,E))),r=Math.min(...n),o=Math.max(...n)-r;this.canvasContext.lineWidth=this.style.lineWidth,this.canvasContext.strokeStyle=this.style.strokeStyle,this.canvasContext.beginPath();const c=this.style.yMargin,d=this.height-1-2*this.style.yMargin;for(let _=0;_<t;_++){0===_&&this.canvasContext.moveTo(_,window.ud.Utils.fitRangeWithOffset(r,o,c,d,n[_]));const E=_+1;this.canvasContext.lineTo(E,window.ud.Utils.fitRangeWithOffset(r,o,c,d,n[E]))}this.canvasContext.stroke()}}pv.\u0275fac=function(t){return new(t||pv)},pv.\u0275cmp=Ts({type:pv,selectors:[["app-line-chart"]],viewQuery:function(t,n){if(1&t&&(__(I8,5),__(T8,5)),2&t){let r;tm(r=nm())&&(n.container=r.first),tm(r=nm())&&(n.canvas=r.first)}},hostBindings:function(t,n){1&t&&ho("resize",function(o){return n.onResize(o)},0,Ry)},inputs:{ys:"ys"},features:[na],decls:4,vars:0,consts:[[1,"container"],["container",""],[1,"canvas"],["canvas",""]],template:function(t,n){1&t&&(ni(0,"div",0,1),Ho(2,"canvas",2,3),ri())},styles:[".container[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background-color:#ccc}.canvas[_ngcontent-%COMP%]{position:absolute}"]});class gv{constructor(t){this.elevationProfileService=t}onMapSelectionChange(t){t.line&&(this.chartYs=this.elevationProfileService.StaticResponsePath,this.streetElevationProfile=this.elevationProfileService.StaticResponseCrossSection)}}gv.\u0275fac=function(t){return new(t||gv)(bi(Dm))},gv.\u0275cmp=Ts({type:gv,selectors:[["app-root"]],decls:5,vars:2,consts:[[1,"top-panel"],[3,"selectionChange"],[1,"street-elevation-chart",3,"ys"],[3,"elevationProfile"]],template:function(t,n){1&t&&(ni(0,"div",0)(1,"app-map-view",1),ho("selectionChange",function(o){return n.onMapSelectionChange(o)}),ri(),Ho(2,"app-line-chart",2),ri(),Ho(3,"app-street-canvas",3)(4,"router-outlet")),2&t&&(Oc(2),co("ys",n.chartYs),Oc(1),co("elevationProfile",n.streetElevationProfile))},dependencies:[wE,fv,dv,pv],styles:[".top-panel[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;column-gap:20px}.street-elevation-chart[_ngcontent-%COMP%]{flex-grow:1}"]});const M8=()=>{};class Pm{}Pm.\u0275fac=function(t){return new(t||Pm)},Pm.\u0275mod=Qs({type:Pm,bootstrap:[gv]}),Pm.\u0275inj=Jo({providers:[{provide:x_,useFactory:()=>M8,multi:!0}],imports:[LF,gm]}),PF().bootstrapModule(Pm).catch(e=>console.error(e))},1503:(xn,It,He)=>{"use strict";var Ue=He(3269);function ft(p){var Ce=[1/0,1/0,-1/0,-1/0];return Ue.coordEach(p,function(We){Ce[0]>We[0]&&(Ce[0]=We[0]),Ce[1]>We[1]&&(Ce[1]=We[1]),Ce[2]<We[0]&&(Ce[2]=We[0]),Ce[3]<We[1]&&(Ce[3]=We[1])}),Ce}ft.default=ft,It.Z=ft},8275:(xn,It)=>{"use strict";function He(Ge,$e,ue){void 0===ue&&(ue={});var on={type:"Feature"};return(0===ue.id||ue.id)&&(on.id=ue.id),ue.bbox&&(on.bbox=ue.bbox),on.properties=$e||{},on.geometry=Ge,on}function Ue(Ge,$e,ue){if(void 0===ue&&(ue={}),!Ge)throw new Error("coordinates is required");if(!Array.isArray(Ge))throw new Error("coordinates must be an Array");if(Ge.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!le(Ge[0])||!le(Ge[1]))throw new Error("coordinates must contain numbers");return He({type:"Point",coordinates:Ge},$e,ue)}function p(Ge,$e,ue){void 0===ue&&(ue={});for(var on=0,kt=Ge;on<kt.length;on++){var Ne=kt[on];if(Ne.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var gt=0;gt<Ne[Ne.length-1].length;gt++)if(Ne[Ne.length-1][gt]!==Ne[0][gt])throw new Error("First and last Position are not equivalent.")}return He({type:"Polygon",coordinates:Ge},$e,ue)}function We(Ge,$e,ue){if(void 0===ue&&(ue={}),Ge.length<2)throw new Error("coordinates must be an array of two or more positions");return He({type:"LineString",coordinates:Ge},$e,ue)}function yt(Ge,$e){void 0===$e&&($e={});var ue={type:"FeatureCollection"};return $e.id&&(ue.id=$e.id),$e.bbox&&(ue.bbox=$e.bbox),ue.features=Ge,ue}function Lt(Ge,$e,ue){return void 0===ue&&(ue={}),He({type:"MultiLineString",coordinates:Ge},$e,ue)}function un(Ge,$e,ue){return void 0===ue&&(ue={}),He({type:"MultiPoint",coordinates:Ge},$e,ue)}function Gt(Ge,$e,ue){return void 0===ue&&(ue={}),He({type:"MultiPolygon",coordinates:Ge},$e,ue)}function Dn(Ge,$e){void 0===$e&&($e="kilometers");var ue=It.factors[$e];if(!ue)throw new Error($e+" units is invalid");return Ge*ue}function ge(Ge,$e){void 0===$e&&($e="kilometers");var ue=It.factors[$e];if(!ue)throw new Error($e+" units is invalid");return Ge/ue}function Q(Ge){return Ge%(2*Math.PI)*180/Math.PI}function le(Ge){return!isNaN(Ge)&&null!==Ge&&!Array.isArray(Ge)}Object.defineProperty(It,"__esModule",{value:!0}),It.earthRadius=6371008.8,It.factors={centimeters:100*It.earthRadius,centimetres:100*It.earthRadius,degrees:It.earthRadius/111325,feet:3.28084*It.earthRadius,inches:39.37*It.earthRadius,kilometers:It.earthRadius/1e3,kilometres:It.earthRadius/1e3,meters:It.earthRadius,metres:It.earthRadius,miles:It.earthRadius/1609.344,millimeters:1e3*It.earthRadius,millimetres:1e3*It.earthRadius,nauticalmiles:It.earthRadius/1852,radians:1,yards:1.0936*It.earthRadius},It.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/It.earthRadius,yards:1.0936133},It.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},It.feature=He,It.geometry=function Te(Ge,$e,ue){switch(void 0===ue&&(ue={}),Ge){case"Point":return Ue($e).geometry;case"LineString":return We($e).geometry;case"Polygon":return p($e).geometry;case"MultiPoint":return un($e).geometry;case"MultiLineString":return Lt($e).geometry;case"MultiPolygon":return Gt($e).geometry;default:throw new Error(Ge+" is invalid")}},It.point=Ue,It.points=function ft(Ge,$e,ue){return void 0===ue&&(ue={}),yt(Ge.map(function(on){return Ue(on,$e)}),ue)},It.polygon=p,It.polygons=function Ce(Ge,$e,ue){return void 0===ue&&(ue={}),yt(Ge.map(function(on){return p(on,$e)}),ue)},It.lineString=We,It.lineStrings=function dt(Ge,$e,ue){return void 0===ue&&(ue={}),yt(Ge.map(function(on){return We(on,$e)}),ue)},It.featureCollection=yt,It.multiLineString=Lt,It.multiPoint=un,It.multiPolygon=Gt,It.geometryCollection=function Tt(Ge,$e,ue){return void 0===ue&&(ue={}),He({type:"GeometryCollection",geometries:Ge},$e,ue)},It.round=function Xt(Ge,$e){if(void 0===$e&&($e=0),$e&&!($e>=0))throw new Error("precision must be a positive number");var ue=Math.pow(10,$e||0);return Math.round(Ge*ue)/ue},It.radiansToLength=Dn,It.lengthToRadians=ge,It.lengthToDegrees=function Me(Ge,$e){return Q(ge(Ge,$e))},It.bearingToAzimuth=function de(Ge){var $e=Ge%360;return $e<0&&($e+=360),$e},It.radiansToDegrees=Q,It.degreesToRadians=function fe(Ge){return Ge%360*Math.PI/180},It.convertLength=function ze(Ge,$e,ue){if(void 0===$e&&($e="kilometers"),void 0===ue&&(ue="kilometers"),!(Ge>=0))throw new Error("length must be a positive number");return Dn(ge(Ge,$e),ue)},It.convertArea=function pe(Ge,$e,ue){if(void 0===$e&&($e="meters"),void 0===ue&&(ue="kilometers"),!(Ge>=0))throw new Error("area must be a positive number");var on=It.areaFactors[$e];if(!on)throw new Error("invalid original units");var kt=It.areaFactors[ue];if(!kt)throw new Error("invalid final units");return Ge/on*kt},It.isNumber=le,It.isObject=function we(Ge){return!!Ge&&Ge.constructor===Object},It.validateBBox=function J(Ge){if(!Ge)throw new Error("bbox is required");if(!Array.isArray(Ge))throw new Error("bbox must be an Array");if(4!==Ge.length&&6!==Ge.length)throw new Error("bbox must be an Array of 4 or 6 numbers");Ge.forEach(function($e){if(!le($e))throw new Error("bbox must only contain numbers")})},It.validateId=function _t(Ge){if(!Ge)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof Ge))throw new Error("id must be a number or a string")}},3269:(xn,It,He)=>{"use strict";Object.defineProperty(It,"__esModule",{value:!0});var Te=He(8275);function Ue(fe,ze,pe){if(null!==fe)for(var le,we,J,_t,Ge,$e,ue,Ne,on=0,kt=0,gt=fe.type,Ee="FeatureCollection"===gt,it="Feature"===gt,vt=Ee?fe.features.length:1,Re=0;Re<vt;Re++){Ge=(Ne=!!(ue=Ee?fe.features[Re].geometry:it?fe.geometry:fe)&&"GeometryCollection"===ue.type)?ue.geometries.length:1;for(var Yt=0;Yt<Ge;Yt++){var $t=0,Mn=0;if(null!==(_t=Ne?ue.geometries[Yt]:ue)){$e=_t.coordinates;var jt=_t.type;switch(on=!pe||"Polygon"!==jt&&"MultiPolygon"!==jt?0:1,jt){case null:break;case"Point":if(!1===ze($e,kt,Re,$t,Mn))return!1;kt++,$t++;break;case"LineString":case"MultiPoint":for(le=0;le<$e.length;le++){if(!1===ze($e[le],kt,Re,$t,Mn))return!1;kt++,"MultiPoint"===jt&&$t++}"LineString"===jt&&$t++;break;case"Polygon":case"MultiLineString":for(le=0;le<$e.length;le++){for(we=0;we<$e[le].length-on;we++){if(!1===ze($e[le][we],kt,Re,$t,Mn))return!1;kt++}"MultiLineString"===jt&&$t++,"Polygon"===jt&&Mn++}"Polygon"===jt&&$t++;break;case"MultiPolygon":for(le=0;le<$e.length;le++){for(Mn=0,we=0;we<$e[le].length;we++){for(J=0;J<$e[le][we].length-on;J++){if(!1===ze($e[le][we][J],kt,Re,$t,Mn))return!1;kt++}Mn++}$t++}break;case"GeometryCollection":for(le=0;le<_t.geometries.length;le++)if(!1===Ue(_t.geometries[le],ze,pe))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(fe,ze){var pe;switch(fe.type){case"FeatureCollection":for(pe=0;pe<fe.features.length&&!1!==ze(fe.features[pe].properties,pe);pe++);break;case"Feature":ze(fe.properties,0)}}function We(fe,ze){if("Feature"===fe.type)ze(fe,0);else if("FeatureCollection"===fe.type)for(var pe=0;pe<fe.features.length&&!1!==ze(fe.features[pe],pe);pe++);}function Lt(fe,ze){var pe,le,we,J,_t,Ge,$e,ue,on,kt,Ne=0,gt="FeatureCollection"===fe.type,Ee="Feature"===fe.type,it=gt?fe.features.length:1;for(pe=0;pe<it;pe++){for(ue=gt?fe.features[pe].properties:Ee?fe.properties:{},on=gt?fe.features[pe].bbox:Ee?fe.bbox:void 0,kt=gt?fe.features[pe].id:Ee?fe.id:void 0,_t=($e=!!(Ge=gt?fe.features[pe].geometry:Ee?fe.geometry:fe)&&"GeometryCollection"===Ge.type)?Ge.geometries.length:1,we=0;we<_t;we++)if(null!==(J=$e?Ge.geometries[we]:Ge))switch(J.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ze(J,Ne,ue,on,kt))return!1;break;case"GeometryCollection":for(le=0;le<J.geometries.length;le++)if(!1===ze(J.geometries[le],Ne,ue,on,kt))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ze(null,Ne,ue,on,kt))return!1;Ne++}}function Gt(fe,ze){Lt(fe,function(pe,le,we,J,_t){var $e,Ge=null===pe?null:pe.type;switch(Ge){case null:case"Point":case"LineString":case"Polygon":return!1!==ze(Te.feature(pe,we,{bbox:J,id:_t}),le,0)&&void 0}switch(Ge){case"MultiPoint":$e="Point";break;case"MultiLineString":$e="LineString";break;case"MultiPolygon":$e="Polygon"}for(var ue=0;ue<pe.coordinates.length;ue++)if(!1===ze(Te.feature({type:$e,coordinates:pe.coordinates[ue]},we),le,ue))return!1})}function Xt(fe,ze){Gt(fe,function(pe,le,we){var J=0;if(pe.geometry){var _t=pe.geometry.type;if("Point"!==_t&&"MultiPoint"!==_t){var Ge,$e=0,ue=0,on=0;if(!1===Ue(pe,function(kt,Ne,gt,Ee,it){if(void 0===Ge||le>$e||Ee>ue||it>on)return Ge=kt,$e=le,ue=Ee,on=it,void(J=0);var vt=Te.lineString([Ge,kt],pe.properties);if(!1===ze(vt,le,we,it,J))return!1;J++,Ge=kt}))return!1}}})}function ge(fe,ze){if(!fe)throw new Error("geojson is required");Gt(fe,function(pe,le,we){if(null!==pe.geometry){var _t=pe.geometry.coordinates;switch(pe.geometry.type){case"LineString":if(!1===ze(pe,le,we,0,0))return!1;break;case"Polygon":for(var Ge=0;Ge<_t.length;Ge++)if(!1===ze(Te.lineString(_t[Ge],pe.properties),le,we,Ge))return!1}}})}It.coordAll=function yt(fe){var ze=[];return Ue(fe,function(pe){ze.push(pe)}),ze},It.coordEach=Ue,It.coordReduce=function ft(fe,ze,pe,le){var we=pe;return Ue(fe,function(J,_t,Ge,$e,ue){we=0===_t&&void 0===pe?J:ze(we,J,_t,Ge,$e,ue)},le),we},It.featureEach=We,It.featureReduce=function dt(fe,ze,pe){var le=pe;return We(fe,function(we,J){le=0===J&&void 0===pe?we:ze(le,we,J)}),le},It.findPoint=function Q(fe,ze){if(!Te.isObject(ze=ze||{}))throw new Error("options is invalid");var Ge,pe=ze.featureIndex||0,le=ze.multiFeatureIndex||0,we=ze.geometryIndex||0,J=ze.coordIndex||0,_t=ze.properties;switch(fe.type){case"FeatureCollection":pe<0&&(pe=fe.features.length+pe),_t=_t||fe.features[pe].properties,Ge=fe.features[pe].geometry;break;case"Feature":_t=_t||fe.properties,Ge=fe.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ge=fe;break;default:throw new Error("geojson is invalid")}if(null===Ge)return null;var $e=Ge.coordinates;switch(Ge.type){case"Point":return Te.point($e,_t,ze);case"MultiPoint":return le<0&&(le=$e.length+le),Te.point($e[le],_t,ze);case"LineString":return J<0&&(J=$e.length+J),Te.point($e[J],_t,ze);case"Polygon":return we<0&&(we=$e.length+we),J<0&&(J=$e[we].length+J),Te.point($e[we][J],_t,ze);case"MultiLineString":return le<0&&(le=$e.length+le),J<0&&(J=$e[le].length+J),Te.point($e[le][J],_t,ze);case"MultiPolygon":return le<0&&(le=$e.length+le),we<0&&(we=$e[le].length+we),J<0&&(J=$e[le][we].length-J),Te.point($e[le][we][J],_t,ze)}throw new Error("geojson is invalid")},It.findSegment=function de(fe,ze){if(!Te.isObject(ze=ze||{}))throw new Error("options is invalid");var Ge,pe=ze.featureIndex||0,le=ze.multiFeatureIndex||0,we=ze.geometryIndex||0,J=ze.segmentIndex||0,_t=ze.properties;switch(fe.type){case"FeatureCollection":pe<0&&(pe=fe.features.length+pe),_t=_t||fe.features[pe].properties,Ge=fe.features[pe].geometry;break;case"Feature":_t=_t||fe.properties,Ge=fe.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ge=fe;break;default:throw new Error("geojson is invalid")}if(null===Ge)return null;var $e=Ge.coordinates;switch(Ge.type){case"Point":case"MultiPoint":return null;case"LineString":return J<0&&(J=$e.length+J-1),Te.lineString([$e[J],$e[J+1]],_t,ze);case"Polygon":return we<0&&(we=$e.length+we),J<0&&(J=$e[we].length+J-1),Te.lineString([$e[we][J],$e[we][J+1]],_t,ze);case"MultiLineString":return le<0&&(le=$e.length+le),J<0&&(J=$e[le].length+J-1),Te.lineString([$e[le][J],$e[le][J+1]],_t,ze);case"MultiPolygon":return le<0&&(le=$e.length+le),we<0&&(we=$e[le].length+we),J<0&&(J=$e[le][we].length-J-1),Te.lineString([$e[le][we][J],$e[le][we][J+1]],_t,ze)}throw new Error("geojson is invalid")},It.flattenEach=Gt,It.flattenReduce=function Tt(fe,ze,pe){var le=pe;return Gt(fe,function(we,J,_t){le=0===J&&0===_t&&void 0===pe?we:ze(le,we,J,_t)}),le},It.geomEach=Lt,It.geomReduce=function un(fe,ze,pe){var le=pe;return Lt(fe,function(we,J,_t,Ge,$e){le=0===J&&void 0===pe?we:ze(le,we,J,_t,Ge,$e)}),le},It.lineEach=ge,It.lineReduce=function Me(fe,ze,pe){var le=pe;return ge(fe,function(we,J,_t,Ge){le=0===J&&void 0===pe?we:ze(le,we,J,_t,Ge)}),le},It.propEach=p,It.propReduce=function Ce(fe,ze,pe){var le=pe;return p(fe,function(we,J){le=0===J&&void 0===pe?we:ze(le,we,J)}),le},It.segmentEach=Xt,It.segmentReduce=function Dn(fe,ze,pe){var le=pe,we=!1;return Xt(fe,function(J,_t,Ge,$e,ue){le=!1===we&&void 0===pe?J:ze(le,J,_t,Ge,$e,ue),we=!0}),le}},5834:(xn,It,He)=>{"use strict";var Te=He(5203),Ue=He(5685),ft=Ue(Te("String.prototype.indexOf"));xn.exports=function(Ce,We){var dt=Te(Ce,!!We);return"function"==typeof dt&&ft(Ce,".prototype.")>-1?Ue(dt):dt}},5685:(xn,It,He)=>{"use strict";var Te=He(4444),Ue=He(5203),ft=Ue("%Function.prototype.apply%"),p=Ue("%Function.prototype.call%"),Ce=Ue("%Reflect.apply%",!0)||Te.call(p,ft),We=Ue("%Object.getOwnPropertyDescriptor%",!0),dt=Ue("%Object.defineProperty%",!0),yt=Ue("%Math.max%");if(dt)try{dt({},"a",{value:1})}catch{dt=null}xn.exports=function(Gt){var Tt=Ce(Te,p,arguments);if(We&&dt){var Xt=We(Tt,"length");Xt.configurable&&dt(Tt,"length",{value:1+yt(0,Gt.length-(arguments.length-1))})}return Tt};var Lt=function(){return Ce(Te,ft,arguments)};dt?dt(xn.exports,"apply",{value:Lt}):xn.exports.apply=Lt},1335:(xn,It,He)=>{"use strict";var Te=He(3156),Ue=He(7253),ft=He(3870),p=He(7563).orient2d;function Ce(pe,le,we){le=Math.max(0,void 0===le?2:le),we=we||0;var J=function Dn(pe){for(var le=pe[0],we=pe[0],J=pe[0],_t=pe[0],Ge=0;Ge<pe.length;Ge++){var $e=pe[Ge];$e[0]<le[0]&&(le=$e),$e[0]>J[0]&&(J=$e),$e[1]<we[1]&&(we=$e),$e[1]>_t[1]&&(_t=$e)}var ue=[le,we,J,_t],on=ue.slice();for(Ge=0;Ge<pe.length;Ge++)ft(pe[Ge],ue)||on.push(pe[Ge]);return function ze(pe){pe.sort(fe);for(var le=[],we=0;we<pe.length;we++){for(;le.length>=2&&Gt(le[le.length-2],le[le.length-1],pe[we])<=0;)le.pop();le.push(pe[we])}for(var J=[],_t=pe.length-1;_t>=0;_t--){for(;J.length>=2&&Gt(J[J.length-2],J[J.length-1],pe[_t])<=0;)J.pop();J.push(pe[_t])}return J.pop(),le.pop(),le.concat(J)}(on)}(pe),_t=new Te(16);_t.toBBox=function(Mn){return{minX:Mn[0],minY:Mn[1],maxX:Mn[0],maxY:Mn[1]}},_t.compareMinX=function(Mn,jt){return Mn[0]-jt[0]},_t.compareMinY=function(Mn,jt){return Mn[1]-jt[1]},_t.load(pe);for(var ue,Ge=[],$e=0;$e<J.length;$e++){var on=J[$e];_t.remove(on),ue=ge(on,ue),Ge.push(ue)}var kt=new Te(16);for($e=0;$e<Ge.length;$e++)kt.insert(Xt(Ge[$e]));for(var Ne=le*le,gt=we*we;Ge.length;){var Ee=Ge.shift(),it=Ee.p,vt=Ee.next.p,Re=Me(it,vt);if(!(Re<gt)){var Yt=Re/Ne;(on=We(_t,Ee.prev.p,it,vt,Ee.next.next.p,Yt,kt))&&Math.min(Me(on,it),Me(on,vt))<=Yt&&(Ge.push(Ee),Ge.push(ge(on,Ee)),_t.remove(on),kt.remove(Ee),kt.insert(Xt(Ee)),kt.insert(Xt(Ee.next)))}}Ee=ue;var $t=[];do{$t.push(Ee.p),Ee=Ee.next}while(Ee!==ue);return $t.push(Ee.p),$t}function We(pe,le,we,J,_t,Ge,$e){for(var ue=new Ue([],dt),on=pe.data;on;){for(var kt=0;kt<on.children.length;kt++){var Ne=on.children[kt],gt=on.leaf?de(Ne,we,J):yt(we,J,Ne);gt>Ge||ue.push({node:Ne,dist:gt})}for(;ue.length&&!ue.peek().node.children;){var Ee=ue.pop(),it=Ee.node,vt=de(it,le,we),Re=de(it,J,_t);if(Ee.dist<vt&&Ee.dist<Re&&un(we,it,$e)&&un(J,it,$e))return it}(on=ue.pop())&&(on=on.node)}return null}function dt(pe,le){return pe.dist-le.dist}function yt(pe,le,we){if(Lt(pe,we)||Lt(le,we))return 0;var J=Q(pe[0],pe[1],le[0],le[1],we.minX,we.minY,we.maxX,we.minY);if(0===J)return 0;var _t=Q(pe[0],pe[1],le[0],le[1],we.minX,we.minY,we.minX,we.maxY);if(0===_t)return 0;var Ge=Q(pe[0],pe[1],le[0],le[1],we.maxX,we.minY,we.maxX,we.maxY);if(0===Ge)return 0;var $e=Q(pe[0],pe[1],le[0],le[1],we.minX,we.maxY,we.maxX,we.maxY);return 0===$e?0:Math.min(J,_t,Ge,$e)}function Lt(pe,le){return pe[0]>=le.minX&&pe[0]<=le.maxX&&pe[1]>=le.minY&&pe[1]<=le.maxY}function un(pe,le,we){for(var J=Math.min(pe[0],le[0]),_t=Math.min(pe[1],le[1]),Ge=Math.max(pe[0],le[0]),$e=Math.max(pe[1],le[1]),ue=we.search({minX:J,minY:_t,maxX:Ge,maxY:$e}),on=0;on<ue.length;on++)if(Tt(ue[on].p,ue[on].next.p,pe,le))return!1;return!0}function Gt(pe,le,we){return p(pe[0],pe[1],le[0],le[1],we[0],we[1])}function Tt(pe,le,we,J){return pe!==J&&le!==we&&Gt(pe,le,we)>0!=Gt(pe,le,J)>0&&Gt(we,J,pe)>0!=Gt(we,J,le)>0}function Xt(pe){var le=pe.p,we=pe.next.p;return pe.minX=Math.min(le[0],we[0]),pe.minY=Math.min(le[1],we[1]),pe.maxX=Math.max(le[0],we[0]),pe.maxY=Math.max(le[1],we[1]),pe}function ge(pe,le){var we={p:pe,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return le?(we.next=le.next,we.prev=le,le.next.prev=we,le.next=we):(we.prev=we,we.next=we),we}function Me(pe,le){var we=pe[0]-le[0],J=pe[1]-le[1];return we*we+J*J}function de(pe,le,we){var J=le[0],_t=le[1],Ge=we[0]-J,$e=we[1]-_t;if(0!==Ge||0!==$e){var ue=((pe[0]-J)*Ge+(pe[1]-_t)*$e)/(Ge*Ge+$e*$e);ue>1?(J=we[0],_t=we[1]):ue>0&&(J+=Ge*ue,_t+=$e*ue)}return(Ge=pe[0]-J)*Ge+($e=pe[1]-_t)*$e}function Q(pe,le,we,J,_t,Ge,$e,ue){var Xn,Qn,sr,kn,on=we-pe,kt=J-le,Ne=$e-_t,gt=ue-Ge,Ee=pe-_t,it=le-Ge,vt=on*on+kt*kt,Re=on*Ne+kt*gt,Yt=Ne*Ne+gt*gt,$t=on*Ee+kt*it,Mn=Ne*Ee+gt*it,jt=vt*Yt-Re*Re,zn=jt,wn=jt;0===jt?(Qn=0,zn=1,kn=Mn,wn=Yt):(kn=vt*Mn-Re*$t,(Qn=Re*Mn-Yt*$t)<0?(Qn=0,kn=Mn,wn=Yt):Qn>zn&&(Qn=zn,kn=Mn+Re,wn=Yt)),kn<0?(kn=0,-$t<0?Qn=0:-$t>vt?Qn=zn:(Qn=-$t,zn=vt)):kn>wn&&(kn=wn,-$t+Re<0?Qn=0:-$t+Re>vt?Qn=zn:(Qn=-$t+Re,zn=vt));var Or=(1-(sr=0===kn?0:kn/wn))*_t+sr*$e-((1-(Xn=0===Qn?0:Qn/zn))*pe+Xn*we),St=(1-sr)*Ge+sr*ue-((1-Xn)*le+Xn*J);return Or*Or+St*St}function fe(pe,le){return pe[0]===le[0]?pe[1]-le[1]:pe[0]-le[0]}Ue.default&&(Ue=Ue.default),xn.exports=Ce,xn.exports.default=Ce},3156:function(xn){xn.exports=function(){"use strict";function It(ge,Me,de,Q,fe){!function ze(pe,le,we,J,_t){for(;J>we;){if(J-we>600){var Ge=J-we+1,$e=le-we+1,ue=Math.log(Ge),on=.5*Math.exp(2*ue/3),kt=.5*Math.sqrt(ue*on*(Ge-on)/Ge)*($e-Ge/2<0?-1:1);ze(pe,le,Math.max(we,Math.floor(le-$e*on/Ge+kt)),Math.min(J,Math.floor(le+(Ge-$e)*on/Ge+kt)),_t)}var Ee=pe[le],it=we,vt=J;for(He(pe,we,le),_t(pe[J],Ee)>0&&He(pe,we,J);it<vt;){for(He(pe,it,vt),it++,vt--;_t(pe[it],Ee)<0;)it++;for(;_t(pe[vt],Ee)>0;)vt--}0===_t(pe[we],Ee)?He(pe,we,vt):He(pe,++vt,J),vt<=le&&(we=vt+1),le<=vt&&(J=vt-1)}}(ge,Me,de||0,Q||ge.length-1,fe||Te)}function He(ge,Me,de){var Q=ge[Me];ge[Me]=ge[de],ge[de]=Q}function Te(ge,Me){return ge<Me?-1:ge>Me?1:0}var Ue=function(ge){void 0===ge&&(ge=9),this._maxEntries=Math.max(4,ge),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ft(ge,Me,de){if(!de)return Me.indexOf(ge);for(var Q=0;Q<Me.length;Q++)if(de(ge,Me[Q]))return Q;return-1}function p(ge,Me){Ce(ge,0,ge.children.length,Me,ge)}function Ce(ge,Me,de,Q,fe){fe||(fe=Xt(null)),fe.minX=1/0,fe.minY=1/0,fe.maxX=-1/0,fe.maxY=-1/0;for(var ze=Me;ze<de;ze++){var pe=ge.children[ze];We(fe,ge.leaf?Q(pe):pe)}return fe}function We(ge,Me){return ge.minX=Math.min(ge.minX,Me.minX),ge.minY=Math.min(ge.minY,Me.minY),ge.maxX=Math.max(ge.maxX,Me.maxX),ge.maxY=Math.max(ge.maxY,Me.maxY),ge}function dt(ge,Me){return ge.minX-Me.minX}function yt(ge,Me){return ge.minY-Me.minY}function Lt(ge){return(ge.maxX-ge.minX)*(ge.maxY-ge.minY)}function un(ge){return ge.maxX-ge.minX+(ge.maxY-ge.minY)}function Gt(ge,Me){return ge.minX<=Me.minX&&ge.minY<=Me.minY&&Me.maxX<=ge.maxX&&Me.maxY<=ge.maxY}function Tt(ge,Me){return Me.minX<=ge.maxX&&Me.minY<=ge.maxY&&Me.maxX>=ge.minX&&Me.maxY>=ge.minY}function Xt(ge){return{children:ge,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Dn(ge,Me,de,Q,fe){for(var ze=[Me,de];ze.length;)if(!((de=ze.pop())-(Me=ze.pop())<=Q)){var pe=Me+Math.ceil((de-Me)/Q/2)*Q;It(ge,pe,Me,de,fe),ze.push(Me,pe,pe,de)}}return Ue.prototype.all=function(){return this._all(this.data,[])},Ue.prototype.search=function(ge){var Me=this.data,de=[];if(!Tt(ge,Me))return de;for(var Q=this.toBBox,fe=[];Me;){for(var ze=0;ze<Me.children.length;ze++){var pe=Me.children[ze],le=Me.leaf?Q(pe):pe;Tt(ge,le)&&(Me.leaf?de.push(pe):Gt(ge,le)?this._all(pe,de):fe.push(pe))}Me=fe.pop()}return de},Ue.prototype.collides=function(ge){var Me=this.data;if(!Tt(ge,Me))return!1;for(var de=[];Me;){for(var Q=0;Q<Me.children.length;Q++){var fe=Me.children[Q],ze=Me.leaf?this.toBBox(fe):fe;if(Tt(ge,ze)){if(Me.leaf||Gt(ge,ze))return!0;de.push(fe)}}Me=de.pop()}return!1},Ue.prototype.load=function(ge){if(!ge||!ge.length)return this;if(ge.length<this._minEntries){for(var Me=0;Me<ge.length;Me++)this.insert(ge[Me]);return this}var de=this._build(ge.slice(),0,ge.length-1,0);if(this.data.children.length)if(this.data.height===de.height)this._splitRoot(this.data,de);else{if(this.data.height<de.height){var Q=this.data;this.data=de,de=Q}this._insert(de,this.data.height-de.height-1,!0)}else this.data=de;return this},Ue.prototype.insert=function(ge){return ge&&this._insert(ge,this.data.height-1),this},Ue.prototype.clear=function(){return this.data=Xt([]),this},Ue.prototype.remove=function(ge,Me){if(!ge)return this;for(var de,Q,fe,ze=this.data,pe=this.toBBox(ge),le=[],we=[];ze||le.length;){if(ze||(ze=le.pop(),Q=le[le.length-1],de=we.pop(),fe=!0),ze.leaf){var J=ft(ge,ze.children,Me);if(-1!==J)return ze.children.splice(J,1),le.push(ze),this._condense(le),this}fe||ze.leaf||!Gt(ze,pe)?Q?(de++,ze=Q.children[de],fe=!1):ze=null:(le.push(ze),we.push(de),de=0,Q=ze,ze=ze.children[0])}return this},Ue.prototype.toBBox=function(ge){return ge},Ue.prototype.compareMinX=function(ge,Me){return ge.minX-Me.minX},Ue.prototype.compareMinY=function(ge,Me){return ge.minY-Me.minY},Ue.prototype.toJSON=function(){return this.data},Ue.prototype.fromJSON=function(ge){return this.data=ge,this},Ue.prototype._all=function(ge,Me){for(var de=[];ge;)ge.leaf?Me.push.apply(Me,ge.children):de.push.apply(de,ge.children),ge=de.pop();return Me},Ue.prototype._build=function(ge,Me,de,Q){var fe,ze=de-Me+1,pe=this._maxEntries;if(ze<=pe)return p(fe=Xt(ge.slice(Me,de+1)),this.toBBox),fe;Q||(Q=Math.ceil(Math.log(ze)/Math.log(pe)),pe=Math.ceil(ze/Math.pow(pe,Q-1))),(fe=Xt([])).leaf=!1,fe.height=Q;var le=Math.ceil(ze/pe),we=le*Math.ceil(Math.sqrt(pe));Dn(ge,Me,de,we,this.compareMinX);for(var J=Me;J<=de;J+=we){var _t=Math.min(J+we-1,de);Dn(ge,J,_t,le,this.compareMinY);for(var Ge=J;Ge<=_t;Ge+=le){var $e=Math.min(Ge+le-1,_t);fe.children.push(this._build(ge,Ge,$e,Q-1))}}return p(fe,this.toBBox),fe},Ue.prototype._chooseSubtree=function(ge,Me,de,Q){for(;Q.push(Me),!Me.leaf&&Q.length-1!==de;){for(var fe=1/0,ze=1/0,pe=void 0,le=0;le<Me.children.length;le++){var we=Me.children[le],J=Lt(we),_t=(Ge=ge,$e=we,(Math.max($e.maxX,Ge.maxX)-Math.min($e.minX,Ge.minX))*(Math.max($e.maxY,Ge.maxY)-Math.min($e.minY,Ge.minY))-J);_t<ze?(ze=_t,fe=J<fe?J:fe,pe=we):_t===ze&&J<fe&&(fe=J,pe=we)}Me=pe||Me.children[0]}var Ge,$e;return Me},Ue.prototype._insert=function(ge,Me,de){var Q=de?ge:this.toBBox(ge),fe=[],ze=this._chooseSubtree(Q,this.data,Me,fe);for(ze.children.push(ge),We(ze,Q);Me>=0&&fe[Me].children.length>this._maxEntries;)this._split(fe,Me),Me--;this._adjustParentBBoxes(Q,fe,Me)},Ue.prototype._split=function(ge,Me){var de=ge[Me],Q=de.children.length,fe=this._minEntries;this._chooseSplitAxis(de,fe,Q);var ze=this._chooseSplitIndex(de,fe,Q),pe=Xt(de.children.splice(ze,de.children.length-ze));pe.height=de.height,pe.leaf=de.leaf,p(de,this.toBBox),p(pe,this.toBBox),Me?ge[Me-1].children.push(pe):this._splitRoot(de,pe)},Ue.prototype._splitRoot=function(ge,Me){this.data=Xt([ge,Me]),this.data.height=ge.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},Ue.prototype._chooseSplitIndex=function(ge,Me,de){for(var Q,fe,ze,pe,le,we,J,_t=1/0,Ge=1/0,$e=Me;$e<=de-Me;$e++){var ue=Ce(ge,0,$e,this.toBBox),on=Ce(ge,$e,de,this.toBBox),kt=(fe=ue,ze=on,void 0,void 0,void 0,void 0,pe=Math.max(fe.minX,ze.minX),le=Math.max(fe.minY,ze.minY),we=Math.min(fe.maxX,ze.maxX),J=Math.min(fe.maxY,ze.maxY),Math.max(0,we-pe)*Math.max(0,J-le)),Ne=Lt(ue)+Lt(on);kt<_t?(_t=kt,Q=$e,Ge=Ne<Ge?Ne:Ge):kt===_t&&Ne<Ge&&(Ge=Ne,Q=$e)}return Q||de-Me},Ue.prototype._chooseSplitAxis=function(ge,Me,de){var Q=ge.leaf?this.compareMinX:dt,fe=ge.leaf?this.compareMinY:yt;this._allDistMargin(ge,Me,de,Q)<this._allDistMargin(ge,Me,de,fe)&&ge.children.sort(Q)},Ue.prototype._allDistMargin=function(ge,Me,de,Q){ge.children.sort(Q);for(var fe=this.toBBox,ze=Ce(ge,0,Me,fe),pe=Ce(ge,de-Me,de,fe),le=un(ze)+un(pe),we=Me;we<de-Me;we++){var J=ge.children[we];We(ze,ge.leaf?fe(J):J),le+=un(ze)}for(var _t=de-Me-1;_t>=Me;_t--){var Ge=ge.children[_t];We(pe,ge.leaf?fe(Ge):Ge),le+=un(pe)}return le},Ue.prototype._adjustParentBBoxes=function(ge,Me,de){for(var Q=de;Q>=0;Q--)We(Me[Q],ge)},Ue.prototype._condense=function(ge){for(var Me=ge.length-1,de=void 0;Me>=0;Me--)0===ge[Me].children.length?Me>0?(de=ge[Me-1].children).splice(de.indexOf(ge[Me]),1):this.clear():p(ge[Me],this.toBBox)},Ue}()},6952:(xn,It,He)=>{var Te=He(1356),Ue=He(3407),ft=He(2e3),p=He(2342),Ce=He(9235),We=He(2374),dt=Date.prototype.getTime;function Lt(Tt){return null==Tt}function un(Tt){return!(!Tt||"object"!=typeof Tt||"number"!=typeof Tt.length||"function"!=typeof Tt.copy||"function"!=typeof Tt.slice||Tt.length>0&&"number"!=typeof Tt[0])}xn.exports=function yt(Tt,Xt,Dn){var ge=Dn||{};return!!(ge.strict?ft(Tt,Xt):Tt===Xt)||(!Tt||!Xt||"object"!=typeof Tt&&"object"!=typeof Xt?ge.strict?ft(Tt,Xt):Tt==Xt:function Gt(Tt,Xt,Dn){var ge,Me;if(typeof Tt!=typeof Xt||Lt(Tt)||Lt(Xt)||Tt.prototype!==Xt.prototype||Ue(Tt)!==Ue(Xt))return!1;var de=p(Tt),Q=p(Xt);if(de!==Q)return!1;if(de||Q)return Tt.source===Xt.source&&Ce(Tt)===Ce(Xt);if(We(Tt)&&We(Xt))return dt.call(Tt)===dt.call(Xt);var fe=un(Tt),ze=un(Xt);if(fe!==ze)return!1;if(fe||ze){if(Tt.length!==Xt.length)return!1;for(ge=0;ge<Tt.length;ge++)if(Tt[ge]!==Xt[ge])return!1;return!0}if(typeof Tt!=typeof Xt)return!1;try{var pe=Te(Tt),le=Te(Xt)}catch{return!1}if(pe.length!==le.length)return!1;for(pe.sort(),le.sort(),ge=pe.length-1;ge>=0;ge--)if(pe[ge]!=le[ge])return!1;for(ge=pe.length-1;ge>=0;ge--)if(!yt(Tt[Me=pe[ge]],Xt[Me],Dn))return!1;return!0}(Tt,Xt,ge))}},2358:(xn,It,He)=>{"use strict";var Te=He(1356),Ue="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),ft=Object.prototype.toString,p=Array.prototype.concat,Ce=Object.defineProperty,dt=He(7027)(),yt=Ce&&dt,Lt=function(Gt,Tt,Xt,Dn){Tt in Gt&&(!function(Gt){return"function"==typeof Gt&&"[object Function]"===ft.call(Gt)}(Dn)||!Dn())||(yt?Ce(Gt,Tt,{configurable:!0,enumerable:!1,value:Xt,writable:!0}):Gt[Tt]=Xt)},un=function(Gt,Tt){var Xt=arguments.length>2?arguments[2]:{},Dn=Te(Tt);Ue&&(Dn=p.call(Dn,Object.getOwnPropertySymbols(Tt)));for(var ge=0;ge<Dn.length;ge+=1)Lt(Gt,Dn[ge],Tt[Dn[ge]],Xt[Dn[ge]])};un.supportsDescriptors=!!yt,xn.exports=un},1817:xn=>{function It(He,Te,Ue,ft){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(He,Te,Ue,ft)}It.prototype.run=function(He,Te,Ue,ft){this._init(He,Te,Ue,ft);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var Ce=this._regionQuery(p);if(Ce.length<this.minPts)this.noise.push(p);else{var We=this.clusters.length;this.clusters.push([]),this._addToCluster(p,We),this._expandCluster(We,Ce)}}return this.clusters},It.prototype._init=function(He,Te,Ue,ft){if(He){if(!(He instanceof Array))throw Error("Dataset must be of type array, "+typeof He+" given");this.dataset=He,this.clusters=[],this.noise=[],this._datasetLength=He.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}Te&&(this.epsilon=Te),Ue&&(this.minPts=Ue),ft&&(this.distance=ft)},It.prototype._expandCluster=function(He,Te){for(var Ue=0;Ue<Te.length;Ue++){var ft=Te[Ue];if(1!==this._visited[ft]){this._visited[ft]=1;var p=this._regionQuery(ft);p.length>=this.minPts&&(Te=this._mergeArrays(Te,p))}1!==this._assigned[ft]&&this._addToCluster(ft,He)}},It.prototype._addToCluster=function(He,Te){this.clusters[Te].push(He),this._assigned[He]=1},It.prototype._regionQuery=function(He){for(var Te=[],Ue=0;Ue<this._datasetLength;Ue++)this.distance(this.dataset[He],this.dataset[Ue])<this.epsilon&&Te.push(Ue);return Te},It.prototype._mergeArrays=function(He,Te){for(var Ue=Te.length,ft=0;ft<Ue;ft++){var p=Te[ft];He.indexOf(p)<0&&He.push(p)}return He},It.prototype._euclideanDistance=function(He,Te){for(var Ue=0,ft=Math.min(He.length,Te.length);ft--;)Ue+=(He[ft]-Te[ft])*(He[ft]-Te[ft]);return Math.sqrt(Ue)},xn.exports&&(xn.exports=It)},4273:xn=>{function It(He,Te,Ue){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(He,Te,Ue)}It.prototype.init=function(He,Te,Ue){this.assignments=[],this.centroids=[],typeof He<"u"&&(this.dataset=He),typeof Te<"u"&&(this.k=Te),typeof Ue<"u"&&(this.distance=Ue)},It.prototype.run=function(He,Te){this.init(He,Te);for(var Ue=this.dataset.length,ft=0;ft<this.k;ft++)this.centroids[ft]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var Ce=0;Ce<this.k;Ce++){for(var We=new Array(un),dt=0,yt=0;yt<un;yt++)We[yt]=0;for(var Lt=0;Lt<Ue;Lt++){var un=this.dataset[Lt].length;if(Ce===this.assignments[Lt]){for(yt=0;yt<un;yt++)We[yt]+=this.dataset[Lt][yt];dt++}}if(dt>0){for(yt=0;yt<un;yt++)We[yt]/=dt;this.centroids[Ce]=We}else this.centroids[Ce]=this.randomCentroid(),p=!0}}return this.getClusters()},It.prototype.randomCentroid=function(){var Te,Ue,He=this.dataset.length-1;do{Ue=Math.round(Math.random()*He),Te=this.dataset[Ue]}while(this.centroids.indexOf(Te)>=0);return Te},It.prototype.assign=function(){for(var Ue,He=!1,Te=this.dataset.length,ft=0;ft<Te;ft++)(Ue=this.argmin(this.dataset[ft],this.centroids,this.distance))!=this.assignments[ft]&&(this.assignments[ft]=Ue,He=!0);return He},It.prototype.getClusters=function(){for(var Te,He=new Array(this.k),Ue=0;Ue<this.assignments.length;Ue++)typeof He[Te=this.assignments[Ue]]>"u"&&(He[Te]=[]),He[Te].push(Ue);return He},It.prototype.argmin=function(He,Te,Ue){for(var We,ft=Number.MAX_VALUE,p=0,Ce=Te.length,dt=0;dt<Ce;dt++)(We=Ue(He,Te[dt]))<ft&&(ft=We,p=dt);return p},It.prototype.distance=function(He,Te){for(var Ue=0,ft=Math.min(He.length,Te.length);ft--;){var p=He[ft]-Te[ft];Ue+=p*p}return Math.sqrt(Ue)},xn.exports&&(xn.exports=It)},8680:(xn,It,He)=>{if(xn.exports)var Te=He(8759);function Ue(ft,p,Ce,We){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(ft,p,Ce,We)}Ue.prototype.run=function(ft,p,Ce,We){this._init(ft,p,Ce,We);for(var dt=0,yt=this.dataset.length;dt<yt;dt++)if(1!==this._processed[dt]){this._processed[dt]=1,this.clusters.push([dt]);var Lt=this.clusters.length-1;this._orderedList.push(dt);var un=new Te(null,null,"asc"),Gt=this._regionQuery(dt);void 0!==this._distanceToCore(dt)&&(this._updateQueue(dt,Gt,un),this._expandCluster(Lt,un))}return this.clusters},Ue.prototype.getReachabilityPlot=function(){for(var ft=[],p=0,Ce=this._orderedList.length;p<Ce;p++){var We=this._orderedList[p];ft.push([We,this._reachability[We]])}return ft},Ue.prototype._init=function(ft,p,Ce,We){if(ft){if(!(ft instanceof Array))throw Error("Dataset must be of type array, "+typeof ft+" given");this.dataset=ft,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),Ce&&(this.minPts=Ce),We&&(this.distance=We)},Ue.prototype._updateQueue=function(ft,p,Ce){var We=this;this._coreDistance=this._distanceToCore(ft),p.forEach(function(dt){if(void 0===We._processed[dt]){var yt=We.distance(We.dataset[ft],We.dataset[dt]),Lt=Math.max(We._coreDistance,yt);void 0===We._reachability[dt]?(We._reachability[dt]=Lt,Ce.insert(dt,Lt)):Lt<We._reachability[dt]&&(We._reachability[dt]=Lt,Ce.remove(dt),Ce.insert(dt,Lt))}})},Ue.prototype._expandCluster=function(ft,p){for(var Ce=p.getElements(),We=0,dt=Ce.length;We<dt;We++){var yt=Ce[We];if(void 0===this._processed[yt]){var Lt=this._regionQuery(yt);this._processed[yt]=1,this.clusters[ft].push(yt),this._orderedList.push(yt),void 0!==this._distanceToCore(yt)&&(this._updateQueue(yt,Lt,p),this._expandCluster(ft,p))}}},Ue.prototype._distanceToCore=function(ft){for(var p=this.epsilon,Ce=0;Ce<p;Ce++)if(this._regionQuery(ft,Ce).length>=this.minPts)return Ce},Ue.prototype._regionQuery=function(ft,p){p=p||this.epsilon;for(var Ce=[],We=0,dt=this.dataset.length;We<dt;We++)this.distance(this.dataset[ft],this.dataset[We])<p&&Ce.push(We);return Ce},Ue.prototype._euclideanDistance=function(ft,p){for(var Ce=0,We=Math.min(ft.length,p.length);We--;)Ce+=(ft[We]-p[We])*(ft[We]-p[We]);return Math.sqrt(Ce)},xn.exports&&(xn.exports=Ue)},8759:xn=>{function It(He,Te,Ue){this._queue=[],this._priorities=[],this._sorting="desc",this._init(He,Te,Ue)}It.prototype.insert=function(He,Te){for(var Ue=this._queue.length,ft=Ue;ft--;){var p=this._priorities[ft];"desc"===this._sorting?Te>p&&(Ue=ft):Te<p&&(Ue=ft)}this._insertAt(He,Te,Ue)},It.prototype.remove=function(He){for(var Te=this._queue.length;Te--;)if(He===this._queue[Te]){this._queue.splice(Te,1),this._priorities.splice(Te,1);break}},It.prototype.forEach=function(He){this._queue.forEach(He)},It.prototype.getElements=function(){return this._queue},It.prototype.getElementPriority=function(He){return this._priorities[He]},It.prototype.getPriorities=function(){return this._priorities},It.prototype.getElementsWithPriorities=function(){for(var He=[],Te=0,Ue=this._queue.length;Te<Ue;Te++)He.push([this._queue[Te],this._priorities[Te]]);return He},It.prototype._init=function(He,Te,Ue){if(He&&Te){if(this._queue=[],this._priorities=[],He.length!==Te.length)throw new Error("Arrays must have the same length");for(var ft=0;ft<He.length;ft++)this.insert(He[ft],Te[ft])}Ue&&(this._sorting=Ue)},It.prototype._insertAt=function(He,Te,Ue){this._queue.length===Ue?(this._queue.push(He),this._priorities.push(Te)):(this._queue.splice(Ue,0,He),this._priorities.splice(Ue,0,Te))},xn.exports&&(xn.exports=It)},7470:(xn,It,He)=>{xn.exports&&(xn.exports={DBSCAN:He(1817),KMEANS:He(4273),OPTICS:He(8680),PriorityQueue:He(8759)})},5469:xn=>{"use strict";function It(Ne,gt,Ee){Ee=Ee||2;var $t,Mn,jt,Xn,Qn,sr,kn,it=gt&&gt.length,vt=it?gt[0]*Ee:Ne.length,Re=He(Ne,0,vt,Ee,!0),Yt=[];if(!Re||Re.next===Re.prev)return Yt;if(it&&(Re=function dt(Ne,gt,Ee,it){var Re,Yt,jt,vt=[];for(Re=0,Yt=gt.length;Re<Yt;Re++)(jt=He(Ne,gt[Re]*it,Re<Yt-1?gt[Re+1]*it:Ne.length,it,!1))===jt.next&&(jt.steiner=!0),vt.push(ge(jt));for(vt.sort(yt),Re=0;Re<vt.length;Re++)Ee=Lt(vt[Re],Ee);return Ee}(Ne,gt,Re,Ee)),Ne.length>80*Ee){$t=jt=Ne[0],Mn=Xn=Ne[1];for(var zn=Ee;zn<vt;zn+=Ee)(Qn=Ne[zn])<$t&&($t=Qn),(sr=Ne[zn+1])<Mn&&(Mn=sr),Qn>jt&&(jt=Qn),sr>Xn&&(Xn=sr);kn=0!==(kn=Math.max(jt-$t,Xn-Mn))?32767/kn:0}return Ue(Re,Yt,Ee,$t,Mn,kn,0),Yt}function He(Ne,gt,Ee,it,vt){var Re,Yt;if(vt===kt(Ne,gt,Ee,it)>0)for(Re=gt;Re<Ee;Re+=it)Yt=$e(Re,Ne[Re],Ne[Re+1],Yt);else for(Re=Ee-it;Re>=gt;Re-=it)Yt=$e(Re,Ne[Re],Ne[Re+1],Yt);return Yt&&fe(Yt,Yt.next)&&(ue(Yt),Yt=Yt.next),Yt}function Te(Ne,gt){if(!Ne)return Ne;gt||(gt=Ne);var it,Ee=Ne;do{if(it=!1,Ee.steiner||!fe(Ee,Ee.next)&&0!==Q(Ee.prev,Ee,Ee.next))Ee=Ee.next;else{if(ue(Ee),(Ee=gt=Ee.prev)===Ee.next)break;it=!0}}while(it||Ee!==gt);return gt}function Ue(Ne,gt,Ee,it,vt,Re,Yt){if(Ne){!Yt&&Re&&function Tt(Ne,gt,Ee,it){var vt=Ne;do{0===vt.z&&(vt.z=Dn(vt.x,vt.y,gt,Ee,it)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next}while(vt!==Ne);vt.prevZ.nextZ=null,vt.prevZ=null,function Xt(Ne){var gt,Ee,it,vt,Re,Yt,$t,Mn,jt=1;do{for(Ee=Ne,Ne=null,Re=null,Yt=0;Ee;){for(Yt++,it=Ee,$t=0,gt=0;gt<jt&&($t++,it=it.nextZ);gt++);for(Mn=jt;$t>0||Mn>0&&it;)0!==$t&&(0===Mn||!it||Ee.z<=it.z)?(vt=Ee,Ee=Ee.nextZ,$t--):(vt=it,it=it.nextZ,Mn--),Re?Re.nextZ=vt:Ne=vt,vt.prevZ=Re,Re=vt;Ee=it}Re.nextZ=null,jt*=2}while(Yt>1)}(vt)}(Ne,it,vt,Re);for(var Mn,jt,$t=Ne;Ne.prev!==Ne.next;)if(Mn=Ne.prev,jt=Ne.next,Re?p(Ne,it,vt,Re):ft(Ne))gt.push(Mn.i/Ee|0),gt.push(Ne.i/Ee|0),gt.push(jt.i/Ee|0),ue(Ne),Ne=jt.next,$t=jt.next;else if((Ne=jt)===$t){Yt?1===Yt?Ue(Ne=Ce(Te(Ne),gt,Ee),gt,Ee,it,vt,Re,2):2===Yt&&We(Ne,gt,Ee,it,vt,Re):Ue(Te(Ne),gt,Ee,it,vt,Re,1);break}}}function ft(Ne){var gt=Ne.prev,Ee=Ne,it=Ne.next;if(Q(gt,Ee,it)>=0)return!1;for(var vt=gt.x,Re=Ee.x,Yt=it.x,$t=gt.y,Mn=Ee.y,jt=it.y,Xn=vt<Re?vt<Yt?vt:Yt:Re<Yt?Re:Yt,Qn=$t<Mn?$t<jt?$t:jt:Mn<jt?Mn:jt,sr=vt>Re?vt>Yt?vt:Yt:Re>Yt?Re:Yt,kn=$t>Mn?$t>jt?$t:jt:Mn>jt?Mn:jt,zn=it.next;zn!==gt;){if(zn.x>=Xn&&zn.x<=sr&&zn.y>=Qn&&zn.y<=kn&&Me(vt,$t,Re,Mn,Yt,jt,zn.x,zn.y)&&Q(zn.prev,zn,zn.next)>=0)return!1;zn=zn.next}return!0}function p(Ne,gt,Ee,it){var vt=Ne.prev,Re=Ne,Yt=Ne.next;if(Q(vt,Re,Yt)>=0)return!1;for(var $t=vt.x,Mn=Re.x,jt=Yt.x,Xn=vt.y,Qn=Re.y,sr=Yt.y,kn=$t<Mn?$t<jt?$t:jt:Mn<jt?Mn:jt,zn=Xn<Qn?Xn<sr?Xn:sr:Qn<sr?Qn:sr,wn=$t>Mn?$t>jt?$t:jt:Mn>jt?Mn:jt,pr=Xn>Qn?Xn>sr?Xn:sr:Qn>sr?Qn:sr,Jr=Dn(kn,zn,gt,Ee,it),ki=Dn(wn,pr,gt,Ee,it),_r=Ne.prevZ,Or=Ne.nextZ;_r&&_r.z>=Jr&&Or&&Or.z<=ki;){if(_r.x>=kn&&_r.x<=wn&&_r.y>=zn&&_r.y<=pr&&_r!==vt&&_r!==Yt&&Me($t,Xn,Mn,Qn,jt,sr,_r.x,_r.y)&&Q(_r.prev,_r,_r.next)>=0||(_r=_r.prevZ,Or.x>=kn&&Or.x<=wn&&Or.y>=zn&&Or.y<=pr&&Or!==vt&&Or!==Yt&&Me($t,Xn,Mn,Qn,jt,sr,Or.x,Or.y)&&Q(Or.prev,Or,Or.next)>=0))return!1;Or=Or.nextZ}for(;_r&&_r.z>=Jr;){if(_r.x>=kn&&_r.x<=wn&&_r.y>=zn&&_r.y<=pr&&_r!==vt&&_r!==Yt&&Me($t,Xn,Mn,Qn,jt,sr,_r.x,_r.y)&&Q(_r.prev,_r,_r.next)>=0)return!1;_r=_r.prevZ}for(;Or&&Or.z<=ki;){if(Or.x>=kn&&Or.x<=wn&&Or.y>=zn&&Or.y<=pr&&Or!==vt&&Or!==Yt&&Me($t,Xn,Mn,Qn,jt,sr,Or.x,Or.y)&&Q(Or.prev,Or,Or.next)>=0)return!1;Or=Or.nextZ}return!0}function Ce(Ne,gt,Ee){var it=Ne;do{var vt=it.prev,Re=it.next.next;!fe(vt,Re)&&ze(vt,it,it.next,Re)&&J(vt,Re)&&J(Re,vt)&&(gt.push(vt.i/Ee|0),gt.push(it.i/Ee|0),gt.push(Re.i/Ee|0),ue(it),ue(it.next),it=Ne=Re),it=it.next}while(it!==Ne);return Te(it)}function We(Ne,gt,Ee,it,vt,Re){var Yt=Ne;do{for(var $t=Yt.next.next;$t!==Yt.prev;){if(Yt.i!==$t.i&&de(Yt,$t)){var Mn=Ge(Yt,$t);return Yt=Te(Yt,Yt.next),Mn=Te(Mn,Mn.next),Ue(Yt,gt,Ee,it,vt,Re,0),void Ue(Mn,gt,Ee,it,vt,Re,0)}$t=$t.next}Yt=Yt.next}while(Yt!==Ne)}function yt(Ne,gt){return Ne.x-gt.x}function Lt(Ne,gt){var Ee=function un(Ne,gt){var Yt,Ee=gt,it=Ne.x,vt=Ne.y,Re=-1/0;do{if(vt<=Ee.y&&vt>=Ee.next.y&&Ee.next.y!==Ee.y){var $t=Ee.x+(vt-Ee.y)*(Ee.next.x-Ee.x)/(Ee.next.y-Ee.y);if($t<=it&&$t>Re&&(Re=$t,Yt=Ee.x<Ee.next.x?Ee:Ee.next,$t===it))return Yt}Ee=Ee.next}while(Ee!==gt);if(!Yt)return null;var sr,Mn=Yt,jt=Yt.x,Xn=Yt.y,Qn=1/0;Ee=Yt;do{it>=Ee.x&&Ee.x>=jt&&it!==Ee.x&&Me(vt<Xn?it:Re,vt,jt,Xn,vt<Xn?Re:it,vt,Ee.x,Ee.y)&&(sr=Math.abs(vt-Ee.y)/(it-Ee.x),J(Ee,Ne)&&(sr<Qn||sr===Qn&&(Ee.x>Yt.x||Ee.x===Yt.x&&Gt(Yt,Ee)))&&(Yt=Ee,Qn=sr)),Ee=Ee.next}while(Ee!==Mn);return Yt}(Ne,gt);if(!Ee)return gt;var it=Ge(Ee,Ne);return Te(it,it.next),Te(Ee,Ee.next)}function Gt(Ne,gt){return Q(Ne.prev,Ne,gt.prev)<0&&Q(gt.next,Ne,Ne.next)<0}function Dn(Ne,gt,Ee,it,vt){return(Ne=1431655765&((Ne=858993459&((Ne=252645135&((Ne=16711935&((Ne=(Ne-Ee)*vt|0)|Ne<<8))|Ne<<4))|Ne<<2))|Ne<<1))|(gt=1431655765&((gt=858993459&((gt=252645135&((gt=16711935&((gt=(gt-it)*vt|0)|gt<<8))|gt<<4))|gt<<2))|gt<<1))<<1}function ge(Ne){var gt=Ne,Ee=Ne;do{(gt.x<Ee.x||gt.x===Ee.x&&gt.y<Ee.y)&&(Ee=gt),gt=gt.next}while(gt!==Ne);return Ee}function Me(Ne,gt,Ee,it,vt,Re,Yt,$t){return(vt-Yt)*(gt-$t)>=(Ne-Yt)*(Re-$t)&&(Ne-Yt)*(it-$t)>=(Ee-Yt)*(gt-$t)&&(Ee-Yt)*(Re-$t)>=(vt-Yt)*(it-$t)}function de(Ne,gt){return Ne.next.i!==gt.i&&Ne.prev.i!==gt.i&&!function we(Ne,gt){var Ee=Ne;do{if(Ee.i!==Ne.i&&Ee.next.i!==Ne.i&&Ee.i!==gt.i&&Ee.next.i!==gt.i&&ze(Ee,Ee.next,Ne,gt))return!0;Ee=Ee.next}while(Ee!==Ne);return!1}(Ne,gt)&&(J(Ne,gt)&&J(gt,Ne)&&function _t(Ne,gt){var Ee=Ne,it=!1,vt=(Ne.x+gt.x)/2,Re=(Ne.y+gt.y)/2;do{Ee.y>Re!=Ee.next.y>Re&&Ee.next.y!==Ee.y&&vt<(Ee.next.x-Ee.x)*(Re-Ee.y)/(Ee.next.y-Ee.y)+Ee.x&&(it=!it),Ee=Ee.next}while(Ee!==Ne);return it}(Ne,gt)&&(Q(Ne.prev,Ne,gt.prev)||Q(Ne,gt.prev,gt))||fe(Ne,gt)&&Q(Ne.prev,Ne,Ne.next)>0&&Q(gt.prev,gt,gt.next)>0)}function Q(Ne,gt,Ee){return(gt.y-Ne.y)*(Ee.x-gt.x)-(gt.x-Ne.x)*(Ee.y-gt.y)}function fe(Ne,gt){return Ne.x===gt.x&&Ne.y===gt.y}function ze(Ne,gt,Ee,it){var vt=le(Q(Ne,gt,Ee)),Re=le(Q(Ne,gt,it)),Yt=le(Q(Ee,it,Ne)),$t=le(Q(Ee,it,gt));return!!(vt!==Re&&Yt!==$t||0===vt&&pe(Ne,Ee,gt)||0===Re&&pe(Ne,it,gt)||0===Yt&&pe(Ee,Ne,it)||0===$t&&pe(Ee,gt,it))}function pe(Ne,gt,Ee){return gt.x<=Math.max(Ne.x,Ee.x)&&gt.x>=Math.min(Ne.x,Ee.x)&&gt.y<=Math.max(Ne.y,Ee.y)&&gt.y>=Math.min(Ne.y,Ee.y)}function le(Ne){return Ne>0?1:Ne<0?-1:0}function J(Ne,gt){return Q(Ne.prev,Ne,Ne.next)<0?Q(Ne,gt,Ne.next)>=0&&Q(Ne,Ne.prev,gt)>=0:Q(Ne,gt,Ne.prev)<0||Q(Ne,Ne.next,gt)<0}function Ge(Ne,gt){var Ee=new on(Ne.i,Ne.x,Ne.y),it=new on(gt.i,gt.x,gt.y),vt=Ne.next,Re=gt.prev;return Ne.next=gt,gt.prev=Ne,Ee.next=vt,vt.prev=Ee,it.next=Ee,Ee.prev=it,Re.next=it,it.prev=Re,it}function $e(Ne,gt,Ee,it){var vt=new on(Ne,gt,Ee);return it?(vt.next=it.next,vt.prev=it,it.next.prev=vt,it.next=vt):(vt.prev=vt,vt.next=vt),vt}function ue(Ne){Ne.next.prev=Ne.prev,Ne.prev.next=Ne.next,Ne.prevZ&&(Ne.prevZ.nextZ=Ne.nextZ),Ne.nextZ&&(Ne.nextZ.prevZ=Ne.prevZ)}function on(Ne,gt,Ee){this.i=Ne,this.x=gt,this.y=Ee,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kt(Ne,gt,Ee,it){for(var vt=0,Re=gt,Yt=Ee-it;Re<Ee;Re+=it)vt+=(Ne[Yt]-Ne[Re])*(Ne[Re+1]+Ne[Yt+1]),Yt=Re;return vt}xn.exports=It,xn.exports.default=It,It.deviation=function(Ne,gt,Ee,it){var vt=gt&&gt.length,Yt=Math.abs(kt(Ne,0,vt?gt[0]*Ee:Ne.length,Ee));if(vt)for(var $t=0,Mn=gt.length;$t<Mn;$t++)Yt-=Math.abs(kt(Ne,gt[$t]*Ee,$t<Mn-1?gt[$t+1]*Ee:Ne.length,Ee));var Qn=0;for($t=0;$t<it.length;$t+=3){var sr=it[$t]*Ee,kn=it[$t+1]*Ee,zn=it[$t+2]*Ee;Qn+=Math.abs((Ne[sr]-Ne[zn])*(Ne[kn+1]-Ne[sr+1])-(Ne[sr]-Ne[kn])*(Ne[zn+1]-Ne[sr+1]))}return 0===Yt&&0===Qn?0:Math.abs((Qn-Yt)/Yt)},It.flatten=function(Ne){for(var gt=Ne[0][0].length,Ee={vertices:[],holes:[],dimensions:gt},it=0,vt=0;vt<Ne.length;vt++){for(var Re=0;Re<Ne[vt].length;Re++)for(var Yt=0;Yt<gt;Yt++)Ee.vertices.push(Ne[vt][Re][Yt]);vt>0&&Ee.holes.push(it+=Ne[vt-1].length)}return Ee}},3457:xn=>{"use strict";var It="Function.prototype.bind called on incompatible ",He=Array.prototype.slice,Te=Object.prototype.toString,Ue="[object Function]";xn.exports=function(p){var Ce=this;if("function"!=typeof Ce||Te.call(Ce)!==Ue)throw new TypeError(It+Ce);for(var dt,We=He.call(arguments,1),yt=function(){if(this instanceof dt){var Xt=Ce.apply(this,We.concat(He.call(arguments)));return Object(Xt)===Xt?Xt:this}return Ce.apply(p,We.concat(He.call(arguments)))},Lt=Math.max(0,Ce.length-We.length),un=[],Gt=0;Gt<Lt;Gt++)un.push("$"+Gt);if(dt=Function("binder","return function ("+un.join(",")+"){ return binder.apply(this,arguments); }")(yt),Ce.prototype){var Tt=function(){};Tt.prototype=Ce.prototype,dt.prototype=new Tt,Tt.prototype=null}return dt}},4444:(xn,It,He)=>{"use strict";var Te=He(3457);xn.exports=Function.prototype.bind||Te},9582:xn=>{"use strict";var It=function(){return"string"==typeof function(){}.name},He=Object.getOwnPropertyDescriptor;if(He)try{He([],"length")}catch{He=null}It.functionsHaveConfigurableNames=function(){if(!It()||!He)return!1;var ft=He(function(){},"name");return!!ft&&!!ft.configurable};var Te=Function.prototype.bind;It.boundFunctionsHaveNames=function(){return It()&&"function"==typeof Te&&""!==function(){}.bind().name},xn.exports=It},5013:(xn,It,He)=>{var Te=He(6952),Ue=function(We){this.precision=We&&We.precision?We.precision:17,this.direction=!(!We||!We.direction)&&We.direction,this.pseudoNode=!(!We||!We.pseudoNode)&&We.pseudoNode,this.objectComparator=We&&We.objectComparator?We.objectComparator:Ce};function ft(We){return We.coordinates.map(function(dt){return{type:We.type.replace("Multi",""),coordinates:dt}})}function p(We,dt){return We.hasOwnProperty("coordinates")?We.coordinates.length===dt.coordinates.length:We.length===dt.length}function Ce(We,dt){return Te(We,dt,{strict:!0})}Ue.prototype.compare=function(We,dt){if(We.type!==dt.type||!p(We,dt))return!1;switch(We.type){case"Point":return this.compareCoord(We.coordinates,dt.coordinates);case"LineString":return this.compareLine(We.coordinates,dt.coordinates,0,!1);case"Polygon":return this.comparePolygon(We,dt);case"Feature":return this.compareFeature(We,dt);default:if(0===We.type.indexOf("Multi")){var yt=this,Lt=ft(We),un=ft(dt);return Lt.every(function(Gt){return this.some(function(Tt){return yt.compare(Gt,Tt)})},un)}}return!1},Ue.prototype.compareCoord=function(We,dt){if(We.length!==dt.length)return!1;for(var yt=0;yt<We.length;yt++)if(We[yt].toFixed(this.precision)!==dt[yt].toFixed(this.precision))return!1;return!0},Ue.prototype.compareLine=function(We,dt,yt,Lt){if(!p(We,dt))return!1;var un=this.pseudoNode?We:this.removePseudo(We),Gt=this.pseudoNode?dt:this.removePseudo(dt);if(!Lt||this.compareCoord(un[0],Gt[0])||(Gt=this.fixStartIndex(Gt,un))){var Tt=this.compareCoord(un[yt],Gt[yt]);return this.direction||Tt?this.comparePath(un,Gt):!!this.compareCoord(un[yt],Gt[Gt.length-(1+yt)])&&this.comparePath(un.slice().reverse(),Gt)}},Ue.prototype.fixStartIndex=function(We,dt){for(var yt,Lt=-1,un=0;un<We.length;un++)if(this.compareCoord(We[un],dt[0])){Lt=un;break}return Lt>=0&&(yt=[].concat(We.slice(Lt,We.length),We.slice(1,Lt+1))),yt},Ue.prototype.comparePath=function(We,dt){var yt=this;return We.every(function(Lt,un){return yt.compareCoord(Lt,this[un])},dt)},Ue.prototype.comparePolygon=function(We,dt){if(this.compareLine(We.coordinates[0],dt.coordinates[0],1,!0)){var yt=We.coordinates.slice(1,We.coordinates.length),Lt=dt.coordinates.slice(1,dt.coordinates.length),un=this;return yt.every(function(Gt){return this.some(function(Tt){return un.compareLine(Gt,Tt,1,!0)})},Lt)}return!1},Ue.prototype.compareFeature=function(We,dt){return!(We.id!==dt.id||!this.objectComparator(We.properties,dt.properties)||!this.compareBBox(We,dt))&&this.compare(We.geometry,dt.geometry)},Ue.prototype.compareBBox=function(We,dt){return!!(!We.bbox&&!dt.bbox||We.bbox&&dt.bbox&&this.compareCoord(We.bbox,dt.bbox))},Ue.prototype.removePseudo=function(We){return We},xn.exports=Ue},5406:(xn,It,He)=>{var Te=He(7192),Ue=He(8275),ft=He(3269),p=He(1503).Z,Ce=ft.featureEach,yt=Ue.featureCollection;function Lt(un){var Gt=new Te(un);return Gt.insert=function(Tt){if("Feature"!==Tt.type)throw new Error("invalid feature");return Tt.bbox=Tt.bbox?Tt.bbox:p(Tt),Te.prototype.insert.call(this,Tt)},Gt.load=function(Tt){var Xt=[];return Array.isArray(Tt)?Tt.forEach(function(Dn){if("Feature"!==Dn.type)throw new Error("invalid features");Dn.bbox=Dn.bbox?Dn.bbox:p(Dn),Xt.push(Dn)}):Ce(Tt,function(Dn){if("Feature"!==Dn.type)throw new Error("invalid features");Dn.bbox=Dn.bbox?Dn.bbox:p(Dn),Xt.push(Dn)}),Te.prototype.load.call(this,Xt)},Gt.remove=function(Tt,Xt){if("Feature"!==Tt.type)throw new Error("invalid feature");return Tt.bbox=Tt.bbox?Tt.bbox:p(Tt),Te.prototype.remove.call(this,Tt,Xt)},Gt.clear=function(){return Te.prototype.clear.call(this)},Gt.search=function(Tt){var Xt=Te.prototype.search.call(this,this.toBBox(Tt));return yt(Xt)},Gt.collides=function(Tt){return Te.prototype.collides.call(this,this.toBBox(Tt))},Gt.all=function(){var Tt=Te.prototype.all.call(this);return yt(Tt)},Gt.toJSON=function(){return Te.prototype.toJSON.call(this)},Gt.fromJSON=function(Tt){return Te.prototype.fromJSON.call(this,Tt)},Gt.toBBox=function(Tt){var Xt;if(Tt.bbox)Xt=Tt.bbox;else if(Array.isArray(Tt)&&4===Tt.length)Xt=Tt;else if(Array.isArray(Tt)&&6===Tt.length)Xt=[Tt[0],Tt[1],Tt[3],Tt[4]];else if("Feature"===Tt.type)Xt=p(Tt);else{if("FeatureCollection"!==Tt.type)throw new Error("invalid geojson");Xt=p(Tt)}return{minX:Xt[0],minY:Xt[1],maxX:Xt[2],maxY:Xt[3]}},Gt}xn.exports=Lt,xn.exports.default=Lt},7192:function(xn){xn.exports=function(){"use strict";function It(ge,Me,de,Q,fe){!function ze(pe,le,we,J,_t){for(;J>we;){if(J-we>600){var Ge=J-we+1,$e=le-we+1,ue=Math.log(Ge),on=.5*Math.exp(2*ue/3),kt=.5*Math.sqrt(ue*on*(Ge-on)/Ge)*($e-Ge/2<0?-1:1);ze(pe,le,Math.max(we,Math.floor(le-$e*on/Ge+kt)),Math.min(J,Math.floor(le+(Ge-$e)*on/Ge+kt)),_t)}var Ee=pe[le],it=we,vt=J;for(He(pe,we,le),_t(pe[J],Ee)>0&&He(pe,we,J);it<vt;){for(He(pe,it,vt),it++,vt--;_t(pe[it],Ee)<0;)it++;for(;_t(pe[vt],Ee)>0;)vt--}0===_t(pe[we],Ee)?He(pe,we,vt):He(pe,++vt,J),vt<=le&&(we=vt+1),le<=vt&&(J=vt-1)}}(ge,Me,de||0,Q||ge.length-1,fe||Te)}function He(ge,Me,de){var Q=ge[Me];ge[Me]=ge[de],ge[de]=Q}function Te(ge,Me){return ge<Me?-1:ge>Me?1:0}var Ue=function(ge){void 0===ge&&(ge=9),this._maxEntries=Math.max(4,ge),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function ft(ge,Me,de){if(!de)return Me.indexOf(ge);for(var Q=0;Q<Me.length;Q++)if(de(ge,Me[Q]))return Q;return-1}function p(ge,Me){Ce(ge,0,ge.children.length,Me,ge)}function Ce(ge,Me,de,Q,fe){fe||(fe=Xt(null)),fe.minX=1/0,fe.minY=1/0,fe.maxX=-1/0,fe.maxY=-1/0;for(var ze=Me;ze<de;ze++){var pe=ge.children[ze];We(fe,ge.leaf?Q(pe):pe)}return fe}function We(ge,Me){return ge.minX=Math.min(ge.minX,Me.minX),ge.minY=Math.min(ge.minY,Me.minY),ge.maxX=Math.max(ge.maxX,Me.maxX),ge.maxY=Math.max(ge.maxY,Me.maxY),ge}function dt(ge,Me){return ge.minX-Me.minX}function yt(ge,Me){return ge.minY-Me.minY}function Lt(ge){return(ge.maxX-ge.minX)*(ge.maxY-ge.minY)}function un(ge){return ge.maxX-ge.minX+(ge.maxY-ge.minY)}function Gt(ge,Me){return ge.minX<=Me.minX&&ge.minY<=Me.minY&&Me.maxX<=ge.maxX&&Me.maxY<=ge.maxY}function Tt(ge,Me){return Me.minX<=ge.maxX&&Me.minY<=ge.maxY&&Me.maxX>=ge.minX&&Me.maxY>=ge.minY}function Xt(ge){return{children:ge,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Dn(ge,Me,de,Q,fe){for(var ze=[Me,de];ze.length;)if(!((de=ze.pop())-(Me=ze.pop())<=Q)){var pe=Me+Math.ceil((de-Me)/Q/2)*Q;It(ge,pe,Me,de,fe),ze.push(Me,pe,pe,de)}}return Ue.prototype.all=function(){return this._all(this.data,[])},Ue.prototype.search=function(ge){var Me=this.data,de=[];if(!Tt(ge,Me))return de;for(var Q=this.toBBox,fe=[];Me;){for(var ze=0;ze<Me.children.length;ze++){var pe=Me.children[ze],le=Me.leaf?Q(pe):pe;Tt(ge,le)&&(Me.leaf?de.push(pe):Gt(ge,le)?this._all(pe,de):fe.push(pe))}Me=fe.pop()}return de},Ue.prototype.collides=function(ge){var Me=this.data;if(!Tt(ge,Me))return!1;for(var de=[];Me;){for(var Q=0;Q<Me.children.length;Q++){var fe=Me.children[Q],ze=Me.leaf?this.toBBox(fe):fe;if(Tt(ge,ze)){if(Me.leaf||Gt(ge,ze))return!0;de.push(fe)}}Me=de.pop()}return!1},Ue.prototype.load=function(ge){if(!ge||!ge.length)return this;if(ge.length<this._minEntries){for(var Me=0;Me<ge.length;Me++)this.insert(ge[Me]);return this}var de=this._build(ge.slice(),0,ge.length-1,0);if(this.data.children.length)if(this.data.height===de.height)this._splitRoot(this.data,de);else{if(this.data.height<de.height){var Q=this.data;this.data=de,de=Q}this._insert(de,this.data.height-de.height-1,!0)}else this.data=de;return this},Ue.prototype.insert=function(ge){return ge&&this._insert(ge,this.data.height-1),this},Ue.prototype.clear=function(){return this.data=Xt([]),this},Ue.prototype.remove=function(ge,Me){if(!ge)return this;for(var de,Q,fe,ze=this.data,pe=this.toBBox(ge),le=[],we=[];ze||le.length;){if(ze||(ze=le.pop(),Q=le[le.length-1],de=we.pop(),fe=!0),ze.leaf){var J=ft(ge,ze.children,Me);if(-1!==J)return ze.children.splice(J,1),le.push(ze),this._condense(le),this}fe||ze.leaf||!Gt(ze,pe)?Q?(de++,ze=Q.children[de],fe=!1):ze=null:(le.push(ze),we.push(de),de=0,Q=ze,ze=ze.children[0])}return this},Ue.prototype.toBBox=function(ge){return ge},Ue.prototype.compareMinX=function(ge,Me){return ge.minX-Me.minX},Ue.prototype.compareMinY=function(ge,Me){return ge.minY-Me.minY},Ue.prototype.toJSON=function(){return this.data},Ue.prototype.fromJSON=function(ge){return this.data=ge,this},Ue.prototype._all=function(ge,Me){for(var de=[];ge;)ge.leaf?Me.push.apply(Me,ge.children):de.push.apply(de,ge.children),ge=de.pop();return Me},Ue.prototype._build=function(ge,Me,de,Q){var fe,ze=de-Me+1,pe=this._maxEntries;if(ze<=pe)return p(fe=Xt(ge.slice(Me,de+1)),this.toBBox),fe;Q||(Q=Math.ceil(Math.log(ze)/Math.log(pe)),pe=Math.ceil(ze/Math.pow(pe,Q-1))),(fe=Xt([])).leaf=!1,fe.height=Q;var le=Math.ceil(ze/pe),we=le*Math.ceil(Math.sqrt(pe));Dn(ge,Me,de,we,this.compareMinX);for(var J=Me;J<=de;J+=we){var _t=Math.min(J+we-1,de);Dn(ge,J,_t,le,this.compareMinY);for(var Ge=J;Ge<=_t;Ge+=le){var $e=Math.min(Ge+le-1,_t);fe.children.push(this._build(ge,Ge,$e,Q-1))}}return p(fe,this.toBBox),fe},Ue.prototype._chooseSubtree=function(ge,Me,de,Q){for(;Q.push(Me),!Me.leaf&&Q.length-1!==de;){for(var fe=1/0,ze=1/0,pe=void 0,le=0;le<Me.children.length;le++){var we=Me.children[le],J=Lt(we),_t=(Ge=ge,$e=we,(Math.max($e.maxX,Ge.maxX)-Math.min($e.minX,Ge.minX))*(Math.max($e.maxY,Ge.maxY)-Math.min($e.minY,Ge.minY))-J);_t<ze?(ze=_t,fe=J<fe?J:fe,pe=we):_t===ze&&J<fe&&(fe=J,pe=we)}Me=pe||Me.children[0]}var Ge,$e;return Me},Ue.prototype._insert=function(ge,Me,de){var Q=de?ge:this.toBBox(ge),fe=[],ze=this._chooseSubtree(Q,this.data,Me,fe);for(ze.children.push(ge),We(ze,Q);Me>=0&&fe[Me].children.length>this._maxEntries;)this._split(fe,Me),Me--;this._adjustParentBBoxes(Q,fe,Me)},Ue.prototype._split=function(ge,Me){var de=ge[Me],Q=de.children.length,fe=this._minEntries;this._chooseSplitAxis(de,fe,Q);var ze=this._chooseSplitIndex(de,fe,Q),pe=Xt(de.children.splice(ze,de.children.length-ze));pe.height=de.height,pe.leaf=de.leaf,p(de,this.toBBox),p(pe,this.toBBox),Me?ge[Me-1].children.push(pe):this._splitRoot(de,pe)},Ue.prototype._splitRoot=function(ge,Me){this.data=Xt([ge,Me]),this.data.height=ge.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},Ue.prototype._chooseSplitIndex=function(ge,Me,de){for(var Q,fe,ze,pe,le,we,J,_t=1/0,Ge=1/0,$e=Me;$e<=de-Me;$e++){var ue=Ce(ge,0,$e,this.toBBox),on=Ce(ge,$e,de,this.toBBox),kt=(fe=ue,ze=on,void 0,void 0,void 0,void 0,pe=Math.max(fe.minX,ze.minX),le=Math.max(fe.minY,ze.minY),we=Math.min(fe.maxX,ze.maxX),J=Math.min(fe.maxY,ze.maxY),Math.max(0,we-pe)*Math.max(0,J-le)),Ne=Lt(ue)+Lt(on);kt<_t?(_t=kt,Q=$e,Ge=Ne<Ge?Ne:Ge):kt===_t&&Ne<Ge&&(Ge=Ne,Q=$e)}return Q||de-Me},Ue.prototype._chooseSplitAxis=function(ge,Me,de){var Q=ge.leaf?this.compareMinX:dt,fe=ge.leaf?this.compareMinY:yt;this._allDistMargin(ge,Me,de,Q)<this._allDistMargin(ge,Me,de,fe)&&ge.children.sort(Q)},Ue.prototype._allDistMargin=function(ge,Me,de,Q){ge.children.sort(Q);for(var fe=this.toBBox,ze=Ce(ge,0,Me,fe),pe=Ce(ge,de-Me,de,fe),le=un(ze)+un(pe),we=Me;we<de-Me;we++){var J=ge.children[we];We(ze,ge.leaf?fe(J):J),le+=un(ze)}for(var _t=de-Me-1;_t>=Me;_t--){var Ge=ge.children[_t];We(pe,ge.leaf?fe(Ge):Ge),le+=un(pe)}return le},Ue.prototype._adjustParentBBoxes=function(ge,Me,de){for(var Q=de;Q>=0;Q--)We(Me[Q],ge)},Ue.prototype._condense=function(ge){for(var Me=ge.length-1,de=void 0;Me>=0;Me--)0===ge[Me].children.length?Me>0?(de=ge[Me-1].children).splice(de.indexOf(ge[Me]),1):this.clear():p(ge[Me],this.toBBox)},Ue}()},5203:(xn,It,He)=>{"use strict";var Te,Ue=SyntaxError,ft=Function,p=TypeError,Ce=function($e){try{return ft('"use strict"; return ('+$e+").constructor;")()}catch{}},We=Object.getOwnPropertyDescriptor;if(We)try{We({},"")}catch{We=null}var dt=function(){throw new p},yt=We?function(){try{return dt}catch{try{return We(arguments,"callee").get}catch{return dt}}}():dt,Lt=He(2969)(),un=Object.getPrototypeOf||function($e){return $e.__proto__},Gt={},Tt=typeof Uint8Array>"u"?Te:un(Uint8Array),Xt={"%AggregateError%":typeof AggregateError>"u"?Te:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Te:ArrayBuffer,"%ArrayIteratorPrototype%":Lt?un([][Symbol.iterator]()):Te,"%AsyncFromSyncIteratorPrototype%":Te,"%AsyncFunction%":Gt,"%AsyncGenerator%":Gt,"%AsyncGeneratorFunction%":Gt,"%AsyncIteratorPrototype%":Gt,"%Atomics%":typeof Atomics>"u"?Te:Atomics,"%BigInt%":typeof BigInt>"u"?Te:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Te:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Te:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Te:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Te:FinalizationRegistry,"%Function%":ft,"%GeneratorFunction%":Gt,"%Int8Array%":typeof Int8Array>"u"?Te:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Te:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Te:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Lt?un(un([][Symbol.iterator]())):Te,"%JSON%":"object"==typeof JSON?JSON:Te,"%Map%":typeof Map>"u"?Te:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Lt?Te:un((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Te:Promise,"%Proxy%":typeof Proxy>"u"?Te:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Te:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Te:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Lt?Te:un((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Te:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Lt?un(""[Symbol.iterator]()):Te,"%Symbol%":Lt?Symbol:Te,"%SyntaxError%":Ue,"%ThrowTypeError%":yt,"%TypedArray%":Tt,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?Te:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Te:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Te:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Te:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Te:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Te:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Te:WeakSet},Dn=function $e(ue){var on;if("%AsyncFunction%"===ue)on=Ce("async function () {}");else if("%GeneratorFunction%"===ue)on=Ce("function* () {}");else if("%AsyncGeneratorFunction%"===ue)on=Ce("async function* () {}");else if("%AsyncGenerator%"===ue){var kt=$e("%AsyncGeneratorFunction%");kt&&(on=kt.prototype)}else if("%AsyncIteratorPrototype%"===ue){var Ne=$e("%AsyncGenerator%");Ne&&(on=un(Ne.prototype))}return Xt[ue]=on,on},ge={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Me=He(4444),de=He(3164),Q=Me.call(Function.call,Array.prototype.concat),fe=Me.call(Function.apply,Array.prototype.splice),ze=Me.call(Function.call,String.prototype.replace),pe=Me.call(Function.call,String.prototype.slice),le=Me.call(Function.call,RegExp.prototype.exec),we=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,J=/\\(\\)?/g,_t=function(ue){var on=pe(ue,0,1),kt=pe(ue,-1);if("%"===on&&"%"!==kt)throw new Ue("invalid intrinsic syntax, expected closing `%`");if("%"===kt&&"%"!==on)throw new Ue("invalid intrinsic syntax, expected opening `%`");var Ne=[];return ze(ue,we,function(gt,Ee,it,vt){Ne[Ne.length]=it?ze(vt,J,"$1"):Ee||gt}),Ne},Ge=function(ue,on){var Ne,kt=ue;if(de(ge,kt)&&(kt="%"+(Ne=ge[kt])[0]+"%"),de(Xt,kt)){var gt=Xt[kt];if(gt===Gt&&(gt=Dn(kt)),typeof gt>"u"&&!on)throw new p("intrinsic "+ue+" exists, but is not available. Please file an issue!");return{alias:Ne,name:kt,value:gt}}throw new Ue("intrinsic "+ue+" does not exist!")};xn.exports=function(ue,on){if("string"!=typeof ue||0===ue.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof on)throw new p('"allowMissing" argument must be a boolean');if(null===le(/^%?[^%]*%?$/,ue))throw new Ue("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var kt=_t(ue),Ne=kt.length>0?kt[0]:"",gt=Ge("%"+Ne+"%",on),Ee=gt.name,it=gt.value,vt=!1,Re=gt.alias;Re&&(Ne=Re[0],fe(kt,Q([0,1],Re)));for(var Yt=1,$t=!0;Yt<kt.length;Yt+=1){var Mn=kt[Yt],jt=pe(Mn,0,1),Xn=pe(Mn,-1);if(('"'===jt||"'"===jt||"`"===jt||'"'===Xn||"'"===Xn||"`"===Xn)&&jt!==Xn)throw new Ue("property names with quotes must have matching quotes");if(("constructor"===Mn||!$t)&&(vt=!0),de(Xt,Ee="%"+(Ne+="."+Mn)+"%"))it=Xt[Ee];else if(null!=it){if(!(Mn in it)){if(!on)throw new p("base intrinsic for "+ue+" exists, but the property is not available.");return}if(We&&Yt+1>=kt.length){var Qn=We(it,Mn);it=($t=!!Qn)&&"get"in Qn&&!("originalValue"in Qn.get)?Qn.get:it[Mn]}else $t=de(it,Mn),it=it[Mn];$t&&!vt&&(Xt[Ee]=it)}}return it}},7027:(xn,It,He)=>{"use strict";var Ue=He(5203)("%Object.defineProperty%",!0),ft=function(){if(Ue)try{return Ue({},"a",{value:1}),!0}catch{return!1}return!1};ft.hasArrayLengthDefineBug=function(){if(!ft())return null;try{return 1!==Ue([],"length",{value:1}).length}catch{return!0}},xn.exports=ft},2969:(xn,It,He)=>{"use strict";var Te=typeof Symbol<"u"&&Symbol,Ue=He(1983);xn.exports=function(){return"function"==typeof Te&&"function"==typeof Symbol&&"symbol"==typeof Te("foo")&&"symbol"==typeof Symbol("bar")&&Ue()}},1983:xn=>{"use strict";xn.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var He={},Te=Symbol("test"),Ue=Object(Te);if("string"==typeof Te||"[object Symbol]"!==Object.prototype.toString.call(Te)||"[object Symbol]"!==Object.prototype.toString.call(Ue))return!1;for(Te in He[Te]=42,He)return!1;if("function"==typeof Object.keys&&0!==Object.keys(He).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(He).length)return!1;var p=Object.getOwnPropertySymbols(He);if(1!==p.length||p[0]!==Te||!Object.prototype.propertyIsEnumerable.call(He,Te))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var Ce=Object.getOwnPropertyDescriptor(He,Te);if(42!==Ce.value||!0!==Ce.enumerable)return!1}return!0}},6259:(xn,It,He)=>{"use strict";var Te=He(1983);xn.exports=function(){return Te()&&!!Symbol.toStringTag}},3164:(xn,It,He)=>{"use strict";var Te=He(4444);xn.exports=Te.call(Function.call,Object.prototype.hasOwnProperty)},3407:(xn,It,He)=>{"use strict";var Te=He(6259)(),ft=He(5834)("Object.prototype.toString"),p=function(yt){return!(Te&&yt&&"object"==typeof yt&&Symbol.toStringTag in yt)&&"[object Arguments]"===ft(yt)},Ce=function(yt){return!!p(yt)||null!==yt&&"object"==typeof yt&&"number"==typeof yt.length&&yt.length>=0&&"[object Array]"!==ft(yt)&&"[object Function]"===ft(yt.callee)},We=function(){return p(arguments)}();p.isLegacyArguments=Ce,xn.exports=We?p:Ce},2374:(xn,It,He)=>{"use strict";var Te=Date.prototype.getDay,ft=Object.prototype.toString,Ce=He(6259)();xn.exports=function(dt){return"object"==typeof dt&&null!==dt&&(Ce?function(dt){try{return Te.call(dt),!0}catch{return!1}}(dt):"[object Date]"===ft.call(dt))}},2342:(xn,It,He)=>{"use strict";var ft,p,Ce,We,Te=He(5834),Ue=He(6259)();if(Ue){ft=Te("Object.prototype.hasOwnProperty"),p=Te("RegExp.prototype.exec"),Ce={};var dt=function(){throw Ce};We={toString:dt,valueOf:dt},"symbol"==typeof Symbol.toPrimitive&&(We[Symbol.toPrimitive]=dt)}var yt=Te("Object.prototype.toString"),Lt=Object.getOwnPropertyDescriptor;xn.exports=Ue?function(Tt){if(!Tt||"object"!=typeof Tt)return!1;var Xt=Lt(Tt,"lastIndex");if(!Xt||!ft(Xt,"value"))return!1;try{p(Tt,We)}catch(ge){return ge===Ce}}:function(Tt){return!(!Tt||"object"!=typeof Tt&&"function"!=typeof Tt)&&"[object RegExp]"===yt(Tt)}},9898:function(xn){xn.exports=function(){"use strict";var It,He,Te;function Ue(p,Ce){if(It)if(He){var We="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+It+")(sharedChunk); ("+He+")(sharedChunk); self.onerror = null;",dt={};It(dt),Te=Ce(dt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Te.workerUrl=window.URL.createObjectURL(new Blob([We],{type:"text/javascript"})))}else He=Ce;else It=Ce}return Ue(0,function(p){var Ce=typeof self<"u"?self:{},We="2.11.1";let dt;const yt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==dt){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{dt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{dt=s}}return dt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Lt={supported:!1,testSupport:function(s){!Tt&&Gt&&(Xt?Dn(s):un=s)}};let un,Gt,Tt=!1,Xt=!1;function Dn(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Gt),s.isContextLost())return;Lt.supported=!0}catch{}s.deleteTexture(i),Tt=!0}Ce.document&&(Gt=Ce.document.createElement("img"),Gt.onload=function(){un&&Dn(un),un=null,Xt=!0},Gt.onerror=function(){Tt=!0,un=null},Gt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ge="01";var Me=de;function de(s,i,a,f){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=a,this.p2y=f}de.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,f=0;f<8;f++){var m=this.sampleCurveX(a)-s;if(Math.abs(m)<i)return a;var w=this.sampleCurveDerivativeX(a);if(Math.abs(w)<1e-6)break;a-=m/w}var S=0,M=1;for(a=s,f=0;f<20&&(m=this.sampleCurveX(a),!(Math.abs(m-s)<i));f++)s>m?S=a:M=a,a=.5*(M-S)+S;return a},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Q=fe;function fe(s,i){this.x=s,this.y=i}fe.prototype={clone:function(){return new fe(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,a=s.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),a=Math.sin(s),f=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=f,this},_rotateAround:function(s,i){var a=Math.cos(s),f=Math.sin(s),m=i.y+f*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-f*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},fe.convert=function(s){return s instanceof fe?s:Array.isArray(s)?new fe(s[0],s[1]):s};const ze=Math.PI/180,pe=180/Math.PI;function le(s){return s*ze}function we(s){return s*pe}const J=[[0,0],[1,0],[1,1],[0,1]];function _t(s){if(s<=0)return 0;if(s>=1)return 1;const i=s*s,a=i*s;return 4*(s<.5?a:3*(s-i)+a-.75)}function Ge(s,i,a,f){const m=new Me(s,i,a,f);return function(w){return m.solve(w)}}const $e=Ge(.25,.1,.25,1);function ue(s,i,a){return Math.min(a,Math.max(i,s))}function on(s,i,a){return(a=ue((a-s)/(i-s),0,1))*a*(3-2*a)}function kt(s,i,a){const f=a-i,m=((s-i)%f+f)%f+i;return m===i?a:m}function Ne(s,i,a){if(!s.length)return a(null,[]);let f=s.length;const m=new Array(s.length);let w=null;s.forEach((S,M)=>{i(S,(P,R)=>{P&&(w=P),m[M]=R,0==--f&&a(w,m)})})}function gt(s){const i=[];for(const a in s)i.push(s[a]);return i}function Ee(s,...i){for(const a of i)for(const f in a)s[f]=a[f];return s}let it=1;function vt(){return it++}function Re(){return function s(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Yt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function $t(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function Mn(s,i){s.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function jt(s,i){return-1!==s.indexOf(i,s.length-i.length)}function Xn(s,i,a){const f={};for(const m in s)f[m]=i.call(a||this,s[m],m,s);return f}function Qn(s,i,a){const f={};for(const m in s)i.call(a||this,s[m],m,s)&&(f[m]=s[m]);return f}function sr(s){return Array.isArray(s)?s.map(sr):"object"==typeof s&&s?Xn(s,sr):s}const kn={};function zn(s){kn[s]||(typeof console<"u"&&console.warn(s),kn[s]=!0)}function wn(s,i,a){return(a.y-s.y)*(i.x-s.x)>(i.y-s.y)*(a.x-s.x)}function pr(s){let i=0;for(let a,f,m=0,w=s.length,S=w-1;m<w;S=m++)a=s[m],f=s[S],i+=(f.x-a.x)*(a.y+f.y);return i}function Jr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ki(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,f,m,w)=>{const S=m||w;return i[f]=!S||S.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let _r=null;function Or(s){if(null==_r){const i=s.navigator?s.navigator.userAgent:null;_r=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return _r}function St(s){try{const i=Ce[s];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function ve(s,i){return[s[4*i],s[4*i+1],s[4*i+2],s[4*i+3]]}const me="mapbox-tiles";let se,Ve,mt=500,qt=50;function pn(){try{return Ce.caches}catch{}}function yn(){pn()&&!se&&(se=Ce.caches.open(me))}function Kt(s){const i=s.indexOf("?");if(i<0)return s;const f=function(m){const w=m.indexOf("?");return w>0?m.slice(w+1).split("&"):[]}(s).filter(m=>{const w=m.split("=");return"language"===w[0]||"worldview"===w[0]});return f.length?`${s.slice(0,i)}?${f.join("&")}`:s.slice(0,i)}let Pr=1/0;const lr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(lr);class On extends Error{constructor(i,a,f){401===a&&Ys(f)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Lr=Jr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ce.location.protocol?Ce.parent:Ce).location.href,_i=function(s,i){if(!(/^file:/.test(a=s.url)||/^file:/.test(Lr())&&!/^\w+:/.test(a))){if(Ce.fetch&&Ce.Request&&Ce.AbortController&&Ce.Request.prototype.hasOwnProperty("signal"))return function(f,m){const w=new Ce.AbortController,S=new Ce.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Lr(),signal:w.signal});let M=!1,P=!1;const R=(z=S.url).indexOf("sku=")>0&&Ys(z);var z;"json"===f.type&&S.headers.set("Accept","application/json");const V=(Z,W,re)=>{if(P)return;if(Z&&"SecurityError"!==Z.message&&zn(Z),W&&re)return G(W);const be=Date.now();Ce.fetch(S).then(Xe=>{if(Xe.ok){const Ke=R?Xe.clone():null;return G(Xe,Ke,be)}return m(new On(Xe.statusText,Xe.status,f.url))}).catch(Xe=>{20!==Xe.code&&m(new Error(Xe.message))})},G=(Z,W,re)=>{("arrayBuffer"===f.type?Z.arrayBuffer():"json"===f.type?Z.json():Z.text()).then(be=>{P||(W&&re&&function(Xe,Ke,qe){if(yn(),!se)return;const Je={status:Ke.status,statusText:Ke.statusText,headers:new Ce.Headers};Ke.headers.forEach((Ut,Ot)=>Je.headers.set(Ot,Ut));const at=ki(Ke.headers.get("Cache-Control")||"");if(at["no-store"])return;at["max-age"]&&Je.headers.set("Expires",new Date(qe+1e3*at["max-age"]).toUTCString());const Qe=Je.headers.get("Expires");Qe&&(new Date(Qe).getTime()-qe<42e4||function(Ut,Ot){if(void 0===Ve)try{new Response(new ReadableStream),Ve=!0}catch{Ve=!1}Ve?Ot(Ut.body):Ut.blob().then(Ot)}(Ke,Ut=>{const Ot=new Ce.Response(Ut,Je);yn(),se&&se.then(rn=>rn.put(Kt(Xe.url),Ot)).catch(rn=>zn(rn.message))}))}(S,W,re),M=!0,m(null,be,Z.headers.get("Cache-Control"),Z.headers.get("Expires")))}).catch(be=>{P||m(new Error(be.message))})};return R?function(Z,W){if(yn(),!se)return W(null);const re=Kt(Z.url);se.then(be=>{be.match(re).then(Xe=>{const Ke=function(qe){if(!qe)return!1;const Je=new Date(qe.headers.get("Expires")||0),at=ki(qe.headers.get("Cache-Control")||"");return Je>Date.now()&&!at["no-cache"]}(Xe);be.delete(re),Ke&&be.put(re,Xe.clone()),W(null,Xe,Ke)}).catch(W)}).catch(W)}(S,V):V(null,null),{cancel:()=>{P=!0,M||w.abort()}}}(s,i);if(Jr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var a;return function(f,m){const w=new Ce.XMLHttpRequest;w.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(w.responseType="arraybuffer");for(const S in f.headers)w.setRequestHeader(S,f.headers[S]);return"json"===f.type&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials="include"===f.credentials,w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||0===w.status)&&null!==w.response){let S=w.response;if("json"===f.type)try{S=JSON.parse(w.response)}catch(M){return m(M)}m(null,S,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else m(new On(w.statusText,w.status,f.url))},w.send(f.body),{cancel:()=>w.abort()}}(s,i)},vi=function(s,i){return _i(Ee(s,{type:"arrayBuffer"}),i)};function Pi(s){const i=Ce.document.createElement("a");return i.href=s,i.protocol===Ce.document.location.protocol&&i.host===Ce.document.location.host}const Ri="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Sr,ds;Sr=[],ds=0;const Ko=function(s,i){if(Lt.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),ds>=yt.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return Sr.push(w),w}ds++;let a=!1;const f=()=>{if(!a)for(a=!0,ds--;Sr.length&&ds<yt.MAX_PARALLEL_IMAGE_REQUESTS;){const w=Sr.shift(),{requestParameters:S,callback:M,cancelled:P}=w;P||(w.cancel=Ko(S,M).cancel)}},m=vi(s,(w,S,M,P)=>{f(),w?i(w):S&&(Ce.createImageBitmap?function(R,z){const V=new Ce.Blob([new Uint8Array(R)],{type:"image/png"});Ce.createImageBitmap(V).then(G=>{z(null,G)}).catch(G=>{z(new Error(`Could not load image because of ${G.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(S,(R,z)=>i(R,z,M,P)):function(R,z){const V=new Ce.Image,G=Ce.URL;V.onload=()=>{z(null,V),G.revokeObjectURL(V.src),V.onload=null,Ce.requestAnimationFrame(()=>{V.src=Ri})},V.onerror=()=>z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const Z=new Ce.Blob([new Uint8Array(R)],{type:"image/png"});V.src=R.byteLength?G.createObjectURL(Z):Ri}(S,(R,z)=>i(R,z,M,P)))});return{cancel:()=>{m.cancel(),f()}}},Ns="NO_ACCESS_TOKEN";function Ci(s){return 0===s.indexOf("mapbox:")}function Ys(s){return yt.API_URL_REGEX.test(s)}function oi(s){return yt.API_STYLE_REGEX.test(s)&&!An(s)}function An(s){return yt.API_SPRITE_REGEX.test(s)}const Ks=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function as(s){const i=s.match(Ks);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function $r(s){const i=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${i}`}function Ha(s){if(!s)return null;const i=s.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(Ce.atob(i[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class ns{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=Ha(yt.ACCESS_TOKEN);let f="";return f=a&&a.u?Ce.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(m,w)=>String.fromCharCode(Number("0x"+w)))):yt.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${f}`:`mapbox.eventData:${f}`}fetchEventData(){const i=St("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{const m=Ce.localStorage.getItem(a);m&&(this.eventData=JSON.parse(m));const w=Ce.localStorage.getItem(f);w&&(this.anonId=w)}catch{zn("Unable to read from LocalStorage")}}saveEventData(){const i=St("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{Ce.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&Ce.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{zn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,f,m){if(!yt.EVENTS_URL)return;const w=as(yt.EVENTS_URL);w.params.push(`access_token=${m||yt.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(i).toISOString()},M=a?Ee(S,a):S,P={url:$r(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([M])};var z;this.pendingRequest=(z=R=>{this.pendingRequest=null,f(R),this.saveEventData(),this.processRequests(m)},_i(Ee(P,{method:"POST"}),z))}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const Oe=new class extends ns{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,i){yt.EVENTS_URL&&yt.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>Ci(a)||Ys(a))&&this.queueRequest(Date.now(),i)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Ha(yt.ACCESS_TOKEN),a=i?i.u:yt.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;$t(this.anonId)||(this.anonId=Re(),f=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(m),M=(m-this.eventData.lastSuccess)/864e5;f=f||M>=1||M<-1||w.getDate()!==S.getDate()}else f=!0;f?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:We,skuId:ge,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=m,this.eventData.tokenU=a)},s):this.processRequests()}},Y=Oe.postTurnstileEvent.bind(Oe),ie=new class extends ns{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,i,a,f){this.skuToken=i,this.errorCb=f,yt.EVENTS_URL&&(a||yt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(Ns)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),$t(this.anonId)||(this.anonId=Re()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:We,skuId:ge,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s))}},ke=ie.postMapLoadEvent.bind(ie),Ye=new class extends ns{constructor(){super("gljs.performance")}postPerformanceEvent(s,i){yt.EVENTS_URL&&(s||yt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:a}=this.queue.shift(),f=function(m){const w=Ce.performance.getEntriesByType("resource"),S=Ce.performance.getEntriesByType("mark"),M=function(G){const Z={};if(G)for(const W in G)if("other"!==W)for(const re of G[W]){const be=`${W}RequestCount`,Xe=`${W}ResolveRangeMin`,Ke=`${W}ResolveRangeMax`;Z[Xe]=Math.min(Z[Xe]||1/0,re.startTime),Z[Ke]=Math.max(Z[Ke]||-1/0,re.responseEnd),void 0===Z[be]&&(Z[be]=0),++Z[be]}return Z}(function(G,Z){const W={};if(G)for(const re of G){const be=Z(re);void 0===W[be]&&(W[be]=[]),W[be].push(re)}return W}(w,Rn)),P=Ce.devicePixelRatio,R=Ce.navigator.connection||Ce.navigator.mozConnection||Ce.navigator.webkitConnection,z={counters:[],metadata:[],attributes:[]},V=(G,Z,W)=>{null!=W&&G.push({name:Z,value:W.toString()})};for(const G in M)V(z.counters,G,M[G]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(V(z.counters,"interactionRangeMin",m.interactionRange[0]),V(z.counters,"interactionRangeMax",m.interactionRange[1])),S)for(const G of Object.keys(ht)){const Z=ht[G],W=S.find(re=>re.name===Z);W&&V(z.counters,Z,W.startTime)}return V(z.counters,"visibilityHidden",m.visibilityHidden),V(z.attributes,"style",function(G){if(G)for(const Z of G){const W=Z.name.split("?")[0];if(oi(W)){const re=W.split("/").slice(-2);if(2===re.length)return`mapbox://styles/${re[0]}/${re[1]}`}}}(w)),V(z.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),V(z.attributes,"fogEnabled",m.fogEnabled?"true":"false"),V(z.attributes,"projection",m.projection.name),V(z.attributes,"zoom",m.zoom),V(z.metadata,"devicePixelRatio",P),V(z.metadata,"connectionEffectiveType",R?R.effectiveType:void 0),V(z.metadata,"navigatorUserAgent",Ce.navigator.userAgent),V(z.metadata,"screenWidth",Ce.screen.width),V(z.metadata,"screenHeight",Ce.screen.height),V(z.metadata,"windowWidth",Ce.innerWidth),V(z.metadata,"windowHeight",Ce.innerHeight),V(z.metadata,"mapWidth",m.width/P),V(z.metadata,"mapHeight",m.height/P),V(z.metadata,"webglRenderer",m.renderer),V(z.metadata,"webglVendor",m.vendor),V(z.metadata,"sdkVersion",We),V(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(a);for(const m of f.metadata);for(const m of f.counters);for(const m of f.attributes);this.postEvent(i,f,()=>{},s)}},ot=Ye.postPerformanceEvent.bind(Ye),Mt=new class extends ns{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,i,a,f){if(!yt.API_URL||!yt.SESSION_PATH)return;const m=as(yt.API_URL+yt.SESSION_PATH);m.params.push(`sku=${i||""}`),m.params.push(`access_token=${f||yt.ACCESS_TOKEN||""}`);const w={url:$r(m),headers:{"Content-Type":"text/plain"}};var M;this.pendingRequest=(M=S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(f)},_i(Ee(w,{method:"GET"}),M))}getSessionAPI(s,i,a,f){this.skuToken=i,this.errorCb=f,yt.SESSION_PATH&&yt.API_URL&&(a||yt.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(Ns)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s)}},Ct=Mt.getSessionAPI.bind(Mt),lt=new Set,ht={create:"create",load:"load",fullLoad:"fullLoad"},nn={mark(s){Ce.performance.mark(s)},measure(s,i,a){Ce.performance.measure(s,i,a)}};function Rn(s){const i=s.name.split("?")[0];return i.includes("mapbox-gl.js")?"javascript":i.includes("mapbox-gl.css")?"css":yt.API_FONTS_REGEX.test(i)?"fontRange":An(i)?"sprite":oi(i)?"style":yt.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const cn=Ce.performance;function rr(s){const i=s?s.url.toString():void 0;return cn.getEntriesByName(i)}let cr,ir,Mr,Dr;const ji={now:()=>void 0!==Mr?Mr:Ce.performance.now(),setNow(s){Mr=s},restoreNow(){Mr=void 0},frame(s){const i=Ce.requestAnimationFrame(s);return{cancel:()=>Ce.cancelAnimationFrame(i)}},getImageData(s,i=0){const{width:a,height:f}=s;Dr||(Dr=Ce.document.createElement("canvas"));const m=Dr.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return(a>Dr.width||f>Dr.height)&&(Dr.width=a,Dr.height=f),m.clearRect(-i,-i,a+2*i,f+2*i),m.drawImage(s,0,0,a,f),m.getImageData(-i,-i,a+2*i,f+2*i)},resolveURL:s=>(cr||(cr=Ce.document.createElement("a")),cr.href=s,cr.href),get devicePixelRatio(){return Ce.devicePixelRatio},get prefersReducedMotion(){return!!Ce.matchMedia&&(null==ir&&(ir=Ce.matchMedia("(prefers-reduced-motion: reduce)")),ir.matches)}};function tr(s,i,a){a[s]&&-1!==a[s].indexOf(i)||(a[s]=a[s]||[],a[s].push(i))}function gr(s,i,a){if(a&&a[s]){const f=a[s].indexOf(i);-1!==f&&a[s].splice(f,1)}}class Gi{constructor(i,a={}){Ee(this,a),this.type=i}}class ks extends Gi{constructor(i,a={}){super("error",Ee({error:i},a))}}class ia{on(i,a){return this._listeners=this._listeners||{},tr(i,a,this._listeners),this}off(i,a){return gr(i,a,this._listeners),gr(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},tr(i,a,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,a){"string"==typeof i&&(i=new Gi(i,a||{}));const f=i.type;if(this.listens(f)){i.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const M of m)M.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const M of w)gr(f,M,this._oneTimeListeners),M.call(this,i);const S=this._eventedParent;S&&(Ee(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(i))}else i instanceof ks&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var zt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Na(s,...i){for(const a of i)for(const f in a)s[f]=a[f];return s}function so(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Hi(s){if(Array.isArray(s))return s.map(Hi);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const a in s)i[a]=Hi(s[a]);return i}return so(s)}class Ki extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}var du=Ki;class Ea{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[f,m]of a)this.bindings[f]=m}concat(i){return new Ea(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Ca=Ea;const Fi={kind:"null"},gn={kind:"number"},or={kind:"string"},Vr={kind:"boolean"},Eu={kind:"color"},sl={kind:"object"},hn={kind:"value"},Wu={kind:"collator"},oa={kind:"formatted"},Nl={kind:"resolvedImage"};function Br(s,i){return{kind:"array",itemType:s,N:i}}function Fn(s){if("array"===s.kind){const i=Fn(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const Cc=[Fi,gn,or,Vr,Eu,oa,sl,Br(hn),Nl];function k(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!k(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const a of Cc)if(!k(a,i))return null}return`Expected ${Fn(s)} but found ${Fn(i)} instead.`}function q(s,i){return i.some(a=>a.kind===s.kind)}function he(s,i){return i.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}var pt,Bt={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function je(s){return(s=Math.round(s))<0?0:s>255?255:s}function At(s){return je("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function Cn(s){return(i="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:i>1?1:i;var i}function vn(s,i,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?s+(i-s)*a*6:2*a<1?i:3*a<2?s+(i-s)*(2/3-a)*6:s}try{pt={}.parseCSSColor=function(s){var i,a=s.replace(/ /g,"").toLowerCase();if(a in Bt)return Bt[a].slice();if("#"===a[0])return 4===a.length?(i=parseInt(a.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===a.length&&(i=parseInt(a.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var f=a.indexOf("("),m=a.indexOf(")");if(-1!==f&&m+1===a.length){var w=a.substr(0,f),S=a.substr(f+1,m-(f+1)).split(","),M=1;switch(w){case"rgba":if(4!==S.length)return null;M=Cn(S.pop());case"rgb":return 3!==S.length?null:[At(S[0]),At(S[1]),At(S[2]),M];case"hsla":if(4!==S.length)return null;M=Cn(S.pop());case"hsl":if(3!==S.length)return null;var P=(parseFloat(S[0])%360+360)%360/360,R=Cn(S[1]),z=Cn(S[2]),V=z<=.5?z*(R+1):z+R-z*R,G=2*z-V;return[je(255*vn(G,V,P+1/3)),je(255*vn(G,V,P)),je(255*vn(G,V,P-1/3)),M];default:return null}}return null}}catch{}class jn{constructor(i,a,f,m=1){this.r=i,this.g=a,this.b=f,this.a=m}static parse(i){if(!i)return;if(i instanceof jn)return i;if("string"!=typeof i)return;const a=pt(i);return a?new jn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[i,a,f,m]=this.toArray();return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(f)},${m})`}toArray(){const{r:i,g:a,b:f,a:m}=this;return 0===m?[0,0,0,0]:[255*i/m,255*a/m,255*f/m,m]}toArray01(){const{r:i,g:a,b:f,a:m}=this;return 0===m?[0,0,0,0]:[i/m,a/m,f/m,m]}toArray01PremultipliedAlpha(){const{r:i,g:a,b:f,a:m}=this;return[i,a,f,m]}}jn.black=new jn(0,0,0,1),jn.white=new jn(1,1,1,1),jn.transparent=new jn(0,0,0,0),jn.red=new jn(1,0,0,1),jn.blue=new jn(0,0,1,1);var wt=jn;class Sn{constructor(i,a,f){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Pn{constructor(i,a,f,m,w){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=f,this.fontStack=m,this.textColor=w}}class $n{constructor(i){this.sections=i}static fromString(i){return new $n([new Pn(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof $n?i:$n.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.name]);continue}i.push(a.text);const f={};a.fontStack&&(f["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(f["font-scale"]=a.scale),a.textColor&&(f["text-color"]=["rgba"].concat(a.textColor.toArray())),i.push(f)}return i}}class Ar{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ar({name:i,available:!1}):null}serialize(){return["image",this.name]}}function $s(s,i,a,f){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,a,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[s,i,a,f]:[s,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function sn(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof wt||s instanceof Sn||s instanceof $n||s instanceof Ar)return!0;if(Array.isArray(s)){for(const i of s)if(!sn(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!sn(s[i]))return!1;return!0}return!1}function qn(s){if(null===s)return Fi;if("string"==typeof s)return or;if("boolean"==typeof s)return Vr;if("number"==typeof s)return gn;if(s instanceof wt)return Eu;if(s instanceof Sn)return Wu;if(s instanceof $n)return oa;if(s instanceof Ar)return Nl;if(Array.isArray(s)){const i=s.length;let a;for(const f of s){const m=qn(f);if(a){if(a===m)continue;a=hn;break}a=m}return Br(a||hn,i)}return sl}function Si(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof wt||s instanceof $n||s instanceof Ar?s.toString():JSON.stringify(s)}class ar{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(2!==i.length)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!sn(i[1]))return a.error("invalid value");const f=i[1];let m=qn(f);const w=a.expectedType;return"array"!==m.kind||0!==m.N||!w||"array"!==w.kind||"number"==typeof w.N&&0!==w.N||(m=w),new ar(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof wt?["rgba"].concat(this.value.toArray()):this.value instanceof $n?this.value.serialize():this.value}}var Rr=ar,Zn=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const Yu={string:or,number:gn,boolean:Vr,object:sl};class eu{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let f,m=1;const w=i[0];if("array"===w){let M,P;if(i.length>2){const R=i[1];if("string"!=typeof R||!(R in Yu)||"object"===R)return a.error('The item type argument of "array" must be one of string, number, boolean',1);M=Yu[R],m++}else M=hn;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);P=i[2],m++}f=Br(M,P)}else f=Yu[w];const S=[];for(;m<i.length;m++){const M=a.parse(i[m],m,hn);if(!M)return null;S.push(M)}return new eu(f,S)}evaluate(i){for(let a=0;a<this.args.length;a++){const f=this.args[a].evaluate(i);if(!k(this.type,qn(f)))return f;if(a===this.args.length-1)throw new Zn(`Expected value to be of type ${Fn(this.type)}, but found ${Fn(qn(f))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if("array"===i.kind){const f=i.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){a.push(f.kind);const m=i.N;("number"==typeof m||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map(f=>f.serialize()))}}var bn=eu;class ao{constructor(i){this.type=oa,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&"object"==typeof f)return a.error("First argument must be an image or text section.");const m=[];let w=!1;for(let S=1;S<=i.length-1;++S){const M=i[S];if(w&&"object"==typeof M&&!Array.isArray(M)){w=!1;let P=null;if(M["font-scale"]&&(P=a.parse(M["font-scale"],1,gn),!P))return null;let R=null;if(M["text-font"]&&(R=a.parse(M["text-font"],1,Br(or)),!R))return null;let z=null;if(M["text-color"]&&(z=a.parse(M["text-color"],1,Eu),!z))return null;const V=m[m.length-1];V.scale=P,V.font=R,V.textColor=z}else{const P=a.parse(i[S],1,hn);if(!P)return null;const R=P.type.kind;if("string"!==R&&"value"!==R&&"null"!==R&&"resolvedImage"!==R)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,m.push({content:P,scale:null,font:null,textColor:null})}}return new ao(m)}evaluate(i){return new $n(this.sections.map(a=>{const f=a.content.evaluate(i);return qn(f)===Nl?new Pn("",f,null,null,null):new Pn(Si(f),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const f={};a.scale&&(f["font-scale"]=a.scale.serialize()),a.font&&(f["text-font"]=a.font.serialize()),a.textColor&&(f["text-color"]=a.textColor.serialize()),i.push(f)}return i}}class Jo{constructor(i){this.type=Nl,this.input=i}static parse(i,a){if(2!==i.length)return a.error("Expected two arguments.");const f=a.parse(i[1],1,or);return f?new Jo(f):a.error("No image name provided.")}evaluate(i){const a=this.input.evaluate(i),f=Ar.fromString(a);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(a)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ca={"to-boolean":Vr,"to-color":Eu,"to-number":gn,"to-string":or};class pu{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const f=i[0];if(("to-boolean"===f||"to-string"===f)&&2!==i.length)return a.error("Expected one argument.");const m=ca[f],w=[];for(let S=1;S<i.length;S++){const M=a.parse(i[S],S,hn);if(!M)return null;w.push(M)}return new pu(m,w)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let a,f;for(const m of this.args){if(a=m.evaluate(i),f=null,a instanceof wt)return a;if("string"==typeof a){const w=i.parseColor(a);if(w)return w}else if(Array.isArray(a)&&(f=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:$s(a[0],a[1],a[2],a[3]),!f))return new wt(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Zn(f||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const f of this.args){if(a=f.evaluate(i),null===a)return 0;const m=Number(a);if(!isNaN(m))return m}throw new Zn(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?$n.fromString(Si(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?Ar.fromString(Si(this.args[0].evaluate(i))):Si(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ao([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Jo(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}var Ss=pu;const yl=["Unknown","Point","LineString","Polygon"];var vs=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?yl[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-s[0])+this.featureDistanceData.bearing[1]*(f*i-s[1])}return 0}parseColor(s){let i=this._parseColorCache[s];return i||(i=this._parseColorCache[s]=wt.parse(s)),i}};class al{constructor(i,a,f,m){this.name=i,this.type=a,this._evaluate=f,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const f=i[0],m=al.definitions[f];if(!m)return a.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(m)?m[0]:m.type,S=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,M=S.filter(([R])=>!Array.isArray(R)||R.length===i.length-1);let P=null;for(const[R,z]of M){P=new xr(a.registry,a.path,null,a.scope);const V=[];let G=!1;for(let Z=1;Z<i.length;Z++){const W=i[Z],re=Array.isArray(R)?R[Z-1]:R.type,be=P.parse(W,1+V.length,re);if(!be){G=!0;break}V.push(be)}if(!G)if(Array.isArray(R)&&R.length!==V.length)P.error(`Expected ${R.length} arguments, but found ${V.length} instead.`);else{for(let Z=0;Z<V.length;Z++){const W=Array.isArray(R)?R[Z]:R.type,re=V[Z];P.concat(Z+1).checkSubtype(W,re.type)}if(0===P.errors.length)return new al(f,w,z,V)}}if(1===M.length)a.errors.push(...P.errors);else{const R=(M.length?M:S).map(([V])=>{return G=V,Array.isArray(G)?`(${G.map(Fn).join(", ")})`:`(${Fn(G.type)}...)`;var G}).join(" | "),z=[];for(let V=1;V<i.length;V++){const G=a.parse(i[V],1+z.length);if(!G)return null;z.push(Fn(G.type))}a.error(`Expected arguments of type ${R}, but found (${z.join(", ")}) instead.`)}return null}static register(i,a){al.definitions=a;for(const f in a)i[f]=al}}var us=al;class uo{constructor(i,a,f){this.type=Wu,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(2!==i.length)return a.error("Expected one argument.");const f=i[1];if("object"!=typeof f||Array.isArray(f))return a.error("Collator options argument must be an object.");const m=a.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,Vr);if(!m)return null;const w=a.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,Vr);if(!w)return null;let S=null;return f.locale&&(S=a.parse(f.locale,1,or),!S)?null:new uo(m,w,S)}evaluate(i){return new Sn(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const jo=8192;function kl(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function Xr(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function Fs(s,i){const a=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(a*m*jo),Math.round(f*m*jo)]}function Hc(s,i,a){const f=s[0]-i[0],m=s[1]-i[1],w=s[0]-a[0],S=s[1]-a[1];return f*S-w*m==0&&f*w<=0&&m*S<=0}function ka(s,i){let a=!1;for(let S=0,M=i.length;S<M;S++){const P=i[S];for(let R=0,z=P.length;R<z-1;R++){if(Hc(s,P[R],P[R+1]))return!1;(m=P[R])[1]>(f=s)[1]!=(w=P[R+1])[1]>f[1]&&f[0]<(w[0]-m[0])*(f[1]-m[1])/(w[1]-m[1])+m[0]&&(a=!a)}}var f,m,w;return a}function sa(s,i){for(let a=0;a<i.length;a++)if(ka(s,i[a]))return!0;return!1}function Cu(s,i,a,f){const m=f[0]-a[0],w=f[1]-a[1],S=(s[0]-a[0])*w-m*(s[1]-a[1]),M=(i[0]-a[0])*w-m*(i[1]-a[1]);return S>0&&M<0||S<0&&M>0}function li(s,i,a){for(const R of a)for(let z=0;z<R.length-1;++z)if((M=[(S=R[z+1])[0]-(w=R[z])[0],S[1]-w[1]])[0]*(P=[(m=i)[0]-(f=s)[0],m[1]-f[1]])[1]-M[1]*P[0]!=0&&Cu(f,m,w,S)&&Cu(w,S,f,m))return!0;var f,m,w,S,M,P;return!1}function Ku(s,i){for(let a=0;a<s.length;++a)if(!ka(s[a],i))return!1;for(let a=0;a<s.length-1;++a)if(li(s[a],s[a+1],i))return!1;return!0}function tu(s,i){for(let a=0;a<i.length;a++)if(Ku(s,i[a]))return!0;return!1}function Su(s,i,a){const f=[];for(let m=0;m<s.length;m++){const w=[];for(let S=0;S<s[m].length;S++){const M=Fs(s[m][S],a);kl(i,M),w.push(M)}f.push(w)}return f}function Xi(s,i,a){const f=[];for(let m=0;m<s.length;m++){const w=Su(s[m],i,a);f.push(w)}return f}function vr(s,i,a,f){if(s[0]<a[0]||s[0]>a[2]){const m=.5*f;let w=s[0]-a[0]>m?-f:a[0]-s[0]>m?f:0;0===w&&(w=s[0]-a[2]>m?-f:a[2]-s[0]>m?f:0),s[0]+=w}kl(i,s)}function _l(s,i,a,f){const m=Math.pow(2,f.z)*jo,w=[f.x*jo,f.y*jo],S=[];if(!s)return S;for(const M of s)for(const P of M){const R=[P.x+w[0],P.y+w[1]];vr(R,i,a,m),S.push(R)}return S}function Fl(s,i,a,f){const m=Math.pow(2,f.z)*jo,w=[f.x*jo,f.y*jo],S=[];if(!s)return S;for(const P of s){const R=[];for(const z of P){const V=[z.x+w[0],z.y+w[1]];kl(i,V),R.push(V)}S.push(R)}if(i[2]-i[0]<=m/2){(M=i)[0]=M[1]=1/0,M[2]=M[3]=-1/0;for(const P of S)for(const R of P)vr(R,i,a,m)}var M;return S}class xs{constructor(i,a){this.type=Vr,this.geojson=i,this.geometries=a}static parse(i,a){if(2!==i.length)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(sn(i[1])){const f=i[1];if("FeatureCollection"===f.type)for(let m=0;m<f.features.length;++m){const w=f.features[m].geometry.type;if("Polygon"===w||"MultiPolygon"===w)return new xs(f,f.features[m].geometry)}else if("Feature"===f.type){const m=f.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new xs(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new xs(f,f)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(a,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=a.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=Su(f.coordinates,w,S),P=_l(a.geometry(),m,w,S);if(!Xr(m,w))return!1;for(const R of P)if(!ka(R,M))return!1}if("MultiPolygon"===f.type){const M=Xi(f.coordinates,w,S),P=_l(a.geometry(),m,w,S);if(!Xr(m,w))return!1;for(const R of P)if(!sa(R,M))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(a,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=a.canonicalID();if(!S)return!1;if("Polygon"===f.type){const M=Su(f.coordinates,w,S),P=Fl(a.geometry(),m,w,S);if(!Xr(m,w))return!1;for(const R of P)if(!Ku(R,M))return!1}if("MultiPolygon"===f.type){const M=Xi(f.coordinates,w,S),P=Fl(a.geometry(),m,w,S);if(!Xr(m,w))return!1;for(const R of P)if(!tu(R,M))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var gi=xs;function nu(s){if(s instanceof us&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof gi)return!1;let i=!0;return s.eachChild(a=>{i&&!nu(a)&&(i=!1)}),i}function ru(s){if(s instanceof us&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(a=>{i&&!ru(a)&&(i=!1)}),i}function Sa(s,i){if(s instanceof us&&i.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(f=>{a&&!Sa(f,i)&&(a=!1)}),a}class gu{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(2!==i.length||"string"!=typeof i[1])return a.error("'var' expression requires exactly one string literal argument.");const f=i[1];return a.scope.has(f)?new gu(f,a.scope.get(f)):a.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Gn=gu;class Ia{constructor(i,a=[],f,m=new Ca,w=[]){this.registry=i,this.path=a,this.key=a.map(S=>`[${S}]`).join(""),this.scope=m,this.errors=w,this.expectedType=f}parse(i,a,f,m,w={}){return a?this.concat(a,f,m)._parse(i,w):this._parse(i,w)}_parse(i,a){function f(m,w,S){return"assert"===S?new bn(w,[m]):"coerce"===S?new Ss(w,[m]):m}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[m];if(w){let S=w.parse(i,this);if(!S)return null;if(this.expectedType){const M=this.expectedType,P=S.type;if("string"!==M.kind&&"number"!==M.kind&&"boolean"!==M.kind&&"object"!==M.kind&&"array"!==M.kind||"value"!==P.kind)if("color"!==M.kind&&"formatted"!==M.kind&&"resolvedImage"!==M.kind||"value"!==P.kind&&"string"!==P.kind){if(this.checkSubtype(M,P))return null}else S=f(S,M,a.typeAnnotation||"coerce");else S=f(S,M,a.typeAnnotation||"assert")}if(!(S instanceof Rr)&&"resolvedImage"!==S.type.kind&&Fu(S)){const M=new vs;try{S=new Rr(S.type,S.evaluate(M))}catch(P){return this.error(P.message),null}}return S}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,f){const m="number"==typeof i?this.path.concat(i):this.path,w=f?this.scope.concat(f):this.scope;return new Ia(this.registry,m,a||null,w,this.errors)}error(i,...a){const f=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new du(f,i))}checkSubtype(i,a){const f=k(i,a);return f&&this.error(f),f}}var xr=Ia;function Fu(s){if(s instanceof Gn)return Fu(s.boundExpression);if(s instanceof us&&"error"===s.name||s instanceof uo||s instanceof gi)return!1;const i=s instanceof Ss||s instanceof bn;let a=!0;return s.eachChild(f=>{a=i?a&&Fu(f):a&&f instanceof Rr}),!!a&&nu(s)&&Sa(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Is(s,i){const a=s.length-1;let f,m,w=0,S=a,M=0;for(;w<=S;)if(M=Math.floor((w+S)/2),f=s[M],m=s[M+1],f<=i){if(M===a||i<m)return M;w=M+1}else{if(!(f>i))throw new Zn("Input is not a number.");S=M-1}return 0}class Ta{constructor(i,a,f){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[m,w]of f)this.labels.push(m),this.outputs.push(w)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const f=a.parse(i[1],1,gn);if(!f)return null;const m=[];let w=null;a.expectedType&&"value"!==a.expectedType.kind&&(w=a.expectedType);for(let S=1;S<i.length;S+=2){const M=1===S?-1/0:i[S],P=i[S+1],R=S,z=S+1;if("number"!=typeof M)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(m.length&&m[m.length-1][0]>=M)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const V=a.parse(P,z,w);if(!V)return null;w=w||V.type,m.push([M,V])}return new Ta(w,f,m)}evaluate(i){const a=this.labels,f=this.outputs;if(1===a.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return f[0].evaluate(i);const w=a.length;return m>=a[w-1]?f[w-1].evaluate(i):f[Is(a,m)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}var ci=Ta;function Ii(s,i,a){return s*(1-a)+i*a}var Ji=Object.freeze({__proto__:null,number:Ii,color:function(s,i,a){return new wt(Ii(s.r,i.r,a),Ii(s.g,i.g,a),Ii(s.b,i.b,a),Ii(s.a,i.a,a))},array:function(s,i,a){return s.map((f,m)=>Ii(f,i[m],a))}});const vl=4/29,zl=6/29,zs=3*zl*zl,mi=Math.PI/180,Wr=180/Math.PI;function zu(s){return s>.008856451679035631?Math.pow(s,1/3):s/zs+vl}function qs(s){return s>zl?s*s*s:zs*(s-vl)}function Js(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Bs(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function ou(s){const i=Bs(s.r),a=Bs(s.g),f=Bs(s.b),m=zu((.4124564*i+.3575761*a+.1804375*f)/.95047),w=zu((.2126729*i+.7151522*a+.072175*f)/1);return{l:116*w-16,a:500*(m-w),b:200*(w-zu((.0193339*i+.119192*a+.9503041*f)/1.08883)),alpha:s.a}}function ul(s){let i=(s.l+16)/116,a=isNaN(s.a)?i:i+s.a/500,f=isNaN(s.b)?i:i-s.b/200;return i=1*qs(i),a=.95047*qs(a),f=1.08883*qs(f),new wt(Js(3.2404542*a-1.5371385*i-.4985314*f),Js(-.969266*a+1.8760108*i+.041556*f),Js(.0556434*a-.2040259*i+1.0572252*f),s.alpha)}function Ju(s,i,a){const f=i-s;return s+a*(f>180||f<-180?f-360*Math.round(f/360):f)}const Ts={forward:ou,reverse:ul,interpolate:function(s,i,a){return{l:Ii(s.l,i.l,a),a:Ii(s.a,i.a,a),b:Ii(s.b,i.b,a),alpha:Ii(s.alpha,i.alpha,a)}}},mu={forward:function(s){const{l:i,a,b:f}=ou(s),m=Math.atan2(f,a)*Wr;return{h:m<0?m+360:m,c:Math.sqrt(a*a+f*f),l:i,alpha:s.a}},reverse:function(s){const i=s.h*mi,a=s.c;return ul({l:s.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:s.alpha})},interpolate:function(s,i,a){return{h:Ju(s.h,i.h,a),c:Ii(s.c,i.c,a),l:Ii(s.l,i.l,a),alpha:Ii(s.alpha,i.alpha,a)}}};var Zs=Object.freeze({__proto__:null,lab:Ts,hcl:mu});class Ma{constructor(i,a,f,m,w){this.type=i,this.operator=a,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[S,M]of w)this.labels.push(S),this.outputs.push(M)}static interpolationFactor(i,a,f,m){let w=0;if("exponential"===i.name)w=Qs(a,i.base,f,m);else if("linear"===i.name)w=Qs(a,1,f,m);else if("cubic-bezier"===i.name){const S=i.controlPoints;w=new Me(S[0],S[1],S[2],S[3]).solve(Qs(a,1,f,m))}return w}static parse(i,a){let[f,m,w,...S]=i;if(!Array.isArray(m)||0===m.length)return a.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const R=m[1];if("number"!=typeof R)return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:R}}else{if("cubic-bezier"!==m[0])return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const R=m.slice(1);if(4!==R.length||R.some(z=>"number"!=typeof z||z<0||z>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:R}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(w=a.parse(w,2,gn),!w)return null;const M=[];let P=null;"interpolate-hcl"===f||"interpolate-lab"===f?P=Eu:a.expectedType&&"value"!==a.expectedType.kind&&(P=a.expectedType);for(let R=0;R<S.length;R+=2){const z=S[R],V=S[R+1],G=R+3,Z=R+4;if("number"!=typeof z)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',G);if(M.length&&M[M.length-1][0]>=z)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',G);const W=a.parse(V,Z,P);if(!W)return null;P=P||W.type,M.push([z,W])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new Ma(P,f,m,w,M):a.error(`Type ${Fn(P)} is not interpolatable.`)}evaluate(i){const a=this.labels,f=this.outputs;if(1===a.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return f[0].evaluate(i);const w=a.length;if(m>=a[w-1])return f[w-1].evaluate(i);const S=Is(a,m),M=Ma.interpolationFactor(this.interpolation,m,a[S],a[S+1]),P=f[S].evaluate(i),R=f[S+1].evaluate(i);return"interpolate"===this.operator?Ji[this.type.kind.toLowerCase()](P,R,M):"interpolate-hcl"===this.operator?mu.reverse(mu.interpolate(mu.forward(P),mu.forward(R),M)):Ts.reverse(Ts.interpolate(Ts.forward(P),Ts.forward(R),M))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];for(let f=0;f<this.labels.length;f++)a.push(this.labels[f],this.outputs[f].serialize());return a}}function Qs(s,i,a,f){const m=f-a,w=s-a;return 0===m?0:1===i?w/m:(Math.pow(i,w)-1)/(Math.pow(i,m)-1)}var Et=Ma;class en{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let f=null;const m=a.expectedType;m&&"value"!==m.kind&&(f=m);const w=[];for(const M of i.slice(1)){const P=a.parse(M,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,w.push(P)}const S=m&&w.some(M=>k(m,M.type));return new en(S?hn:f,w)}evaluate(i){let a,f=null,m=0;for(const w of this.args){if(m++,f=w.evaluate(i),f&&f instanceof Ar&&!f.available&&(a||(a=f),f=null,m===this.args.length))return a;if(null!==f)break}return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var En=en;class hr{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let w=1;w<i.length-1;w+=2){const S=i[w];if("string"!=typeof S)return a.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return a.error("Variable names must contain only alphanumeric characters or '_'.",w);const M=a.parse(i[w+1],w+1);if(!M)return null;f.push([S,M])}const m=a.parse(i[i.length-1],i.length-1,a.expectedType,f);return m?new hr(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,f]of this.bindings)i.push(a,f.serialize());return i.push(this.result.serialize()),i}}var Nr=hr;class mr{constructor(i,a,f){this.type=i,this.index=a,this.input=f}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,gn),m=a.parse(i[2],2,Br(a.expectedType||hn));return f&&m?new mr(m.type.itemType,f,m):null}evaluate(i){const a=this.index.evaluate(i),f=this.input.evaluate(i);if(a<0)throw new Zn(`Array index out of bounds: ${a} < 0.`);if(a>=f.length)throw new Zn(`Array index out of bounds: ${a} > ${f.length-1}.`);if(a!==Math.floor(a))throw new Zn(`Array index must be an integer, but found ${a} instead.`);return f[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var xi=mr;class zi{constructor(i,a){this.type=Vr,this.needle=i,this.haystack=a}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,hn),m=a.parse(i[2],2,hn);return f&&m?q(f.type,[Vr,or,gn,Fi,hn])?new zi(f,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(f.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(null==f)return!1;if(!he(a,["boolean","string","number","null"]))throw new Zn(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(qn(a))} instead.`);if(!he(f,["string","array"]))throw new Zn(`Expected second argument to be of type array or string, but found ${Fn(qn(f))} instead.`);return f.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ms=zi;class hi{constructor(i,a,f){this.type=gn,this.needle=i,this.haystack=a,this.fromIndex=f}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,hn),m=a.parse(i[2],2,hn);if(!f||!m)return null;if(!q(f.type,[Vr,or,gn,Fi,hn]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(f.type)} instead`);if(4===i.length){const w=a.parse(i[3],3,gn);return w?new hi(f,m,w):null}return new hi(f,m)}evaluate(i){const a=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!he(a,["boolean","string","number","null"]))throw new Zn(`Expected first argument to be of type boolean, string, number or null, but found ${Fn(qn(a))} instead.`);if(!he(f,["string","array"]))throw new Zn(`Expected second argument to be of type array or string, but found ${Fn(qn(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return f.indexOf(a,m)}return f.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Kn=hi;class Ur{constructor(i,a,f,m,w,S){this.inputType=i,this.type=a,this.input=f,this.cases=m,this.outputs=w,this.otherwise=S}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let f,m;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);const w={},S=[];for(let R=2;R<i.length-1;R+=2){let z=i[R];const V=i[R+1];Array.isArray(z)||(z=[z]);const G=a.concat(R);if(0===z.length)return G.error("Expected at least one branch label.");for(const W of z){if("number"!=typeof W&&"string"!=typeof W)return G.error("Branch labels must be numbers or strings.");if("number"==typeof W&&Math.abs(W)>Number.MAX_SAFE_INTEGER)return G.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof W&&Math.floor(W)!==W)return G.error("Numeric branch labels must be integer values.");if(f){if(G.checkSubtype(f,qn(W)))return null}else f=qn(W);if(void 0!==w[String(W)])return G.error("Branch labels must be unique.");w[String(W)]=S.length}const Z=a.parse(V,R,m);if(!Z)return null;m=m||Z.type,S.push(Z)}const M=a.parse(i[1],1,hn);if(!M)return null;const P=a.parse(i[i.length-1],i.length-1,m);return P?"value"!==M.type.kind&&a.concat(1).checkSubtype(f,M.type)?null:new Ur(f,m,M,w,S,P):null}evaluate(i){const a=this.input.evaluate(i);return(qn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),f=[],m={};for(const S of a){const M=m[this.cases[S]];void 0===M?(m[this.cases[S]]=f.length,f.push([this.cases[S],[S]])):f[M][1].push(S)}const w=S=>"number"===this.inputType.kind?Number(S):S;for(const[S,M]of f)i.push(1===M.length?w(M[0]):M.map(w)),i.push(this.outputs[S].serialize());return i.push(this.otherwise.serialize()),i}}var Zi=Ur;class rs{constructor(i,a,f){this.type=i,this.branches=a,this.otherwise=f}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let f;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);const m=[];for(let S=1;S<i.length-1;S+=2){const M=a.parse(i[S],S,Vr);if(!M)return null;const P=a.parse(i[S+1],S+1,f);if(!P)return null;m.push([M,P]),f=f||P.type}const w=a.parse(i[i.length-1],i.length-1,f);return w?new rs(f,m,w):null}evaluate(i){for(const[a,f]of this.branches)if(a.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,f]of this.branches)i(a),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var Fa=rs;class Vo{constructor(i,a,f,m){this.type=i,this.input=a,this.beginIndex=f,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,hn),m=a.parse(i[2],2,gn);if(!f||!m)return null;if(!q(f.type,[Br(hn),or,hn]))return a.error(`Expected first argument to be of type array or string, but found ${Fn(f.type)} instead`);if(4===i.length){const w=a.parse(i[3],3,gn);return w?new Vo(f.type,f,m,w):null}return new Vo(f.type,f,m)}evaluate(i){const a=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!he(a,["string","array"]))throw new Zn(`Expected first argument to be of type array or string, but found ${Fn(qn(a))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return a.slice(f,m)}return a.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Hs=Vo;function fi(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Xa(s,i,a,f){return 0===f.compare(i,a)}function ls(s,i,a){const f="=="!==s&&"!="!==s;return class PP{constructor(w,S,M){this.type=Vr,this.lhs=w,this.rhs=S,this.collator=M,this.hasUntypedArgument="value"===w.type.kind||"value"===S.type.kind}static parse(w,S){if(3!==w.length&&4!==w.length)return S.error("Expected two or three arguments.");const M=w[0];let P=S.parse(w[1],1,hn);if(!P)return null;if(!fi(M,P.type))return S.concat(1).error(`"${M}" comparisons are not supported for type '${Fn(P.type)}'.`);let R=S.parse(w[2],2,hn);if(!R)return null;if(!fi(M,R.type))return S.concat(2).error(`"${M}" comparisons are not supported for type '${Fn(R.type)}'.`);if(P.type.kind!==R.type.kind&&"value"!==P.type.kind&&"value"!==R.type.kind)return S.error(`Cannot compare types '${Fn(P.type)}' and '${Fn(R.type)}'.`);f&&("value"===P.type.kind&&"value"!==R.type.kind?P=new bn(R.type,[P]):"value"!==P.type.kind&&"value"===R.type.kind&&(R=new bn(P.type,[R])));let z=null;if(4===w.length){if("string"!==P.type.kind&&"string"!==R.type.kind&&"value"!==P.type.kind&&"value"!==R.type.kind)return S.error("Cannot use collator to compare non-string types.");if(z=S.parse(w[3],3,Wu),!z)return null}return new PP(P,R,z)}evaluate(w){const S=this.lhs.evaluate(w),M=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const P=qn(S),R=qn(M);if(P.kind!==R.kind||"string"!==P.kind&&"number"!==P.kind)throw new Zn(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${R.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=qn(S),R=qn(M);if("string"!==P.kind||"string"!==R.kind)return i(w,S,M)}return this.collator?a(w,S,M,this.collator.evaluate(w)):i(w,S,M)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}serialize(){const w=[s];return this.eachChild(S=>{w.push(S.serialize())}),w}}}const Qr=ls("==",function(s,i,a){return i===a},Xa),Qu=ls("!=",function(s,i,a){return i!==a},function(s,i,a,f){return!Xa(0,i,a,f)}),Qi=ls("<",function(s,i,a){return i<a},function(s,i,a,f){return f.compare(i,a)<0}),Vi=ls(">",function(s,i,a){return i>a},function(s,i,a,f){return f.compare(i,a)>0}),ha=ls("<=",function(s,i,a){return i<=a},function(s,i,a,f){return f.compare(i,a)<=0}),eo=ls(">=",function(s,i,a){return i>=a},function(s,i,a,f){return f.compare(i,a)>=0});class is{constructor(i,a,f,m,w,S){this.type=or,this.number=i,this.locale=a,this.currency=f,this.unit=m,this.minFractionDigits=w,this.maxFractionDigits=S}static parse(i,a){if(3!==i.length)return a.error("Expected two arguments.");const f=a.parse(i[1],1,gn);if(!f)return null;const m=i[2];if("object"!=typeof m||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let w=null;if(m.locale&&(w=a.parse(m.locale,1,or),!w))return null;let S=null;if(m.currency&&(S=a.parse(m.currency,1,or),!S))return null;let M=null;if(m.unit&&(M=a.parse(m.unit,1,or),!M))return null;let P=null;if(m["min-fraction-digits"]&&(P=a.parse(m["min-fraction-digits"],1,gn),!P))return null;let R=null;return m["max-fraction-digits"]&&(R=a.parse(m["max-fraction-digits"],1,gn),!R)?null:new is(f,w,S,M,P,R)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class fo{constructor(i){this.type=gn,this.input=i}static parse(i,a){if(2!==i.length)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=a.parse(i[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?a.error(`Expected argument of type string or array, but found ${Fn(f.type)} instead.`):new fo(f):null}evaluate(i){const a=this.input.evaluate(i);if("string"==typeof a||Array.isArray(a))return a.length;throw new Zn(`Expected value to be of type string or array, but found ${Fn(qn(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}const $i={"==":Qr,"!=":Qu,">":Vi,"<":Qi,">=":eo,"<=":ha,array:bn,at:xi,boolean:bn,case:Fa,coalesce:En,collator:uo,format:ao,image:Jo,in:Ms,"index-of":Kn,interpolate:Et,"interpolate-hcl":Et,"interpolate-lab":Et,length:fo,let:Nr,literal:Rr,match:Zi,number:bn,"number-format":is,object:bn,slice:Hs,step:ci,string:bn,"to-boolean":Ss,"to-color":Ss,"to-number":Ss,"to-string":Ss,var:Gn,within:gi};function su(s,[i,a,f,m]){i=i.evaluate(s),a=a.evaluate(s),f=f.evaluate(s);const w=m?m.evaluate(s):1,S=$s(i,a,f,w);if(S)throw new Zn(S);return new wt(i/255*w,a/255*w,f/255*w,w)}function Za(s,i){return s in i}function qi(s,i){const a=i[s];return void 0===a?null:a}function Go(s){return{type:s}}us.register($i,{error:[{kind:"error"},[or],(s,[i])=>{throw new Zn(i.evaluate(s))}],typeof:[or,[hn],(s,[i])=>Fn(qn(i.evaluate(s)))],"to-rgba":[Br(gn,4),[Eu],(s,[i])=>i.evaluate(s).toArray()],rgb:[Eu,[gn,gn,gn],su],rgba:[Eu,[gn,gn,gn,gn],su],has:{type:Vr,overloads:[[[or],(s,[i])=>Za(i.evaluate(s),s.properties())],[[or,sl],(s,[i,a])=>Za(i.evaluate(s),a.evaluate(s))]]},get:{type:hn,overloads:[[[or],(s,[i])=>qi(i.evaluate(s),s.properties())],[[or,sl],(s,[i,a])=>qi(i.evaluate(s),a.evaluate(s))]]},"feature-state":[hn,[or],(s,[i])=>qi(i.evaluate(s),s.featureState||{})],properties:[sl,[],s=>s.properties()],"geometry-type":[or,[],s=>s.geometryType()],id:[hn,[],s=>s.id()],zoom:[gn,[],s=>s.globals.zoom],pitch:[gn,[],s=>s.globals.pitch||0],"distance-from-center":[gn,[],s=>s.distanceFromCenter()],"heatmap-density":[gn,[],s=>s.globals.heatmapDensity||0],"line-progress":[gn,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[gn,[],s=>s.globals.skyRadialProgress||0],accumulated:[hn,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[gn,Go(gn),(s,i)=>{let a=0;for(const f of i)a+=f.evaluate(s);return a}],"*":[gn,Go(gn),(s,i)=>{let a=1;for(const f of i)a*=f.evaluate(s);return a}],"-":{type:gn,overloads:[[[gn,gn],(s,[i,a])=>i.evaluate(s)-a.evaluate(s)],[[gn],(s,[i])=>-i.evaluate(s)]]},"/":[gn,[gn,gn],(s,[i,a])=>i.evaluate(s)/a.evaluate(s)],"%":[gn,[gn,gn],(s,[i,a])=>i.evaluate(s)%a.evaluate(s)],ln2:[gn,[],()=>Math.LN2],pi:[gn,[],()=>Math.PI],e:[gn,[],()=>Math.E],"^":[gn,[gn,gn],(s,[i,a])=>Math.pow(i.evaluate(s),a.evaluate(s))],sqrt:[gn,[gn],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[gn,[gn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[gn,[gn],(s,[i])=>Math.log(i.evaluate(s))],log2:[gn,[gn],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[gn,[gn],(s,[i])=>Math.sin(i.evaluate(s))],cos:[gn,[gn],(s,[i])=>Math.cos(i.evaluate(s))],tan:[gn,[gn],(s,[i])=>Math.tan(i.evaluate(s))],asin:[gn,[gn],(s,[i])=>Math.asin(i.evaluate(s))],acos:[gn,[gn],(s,[i])=>Math.acos(i.evaluate(s))],atan:[gn,[gn],(s,[i])=>Math.atan(i.evaluate(s))],min:[gn,Go(gn),(s,i)=>Math.min(...i.map(a=>a.evaluate(s)))],max:[gn,Go(gn),(s,i)=>Math.max(...i.map(a=>a.evaluate(s)))],abs:[gn,[gn],(s,[i])=>Math.abs(i.evaluate(s))],round:[gn,[gn],(s,[i])=>{const a=i.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[gn,[gn],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[gn,[gn],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Vr,[or,hn],(s,[i,a])=>s.properties()[i.value]===a.value],"filter-id-==":[Vr,[hn],(s,[i])=>s.id()===i.value],"filter-type-==":[Vr,[or],(s,[i])=>s.geometryType()===i.value],"filter-<":[Vr,[or,hn],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f<m}],"filter-id-<":[Vr,[hn],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a<f}],"filter->":[Vr,[or,hn],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f>m}],"filter-id->":[Vr,[hn],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a>f}],"filter-<=":[Vr,[or,hn],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[Vr,[hn],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a<=f}],"filter->=":[Vr,[or,hn],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[Vr,[hn],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a>=f}],"filter-has":[Vr,[hn],(s,[i])=>i.value in s.properties()],"filter-has-id":[Vr,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[Vr,[Br(or)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Vr,[Br(hn)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Vr,[or,Br(hn)],(s,[i,a])=>a.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Vr,[or,Br(hn)],(s,[i,a])=>function(f,m,w,S){for(;w<=S;){const M=w+S>>1;if(m[M]===f)return!0;m[M]>f?S=M-1:w=M+1}return!1}(s.properties()[i.value],a.value,0,a.value.length-1)],all:{type:Vr,overloads:[[[Vr,Vr],(s,[i,a])=>i.evaluate(s)&&a.evaluate(s)],[Go(Vr),(s,i)=>{for(const a of i)if(!a.evaluate(s))return!1;return!0}]]},any:{type:Vr,overloads:[[[Vr,Vr],(s,[i,a])=>i.evaluate(s)||a.evaluate(s)],[Go(Vr),(s,i)=>{for(const a of i)if(a.evaluate(s))return!0;return!1}]]},"!":[Vr,[Vr],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Vr,[or],(s,[i])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(i.evaluate(s))}],upcase:[or,[or],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[or,[or],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[or,Go(hn),(s,i)=>i.map(a=>Si(a.evaluate(s))).join("")],"resolved-locale":[or,[Wu],(s,[i])=>i.evaluate(s).resolvedLocale()]});var no=$i;function za(s){return{result:"success",value:s}}function os(s){return{result:"error",value:s}}function yu(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function Ba(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function Wi(s){return!!s.expression&&s.expression.interpolated}function ei(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function ps(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function ro(s){return s}function Xc(s,i){const a="color"===i.type,f=s.stops&&"object"==typeof s.stops[0][0],m=f||!(f||void 0!==s.property),w=s.type||(Wi(i)?"exponential":"interval");if(a&&((s=Na({},s)).stops&&(s.stops=s.stops.map(R=>[R[0],wt.parse(R[1])])),s.default=wt.parse(s.default?s.default:i.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!Zs[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let S,M,P;if("exponential"===w)S=xl;else if("interval"===w)S=Us;else if("categorical"===w){S=Xs,M=Object.create(null);for(const R of s.stops)M[R[0]]=R[1];P=typeof s.stops[0][0]}else{if("identity"!==w)throw new Error(`Unknown function type "${w}"`);S=oc}if(f){const R={},z=[];for(let Z=0;Z<s.stops.length;Z++){const W=s.stops[Z],re=W[0].zoom;void 0===R[re]&&(R[re]={zoom:re,type:s.type,property:s.property,default:s.default,stops:[]},z.push(re)),R[re].stops.push([W[0].value,W[1]])}const V=[];for(const Z of z)V.push([R[Z].zoom,Xc(R[Z],i)]);const G={name:"linear"};return{kind:"composite",interpolationType:G,interpolationFactor:Et.interpolationFactor.bind(void 0,G),zoomStops:V.map(Z=>Z[0]),evaluate:({zoom:Z},W)=>xl({stops:V,base:s.base},i,Z).evaluate(Z,W)}}if(m){const R="exponential"===w?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:Et.interpolationFactor.bind(void 0,R),zoomStops:s.stops.map(z=>z[0]),evaluate:({zoom:z})=>S(s,i,z,M,P)}}return{kind:"source",evaluate(R,z){const V=z&&z.properties?z.properties[s.property]:void 0;return void 0===V?aa(s.default,i.default):S(s,i,V,M,P)}}}function aa(s,i,a){return void 0!==s?s:void 0!==i?i:void 0!==a?a:void 0}function Xs(s,i,a,f,m){return aa(typeof a===m?f[a]:void 0,s.default,i.default)}function Us(s,i,a){if("number"!==ei(a))return aa(s.default,i.default);const f=s.stops.length;if(1===f||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[f-1][0])return s.stops[f-1][1];const m=Is(s.stops.map(w=>w[0]),a);return s.stops[m][1]}function xl(s,i,a){const f=void 0!==s.base?s.base:1;if("number"!==ei(a))return aa(s.default,i.default);const m=s.stops.length;if(1===m||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[m-1][0])return s.stops[m-1][1];const w=Is(s.stops.map(z=>z[0]),a),S=function(z,V,G,Z){const W=Z-G,re=z-G;return 0===W?0:1===V?re/W:(Math.pow(V,re)-1)/(Math.pow(V,W)-1)}(a,f,s.stops[w][0],s.stops[w+1][0]),M=s.stops[w][1],P=s.stops[w+1][1];let R=Ji[i.type]||ro;if(s.colorSpace&&"rgb"!==s.colorSpace){const z=Zs[s.colorSpace];R=(V,G)=>z.reverse(z.interpolate(z.forward(V),z.forward(G),S))}return"function"==typeof M.evaluate?{evaluate(...z){const V=M.evaluate.apply(void 0,z),G=P.evaluate.apply(void 0,z);if(void 0!==V&&void 0!==G)return R(V,G,S)}}:R(M,P,S)}function oc(s,i,a){return"color"===i.type?a=wt.parse(a):"formatted"===i.type?a=$n.fromString(a.toString()):"resolvedImage"===i.type?a=Ar.fromString(a.toString()):ei(a)===i.type||"enum"===i.type&&i.values[a]||(a=void 0),aa(a,s.default,i.default)}class au{constructor(i,a){var f;this.expression=i,this._warningHistory={},this._evaluator=new vs,this._defaultValue=a?"color"===(f=a).type&&(ps(f.default)||Array.isArray(f.default))?new wt(0,0,0,0):"color"===f.type?wt.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(i,a,f,m,w,S,M,P){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,f,m,w,S,M,P){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=M||null,this._evaluator.featureDistanceData=P||null;try{const R=this.expression.evaluate(this._evaluator);if(null==R||"number"==typeof R&&R!=R)return this._defaultValue;if(this._enumValues&&!(R in this._enumValues))throw new Zn(`Expected value to be one of ${Object.keys(this._enumValues).map(z=>JSON.stringify(z)).join(", ")}, but found ${JSON.stringify(R)} instead.`);return R}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console<"u"&&console.warn(R.message)),this._defaultValue}}}function ll(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in no}function ea(s,i){const a=new xr(no,[],i?function(m){const w={color:Eu,string:or,number:gn,enum:or,boolean:Vr,formatted:oa,resolvedImage:Nl};return"array"===m.type?Br(w[m.value]||hn,m.length):w[m.type]}(i):void 0),f=a.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return f?za(new au(f,i)):os(a.errors)}class Bu{constructor(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent="constant"!==i&&!ru(a.expression)}evaluateWithoutErrorHandling(i,a,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,a,f,m,w,S)}evaluate(i,a,f,m,w,S){return this._styleExpression.evaluate(i,a,f,m,w,S)}}class ws{constructor(i,a,f,m){this.kind=i,this.zoomStops=f,this._styleExpression=a,this.isStateDependent="camera"!==i&&!ru(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,a,f,m,w,S)}evaluate(i,a,f,m,w,S){return this._styleExpression.evaluate(i,a,f,m,w,S)}interpolationFactor(i,a,f){return this.interpolationType?Et.interpolationFactor(this.interpolationType,i,a,f):0}}function mh(s,i){if("error"===(s=ea(s,i)).result)return s;const a=s.value.expression,f=nu(a);if(!f&&!yu(i))return os([new du("","data expressions not supported")]);const m=Sa(a,["zoom","pitch","distance-from-center"]);if(!m&&!Ba(i))return os([new du("","zoom expressions not supported")]);const w=ua(a);return w||m?w instanceof du?os([w]):w instanceof Et&&!Wi(i)?os([new du("",'"interpolate" expressions cannot be used with this property')]):za(w?new ws(f?"camera":"composite",s.value,w.labels,w instanceof Et?w.interpolation:void 0):new Bu(f?"constant":"source",s.value)):os([new du("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bl{constructor(i,a){this._parameters=i,this._specification=a,Na(this,Xc(this._parameters,this._specification))}static deserialize(i){return new Bl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function ua(s){let i=null;if(s instanceof Nr)i=ua(s.result);else if(s instanceof En){for(const a of s.args)if(i=ua(a),i)break}else(s instanceof ci||s instanceof Et)&&s.input instanceof us&&"zoom"===s.input.name&&(i=s);return i instanceof du||s.eachChild(a=>{const f=ua(a);f instanceof du?i=f:!i&&f?i=new du("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new du("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class Wn{constructor(i,a,f,m){this.message=(i?`${i}: `:"")+f,m&&(this.identifier=m),null!=a&&a.__line__&&(this.line=a.__line__)}}function Iu(s){const i=s.key,a=s.value,f=s.valueSpec||{},m=s.objectElementValidators||{},w=s.style,S=s.styleSpec;let M=[];const P=ei(a);if("object"!==P)return[new Wn(i,a,`object expected, ${P} found`)];for(const R in a){const z=R.split(".")[0],V=f[z]||f["*"];let G;m[z]?G=m[z]:f[z]?G=ma:m["*"]?G=m["*"]:f["*"]&&(G=ma),G?M=M.concat(G({key:(i&&`${i}.`)+R,value:a[R],valueSpec:V,style:w,styleSpec:S,object:a,objectKey:R},a)):M.push(new Wn(i,a[R],`unknown property "${R}"`))}for(const R in f)m[R]||f[R].required&&void 0===f[R].default&&void 0===a[R]&&M.push(new Wn(i,a,`missing required property "${R}"`));return M}function sc(s){const i=s.value,a=s.valueSpec,f=s.style,m=s.styleSpec,w=s.key,S=s.arrayElementValidator||ma;if("array"!==ei(i))return[new Wn(w,i,`array expected, ${ei(i)} found`)];if(a.length&&i.length!==a.length)return[new Wn(w,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new Wn(w,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let M={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};m.$version<7&&(M.function=a.function),"object"===ei(a.value)&&(M=a.value);let P=[];for(let R=0;R<i.length;R++)P=P.concat(S({array:i,arrayIndex:R,value:i[R],valueSpec:M,style:f,styleSpec:m,key:`${w}[${R}]`}));return P}function Ul(s){const i=s.key,a=s.value,f=s.valueSpec;let m=ei(a);if("number"===m&&a!=a&&(m="NaN"),"number"!==m)return[new Wn(i,a,`number expected, ${m} found`)];if("minimum"in f){let w=f.minimum;if("array"===ei(f.minimum)&&(w=f.minimum[s.arrayIndex]),a<w)return[new Wn(i,a,`${a} is less than the minimum value ${w}`)]}if("maximum"in f){let w=f.maximum;if("array"===ei(f.maximum)&&(w=f.maximum[s.arrayIndex]),a>w)return[new Wn(i,a,`${a} is greater than the maximum value ${w}`)]}return[]}function ta(s){const i=s.valueSpec,a=so(s.value.type);let f,m,w,S={};const M="categorical"!==a&&void 0===s.value.property,P=!M,R="array"===ei(s.value.stops)&&"array"===ei(s.value.stops[0])&&"object"===ei(s.value.stops[0][0]),z=Iu({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(Z){if("identity"===a)return[new Wn(Z.key,Z.value,'identity function may not have a "stops" property')];let W=[];const re=Z.value;return W=W.concat(sc({key:Z.key,value:re,valueSpec:Z.valueSpec,style:Z.style,styleSpec:Z.styleSpec,arrayElementValidator:V})),"array"===ei(re)&&0===re.length&&W.push(new Wn(Z.key,re,"array must have at least one stop")),W},default:function(Z){return ma({key:Z.key,value:Z.value,valueSpec:i,style:Z.style,styleSpec:Z.styleSpec})}}});return"identity"===a&&M&&z.push(new Wn(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||z.push(new Wn(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!Wi(s.valueSpec)&&z.push(new Wn(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!yu(s.valueSpec)?z.push(new Wn(s.key,s.value,"property functions not supported")):M&&!Ba(s.valueSpec)&&z.push(new Wn(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!R||void 0!==s.value.property||z.push(new Wn(s.key,s.value,'"property" property is required')),z;function V(Z){let W=[];const re=Z.value,be=Z.key;if("array"!==ei(re))return[new Wn(be,re,`array expected, ${ei(re)} found`)];if(2!==re.length)return[new Wn(be,re,`array length 2 expected, length ${re.length} found`)];if(R){if("object"!==ei(re[0]))return[new Wn(be,re,`object expected, ${ei(re[0])} found`)];if(void 0===re[0].zoom)return[new Wn(be,re,"object stop key must have zoom")];if(void 0===re[0].value)return[new Wn(be,re,"object stop key must have value")];const Xe=so(re[0].zoom);if("number"!=typeof Xe)return[new Wn(be,re[0].zoom,"stop zoom values must be numbers")];if(w&&w>Xe)return[new Wn(be,re[0].zoom,"stop zoom values must appear in ascending order")];Xe!==w&&(w=Xe,m=void 0,S={}),W=W.concat(Iu({key:`${be}[0]`,value:re[0],valueSpec:{zoom:{}},style:Z.style,styleSpec:Z.styleSpec,objectElementValidators:{zoom:Ul,value:G}}))}else W=W.concat(G({key:`${be}[0]`,value:re[0],valueSpec:{},style:Z.style,styleSpec:Z.styleSpec},re));return ll(Hi(re[1]))?W.concat([new Wn(`${be}[1]`,re[1],"expressions are not allowed in function stops.")]):W.concat(ma({key:`${be}[1]`,value:re[1],valueSpec:i,style:Z.style,styleSpec:Z.styleSpec}))}function G(Z,W){const re=ei(Z.value),be=so(Z.value),Xe=null!==Z.value?Z.value:W;if(f){if(re!==f)return[new Wn(Z.key,Xe,`${re} stop domain type must match previous stop domain type ${f}`)]}else f=re;if("number"!==re&&"string"!==re&&"boolean"!==re&&"number"!=typeof be&&"string"!=typeof be&&"boolean"!=typeof be)return[new Wn(Z.key,Xe,"stop domain value must be a number, string, or boolean")];if("number"!==re&&"categorical"!==a){let Ke=`number expected, ${re} found`;return yu(i)&&void 0===a&&(Ke+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wn(Z.key,Xe,Ke)]}return"categorical"!==a||"number"!==re||"number"==typeof be&&isFinite(be)&&Math.floor(be)===be?"categorical"!==a&&"number"===re&&"number"==typeof be&&"number"==typeof m&&void 0!==m&&be<m?[new Wn(Z.key,Xe,"stop domain values must appear in ascending order")]:(m=be,"categorical"===a&&be in S?[new Wn(Z.key,Xe,"stop domain values must be unique")]:(S[be]=!0,[])):[new Wn(Z.key,Xe,`integer expected, found ${String(be)}`)]}}function js(s){const i=("property"===s.expressionContext?mh:ea)(Hi(s.value),s.valueSpec);if("error"===i.result)return i.value.map(f=>new Wn(`${s.key}${f.key}`,s.value,f.message));const a=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new Wn(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!ru(a))return[new Wn(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return Sc(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Sa(a,["zoom","feature-state"]))return[new Wn(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!nu(a))return[new Wn(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Sc(s,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)a.delete(m);if(0===a.size)return[];const f=[];return s instanceof us&&a.has(s.name)?[new Wn(i.key,i.value,`["${s.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(s.eachChild(m=>{f.push(...Sc(m,i))}),f)}function fa(s){const i=s.key,a=s.value,f=s.valueSpec,m=[];return Array.isArray(f.values)?-1===f.values.indexOf(so(a))&&m.push(new Wn(i,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(f.values).indexOf(so(a))&&m.push(new Wn(i,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function qh(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!qh(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Zc(s,i="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};qh(s)||(s=Hh(s));const a=s;let f=!0;try{f=function(R){if(!Da(R))return R;let z=Hi(R);return cl(z),z=da(z),z}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const m=zt[`filter_${i}`],w=ea(f,m);let S=null;if("error"===w.result)throw new Error(w.value.map(R=>`${R.key}: ${R.message}`).join(", "));S=(R,z,V)=>w.value.evaluate(R,z,{},V);let M=null,P=null;if(f!==a){const R=ea(a,m);if("error"===R.result)throw new Error(R.value.map(z=>`${z.key}: ${z.message}`).join(", "));M=(z,V,G,Z,W)=>R.value.evaluate(z,V,{},G,void 0,void 0,Z,W),P=!nu(R.value.expression)}return{filter:S,dynamicFilter:M||void 0,needGeometry:ud(f),needFeature:!!P}}function da(s){if(!Array.isArray(s))return s;const i=function(a){if(na.has(a[0]))for(let f=1;f<a.length;f++)if(Da(a[f]))return!0;return a}(s);return!0===i?i:i.map(a=>da(a))}function cl(s){let i=!1;const a=[];if("case"===s[0]){for(let f=1;f<s.length-1;f+=2)i=i||Da(s[f]),a.push(s[f+1]);a.push(s[s.length-1])}else if("match"===s[0]){i=i||Da(s[1]);for(let f=2;f<s.length-1;f+=2)a.push(s[f+1]);a.push(s[s.length-1])}else if("step"===s[0]){i=i||Da(s[1]);for(let f=1;f<s.length-1;f+=2)a.push(s[f+1])}i&&(s.length=0,s.push("any",...a));for(let f=1;f<s.length;f++)cl(s[f])}function Da(s){if(!Array.isArray(s))return!1;if("pitch"===(i=s[0])||"distance-from-center"===i)return!0;var i;for(let a=1;a<s.length;a++)if(Da(s[a]))return!0;return!1}const na=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function jl(s,i){return s<i?-1:s>i?1:0}function ud(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(ud(s[i]))return!0;return!1}function Hh(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?Tu(s[1],s[2],"=="):"!="===i?uc(Tu(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Tu(s[1],s[2],i):"any"===i?(a=s.slice(1),["any"].concat(a.map(Hh))):"all"===i?["all"].concat(s.slice(1).map(Hh)):"none"===i?["all"].concat(s.slice(1).map(Hh).map(uc)):"in"===i?ac(s[1],s.slice(2)):"!in"===i?uc(ac(s[1],s.slice(2))):"has"===i?Vl(s[1]):"!has"===i?uc(Vl(s[1])):"within"!==i||s;var a}function Tu(s,i,a){switch(s){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,s,i]}}function ac(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",s,["literal",i.sort(jl)]]:["filter-in-small",s,["literal",i]]}}function Vl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function uc(s){return["!",s]}function wl(s){return qh(Hi(s.value))?js(Na({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):pa(s)}function pa(s){const i=s.value,a=s.key;if("array"!==ei(i))return[new Wn(a,i,`array expected, ${ei(i)} found`)];const f=s.styleSpec;let m,w=[];if(i.length<1)return[new Wn(a,i,"filter array must have at least 1 element")];switch(w=w.concat(fa({key:`${a}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),so(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===so(i[1])&&w.push(new Wn(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&w.push(new Wn(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=ei(i[1]),"string"!==m&&w.push(new Wn(`${a}[1]`,i[1],`string expected, ${m} found`)));for(let S=2;S<i.length;S++)m=ei(i[S]),"$type"===so(i[1])?w=w.concat(fa({key:`${a}[${S}]`,value:i[S],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&w.push(new Wn(`${a}[${S}]`,i[S],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)w=w.concat(pa({key:`${a}[${S}]`,value:i[S],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=ei(i[1]),2!==i.length?w.push(new Wn(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&w.push(new Wn(`${a}[1]`,i[1],`string expected, ${m} found`));break;case"within":m=ei(i[1]),2!==i.length?w.push(new Wn(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==m&&w.push(new Wn(`${a}[1]`,i[1],`object expected, ${m} found`))}return w}function Ic(s,i){const a=s.key,f=s.style,m=s.styleSpec,w=s.value,S=s.objectKey,M=m[`${i}_${s.layerType}`];if(!M)return[];const P=S.match(/^(.*)-transition$/);if("paint"===i&&P&&M[P[1]]&&M[P[1]].transition)return ma({key:a,value:w,valueSpec:m.transition,style:f,styleSpec:m});const R=s.valueSpec||M[S];if(!R)return[new Wn(a,w,`unknown property "${S}"`)];let z;if("string"===ei(w)&&yu(R)&&!R.tokens&&(z=/^{([^}]+)}$/.exec(w)))return[new Wn(a,w,`"${S}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const V=[];return"symbol"===s.layerType&&("text-field"===S&&f&&!f.glyphs&&V.push(new Wn(a,w,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&ps(Hi(w))&&"identity"===so(w.type)&&V.push(new Wn(a,w,'"text-font" does not support identity functions'))),V.concat(ma({key:s.key,value:w,valueSpec:R,style:f,styleSpec:m,expressionContext:"property",propertyType:i,propertyKey:S}))}function bl(s){return Ic(s,"paint")}function Vs(s){return Ic(s,"layout")}function Yr(s){let i=[];const a=s.value,f=s.key,m=s.style,w=s.styleSpec;a.type||a.ref||i.push(new Wn(f,a,'either "type" or "ref" is required'));let S=so(a.type);const M=so(a.ref);if(a.id){const P=so(a.id);for(let R=0;R<s.arrayIndex;R++){const z=m.layers[R];so(z.id)===P&&i.push(new Wn(f,a.id,`duplicate layer id "${a.id}", previously used at line ${z.id.__line__}`))}}if("ref"in a){let P;["type","source","source-layer","filter","layout"].forEach(R=>{R in a&&i.push(new Wn(f,a[R],`"${R}" is prohibited for ref layers`))}),m.layers.forEach(R=>{so(R.id)===M&&(P=R)}),P?P.ref?i.push(new Wn(f,a.ref,"ref cannot reference another ref layer")):S=so(P.type):"string"==typeof M&&i.push(new Wn(f,a.ref,`ref layer "${M}" not found`))}else if("background"!==S&&"sky"!==S)if(a.source){const P=m.sources&&m.sources[a.source],R=P&&so(P.type);P?"vector"===R&&"raster"===S?i.push(new Wn(f,a.source,`layer "${a.id}" requires a raster source`)):"raster"===R&&"raster"!==S?i.push(new Wn(f,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==R||a["source-layer"]?"raster-dem"===R&&"hillshade"!==S?i.push(new Wn(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===R&&P.lineMetrics||i.push(new Wn(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Wn(f,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new Wn(f,a.source,`source "${a.source}" not found`))}else i.push(new Wn(f,a,'missing required property "source"'));return i=i.concat(Iu({key:f,value:a,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ma({key:`${f}.type`,value:a.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:P=>wl(Na({layerType:S},P)),layout:P=>Iu({layer:a,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>Vs(Na({layerType:S},R))}}),paint:P=>Iu({layer:a,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":R=>bl(Na({layerType:S},R))}})}})),i}function Ua(s){const i=s.value,a=s.key,f=ei(i);return"string"!==f?[new Wn(a,i,`string expected, ${f} found`)]:[]}const Aa={promoteId:function({key:s,value:i}){if("string"===ei(i))return Ua({key:s,value:i});{const a=[];for(const f in i)a.push(...Ua({key:`${s}.${f}`,value:i[f]}));return a}}};function hl(s){const i=s.value,a=s.key,f=s.styleSpec,m=s.style;if(!i.type)return[new Wn(a,i,'"type" is required')];const w=so(i.type);let S;switch(w){case"vector":case"raster":case"raster-dem":return S=Iu({key:a,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Aa}),S;case"geojson":if(S=Iu({key:a,value:i,valueSpec:f.source_geojson,style:m,styleSpec:f,objectElementValidators:Aa}),i.cluster)for(const M in i.clusterProperties){const[P,R]=i.clusterProperties[M],z="string"==typeof P?[P,["accumulated"],["get",M]]:P;S.push(...js({key:`${a}.${M}.map`,value:R,expressionContext:"cluster-map"})),S.push(...js({key:`${a}.${M}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return S;case"video":return Iu({key:a,value:i,valueSpec:f.source_video,style:m,styleSpec:f});case"image":return Iu({key:a,value:i,valueSpec:f.source_image,style:m,styleSpec:f});case"canvas":return[new Wn(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return fa({key:`${a}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:f})}}function ga(s){const i=s.value,a=s.styleSpec,f=a.light,m=s.style;let w=[];const S=ei(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new Wn("light",i,`object expected, ${S} found`)]),w;for(const M in i){const P=M.match(/^(.*)-transition$/);w=w.concat(P&&f[P[1]]&&f[P[1]].transition?ma({key:M,value:i[M],valueSpec:a.transition,style:m,styleSpec:a}):f[M]?ma({key:M,value:i[M],valueSpec:f[M],style:m,styleSpec:a}):[new Wn(M,i[M],`unknown property "${M}"`)])}return w}function Gl(s){const i=s.value,a=s.key,f=s.style,m=s.styleSpec,w=m.terrain;let S=[];const M=ei(i);if(void 0===i)return S;if("object"!==M)return S=S.concat([new Wn("terrain",i,`object expected, ${M} found`)]),S;for(const P in i){const R=P.match(/^(.*)-transition$/);S=S.concat(R&&w[R[1]]&&w[R[1]].transition?ma({key:P,value:i[P],valueSpec:m.transition,style:f,styleSpec:m}):w[P]?ma({key:P,value:i[P],valueSpec:w[P],style:f,styleSpec:m}):[new Wn(P,i[P],`unknown property "${P}"`)])}if(i.source){const P=f.sources&&f.sources[i.source],R=P&&so(P.type);P?"raster-dem"!==R&&S.push(new Wn(a,i.source,`terrain cannot be used with a source of type ${String(R)}, it only be used with a "raster-dem" source type`)):S.push(new Wn(a,i.source,`source "${i.source}" not found`))}else S.push(new Wn(a,i,'terrain is missing required property "source"'));return S}function gs(s){const i=s.value,a=s.style,f=s.styleSpec,m=f.fog;let w=[];const S=ei(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new Wn("fog",i,`object expected, ${S} found`)]),w;for(const M in i){const P=M.match(/^(.*)-transition$/);w=w.concat(P&&m[P[1]]&&m[P[1]].transition?ma({key:M,value:i[M],valueSpec:f.transition,style:a,styleSpec:f}):m[M]?ma({key:M,value:i[M],valueSpec:m[M],style:a,styleSpec:f}):[new Wn(M,i[M],`unknown property "${M}"`)])}return w}const Ds={"*":()=>[],array:sc,boolean:function(s){const i=s.value,a=s.key,f=ei(i);return"boolean"!==f?[new Wn(a,i,`boolean expected, ${f} found`)]:[]},number:Ul,color:function(s){const i=s.key,a=s.value,f=ei(a);return"string"!==f?[new Wn(i,a,`color expected, ${f} found`)]:null===pt(a)?[new Wn(i,a,`color expected, "${a}" found`)]:[]},enum:fa,filter:wl,function:ta,layer:Yr,object:Iu,source:hl,light:ga,terrain:Gl,fog:gs,string:Ua,formatted:function(s){return 0===Ua(s).length?[]:js(s)},resolvedImage:function(s){return 0===Ua(s).length?[]:js(s)},projection:function(s){const i=s.value,a=s.styleSpec,f=a.projection,m=s.style;let w=[];const S=ei(i);if("object"===S)for(const M in i)w=w.concat(ma({key:M,value:i[M],valueSpec:f[M],style:m,styleSpec:a}));else"string"!==S&&(w=w.concat([new Wn("projection",i,`object or string expected, ${S} found`)]));return w}};function ma(s){const i=s.value,a=s.valueSpec,f=s.styleSpec;return a.expression&&ps(so(i))?ta(s):a.expression&&ll(Hi(i))?js(s):a.type&&Ds[a.type]?Ds[a.type](s):Iu(Na({},s,{valueSpec:a.type?f[a.type]:a}))}function Tc(s){const i=s.value,a=s.key,f=Ua(s);return f.length||(-1===i.indexOf("{fontstack}")&&f.push(new Wn(a,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&f.push(new Wn(a,i,'"glyphs" url must include a "{range}" token'))),f}function u(s,i=zt){return x(ma({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:Tc,"*":()=>[]}}))}const h=s=>x(bl(s)),y=s=>x(Vs(s));function x(s){return s.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function T(s,i){let a=!1;if(i&&i.length)for(const f of i)s.fire(new ks(new Error(f.message))),a=!0;return a}var F=$;function $(s,i,a){var f=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(i=m[1])+2*(a=m[2]);for(var w=0;w<this.d*this.d;w++){var S=m[3+w],M=m[3+w+1];f.push(S===M?null:m.subarray(S,M))}var P=m[3+f.length+1];this.keys=m.subarray(m[3+f.length],P),this.bboxes=m.subarray(P),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var R=0;R<this.d*this.d;R++)f.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=s,this.padding=a,this.scale=i/s,this.uid=0;var z=a/i*s;this.min=-z,this.max=s+z}$.prototype.insert=function(s,i,a,f,m){this._forEachCell(i,a,f,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(m)},$.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$.prototype._insertCell=function(s,i,a,f,m,w){this.cells[m].push(w)},$.prototype.query=function(s,i,a,f,m){var w=this.min,S=this.max;if(s<=w&&i<=w&&S<=a&&S<=f&&!m)return Array.prototype.slice.call(this.keys);var M=[];return this._forEachCell(s,i,a,f,this._queryCell,M,{},m),M},$.prototype._queryCell=function(s,i,a,f,m,w,S,M){var P=this.cells[m];if(null!==P)for(var R=this.keys,z=this.bboxes,V=0;V<P.length;V++){var G=P[V];if(void 0===S[G]){var Z=4*G;(M?M(z[Z+0],z[Z+1],z[Z+2],z[Z+3]):s<=z[Z+2]&&i<=z[Z+3]&&a>=z[Z+0]&&f>=z[Z+1])?(S[G]=!0,w.push(R[G])):S[G]=!1}}},$.prototype._forEachCell=function(s,i,a,f,m,w,S,M){for(var P=this._convertToCellCoord(s),R=this._convertToCellCoord(i),z=this._convertToCellCoord(a),V=this._convertToCellCoord(f),G=P;G<=z;G++)for(var Z=R;Z<=V;Z++){var W=this.d*Z+G;if((!M||M(this._convertFromCellCoord(G),this._convertFromCellCoord(Z),this._convertFromCellCoord(G+1),this._convertFromCellCoord(Z+1)))&&m.call(this,s,i,a,f,W,w,S,M))return}},$.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},$.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},$.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,i=3+this.cells.length+1+1,a=0,f=0;f<this.cells.length;f++)a+=this.cells[f].length;var m=new Int32Array(i+a+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var w=i,S=0;S<s.length;S++){var M=s[S];m[3+S]=w,m.set(M,w),w+=M.length}return m[3+s.length]=w,m.set(this.keys,w),m[3+s.length+1]=w+=this.keys.length,m.set(this.bboxes,w),w+=this.bboxes.length,m.buffer};const ee={};function oe(s,i,a={}){Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),ee[i]={klass:s,omit:a.omit||[]}}oe(Object,"Object"),F.serialize=function(s,i){const a=s.toArrayBuffer();return i&&i.push(a),{buffer:a}},F.deserialize=function(s){return new F(s.buffer)},Object.defineProperty(F,"name",{value:"Grid"}),oe(F,"Grid"),oe(wt,"Color"),oe(Error,"Error"),oe(On,"AJAXError"),oe(Ar,"ResolvedImage"),oe(Bl,"StylePropertyFunction"),oe(au,"StyleExpression",{omit:["_evaluator"]}),oe(ws,"ZoomDependentExpression"),oe(Bu,"ZoomConstantExpression"),oe(us,"CompoundExpression",{omit:["_evaluate"]});for(const s in no)ee[no[s]._classRegistryKey]||oe(no[s],`Expression${s}`);function st(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Zt(s){return Ce.ImageBitmap&&s instanceof Ce.ImageBitmap}function Qt(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(st(s)||Zt(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return i&&i.push(a.buffer),a}if(s instanceof Ce.ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const f of s)a.push(Qt(f,i));return a}if("object"==typeof s){const a=s.constructor,f=a._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const m=a.serialize?a.serialize(s,i):{};if(!a.serialize){for(const w in s)s.hasOwnProperty(w)&&(ee[f].omit.indexOf(w)>=0||(m[w]=Qt(s[w],i)));s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof s)}function xt(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||st(s)||Zt(s)||ArrayBuffer.isView(s)||s instanceof Ce.ImageData)return s;if(Array.isArray(s))return s.map(xt);if("object"==typeof s){const i=s.$name||"Object",{klass:a}=ee[i];if(!a)throw new Error(`can't deserialize unregistered class ${i}`);if(a.deserialize)return a.deserialize(s);const f=Object.create(a.prototype);for(const m of Object.keys(s))"$name"!==m&&(f[m]=xt(s[m]));return f}throw new Error("can't deserialize object of type "+typeof s)}class mn{constructor(){this.first=!0}update(i,a){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=a),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const ur=s=>s>=1536&&s<=1791,Cr=s=>s>=1872&&s<=1919,ti=s=>s>=2208&&s<=2303,bs=s=>s>=11904&&s<=12031,Ws=s=>s>=12032&&s<=12255,ra=s=>s>=12272&&s<=12287,_u=s=>s>=12288&&s<=12351,lc=s=>s>=12352&&s<=12447,Tf=s=>s>=12448&&s<=12543,Kd=s=>s>=12544&&s<=12591,Mf=s=>s>=12704&&s<=12735,Mu=s=>s>=12736&&s<=12783,cc=s=>s>=12784&&s<=12799,ld=s=>s>=12800&&s<=13055,yh=s=>s>=13056&&s<=13311,hc=s=>s>=13312&&s<=19903,Jd=s=>s>=19968&&s<=40959,Df=s=>s>=40960&&s<=42127,qp=s=>s>=42128&&s<=42191,Hp=s=>s>=44032&&s<=55215,cd=s=>s>=63744&&s<=64255,Af=s=>s>=64336&&s<=65023,Qd=s=>s>=65040&&s<=65055,Xh=s=>s>=65072&&s<=65103,Pf=s=>s>=65104&&s<=65135,v=s=>s>=65136&&s<=65279,l=s=>s>=65280&&s<=65519;function g(s){for(const i of s)if(A(i.charCodeAt(0)))return!0;return!1}function b(s){for(const i of s)if(!I(i.charCodeAt(0)))return!1;return!0}function I(s){return!(ur(s)||Cr(s)||ti(s)||Af(s)||v(s))}function A(s){return!(746!==s&&747!==s&&(s<4352||!(Mf(s)||Kd(s)||Xh(s)&&!(s>=65097&&s<=65103)||cd(s)||yh(s)||bs(s)||Mu(s)||!(!_u(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||hc(s)||Jd(s)||ld(s)||(i=s,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(s)||(i=>i>=55216&&i<=55295)(s)||(i=>i>=4352&&i<=4607)(s)||Hp(s)||lc(s)||ra(s)||(i=>i>=12688&&i<=12703)(s)||Ws(s)||cc(s)||Tf(s)&&12540!==s||!(!l(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Pf(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(i=>i>=5120&&i<=5759)(s)||(i=>i>=6320&&i<=6399)(s)||Qd(s)||(i=>i>=19904&&i<=19967)(s)||Df(s)||qp(s))));var i}function O(s){return!(A(s)||(i=s,(a=i)>=128&&a<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(a=>a>=8192&&a<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(a=>a>=8448&&a<=8527)(i)||(a=>a>=8528&&a<=8591)(i)||(a=>a>=8960&&a<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(a=>a>=9216&&a<=9279)(i)&&9251!==i||(a=>a>=9280&&a<=9311)(i)||(a=>a>=9312&&a<=9471)(i)||(a=>a>=9632&&a<=9727)(i)||(a=>a>=9728&&a<=9983)(i)&&!(i>=9754&&i<=9759)||(a=>a>=11008&&a<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||_u(i)||Tf(i)||(a=>a>=57344&&a<=63743)(i)||Xh(i)||Pf(i)||l(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,a}function U(s){return s>=1424&&s<=2303||Af(s)||v(s)}function j(s,i){return!(!i&&U(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(a=s,a>=6016&&a<=6143));var a}function H(s){for(const i of s)if(U(i.charCodeAt(0)))return!0;return!1}const X="deferred",K="loading",_e="loaded";let Le=null,Ie="unavailable",Fe=null;const De=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(Ie="error"),Le&&Le(s)};function Se(){Be.fire(new Gi("pluginStateChange",{pluginStatus:Ie,pluginURL:Fe}))}const Be=new ia,Ae=function(){return Ie},et=function(){if(Ie!==X||!Fe)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ie=K,Se(),Fe&&vi({url:Fe},s=>{s?De(s):(Ie=_e,Se())})},rt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ie===_e||null!=rt.applyArabicShaping,isLoading:()=>Ie===K,setState(s){Ie=s.pluginStatus,Fe=s.pluginURL},isParsed:()=>null!=rt.applyArabicShaping&&null!=rt.processBidirectionalText&&null!=rt.processStyledBidirectionalText,getPluginURL:()=>Fe};class Ze{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new mn,this.transition={},this.pitch=0)}isSupportedScript(i){return function(a,f){for(const m of a)if(!j(m.charCodeAt(0),f))return!1;return!0}(i,rt.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,a=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*a}}}class ut{constructor(i,a){this.property=i,this.value=a,this.expression=function(f,m){if(ps(f))return new Bl(f,m);if(ll(f)){const w=mh(f,m);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=f;return"string"==typeof f&&"color"===m.type&&(w=wt.parse(f)),{kind:"constant",evaluate:()=>w}}}(void 0===a?i.specification.default:a,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,a,f){return this.property.possiblyEvaluate(this,i,a,f)}}class Rt{constructor(i){this.property=i,this.value=new ut(i,void 0)}transitioned(i,a){return new Vt(this.property,this.value,a,Ee({},i.transition,this.transition),i.now)}untransitioned(){return new Vt(this.property,this.value,null,{},0)}}class Wt{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return sr(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Rt(this._values[i].property)),this._values[i].value=new ut(this._values[i].property,null===a?void 0:sr(a))}getTransition(i){return sr(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new Rt(this._values[i].property)),this._values[i].transition=sr(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const f=this.getValue(a);void 0!==f&&(i[a]=f);const m=this.getTransition(a);void 0!==m&&(i[`${a}-transition`]=m)}return i}transitioned(i,a){const f=new Ln(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(i,a._values[m]);return f}untransitioned(){const i=new Ln(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Vt{constructor(i,a,f,m,w){const S=m.delay||0,M=m.duration||0;w=w||0,this.property=i,this.value=a,this.begin=w+S,this.end=this.begin+M,i.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(i,a,f){const m=i.now||0,w=this.value.possiblyEvaluate(i,a,f),S=this.prior;if(S){if(m>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(m<this.begin)return S.possiblyEvaluate(i,a,f);{const M=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(i,a,f),w,_t(M))}}return w}}class Ln{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,f){const m=new fn(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,a,f);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Dt{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return sr(this._values[i].value)}setValue(i,a){this._values[i]=new ut(this._values[i].property,null===a?void 0:sr(a))}serialize(){const i={};for(const a of Object.keys(this._values)){const f=this.getValue(a);void 0!==f&&(i[a]=f)}return i}possiblyEvaluate(i,a,f){const m=new fn(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,a,f);return m}}class dn{constructor(i,a,f){this.property=i,this.value=a,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,a,f,m){return this.property.evaluate(this.value,this.parameters,i,a,f,m)}}class fn{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Ft{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,f){const m=Ji[this.specification.type];return m?m(i,a,f):i}}class bt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,f,m){return new dn(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(a,null,{},f,m)}:i.expression,a)}interpolate(i,a,f){if("constant"!==i.value.kind||"constant"!==a.value.kind)return i;if(void 0===i.value.value||void 0===a.value.value)return new dn(this,{kind:"constant",value:void 0},i.parameters);const m=Ji[this.specification.type];return m?new dn(this,{kind:"constant",value:m(i.value.value,a.value.value,f)},i.parameters):i}evaluate(i,a,f,m,w,S){return"constant"===i.kind?i.value:i.evaluate(a,f,m,w,S)}}class Jn extends bt{possiblyEvaluate(i,a,f,m){if(void 0===i.value)return new dn(this,{kind:"constant",value:void 0},a);if("constant"===i.expression.kind){const w=i.expression.evaluate(a,null,{},f,m),S="resolvedImage"===i.property.specification.type&&"string"!=typeof w?w.name:w,M=this._calculate(S,S,S,a);return new dn(this,{kind:"constant",value:M},a)}if("camera"===i.expression.kind){const w=this._calculate(i.expression.evaluate({zoom:a.zoom-1}),i.expression.evaluate({zoom:a.zoom}),i.expression.evaluate({zoom:a.zoom+1}),a);return new dn(this,{kind:"constant",value:w},a)}return new dn(this,i.expression,a)}evaluate(i,a,f,m,w,S){if("source"===i.kind){const M=i.evaluate(a,f,m,w,S);return this._calculate(M,M,M,a)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(a.zoom)-1},f,m),i.evaluate({zoom:Math.floor(a.zoom)},f,m),i.evaluate({zoom:Math.floor(a.zoom)+1},f,m),a):i.value}_calculate(i,a,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:a,other:f}:{from:f,to:a,other:i}}interpolate(i){return i}}class Nn{constructor(i){this.specification=i}possiblyEvaluate(i,a,f,m){if(void 0!==i.value){if("constant"===i.expression.kind){const w=i.expression.evaluate(a,null,{},f,m);return this._calculate(w,w,w,a)}return this._calculate(i.expression.evaluate(new Ze(Math.floor(a.zoom-1),a)),i.expression.evaluate(new Ze(Math.floor(a.zoom),a)),i.expression.evaluate(new Ze(Math.floor(a.zoom+1),a)),a)}}_calculate(i,a,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:a}:{from:f,to:a}}interpolate(i){return i}}class Vn{constructor(i){this.specification=i}possiblyEvaluate(i,a,f,m){return!!i.expression.evaluate(a,null,{},f,m)}interpolate(){return!1}}class Bn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Ze(0,{});for(const f in i){const m=i[f];m.specification.overridable&&this.overridableProperties.push(f);const w=this.defaultPropertyValues[f]=new ut(m,void 0),S=this.defaultTransitionablePropertyValues[f]=new Rt(m);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=w.possiblyEvaluate(a)}}}function fr(s,i){return 256*(s=ue(Math.floor(s),0,255))+ue(Math.floor(i),0,255)}oe(bt,"DataDrivenProperty"),oe(Ft,"DataConstantProperty"),oe(Jn,"CrossFadedDataDrivenProperty"),oe(Nn,"CrossFadedProperty"),oe(Vn,"ColorRampProperty");const qr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class kr{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class wr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Un(s,i=1){let a=0,f=0;return{members:s.map(m=>{const w=qr[m.type].BYTES_PER_ELEMENT,S=a=Zr(a,Math.max(i,w)),M=m.components||1;return f=Math.max(f,w),a+=w*M,{name:m.name,type:m.type,components:M,offset:S}}),size:Zr(a,Math.max(f,i)),alignment:i}}function Zr(s,i){return Math.ceil(s/i)*i}class wi extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.int16[m+0]=a,this.int16[m+1]=f,i}}wi.prototype.bytesPerElement=4,oe(wi,"StructArrayLayout2i4");class $o extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.int16[w+0]=a,this.int16[w+1]=f,this.int16[w+2]=m,i}}$o.prototype.bytesPerElement=6,oe($o,"StructArrayLayout3i6");class ms extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=4*i;return this.int16[S+0]=a,this.int16[S+1]=f,this.int16[S+2]=m,this.int16[S+3]=w,i}}ms.prototype.bytesPerElement=8,oe(ms,"StructArrayLayout4i8");class qo extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,f,m,w,S,M)}emplace(i,a,f,m,w,S,M,P){const R=6*i,z=12*i,V=3*i;return this.int16[R+0]=a,this.int16[R+1]=f,this.uint8[z+4]=m,this.uint8[z+5]=w,this.uint8[z+6]=S,this.uint8[z+7]=M,this.float32[V+2]=P,i}}qo.prototype.bytesPerElement=12,oe(qo,"StructArrayLayout2i4ub1f12");class ja extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=4*i;return this.float32[S+0]=a,this.float32[S+1]=f,this.float32[S+2]=m,this.float32[S+3]=w,i}}ja.prototype.bytesPerElement=16,oe(ja,"StructArrayLayout4f16");class Uu extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P,R,z){const V=this.length;return this.resize(V+1),this.emplace(V,i,a,f,m,w,S,M,P,R,z)}emplace(i,a,f,m,w,S,M,P,R,z,V){const G=10*i;return this.uint16[G+0]=a,this.uint16[G+1]=f,this.uint16[G+2]=m,this.uint16[G+3]=w,this.uint16[G+4]=S,this.uint16[G+5]=M,this.uint16[G+6]=P,this.uint16[G+7]=R,this.uint16[G+8]=z,this.uint16[G+9]=V,i}}Uu.prototype.bytesPerElement=20,oe(Uu,"StructArrayLayout10ui20");class Wa extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P){const R=this.length;return this.resize(R+1),this.emplace(R,i,a,f,m,w,S,M,P)}emplace(i,a,f,m,w,S,M,P,R){const z=8*i;return this.uint16[z+0]=a,this.uint16[z+1]=f,this.uint16[z+2]=m,this.uint16[z+3]=w,this.uint16[z+4]=S,this.uint16[z+5]=M,this.uint16[z+6]=P,this.uint16[z+7]=R,i}}Wa.prototype.bytesPerElement=16,oe(Wa,"StructArrayLayout8ui16");class As extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S){const M=this.length;return this.resize(M+1),this.emplace(M,i,a,f,m,w,S)}emplace(i,a,f,m,w,S,M){const P=6*i;return this.int16[P+0]=a,this.int16[P+1]=f,this.int16[P+2]=m,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=M,i}}As.prototype.bytesPerElement=12,oe(As,"StructArrayLayout6i12");class Ps extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P,R,z,V,G){const Z=this.length;return this.resize(Z+1),this.emplace(Z,i,a,f,m,w,S,M,P,R,z,V,G)}emplace(i,a,f,m,w,S,M,P,R,z,V,G,Z){const W=12*i;return this.int16[W+0]=a,this.int16[W+1]=f,this.int16[W+2]=m,this.int16[W+3]=w,this.uint16[W+4]=S,this.uint16[W+5]=M,this.uint16[W+6]=P,this.uint16[W+7]=R,this.int16[W+8]=z,this.int16[W+9]=V,this.int16[W+10]=G,this.int16[W+11]=Z,i}}Ps.prototype.bytesPerElement=24,oe(Ps,"StructArrayLayout4i4ui4i24");class lo extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S){const M=this.length;return this.resize(M+1),this.emplace(M,i,a,f,m,w,S)}emplace(i,a,f,m,w,S,M){const P=10*i,R=5*i;return this.int16[P+0]=a,this.int16[P+1]=f,this.int16[P+2]=m,this.float32[R+2]=w,this.float32[R+3]=S,this.float32[R+4]=M,i}}lo.prototype.bytesPerElement=20,oe(lo,"StructArrayLayout3i3f20");class ya extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}ya.prototype.bytesPerElement=4,oe(ya,"StructArrayLayout1ul4");class uu extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P,R,z,V,G,Z){const W=this.length;return this.resize(W+1),this.emplace(W,i,a,f,m,w,S,M,P,R,z,V,G,Z)}emplace(i,a,f,m,w,S,M,P,R,z,V,G,Z,W){const re=20*i,be=10*i;return this.int16[re+0]=a,this.int16[re+1]=f,this.int16[re+2]=m,this.int16[re+3]=w,this.int16[re+4]=S,this.float32[be+3]=M,this.float32[be+4]=P,this.float32[be+5]=R,this.float32[be+6]=z,this.int16[re+14]=V,this.uint32[be+8]=G,this.uint16[re+18]=Z,this.uint16[re+19]=W,i}}uu.prototype.bytesPerElement=40,oe(uu,"StructArrayLayout5i4f1i1ul2ui40");class cs extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,f,m,w,S,M)}emplace(i,a,f,m,w,S,M,P){const R=8*i;return this.int16[R+0]=a,this.int16[R+1]=f,this.int16[R+2]=m,this.int16[R+4]=w,this.int16[R+5]=S,this.int16[R+6]=M,this.int16[R+7]=P,i}}cs.prototype.bytesPerElement=16,oe(cs,"StructArrayLayout3i2i2i16");class el extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,f,m,w)}emplace(i,a,f,m,w,S){const M=4*i,P=8*i;return this.float32[M+0]=a,this.float32[M+1]=f,this.float32[M+2]=m,this.int16[P+6]=w,this.int16[P+7]=S,i}}el.prototype.bytesPerElement=16,oe(el,"StructArrayLayout2f1f2i16");class Wc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=12*i,M=3*i;return this.uint8[S+0]=a,this.uint8[S+1]=f,this.float32[M+1]=m,this.float32[M+2]=w,i}}Wc.prototype.bytesPerElement=12,oe(Wc,"StructArrayLayout2ub2f12");class El extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.float32[w+0]=a,this.float32[w+1]=f,this.float32[w+2]=m,i}}El.prototype.bytesPerElement=12,oe(El,"StructArrayLayout3f12");class Du extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.uint16[w+0]=a,this.uint16[w+1]=f,this.uint16[w+2]=m,i}}Du.prototype.bytesPerElement=6,oe(Du,"StructArrayLayout3ui6");class _h extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at){const Qe=this.length;return this.resize(Qe+1),this.emplace(Qe,i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at)}emplace(i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at,Qe){const Ut=30*i,Ot=15*i,rn=60*i;return this.int16[Ut+0]=a,this.int16[Ut+1]=f,this.int16[Ut+2]=m,this.float32[Ot+2]=w,this.float32[Ot+3]=S,this.uint16[Ut+8]=M,this.uint16[Ut+9]=P,this.uint32[Ot+5]=R,this.uint32[Ot+6]=z,this.uint32[Ot+7]=V,this.uint16[Ut+16]=G,this.uint16[Ut+17]=Z,this.uint16[Ut+18]=W,this.float32[Ot+10]=re,this.float32[Ot+11]=be,this.uint8[rn+48]=Xe,this.uint8[rn+49]=Ke,this.uint8[rn+50]=qe,this.uint32[Ot+13]=Je,this.int16[Ut+28]=at,this.uint8[rn+58]=Qe,i}}_h.prototype.bytesPerElement=60,oe(_h,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Yc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at,Qe,Ut,Ot,rn,In,Ht,an,ln,_n){const Tn=this.length;return this.resize(Tn+1),this.emplace(Tn,i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at,Qe,Ut,Ot,rn,In,Ht,an,ln,_n)}emplace(i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be,Xe,Ke,qe,Je,at,Qe,Ut,Ot,rn,In,Ht,an,ln,_n,Tn){const Jt=38*i,Hn=19*i;return this.int16[Jt+0]=a,this.int16[Jt+1]=f,this.int16[Jt+2]=m,this.float32[Hn+2]=w,this.float32[Hn+3]=S,this.int16[Jt+8]=M,this.int16[Jt+9]=P,this.int16[Jt+10]=R,this.int16[Jt+11]=z,this.int16[Jt+12]=V,this.int16[Jt+13]=G,this.uint16[Jt+14]=Z,this.uint16[Jt+15]=W,this.uint16[Jt+16]=re,this.uint16[Jt+17]=be,this.uint16[Jt+18]=Xe,this.uint16[Jt+19]=Ke,this.uint16[Jt+20]=qe,this.uint16[Jt+21]=Je,this.uint16[Jt+22]=at,this.uint16[Jt+23]=Qe,this.uint16[Jt+24]=Ut,this.uint16[Jt+25]=Ot,this.uint16[Jt+26]=rn,this.uint16[Jt+27]=In,this.uint16[Jt+28]=Ht,this.uint32[Hn+15]=an,this.float32[Hn+16]=ln,this.float32[Hn+17]=_n,this.float32[Hn+18]=Tn,i}}Yc.prototype.bytesPerElement=76,oe(Yc,"StructArrayLayout3i2f6i15ui1ul3f76");class Va extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}Va.prototype.bytesPerElement=4,oe(Va,"StructArrayLayout1f4");class Au extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,f,m,w)}emplace(i,a,f,m,w,S){const M=5*i;return this.float32[M+0]=a,this.float32[M+1]=f,this.float32[M+2]=m,this.float32[M+3]=w,this.float32[M+4]=S,i}}Au.prototype.bytesPerElement=20,oe(Au,"StructArrayLayout5f20");class Kc extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=6*i;return this.uint32[3*i+0]=a,this.uint16[S+2]=f,this.uint16[S+3]=m,this.uint16[S+4]=w,i}}Kc.prototype.bytesPerElement=12,oe(Kc,"StructArrayLayout1ul3ui12");class Cl extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.uint16[m+0]=a,this.uint16[m+1]=f,i}}Cl.prototype.bytesPerElement=4,oe(Cl,"StructArrayLayout2ui4");class hd extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}hd.prototype.bytesPerElement=2,oe(hd,"StructArrayLayout1ui2");class vh extends wr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.float32[m+0]=a,this.float32[m+1]=f,i}}vh.prototype.bytesPerElement=8,oe(vh,"StructArrayLayout2f8");class yv extends kr{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}yv.prototype.size=12;class Lm extends As{get(i){return new yv(this,i)}}oe(Lm,"FillExtrusionExtArray");class Xp extends kr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Xp.prototype.size=40;class Rm extends uu{get(i){return new Xp(this,i)}}oe(Rm,"CollisionBoxArray");class Om extends kr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Om.prototype.size=60;class ep extends _h{get(i){return new Om(this,i)}}oe(ep,"PlacedSymbolArray");class Lf extends kr{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Lf.prototype.size=76;class Rf extends Yc{get(i){return new Lf(this,i)}}oe(Rf,"SymbolInstanceArray");class Of extends Va{getoffsetX(i){return this.float32[1*i+0]}}oe(Of,"GlyphOffsetArray");class Nm extends $o{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}oe(Nm,"SymbolLineVertexArray");class Zp extends kr{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Zp.prototype.size=12;class Nf extends Kc{get(i){return new Zp(this,i)}}oe(Nf,"FeatureIndexArray");class Nx extends kr{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Nx.prototype.size=4;class _v extends Cl{get(i){return new Nx(this,i)}}oe(_v,"FillExtrusionCentroidArray");class Ti extends kr{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Ti.prototype.size=12;class kx extends As{get(i){return new Ti(this,i)}}oe(kx,"CircleGlobeExtArray");const tS=Un([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),nS=Un([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var tp={exports:{}},Bx=function(s,i){var a,f,m,w,S,M,P,R;for(f=s.length-(a=3&s.length),m=i,S=3432918353,M=461845907,R=0;R<f;)P=255&s.charCodeAt(R)|(255&s.charCodeAt(++R))<<8|(255&s.charCodeAt(++R))<<16|(255&s.charCodeAt(++R))<<24,++R,m=27492+(65535&(w=5*(65535&(m=(m^=P=(65535&(P=(P=(65535&P)*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(P=0,a){case 3:P^=(255&s.charCodeAt(R+2))<<16;case 2:P^=(255&s.charCodeAt(R+1))<<8;case 1:m^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(R)))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*M+(((P>>>16)*M&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},np=function(s,i){for(var a,f=s.length,m=i^f,w=0;f>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(a>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:m^=(255&s.charCodeAt(w+2))<<16;case 2:m^=(255&s.charCodeAt(w+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(w)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};tp.exports=Bx,tp.exports.murmur3=Bx,tp.exports.murmur2=np;class km{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,a,f,m){this.ids.push(Ux(i)),this.positions.push(a,f,m)}getPositions(i){const a=Ux(i);let f=0,m=this.ids.length-1;for(;f<m;){const S=f+m>>1;this.ids[S]>=a?m=S:f=S+1}const w=[];for(;this.ids[f]===a;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(i,a){const f=new Float64Array(i.ids),m=new Uint32Array(i.positions);return Ya(f,m,0,f.length-1),a&&a.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(i){const a=new km;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a}}function Ux(s){const i=+s;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:tp.exports(String(s))}function Ya(s,i,a,f){for(;a<f;){const m=s[a+f>>1];let w=a-1,S=f+1;for(;;){do{w++}while(s[w]<m);do{S--}while(s[S]>m);if(w>=S)break;fd(s,w,S),fd(i,3*w,3*S),fd(i,3*w+1,3*S+1),fd(i,3*w+2,3*S+2)}S-a<f-S?(Ya(s,i,a,S),a=S+1):(Ya(s,i,S+1,f),f=S)}}function fd(s,i,a){const f=s[i];s[i]=s[a],s[a]=f}oe(km,"FeaturePositionMap");class $l{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}}class Wp extends $l{constructor(i){super(i),this.current=0}set(i,a,f){this.fetchUniformLocation(i,a)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class ql extends $l{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,f){this.fetchUniformLocation(i,a)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class Zh extends $l{constructor(i){super(i),this.current=wt.transparent}set(i,a,f){this.fetchUniformLocation(i,a)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const vv=new Float32Array(16),Yp=new Float32Array(9),rp=new Float32Array(4);function Fm(s){return[fr(255*s.r,255*s.g),fr(255*s.b,255*s.a)]}class Kp{constructor(i,a,f){this.value=i,this.uniformNames=a.map(m=>`u_${m}`),this.type=f}setUniform(i,a,f,m,w){a.set(i,w,m.constantOr(this.value))}getBinding(i,a){return"color"===this.type?new Zh(i):new Wp(i)}}class dd{constructor(i,a){this.uniformNames=a.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=i.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,a,f,m,w){const S="u_pattern_to"===w||"u_dash_to"===w?this.patternTo:"u_pattern_from"===w||"u_dash_from"===w?this.patternFrom:"u_pixel_ratio_to"===w?this.pixelRatioTo:"u_pixel_ratio_from"===w?this.pixelRatioFrom:null;S&&a.set(i,w,S)}getBinding(i,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new ql(i):new Wp(i)}}class Wh{constructor(i,a,f,m){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,a,f,m,w,S){const M=this.paintVertexArray.length,P=this.expression.evaluate(new Ze(0),a,{},w,m,S);this.paintVertexArray.resize(i),this._setPaintValue(M,i,P)}updatePaintArray(i,a,f,m,w){const S=this.expression.evaluate({zoom:0},f,m,void 0,w);this._setPaintValue(i,a,S)}_setPaintValue(i,a,f){if("color"===this.type){const m=Fm(f);for(let w=i;w<a;w++)this.paintVertexArray.emplace(w,m[0],m[1])}else{for(let m=i;m<a;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pa{constructor(i,a,f,m,w,S){this.expression=i,this.uniformNames=a.map(M=>`u_${M}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=a.map(M=>({name:`a_${M}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(i,a,f,m,w,S){const M=this.expression.evaluate(new Ze(this.zoom),a,{},w,m,S),P=this.expression.evaluate(new Ze(this.zoom+1),a,{},w,m,S),R=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(R,i,M,P)}updatePaintArray(i,a,f,m,w){const S=this.expression.evaluate({zoom:this.zoom},f,m,void 0,w),M=this.expression.evaluate({zoom:this.zoom+1},f,m,void 0,w);this._setPaintValue(i,a,S,M)}_setPaintValue(i,a,f,m){if("color"===this.type){const w=Fm(f),S=Fm(m);for(let M=i;M<a;M++)this.paintVertexArray.emplace(M,w[0],w[1],S[0],S[1])}else{for(let w=i;w<a;w++)this.paintVertexArray.emplace(w,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,f,m,w){const S=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,M=ue(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);a.set(i,w,M)}getBinding(i,a){return new Wp(i)}}class Jc{constructor(i,a,f,m,w,S,M){this.expression=i,this.type=f,this.useIntegerZoom=m,this.zoom=w,this.layerId=M,this.paintVertexAttributes=("array"===f?nS:tS).members;for(let P=0;P<a.length;++P);this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(i,a,f){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(m,i,a.patterns&&a.patterns[this.layerId],f)}updatePaintArray(i,a,f,m,w,S){this._setPaintValues(i,a,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(i,a,f,m){if(!m||!f)return;const{min:w,mid:S,max:M}=f,P=m[w],R=m[S],z=m[M];if(P&&R&&z)for(let V=i;V<a;V++)this._setPaintValue(this.zoomInPaintVertexArray,V,R,P),this._setPaintValue(this.zoomOutPaintVertexArray,V,R,z)}_setPaintValue(i,a,f,m){i.emplace(a,f.tl[0],f.tl[1],f.br[0],f.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],f.pixelRatio,m.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Hl{constructor(i,a,f=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const w in i.paint._values){if(!f(w))continue;const S=i.paint.get(w);if(!(S instanceof dn&&yu(S.property.specification)))continue;const M=jx(w,i.type),P=S.value,R=S.property.specification.type,z=S.property.useIntegerZoom,V=S.property.specification["property-type"],G="cross-faded"===V||"cross-faded-data-driven"===V,Z="line-dasharray"===String(w)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==P.kind||Z)if("source"===P.kind||Z||G){const W=wv(w,R,"source");this.binders[w]=G?new Jc(P,M,R,z,a,W,i.id):new Wh(P,M,R,W),m.push(`/a_${w}`)}else{const W=wv(w,R,"composite");this.binders[w]=new Pa(P,M,R,z,a,W),m.push(`/z_${w}`)}else this.binders[w]=G?new dd(P.value,M):new Kp(P.value,M,R),m.push(`/u_${w}`)}this.cacheKey=m.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Wh||a instanceof Pa?a.maxValue:0}populatePaintArrays(i,a,f,m,w,S){for(const M in this.binders){const P=this.binders[M];(P instanceof Wh||P instanceof Pa||P instanceof Jc)&&P.populatePaintArray(i,a,f,m,w,S)}}setConstantPatternPositions(i,a){for(const f in this.binders){const m=this.binders[f];m instanceof dd&&m.setConstantPatternPositions(i,a)}}updatePaintArrays(i,a,f,m,w,S){let M=!1;for(const P in i){const R=a.getPositions(P);for(const z of R){const V=f.feature(z.index);for(const G in this.binders){const Z=this.binders[G];if((Z instanceof Wh||Z instanceof Pa||Z instanceof Jc)&&!0===Z.expression.isStateDependent){const W=m.paint.get(G);Z.expression=W.value,Z.updatePaintArray(z.start,z.end,V,i[P],w,S),M=!0}}}}return M}defines(){const i=[];for(const a in this.binders){const f=this.binders[a];(f instanceof Kp||f instanceof dd)&&i.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const f=this.binders[a];if(f instanceof Wh||f instanceof Pa||f instanceof Jc)for(let m=0;m<f.paintVertexAttributes.length;m++)i.push(f.paintVertexAttributes[m].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const f=this.binders[a];if(f instanceof Kp||f instanceof dd||f instanceof Pa)for(const m of f.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Kp||m instanceof dd||m instanceof Pa)for(const w of m.uniformNames)a.push({name:w,property:f,binding:m.getBinding(i,w)})}return a}setUniforms(i,a,f,m,w){for(const{name:S,property:M,binding:P}of f)this.binders[M].setUniform(i,P,w,m.get(M),S)}updatePaintBuffers(i){this._buffers=[];for(const a in this.binders){const f=this.binders[a];if(i&&f instanceof Jc){const m=2===i.fromScale?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof Wh||f instanceof Pa)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const a in this.binders){const f=this.binders[a];(f instanceof Wh||f instanceof Pa||f instanceof Jc)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Wh||a instanceof Pa||a instanceof Jc)&&a.destroy()}}}class pd{constructor(i,a,f=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new Hl(m,a,f);this.needsUpload=!1,this._featureMap=new km,this._bufferOffset=0}populatePaintArrays(i,a,f,m,w,S,M){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(i,a,m,w,S,M);void 0!==a.id&&this._featureMap.add(a.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,f,m,w){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(i,this._featureMap,a,S,m,w)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const xv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jx(s,i){return xv[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}const Vx={"line-pattern":{source:Uu,composite:Uu},"fill-pattern":{source:Uu,composite:Uu},"fill-extrusion-pattern":{source:Uu,composite:Uu},"line-dasharray":{source:Wa,composite:Wa}},Gx={color:{source:vh,composite:ja},number:{source:Va,composite:vh}};function wv(s,i,a){const f=Vx[s];return f&&f[a]||Gx[i][a]}oe(Kp,"ConstantBinder"),oe(dd,"CrossFadedConstantBinder"),oe(Wh,"SourceExpressionBinder"),oe(Jc,"CrossFadedCompositeBinder"),oe(Pa,"CompositeExpressionBinder"),oe(Hl,"ProgramConfiguration",{omit:["_buffers"]}),oe(pd,"ProgramConfigurationSet");const Jp="-transition";class Mc extends ia{constructor(i,a){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),a.layout&&(this._unevaluatedLayout=new Dt(a.layout)),a.paint)){this._transitionablePaint=new Wt(a.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fn(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a,f={}){null!=a&&this._validate(y,`layers.${this.id}.layout.${i}`,i,a,f)||("visibility"!==i?this._unevaluatedLayout.setValue(i,a):this.visibility=a)}getPaintProperty(i){return jt(i,Jp)?this._transitionablePaint.getTransition(i.slice(0,-Jp.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a,f={}){if(null!=a&&this._validate(h,`layers.${this.id}.paint.${i}`,i,a,f))return!1;if(jt(i,Jp))return this._transitionablePaint.setTransition(i.slice(0,-Jp.length),a||void 0),!1;{const m=this._transitionablePaint._values[i],w="cross-faded-data-driven"===m.property.specification["property-type"],S=m.value.isDataDriven(),M=m.value;this._transitionablePaint.setValue(i,a),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||S||w||this._handleOverridablePaintPropertyUpdate(i,M,P)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,a,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Qn(i,(a,f)=>!(void 0===a||"layout"===f&&!Object.keys(a).length||"paint"===f&&!Object.keys(a).length))}_validate(i,a,f,m,w={}){return(!w||!1!==w.validate)&&T(this,i.call(u,{key:a,layerType:this.type,objectKey:f,value:m,styleSpec:zt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof dn&&yu(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Zc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const zm=Un([{name:"a_pos",components:2,type:"Int16"}],4),Qp=Un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class _a{constructor(i=[]){this.segments=i}prepareSegment(i,a,f,m){let w=this.segments[this.segments.length-1];return i>_a.MAX_VERTEX_ARRAY_LENGTH&&zn(`Max vertices per segment is ${_a.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>_a.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==m)&&(w={vertexOffset:a.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==m&&(w.sortKey=m),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,f,m){return new _a([{vertexOffset:i,primitiveOffset:a,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}_a.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,oe(_a,"SegmentVector");var jr=8192;class xh{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof po?new po(i.lng,i.lat):po.convert(i),this}setSouthWest(i){return this._sw=i instanceof po?new po(i.lng,i.lat):po.convert(i),this}extend(i){const a=this._sw,f=this._ne;let m,w;if(i instanceof po)m=i,w=i;else{if(!(i instanceof xh))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(xh.convert(i)):this.extend(po.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&i.hasOwnProperty("lon")?this.extend(po.convert(i)):this;if(m=i._sw,w=i._ne,!m||!w)return this}return a||f?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),f.lng=Math.max(w.lng,f.lng),f.lat=Math.max(w.lat,f.lat)):(this._sw=new po(m.lng,m.lat),this._ne=new po(w.lng,w.lat)),this}getCenter(){return new po((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new po(this.getWest(),this.getNorth())}getSouthEast(){return new po(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:f}=po.convert(i);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return!i||i instanceof xh?i:new xh(i)}}const Yh=6371008.8;class po{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new po(kt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,f=this.lat*a,m=i.lat*a,w=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((i.lng-this.lng)*a);return Yh*Math.acos(Math.min(w,1))}toBounds(i=0){const a=360*i/40075017,f=a/Math.cos(Math.PI/180*this.lat);return new xh(new po(this.lng-f,this.lat-a),new po(this.lng+f,this.lat+a))}static convert(i){if(i instanceof po)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new po(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new po(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Bm=2*Math.PI*Yh;function kf(s){return Bm*Math.cos(s*Math.PI/180)}function Xl(s){return(180+s)/360}function Dc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function fc(s,i){return s/kf(i)}function Zl(s){return 360*s-180}function La(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function gd(s,i){return s*kf(La(i))}const Qc=85.051129;function $x(s){return 1/Math.cos(s*Math.PI/180)}class Ff{constructor(i,a,f=0){this.x=+i,this.y=+a,this.z=+f}static fromLngLat(i,a=0){const f=po.convert(i);return new Ff(Xl(f.lng),Dc(f.lat),fc(a,f.lat))}toLngLat(){return new po(Zl(this.x),La(this.y))}toAltitude(){return gd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Bm*$x(La(this.y))}}function Um(s,i,a,f,m,w,S,M,P){const R=(i+f)/2,z=(a+m)/2,V=new Q(R,z);M(V),function(G,Z,W,re,be,Xe){const Ke=W-be,qe=re-Xe;return Math.abs((re-Z)*Ke-(W-G)*qe)/Math.hypot(Ke,qe)}(V.x,V.y,w.x,w.y,S.x,S.y)>=P?(Um(s,i,a,R,z,w,V,M,P),Um(s,R,z,f,m,V,S,M,P)):s.push(S)}function qx(s,i,a){let f=s[0],m=f.x,w=f.y;i(f);const S=[f];for(let M=1;M<s.length;M++){const P=s[M],{x:R,y:z}=P;i(P),Um(S,m,w,R,z,f,P,i,a),m=R,w=z,f=P}return S}function jm(s,i,a,f){if(f(i,a)){const m=i.add(a)._mult(.5);jm(s,i,m,f),jm(s,m,a,f)}else s.push(a)}function Hx(s,i){let a=s[0];const f=[a];for(let m=1;m<s.length;m++){const w=s[m];jm(f,a,w,i),a=w}return f}const Vm=Math.pow(2,14)-1,ip=-Vm-1;function bv(s,i){const a=Math.round(s.x*i),f=Math.round(s.y*i);return s.x=ue(a,ip,Vm),s.y=ue(f,ip,Vm),(a<s.x||a>s.x+1||f<s.y||f>s.y+1)&&zn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function wh(s,i,a){const f=s.loadGeometry(),m=s.extent,w=jr/m;if(i&&a&&a.projection.isReprojectedInTileSpace){const S=1<<i.z,{scale:M,x:P,y:R,projection:z}=a,V=G=>{const Z=Zl((i.x+G.x/m)/S),W=La((i.y+G.y/m)/S),re=z.project(Z,W);G.x=(re.x*M-P)*m,G.y=(re.y*M-R)*m};for(let G=0;G<f.length;G++)if(1!==s.type)f[G]=qx(f[G],V,1);else{const Z=[];for(const W of f[G])W.x<0||W.x>=m||W.y<0||W.y>=m||(V(W),Z.push(W));f[G]=Z}}for(const S of f)for(const M of S)bv(M,w);return f}function Kh(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?wh(s):[]}}function Gm(s,i,a,f,m){s.emplaceBack(2*i+(f+1)/2,2*a+(m+1)/2)}function op(s,i,a){s.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class Ev{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new wi,this.indexArray=new Du,this.segments=new _a,this.programConfigurations=new pd(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,f,m){const w=this.layers[0],S=[];let M=null;"circle"===w.type&&(M=w.layout.get("circle-sort-key"));for(const{feature:R,id:z,index:V,sourceLayerIndex:G}of i){const Z=this.layers[0]._featureFilter.needGeometry,W=Kh(R,Z);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),W,f))continue;const re=M?M.evaluate(W,{},f):void 0,be={id:z,properties:R.properties,type:R.type,sourceLayerIndex:G,index:V,geometry:Z?W.geometry:wh(R,f,m),patterns:{},sortKey:re};S.push(be)}M&&S.sort((R,z)=>R.sortKey-z.sortKey);let P=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new kx,P=m.projection);for(const R of S){const{geometry:z,index:V,sourceLayerIndex:G}=R,Z=i[V].feature;this.addFeature(R,z,V,a.availableImages,f,P),a.featureIndex.insert(Z,z,V,G,this.index)}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,zm.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,Qp.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,f,m,w,S){for(const M of a)for(const P of M){const R=P.x,z=P.y;if(R<0||R>=jr||z<0||z>=jr)continue;if(S){const Z=S.projectTilePoint(R,z,w),W=S.upVector(w,R,z),re=this.globeExtVertexArray;op(re,Z,W),op(re,Z,W),op(re,Z,W),op(re,Z,W)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),G=V.vertexLength;Gm(this.layoutVertexArray,R,z,-1,-1),Gm(this.layoutVertexArray,R,z,1,-1),Gm(this.layoutVertexArray,R,z,1,1),Gm(this.layoutVertexArray,R,z,-1,1),this.indexArray.emplaceBack(G,G+1,G+2),this.indexArray.emplaceBack(G,G+2,G+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},m,w)}}function Cv(s,i){for(let a=0;a<s.length;a++)if(md(i,s[a]))return!0;for(let a=0;a<i.length;a++)if(md(s,i[a]))return!0;return!!Sv(s,i)}function Xx(s,i,a){return!!md(s,i)||!!Iv(i,s,a)}function eg(s,i){if(1===s.length)return Wx(i,s[0]);for(let a=0;a<i.length;a++){const f=i[a];for(let m=0;m<f.length;m++)if(md(s,f[m]))return!0}for(let a=0;a<s.length;a++)if(Wx(i,s[a]))return!0;for(let a=0;a<i.length;a++)if(Sv(s,i[a]))return!0;return!1}function rS(s,i,a){if(s.length>1){if(Sv(s,i))return!0;for(let f=0;f<i.length;f++)if(Iv(i[f],s,a))return!0}for(let f=0;f<s.length;f++)if(Iv(s[f],i,a))return!0;return!1}function Sv(s,i){if(0===s.length||0===i.length)return!1;for(let a=0;a<s.length-1;a++){const f=s[a],m=s[a+1];for(let w=0;w<i.length-1;w++)if($m(f,m,i[w],i[w+1]))return!0}return!1}function $m(s,i,a,f){return wn(s,a,f)!==wn(i,a,f)&&wn(s,i,a)!==wn(s,i,f)}function Iv(s,i,a){const f=a*a;if(1===i.length)return s.distSqr(i[0])<f;for(let m=1;m<i.length;m++)if(Zx(s,i[m-1],i[m])<f)return!0;return!1}function Zx(s,i,a){const f=i.distSqr(a);if(0===f)return s.distSqr(i);const m=((s.x-i.x)*(a.x-i.x)+(s.y-i.y)*(a.y-i.y))/f;return s.distSqr(m<0?i:m>1?a:a.sub(i)._mult(m)._add(i))}function Wx(s,i){let a,f,m,w=!1;for(let S=0;S<s.length;S++){a=s[S];for(let M=0,P=a.length-1;M<a.length;P=M++)f=a[M],m=a[P],f.y>i.y!=m.y>i.y&&i.x<(m.x-f.x)*(i.y-f.y)/(m.y-f.y)+f.x&&(w=!w)}return w}function md(s,i){let a=!1;for(let f=0,m=s.length-1;f<s.length;m=f++){const w=s[f],S=s[m];w.y>i.y!=S.y>i.y&&i.x<(S.x-w.x)*(i.y-w.y)/(S.y-w.y)+w.x&&(a=!a)}return a}function Yx(s,i,a,f,m){for(const S of s)if(i<=S.x&&a<=S.y&&f>=S.x&&m>=S.y)return!0;const w=[new Q(i,a),new Q(i,m),new Q(f,m),new Q(f,a)];if(s.length>2)for(const S of w)if(md(s,S))return!0;for(let S=0;S<s.length-1;S++)if(Kx(s[S],s[S+1],w))return!0;return!1}function Kx(s,i,a){const f=a[0],m=a[2];if(s.x<f.x&&i.x<f.x||s.x>m.x&&i.x>m.x||s.y<f.y&&i.y<f.y||s.y>m.y&&i.y>m.y)return!1;const w=wn(s,i,a[0]);return w!==wn(s,i,a[1])||w!==wn(s,i,a[2])||w!==wn(s,i,a[3])}function zf(s,i,a){const f=i.paint.get(s).value;return"constant"===f.kind?f.value:a.programConfigurations.get(i.id).getMaxValue(s)}function yd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function qm(s,i,a,f,m){if(!i[0]&&!i[1])return s;const w=Q.convert(i)._mult(m);"viewport"===a&&w._rotate(-f);const S=[];for(let M=0;M<s.length;M++)S.push(s[M].sub(w));return S}function Hm(s,i,a,f){const m=Q.convert(s)._mult(f);return"viewport"===i&&m._rotate(-a),m}oe(Ev,"CircleBucket",{omit:["layers"]});const Tv=new Bn({"circle-sort-key":new bt(zt.layout_circle["circle-sort-key"])});var Sl={paint:new Bn({"circle-radius":new bt(zt.paint_circle["circle-radius"]),"circle-color":new bt(zt.paint_circle["circle-color"]),"circle-blur":new bt(zt.paint_circle["circle-blur"]),"circle-opacity":new bt(zt.paint_circle["circle-opacity"]),"circle-translate":new Ft(zt.paint_circle["circle-translate"]),"circle-translate-anchor":new Ft(zt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ft(zt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ft(zt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new bt(zt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new bt(zt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new bt(zt.paint_circle["circle-stroke-opacity"])}),layout:Tv},tg=1e-6,Il=typeof Float32Array<"u"?Float32Array:Array;function Mv(){var s=new Il(9);return Il!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Xm(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3],M=i[4],P=i[5],R=i[6],z=i[7],V=i[8],G=a[0],Z=a[1],W=a[2],re=a[3],be=a[4],Xe=a[5],Ke=a[6],qe=a[7],Je=a[8];return s[0]=G*f+Z*S+W*R,s[1]=G*m+Z*M+W*z,s[2]=G*w+Z*P+W*V,s[3]=re*f+be*S+Xe*R,s[4]=re*m+be*M+Xe*z,s[5]=re*w+be*P+Xe*V,s[6]=Ke*f+qe*S+Je*R,s[7]=Ke*m+qe*M+Je*z,s[8]=Ke*w+qe*P+Je*V,s}function dc(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Zm(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=i[4],M=i[5],P=i[6],R=i[7],z=i[8],V=i[9],G=i[10],Z=i[11],W=i[12],re=i[13],be=i[14],Xe=i[15],Ke=a*M-f*S,qe=a*P-m*S,Je=a*R-w*S,at=f*P-m*M,Qe=f*R-w*M,Ut=m*R-w*P,Ot=z*re-V*W,rn=z*be-G*W,In=z*Xe-Z*W,Ht=V*be-G*re,an=V*Xe-Z*re,ln=G*Xe-Z*be,_n=Ke*ln-qe*an+Je*Ht+at*In-Qe*rn+Ut*Ot;return _n?(s[0]=(M*ln-P*an+R*Ht)*(_n=1/_n),s[1]=(m*an-f*ln-w*Ht)*_n,s[2]=(re*Ut-be*Qe+Xe*at)*_n,s[3]=(G*Qe-V*Ut-Z*at)*_n,s[4]=(P*In-S*ln-R*rn)*_n,s[5]=(a*ln-m*In+w*rn)*_n,s[6]=(be*Je-W*Ut-Xe*qe)*_n,s[7]=(z*Ut-G*Je+Z*qe)*_n,s[8]=(S*an-M*In+R*Ot)*_n,s[9]=(f*In-a*an-w*Ot)*_n,s[10]=(W*Qe-re*Je+Xe*Ke)*_n,s[11]=(V*Je-z*Qe-Z*Ke)*_n,s[12]=(M*rn-S*Ht-P*Ot)*_n,s[13]=(a*Ht-f*rn+m*Ot)*_n,s[14]=(re*qe-W*at-be*Ke)*_n,s[15]=(z*at-V*qe+G*Ke)*_n,s):null}function _d(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3],M=i[4],P=i[5],R=i[6],z=i[7],V=i[8],G=i[9],Z=i[10],W=i[11],re=i[12],be=i[13],Xe=i[14],Ke=i[15],qe=a[0],Je=a[1],at=a[2],Qe=a[3];return s[0]=qe*f+Je*M+at*V+Qe*re,s[1]=qe*m+Je*P+at*G+Qe*be,s[2]=qe*w+Je*R+at*Z+Qe*Xe,s[3]=qe*S+Je*z+at*W+Qe*Ke,s[4]=(qe=a[4])*f+(Je=a[5])*M+(at=a[6])*V+(Qe=a[7])*re,s[5]=qe*m+Je*P+at*G+Qe*be,s[6]=qe*w+Je*R+at*Z+Qe*Xe,s[7]=qe*S+Je*z+at*W+Qe*Ke,s[8]=(qe=a[8])*f+(Je=a[9])*M+(at=a[10])*V+(Qe=a[11])*re,s[9]=qe*m+Je*P+at*G+Qe*be,s[10]=qe*w+Je*R+at*Z+Qe*Xe,s[11]=qe*S+Je*z+at*W+Qe*Ke,s[12]=(qe=a[12])*f+(Je=a[13])*M+(at=a[14])*V+(Qe=a[15])*re,s[13]=qe*m+Je*P+at*G+Qe*be,s[14]=qe*w+Je*R+at*Z+Qe*Xe,s[15]=qe*S+Je*z+at*W+Qe*Ke,s}function sp(s,i,a){var f,m,w,S,M,P,R,z,V,G,Z,W,re=a[0],be=a[1],Xe=a[2];return i===s?(s[12]=i[0]*re+i[4]*be+i[8]*Xe+i[12],s[13]=i[1]*re+i[5]*be+i[9]*Xe+i[13],s[14]=i[2]*re+i[6]*be+i[10]*Xe+i[14],s[15]=i[3]*re+i[7]*be+i[11]*Xe+i[15]):(m=i[1],w=i[2],S=i[3],M=i[4],P=i[5],R=i[6],z=i[7],V=i[8],G=i[9],Z=i[10],W=i[11],s[0]=f=i[0],s[1]=m,s[2]=w,s[3]=S,s[4]=M,s[5]=P,s[6]=R,s[7]=z,s[8]=V,s[9]=G,s[10]=Z,s[11]=W,s[12]=f*re+M*be+V*Xe+i[12],s[13]=m*re+P*be+G*Xe+i[13],s[14]=w*re+R*be+Z*Xe+i[14],s[15]=S*re+z*be+W*Xe+i[15]),s}function Jh(s,i,a){var f=a[0],m=a[1],w=a[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*m,s[5]=i[5]*m,s[6]=i[6]*m,s[7]=i[7]*m,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Wm(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[4],S=i[5],M=i[6],P=i[7],R=i[8],z=i[9],V=i[10],G=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*m+R*f,s[5]=S*m+z*f,s[6]=M*m+V*f,s[7]=P*m+G*f,s[8]=R*m-w*f,s[9]=z*m-S*f,s[10]=V*m-M*f,s[11]=G*m-P*f,s}function ng(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[0],S=i[1],M=i[2],P=i[3],R=i[8],z=i[9],V=i[10],G=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m-R*f,s[1]=S*m-z*f,s[2]=M*m-V*f,s[3]=P*m-G*f,s[8]=w*f+R*m,s[9]=S*f+z*m,s[10]=M*f+V*m,s[11]=P*f+G*m,s}function fl(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function rg(s,i,a){var f,m,w,S=a[0],M=a[1],P=a[2],R=Math.hypot(S,M,P);return R<tg?null:(S*=R=1/R,M*=R,P*=R,f=Math.sin(i),m=Math.cos(i),s[0]=S*S*(w=1-m)+m,s[1]=M*S*w+P*f,s[2]=P*S*w-M*f,s[3]=0,s[4]=S*M*w-P*f,s[5]=M*M*w+m,s[6]=P*M*w+S*f,s[7]=0,s[8]=S*P*w+M*f,s[9]=M*P*w-S*f,s[10]=P*P*w+m,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var Dv=_d;function ap(){var s=new Il(3);return Il!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function ju(s){var i=new Il(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i}function bh(s){return Math.hypot(s[0],s[1],s[2])}function Bf(s,i,a){var f=new Il(3);return f[0]=s,f[1]=i,f[2]=a,f}function eh(s,i,a){return s[0]=i[0]+a[0],s[1]=i[1]+a[1],s[2]=i[2]+a[2],s}function Ym(s,i,a){return s[0]=i[0]-a[0],s[1]=i[1]-a[1],s[2]=i[2]-a[2],s}function Km(s,i,a){return s[0]=i[0]*a[0],s[1]=i[1]*a[1],s[2]=i[2]*a[2],s}function up(s,i,a){return s[0]=Math.min(i[0],a[0]),s[1]=Math.min(i[1],a[1]),s[2]=Math.min(i[2],a[2]),s}function vd(s,i,a){return s[0]=Math.max(i[0],a[0]),s[1]=Math.max(i[1],a[1]),s[2]=Math.max(i[2],a[2]),s}function Wl(s,i,a){return s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s}function xd(s,i,a,f){return s[0]=i[0]+a[0]*f,s[1]=i[1]+a[1]*f,s[2]=i[2]+a[2]*f,s}function tl(s,i){var a=i[0],f=i[1],m=i[2],w=a*a+f*f+m*m;return w>0&&(w=1/Math.sqrt(w)),s[0]=i[0]*w,s[1]=i[1]*w,s[2]=i[2]*w,s}function pc(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function lp(s,i,a){var f=i[0],m=i[1],w=i[2],S=a[0],M=a[1],P=a[2];return s[0]=m*P-w*M,s[1]=w*S-f*P,s[2]=f*M-m*S,s}function va(s,i,a){var f=i[0],m=i[1],w=i[2],S=a[3]*f+a[7]*m+a[11]*w+a[15];return s[0]=(a[0]*f+a[4]*m+a[8]*w+a[12])/(S=S||1),s[1]=(a[1]*f+a[5]*m+a[9]*w+a[13])/S,s[2]=(a[2]*f+a[6]*m+a[10]*w+a[14])/S,s}function Av(s,i,a){var f=a[0],m=a[1],w=a[2],S=i[0],M=i[1],P=i[2],R=m*P-w*M,z=w*S-f*P,V=f*M-m*S,G=m*V-w*z,Z=w*R-f*V,W=f*z-m*R,re=2*a[3];return z*=re,V*=re,Z*=2,W*=2,s[0]=S+(R*=re)+(G*=2),s[1]=M+z+Z,s[2]=P+V+W,s}var Eh,Ac=Ym,Jx=Km,Jm=bh;function ig(s,i,a){return s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s[3]=i[3]*a,s}function Qm(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=a*a+f*f+m*m+w*w;return S>0&&(S=1/Math.sqrt(S)),s[0]=a*S,s[1]=f*S,s[2]=m*S,s[3]=w*S,s}function gc(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3];return s[0]=a[0]*f+a[4]*m+a[8]*w+a[12]*S,s[1]=a[1]*f+a[5]*m+a[9]*w+a[13]*S,s[2]=a[2]*f+a[6]*m+a[10]*w+a[14]*S,s[3]=a[3]*f+a[7]*m+a[11]*w+a[15]*S,s}function og(){var s=new Il(4);return Il!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function ey(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Pv(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(a),P=Math.cos(a);return s[0]=f*P+S*M,s[1]=m*P+w*M,s[2]=w*P-m*M,s[3]=S*P-f*M,s}function sg(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(a),P=Math.cos(a);return s[0]=f*P-w*M,s[1]=m*P+S*M,s[2]=w*P+f*M,s[3]=S*P-m*M,s}ap(),Eh=new Il(4),Il!=Float32Array&&(Eh[0]=0,Eh[1]=0,Eh[2]=0,Eh[3]=0);var Qx=Qm;ap(),Bf(1,0,0),Bf(0,1,0),og(),og(),Mv();class ty{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,f){const m=pc(a,this.dir);if(Math.abs(m)<1e-6)return!1;const w=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/m;return f[0]=this.pos[0]+this.dir[0]*w,f[1]=this.pos[1]+this.dir[1]*w,f[2]=this.pos[2]+this.dir[2]*w,!0}closestPointOnSphere(i,a,f){if(re=(Z=this.pos)[0],be=Z[1],Xe=Z[2],Ke=(W=i)[0],qe=W[1],Je=W[2],Math.abs(re-Ke)<=tg*Math.max(1,Math.abs(re),Math.abs(Ke))&&Math.abs(be-qe)<=tg*Math.max(1,Math.abs(be),Math.abs(qe))&&Math.abs(Xe-Je)<=tg*Math.max(1,Math.abs(Xe),Math.abs(Je))||0===a)return f[0]=f[1]=f[2]=0,!1;var Z,W,re,be,Xe,Ke,qe,Je;const[m,w,S]=this.dir,M=this.pos[0]-i[0],P=this.pos[1]-i[1],R=this.pos[2]-i[2],z=m*m+w*w+S*S,V=2*(M*m+P*w+R*S),G=V*V-4*z*(M*M+P*P+R*R-a*a);if(G<0){const Z=Math.max(-V/2,0),W=M+m*Z,re=P+w*Z,be=R+S*Z,Xe=Math.hypot(W,re,be);return f[0]=W*a/Xe,f[1]=re*a/Xe,f[2]=be*a/Xe,!1}{const Z=(-V-Math.sqrt(G))/(2*z);if(Z<0){const W=Math.hypot(M,P,R);return f[0]=M*a/W,f[1]=P*a/W,f[2]=R*a/W,!1}return f[0]=M+m*Z,f[1]=P+w*Z,f[2]=R+S*Z,!0}}}class ny{constructor(i,a,f,m,w){this.TL=i,this.TR=a,this.BR=f,this.BL=m,this.horizon=w}static fromInvProjectionMatrix(i,a,f){const m=[-1,1,1],w=[1,1,1],S=[1,-1,1],M=[-1,-1,1],P=va(m,m,i),R=va(w,w,i),z=va(S,S,i),V=va(M,M,i);return new ny(P,R,z,V,a/f)}}class ry{constructor(i,a){this.points=i,this.planes=a}static fromInvProjectionMatrix(i,a,f,m){const w=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const R=gc([],P,i),z=1/R[3]/a*w;return(V=R)[0]=(G=R)[0]*(Z=[z,z,m?1/R[3]:z,z])[0],V[1]=G[1]*Z[1],V[2]=G[2]*Z[2],V[3]=G[3]*Z[3],V;var V,G,Z}),M=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const R=tl([],lp([],Ac([],S[P[0]],S[P[1]]),Ac([],S[P[2]],S[P[1]]))),z=-pc(R,S[P[1]]);return R.concat(z)});return new ry(S,M)}}class nl{static fromPoints(i){const a=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of i)up(a,a,m),vd(f,f,m);return new nl(a,f)}static applyTransform(i,a){const f=i.getCorners();for(let m=0;m<f.length;++m)va(f[m],f[m],a);return nl.fromPoints(f)}constructor(i,a){this.min=i,this.max=a,this.center=Wl([],eh([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],f=ju(this.min),m=ju(this.max);for(let w=0;w<a.length;w++)f[w]=a[w]?this.min[w]:this.center[w],m[w]=a[w]?this.center[w]:this.max[w];return m[2]=this.max[2],new nl(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){const a=this.getCorners();let f=!0;for(let m=0;m<i.planes.length;m++){const w=i.planes[m];let S=0;for(let M=0;M<a.length;M++)S+=pc(w,a[M])+w[3]>=0;if(0===S)return 0;S!==a.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let w=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let M=0;M<i.points.length;M++){const P=i.points[M][m]-this.min[m];w=Math.min(w,P),S=Math.max(S,P)}if(S<0||w>this.max[m]-this.min[m])return 0}return 1}}function Lv(s,i,a,f,m,w,S,M,P){if(w&&s.queryGeometry.isAboveHorizon)return!1;w&&(P*=s.pixelToTileUnitsFactor);const R=s.tileID.canonical,z=a.projection.upVectorScale(R,a.center.lat,a.worldSize).metersToTile;for(const V of i)for(const G of V){const Z=G.add(M),W=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(Z.x,Z.y,!0):0,re=a.projection.projectTilePoint(Z.x,Z.y,R);if(W>0){const qe=a.projection.upVector(R,Z.x,Z.y);re.x+=qe[0]*z*W,re.y+=qe[1]*z*W,re.z+=qe[2]*z*W}const be=w?Z:Rv(re.x,re.y,re.z,f),Xe=w?s.tilespaceRays.map(qe=>iy(qe,W)):s.queryGeometry.screenGeometry,Ke=gc([],[re.x,re.y,re.z,1],f);if(!S&&w?P*=Ke[3]/a.cameraToCenterDistance:S&&!w&&(P*=a.cameraToCenterDistance/Ke[3]),w){const qe=La((G.y/jr+R.y)/(1<<R.z));P/=a.projection.pixelsPerMeter(qe,1)/fc(1,qe)}if(Xx(Xe,be,P))return!0}return!1}function Rv(s,i,a,f){const m=gc([],[s,i,a,1],f);return new Q(m[0]/m[3],m[1]/m[3])}const ag=Bf(0,0,0),Ov=Bf(0,0,1);function iy(s,i){const a=ap();return ag[2]=i,s.intersectsPlane(ag,Ov,a),new Q(a[0],a[1])}class Nv extends Ev{}function kv(s,{width:i,height:a},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*a*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*a*f);return s.width=i,s.height=a,s.data=m,s}function oy(s,i,a){const{width:f,height:m}=i;f===s.width&&m===s.height||(ug(s,i,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,f),height:Math.min(s.height,m)},a),s.width=f,s.height=m,s.data=i.data)}function ug(s,i,a,f,m,w){if(0===m.width||0===m.height)return i;if(m.width>s.width||m.height>s.height||a.x>s.width-m.width||a.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||f.x>i.width-m.width||f.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const S=s.data,M=i.data;for(let P=0;P<m.height;P++){const R=((a.y+P)*s.width+a.x)*w,z=((f.y+P)*i.width+f.x)*w;for(let V=0;V<m.width*w;V++)M[z+V]=S[R+V]}return i}oe(Nv,"HeatmapBucket",{omit:["layers"]});class dl{constructor(i,a){kv(this,i,1,a)}resize(i){oy(this,new dl(i),1)}clone(){return new dl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,f,m,w){ug(i,a,f,m,w,1)}}class pl{constructor(i,a){kv(this,i,4,a)}resize(i){oy(this,new pl(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new pl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,f,m,w){ug(i,a,f,m,w,4)}}oe(dl,"AlphaImage"),oe(pl,"RGBAImage");var Fv={paint:new Bn({"heatmap-radius":new bt(zt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new bt(zt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ft(zt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Vn(zt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ft(zt.paint_heatmap["heatmap-opacity"])})};function sy(s){const i={},a=s.resolution||256,f=s.clips?s.clips.length:1,m=s.image||new pl({width:a,height:f}),w=(S,M,P)=>{i[s.evaluationKey]=P;const R=s.expression.evaluate(i);m.data[S+M+0]=Math.floor(255*R.r/R.a),m.data[S+M+1]=Math.floor(255*R.g/R.a),m.data[S+M+2]=Math.floor(255*R.b/R.a),m.data[S+M+3]=Math.floor(255*R.a)};if(s.clips)for(let S=0,M=0;S<f;++S,M+=4*a)for(let P=0,R=0;P<a;P++,R+=4){const z=P/(a-1),{start:V,end:G}=s.clips[S];w(M,R,V*(1-z)+G*z)}else for(let S=0,M=0;S<a;S++,M+=4)w(0,M,S/(a-1));return m}var iS={paint:new Bn({"hillshade-illumination-direction":new Ft(zt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ft(zt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ft(zt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ft(zt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ft(zt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ft(zt.paint_hillshade["hillshade-accent-color"])})};const lg=Un([{name:"a_pos",components:2,type:"Int16"}],4),{members:ew}=lg;var wd={exports:{}};function cp(s,i,a){a=a||2;var f,m,w,S,M,P,R,z=i&&i.length,V=z?i[0]*a:s.length,G=ay(s,0,V,a,!0),Z=[];if(!G||G.next===G.prev)return Z;if(z&&(G=function(re,be,Xe,Ke){var qe,Je,at,Qe=[];for(qe=0,Je=be.length;qe<Je;qe++)(at=ay(re,be[qe]*Ke,qe<Je-1?be[qe+1]*Ke:re.length,Ke,!1))===at.next&&(at.steiner=!0),Qe.push(Bv(at));for(Qe.sort(ly),qe=0;qe<Qe.length;qe++)Xe=cy(Qe[qe],Xe);return Xe}(s,i,G,a)),s.length>80*a){f=w=s[0],m=S=s[1];for(var W=a;W<V;W+=a)(M=s[W])<f&&(f=M),(P=s[W+1])<m&&(m=P),M>w&&(w=M),P>S&&(S=P);R=0!==(R=Math.max(w-f,S-m))?32767/R:0}return bd(G,Z,a,f,m,R,0),Z}function ay(s,i,a,f,m){var w,S;if(m===dp(s,i,a,f)>0)for(w=i;w<a;w+=f)S=jv(w,s[w],s[w+1],S);else for(w=a-f;w>=i;w-=f)S=jv(w,s[w],s[w+1],S);return S&&fp(S,S.next)&&(fg(S),S=S.next),S}function Ch(s,i){if(!s)return s;i||(i=s);var a,f=s;do{if(a=!1,f.steiner||!fp(f,f.next)&&0!==Ra(f.prev,f,f.next))f=f.next;else{if(fg(f),(f=i=f.prev)===f.next)break;a=!0}}while(a||f!==i);return i}function bd(s,i,a,f,m,w,S){if(s){!S&&w&&function(z,V,G,Z){var W=z;do{0===W.z&&(W.z=hy(W.x,W.y,V,G,Z)),W.prevZ=W.prev,W.nextZ=W.next,W=W.next}while(W!==z);W.prevZ.nextZ=null,W.prevZ=null,function(re){var be,Xe,Ke,qe,Je,at,Qe,Ut,Ot=1;do{for(Xe=re,re=null,Je=null,at=0;Xe;){for(at++,Ke=Xe,Qe=0,be=0;be<Ot&&(Qe++,Ke=Ke.nextZ);be++);for(Ut=Ot;Qe>0||Ut>0&&Ke;)0!==Qe&&(0===Ut||!Ke||Xe.z<=Ke.z)?(qe=Xe,Xe=Xe.nextZ,Qe--):(qe=Ke,Ke=Ke.nextZ,Ut--),Je?Je.nextZ=qe:re=qe,qe.prevZ=Je,Je=qe;Xe=Ke}Je.nextZ=null,Ot*=2}while(at>1)}(W)}(s,f,m,w);for(var M,P,R=s;s.prev!==s.next;)if(M=s.prev,P=s.next,w?hg(s,f,m,w):cg(s))i.push(M.i/a|0),i.push(s.i/a|0),i.push(P.i/a|0),fg(s),s=P.next,R=P.next;else if((s=P)===R){S?1===S?bd(s=zv(Ch(s),i,a),i,a,f,m,w,2):2===S&&uy(s,i,a,f,m,w):bd(Ch(s),i,a,f,m,w,1);break}}}function cg(s){var i=s.prev,a=s,f=s.next;if(Ra(i,a,f)>=0)return!1;for(var m=i.x,w=a.x,S=f.x,M=i.y,P=a.y,R=f.y,z=m<w?m<S?m:S:w<S?w:S,V=M<P?M<R?M:R:P<R?P:R,G=m>w?m>S?m:S:w>S?w:S,Z=M>P?M>R?M:R:P>R?P:R,W=f.next;W!==i;){if(W.x>=z&&W.x<=G&&W.y>=V&&W.y<=Z&&Ed(m,M,w,P,S,R,W.x,W.y)&&Ra(W.prev,W,W.next)>=0)return!1;W=W.next}return!0}function hg(s,i,a,f){var m=s.prev,w=s,S=s.next;if(Ra(m,w,S)>=0)return!1;for(var M=m.x,P=w.x,R=S.x,z=m.y,V=w.y,G=S.y,Z=M<P?M<R?M:R:P<R?P:R,W=z<V?z<G?z:G:V<G?V:G,re=M>P?M>R?M:R:P>R?P:R,be=z>V?z>G?z:G:V>G?V:G,Xe=hy(Z,W,i,a,f),Ke=hy(re,be,i,a,f),qe=s.prevZ,Je=s.nextZ;qe&&qe.z>=Xe&&Je&&Je.z<=Ke;){if(qe.x>=Z&&qe.x<=re&&qe.y>=W&&qe.y<=be&&qe!==m&&qe!==S&&Ed(M,z,P,V,R,G,qe.x,qe.y)&&Ra(qe.prev,qe,qe.next)>=0||(qe=qe.prevZ,Je.x>=Z&&Je.x<=re&&Je.y>=W&&Je.y<=be&&Je!==m&&Je!==S&&Ed(M,z,P,V,R,G,Je.x,Je.y)&&Ra(Je.prev,Je,Je.next)>=0))return!1;Je=Je.nextZ}for(;qe&&qe.z>=Xe;){if(qe.x>=Z&&qe.x<=re&&qe.y>=W&&qe.y<=be&&qe!==m&&qe!==S&&Ed(M,z,P,V,R,G,qe.x,qe.y)&&Ra(qe.prev,qe,qe.next)>=0)return!1;qe=qe.prevZ}for(;Je&&Je.z<=Ke;){if(Je.x>=Z&&Je.x<=re&&Je.y>=W&&Je.y<=be&&Je!==m&&Je!==S&&Ed(M,z,P,V,R,G,Je.x,Je.y)&&Ra(Je.prev,Je,Je.next)>=0)return!1;Je=Je.nextZ}return!0}function zv(s,i,a){var f=s;do{var m=f.prev,w=f.next.next;!fp(m,w)&&fy(m,f,f.next,w)&&Pc(m,w)&&Pc(w,m)&&(i.push(m.i/a|0),i.push(f.i/a|0),i.push(w.i/a|0),fg(f),fg(f.next),f=s=w),f=f.next}while(f!==s);return Ch(f)}function uy(s,i,a,f,m,w){var S=s;do{for(var M=S.next.next;M!==S.prev;){if(S.i!==M.i&&tw(S,M)){var P=Uv(S,M);return S=Ch(S,S.next),P=Ch(P,P.next),bd(S,i,a,f,m,w,0),void bd(P,i,a,f,m,w,0)}M=M.next}S=S.next}while(S!==s)}function ly(s,i){return s.x-i.x}function cy(s,i){var a=function(m,w){var S,M=w,P=m.x,R=m.y,z=-1/0;do{if(R<=M.y&&R>=M.next.y&&M.next.y!==M.y){var V=M.x+(R-M.y)*(M.next.x-M.x)/(M.next.y-M.y);if(V<=P&&V>z&&(z=V,S=M.x<M.next.x?M:M.next,V===P))return S}M=M.next}while(M!==w);if(!S)return null;var G,Z=S,W=S.x,re=S.y,be=1/0;M=S;do{P>=M.x&&M.x>=W&&P!==M.x&&Ed(R<re?P:z,R,W,re,R<re?z:P,R,M.x,M.y)&&(G=Math.abs(R-M.y)/(P-M.x),Pc(M,m)&&(G<be||G===be&&(M.x>S.x||M.x===S.x&&hp(S,M)))&&(S=M,be=G)),M=M.next}while(M!==Z);return S}(s,i);if(!a)return i;var f=Uv(a,s);return Ch(f,f.next),Ch(a,a.next)}function hp(s,i){return Ra(s.prev,s,i.prev)<0&&Ra(i.next,s,s.next)<0}function hy(s,i,a,f,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Bv(s){var i=s,a=s;do{(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next}while(i!==s);return a}function Ed(s,i,a,f,m,w,S,M){return(m-S)*(i-M)>=(s-S)*(w-M)&&(s-S)*(f-M)>=(a-S)*(i-M)&&(a-S)*(w-M)>=(m-S)*(f-M)}function tw(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(a,f){var m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==f.i&&m.next.i!==f.i&&fy(m,m.next,a,f))return!0;m=m.next}while(m!==a);return!1}(s,i)&&(Pc(s,i)&&Pc(i,s)&&function(a,f){var m=a,w=!1,S=(a.x+f.x)/2,M=(a.y+f.y)/2;do{m.y>M!=m.next.y>M&&m.next.y!==m.y&&S<(m.next.x-m.x)*(M-m.y)/(m.next.y-m.y)+m.x&&(w=!w),m=m.next}while(m!==a);return w}(s,i)&&(Ra(s.prev,s,i.prev)||Ra(s,i.prev,i))||fp(s,i)&&Ra(s.prev,s,s.next)>0&&Ra(i.prev,i,i.next)>0)}function Ra(s,i,a){return(i.y-s.y)*(a.x-i.x)-(i.x-s.x)*(a.y-i.y)}function fp(s,i){return s.x===i.x&&s.y===i.y}function fy(s,i,a,f){var m=Cd(Ra(s,i,a)),w=Cd(Ra(s,i,f)),S=Cd(Ra(a,f,s)),M=Cd(Ra(a,f,i));return m!==w&&S!==M||!(0!==m||!Uf(s,a,i))||!(0!==w||!Uf(s,f,i))||!(0!==S||!Uf(a,s,f))||!(0!==M||!Uf(a,i,f))}function Uf(s,i,a){return i.x<=Math.max(s.x,a.x)&&i.x>=Math.min(s.x,a.x)&&i.y<=Math.max(s.y,a.y)&&i.y>=Math.min(s.y,a.y)}function Cd(s){return s>0?1:s<0?-1:0}function Pc(s,i){return Ra(s.prev,s,s.next)<0?Ra(s,i,s.next)>=0&&Ra(s,s.prev,i)>=0:Ra(s,i,s.prev)<0||Ra(s,s.next,i)<0}function Uv(s,i){var a=new dy(s.i,s.x,s.y),f=new dy(i.i,i.x,i.y),m=s.next,w=i.prev;return s.next=i,i.prev=s,a.next=m,m.prev=a,f.next=a,a.prev=f,w.next=f,f.prev=w,f}function jv(s,i,a,f){var m=new dy(s,i,a);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function fg(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function dy(s,i,a){this.i=s,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function dp(s,i,a,f){for(var m=0,w=i,S=a-f;w<a;w+=f)m+=(s[S]-s[w])*(s[w+1]+s[S+1]),S=w;return m}function nw(s,i,a,f,m){py(s,i,a||0,f||s.length-1,m||gy)}function py(s,i,a,f,m){for(;f>a;){if(f-a>600){var w=f-a+1,S=i-a+1,M=Math.log(w),P=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*P*(w-P)/w)*(S-w/2<0?-1:1);py(s,i,Math.max(a,Math.floor(i-S*P/w+R)),Math.min(f,Math.floor(i+(w-S)*P/w+R)),m)}var z=s[i],V=a,G=f;for(Qh(s,a,i),m(s[f],z)>0&&Qh(s,a,f);V<G;){for(Qh(s,V,G),V++,G--;m(s[V],z)<0;)V++;for(;m(s[G],z)>0;)G--}0===m(s[a],z)?Qh(s,a,G):Qh(s,++G,f),G<=i&&(a=G+1),i<=G&&(f=G-1)}}function Qh(s,i,a){var f=s[i];s[i]=s[a],s[a]=f}function gy(s,i){return s<i?-1:s>i?1:0}function dg(s,i){const a=s.length;if(a<=1)return[s];const f=[];let m,w;for(let S=0;S<a;S++){const M=pr(s[S]);0!==M&&(s[S].area=Math.abs(M),void 0===w&&(w=M<0),w===M<0?(m&&f.push(m),m=[s[S]]):m.push(s[S]))}if(m&&f.push(m),i>1)for(let S=0;S<f.length;S++)f[S].length<=i||(nw(f[S],i,1,f[S].length-1,Vv),f[S]=f[S].slice(0,i));return f}function Vv(s,i){return i.area-s.area}function pg(s,i,a){const f=a.patternDependencies;let m=!1;for(const w of i){const S=w.paint.get(`${s}-pattern`);S.isConstant()||(m=!0);const M=S.constantOr(null);M&&(m=!0,f[M.to]=!0,f[M.from]=!0)}return m}function gg(s,i,a,f,m){const w=m.patternDependencies;for(const S of i){const M=S.paint.get(`${s}-pattern`).value;if("constant"!==M.kind){let P=M.evaluate({zoom:f-1},a,{},m.availableImages),R=M.evaluate({zoom:f},a,{},m.availableImages),z=M.evaluate({zoom:f+1},a,{},m.availableImages);P=P&&P.name?P.name:P,R=R&&R.name?R.name:R,z=z&&z.name?z.name:z,w[P]=!0,w[R]=!0,w[z]=!0,a.patterns[S.id]={min:P,mid:R,max:z}}}return a}wd.exports=cp,wd.exports.default=cp,cp.deviation=function(s,i,a,f){var m=i&&i.length,w=Math.abs(dp(s,0,m?i[0]*a:s.length,a));if(m)for(var S=0,M=i.length;S<M;S++)w-=Math.abs(dp(s,i[S]*a,S<M-1?i[S+1]*a:s.length,a));var P=0;for(S=0;S<f.length;S+=3){var R=f[S]*a,z=f[S+1]*a,V=f[S+2]*a;P+=Math.abs((s[R]-s[V])*(s[z+1]-s[R+1])-(s[R]-s[z])*(s[V+1]-s[R+1]))}return 0===w&&0===P?0:Math.abs((P-w)/w)},cp.flatten=function(s){for(var i=s[0][0].length,a={vertices:[],holes:[],dimensions:i},f=0,m=0;m<s.length;m++){for(var w=0;w<s[m].length;w++)for(var S=0;S<i;S++)a.vertices.push(s[m][w][S]);m>0&&a.holes.push(f+=s[m-1].length)}return a};class mg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new wi,this.indexArray=new Du,this.indexArray2=new Cl,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new _a,this.segments2=new _a,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}populate(i,a,f,m){this.hasPattern=pg("fill",this.layers,a);const w=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:M,id:P,index:R,sourceLayerIndex:z}of i){const V=this.layers[0]._featureFilter.needGeometry,G=Kh(M,V);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),G,f))continue;const Z=w?w.evaluate(G,{},f,a.availableImages):void 0,W={id:P,properties:M.properties,type:M.type,sourceLayerIndex:z,index:R,geometry:V?G.geometry:wh(M,f,m),patterns:{},sortKey:Z};S.push(W)}w&&S.sort((M,P)=>M.sortKey-P.sortKey);for(const M of S){const{geometry:P,index:R,sourceLayerIndex:z}=M;if(this.hasPattern){const V=gg("fill",this.layers,M,this.zoom,a);this.patternFeatures.push(V)}else this.addFeature(M,P,R,f,{},a.availableImages);a.featureIndex.insert(i[R].feature,P,R,z,this.index)}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}addFeatures(i,a,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,ew),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,f,m,w,S=[]){for(const M of dg(a,500)){let P=0;for(const W of M)P+=W.length;const R=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),z=R.vertexLength,V=[],G=[];for(const W of M){if(0===W.length)continue;W!==M[0]&&G.push(V.length/2);const re=this.segments2.prepareSegment(W.length,this.layoutVertexArray,this.indexArray2),be=re.vertexLength;this.layoutVertexArray.emplaceBack(W[0].x,W[0].y),this.indexArray2.emplaceBack(be+W.length-1,be),V.push(W[0].x),V.push(W[0].y);for(let Xe=1;Xe<W.length;Xe++)this.layoutVertexArray.emplaceBack(W[Xe].x,W[Xe].y),this.indexArray2.emplaceBack(be+Xe-1,be+Xe),V.push(W[Xe].x),V.push(W[Xe].y);re.vertexLength+=W.length,re.primitiveLength+=W.length}const Z=wd.exports(V,G);for(let W=0;W<Z.length;W+=3)this.indexArray.emplaceBack(z+Z[W],z+Z[W+1],z+Z[W+2]);R.vertexLength+=P,R.primitiveLength+=Z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}}oe(mg,"FillBucket",{omit:["layers","patternFeatures"]});const rw=new Bn({"fill-sort-key":new bt(zt.layout_fill["fill-sort-key"])});var iw={paint:new Bn({"fill-antialias":new Ft(zt.paint_fill["fill-antialias"]),"fill-opacity":new bt(zt.paint_fill["fill-opacity"]),"fill-color":new bt(zt.paint_fill["fill-color"]),"fill-outline-color":new bt(zt.paint_fill["fill-outline-color"]),"fill-translate":new Ft(zt.paint_fill["fill-translate"]),"fill-translate-anchor":new Ft(zt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Jn(zt.paint_fill["fill-pattern"])}),layout:rw};const ow=Un([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),sw=Un([{name:"a_centroid_pos",components:2,type:"Uint16"}]),ef=Un([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:pp}=ow;var yg={},oS=Q,aw=gp;function gp(s,i,a,f,m){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=m,s.readFields(sS,this,i)}function sS(s,i,a){1==s?i.id=a.readVarint():2==s?function(f,m){for(var w=f.readVarint()+f.pos;f.pos<w;){var S=m._keys[f.readVarint()],M=m._values[f.readVarint()];m.properties[S]=M}}(a,i):3==s?i.type=a.readVarint():4==s&&(i._geometry=a.pos)}function aS(s){for(var i,a,f=0,m=0,w=s.length,S=w-1;m<w;S=m++)f+=((a=s[S]).x-(i=s[m]).x)*(i.y+a.y);return f}gp.types=["Unknown","Point","LineString","Polygon"],gp.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,a=s.readVarint()+s.pos,f=1,m=0,w=0,S=0,M=[];s.pos<a;){if(m<=0){var P=s.readVarint();f=7&P,m=P>>3}if(m--,1===f||2===f)w+=s.readSVarint(),S+=s.readSVarint(),1===f&&(i&&M.push(i),i=[]),i.push(new oS(w,S));else{if(7!==f)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&M.push(i),M},gp.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,a=1,f=0,m=0,w=0,S=1/0,M=-1/0,P=1/0,R=-1/0;s.pos<i;){if(f<=0){var z=s.readVarint();a=7&z,f=z>>3}if(f--,1===a||2===a)(m+=s.readSVarint())<S&&(S=m),m>M&&(M=m),(w+=s.readSVarint())<P&&(P=w),w>R&&(R=w);else if(7!==a)throw new Error("unknown command "+a)}return[S,P,M,R]},gp.prototype.toGeoJSON=function(s,i,a){var f,m,w=this.extent*Math.pow(2,a),S=this.extent*s,M=this.extent*i,P=this.loadGeometry(),R=gp.types[this.type];function z(Z){for(var W=0;W<Z.length;W++){var re=Z[W];Z[W]=[360*(re.x+S)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(re.y+M)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(f=0;f<P.length;f++)V[f]=P[f][0];z(P=V);break;case 2:for(f=0;f<P.length;f++)z(P[f]);break;case 3:for(P=function(Z){var W=Z.length;if(W<=1)return[Z];for(var re,be,Xe=[],Ke=0;Ke<W;Ke++){var qe=aS(Z[Ke]);0!==qe&&(void 0===be&&(be=qe<0),be===qe<0?(re&&Xe.push(re),re=[Z[Ke]]):re.push(Z[Ke]))}return re&&Xe.push(re),Xe}(P),f=0;f<P.length;f++)for(m=0;m<P[f].length;m++)z(P[f][m])}1===P.length?P=P[0]:R="Multi"+R;var G={type:"Feature",geometry:{type:R,coordinates:P},properties:this.properties};return"id"in this&&(G.id=this.id),G};var Gv=aw,$v=qv;function qv(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(uw,this,i),this.length=this._features.length}function uw(s,i,a){15===s?i.version=a.readVarint():1===s?i.name=a.readString():5===s?i.extent=a.readVarint():2===s?i._features.push(a.pos):3===s?i._keys.push(a.readString()):4===s&&i._values.push(function(f){for(var m=null,w=f.readVarint()+f.pos;f.pos<w;){var S=f.readVarint()>>3;m=1===S?f.readString():2===S?f.readFloat():3===S?f.readDouble():4===S?f.readVarint64():5===S?f.readVarint():6===S?f.readSVarint():7===S?f.readBoolean():null}return m}(a))}qv.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new Gv(this._pbf,i,this.extent,this._keys,this._values)};var lw=$v;function my(s,i,a){if(3===s){var f=new lw(a,a.readVarint()+a.pos);f.length&&(i[f.name]=f)}}var Lc=yg.VectorTile=function(s,i){this.layers=s.readFields(my,{},i)},tf=yg.VectorTileFeature=aw;function mp(s,i,a,f){const m=[],w=0===f?(S,M,P,R,z,V)=>{S.push(new Q(V,P+(V-M)/(R-M)*(z-P)))}:(S,M,P,R,z,V)=>{S.push(new Q(M+(V-P)/(z-P)*(R-M),V))};for(const S of s){const M=[];for(const P of S){if(P.length<=2)continue;const R=[];for(let G=0;G<P.length-1;G++){const Z=P[G].x,W=P[G].y,re=P[G+1].x,be=P[G+1].y,Xe=0===f?Z:W,Ke=0===f?re:be;Xe<i?Ke>i&&w(R,Z,W,re,be,i):Xe>a?Ke<a&&w(R,Z,W,re,be,a):R.push(P[G]),Ke<i&&Xe>=i&&w(R,Z,W,re,be,i),Ke>a&&Xe<=a&&w(R,Z,W,re,be,a)}let z=P[P.length-1];const V=0===f?z.x:z.y;V>=i&&V<=a&&R.push(z),R.length&&(z=R[R.length-1],R[0].x===z.x&&R[0].y===z.y||R.push(R[0]),M.push(R))}M.length&&m.push(M)}return m}yg.VectorTileLayer=$v;const Hv=tf.types,Xv=Math.pow(2,13);function _g(s,i,a,f,m,w,S,M){s.emplaceBack((i<<1)+S,(a<<1)+w,(Math.floor(f*Xv)<<1)+m,Math.round(M))}function vg(s,i,a){s.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class cw{constructor(){this.acc=new Q(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Q(i.x,i.y),this.max=new Q(i.x,i.y))}append(i,a){this.currentPolyCount.edges++,this.acc._add(i);const f=this.min,m=this.max;i.x<f.x?f.x=i.x:i.x>m.x&&(m.x=i.x),i.y<f.y?f.y=i.y:i.y>m.y&&(m.y=i.y),((0===i.x||i.x===jr)&&i.x===a.x)!=((0===i.y||i.y===jr)&&i.y===a.y)&&this.processBorderOverlap(i,a),a.x<0!=i.x<0&&this.addBorderIntersection(0,Ii(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>jr!=i.x>jr&&this.addBorderIntersection(1,Ii(a.y,i.y,(jr-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,Ii(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>jr!=i.y>jr&&this.addBorderIntersection(3,Ii(a.x,i.x,(jr-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[i];a<f[0]&&(f[0]=a),a>f[1]&&(f[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const f=0===i.x?0:1;this.addBorderIntersection(f,a.y),this.addBorderIntersection(f,i.y)}else{const f=0===i.y?2:3;this.addBorderIntersection(f,a.x),this.addBorderIntersection(f,i.x)}}centroid(){const i=this.polyCount.reduce((a,f)=>a+f.edges,0);return 0!==i?this.acc.div(i)._round():new Q(0,0)}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0)}}class jf{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new ms,this.centroidVertexArray=new _v,this.indexArray=new Du,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new _a,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=i.enableTerrain}populate(i,a,f,m){this.features=[],this.hasPattern=pg("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(w){const S=Math.exp(Math.PI*(1-w.y/(1<<w.z)*2));return 80150034*S/(S*S+1)/jr/(1<<w.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:w,id:S,index:M,sourceLayerIndex:P}of i){const R=this.layers[0]._featureFilter.needGeometry,z=Kh(w,R);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),z,f))continue;const V={id:S,sourceLayerIndex:P,index:M,geometry:R?z.geometry:wh(w,f,m),properties:w.properties,type:w.type,patterns:{}},G=this.layoutVertexArray.length;this.hasPattern?this.features.push(gg("fill-extrusion",this.layers,V,this.zoom,a)):this.addFeature(V,V.geometry,M,f,{},a.availableImages,m),a.featureIndex.insert(w,V.geometry,M,P,this.index,G)}this.sortBorders()}addFeatures(i,a,f,m,w){for(const S of this.features){const{geometry:M}=S;this.addFeature(S,M,S.index,a,f,m,w)}this.sortBorders()}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pp),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,ef.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,sw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,f,m,w,S,M){const P=[new Q(0,0),new Q(jr,jr)],R=M.projection,z="globe"===R.name,V=this.enableTerrain&&!z?new cw:null,G="Polygon"===Hv[i.type];z&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lm);const Z=dg(a,500);for(let Xe=Z.length-1;Xe>=0;Xe--){const Ke=Z[Xe];(0===Ke.length||(W=Ke[0]).every(qe=>qe.x<=0)||W.every(qe=>qe.x>=jr)||W.every(qe=>qe.y<=0)||W.every(qe=>qe.y>=jr))&&Z.splice(Xe,1)}var W;let re;if(z)re=Kv(Z,P,m);else{re=[];for(const Xe of Z)re.push({polygon:Xe,bounds:P})}const be=G?this.edgeRadius:0;for(const{polygon:Xe,bounds:Ke}of re){let qe=0,Je=0;for(const Qe of Xe)G&&!Qe[0].equals(Qe[Qe.length-1])&&Qe.push(Qe[0]),Je+=G?Qe.length-1:Qe.length;const at=this.segments.prepareSegment((G?5:4)*Je,this.layoutVertexArray,this.indexArray);if(G){const Qe=[],Ut=[];qe=at.vertexLength;for(const rn of Xe){let In,Ht;rn.length&&rn!==Xe[0]&&Ut.push(Qe.length/2),In=rn[1].sub(rn[0])._perp()._unit();for(let an=1;an<rn.length;an++){const ln=rn[an],_n=rn[an===rn.length-1?1:an+1];let{x:Tn,y:Jt}=ln;if(be){Ht=_n.sub(ln)._perp()._unit();const Hn=In.add(Ht)._unit(),Fr=be*Math.min(4,1/(In.x*Hn.x+In.y*Hn.y));Tn+=Fr*Hn.x,Jt+=Fr*Hn.y,In=Ht}_g(this.layoutVertexArray,Tn,Jt,0,0,1,1,0),at.vertexLength++,Qe.push(ln.x,ln.y),z&&vg(this.layoutVertexExtArray,R.projectTilePoint(Tn,Jt,m),R.upVector(m,Tn,Jt))}}const Ot=wd.exports(Qe,Ut);for(let rn=0;rn<Ot.length;rn+=3)this.indexArray.emplaceBack(qe+Ot[rn],qe+Ot[rn+2],qe+Ot[rn+1]),at.primitiveLength++}for(const Qe of Xe){V&&Qe.length&&V.startRing(Qe[0]);let Ut,Ot,rn,In=Qe.length>4&&Zv(Qe[Qe.length-2],Qe[0],Qe[1]),Ht=be?uS(Qe[Qe.length-2],Qe[0],Qe[1],be):0;Ot=Qe[1].sub(Qe[0])._perp()._unit();let an=!0;for(let ln=1,_n=0;ln<Qe.length;ln++){let Tn=Qe[ln-1],Jt=Qe[ln];const Hn=Qe[ln===Qe.length-1?1:ln+1];if(V&&G&&V.currentPolyCount.top++,yy(Jt,Tn,Ke)){be&&(Ot=Hn.sub(Jt)._perp()._unit(),an=!an);continue}V&&V.append(Jt,Tn);const Fr=Jt.sub(Tn)._perp(),er=Fr.x/(Math.abs(Fr.x)+Math.abs(Fr.y)),yr=Fr.y>0?1:0,Yn=Tn.dist(Jt);if(_n+Yn>32768&&(_n=0),be){rn=Hn.sub(Jt)._perp()._unit();let to=hw(Tn,Jt,Hn,xg(Ot,rn),be);isNaN(to)&&(to=0);const ai=Jt.sub(Tn)._unit();Tn=Tn.add(ai.mult(Ht))._round(),Jt=Jt.add(ai.mult(-to))._round(),Ht=to,Ot=rn}const Gr=at.vertexLength,si=Qe.length>4&&Zv(Tn,Jt,Hn);let di=Wv(_n,In,an);if(_g(this.layoutVertexArray,Tn.x,Tn.y,er,yr,0,0,di),_g(this.layoutVertexArray,Tn.x,Tn.y,er,yr,0,1,di),_n+=Yn,di=Wv(_n,si,!an),In=si,_g(this.layoutVertexArray,Jt.x,Jt.y,er,yr,0,0,di),_g(this.layoutVertexArray,Jt.x,Jt.y,er,yr,0,1,di),at.vertexLength+=4,this.indexArray.emplaceBack(Gr+0,Gr+1,Gr+2),this.indexArray.emplaceBack(Gr+1,Gr+3,Gr+2),at.primitiveLength+=2,be){const to=qe+(1===ln?Qe.length-2:ln-2),ai=1===ln?qe:to+1;if(this.indexArray.emplaceBack(Gr+1,to,Gr+3),this.indexArray.emplaceBack(to,ai,Gr+3),at.primitiveLength+=2,void 0===Ut&&(Ut=Gr),!yy(Hn,Qe[ln],Ke)){const Ls=ln===Qe.length-1?Ut:at.vertexLength;this.indexArray.emplaceBack(Gr+2,Gr+3,Ls),this.indexArray.emplaceBack(Gr+3,Ls+1,Ls),this.indexArray.emplaceBack(Gr+3,ai,Ls+1),at.primitiveLength+=3}an=!an}if(z){const to=this.layoutVertexExtArray,ai=R.projectTilePoint(Tn.x,Tn.y,m),Ls=R.projectTilePoint(Jt.x,Jt.y,m),Mi=R.upVector(m,Tn.x,Tn.y),Ni=R.upVector(m,Jt.x,Jt.y);vg(to,ai,Mi),vg(to,ai,Mi),vg(to,Ls,Ni),vg(to,Ls,Ni)}}G&&(qe+=Qe.length-1)}}if(V&&V.polyCount.length>0){if(V.borders){V.vertexArrayOffset=this.centroidVertexArray.length;const Xe=V.borders,Ke=this.featuresOnBorder.push(V)-1;for(let qe=0;qe<4;qe++)Xe[qe][0]!==Number.MAX_VALUE&&this.borders[qe].push(Ke)}this.encodeCentroid(V.borders?void 0:V.centroid(),V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((a,f)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[f].borders[i][0])}encodeCentroid(i,a,f=!0){let m,w;if(i)if(0!==i.y){const M=a.span()._mult(this.tileToMeter);m=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(M.x/10)),w=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(M.y/10))}else m=Math.ceil(7*(i.x+450)),w=0;else m=0,w=+f;let S=f?this.centroidVertexArray.length:a.vertexArrayOffset;for(const M of a.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*M.edges+M.top);for(let P=0;P<M.top;P++)this.centroidVertexArray.emplace(S++,m,w);for(let P=0;P<2*M.edges;P++)this.centroidVertexArray.emplace(S++,0,w),this.centroidVertexArray.emplace(S++,m,w)}}}function xg(s,i){const a=s.add(i)._unit();return s.x*a.x+s.y*a.y}function uS(s,i,a,f){const m=i.sub(s)._perp()._unit(),w=a.sub(i)._perp()._unit();return hw(s,i,a,xg(m,w),f)}function hw(s,i,a,f,m){const w=Math.sqrt(1-f*f);return Math.min(s.dist(i)/3,i.dist(a)/3,m*w/f)}function yy(s,i,a){return s.x<a[0].x&&i.x<a[0].x||s.x>a[1].x&&i.x>a[1].x||s.y<a[0].y&&i.y<a[0].y||s.y>a[1].y&&i.y>a[1].y}function Zv(s,i,a){if(s.x<0||s.x>=jr||i.x<0||i.x>=jr||a.x<0||a.x>=jr)return!1;const f=a.sub(i),m=f.perp(),w=s.sub(i);return(f.x*w.x+f.y*w.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(w.x*w.x+w.y*w.y))>-.866&&m.x*w.x+m.y*w.y<0}function Wv(s,i,a){const f=i?2|s:-3&s;return a?1|f:-2&f}function Yv(){const s=Math.PI/32,i=Math.tan(s),a=Yh;return a*Math.sqrt(1+2*i*i)-a}function Kv(s,i,a){const f=1<<a.z,m=Zl(a.x/f),w=Zl((a.x+1)/f),S=La(a.y/f),M=La((a.y+1)/f);return function(P,R,z,V,G=0,Z){const W=[];if(!P.length||!z||!V)return W;const re=(Qe,Ut)=>{for(const Ot of Qe)W.push({polygon:Ot,bounds:Ut})},be=Math.ceil(Math.log2(z)),Xe=Math.ceil(Math.log2(V)),Ke=be-Xe,qe=[];for(let Qe=0;Qe<Math.abs(Ke);Qe++)qe.push(Ke>0?0:1);for(let Qe=0;Qe<Math.min(be,Xe);Qe++)qe.push(0),qe.push(1);let Je=P;if(Je=mp(Je,R[0].y-G,R[1].y+G,1),Je=mp(Je,R[0].x-G,R[1].x+G,0),!Je.length)return W;const at=[];for(qe.length?at.push({polygons:Je,bounds:R,depth:0}):re(Je,R);at.length;){const Qe=at.pop(),Ut=Qe.depth,Ot=qe[Ut],rn=Qe.bounds[0],In=Qe.bounds[1],Ht=0===Ot?rn.x:rn.y,an=0===Ot?In.x:In.y,ln=Z?Z(Ot,Ht,an):.5*(Ht+an),_n=mp(Qe.polygons,Ht-G,ln+G,Ot),Tn=mp(Qe.polygons,ln-G,an+G,Ot);if(_n.length){const Jt=[rn,new Q(0===Ot?ln:In.x,1===Ot?ln:In.y)];qe.length>Ut+1?at.push({polygons:_n,bounds:Jt,depth:Ut+1}):re(_n,Jt)}if(Tn.length){const Jt=[new Q(0===Ot?ln:rn.x,1===Ot?ln:rn.y),In];qe.length>Ut+1?at.push({polygons:Tn,bounds:Jt,depth:Ut+1}):re(Tn,Jt)}}return W}(s,i,Math.ceil((w-m)/11.25),Math.ceil((S-M)/11.25),1,(P,R,z)=>{if(0===P)return.5*(R+z);{const V=La((a.y+R/jr)/f);return(Dc(.5*(La((a.y+z/jr)/f)+V))*f-a.y)*jr}})}oe(jf,"FillExtrusionBucket",{omit:["layers","features"]}),oe(cw,"PartMetadata");const Jv=new Bn({"fill-extrusion-edge-radius":new Ft(zt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var wg={paint:new Bn({"fill-extrusion-opacity":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new bt(zt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Jn(zt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new bt(zt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new bt(zt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ft(zt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Jv};function Qv(s,i,a){var f=2*Math.PI*6378137/256/Math.pow(2,a);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Sd{constructor(i,a,f){this.z=i,this.x=a,this.y=f,this.key=yp(0,i,i,a,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const f=(S=this.y,M=this.z,P=Qv(256*(w=this.x),256*(S=Math.pow(2,M)-S-1),M),R=Qv(256*(w+1),256*(S+1),M),P[0]+","+P[1]+","+R[0]+","+R[1]),m=function(w,S,M){let P,R="";for(let z=w;z>0;z--)P=1<<z-1,R+=(S&P?1:0)+(M&P?2:0);return R}(this.z,this.x,this.y);var w,S,M,P,R;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class e0{constructor(i,a){this.wrap=i,this.canonical=a,this.key=yp(i,a.z,a.z,a.x,a.y)}}class es{constructor(i,a,f,m,w){this.overscaledZ=i,this.wrap=a,this.canonical=new Sd(f,+m,+w),this.key=0===a&&i===f?this.canonical.key:yp(a,i,f,m,w)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new es(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new es(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return yp(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-i;return yp(this.wrap*+a,i,i,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new es(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new es(a,this.wrap,a,f,m),new es(a,this.wrap,a,f+1,m),new es(a,this.wrap,a,f,m+1),new es(a,this.wrap,a,f+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new es(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new es(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new e0(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function yp(s,i,a,f,m){const w=1<<Math.min(a,22);let S=w*(m%w)+f%w;return s&&a<22&&(S+=w*w*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*S+a)+(i-a)}oe(Sd,"CanonicalTileID"),oe(es,"OverscaledTileID",{omit:["projMatrix"]});class Id extends Q{constructor(i,a,f){super(i,a),this.z=f}}function Td(s,i){return s.x*i.x+s.y*i.y}function _y(s,i){if(1===s.length){let a=0;const f=i[a++];let m;for(;!m||f.equals(m);)if(m=i[a++],!m)return 1/0;for(;a<i.length;a++){const w=i[a],S=s[0],M=m.sub(f),P=w.sub(f),R=S.sub(f),z=Td(M,M),V=Td(M,P),G=Td(P,P),Z=Td(R,M),W=Td(R,P),re=z*G-V*V,be=(G*Z-V*W)/re,Xe=(z*W-V*Z)/re,Ke=f.z*(1-be-Xe)+m.z*be+w.z*Xe;if(isFinite(Ke))return Ke}return 1/0}{let a=1/0;for(const f of i)a=Math.min(a,f.z);return a}}function t0(s,i,a,f,m,w,S,M){const P=S*m.getElevationAt(s,i,!0,!0),R=0!==w[0],z=R?0===w[1]?S*(w[0]/7-450):S*function(V,G,Z){const W=Math.floor(G[0]/8),re=Math.floor(G[1]/8),be=10*(G[0]-8*W),Xe=10*(G[1]-8*re),Ke=V.getElevationAt(W,re,!0,!0),qe=V.getMeterToDEM(Z),Je=Math.floor(.5*(be*qe-1)),at=Math.floor(.5*(Xe*qe-1)),Qe=V.tileCoordToPixel(W,re),Ut=2*Je+1,Ot=2*at+1,rn=(Fr=Ut,er=Ot,[(Tn=V).getElevationAtPixel(Jt=Qe.x-Je,Hn=Qe.y-at,!0),Tn.getElevationAtPixel(Jt+er,Hn,!0),Tn.getElevationAtPixel(Jt,Hn+er,!0),Tn.getElevationAtPixel(Jt+Fr,Hn+er,!0)]),In=Math.abs(rn[0]-rn[1]),Ht=Math.abs(rn[2]-rn[3]),an=Math.abs(rn[0]-rn[2])+Math.abs(rn[1]-rn[3]),ln=Math.min(.25,.5*qe*(In+Ht)/Ut),_n=Math.min(.25,.5*qe*an/Ot);var Tn,Jt,Hn,Fr,er;return Ke+Math.max(ln*be,_n*Xe)}(m,w,M):P;return{base:P+(0===a)?-1:a,top:R?Math.max(z+f,P+a+2):P+f}}const fw=Un([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:dw}=fw,pw=Un([{name:"a_packed",components:4,type:"Float32"}]),{members:n0}=pw,lS=tf.types,cS=Math.cos(Math.PI/180*37.5);class nf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new qo,this.layoutVertexArray2=new ja,this.indexArray=new Du,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new _a,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,f,m){this.hasPattern=pg("line",this.layers,a);const w=this.layers[0].layout.get("line-sort-key"),S=[];for(const{feature:z,id:V,index:G,sourceLayerIndex:Z}of i){const W=this.layers[0]._featureFilter.needGeometry,re=Kh(z,W);if(!this.layers[0]._featureFilter.filter(new Ze(this.zoom),re,f))continue;const be=w?w.evaluate(re,{},f):void 0,Xe={id:V,properties:z.properties,type:z.type,sourceLayerIndex:Z,index:G,geometry:W?re.geometry:wh(z,f,m),patterns:{},sortKey:be};S.push(Xe)}w&&S.sort((z,V)=>z.sortKey-V.sortKey);const{lineAtlas:M,featureIndex:P}=a,R=this.addConstantDashes(M);for(const z of S){const{geometry:V,index:G,sourceLayerIndex:Z}=z;if(R&&this.addFeatureDashes(z,M),this.hasPattern){const W=gg("line",this.layers,z,this.zoom,a);this.patternFeatures.push(W)}else this.addFeature(z,V,G,f,M.positions,a.availableImages);P.insert(i[G].feature,V,G,Z,this.index)}}addConstantDashes(i){let a=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,w=f.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==w.kind)a=!0;else{const S=w.value,M=m.value;if(!M)continue;i.addDash(M.from,S),i.addDash(M.to,S),M.other&&i.addDash(M.other,S)}}return a}addFeatureDashes(i,a){const f=this.zoom;for(const m of this.layers){const w=m.paint.get("line-dasharray").value,S=m.layout.get("line-cap").value;if("constant"===w.kind&&"constant"===S.kind)continue;let M,P,R,z,V,G;if("constant"===w.kind){const be=w.value;if(!be)continue;M=be.other||be.to,P=be.to,R=be.from}else M=w.evaluate({zoom:f-1},i),P=w.evaluate({zoom:f},i),R=w.evaluate({zoom:f+1},i);"constant"===S.kind?z=V=G=S.value:(z=S.evaluate({zoom:f-1},i),V=S.evaluate({zoom:f},i),G=S.evaluate({zoom:f+1},i)),a.addDash(M,z),a.addDash(P,V),a.addDash(R,G);const Z=a.getKey(M,z),W=a.getKey(P,V),re=a.getKey(R,G);i.patterns[m.id]={min:Z,mid:W,max:re}}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}addFeatures(i,a,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,n0)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,dw),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,f,m,w,S){const M=this.layers[0].layout,P=M.get("line-join").evaluate(i,{}),R=M.get("line-cap").evaluate(i,{}),z=M.get("line-miter-limit"),V=M.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const G of a)this.addLine(G,i,P,R,z,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}addLine(i,a,f,m,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Xe=0;Xe<i.length-1;Xe++)this.totalDistance+=i[Xe].dist(i[Xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const M="Polygon"===lS[a.type];let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let R=0;for(;R<P-1&&i[R].equals(i[R+1]);)R++;if(P<(M?3:2))return;"bevel"===f&&(w=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let G,Z,W,re,be;this.e1=this.e2=-1,M&&(G=i[P-2],be=i[R].sub(G)._unit()._perp());for(let Xe=R;Xe<P;Xe++){if(W=Xe===P-1?M?i[R+1]:void 0:i[Xe+1],W&&i[Xe].equals(W))continue;be&&(re=be),G&&(Z=G),G=i[Xe],be=W?W.sub(G)._unit()._perp():re,re=re||be;let Ke=re.add(be);0===Ke.x&&0===Ke.y||Ke._unit();const qe=re.x*be.x+re.y*be.y,Je=Ke.x*be.x+Ke.y*be.y,at=0!==Je?1/Je:1/0,Qe=2*Math.sqrt(2-2*Je),Ut=Je<cS&&Z&&W,Ot=re.x*be.y-re.y*be.x>0;if(Ut&&Xe>R){const Ht=G.dist(Z);if(Ht>2*z){const an=G.sub(G.sub(Z)._mult(z/Ht)._round());this.updateDistance(Z,an),this.addCurrentVertex(an,re,0,0,V),Z=an}}const rn=Z&&W;let In=rn?f:M?"butt":m;if(rn&&"round"===In&&(at<S?In="miter":at<=2&&(In="fakeround")),"miter"===In&&at>w&&(In="bevel"),"bevel"===In&&(at>2&&(In="flipbevel"),at<w&&(In="miter")),Z&&this.updateDistance(Z,G),"miter"===In)Ke._mult(at),this.addCurrentVertex(G,Ke,0,0,V);else if("flipbevel"===In){if(at>100)Ke=be.mult(-1);else{const Ht=at*re.add(be).mag()/re.sub(be).mag();Ke._perp()._mult(Ht*(Ot?-1:1))}this.addCurrentVertex(G,Ke,0,0,V),this.addCurrentVertex(G,Ke.mult(-1),0,0,V)}else if("bevel"===In||"fakeround"===In){const Ht=-Math.sqrt(at*at-1),an=Ot?Ht:0,ln=Ot?0:Ht;if(Z&&this.addCurrentVertex(G,re,an,ln,V),"fakeround"===In){const _n=Math.round(180*Qe/Math.PI/20);for(let Tn=1;Tn<_n;Tn++){let Jt=Tn/_n;if(.5!==Jt){const Fr=Jt-.5;Jt+=Jt*Fr*(Jt-1)*((1.0904+qe*(qe*(3.55645-1.43519*qe)-3.2452))*Fr*Fr+(.848013+qe*(.215638*qe-1.06021)))}const Hn=be.sub(re)._mult(Jt)._add(re)._unit()._mult(Ot?-1:1);this.addHalfVertex(G,Hn.x,Hn.y,!1,Ot,0,V)}}W&&this.addCurrentVertex(G,be,-an,-ln,V)}else if("butt"===In)this.addCurrentVertex(G,Ke,0,0,V);else if("square"===In){const Ht=Z?1:-1;Z||this.addCurrentVertex(G,Ke,Ht,Ht,V),this.addCurrentVertex(G,Ke,0,0,V),Z&&this.addCurrentVertex(G,Ke,Ht,Ht,V)}else"round"===In&&(Z&&(this.addCurrentVertex(G,re,0,0,V),this.addCurrentVertex(G,re,1,1,V,!0)),W&&(this.addCurrentVertex(G,be,-1,-1,V,!0),this.addCurrentVertex(G,be,0,0,V)));if(Ut&&Xe<P-1){const Ht=G.dist(W);if(Ht>2*z){const an=G.add(W.sub(G)._mult(z/Ht)._round());this.updateDistance(G,an),this.addCurrentVertex(an,be,0,0,V),G=an}}}}addCurrentVertex(i,a,f,m,w,S=!1){const M=a.y*m-a.x,P=-a.y-a.x*m;this.addHalfVertex(i,a.x+a.y*f,a.y-a.x*f,S,!1,f,w),this.addHalfVertex(i,M,P,S,!0,-m,w)}addHalfVertex({x:i,y:a},f,m,w,S,M,P){this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(a<<1)+(S?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(0===M?0:M<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const R=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,R),P.primitiveLength++),S?this.e2=R:this.e1=R}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,a){this.distance+=i.dist(a),this.updateScaledDistance()}}oe(nf,"LineBucket",{omit:["layers","patternFeatures"]});const bg=new Bn({"line-cap":new bt(zt.layout_line["line-cap"]),"line-join":new bt(zt.layout_line["line-join"]),"line-miter-limit":new Ft(zt.layout_line["line-miter-limit"]),"line-round-limit":new Ft(zt.layout_line["line-round-limit"]),"line-sort-key":new bt(zt.layout_line["line-sort-key"])});var vy={paint:new Bn({"line-opacity":new bt(zt.paint_line["line-opacity"]),"line-color":new bt(zt.paint_line["line-color"]),"line-translate":new Ft(zt.paint_line["line-translate"]),"line-translate-anchor":new Ft(zt.paint_line["line-translate-anchor"]),"line-width":new bt(zt.paint_line["line-width"]),"line-gap-width":new bt(zt.paint_line["line-gap-width"]),"line-offset":new bt(zt.paint_line["line-offset"]),"line-blur":new bt(zt.paint_line["line-blur"]),"line-dasharray":new Jn(zt.paint_line["line-dasharray"]),"line-pattern":new Jn(zt.paint_line["line-pattern"]),"line-gradient":new Vn(zt.paint_line["line-gradient"]),"line-trim-offset":new Ft(zt.paint_line["line-trim-offset"])}),layout:bg};const xy=new class extends bt{possiblyEvaluate(s,i){return i=new Ze(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,a,f){return i=Ee({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,a,f)}}(vy.paint.properties["line-width"].specification);function wy(s,i){return i>0?i+2*s:s}xy.useIntegerZoom=!0;const hS=Un([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),gw=Un([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),r0=Un([{name:"a_projected_pos",components:4,type:"Float32"}],4);Un([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const o0=Un([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),by=Un([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mw=Un([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ey=Un([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Un([{name:"triangle",components:3,type:"Uint16"}]),Un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Un([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Un([{type:"Float32",name:"offsetX"}]),Un([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const mc=128;function Eg(s,i){const{expression:a}=i;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Ze(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:m}=a;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let S=w;for(;S<f.length&&f[S]<s+1;)S++;S=Math.min(f.length-1,S);const M=f[w],P=f[S];return"composite"===a.kind?{kind:"composite",minZoom:M,maxZoom:P,interpolationType:m}:{kind:"camera",minZoom:M,maxZoom:P,minSize:a.evaluate(new Ze(M)),maxSize:a.evaluate(new Ze(P)),interpolationType:m}}}function _p(s,{uSize:i,uSizeT:a},{lowerSize:f,upperSize:m}){return"source"===s.kind?f/mc:"composite"===s.kind?Ii(f/mc,m/mc,a):i}function yc(s,i){let a=0,f=0;if("constant"===s.kind)f=s.layoutSize;else if("source"!==s.kind){const{interpolationType:m,minZoom:w,maxZoom:S}=s,M=m?ue(Et.interpolationFactor(m,i,w,S),0,1):0;"camera"===s.kind?f=Ii(s.minSize,s.maxSize,M):a=M}return{uSizeT:a,uSize:f}}var yw=Object.freeze({__proto__:null,getSizeData:Eg,evaluateSizeForFeature:_p,evaluateSizeForZoom:yc,SIZE_PACK_FACTOR:mc});function Cy(s,i,a){return s.sections.forEach(f=>{f.text=function(m,w,S){const M=w.layout.get("text-transform").evaluate(S,{});return"uppercase"===M?m=m.toLocaleUpperCase():"lowercase"===M&&(m=m.toLocaleLowerCase()),rt.applyArabicShaping&&(m=rt.applyArabicShaping(m)),m}(f.text,i,a)}),s}const rf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function _w(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Sy(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var sf=hs,th=function(s,i,a,f,m){var w,S,M=8*m-f-1,P=(1<<M)-1,R=P>>1,z=-7,V=a?m-1:0,G=a?-1:1,Z=s[i+V];for(V+=G,w=Z&(1<<-z)-1,Z>>=-z,z+=M;z>0;w=256*w+s[i+V],V+=G,z-=8);for(S=w&(1<<-z)-1,w>>=-z,z+=f;z>0;S=256*S+s[i+V],V+=G,z-=8);if(0===w)w=1-R;else{if(w===P)return S?NaN:1/0*(Z?-1:1);S+=Math.pow(2,f),w-=R}return(Z?-1:1)*S*Math.pow(2,w-f)},Iy=function(s,i,a,f,m,w){var S,M,P,R=8*w-m-1,z=(1<<R)-1,V=z>>1,G=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,Z=f?0:w-1,W=f?1:-1,re=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(M=isNaN(i)?1:0,S=z):(S=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-S))<1&&(S--,P*=2),(i+=S+V>=1?G/P:G*Math.pow(2,1-V))*P>=2&&(S++,P/=2),S+V>=z?(M=0,S=z):S+V>=1?(M=(i*P-1)*Math.pow(2,m),S+=V):(M=i*Math.pow(2,V-1)*Math.pow(2,m),S=0));m>=8;s[a+Z]=255&M,Z+=W,M/=256,m-=8);for(S=S<<m|M,R+=m;R>0;s[a+Z]=255&S,Z+=W,S/=256,R-=8);s[a+Z-W]|=128*re};function hs(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}hs.Varint=0,hs.Fixed64=1,hs.Bytes=2,hs.Fixed32=5;var Ty=4294967296,s0=1/Ty,My=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Tl(s){return s.type===hs.Bytes?s.readVarint()+s.pos:s.pos+1}function a0(s,i,a){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(f);for(var m=a.pos-1;m>=s;m--)a.buf[m+f]=a.buf[m]}function vw(s,i){for(var a=0;a<s.length;a++)i.writeVarint(s[a])}function Dy(s,i){for(var a=0;a<s.length;a++)i.writeSVarint(s[a])}function xw(s,i){for(var a=0;a<s.length;a++)i.writeFloat(s[a])}function u0(s,i){for(var a=0;a<s.length;a++)i.writeDouble(s[a])}function ww(s,i){for(var a=0;a<s.length;a++)i.writeBoolean(s[a])}function l0(s,i){for(var a=0;a<s.length;a++)i.writeFixed32(s[a])}function fS(s,i){for(var a=0;a<s.length;a++)i.writeSFixed32(s[a])}function bw(s,i){for(var a=0;a<s.length;a++)i.writeFixed64(s[a])}function vp(s,i){for(var a=0;a<s.length;a++)i.writeSFixed64(s[a])}function Cg(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Rc(s,i,a){s[a]=i,s[a+1]=i>>>8,s[a+2]=i>>>16,s[a+3]=i>>>24}function Sh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}function Ew(s,i,a){i.glyphs=[],1===s&&a.readMessage(c0,i)}function c0(s,i,a){if(3===s){const{id:f,bitmap:m,width:w,height:S,left:M,top:P,advance:R}=a.readMessage(Sg,{});i.glyphs.push({id:f,bitmap:new dl({width:w+6,height:S+6},m),metrics:{width:w,height:S,left:M,top:P,advance:R}})}else 4===s?i.ascender=a.readSVarint():5===s&&(i.descender=a.readSVarint())}function Sg(s,i,a){1===s?i.id=a.readVarint():2===s?i.bitmap=a.readBytes():3===s?i.width=a.readVarint():4===s?i.height=a.readVarint():5===s?i.left=a.readSVarint():6===s?i.top=a.readSVarint():7===s&&(i.advance=a.readVarint())}function Ay(s){let i=0,a=0;for(const S of s)i+=S.w*S.h,a=Math.max(a,S.w);s.sort((S,M)=>M.h-S.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let m=0,w=0;for(const S of s)for(let M=f.length-1;M>=0;M--){const P=f[M];if(!(S.w>P.w||S.h>P.h)){if(S.x=P.x,S.y=P.y,w=Math.max(w,S.y+S.h),m=Math.max(m,S.x+S.w),S.w===P.w&&S.h===P.h){const R=f.pop();M<f.length&&(f[M]=R)}else S.h===P.h?(P.x+=S.w,P.w-=S.w):S.w===P.w?(P.y+=S.h,P.h-=S.h):(f.push({x:P.x+S.w,y:P.y,w:P.w-S.w,h:S.h}),P.y+=S.h,P.h-=S.h);break}}return{w:m,h:w,fill:i/(m*w)||0}}hs.prototype={destroy:function(){this.buf=null},readFields:function(s,i,a){for(a=a||this.length;this.pos<a;){var f=this.readVarint(),m=f>>3,w=this.pos;this.type=7&f,s(m,i,this),this.pos===w&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Cg(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=Sh(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Cg(this.buf,this.pos)+Cg(this.buf,this.pos+4)*Ty;return this.pos+=8,s},readSFixed64:function(){var s=Cg(this.buf,this.pos)+Sh(this.buf,this.pos+4)*Ty;return this.pos+=8,s},readFloat:function(){var s=th(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=th(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,a,f=this.buf;return i=127&(a=f[this.pos++]),a<128?i:(i|=(127&(a=f[this.pos++]))<<7,a<128?i:(i|=(127&(a=f[this.pos++]))<<14,a<128?i:(i|=(127&(a=f[this.pos++]))<<21,a<128?i:function(m,w,S){var M,P,R=S.buf;if(M=(112&(P=R[S.pos++]))>>4,P<128||(M|=(127&(P=R[S.pos++]))<<3,P<128)||(M|=(127&(P=R[S.pos++]))<<10,P<128)||(M|=(127&(P=R[S.pos++]))<<17,P<128)||(M|=(127&(P=R[S.pos++]))<<24,P<128)||(M|=(1&(P=R[S.pos++]))<<31,P<128))return function Md(s,i,a){return a?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(m,M,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(a=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&My?My.decode(this.buf.subarray(i,s)):function(a,f,m){for(var w="",S=f;S<m;){var M,P,R,z=a[S],V=null,G=z>239?4:z>223?3:z>191?2:1;if(S+G>m)break;1===G?z<128&&(V=z):2===G?128==(192&(M=a[S+1]))&&(V=(31&z)<<6|63&M)<=127&&(V=null):3===G?(P=a[S+2],128==(192&(M=a[S+1]))&&128==(192&P)&&((V=(15&z)<<12|(63&M)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):4===G&&(P=a[S+2],R=a[S+3],128==(192&(M=a[S+1]))&&128==(192&P)&&128==(192&R)&&((V=(15&z)<<18|(63&M)<<12|(63&P)<<6|63&R)<=65535||V>=1114112)&&(V=null)),null===V?(V=65533,G=1):V>65535&&(V-=65536,w+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),w+=String.fromCharCode(V),S+=G}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==hs.Bytes)return s.push(this.readVarint(i));var a=Tl(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==hs.Bytes)return s.push(this.readSVarint());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==hs.Bytes)return s.push(this.readBoolean());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==hs.Bytes)return s.push(this.readFloat());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==hs.Bytes)return s.push(this.readDouble());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==hs.Bytes)return s.push(this.readFixed32());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==hs.Bytes)return s.push(this.readSFixed32());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==hs.Bytes)return s.push(this.readFixed64());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==hs.Bytes)return s.push(this.readSFixed64());var i=Tl(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===hs.Varint)for(;this.buf[this.pos++]>127;);else if(i===hs.Bytes)this.pos=this.readVarint()+this.pos;else if(i===hs.Fixed32)this.pos+=4;else{if(i!==hs.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Rc(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Rc(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Rc(this.buf,-1&s,this.pos),Rc(this.buf,Math.floor(s*s0),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Rc(this.buf,-1&s,this.pos),Rc(this.buf,Math.floor(s*s0),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,a){var f,m,w,M;if(i>=0?(f=i%4294967296|0,m=i/4294967296|0):(m=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,m=m+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),w=f,(M=a).buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,w>>>=7,M.buf[M.pos++]=127&w|128,M.buf[M.pos]=127&(w>>>=7),function(w,S){var M=(7&w)<<4;S.buf[S.pos++]|=M|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))}(m,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,m,w){for(var S,M,P=0;P<m.length;P++){if((S=m.charCodeAt(P))>55295&&S<57344){if(!M){S>56319||P+1===m.length?(f[w++]=239,f[w++]=191,f[w++]=189):M=S;continue}if(S<56320){f[w++]=239,f[w++]=191,f[w++]=189,M=S;continue}S=M-55296<<10|S-56320|65536,M=null}else M&&(f[w++]=239,f[w++]=191,f[w++]=189,M=null);S<128?f[w++]=S:(S<2048?f[w++]=S>>6|192:(S<65536?f[w++]=S>>12|224:(f[w++]=S>>18|240,f[w++]=S>>12&63|128),f[w++]=S>>6&63|128),f[w++]=63&S|128)}return w}(this.buf,s,this.pos);var a=this.pos-i;a>=128&&a0(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),Iy(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Iy(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,i){this.pos++;var a=this.pos;s(i,this);var f=this.pos-a;f>=128&&a0(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,a){this.writeTag(s,hs.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,vw,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Dy,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,ww,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,xw,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,u0,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,l0,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,fS,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,bw,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,vp,i)},writeBytesField:function(s,i){this.writeTag(s,hs.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,hs.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,hs.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,hs.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,hs.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,hs.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,hs.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,hs.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,hs.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,hs.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,Boolean(i))}};class Py{constructor(i,{pixelRatio:a,version:f,stretchX:m,stretchY:w,content:S}){this.paddedRect=i,this.pixelRatio=a,this.stretchX=m,this.stretchY=w,this.content=S,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class xp{constructor(i,a){const f={},m={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,f,w),this.addImages(a,m,w);const{w:S,h:M}=Ay(w),P=new pl({width:S||1,height:M||1});for(const R in i){const z=i[R],V=f[R].paddedRect;pl.copy(z.data,P,{x:0,y:0},{x:V.x+1,y:V.y+1},z.data)}for(const R in a){const z=a[R],V=m[R].paddedRect,G=V.x+1,Z=V.y+1,W=z.data.width,re=z.data.height;pl.copy(z.data,P,{x:0,y:0},{x:G,y:Z},z.data),pl.copy(z.data,P,{x:0,y:re-1},{x:G,y:Z-1},{width:W,height:1}),pl.copy(z.data,P,{x:0,y:0},{x:G,y:Z+re},{width:W,height:1}),pl.copy(z.data,P,{x:W-1,y:0},{x:G-1,y:Z},{width:1,height:re}),pl.copy(z.data,P,{x:0,y:0},{x:G+W,y:Z},{width:1,height:re})}this.image=P,this.iconPositions=f,this.patternPositions=m}addImages(i,a,f){for(const m in i){const w=i[m],S={x:0,y:0,w:w.data.width+2,h:w.data.height+2};f.push(S),a[m]=new Py(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),a),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),a)}patchUpdatedImage(i,a,f){if(!i||!a||i.version===a.version)return;i.version=a.version;const[m,w]=i.tl;f.update(a.data,void 0,{x:m,y:w})}}oe(Py,"ImagePosition"),oe(xp,"ImageAtlas");const Yl={horizontal:1,vertical:2,horizontalOnly:3};class Vf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,a){const f=new Vf;return f.scale=i||1,f.fontStack=a,f}static forImage(i){const a=new Vf;return a.imageName=i,a}}class af{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const f=new af;for(let m=0;m<i.sections.length;m++){const w=i.sections[m];w.image?f.addImageSection(w):f.addTextSection(w,a)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(a,f){let m="";for(let w=0;w<a.length;w++){const S=a.charCodeAt(w+1)||null,M=a.charCodeAt(w-1)||null;m+=!f&&(S&&O(S)&&!rf[a[w+1]]||M&&O(M)&&!rf[a[w-1]])||!rf[a[w]]?a[w]:rf[a[w]]}return m}(this.text,i)}trim(){let i=0;for(let f=0;f<this.text.length&&Dd[this.text.charCodeAt(f)];f++)i++;let a=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Dd[this.text.charCodeAt(f)];f--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const f=new af;return f.text=this.text.substring(i,a),f.sectionIndex=this.sectionIndex.slice(i,a),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Vf.forText(i.scale,i.fontStack||a));const f=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(f)}addImageSection(i){const a=i.image?i.image.name:"";if(0===a.length)return void zn("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Vf.forImage(a)),this.sectionIndex.push(this.sections.length-1)):zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ly(s,i,a,f,m,w,S,M,P,R,z,V,G,Z,W){const re=af.fromFeature(s,m);V===Yl.vertical&&re.verticalizePunctuation(G);let be=[];const Xe=function(Qe,Ut,Ot,rn,In,Ht){if(!Qe)return[];const an=[],ln=function(Hn,Fr,er,yr,Yn,Gr){let si=0;for(let di=0;di<Hn.length();di++){const to=Hn.getSection(di);si+=h0(Hn.getCharCode(di),to,yr,Yn,Fr,Gr)}return si/Math.max(1,Math.ceil(si/er))}(Qe,Ut,Ot,rn,In,Ht),_n=Qe.text.indexOf("\u200b")>=0;let Tn=0;for(let Hn=0;Hn<Qe.length();Hn++){const Fr=Qe.getSection(Hn),er=Qe.getCharCode(Hn);if(Dd[er]||(Tn+=h0(er,Fr,rn,In,Ut,Ht)),Hn<Qe.length()-1){const yr=!((Jt=er)<11904||!(Mf(Jt)||Kd(Jt)||Xh(Jt)||cd(Jt)||yh(Jt)||bs(Jt)||Mu(Jt)||_u(Jt)||hc(Jt)||Jd(Jt)||ld(Jt)||l(Jt)||lc(Jt)||ra(Jt)||Ws(Jt)||cc(Jt)||Tf(Jt)||Qd(Jt)||qp(Jt)||Df(Jt)));(Ad[er]||yr||Fr.imageName)&&an.push(d0(Hn+1,Tn,ln,an,Cw(er,Qe.getCharCode(Hn+1),yr&&_n),!1))}}var Jt;return Ry(d0(Qe.length(),Tn,ln,an,0,!0))}(re,R,w,i,f,Z),{processBidirectionalText:Ke,processStyledBidirectionalText:qe}=rt;if(Ke&&1===re.sections.length){const Qe=Ke(re.toString(),Xe);for(const Ut of Qe){const Ot=new af;Ot.text=Ut,Ot.sections=re.sections;for(let rn=0;rn<Ut.length;rn++)Ot.sectionIndex.push(0);be.push(Ot)}}else if(qe){const Qe=qe(re.text,re.sectionIndex,Xe);for(const Ut of Qe){const Ot=new af;Ot.text=Ut[0],Ot.sectionIndex=Ut[1],Ot.sections=re.sections,be.push(Ot)}}else be=function(Qe,Ut){const Ot=[],rn=Qe.text;let In=0;for(const Ht of Ut)Ot.push(Qe.substring(In,Ht)),In=Ht;return In<rn.length&&Ot.push(Qe.substring(In,rn.length)),Ot}(re,Xe);const Je=[],at={positionedLines:Je,text:re.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Qe,Ut,Ot,rn,In,Ht,an,ln,_n,Tn,Jt,Hn){let Fr=0,er=0,yr=0;const Yn="right"===ln?1:"left"===ln?0:.5;let Gr=!1;for(const Mi of In){const Ni=Mi.getSections();for(const co of Ni){if(co.imageName)continue;const ys=Ut[co.fontStack];if(ys&&(Gr=void 0!==ys.ascender&&void 0!==ys.descender,!Gr))break}if(!Gr)break}let si=0;for(const Mi of In){Mi.trim();const Ni=Mi.getMaxScale(),co=24*(Ni-1),ys={positionedGlyphs:[],lineOffset:0};Qe.positionedLines[si]=ys;const Es=ys.positionedGlyphs;let ni=0;if(!Mi.length()){er+=Ht,++si;continue}let ri=0,Ho=0;for(let Xo=0;Xo<Mi.length();Xo++){const xa=Mi.getSection(Xo),wa=Mi.getSectionIndex(Xo),io=Mi.getCharCode(Xo);let Rs=xa.scale,Ga=null,ss=null,ho=null,Lu=24,xu=0;const lu=!(_n===Yl.horizontal||!Jt&&!A(io)||Jt&&(Dd[io]||(di=io,ur(di)||Cr(di)||ti(di)||Af(di)||v(di))));if(xa.imageName){const Vu=rn[xa.imageName];if(!Vu)continue;ho=xa.imageName,Qe.iconsInText=Qe.iconsInText||!0,ss=Vu.paddedRect;const cu=Vu.displaySize;Rs=24*Rs/Hn,Ga={width:cu[0],height:cu[1],left:1,top:-3,advance:lu?cu[1]:cu[0],localGlyph:!1},xu=Gr?-Ga.height*Rs:24*Ni-17-cu[1]*Rs,Lu=Ga.advance;const Ah=(lu?cu[0]:cu[1])*Rs-24*Ni;Ah>0&&Ah>ni&&(ni=Ah)}else{const Vu=Ot[xa.fontStack];if(!Vu)continue;Vu[io]&&(ss=Vu[io]);const cu=Ut[xa.fontStack];if(!cu)continue;const Ah=cu.glyphs[io];if(!Ah)continue;if(Ga=Ah.metrics,Lu=8203!==io?24:0,Gr){const Ud=void 0!==cu.ascender?Math.abs(cu.ascender):0,Ap=void 0!==cu.descender?Math.abs(cu.descender):0,Pp=(Ud+Ap)*Rs;ri<Pp&&(ri=Pp,Ho=(Ud-Ap)/2*Rs),xu=-Ud*Rs}else xu=24*(Ni-Rs)-17}lu?(Qe.verticalizable=!0,Es.push({glyph:io,imageName:ho,x:Fr,y:er+xu,vertical:lu,scale:Rs,localGlyph:Ga.localGlyph,fontStack:xa.fontStack,sectionIndex:wa,metrics:Ga,rect:ss}),Fr+=Lu*Rs+Tn):(Es.push({glyph:io,imageName:ho,x:Fr,y:er+xu,vertical:lu,scale:Rs,localGlyph:Ga.localGlyph,fontStack:xa.fontStack,sectionIndex:wa,metrics:Ga,rect:ss}),Fr+=Ga.advance*Rs+Tn)}0!==Es.length&&(yr=Math.max(Fr-Tn,yr),Gr?p0(Es,Yn,ni,Ho,Ht*Ni/2):p0(Es,Yn,ni,0,Ht/2)),Fr=0;const vu=Ht*Ni+ni;ys.lineOffset=Math.max(ni,co),er+=vu,++si}var di;const to=er,{horizontalAlign:ai,verticalAlign:Ls}=Oy(an);(function(Mi,Ni,co,ys,Es,ni){const ri=(Ni-co)*Es,Ho=-ni*ys;for(const vu of Mi)for(const Xo of vu.positionedGlyphs)Xo.x+=ri,Xo.y+=Ho})(Qe.positionedLines,Yn,ai,Ls,yr,to),Qe.top+=-Ls*to,Qe.bottom=Qe.top+to,Qe.left+=-ai*yr,Qe.right=Qe.left+yr,Qe.hasBaseline=Gr}(at,i,a,f,be,S,M,P,V,R,G,W),!function(Qe){for(const Ut of Qe)if(0!==Ut.positionedGlyphs.length)return!1;return!0}(Je)&&at}const Dd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ad={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function h0(s,i,a,f,m,w){if(i.imageName){const S=f[i.imageName];return S?S.displaySize[0]*i.scale*24/w+m:0}{const S=a[i.fontStack],M=S&&S.glyphs[s];return M?M.metrics.advance*i.scale+m:0}}function f0(s,i,a,f){const m=Math.pow(s-i,2);return f?s<i?m/2:2*m:m+Math.abs(a)*a}function Cw(s,i,a){let f=0;return 10===s&&(f-=1e4),a&&(f+=150),40!==s&&65288!==s||(f+=50),41!==i&&65289!==i||(f+=50),f}function d0(s,i,a,f,m,w){let S=null,M=f0(i,a,m,w);for(const P of f){const R=f0(i-P.x,a,m,w)+P.badness;R<=M&&(S=P,M=R)}return{index:s,x:i,priorBreak:S,badness:M}}function Ry(s){return s?Ry(s.priorBreak).concat(s.index):[]}function Oy(s){let i=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function p0(s,i,a,f,m){if(!(i||a||f||m))return;const w=s.length-1,S=s[w],M=(S.x+S.metrics.advance*S.scale)*i;for(let P=0;P<=w;P++)s[P].x-=M,s[P].y+=a+f+m}function Pd(s,i,a){const{horizontalAlign:f,verticalAlign:m}=Oy(a),w=i[0]-s.displaySize[0]*f,S=i[1]-s.displaySize[1]*m;return{image:s,top:S,bottom:S+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function nh(s,i,a,f,m,w){const S=s.image;let M;if(S.content){const be=S.content,Xe=S.pixelRatio||1;M=[be[0]/Xe,be[1]/Xe,S.displaySize[0]-be[2]/Xe,S.displaySize[1]-be[3]/Xe]}const P=i.left*w,R=i.right*w;let z,V,G,Z;"width"===a||"both"===a?(Z=m[0]+P-f[3],V=m[0]+R+f[1]):(Z=m[0]+(P+R-S.displaySize[0])/2,V=Z+S.displaySize[0]);const W=i.top*w,re=i.bottom*w;return"height"===a||"both"===a?(z=m[1]+W-f[0],G=m[1]+re+f[2]):(z=m[1]+(W+re-S.displaySize[1])/2,G=z+S.displaySize[1]),{image:S,top:z,right:V,bottom:G,left:Z,collisionPadding:M}}class Ih extends Q{constructor(i,a,f,m,w){super(i,a),this.angle=m,this.z=f,void 0!==w&&(this.segment=w)}clone(){return new Ih(this.x,this.y,this.z,this.angle,this.segment)}}function g0(s,i,a,f,m){if(void 0===i.segment)return!0;let w=i,S=i.segment+1,M=0;for(;M>-a/2;){if(S--,S<0)return!1;M-=s[S].dist(w),w=s[S]}M+=s[S].dist(s[S+1]),S++;const P=[];let R=0;for(;M<a/2;){const z=s[S],V=s[S+1];if(!V)return!1;let G=s[S-1].angleTo(z)-z.angleTo(V);for(G=Math.abs((G+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:M,angleDelta:G}),R+=G;M-P[0].distance>f;)R-=P.shift().angleDelta;if(R>m)return!1;S++,M+=z.dist(V)}return!0}function Sw(s){let i=0;for(let a=0;a<s.length-1;a++)i+=s[a].dist(s[a+1]);return i}function Iw(s,i,a){return s?.6*i*a:0}function Ny(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function dS(s,i,a,f,m,w){const S=Iw(a,m,w),M=Ny(a,f)*w;let P=0;const R=Sw(s)/2;for(let z=0;z<s.length-1;z++){const V=s[z],G=s[z+1],Z=V.dist(G);if(P+Z>R){const W=(R-P)/Z,re=Ii(V.x,G.x,W),be=Ii(V.y,G.y,W),Xe=new Ih(re,be,0,G.angleTo(V),z);return!S||g0(s,Xe,M,S,i)?Xe:void 0}P+=Z}}function m0(s,i,a,f,m,w,S,M,P){const R=Iw(f,w,S),z=Ny(f,m),V=z*S,G=0===s[0].x||s[0].x===P||0===s[0].y||s[0].y===P;return i-V<i/4&&(i=V+i/4),ky(s,G?i/2*M%i:(z/2+2*w)*S*M%i,i,R,a,V,G,!1,P)}function ky(s,i,a,f,m,w,S,M,P){const R=w/2,z=Sw(s);let V=0,G=i-a,Z=[];for(let W=0;W<s.length-1;W++){const re=s[W],be=s[W+1],Xe=re.dist(be),Ke=be.angleTo(re);for(;G+a<V+Xe;){G+=a;const qe=(G-V)/Xe,Je=Ii(re.x,be.x,qe),at=Ii(re.y,be.y,qe);if(Je>=0&&Je<P&&at>=0&&at<P&&G-R>=0&&G+R<=z){const Qe=new Ih(Je,at,0,Ke,W);Qe._round(),f&&!g0(s,Qe,w,f,m)||Z.push(Qe)}}V+=Xe}return M||Z.length||S||(Z=ky(s,V/2,a,f,m,w,S,!0,P)),Z}function y0(s,i,a,f,m){const w=[];for(let S=0;S<s.length;S++){const M=s[S];let P;for(let R=0;R<M.length-1;R++){let z=M[R],V=M[R+1];z.x<i&&V.x<i||(z.x<i?z=new Q(i,z.y+(i-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x<i&&(V=new Q(i,z.y+(i-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y<a&&V.y<a||(z.y<a?z=new Q(z.x+(a-z.y)/(V.y-z.y)*(V.x-z.x),a)._round():V.y<a&&(V=new Q(z.x+(a-z.y)/(V.y-z.y)*(V.x-z.x),a)._round()),z.x>=f&&V.x>=f||(z.x>=f?z=new Q(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round():V.x>=f&&(V=new Q(f,z.y+(f-z.x)/(V.x-z.x)*(V.y-z.y))._round()),z.y>=m&&V.y>=m||(z.y>=m?z=new Q(z.x+(m-z.y)/(V.y-z.y)*(V.x-z.x),m)._round():V.y>=m&&(V=new Q(z.x+(m-z.y)/(V.y-z.y)*(V.x-z.x),m)._round()),P&&z.equals(P[P.length-1])||(P=[z],w.push(P)),P.push(V)))))}}return w}oe(Ih,"Anchor");const Ld=1e20;function _0(s,i,a,f,m,w,S,M,P){for(let R=i;R<i+f;R++)v0(s,a*w+R,w,m,S,M,P);for(let R=a;R<a+m;R++)v0(s,R*w+i,1,f,S,M,P)}function v0(s,i,a,f,m,w,S){w[0]=0,S[0]=-Ld,S[1]=Ld,m[0]=s[i];for(let M=1,P=0,R=0;M<f;M++){m[M]=s[i+M*a];const z=M*M;do{const V=w[P];R=(m[M]-m[V]+z-V*V)/(M-V)/2}while(R<=S[P]&&--P>-1);P++,w[P]=M,S[P]=R,S[P+1]=Ld}for(let M=0,P=0;M<f;M++){for(;S[P+1]<M;)P++;const R=w[P],z=M-R;s[i+M*a]=m[R]+z*z}}const Kl={none:0,ideographs:1,all:2};class Rd{constructor(i,a,f){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const f=[];for(const m in i)for(const w of i[m])f.push({stack:m,id:w});Ne(f,({stack:m,id:w},S)=>{let M=this.entries[m];M||(M=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=M.glyphs[w];if(void 0!==P)return void S(null,{stack:m,id:w,glyph:P});if(P=this._tinySDF(M,m,w),P)return M.glyphs[w]=P,void S(null,{stack:m,id:w,glyph:P});const R=Math.floor(w/256);if(256*R>65535)return void S(new Error("glyphs > 65535 not supported"));if(M.ranges[R])return void S(null,{stack:m,id:w,glyph:P});let z=M.requests[R];z||(z=M.requests[R]=[],Rd.loadGlyphRange(m,R,this.url,this.requestManager,(V,G)=>{if(G){M.ascender=G.ascender,M.descender=G.descender;for(const Z in G.glyphs)this._doesCharSupportLocalGlyph(+Z)||(M.glyphs[+Z]=G.glyphs[+Z]);M.ranges[R]=!0}for(const Z of z)Z(V,G);delete M.requests[R]})),z.push((V,G)=>{V?S(V):G&&S(null,{stack:m,id:w,glyph:G.glyphs[w]||null})})},(m,w)=>{if(m)a(m);else if(w){const S={};for(const{stack:M,id:P,glyph:R}of w)void 0===S[M]&&(S[M]={}),void 0===S[M].glyphs&&(S[M].glyphs={}),S[M].glyphs[P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics},S[M].ascender=this.entries[M].ascender,S[M].descender=this.entries[M].descender;a(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Kl.none&&(this.localGlyphMode===Kl.all?!!this.localFontFamily:!!this.localFontFamily&&(Jd(i)||Hp(i)||lc(i)||Tf(i)||_u(i)))}_tinySDF(i,a,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let w=i.tinySDF;if(!w){let re="400";/bold/i.test(a)?re="900":/medium/i.test(a)?re="500":/light/i.test(a)&&(re="200"),w=i.tinySDF=new Rd.TinySDF({fontFamily:m,fontWeight:re,fontSize:48,buffer:6,radius:16}),w.fontWeight=re}if(this.localGlyphs[w.fontWeight][f])return this.localGlyphs[w.fontWeight][f];const S=String.fromCharCode(f),{data:M,width:P,height:R,glyphWidth:z,glyphHeight:V,glyphLeft:G,glyphTop:Z,glyphAdvance:W}=w.draw(S);return this.localGlyphs[w.fontWeight][f]={id:f,bitmap:new dl({width:P,height:R},M),metrics:{width:z/2,height:V/2,left:G/2,top:Z/2-27,advance:W/2,localGlyph:!0}}}}function Fy(s,i,a,f){const m=[],w=s.image,S=w.pixelRatio,M=w.paddedRect.w-2,P=w.paddedRect.h-2,R=s.right-s.left,z=s.bottom-s.top,V=w.stretchX||[[0,M]],G=w.stretchY||[[0,P]],Z=(Ht,an)=>Ht+an[1]-an[0],W=V.reduce(Z,0),re=G.reduce(Z,0),be=M-W,Xe=P-re;let Ke=0,qe=W,Je=0,at=re,Qe=0,Ut=be,Ot=0,rn=Xe;if(w.content&&f){const Ht=w.content;Ke=Ig(V,0,Ht[0]),Je=Ig(G,0,Ht[1]),qe=Ig(V,Ht[0],Ht[2]),at=Ig(G,Ht[1],Ht[3]),Qe=Ht[0]-Ke,Ot=Ht[1]-Je,Ut=Ht[2]-Ht[0]-qe,rn=Ht[3]-Ht[1]-at}const In=(Ht,an,ln,_n)=>{const Tn=Tg(Ht.stretch-Ke,qe,R,s.left),Jt=Mg(Ht.fixed-Qe,Ut,Ht.stretch,W),Hn=Tg(an.stretch-Je,at,z,s.top),Fr=Mg(an.fixed-Ot,rn,an.stretch,re),er=Tg(ln.stretch-Ke,qe,R,s.left),yr=Mg(ln.fixed-Qe,Ut,ln.stretch,W),Yn=Tg(_n.stretch-Je,at,z,s.top),Gr=Mg(_n.fixed-Ot,rn,_n.stretch,re),si=new Q(Tn,Hn),di=new Q(er,Hn),to=new Q(er,Yn),ai=new Q(Tn,Yn),Ls=new Q(Jt/S,Fr/S),Mi=new Q(yr/S,Gr/S),Ni=i*Math.PI/180;if(Ni){const Es=Math.sin(Ni),ni=Math.cos(Ni),ri=[ni,-Es,Es,ni];si._matMult(ri),di._matMult(ri),ai._matMult(ri),to._matMult(ri)}const co=Ht.stretch+Ht.fixed,ys=an.stretch+an.fixed;return{tl:si,tr:di,bl:ai,br:to,tex:{x:w.paddedRect.x+1+co,y:w.paddedRect.y+1+ys,w:ln.stretch+ln.fixed-co,h:_n.stretch+_n.fixed-ys},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ls,pixelOffsetBR:Mi,minFontScaleX:Ut/S/R,minFontScaleY:rn/S/z,isSDF:a}};if(f&&(w.stretchX||w.stretchY)){const Ht=x0(V,be,W),an=x0(G,Xe,re);for(let ln=0;ln<Ht.length-1;ln++){const _n=Ht[ln],Tn=Ht[ln+1];for(let Jt=0;Jt<an.length-1;Jt++)m.push(In(_n,an[Jt],Tn,an[Jt+1]))}}else m.push(In({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:M+1},{fixed:0,stretch:P+1}));return m}function Ig(s,i,a){let f=0;for(const m of s)f+=Math.max(i,Math.min(a,m[1]))-Math.max(i,Math.min(a,m[0]));return f}function x0(s,i,a){const f=[{fixed:-1,stretch:0}];for(const[m,w]of s){const S=f[f.length-1];f.push({fixed:m-S.stretch,stretch:S.stretch}),f.push({fixed:m-S.stretch,stretch:S.stretch+(w-m)})}return f.push({fixed:i+1,stretch:a}),f}function Tg(s,i,a,f){return s/i*a+f}function Mg(s,i,a,f){return s-i*a/f}function w0(s,i,a,f){const m=i+s.positionedLines[f].lineOffset;return 0===f?a+m/2:a+(m+(i+s.positionedLines[f-1].lineOffset))/2}Rd.loadGlyphRange=function(s,i,a,f,m){const w=256*i,S=w+255,M=f.transformRequest(f.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${w}-${S}`),lr.Glyphs);vi(M,(P,R)=>{if(P)m(P);else if(R){const z={},V=new sf(R).readFields(Ew,{});for(const G of V.glyphs)z[G.id]=G;m(null,{glyphs:z,ascender:V.ascender,descender:V.descender})}})},Rd.TinySDF=class{constructor({fontSize:s=24,buffer:i=3,radius:a=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:w="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=a;const M=this.size=s+4*i,P=this._createCanvas(M),R=this.ctx=P.getContext("2d",{willReadFrequently:!0});R.font=`${S} ${w} ${s}px ${m}`,R.textBaseline="alphabetic",R.textAlign="left",R.fillStyle="black",this.gridOuter=new Float64Array(M*M),this.gridInner=new Float64Array(M*M),this.f=new Float64Array(M),this.z=new Float64Array(M+1),this.v=new Uint16Array(M)}_createCanvas(s){const i=document.createElement("canvas");return i.width=i.height=s,i}draw(s){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:w}=this.ctx.measureText(s),S=Math.ceil(a),M=Math.min(this.size-this.buffer,Math.ceil(w-m)),P=Math.min(this.size-this.buffer,S+Math.ceil(f)),R=M+2*this.buffer,z=P+2*this.buffer,V=Math.max(R*z,0),G=new Uint8ClampedArray(V),Z={data:G,width:R,height:z,glyphWidth:M,glyphHeight:P,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(0===M||0===P)return Z;const{ctx:W,buffer:re,gridInner:be,gridOuter:Xe}=this;W.clearRect(re,re,M,P),W.fillText(s,re,re+S);const Ke=W.getImageData(re,re,M,P);Xe.fill(Ld,0,V),be.fill(0,0,V);for(let qe=0;qe<P;qe++)for(let Je=0;Je<M;Je++){const at=Ke.data[4*(qe*M+Je)+3]/255;if(0===at)continue;const Qe=(qe+re)*R+Je+re;if(1===at)Xe[Qe]=0,be[Qe]=Ld;else{const Ut=.5-at;Xe[Qe]=Ut>0?Ut*Ut:0,be[Qe]=Ut<0?Ut*Ut:0}}_0(Xe,0,0,R,z,R,this.f,this.v,this.z),_0(be,re,re,M,P,R,this.f,this.v,this.z);for(let qe=0;qe<V;qe++){const Je=Math.sqrt(Xe[qe])-Math.sqrt(be[qe]);G[qe]=Math.round(255-255*(Je/this.radius+this.cutoff))}return Z}};class Tw{constructor(i=[],a=Mw){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:f}=this,m=a[i];for(;i>0;){const w=i-1>>1,S=a[w];if(f(m,S)>=0)break;a[i]=S,i=w}a[i]=m}_down(i){const{data:a,compare:f}=this,m=this.length>>1,w=a[i];for(;i<m;){let S=1+(i<<1),M=a[S];const P=S+1;if(P<this.length&&f(a[P],M)<0&&(S=P,M=a[P]),f(M,w)>=0)break;a[i]=M,i=S}a[i]=w}}function Mw(s,i){return s<i?-1:s>i?1:0}function Dw(s,i=1,a=!1){let f=1/0,m=1/0,w=-1/0,S=-1/0;const M=s[0];for(let Z=0;Z<M.length;Z++){const W=M[Z];(!Z||W.x<f)&&(f=W.x),(!Z||W.y<m)&&(m=W.y),(!Z||W.x>w)&&(w=W.x),(!Z||W.y>S)&&(S=W.y)}const P=Math.min(w-f,S-m);let R=P/2;const z=new Tw([],Bi);if(0===P)return new Q(f,m);for(let Z=f;Z<w;Z+=P)for(let W=m;W<S;W+=P)z.push(new Oc(Z+R,W+R,R,s));let V=function(Z){let W=0,re=0,be=0;const Xe=Z[0];for(let Ke=0,qe=Xe.length,Je=qe-1;Ke<qe;Je=Ke++){const at=Xe[Ke],Qe=Xe[Je],Ut=at.x*Qe.y-Qe.x*at.y;re+=(at.x+Qe.x)*Ut,be+=(at.y+Qe.y)*Ut,W+=3*Ut}return new Oc(re/W,be/W,0,Z)}(s),G=z.length;for(;z.length;){const Z=z.pop();(Z.d>V.d||!V.d)&&(V=Z,a&&console.log("found best %d after %d probes",Math.round(1e4*Z.d)/1e4,G)),Z.max-V.d<=i||(R=Z.h/2,z.push(new Oc(Z.p.x-R,Z.p.y-R,R,s)),z.push(new Oc(Z.p.x+R,Z.p.y-R,R,s)),z.push(new Oc(Z.p.x-R,Z.p.y+R,R,s)),z.push(new Oc(Z.p.x+R,Z.p.y+R,R,s)),G+=4)}return a&&(console.log(`num probes: ${G}`),console.log(`best distance: ${V.d}`)),V.p}function Bi(s,i){return i.max-s.max}function Oc(s,i,a,f){this.p=new Q(s,i),this.h=a,this.d=function(m,w){let S=!1,M=1/0;for(let P=0;P<w.length;P++){const R=w[P];for(let z=0,V=R.length,G=V-1;z<V;G=z++){const Z=R[z],W=R[G];Z.y>m.y!=W.y>m.y&&m.x<(W.x-Z.x)*(m.y-Z.y)/(W.y-Z.y)+Z.x&&(S=!S),M=Math.min(M,Zx(m,Z,W))}}return(S?1:-1)*Math.sqrt(M)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const Dg=Number.POSITIVE_INFINITY,b0=Math.sqrt(2);function E0(s,i){return i[1]!==Dg?function(a,f,m){let w=0,S=0;switch(f=Math.abs(f),m=Math.abs(m),a){case"top-right":case"top-left":case"top":S=m-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-m}switch(a){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,S]}(s,i[0],i[1]):function(a,f){let m=0,w=0;f<0&&(f=0);const S=f/b0;switch(a){case"top-right":case"top-left":w=S-7;break;case"bottom-right":case"bottom-left":w=7-S;break;case"bottom":w=7-f;break;case"top":w=f-7}switch(a){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=f;break;case"right":m=-f}return[m,w]}(s,i[0])}function Aw(s,i,a,f,m,w,S,M,P,R){s.createArrays(),s.tilePixelRatio=jr/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const z=s.layers[0].layout,V=s.layers[0]._unevaluatedLayout._values,G={};if("composite"===s.textSizeData.kind){const{minZoom:re,maxZoom:be}=s.textSizeData;G.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Ze(re),M),V["text-size"].possiblyEvaluate(new Ze(be),M)]}if("composite"===s.iconSizeData.kind){const{minZoom:re,maxZoom:be}=s.iconSizeData;G.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Ze(re),M),V["icon-size"].possiblyEvaluate(new Ze(be),M)]}G.layoutTextSize=V["text-size"].possiblyEvaluate(new Ze(P+1),M),G.layoutIconSize=V["icon-size"].possiblyEvaluate(new Ze(P+1),M),G.textMaxSize=V["text-size"].possiblyEvaluate(new Ze(18),M);const Z="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),W=z.get("text-size");for(const re of s.features){const be=z.get("text-font").evaluate(re,{},M).join(","),Xe=W.evaluate(re,{},M),Ke=G.layoutTextSize.evaluate(re,{},M),qe=(G.layoutIconSize.evaluate(re,{},M),{horizontal:{},vertical:void 0}),Je=re.text;let at,Qe=[0,0];if(Je){const rn=Je.toString(),In=24*z.get("text-letter-spacing").evaluate(re,{},M),Ht=24*z.get("text-line-height").evaluate(re,{},M),an=b(rn)?In:0,ln=z.get("text-anchor").evaluate(re,{},M),_n=z.get("text-variable-anchor");if(!_n){const er=z.get("text-radial-offset").evaluate(re,{},M);Qe=er?E0(ln,[24*er,Dg]):z.get("text-offset").evaluate(re,{},M).map(yr=>24*yr)}let Tn=Z?"center":z.get("text-justify").evaluate(re,{},M);const Jt="point"===z.get("symbol-placement"),Hn=Jt?24*z.get("text-max-width").evaluate(re,{},M):1/0,Fr=er=>{s.allowVerticalPlacement&&g(rn)&&(qe.vertical=Ly(Je,i,a,m,be,Hn,Ht,ln,er,an,Qe,Yl.vertical,!0,Ke,Xe))};if(!Z&&_n){const er="auto"===Tn?_n.map(Yn=>Ag(Yn)):[Tn];let yr=!1;for(let Yn=0;Yn<er.length;Yn++){const Gr=er[Yn];if(!qe.horizontal[Gr])if(yr)qe.horizontal[Gr]=qe.horizontal[0];else{const si=Ly(Je,i,a,m,be,Hn,Ht,"center",Gr,an,Qe,Yl.horizontal,!1,Ke,Xe);si&&(qe.horizontal[Gr]=si,yr=1===si.positionedLines.length)}}Fr("left")}else{if("auto"===Tn&&(Tn=Ag(ln)),Jt||z.get("text-writing-mode").indexOf("horizontal")>=0||!g(rn)){const er=Ly(Je,i,a,m,be,Hn,Ht,ln,Tn,an,Qe,Yl.horizontal,!1,Ke,Xe);er&&(qe.horizontal[Tn]=er)}Fr(Jt?"left":Tn)}}let Ut=!1;if(re.icon&&re.icon.name){const rn=f[re.icon.name];rn&&(at=Pd(m[re.icon.name],z.get("icon-offset").evaluate(re,{},M),z.get("icon-anchor").evaluate(re,{},M)),Ut=rn.sdf,void 0===s.sdfIcons?s.sdfIcons=rn.sdf:s.sdfIcons!==rn.sdf&&zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(rn.pixelRatio!==s.pixelRatio||0!==z.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const Ot=S0(qe.horizontal)||qe.vertical;s.iconsInText||(s.iconsInText=!!Ot&&Ot.iconsInText),(Ot||at)&&Pw(s,re,qe,at,f,G,Ke,0,Qe,Ut,S,M,R)}w&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function Ag(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Pw(s,i,a,f,m,w,S,M,P,R,z,V,G){let Z=w.textMaxSize.evaluate(i,{},V);void 0===Z&&(Z=S);const W=s.layers[0].layout,re=W.get("icon-offset").evaluate(i,{},V),be=S0(a.horizontal)||a.vertical,Xe="globe"===G.name,Ke=S/24,qe=s.tilePixelRatio*Z/24,Je=(an=s.overscaling,s.zoom>18&&an>2&&(an>>=1),Math.max(jr/(512*an),1)*W.get("symbol-spacing")),at=W.get("text-padding")*s.tilePixelRatio,Qe=W.get("icon-padding")*s.tilePixelRatio,Ut=le(W.get("text-max-angle")),Ot="map"===W.get("text-rotation-alignment")&&"point"!==W.get("symbol-placement"),rn="map"===W.get("icon-rotation-alignment")&&"point"!==W.get("symbol-placement"),In=W.get("symbol-placement"),Ht=Je/2;var an;const ln=W.get("icon-text-fit");let _n;f&&"none"!==ln&&(s.allowVerticalPlacement&&a.vertical&&(_n=nh(f,a.vertical,ln,W.get("icon-text-fit-padding"),re,Ke)),be&&(f=nh(f,be,ln,W.get("icon-text-fit-padding"),re,Ke)));const Tn=(Jt,Hn,Fr)=>{if(Hn.x<0||Hn.x>=jr||Hn.y<0||Hn.y>=jr)return;let er=null;if(Xe){const{x:yr,y:Yn,z:Gr}=G.projectTilePoint(Hn.x,Hn.y,Fr);er={anchor:new Ih(yr,Yn,Gr,0,void 0),up:G.upVector(Fr,Hn.x,Hn.y)}}!function(yr,Yn,Gr,si,di,to,ai,Ls,Mi,Ni,co,ys,Es,ni,ri,Ho,vu,Xo,xa,wa,io,Rs,Ga,ss,ho){const Lu=yr.addToLineVertexArray(Yn,si);let xu,lu,Vu,cu,Ah,Ud,Ap,Pp=0,a_=0,Hg=0,u_=0,Xg=-1,Zg=-1;const Bc={};let l_=tp.exports("");const pf=Gr?Gr.anchor:Yn;let Wg=0,Yg=0;if(void 0===Mi._unevaluatedLayout.getValue("text-radial-offset")?[Wg,Yg]=Mi.layout.get("text-offset").evaluate(io,{},ho).map(Al=>24*Al):(Wg=24*Mi.layout.get("text-radial-offset").evaluate(io,{},ho),Yg=Dg),yr.allowVerticalPlacement&&di.vertical){const Al=di.vertical;if(ri)Ud=Pg(Al),Ls&&(Ap=Pg(Ls));else{const rl=Mi.layout.get("text-rotate").evaluate(io,{},ho)+90;Vu=zy(Ni,pf,Yn,co,ys,Es,Al,ni,rl,Ho),Ls&&(cu=zy(Ni,pf,Yn,co,ys,Es,Ls,Xo,rl))}}if(to){const Al=Mi.layout.get("icon-rotate").evaluate(io,{},ho),rl="none"!==Mi.layout.get("icon-text-fit"),jc=Fy(to,Al,Ga,rl),Lp=Ls?Fy(Ls,Al,Ga,rl):void 0;lu=zy(Ni,pf,Yn,co,ys,Es,to,Xo,Al),Pp=4*jc.length;const J0=yr.iconSizeData;let Ph=null;"source"===J0.kind?(Ph=[mc*Mi.layout.get("icon-size").evaluate(io,{},ho)],Ph[0]>Th&&zn(`${yr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===J0.kind&&(Ph=[mc*Rs.compositeIconSizes[0].evaluate(io,{},ho),mc*Rs.compositeIconSizes[1].evaluate(io,{},ho)],(Ph[0]>Th||Ph[1]>Th)&&zn(`${yr.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),yr.addSymbols(yr.icon,jc,Ph,wa,xa,io,!1,Gr,Yn,Lu.lineStartIndex,Lu.lineLength,-1,ss,ho),Xg=yr.icon.placedSymbolArray.length-1,Lp&&(a_=4*Lp.length,yr.addSymbols(yr.icon,Lp,Ph,wa,xa,io,Yl.vertical,Gr,Yn,Lu.lineStartIndex,Lu.lineLength,-1,ss,ho),Zg=yr.icon.placedSymbolArray.length-1)}for(const Al in di.horizontal){const rl=di.horizontal[Al];xu||(l_=tp.exports(rl.text),ri?Ah=Pg(rl):xu=zy(Ni,pf,Yn,co,ys,Es,rl,ni,Mi.layout.get("text-rotate").evaluate(io,{},ho),Ho));const jc=1===rl.positionedLines.length;if(Hg+=C0(yr,Gr,Yn,rl,ai,Mi,ri,io,Ho,Lu,di.vertical?Yl.horizontal:Yl.horizontalOnly,jc?Object.keys(di.horizontal):[Al],Bc,Xg,Rs,ss,ho),jc)break}di.vertical&&(u_+=C0(yr,Gr,Yn,di.vertical,ai,Mi,ri,io,Ho,Lu,Yl.vertical,["vertical"],Bc,Zg,Rs,ss,ho));let Uc=-1;const ch=(Al,rl)=>Al?Math.max(Al,rl):rl;Uc=ch(Ah,Uc),Uc=ch(Ud,Uc),Uc=ch(Ap,Uc);const Xw=Uc>-1?1:0;yr.glyphOffsetArray.length>=ff.MAX_GLYPHS&&zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==io.sortKey&&yr.addToSortKeyRanges(yr.symbolInstances.length,io.sortKey),yr.symbolInstances.emplaceBack(pf.x,pf.y,pf.z,Yn.x,Yn.y,Bc.right>=0?Bc.right:-1,Bc.center>=0?Bc.center:-1,Bc.left>=0?Bc.left:-1,Bc.vertical>=0?Bc.vertical:-1,Xg,Zg,l_,void 0!==xu?xu:yr.collisionBoxArray.length,void 0!==xu?xu+1:yr.collisionBoxArray.length,void 0!==Vu?Vu:yr.collisionBoxArray.length,void 0!==Vu?Vu+1:yr.collisionBoxArray.length,void 0!==lu?lu:yr.collisionBoxArray.length,void 0!==lu?lu+1:yr.collisionBoxArray.length,cu||yr.collisionBoxArray.length,cu?cu+1:yr.collisionBoxArray.length,co,Hg,u_,Pp,a_,Xw,0,Wg,Yg,Uc)}(s,Hn,er,Jt,a,f,m,_n,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,at,Ot,P,0,Qe,rn,re,i,w,R,z,V)};if("line"===In)for(const Jt of y0(i.geometry,0,0,jr,jr)){const Hn=m0(Jt,Je,Ut,a.vertical||be,f,24,qe,s.overscaling,jr);for(const Fr of Hn){const er=be;er&&I0(s,er.text,Ht,Fr)||Tn(Jt,Fr,V)}}else if("line-center"===In){for(const Jt of i.geometry)if(Jt.length>1){const Hn=dS(Jt,Ut,a.vertical||be,f,24,qe);Hn&&Tn(Jt,Hn,V)}}else if("Polygon"===i.type)for(const Jt of dg(i.geometry,0)){const Hn=Dw(Jt,16);Tn(Jt[0],new Ih(Hn.x,Hn.y,0,0,void 0),V)}else if("LineString"===i.type)for(const Jt of i.geometry)Tn(Jt,new Ih(Jt[0].x,Jt[0].y,0,0,void 0),V);else if("Point"===i.type)for(const Jt of i.geometry)for(const Hn of Jt)Tn([Hn],new Ih(Hn.x,Hn.y,0,0,void 0),V)}const Th=32640;function C0(s,i,a,f,m,w,S,M,P,R,z,V,G,Z,W,re,be){const Xe=function(Je,at,Qe,Ut,Ot,rn,In,Ht){const an=[];if(0===at.positionedLines.length)return an;const ln=Ut.layout.get("text-rotate").evaluate(rn,{})*Math.PI/180,_n=function(er){const yr=er[0],Yn=er[1],Gr=yr*Yn;return Gr>0?[yr,-Yn]:Gr<0?[-yr,Yn]:0===yr?[Yn,yr]:[Yn,-yr]}(Qe);let Tn=Math.abs(at.top-at.bottom);for(const er of at.positionedLines)Tn-=er.lineOffset;const Jt=at.positionedLines.length,Hn=Tn/Jt;let Fr=at.top-Qe[1];for(let er=0;er<Jt;++er){const yr=at.positionedLines[er];Fr=w0(at,Hn,Fr,er);for(const Yn of yr.positionedGlyphs){if(!Yn.rect)continue;const Gr=Yn.rect||{};let si=4,di=!0,to=1,ai=0;if(Yn.imageName){const ss=In[Yn.imageName];if(!ss)continue;if(ss.sdf){zn("SDF images are not supported in formatted text and will be ignored.");continue}di=!1,to=ss.pixelRatio,si=1/to}const Ls=(Ot||Ht)&&Yn.vertical,Mi=Yn.metrics.advance*Yn.scale/2,Ni=Yn.metrics,co=Yn.rect;if(null===co)continue;Ht&&at.verticalizable&&(ai=Yn.imageName?Mi-Yn.metrics.width*Yn.scale/2:0);const ys=Ot?[Yn.x+Mi,Yn.y]:[0,0];let Es=[0,0],ni=[0,0],ri=!1;Ot||(Ls?(ni=[Yn.x+Mi+_n[0],Yn.y+_n[1]-ai],ri=!0):Es=[Yn.x+Mi+Qe[0],Yn.y+Qe[1]-ai]);const Ho=co.w*Yn.scale/(to*(Yn.localGlyph?2:1)),vu=co.h*Yn.scale/(to*(Yn.localGlyph?2:1));let Xo,xa,wa,io;if(Ls){const ss=Yn.y-Fr,ho=new Q(-Mi,Mi-ss),Lu=-Math.PI/2,xu=new Q(...ni);Xo=new Q(-Mi+Es[0],Es[1]),Xo._rotateAround(Lu,ho)._add(xu),Xo.x+=-ss+Mi,Xo.y-=(Ni.left-si)*Yn.scale;const lu=Yn.imageName?Ni.advance*Yn.scale:24*Yn.scale,Vu=String.fromCharCode(Yn.glyph);_w(Vu)?Xo.x+=(1-si)*Yn.scale:Sy(Vu)?Xo.x+=lu-Ni.height*Yn.scale+(-si-1)*Yn.scale:Xo.x+=Yn.imageName||Ni.width+2*si===co.w&&Ni.height+2*si===co.h?(lu-vu)/2:(lu-(Ni.height+2*si)*Yn.scale)/2,xa=new Q(Xo.x,Xo.y-Ho),wa=new Q(Xo.x+vu,Xo.y),io=new Q(Xo.x+vu,Xo.y-Ho)}else{const ss=(Ni.left-si)*Yn.scale-Mi+Es[0],ho=(-Ni.top-si)*Yn.scale+Es[1],Lu=ss+Ho,xu=ho+vu;Xo=new Q(ss,ho),xa=new Q(Lu,ho),wa=new Q(ss,xu),io=new Q(Lu,xu)}if(ln){let ss;ss=Ot?new Q(0,0):ri?new Q(_n[0],_n[1]):new Q(Qe[0],Qe[1]),Xo._rotateAround(ln,ss),xa._rotateAround(ln,ss),wa._rotateAround(ln,ss),io._rotateAround(ln,ss)}const Rs=new Q(0,0),Ga=new Q(0,0);an.push({tl:Xo,tr:xa,bl:wa,br:io,tex:Gr,writingMode:at.writingMode,glyphOffset:ys,sectionIndex:Yn.sectionIndex,isSDF:di,pixelOffsetTL:Rs,pixelOffsetBR:Ga,minFontScaleX:0,minFontScaleY:0})}}return an}(0,f,P,w,S,M,m,s.allowVerticalPlacement),Ke=s.textSizeData;let qe=null;"source"===Ke.kind?(qe=[mc*w.layout.get("text-size").evaluate(M,{},be)],qe[0]>Th&&zn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ke.kind&&(qe=[mc*W.compositeTextSizes[0].evaluate(M,{},be),mc*W.compositeTextSizes[1].evaluate(M,{},be)],(qe[0]>Th||qe[1]>Th)&&zn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,Xe,qe,P,S,M,z,i,a,R.lineStartIndex,R.lineLength,Z,re,be);for(const Je of V)G[Je]=s.text.placedSymbolArray.length-1;return 4*Xe.length}function S0(s){for(const i in s)return s[i];return null}function zy(s,i,a,f,m,w,S,M,P,R){let z=S.top,V=S.bottom,G=S.left,Z=S.right;const W=S.collisionPadding;if(W&&(G-=W[0],z-=W[1],Z+=W[2],V+=W[3]),P){const re=new Q(G,z),be=new Q(Z,z),Xe=new Q(G,V),Ke=new Q(Z,V),qe=le(P);let Je=new Q(0,0);R&&(Je=new Q(R[0],R[1])),re._rotateAround(qe,Je),be._rotateAround(qe,Je),Xe._rotateAround(qe,Je),Ke._rotateAround(qe,Je),G=Math.min(re.x,be.x,Xe.x,Ke.x),Z=Math.max(re.x,be.x,Xe.x,Ke.x),z=Math.min(re.y,be.y,Xe.y,Ke.y),V=Math.max(re.y,be.y,Xe.y,Ke.y)}return s.emplaceBack(i.x,i.y,i.z,a.x,a.y,G,z,Z,V,M,f,m,w),s.length-1}function Pg(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const i=s.bottom-s.top;return i>0?Math.max(10,i):null}function I0(s,i,a,f){const m=s.compareText;if(i in m){const w=m[i];for(let S=w.length-1;S>=0;S--)if(f.dist(w[S])<a)return!0}else m[i]=[];return m[i].push(f),!1}const rh=Un([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:T0}=rh,Lg=Un([{name:"a_pos_3",components:3,type:"Int16"}]);var Gf=Un([{name:"a_pos",type:"Int16",components:2}]);const Mh=jr/Math.PI/2,M0=2*fc(1,0)*Mh*Math.PI,bp=[64,32,16],Nc=-Mh,_c=Mh,pS=[new nl([Nc,Nc,Nc],[_c,_c,_c]),new nl([Nc,Nc,Nc],[0,0,_c]),new nl([0,Nc,Nc],[_c,0,_c]),new nl([Nc,0,Nc],[0,_c,_c]),new nl([0,0,Nc],[_c,_c,_c])];function D0(s,i,a,f=!0){const m=Wl([],s._camera.position,s.worldSize),w=[i,a,1,1];gc(w,w,s.pixelMatrixInverse),ig(w,w,1/w[3]);const S=tl([],Ac([],w,m)),M=s.globeMatrix,P=[M[12],M[13],M[14]],R=Ac([],P,m),z=bh(R),V=tl([],R),G=s.worldSize/(2*Math.PI),Z=pc(V,S),W=Math.asin(G/z);if(W<Math.acos(Z)){if(!f)return null;const In=[],Ht=[];Wl(In,S,z/Z),tl(Ht,Ac(Ht,In,R)),tl(S,eh(S,R,Wl(S,Ht,Math.tan(W)*z)))}const re=[];new ty(m,S).closestPointOnSphere(P,G,re);const be=tl([],ve(M,0)),Xe=tl([],ve(M,1)),Ke=tl([],ve(M,2)),qe=pc(be,re),Je=pc(Xe,re),at=pc(Ke,re),Qe=we(Math.asin(-Je/G));let Ut=we(Math.atan2(qe,at));Ut=s.center.lng+function(In,Ht){const an=(Ht-In+180)%360-180;return an<-180?an+360:an}(s.center.lng,Ut);const Ot=Xl(Ut),rn=ue(Dc(Qe),0,1);return new Ff(Ot,rn)}class Od{constructor(i,a,f){this.a=Ac([],i,f),this.b=Ac([],a,f),this.center=f;const m=tl([],this.a),w=tl([],this.b);this.angle=Math.acos(pc(m,w))}}function By(s,i){if(0===s.angle)return null;let a;return a=0===s.a[i]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[i]/s.a[i]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(f,m,w,S){const M=Math.sin(w);return f*(Math.sin((1-S)*w)/M)+m*(Math.sin(S*w)/M)}(s.a[i],s.b[i],s.angle,ue(a,0,1))+s.center[i]}function kc(s){if(s.z<=1)return pS[s.z+2*s.y+s.x];const i=jy(Rg(s));return nl.fromPoints(i)}function ih(s,i,a){return Wl(s,s,1-a),xd(s,s,i,a)}function A0(s,i){const a=uf(i.zoom);if(0===a)return kc(s);const f=Rg(s),m=jy(f),w=Xl(f.getWest())*i.worldSize,S=Xl(f.getEast())*i.worldSize,M=Dc(f.getNorth())*i.worldSize,P=Dc(f.getSouth())*i.worldSize,R=[w,M,0],z=[S,M,0],V=[w,P,0],G=[S,P,0],Z=Zm([],i.globeMatrix);return va(R,R,Z),va(z,z,Z),va(V,V,Z),va(G,G,Z),m[0]=ih(m[0],V,a),m[1]=ih(m[1],G,a),m[2]=ih(m[2],z,a),m[3]=ih(m[3],R,a),nl.fromPoints(m)}function Uy(s,i,a){for(const f of s)va(f,f,i),Wl(f,f,a)}function Rg({x:s,y:i,z:a}){const f=1/(1<<a),m=new po(Zl(s*f),La((i+1)*f)),w=new po(Zl((s+1)*f),La(i*f));return new xh(m,w)}function jy(s){const i=le(s.getNorth()),a=le(s.getSouth()),f=Math.cos(i),m=Math.cos(a),w=Math.sin(i),S=Math.sin(a),M=s.getWest(),P=s.getEast();return[Nd(m,S,M),Nd(m,S,P),Nd(f,w,P),Nd(f,w,M)]}function Nd(s,i,a,f=Mh){return a=le(a),[s*Math.sin(a)*f,-i*f,s*Math.cos(a)*f]}function Ep(s,i,a){return Nd(Math.cos(le(s)),Math.sin(le(s)),i,a)}function kd(s,i,a,f){const m=1<<a.z,w=(s/jr+a.x)/m;return Ep(La((i/jr+a.y)/m),Zl(w),f)}function Og({min:s,max:i}){return 16383/Math.max(i[0]-s[0],i[1]-s[1],i[2]-s[2])}const Vy=new Float64Array(16);function Fd(s){const i=Og(s),a=fl(Vy,[i,i,i]);return sp(a,a,((f=[])[0]=-(m=s.min)[0],f[1]=-m[1],f[2]=-m[2],f));var f,m}function Cp(s){const i=(f=s.min,(a=Vy)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=f[0],a[13]=f[1],a[14]=f[2],a[15]=1,a);var a,f;const m=1/Og(s);return Jh(i,i,[m,m,m])}function Rw(s,i,a,f,m){const w=function(P){const R=jr/(2*Math.PI);return P/(2*Math.PI)/R}(a),S=[s,i,-a/(2*Math.PI)],M=dc(new Float64Array(16));return sp(M,M,S),Jh(M,M,[w,w,w]),Wm(M,M,le(-m)),ng(M,M,le(-f)),M}function uf(s){return on(5,6,s)}function P0(s,i){const a=Ep(i.lat,i.lng);return S=(m=Ym([],function(W){const re=Ep(W._center.lat,W._center.lng);let be=lp([],Bf(0,1,0),re);const Xe=rg([],-W.angle,re);be=va(be,be,Xe),rg(Xe,-W._pitch,be);const Ke=tl([],re);return Wl(Ke,Ke,W.cameraToCenterDistance/W.pixelsPerMeter*M0),va(Ke,Ke,Xe),eh([],re,Ke)}(s),a))[0],M=m[1],P=m[2],R=(w=a)[0],z=w[1],V=w[2],Z=(G=Math.sqrt(S*S+M*M+P*P)*Math.sqrt(R*R+z*z+V*V))&&pc(m,w)/G,Math.acos(Math.min(Math.max(Z,-1),1));var m,w,S,M,P,R,z,V,G,Z}const Ow=le(85),bi=Math.cos(Ow),L0=Math.sin(Ow);function R0(s,i){const a=s.fovAboveCenter,f=s.elevation?s.elevation.getMinElevationBelowMSL()*i:0,m=(s._camera.position[2]*s.worldSize-f)/Math.cos(s._pitch),w=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01)),S=Math.sin(s._pitch)*w+m;return Math.min(1.01*S,m*(1/s._horizonShift))}function lf(s,i){if(!i.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:i};const a=Math.pow(2,-s.z),f=s.x*a,m=(s.x+1)*a,w=s.y*a,S=(s.y+1)*a,M=Zl(f),P=Zl(m),R=La(w),z=La(S),V=i.project(M,R),G=i.project(P,R),Z=i.project(P,z),W=i.project(M,z);let re=Math.min(V.x,G.x,Z.x,W.x),be=Math.min(V.y,G.y,Z.y,W.y),Xe=Math.max(V.x,G.x,Z.x,W.x),Ke=Math.max(V.y,G.y,Z.y,W.y);const qe=a/16;function Je(Qe,Ut,Ot,rn,In,Ht){const an=(Ot+In)/2,ln=(rn+Ht)/2,_n=i.project(Zl(an),La(ln)),Tn=Math.max(0,re-_n.x,be-_n.y,_n.x-Xe,_n.y-Ke);re=Math.min(re,_n.x),Xe=Math.max(Xe,_n.x),be=Math.min(be,_n.y),Ke=Math.max(Ke,_n.y),Tn>qe&&(Je(Qe,_n,Ot,rn,an,ln),Je(_n,Ut,an,ln,In,Ht))}Je(V,G,f,w,m,w),Je(G,Z,m,w,m,S),Je(Z,W,m,S,f,S),Je(W,V,f,S,f,w),re-=qe,be-=qe,Xe+=qe,Ke+=qe;const at=1/Math.max(Xe-re,Ke-be);return{scale:at,x:re*at,y:be*at,x2:Xe*at,y2:Ke*at,projection:i}}const Nw=dc(new Float32Array(16));class cf{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new po(0,0)}projectTilePoint(i,a,f){return{x:i,y:a,z:0}}locationPoint(i,a,f=!0){return i._coordinatePoint(i.locationCoordinate(a),f)}pixelsPerMeter(i,a){return fc(1,i)*a}pixelSpaceConversion(i,a,f){return 1}farthestPixelDistance(i){return R0(i,i.pixelsPerMeter)}pointCoordinate(i,a,f,m){const w=i.horizonLineFromTop(!1),S=new Q(a,Math.max(w,f));return i.rayIntersectionCoordinate(i.pointRayIntersection(S,m))}pointCoordinate3D(i,a,f){const m=new Q(a,f);if(i.elevation)return i.elevation.pointCoordinate(m);{const w=this.pointCoordinate(i,m.x,m.y,0);return[w.x,w.y,w.z]}}isPointAboveHorizon(i,a){if(i.elevation)return!this.pointCoordinate3D(i,a.x,a.y);const f=i.horizonLineFromTop();return a.y<f}createInversionMatrix(i,a){return Nw}createTileMatrix(i,a,f){let m,w,S;const M=f.canonical,P=dc(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=lf(M,this);m=1,w=R.x+f.wrap*R.scale,S=R.y,Jh(P,P,[m/R.scale,m/R.scale,i.pixelsPerMeter/a])}else m=a/i.zoomScale(M.z),w=(M.x+Math.pow(2,M.z)*f.wrap)*m,S=M.y*m;return sp(P,P,[w,S,0]),Jh(P,P,[m/jr,m/jr,1]),P}upVector(i,a,f){return[0,0,1]}upVectorScale(i,a,f){return{metersToTile:1}}}class Ng extends cf{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,f]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(le(a));this.n=(m+Math.sin(le(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:f,c:m,r0:w}=this,S=le(i-this.center[0]),M=le(a),P=Math.sqrt(m-2*f*Math.sin(M))/f;return{x:P*Math.sin(S*f),y:P*Math.cos(S*f)-w,z:0}}unproject(i,a){const{n:f,c:m,r0:w}=this,S=w+a;let M=Math.atan2(i,Math.abs(S))*Math.sign(S);S*f<0&&(M-=Math.PI*Math.sign(i)*Math.sign(S));const P=le(this.center[0])*f;M=kt(M,-Math.PI-P,Math.PI-P);const R=ue(we(M/f)+this.center[0],-180,180),z=Math.asin(ue((m-(i*i+S*S)*f*f)/(2*f),-1,1)),V=ue(we(z),-85.051129,Qc);return new po(R,V)}}const oh=1.340264,$f=-.081106,Dh=893e-6,qf=.003796,Hf=Math.sqrt(3)/2;class O0 extends cf{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const f=Math.asin(Hf*Math.sin(a)),m=f*f,w=m*m*m;return{x:.5*(i*Math.cos(f)/(Hf*(oh+3*$f*m+w*(7*Dh+9*qf*m)))/Math.PI+.5),y:1-.5*(f*(oh+$f*m+w*(Dh+qf*m))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let f=a=(2*(1-a)-1)*Math.PI,m=f*f,w=m*m*m;for(let z,V,G,Z=0;Z<12&&(V=f*(oh+$f*m+w*(Dh+qf*m))-a,G=oh+3*$f*m+w*(7*Dh+9*qf*m),z=V/G,f=ue(f-z,-Math.PI/3,Math.PI/3),m=f*f,w=m*m*m,!(Math.abs(z)<1e-12));++Z);const S=Hf*i*(oh+3*$f*m+w*(7*Dh+9*qf*m))/Math.cos(f),M=Math.asin(Math.sin(f)/Hf),P=ue(180*S/Math.PI,-180,180),R=ue(180*M/Math.PI,-85.051129,Qc);return new po(P,R)}}class Gy extends cf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const f=360*(i-.5),m=ue(360*(.5-a),-85.051129,Qc);return new po(f,m)}}const hf=Math.PI/2;function zd(s){return Math.tan((hf+s)/2)}class N0 extends cf{constructor(i){super(i),this.center=i.center||[0,30];const[a,f]=this.parallels=i.parallels||[30,30];let m=le(a),w=le(f);this.southernCenter=m+w<0,this.southernCenter&&(m=-m,w=-w);const S=Math.cos(m),M=zd(m);this.n=m===w?Math.sin(m):Math.log(S/Math.cos(w))/Math.log(zd(w)/M),this.f=S*Math.pow(zd(m),this.n)/this.n}project(i,a){a=le(a),this.southernCenter&&(a=-a),i=le(i-this.center[0]);const f=1e-6,{n:m,f:w}=this;w>0?a<-hf+f&&(a=-hf+f):a>hf-f&&(a=hf-f);const S=w/Math.pow(zd(a),m);let M=S*Math.sin(m*i),P=w-S*Math.cos(m*i);return M=.5*(M/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:M,y:this.southernCenter?P:1-P,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:f,f:m}=this,w=m-a,S=Math.sign(w),M=Math.sign(f)*Math.sqrt(i*i+w*w);let P=Math.atan2(i,Math.abs(w))*S;w*f<0&&(P-=Math.PI*Math.sign(i)*S);const R=ue(we(P/f)+this.center[0],-180,180),z=ue(we(2*Math.atan(Math.pow(m/M,1/f))-hf),-85.051129,Qc);return new po(R,this.southernCenter?-z:z)}}class kg extends cf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:Xl(i),y:Dc(a),z:0}}unproject(i,a){const f=Zl(i),m=La(a);return new po(f,m)}}const k0=le(Qc);class kw extends cf{project(i,a){const f=(a=le(a))*a,m=f*f;return{x:.5*((i=le(i))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let f=a=(2*(1-a)-1)*Math.PI,m=25,w=0,S=f*f;do{S=f*f;const R=S*S;w=(f*(1.007226+S*(.015085+R*(.028874*S-.044475-.005916*R)))-a)/(1.007226+S*(.045255+R*(.259866*S-.311325-.005916*11*R))),f=ue(f-w,-k0,k0)}while(Math.abs(w)>1e-6&&--m>0);S=f*f;const M=ue(we(i/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),P=we(f);return new po(M,P)}}const $y=le(Qc);class Fw extends cf{project(i,a){a=le(a),i=le(i);const f=Math.cos(a),m=2/Math.PI,w=Math.acos(f*Math.cos(i/2)),S=Math.sin(w)/w,M=.5*(i*m+2*f*Math.sin(i/2)/S)||0,P=.5*(a+Math.sin(a)/S)||0;return{x:.5*(M/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(i,a){let f=i=(2*i-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,w=25;const S=1e-6;let M=0,P=0;do{const R=Math.cos(m),z=Math.sin(m),V=2*z*R,G=z*z,Z=R*R,W=Math.cos(f/2),re=Math.sin(f/2),be=2*W*re,Xe=re*re,Ke=1-Z*W*W,qe=Ke?1/Ke:0,Je=Ke?Math.acos(R*W)*Math.sqrt(1/Ke):0,at=.5*(2*Je*R*re+2*f/Math.PI)-i,Qe=.5*(Je*z+m)-a,Ut=.5*qe*(Z*Xe+Je*R*W*G)+1/Math.PI,Ot=qe*(be*V/4-Je*z*re),rn=.125*qe*(V*re-Je*z*Z*be),In=.5*qe*(G*W+Je*Xe*R)+.5,Ht=Ot*rn-In*Ut;M=(Qe*Ot-at*In)/Ht,P=(at*rn-Qe*Ut)/Ht,f=ue(f-M,-Math.PI,Math.PI),m=ue(m-P,-$y,$y)}while((Math.abs(M)>S||Math.abs(P)>S)&&--w>0);return new po(we(f),we(m))}}class qy extends cf{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(le(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:f,cosPhi:m}=this;return{x:le(i)*m*f+.5,y:-Math.sin(le(a))/m*f+.5,z:0}}unproject(i,a){const{scale:f,cosPhi:m}=this,w=-(a-.5)/f,S=ue(we((i-.5)/f)/m,-180,180),M=Math.asin(ue(w*m,-1,1)),P=ue(we(M),-85.051129,Qc);return new po(S,P)}}class F0 extends kg{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(i,a,f){const m=kd(i,a,f);return va(m,m,Fd(kc(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,a){const f=Ep(a.lat,a.lng),m=tl([],f),w=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;xd(f,f,m,fc(1,0)*jr*w);const S=dc(new Float64Array(16));return _d(S,i.pixelMatrix,i.globeMatrix),va(f,f,S),new Q(f[0],f[1])}pixelsPerMeter(i,a){return fc(1,0)*a}pixelSpaceConversion(i,a,f){const m=fc(1,i)*a,w=Ii(fc(1,45)*a,m,f);return this.pixelsPerMeter(i,a)/w}createTileMatrix(i,a,f){const m=Cp(kc(f.canonical));return _d(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,a){const{center:f}=i,m=Fd(kc(a));return ng(m,m,le(f.lng)),Wm(m,m,le(f.lat)),Jh(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,a,f,m){return D0(i,a,f,!0)||new Ff(0,0)}pointCoordinate3D(i,a,f){const m=this.pointCoordinate(i,a,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,a){return!D0(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(m,w){const S=m.cameraToCenterDistance,M=m._centerAltitude*w,P=m._camera,R=m._camera.forward(),z=eh([],Wl([],R,-S),[0,0,M]),V=m.worldSize/(2*Math.PI),G=[0,0,-V],Z=m.width/m.height,W=Math.tan(m.fovAboveCenter),re=Wl([],P.up(),W),be=Wl([],P.right(),W*Z),Xe=tl([],eh([],eh([],R,re),be)),Ke=[];let qe;if(new ty(z,Xe).closestPointOnSphere(G,V,Ke)){const Je=eh([],Ke,G),at=Ac([],Je,z);qe=Math.cos(m.fovAboveCenter)*bh(at)}else{const Je=Ac([],z,G),at=Ac([],G,z);tl(at,at);const Qe=bh(Je)-V;qe=Math.sqrt(Qe*(Qe+2*V));const Ut=Math.acos(qe/(V+Qe))-Math.acos(pc(R,at));qe*=Math.cos(Ut)}return 1.01*qe}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),f=uf(i.zoom);if(f>0){const m=R0(i,fc(1,i.center.lat)*i.worldSize),w=i.worldSize/(2*Math.PI),S=Math.max(i.width,i.height)/i.worldSize*Math.PI;return Ii(a,m+w*(1-Math.cos(S)),Math.pow(f,10))}return a}upVector(i,a,f){return kd(a,f,i,1)}upVectorScale(i){return{metersToTile:M0*Og(kc(i))}}}function z0(s){const i=s.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(s.name){case"mercator":return new kg(s);case"equirectangular":return new Gy(s);case"naturalEarth":return new kw(s);case"equalEarth":return new O0(s);case"winkelTripel":return new Fw(s);case"albers":return a?new qy(s):new Ng(s);case"lambertConformalConic":return a?new qy(s):new N0(s);case"globe":return new F0(s)}throw new Error(`Invalid projection name: ${s.name}`)}const zw=tf.types,Jl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sp(s,i,a,f,m,w,S,M,P,R,z,V,G){const Z=M?Math.min(Th,Math.round(M[0])):0,W=M?Math.min(Th,Math.round(M[1])):0;s.emplaceBack(i,a,Math.round(32*f),Math.round(32*m),w,S,(Z<<1)+(P?1:0),W,16*R,16*z,256*V,256*G)}function Fg(s,i,a,f,m,w,S){s.emplaceBack(i,a,f,m,w,S)}function Hy(s,i,a,f,m){s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m)}function Xy(s){for(const i of s.sections)if(H(i.text))return!0;return!1}class zg{constructor(i){this.layoutVertexArray=new Ps,this.indexArray=new Du,this.programConfigurations=i,this.segments=new _a,this.dynamicLayoutVertexArray=new ja,this.opacityVertexArray=new ya,this.placedSymbolArray=new ep,this.globeExtVertexArray=new lo}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,a,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,r0.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Jl,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,gw.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}oe(zg,"SymbolBuffers");class Zy{constructor(i,a,f){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new f,this.segments=new _a,this.collisionVertexArray=new Wc,this.collisionVertexArrayExt=new El}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,o0.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,by.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}oe(Zy,"CollisionBuffers");class ff{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(S=>S.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=dc([]),this.placementViewportMatrix=dc([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Eg(this.zoom,a["text-size"]),this.iconSizeData=Eg(this.zoom,a["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==w&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===w||"auto"===w&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(S=>Yl[S]),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new zg(new pd(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new zg(new pd(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Of,this.lineVertexArray=new Nm,this.symbolInstances=new Rf}calculateGlyphDependencies(i,a,f,m,w){for(let S=0;S<i.length;S++)if(a[i.charCodeAt(S)]=!0,m&&w){const M=rf[i.charAt(S)];M&&(a[M.charCodeAt(0)]=!0)}}populate(i,a,f,m){const w=this.layers[0],S=w.layout,M="globe"===this.projection.name,P=S.get("text-font"),R=S.get("text-field"),z=S.get("icon-image"),V=("constant"!==R.value.kind||R.value.value instanceof $n&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&("constant"!==P.value.kind||P.value.value.length>0),G="constant"!==z.value.kind||!!z.value.value||Object.keys(z.parameters).length>0,Z=S.get("symbol-sort-key");if(this.features=[],!V&&!G)return;const W=a.iconDependencies,re=a.glyphDependencies,be=a.availableImages,Xe=new Ze(this.zoom);for(const{feature:Ke,id:qe,index:Je,sourceLayerIndex:at}of i){const Qe=w._featureFilter.needGeometry,Ut=Kh(Ke,Qe);if(!w._featureFilter.filter(Xe,Ut,f))continue;if(Qe||(Ut.geometry=wh(Ke,f,m)),M&&1!==Ke.type&&f.z<=5){const Ht=Ut.geometry,an=.98078528056,ln=(_n,Tn)=>pc(kd(_n.x,_n.y,f,1),kd(Tn.x,Tn.y,f,1))<an;for(let _n=0;_n<Ht.length;_n++)Ht[_n]=Hx(Ht[_n],ln)}let Ot,rn;if(V){const Ht=w.getValueAndResolveTokens("text-field",Ut,f,be),an=$n.factory(Ht);Xy(an)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Ae()||this.hasRTLText&&rt.isParsed())&&(Ot=Cy(an,w,Ut))}if(G){const Ht=w.getValueAndResolveTokens("icon-image",Ut,f,be);rn=Ht instanceof Ar?Ht:Ar.fromString(Ht)}if(!Ot&&!rn)continue;const In=this.sortFeaturesByKey?Z.evaluate(Ut,{},f):void 0;if(this.features.push({id:qe,text:Ot,icon:rn,index:Je,sourceLayerIndex:at,geometry:Ut.geometry,properties:Ke.properties,type:zw[Ke.type],sortKey:In}),rn&&(W[rn.name]=!0),Ot){const Ht=P.evaluate(Ut,{},f).join(","),an="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Yl.vertical)>=0;for(const ln of Ot.sections)if(ln.image)W[ln.image.name]=!0;else{const _n=g(Ot.toString()),Tn=ln.fontStack||Ht,Jt=re[Tn]=re[Tn]||{};this.calculateGlyphDependencies(ln.text,Jt,an,this.allowVerticalPlacement,_n)}}}"line"===S.get("symbol-placement")&&(this.features=function(Ke){const qe={},Je={},at=[];let Qe=0;function Ut(Ht){at.push(Ke[Ht]),Qe++}function Ot(Ht,an,ln){const _n=Je[Ht];return delete Je[Ht],Je[an]=_n,at[_n].geometry[0].pop(),at[_n].geometry[0]=at[_n].geometry[0].concat(ln[0]),_n}function rn(Ht,an,ln){const _n=qe[an];return delete qe[an],qe[Ht]=_n,at[_n].geometry[0].shift(),at[_n].geometry[0]=ln[0].concat(at[_n].geometry[0]),_n}function In(Ht,an,ln){const _n=ln?an[0][an[0].length-1]:an[0][0];return`${Ht}:${_n.x}:${_n.y}`}for(let Ht=0;Ht<Ke.length;Ht++){const an=Ke[Ht],ln=an.geometry,_n=an.text?an.text.toString():null;if(!_n){Ut(Ht);continue}const Tn=In(_n,ln),Jt=In(_n,ln,!0);if(Tn in Je&&Jt in qe&&Je[Tn]!==qe[Jt]){const Hn=rn(Tn,Jt,ln),Fr=Ot(Tn,Jt,at[Hn].geometry);delete qe[Tn],delete Je[Jt],Je[In(_n,at[Fr].geometry,!0)]=Fr,at[Hn].geometry=null}else Tn in Je?Ot(Tn,Jt,ln):Jt in qe?rn(Tn,Jt,ln):(Ut(Ht),qe[Tn]=Qe-1,Je[Jt]=Qe-1)}return at.filter(Ht=>Ht.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ke,qe)=>Ke.sortKey-qe.sortKey)}update(i,a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,f,m),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,f,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=z0(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const f=this.lineVertexArray.length,m=i.segment;if(void 0!==m){let w=i.dist(a[m+1]),S=i.dist(a[m]);const M={};for(let P=m+1;P<a.length;P++)M[P]={x:a[P].x,y:a[P].y,tileUnitDistanceFromAnchor:w},P<a.length-1&&(w+=a[P+1].dist(a[P]));for(let P=m||0;P>=0;P--)M[P]={x:a[P].x,y:a[P].y,tileUnitDistanceFromAnchor:S},P>0&&(S+=a[P-1].dist(a[P]));for(let P=0;P<a.length;P++){const R=M[P];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,a,f,m,w,S,M,P,R,z,V,G,Z,W){const re=i.indexArray,be=i.layoutVertexArray,Xe=i.globeExtVertexArray,Ke=i.segments.prepareSegment(4*a.length,be,re,this.canOverlap?S.sortKey:void 0),qe=this.glyphOffsetArray.length,Je=Ke.vertexLength,at=this.allowVerticalPlacement&&M===Yl.vertical?Math.PI/2:0,Qe=S.text&&S.text.sections;for(let Ot=0;Ot<a.length;Ot++){const{tl:rn,tr:In,bl:Ht,br:an,tex:ln,pixelOffsetTL:_n,pixelOffsetBR:Tn,minFontScaleX:Jt,minFontScaleY:Hn,glyphOffset:Fr,isSDF:er,sectionIndex:yr}=a[Ot],Yn=Ke.vertexLength,Gr=Fr[1];if(Sp(be,R.x,R.y,rn.x,Gr+rn.y,ln.x,ln.y,f,er,_n.x,_n.y,Jt,Hn),Sp(be,R.x,R.y,In.x,Gr+In.y,ln.x+ln.w,ln.y,f,er,Tn.x,_n.y,Jt,Hn),Sp(be,R.x,R.y,Ht.x,Gr+Ht.y,ln.x,ln.y+ln.h,f,er,_n.x,Tn.y,Jt,Hn),Sp(be,R.x,R.y,an.x,Gr+an.y,ln.x+ln.w,ln.y+ln.h,f,er,Tn.x,Tn.y,Jt,Hn),P){const si=P.anchor,di=P.up;Fg(Xe,si.x,si.y,si.z,di[0],di[1],di[2]),Fg(Xe,si.x,si.y,si.z,di[0],di[1],di[2]),Fg(Xe,si.x,si.y,si.z,di[0],di[1],di[2]),Fg(Xe,si.x,si.y,si.z,di[0],di[1],di[2]),Hy(i.dynamicLayoutVertexArray,si.x,si.y,si.z,at)}else Hy(i.dynamicLayoutVertexArray,R.x,R.y,R.z,at);re.emplaceBack(Yn,Yn+1,Yn+2),re.emplaceBack(Yn+1,Yn+2,Yn+3),Ke.vertexLength+=4,Ke.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Fr[0]),Ot!==a.length-1&&yr===a[Ot+1].sectionIndex||i.programConfigurations.populatePaintArrays(be.length,S,S.index,{},Z,W,Qe&&Qe[yr])}const Ut=P?P.anchor:R;i.placedSymbolArray.emplaceBack(Ut.x,Ut.y,Ut.z,R.x,R.y,qe,this.glyphOffsetArray.length-qe,Je,z,V,R.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],M,0,!1,0,G,0)}_commitLayoutVertex(i,a,f,m,w,S,M){i.emplaceBack(a,f,m,w,S,Math.round(M.x),Math.round(M.y))}_addCollisionDebugVertices(i,a,f,m,w,S,M){const P=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),R=P.vertexLength,z=M.tileAnchorX,V=M.tileAnchorY;for(let Z=0;Z<4;Z++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(a,-i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(a,i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(a,i.padding,i.padding),f.collisionVertexArrayExt.emplaceBack(a,-i.padding,i.padding),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Q(i.x1,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Q(i.x2,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Q(i.x2,i.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,z,V,new Q(i.x1,i.y2)),P.vertexLength+=4;const G=f.indexArray;G.emplaceBack(R,R+1),G.emplaceBack(R+1,R+2),G.emplaceBack(R+2,R+3),G.emplaceBack(R+3,R),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,f,m,w,S){for(let M=m;M<w;M++){const P=f.get(M),R=this.getSymbolInstanceTextSize(i,S,a,M);this._addCollisionDebugVertices(P,R,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(i,a,f,m,w,S){for(let M=m;M<w;M++){const P=f.get(M),R=this.getSymbolInstanceIconSize(i,a,S.placedIconSymbolIndex);this._addCollisionDebugVertices(P,R,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}generateCollisionDebugBuffers(i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zy(cs,mw.members,Cl),this.iconCollisionBox=new Zy(cs,mw.members,Cl);const f=yc(this.iconSizeData,i),m=yc(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(m,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(m,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,a,f,m){const w=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),S=_p(this.textSizeData,i,w)/24;return this.tilePixelRatio*S}getSymbolInstanceIconSize(i,a,f){const m=this.icon.placedSymbolArray.get(f),w=_p(this.iconSizeData,i,m);return this.tilePixelRatio*w}_commitDebugCollisionVertexUpdate(i,a,f){i.emplaceBack(a,-f,-f),i.emplaceBack(a,f,-f),i.emplaceBack(a,f,f),i.emplaceBack(a,-f,f)}_updateTextDebugCollisionBoxes(i,a,f,m,w,S){for(let M=m;M<w;M++){const P=f.get(M),R=this.getSymbolInstanceTextSize(i,S,a,M);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,R,P.padding)}}_updateIconDebugCollisionBoxes(i,a,f,m,w,S){for(let M=m;M<w;M++){const P=f.get(M),R=this.getSymbolInstanceIconSize(i,a,S);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,R,P.padding)}}updateCollisionDebugBuffers(i,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=yc(this.iconSizeData,i),m=yc(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(m,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._updateTextDebugCollisionBoxes(m,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._updateIconDebugCollisionBoxes(f,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,f,m,w,S,M,P,R){const z={};for(let V=a;V<f;V++){const G=i.get(V);z.textBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,padding:G.padding,projectedAnchorX:G.projectedAnchorX,projectedAnchorY:G.projectedAnchorY,projectedAnchorZ:G.projectedAnchorZ,tileAnchorX:G.tileAnchorX,tileAnchorY:G.tileAnchorY},z.textFeatureIndex=G.featureIndex;break}for(let V=m;V<w;V++){const G=i.get(V);z.verticalTextBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,padding:G.padding,projectedAnchorX:G.projectedAnchorX,projectedAnchorY:G.projectedAnchorY,projectedAnchorZ:G.projectedAnchorZ,tileAnchorX:G.tileAnchorX,tileAnchorY:G.tileAnchorY},z.verticalTextFeatureIndex=G.featureIndex;break}for(let V=S;V<M;V++){const G=i.get(V);z.iconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,padding:G.padding,projectedAnchorX:G.projectedAnchorX,projectedAnchorY:G.projectedAnchorY,projectedAnchorZ:G.projectedAnchorZ,tileAnchorX:G.tileAnchorX,tileAnchorY:G.tileAnchorY},z.iconFeatureIndex=G.featureIndex;break}for(let V=P;V<R;V++){const G=i.get(V);z.verticalIconBox={x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,padding:G.padding,projectedAnchorX:G.projectedAnchorX,projectedAnchorY:G.projectedAnchorY,projectedAnchorZ:G.projectedAnchorZ,tileAnchorX:G.tileAnchorX,tileAnchorY:G.tileAnchorY},z.verticalIconFeatureIndex=G.featureIndex;break}return z}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,a){const f=i.placedSymbolArray.get(a),m=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<m;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(i),f=Math.cos(i),m=[],w=[],S=[];for(let M=0;M<this.symbolInstances.length;++M){S.push(M);const P=this.symbolInstances.get(M);m.push(0|Math.round(a*P.tileAnchorX+f*P.tileAnchorY)),w.push(P.featureIndex)}return S.sort((M,P)=>m[M]-m[P]||w[P]-w[M]),S}addToSortKeyRanges(i,a){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===a?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const f=this.symbolInstances.get(a);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((m,w,S)=>{m>=0&&S.indexOf(m)===w&&this.addIndicesForPlacedSymbol(this.text,m)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}oe(ff,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ff.MAX_GLYPHS=65535,ff.addDynamicAttributes=Hy;const Bw=new Bn({"symbol-placement":new Ft(zt.layout_symbol["symbol-placement"]),"symbol-spacing":new Ft(zt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ft(zt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new bt(zt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ft(zt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ft(zt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ft(zt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ft(zt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ft(zt.layout_symbol["icon-rotation-alignment"]),"icon-size":new bt(zt.layout_symbol["icon-size"]),"icon-text-fit":new Ft(zt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ft(zt.layout_symbol["icon-text-fit-padding"]),"icon-image":new bt(zt.layout_symbol["icon-image"]),"icon-rotate":new bt(zt.layout_symbol["icon-rotate"]),"icon-padding":new Ft(zt.layout_symbol["icon-padding"]),"icon-keep-upright":new Ft(zt.layout_symbol["icon-keep-upright"]),"icon-offset":new bt(zt.layout_symbol["icon-offset"]),"icon-anchor":new bt(zt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ft(zt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ft(zt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ft(zt.layout_symbol["text-rotation-alignment"]),"text-field":new bt(zt.layout_symbol["text-field"]),"text-font":new bt(zt.layout_symbol["text-font"]),"text-size":new bt(zt.layout_symbol["text-size"]),"text-max-width":new bt(zt.layout_symbol["text-max-width"]),"text-line-height":new bt(zt.layout_symbol["text-line-height"]),"text-letter-spacing":new bt(zt.layout_symbol["text-letter-spacing"]),"text-justify":new bt(zt.layout_symbol["text-justify"]),"text-radial-offset":new bt(zt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ft(zt.layout_symbol["text-variable-anchor"]),"text-anchor":new bt(zt.layout_symbol["text-anchor"]),"text-max-angle":new Ft(zt.layout_symbol["text-max-angle"]),"text-writing-mode":new Ft(zt.layout_symbol["text-writing-mode"]),"text-rotate":new bt(zt.layout_symbol["text-rotate"]),"text-padding":new Ft(zt.layout_symbol["text-padding"]),"text-keep-upright":new Ft(zt.layout_symbol["text-keep-upright"]),"text-transform":new bt(zt.layout_symbol["text-transform"]),"text-offset":new bt(zt.layout_symbol["text-offset"]),"text-allow-overlap":new Ft(zt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ft(zt.layout_symbol["text-ignore-placement"]),"text-optional":new Ft(zt.layout_symbol["text-optional"])});var Bg={paint:new Bn({"icon-opacity":new bt(zt.paint_symbol["icon-opacity"]),"icon-color":new bt(zt.paint_symbol["icon-color"]),"icon-halo-color":new bt(zt.paint_symbol["icon-halo-color"]),"icon-halo-width":new bt(zt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new bt(zt.paint_symbol["icon-halo-blur"]),"icon-translate":new Ft(zt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ft(zt.paint_symbol["icon-translate-anchor"]),"text-opacity":new bt(zt.paint_symbol["text-opacity"]),"text-color":new bt(zt.paint_symbol["text-color"],{runtimeType:Eu,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new bt(zt.paint_symbol["text-halo-color"]),"text-halo-width":new bt(zt.paint_symbol["text-halo-width"]),"text-halo-blur":new bt(zt.paint_symbol["text-halo-blur"]),"text-translate":new Ft(zt.paint_symbol["text-translate"]),"text-translate-anchor":new Ft(zt.paint_symbol["text-translate-anchor"])}),layout:Bw};class B0{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:Fi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}oe(B0,"FormatSectionOverride",{omit:["defaultValue"]});class Ug extends Mc{constructor(i){super(i,Bg)}recalculate(i,a){super.recalculate(i,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const w of f)m.indexOf(w)<0&&m.push(w);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,a,f,m){const w=this.layout.get(i).evaluate(a,{},f,m),S=this._unevaluatedLayout._values[i];return S.isDataDriven()||ll(S.value)||!w?w:(M=a.properties,w.replace(/{([^{}]+)}/g,(R,z)=>z in M?String(M[z]):""));var M}createBucket(i){return new ff(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Bg.paint.overridableProperties){if(!Ug.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),f=new B0(a),m=new au(f,a.property.specification);let w=null;w="constant"===a.value.kind||"source"===a.value.kind?new Bu("source",m):new ws("composite",m,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new dn(a.property,w,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,f){return!(!this.layout||a.isDataDriven()||f.isDataDriven())&&Ug.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const f=i.get("text-field"),m=Bg.paint.properties[a];let w=!1;const S=M=>{for(const P of M)if(m.overrides&&m.overrides.hasOverride(P))return void(w=!0)};if("constant"===f.value.kind&&f.value.value instanceof $n)S(f.value.value.sections);else if("source"===f.value.kind){const M=R=>{w||(R instanceof Rr&&qn(R.value)===oa?S(R.value.sections):R instanceof ao?S(R.sections):R.eachChild(M))},P=f.value;P._styleExpression&&M(P._styleExpression.expression)}return w}getProgramConfiguration(i){return new Hl(this,i)}}var Wy={paint:new Bn({"background-color":new Ft(zt.paint_background["background-color"]),"background-pattern":new Nn(zt.paint_background["background-pattern"]),"background-opacity":new Ft(zt.paint_background["background-opacity"])})},Uw={paint:new Bn({"raster-opacity":new Ft(zt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ft(zt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ft(zt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ft(zt.paint_raster["raster-brightness-max"]),"raster-saturation":new Ft(zt.paint_raster["raster-saturation"]),"raster-contrast":new Ft(zt.paint_raster["raster-contrast"]),"raster-resampling":new Ft(zt.paint_raster["raster-resampling"]),"raster-fade-duration":new Ft(zt.paint_raster["raster-fade-duration"])})};class jw extends Mc{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Vw={paint:new Bn({"sky-type":new Ft(zt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ft(zt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ft(zt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ft(zt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ft(zt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Vn(zt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ft(zt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ft(zt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ft(zt.paint_sky["sky-opacity"])})};function Yy(s,i,a){const f=[0,0,1],m=ey([]);return sg(m,m,a?-le(s)+Math.PI:le(s)),Pv(m,m,-le(i)),Av(f,f,m),tl(f,f)}const Gw={circle:class extends Mc{constructor(s){super(s,Sl)}createBucket(s){return new Ev(s)}queryRadius(s){const i=s;return zf("circle-radius",this,i)+zf("circle-stroke-width",this,i)+yd(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,a,f,m,w,S,M){const P=Hm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return Lv(s,f,w,S,M,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),P,R)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Hl(this,s)}},heatmap:class extends Mc{createBucket(s){return new Nv(s)}constructor(s){super(s,Fv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=sy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return zf("heatmap-radius",this,s)}queryIntersectsFeature(s,i,a,f,m,w,S,M){const P=this.paint.get("heatmap-radius").evaluate(i,a);return Lv(s,f,w,S,M,!0,!0,new Q(0,0),P)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Hl(this,s)}},hillshade:class extends Mc{constructor(s){super(s,iS)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Mc{constructor(s){super(s,iw)}getProgramIds(){const s=this.paint.get("fill-pattern"),i=s&&s.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new Hl(this,s)}recalculate(s,i){super.recalculate(s,i);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new mg(s)}queryRadius(){return yd(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,a,f,m,w){return!s.queryGeometry.isAboveHorizon&&eg(qm(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends Mc{constructor(s){super(s,wg)}createBucket(s){return new jf(s)}queryRadius(){return yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Hl(this,s)}queryIntersectsFeature(s,i,a,f,m,w,S,M,P){const R=Hm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),z=this.paint.get("fill-extrusion-height").evaluate(i,a),V=this.paint.get("fill-extrusion-base").evaluate(i,a),G=[0,0],Z=M&&w.elevation,W=w.elevation?w.elevation.exaggeration():1,re=s.tile.getBucket(this);if(Z&&re instanceof jf){const Je=re.centroidVertexArray,at=P+1;if(at<Je.length){const Qe=Je.get(at);G[0]=Qe.a_centroid_pos0,G[1]=Qe.a_centroid_pos1}}if(0===G[0]&&1===G[1])return!1;"globe"===w.projection.name&&(f=Kv([f],[new Q(0,0),new Q(jr,jr)],s.tileID.canonical).map(Je=>Je.polygon).flat());const be=Z?M:null,[Xe,Ke]=(at=f,Qe=V,Ut=z,Ot=R,rn=S,In=be,Ht=G,an=W,ln=w.center.lat,"globe"===(Je=w).projection.name?function(Tn,Jt,Hn,Fr,er,yr,Yn,Gr,si,di,to){const ai=[],Ls=[],Mi=Tn.projection.upVectorScale(to,Tn.center.lat,Tn.worldSize).metersToTile,Ni=[0,0,0,1],co=[0,0,0,1],ys=(ni,ri,Ho,vu)=>{ni[0]=ri,ni[1]=Ho,ni[2]=vu,ni[3]=1},Es=Yv();Hn>0&&(Hn+=Es),Fr+=Es;for(const ni of Jt){const ri=[],Ho=[];for(const vu of ni){const Xo=vu.x+er.x,xa=vu.y+er.y,wa=Tn.projection.projectTilePoint(Xo,xa,to),io=Tn.projection.upVector(to,vu.x,vu.y);let Rs=Hn,Ga=Fr;if(Yn){const ss=t0(Xo,xa,Hn,Fr,Yn,Gr,si,di);Rs+=ss.base,Ga+=ss.top}0!==Hn?ys(Ni,wa.x+io[0]*Mi*Rs,wa.y+io[1]*Mi*Rs,wa.z+io[2]*Mi*Rs):ys(Ni,wa.x,wa.y,wa.z),ys(co,wa.x+io[0]*Mi*Ga,wa.y+io[1]*Mi*Ga,wa.z+io[2]*Mi*Ga),va(Ni,Ni,yr),va(co,co,yr),ri.push(new Id(Ni[0],Ni[1],Ni[2])),Ho.push(new Id(co[0],co[1],co[2]))}ai.push(ri),Ls.push(Ho)}return[ai,Ls]}(Je,at,Qe,Ut,Ot,rn,In,Ht,an,ln,s.tileID.canonical):In?function(Tn,Jt,Hn,Fr,er,yr,Yn,Gr,si){const di=[],to=[],ai=[0,0,0,1];for(const Ls of Tn){const Mi=[],Ni=[];for(const co of Ls){const ys=co.x+Fr.x,Es=co.y+Fr.y,ni=t0(ys,Es,Jt,Hn,yr,Yn,Gr,si);ai[0]=ys,ai[1]=Es,ai[2]=ni.base,ai[3]=1,gc(ai,ai,er),ai[3]=Math.max(ai[3],1e-5);const ri=new Id(ai[0]/ai[3],ai[1]/ai[3],ai[2]/ai[3]);ai[0]=ys,ai[1]=Es,ai[2]=ni.top,ai[3]=1,gc(ai,ai,er),ai[3]=Math.max(ai[3],1e-5);const Ho=new Id(ai[0]/ai[3],ai[1]/ai[3],ai[2]/ai[3]);Mi.push(ri),Ni.push(Ho)}di.push(Mi),to.push(Ni)}return[di,to]}(at,Qe,Ut,Ot,rn,In,Ht,an,ln):function(Tn,Jt,Hn,Fr,er){const yr=[],Yn=[],Gr=er[8]*Jt,si=er[9]*Jt,di=er[10]*Jt,to=er[11]*Jt,ai=er[8]*Hn,Ls=er[9]*Hn,Mi=er[10]*Hn,Ni=er[11]*Hn;for(const co of Tn){const ys=[],Es=[];for(const ni of co){const ri=ni.x+Fr.x,Ho=ni.y+Fr.y,vu=er[0]*ri+er[4]*Ho+er[12],Xo=er[1]*ri+er[5]*Ho+er[13],xa=er[2]*ri+er[6]*Ho+er[14],wa=er[3]*ri+er[7]*Ho+er[15],io=vu+Gr,Rs=Xo+si,Ga=xa+di,ss=Math.max(wa+to,1e-5),ho=vu+ai,Lu=Xo+Ls,xu=xa+Mi,lu=Math.max(wa+Ni,1e-5);ys.push(new Id(io/ss,Rs/ss,Ga/ss)),Es.push(new Id(ho/lu,Lu/lu,xu/lu))}yr.push(ys),Yn.push(Es)}return[yr,Yn]}(at,Qe,Ut,Ot,rn)),qe=s.queryGeometry;var Je,at,Qe,Ut,Ot,rn,In,Ht,an,ln;return function(Je,at,Qe){let Ut=1/0;eg(Qe,at)&&(Ut=_y(Qe,at[0]));for(let Ot=0;Ot<at.length;Ot++){const rn=at[Ot],In=Je[Ot];for(let Ht=0;Ht<rn.length-1;Ht++){const an=rn[Ht],ln=[an,rn[Ht+1],In[Ht+1],In[Ht],an];Cv(Qe,ln)&&(Ut=Math.min(Ut,_y(Qe,ln)))}}return Ut!==1/0&&Ut}(Xe,Ke,qe.isPointQuery()?qe.screenBounds:qe.screenGeometry)}},line:class extends Mc{constructor(s){super(s,vy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof ci,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=xy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new nf(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Hl(this,s)}queryRadius(s){const i=s,a=wy(zf("line-width",this,i),zf("line-gap-width",this,i)),f=zf("line-offset",this,i);return a/2+Math.abs(f)+yd(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,a,f,m,w){if(s.queryGeometry.isAboveHorizon)return!1;const S=qm(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),M=s.pixelToTileUnitsFactor/2*wy(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),P=this.paint.get("line-offset").evaluate(i,a);return P&&(f=function(R,z){const V=[],G=new Q(0,0);for(let Z=0;Z<R.length;Z++){const W=R[Z],re=[];for(let be=0;be<W.length;be++){const Xe=W[be-1],Ke=W[be],qe=W[be+1],Je=0===be?G:Ke.sub(Xe)._unit()._perp(),at=be===W.length-1?G:qe.sub(Ke)._unit()._perp(),Qe=Je._add(at)._unit();Qe._mult(1/(Qe.x*at.x+Qe.y*at.y)),re.push(Qe._mult(z)._add(Ke))}V.push(re)}return V}(f,P*s.pixelToTileUnitsFactor)),function(R,z,V){for(let G=0;G<z.length;G++){const Z=z[G];if(R.length>=3)for(let W=0;W<Z.length;W++)if(md(R,Z[W]))return!0;if(rS(R,Z,V))return!0}return!1}(S,f,M)}isTileClipped(){return!0}},symbol:Ug,background:class extends Mc{constructor(s){super(s,Wy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Mc{constructor(s){super(s,Uw)}getProgramIds(){return["raster"]}},sky:class extends Mc{constructor(s){super(s,Vw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=sy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(s,i){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),m=!f,w=s.style.light,S=w.properties.get("position");return m&&"viewport"===w.properties.get("anchor")&&zn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Yy(S.azimuthal,90-S.polar,i):Yy(f[0],90-f[1],i)}const a=this.paint.get("sky-gradient-center");return Yy(a[0],90-a[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class Ml{constructor(i,a,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(a,m)}update(i,a,f){const{width:m,height:w}=i,{context:S}=this,{gl:M}=S,{HTMLImageElement:P,HTMLCanvasElement:R,HTMLVideoElement:z,ImageData:V,ImageBitmap:G}=Ce;if(M.bindTexture(M.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===M.RGBA&&(!a||!1!==a.premultiply)),f||this.size&&this.size[0]===m&&this.size[1]===w){const{x:Z,y:W}=f||{x:0,y:0};i instanceof P||i instanceof R||i instanceof z||i instanceof V||G&&i instanceof G?M.texSubImage2D(M.TEXTURE_2D,0,Z,W,M.RGBA,M.UNSIGNED_BYTE,i):M.texSubImage2D(M.TEXTURE_2D,0,Z,W,m,w,M.RGBA,M.UNSIGNED_BYTE,i.data)}else this.size=[m,w],i instanceof P||i instanceof R||i instanceof z||i instanceof V||G&&i instanceof G?M.texImage2D(M.TEXTURE_2D,0,this.format,this.format,M.UNSIGNED_BYTE,i):M.texImage2D(M.TEXTURE_2D,0,this.format,m,w,0,this.format,M.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&M.generateMipmap(M.TEXTURE_2D)}bind(i,a){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:i),this.filter=i),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Ky{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class $w{constructor(){this.tasks={},this.taskQueue=[],Mn(["process"],this),this.invoker=new Ky(this.process),this.nextId=0}add(i,a){const f=this.nextId++,m=function({type:w,isSymbolTile:S,zoom:M}){return M=M||0,"message"===w?0:"maybePrepare"!==w||S?"parseTile"!==w||S?"parseTile"===w&&S?300-M:"maybePrepare"===w&&S?400-M:500:200-M:100-M}(a);if(0===m){Jr();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:i,metadata:a,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){Jr();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){const w=this.tasks[this.taskQueue[m]];w.priority<a&&(a=w.priority,i=m)}if(null===i)return null;const f=this.taskQueue[i];return this.taskQueue.splice(i,1),f}remove(){this.invoker.remove()}}class U0{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const f=i[a];this._stringToNumber[f]=a,this._numberToString[a]=f}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const j0=["tile","layer","source","sourceLayer","state"];class V0{constructor(i,a,f,m,w){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=f,this._y=m,this.properties=i.properties,this.id=w}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const a of j0)void 0!==this[a]&&(i[a]=this[a]);return i}}const ah=new Uint16Array(8184);for(let s=0;s<2046;s++){let i=s+2,a=0,f=0,m=0,w=0,S=0,M=0;for(1&i?m=w=S=32:a=f=M=32;(i>>=1)>1;){const R=a+m>>1,z=f+w>>1;1&i?(m=a,w=f,a=S,f=M):(a=m,f=w,m=S,w=M),S=R,M=z}const P=4*s;ah[P+0]=a,ah[P+1]=f,ah[P+2]=m,ah[P+3]=w}const uh=new Uint16Array(2178),df=new Uint8Array(1089),Xf=new Uint16Array(1089);function jg(s){return 0===s?-.03125:32===s?.03125:0}var Ip=Un([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const qw={type:2,extent:jr,loadGeometry:()=>[[new Q(0,0),new Q(8193,0),new Q(8193,8193),new Q(0,8193),new Q(0,0)]]};class Tp{constructor(i,a,f,m,w){this.tileID=i,this.uid=vt(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<ji.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=lf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,f){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,w){const S={};if(!w)return S;for(const M of m){const P=M.layerIds.map(R=>w.getLayer(R)).filter(Boolean);if(0!==P.length){M.layers=P,M.stateDependentLayerIds&&(M.stateDependentLayers=M.stateDependentLayerIds.map(R=>P.filter(z=>z.id===R)[0]));for(const R of P)S[R.id]=M}}return S}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const w=this.buckets[m];if(w instanceof ff){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const w=this.buckets[m];if(w instanceof ff&&w.hasRTLText){this.hasRTLText=!0,rt.isLoading()||rt.isLoaded()||"deferred"!==Ae()||et();break}}this.queryPadding=0;for(const m in this.buckets){const w=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(w))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Rm}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Ml(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Ml(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Ml(i,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,f,m,w,S,M,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:M,transform:S,params:w,tileTransform:this.tileTransform},i,a,f):{}}querySourceFeatures(i,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),w=a?a.sourceLayer:"",S=m._geojsonTileLayer||m[w];if(!S)return;const M=Zc(a&&a.filter),{z:P,x:R,y:z}=this.tileID.canonical,V={z:P,x:R,y:z};for(let G=0;G<S.length;G++){const Z=S.feature(G);if(M.needGeometry){const be=Kh(Z,!0);if(!M.filter(new Ze(this.tileID.overscaledZ),be,this.tileID.canonical))continue}else if(!M.filter(new Ze(this.tileID.overscaledZ),Z))continue;const W=f.getId(Z,w),re=new V0(Z,P,R,z,W);re.tile=V,i.push(re)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const f=ki(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const w=this.expirationTime-a;w?this.expirationTime=f+Math.max(w,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!a)return;const f=this.latestFeatureIndex.loadVTLayers(),m=a.style.listImages();for(const w in this.buckets){if(!a.style.hasLayer(w))continue;const S=this.buckets[w],M=S.layers[0].sourceLayer||"_geojsonTileLayer",P=f[M],R=i[M];if(!P||!R||0===Object.keys(R).length)continue;if(S.update(R,P,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),S instanceof nf||S instanceof mg){const V=a.style._getSourceCache(S.layers[0].source);a._terrain&&a._terrain.enabled&&V&&S.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(V.id,this.tileID)}const z=a&&a.style&&a.style.getLayer(w);z&&(this.queryPadding=Math.max(this.queryPadding,z.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ji.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=ji.now()+i}setTexture(i,a){const f=a.context,m=f.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new Ml(f,i,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),f.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax))}setDependencies(i,a){const f={};for(const m of a)f[m]=!0;this.dependencies[i]=f}hasDependency(i,a){for(const f of i){const m=this.dependencies[f];if(m)for(const w of a)if(m[w])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const f=wh(qw,this.tileID.canonical,this.tileTransform)[0],m=new wi,w=new hd;for(let S=0;S<f.length;S++){const{x:M,y:P}=f[S];m.emplaceBack(M,P),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(m,Gf.members),this._tileDebugSegments=_a.simpleSegment(0,0,m.length,w.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const f=wh(qw,this.tileID.canonical,this.tileTransform)[0];let m,w;if(this.isRaster){const S=function(M,P){const R=lf(M,P),z=Math.pow(2,M.z);for(let be=0;be<33;be++)for(let Xe=0;Xe<33;Xe++){const Ke=Zl((M.x+(Xe+jg(Xe))/32)/z),qe=La((M.y+(be+jg(be))/32)/z),Je=P.project(Ke,qe),at=33*be+Xe;uh[2*at+0]=Math.round((Je.x*R.scale-R.x)*jr),uh[2*at+1]=Math.round((Je.y*R.scale-R.y)*jr)}df.fill(0),Xf.fill(0);for(let be=2045;be>=0;be--){const Xe=4*be,Ke=ah[Xe+0],qe=ah[Xe+1],Je=ah[Xe+2],at=ah[Xe+3],Qe=Ke+Je>>1,Ut=qe+at>>1,Ot=Qe+Ut-qe,rn=Ut+Ke-Qe,In=33*qe+Ke,Ht=33*at+Je,an=33*Ut+Qe,ln=Math.hypot((uh[2*In+0]+uh[2*Ht+0])/2-uh[2*an+0],(uh[2*In+1]+uh[2*Ht+1])/2-uh[2*an+1])>=16;if(df[an]=df[an]||(ln?1:0),be<1022){const _n=33*(qe+rn>>1)+(Ke+Ot>>1),Tn=33*(at+rn>>1)+(Je+Ot>>1);df[an]=df[an]||df[_n]||df[Tn]}}const V=new ms,G=new Du;let Z=0;function W(be,Xe){const Ke=33*Xe+be;return 0===Xf[Ke]&&(V.emplaceBack(uh[2*Ke+0],uh[2*Ke+1],be*jr/32,Xe*jr/32),Xf[Ke]=++Z),Xf[Ke]-1}function re(be,Xe,Ke,qe,Je,at){const Qe=be+Ke>>1,Ut=Xe+qe>>1;if(Math.abs(be-Je)+Math.abs(Xe-at)>1&&df[33*Ut+Qe])re(Je,at,be,Xe,Qe,Ut),re(Ke,qe,Je,at,Qe,Ut);else{const Ot=W(be,Xe),rn=W(Ke,qe),In=W(Je,at);G.emplaceBack(Ot,rn,In)}}return re(0,0,32,32,32,0),re(32,32,0,0,0,32),{vertices:V,indices:G}}(this.tileID.canonical,a);m=S.vertices,w=S.indices}else{m=new ms,w=new Du;for(const{x:M,y:P}of f)m.emplaceBack(M,P,0,0);const S=wd.exports(m.int16,void 0,4);for(let M=0;M<S.length;M+=3)w.emplaceBack(S[M],S[M+1],S[M+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,Ip.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=_a.simpleSegment(0,0,m.length,w.length)}_makeGlobeTileDebugBuffers(i,a){const f=a.projection;if(!f||"globe"!==f.name||a.freezeTileCoverage)return;const m=this.tileID.canonical,w=Fd(A0(m,a)),S=uf(a.zoom);let M;S>0&&(M=Zm(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,a,w,M,S),this._makeGlobeTileDebugTextBuffer(i,m,a,w,M,S)}_globePoint(i,a,f,m,w,S,M){let P=kd(i,a,f);if(S){const R=1<<f.z,z=Xl(m.center.lng),V=Dc(m.center.lat),G=(f.x+.5)/R-z;let Z=0;G>.5?Z=-1:G<-.5&&(Z=1);let W=(i/jr+f.x)/R+Z,re=(a/jr+f.y)/R;W=(W-z)*m._pixelsPerMercatorPixel+z,re=(re-V)*m._pixelsPerMercatorPixel+V;const be=[W*m.worldSize,re*m.worldSize,0];va(be,be,S),P=ih(P,be,M)}return va(P,P,w)}_makeGlobeTileDebugBorderBuffer(i,a,f,m,w,S){const M=new wi,P=new hd,R=new $o,z=(G,Z,W,re,be)=>{const Xe=(W-G)/(be-1),Ke=(re-Z)/(be-1),qe=M.length;for(let Je=0;Je<be;Je++){const at=G+Je*Xe,Qe=Z+Je*Ke;M.emplaceBack(at,Qe);const Ut=this._globePoint(at,Qe,a,f,m,w,S);R.emplaceBack(Ut[0],Ut[1],Ut[2]),P.emplaceBack(qe+Je)}},V=jr;z(0,0,V,0,16),z(V,0,V,V,16),z(V,V,0,V,16),z(0,V,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(P),this._tileDebugBuffer=i.createVertexBuffer(M,Gf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(R,Lg.members),this._tileDebugSegments=_a.simpleSegment(0,0,M.length,P.length)}_makeGlobeTileDebugTextBuffer(i,a,f,m,w,S){const M=new wi,P=new Du,R=new $o,z=25;P.reserve(32),M.reserve(z),R.reserve(z);const V=(G,Z)=>z*G+Z;for(let G=0;G<z;G++){const Z=2048*G;for(let W=0;W<z;W++){const re=2048*W;M.emplaceBack(re,Z);const be=this._globePoint(re,Z,a,f,m,w,S);R.emplaceBack(be[0],be[1],be[2])}}for(let G=0;G<4;G++)for(let Z=0;Z<4;Z++){const W=V(G,Z),re=V(G,Z+1),be=V(G+1,Z),Xe=V(G+1,Z+1);P.emplaceBack(W,re,be),P.emplaceBack(be,re,Xe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(P),this._tileDebugTextBuffer=i.createVertexBuffer(M,Gf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(R,Lg.members),this._tileDebugTextSegments=_a.simpleSegment(0,0,z,32)}}class gS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,f){const m=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},Ee(this.stateChanges[i][m],f),null===this.deletedStates[i]){this.deletedStates[i]={};for(const w in this.state[i])w!==m&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][m]){this.deletedStates[i][m]={};for(const w in this.state[i][m])f[w]||(this.deletedStates[i][m][w]=null)}else for(const w in f)this.deletedStates[i]&&this.deletedStates[i][m]&&null===this.deletedStates[i][m][w]&&delete this.deletedStates[i][m][w]}removeFeatureState(i,a,f){if(null===this.deletedStates[i])return;const m=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&void 0!==a)null!==this.deletedStates[i][m]&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(void 0!==a)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,a){const f=String(a),m=Ee({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const w=this.deletedStates[i][a];if(null===w)return{};for(const S in w)delete m[S]}return m}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const w={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Ee(this.state[m][S],this.stateChanges[m][S]),w[S]=this.state[m][S];f[m]=w}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const w={};if(null===this.deletedStates[m])for(const S in this.state[m])w[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(null===this.deletedStates[m][S])this.state[m][S]={};else for(const M of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][M];w[S]=this.state[m][S]}f[m]=f[m]||{},Ee(f[m],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const m in i)i[m].setFeatureState(f,a)}}class Jy{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const f=this.toIdx(i,a);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function Qy(s,i,a,f){let m=0,w=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(f[S])<1e-15){if(a[S]<s[S]||a[S]>i[S])return null}else{const M=1/f[S];let P=(s[S]-a[S])*M,R=(i[S]-a[S])*M;if(P>R){const z=P;P=R,R=z}if(P>m&&(m=P),R<w&&(w=R),m>w)return null}return m}function e_(s,i,a,f,m,w,S,M,P,R,z){const V=f-s,G=m-i,Z=w-a,W=S-s,re=M-i,be=P-a,Xe=z[1]*be-z[2]*re,Ke=z[2]*W-z[0]*be,qe=z[0]*re-z[1]*W,Je=V*Xe+G*Ke+Z*qe;if(Math.abs(Je)<1e-15)return null;const at=1/Je,Qe=R[0]-s,Ut=R[1]-i,Ot=R[2]-a,rn=(Qe*Xe+Ut*Ke+Ot*qe)*at;if(rn<0||rn>1)return null;const In=Ut*Z-Ot*G,Ht=Ot*V-Qe*Z,an=Qe*G-Ut*V,ln=(z[0]*In+z[1]*Ht+z[2]*an)*at;return ln<0||rn+ln>1?null:(W*In+re*Ht+be*an)*at}function t_(s,i,a){return(s-i)/(a-i)}function Vg(s,i,a,f,m,w,S,M,P){const R=1<<a,z=w-f,V=S-m,G=(s+1)/R*z+f,Z=(i+0)/R*V+m,W=(i+1)/R*V+m;M[0]=(s+0)/R*z+f,M[1]=Z,P[0]=G,P[1]=W}class lh{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(w){const S=Math.ceil(Math.log2(w.dim/8)),M=[];let P=Math.ceil(Math.pow(2,S));const R=1/P,z=(Z,W,re,be,Xe)=>{const Ke=be?1:0,qe=(Z+1)*re-Ke,Je=W*re,at=(W+1)*re-Ke;Xe[0]=Z*re,Xe[1]=Je,Xe[2]=qe,Xe[3]=at};let V=new Jy(P);const G=[];for(let Z=0;Z<P*P;Z++){z(Z%P,Math.floor(Z/P),R,!1,G);const W=Fc(G[0],G[1],w),re=Fc(G[2],G[1],w),be=Fc(G[2],G[3],w),Xe=Fc(G[0],G[3],w);V.minimums.push(Math.min(W,re,be,Xe)),V.maximums.push(Math.max(W,re,be,Xe)),V.leaves.push(1)}for(M.push(V),P/=2;P>=1;P/=2){const Z=M[M.length-1];V=new Jy(P);for(let W=0;W<P*P;W++){z(W%P,Math.floor(W/P),2,!0,G);const re=Z.getElevation(G[0],G[1]),be=Z.getElevation(G[2],G[1]),Xe=Z.getElevation(G[2],G[3]),Ke=Z.getElevation(G[0],G[3]),qe=Z.isLeaf(G[0],G[1]),Je=Z.isLeaf(G[2],G[1]),at=Z.isLeaf(G[2],G[3]),Qe=Z.isLeaf(G[0],G[3]),Ut=Math.min(re.min,be.min,Xe.min,Ke.min),Ot=Math.max(re.max,be.max,Xe.max,Ke.max),rn=qe&&Je&&at&&Qe;V.maximums.push(Ot),V.minimums.push(Ut),V.leaves.push(Ot-Ut<=5&&rn?1:0)}M.push(V)}return M}(this.dem),f=a.length-1,m=a[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,f,0)}raycastRoot(i,a,f,m,w,S,M=1){return Qy([i,a,-100],[f,m,this.maximums[0]*M],w,S)}raycast(i,a,f,m,w,S,M=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,a,f,m,w,S,M);if(null==P)return null;const R=[],z=[],V=[],G=[],Z=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;Z.length>0;){const{idx:W,t:re,nodex:be,nodey:Xe,depth:Ke}=Z.pop();if(this.leaves[W]){Vg(be,Xe,Ke,i,a,f,m,V,G);const Je=1<<Ke,at=(be+0)/Je,Qe=(be+1)/Je,Ut=(Xe+0)/Je,Ot=(Xe+1)/Je,rn=Fc(at,Ut,this.dem)*M,In=Fc(Qe,Ut,this.dem)*M,Ht=Fc(Qe,Ot,this.dem)*M,an=Fc(at,Ot,this.dem)*M,ln=e_(V[0],V[1],rn,G[0],V[1],In,G[0],G[1],Ht,w,S),_n=e_(G[0],G[1],Ht,V[0],G[1],an,V[0],V[1],rn,w,S),Tn=Math.min(null!==ln?ln:Number.MAX_VALUE,null!==_n?_n:Number.MAX_VALUE);if(Tn!==Number.MAX_VALUE)return Tn;{const Jt=xd([],w,S,re);if(Mp(rn,In,an,Ht,t_(Jt[0],V[0],G[0]),t_(Jt[1],V[1],G[1]))>=Jt[2])return re}continue}let qe=0;for(let Je=0;Je<this._siblingOffset.length;Je++){Vg((be<<1)+this._siblingOffset[Je][0],(Xe<<1)+this._siblingOffset[Je][1],Ke+1,i,a,f,m,V,G),V[2]=-100,G[2]=this.maximums[this.childOffsets[W]+Je]*M;const at=Qy(V,G,w,S);if(null!=at){const Qe=at;R[Je]=Qe;let Ut=!1;for(let Ot=0;Ot<qe&&!Ut;Ot++)Qe>=R[z[Ot]]&&(z.splice(Ot,0,Je),Ut=!0);Ut||(z[qe]=Je),qe++}}for(let Je=0;Je<qe;Je++){const at=z[Je];Z.push({idx:this.childOffsets[W]+at,t:R[at],nodex:(be<<1)+this._siblingOffset[at][0],nodey:(Xe<<1)+this._siblingOffset[at][1],depth:Ke+1})}}return null}_addNode(i,a,f){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,f,m,w){if(1===i[m].isLeaf(a,f))return;this.childOffsets[w]||(this.childOffsets[w]=this.nodeCount);const S=m-1,M=i[S];let P=0,R=0;for(let z=0;z<this._siblingOffset.length;z++){const V=2*a+this._siblingOffset[z][0],G=2*f+this._siblingOffset[z][1],Z=M.getElevation(V,G),W=M.isLeaf(V,G),re=this._addNode(Z.min,Z.max,W);W&&(P|=1<<z),R||(R=re)}for(let z=0;z<this._siblingOffset.length;z++)P&1<<z||this._construct(i,2*a+this._siblingOffset[z][0],2*f+this._siblingOffset[z][1],S,R+z)}}function Mp(s,i,a,f,m,w){return Ii(Ii(s,a,w),Ii(i,f,w),m)}function Fc(s,i,a){const f=a.dim,m=ue(s*f-.5,0,f-1),w=ue(i*f-.5,0,f-1),S=Math.floor(m),M=Math.floor(w),P=Math.min(S+1,f-1),R=Math.min(M+1,f-1);return Mp(a.get(S,M),a.get(P,M),a.get(S,R),a.get(P,R),m-S,w-M)}const Bd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class Gg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,f,m=!1,w=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return zn(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const S=this.dim=a.height-2,M=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=f||"mapbox",this.borderReady=m,!m){for(let P=0;P<S;P++)M[this._idx(-1,P)]=M[this._idx(0,P)],M[this._idx(S,P)]=M[this._idx(S-1,P)],M[this._idx(P,-1)]=M[this._idx(P,0)],M[this._idx(P,S)]=M[this._idx(P,S-1)];M[this._idx(-1,-1)]=M[this._idx(0,0)],M[this._idx(S,-1)]=M[this._idx(S-1,0)],M[this._idx(-1,S)]=M[this._idx(0,S-1)],M[this._idx(S,S)]=M[this._idx(S-1,S-1)],w&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new lh(this)}get(i,a,f=!1){f&&(i=ue(i,-1,this.dim),a=ue(a,-1,this.dim));const m=4*this._idx(i,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(i){return Bd[i]}get unpackVector(){return Bd[this.encoding]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}_unpackMapbox(i,a,f){return(256*i*256+256*a+f)/10-1e4}_unpackTerrarium(i,a,f){return 256*i+a+f/256-32768}static pack(i,a){const f=[0,0,0,0],m=Gg.getUnpackVector(a);let w=Math.floor((i+m[3])/m[2]);return f[2]=w%256,w=Math.floor(w/256),f[1]=w%256,w=Math.floor(w/256),f[0]=w,f}getPixels(){return new pl({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,w=a*this.dim+this.dim,S=f*this.dim,M=f*this.dim+this.dim;switch(a){case-1:m=w-1;break;case 1:w=m+1}switch(f){case-1:S=M-1;break;case 1:M=S+1}const P=-a*this.dim,R=-f*this.dim;for(let z=S;z<M;z++)for(let V=m;V<w;V++){const G=4*this._idx(V,z),Z=4*this._idx(V+P,z+R);this.pixels[G+0]=i.pixels[Z+0],this.pixels[G+1]=i.pixels[Z+1],this.pixels[G+2]=i.pixels[Z+2],this.pixels[G+3]=i.pixels[Z+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}oe(Gg,"DEMData"),oe(lh,"DemMinMaxQuadTree",{omit:["dem"]});class G0{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,f){const m=i.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const w={value:a,timeout:void 0};if(void 0!==f&&(w.timeout=setTimeout(()=>{this.remove(i,w)},f)),this.data[m].push(w),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const f=i.wrapped().key,m=void 0===a?0:this.data[f].indexOf(a),w=this.data[f][m];return this.data[f].splice(m,1),w.timeout&&clearTimeout(w.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||a.push(m);for(const f of a)this.remove(f.value.tileID,f)}}class Zf{constructor(i,a,f){this.func=i,this.mask=a,this.range=f}}Zf.ReadOnly=!1,Zf.ReadWrite=!0,Zf.disabled=new Zf(519,Zf.ReadOnly,[0,1]);class r_{constructor(i,a,f,m,w,S){this.test=i,this.ref=a,this.mask=f,this.fail=m,this.depthFail=w,this.pass=S}}r_.disabled=new r_({func:519,mask:0},0,0,7680,7680,7680);class Dl{constructor(i,a,f){this.blendFunction=i,this.blendColor=a,this.mask=f}}Dl.Replace=[1,0],Dl.disabled=new Dl(Dl.Replace,wt.transparent,[!1,!1,!1,!1]),Dl.unblended=new Dl(Dl.Replace,wt.transparent,[!0,!0,!0,!0]),Dl.alphaBlended=new Dl([1,771],wt.transparent,[!0,!0,!0,!0]);class zc{constructor(i,a,f){this.enable=i,this.mode=a,this.frontFace=f}}zc.disabled=new zc(!1,1029,2305),zc.backCCW=new zc(!0,1029,2305),zc.backCW=new zc(!0,1029,2304),zc.frontCW=new zc(!0,1028,2304),zc.frontCCW=new zc(!0,1028,2305);class Wf extends ia{constructor(i,a,f){super(),this.id=i,this._onlySymbols=f,a.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new G0(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new gS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return gt(this._tiles).map(i=>i.tileID).sort(q0).map(i=>i.key)}getRenderableIds(i){const a=[];for(const f in this._tiles)this._isIdRenderable(+f,i)&&a.push(this._tiles[f]);return i?a.sort((f,m)=>{const w=f.tileID,S=m.tileID,M=new Q(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),P=new Q(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||P.y-M.y||P.x-M.x}).map(f=>f.tileID.key):a.map(f=>f.tileID).sort(q0).map(f=>f.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const f=this._tiles[i];f&&("loading"!==f.state&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,i,a)))}_tileLoaded(i,a,f,m){if(m)if(i.state="errored",404!==m.status)this._source.fire(new ks(m,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=ji.now(),"expired"===f&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new Gi("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const w=a[m];if(i.neighboringTiles&&i.neighboringTiles[w]){const S=this.getTileByID(w);f(i,S),f(S,i)}}function f(m,w){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-m.tileID.canonical.x;const M=w.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),R=w.tileID.key;0===S&&0===M||Math.abs(M)>1||(Math.abs(S)>1&&(1===Math.abs(S+P)?S+=P:1===Math.abs(S-P)&&(S-=P)),w.dem&&m.dem&&(m.dem.backfillBorder(w.dem,S,M),m.neighboringTiles&&m.neighboringTiles[R]&&(m.neighboringTiles[R].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,f,m){for(const w in this._tiles){let S=this._tiles[w];if(m[w]||!S.hasData()||S.tileID.overscaledZ<=a||S.tileID.overscaledZ>f)continue;let M=S.tileID;for(;S&&S.tileID.overscaledZ>a+1;){const R=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[R.key],S&&S.hasData()&&(M=R)}let P=M;for(;P.overscaledZ>a;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]){m[M.key]=M;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=i.overscaledZ-1;f>=a;f--){const m=i.scaledTo(f),w=this._getLoadedTile(m);if(w)return w}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const f=Math.ceil(i.width/a)+1,m=Math.ceil(i.height/a)+1,w=Math.floor(f*m*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,w):w,M="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(M)}handleWrapJump(i){const a=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,a){const f={};for(const m in this._tiles){const w=this._tiles[m];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),f[w.tileID.key]=w}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,a,f){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let m;this.updateCacheSize(i,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(M=>new es(M.canonical.z,M.wrap,M.canonical.z,M.canonical.x,M.canonical.y)):(m=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(M=>this._source.hasTile(M)))):m=[];const w=this._updateRetainedTiles(m);if(H0(this._source.type)&&0!==m.length){const M={},P={},R=Object.keys(w);for(const V of R){const G=w[V],Z=this._tiles[V];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=ji.now())continue;const W=this.findLoadedParent(G,Math.max(G.overscaledZ-Wf.maxOverzooming,this._source.minzoom));W&&(this._addTile(W.tileID),M[W.tileID.key]=W.tileID),P[V]=G}const z=m[m.length-1].overscaledZ;for(const V in this._tiles){const G=this._tiles[V];if(w[V]||!G.hasData())continue;let Z=G.tileID;for(;Z.overscaledZ>z;){Z=Z.scaledTo(Z.overscaledZ-1);const W=this._tiles[Z.key];if(W&&W.hasData()&&P[Z.key]){w[V]=G.tileID;break}}}for(const V in M)w[V]||(this._coveredTiles[V]=!0,w[V]=M[V])}for(const M in w)this._tiles[M].clearFadeHold();const S=function(M,P){const R=[];for(const z in M)z in P||R.push(z);return R}(this._tiles,w);for(const M of S){const P=this._tiles[M];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+M)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(0===i.length)return a;const f={},m=i.reduce((R,z)=>Math.min(R,z.overscaledZ),1/0),w=i[0].overscaledZ,S=Math.max(w-Wf.maxOverzooming,this._source.minzoom),M=Math.max(w+Wf.maxUnderzooming,this._source.minzoom),P={};for(const R of i){const z=this._addTile(R);a[R.key]=R,z.hasData()||m<this._source.maxzoom&&(P[R.key]=R)}this._retainLoadedChildren(P,m,M,a);for(const R of i){let z=this._tiles[R.key];if(z.hasData())continue;if(R.canonical.z>=this._source.maxzoom){const G=R.children(this._source.maxzoom)[0],Z=this.getTile(G);if(Z&&Z.hasData()){a[G.key]=G;continue}}else{const G=R.children(this._source.maxzoom);if(a[G[0].key]&&a[G[1].key]&&a[G[2].key]&&a[G[3].key])continue}let V=z.wasRequested();for(let G=R.overscaledZ-1;G>=S;--G){const Z=R.scaledTo(G);if(f[Z.key]||(f[Z.key]=!0,z=this.getTile(Z),!z&&V&&(z=this._addTile(Z)),z&&(a[Z.key]=Z,V=z.wasRequested(),z.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}a.push(m.key);const w=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;m=w}for(const w of a)this._loadedParentTiles[w]=f}}_addTile(i){let a=this._tiles[i.key];if(a)return a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const f=Boolean(a);if(!f){const m=this.map?this.map.painter:null;a=new Tp(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,f||this._source.fire(new Gi("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=a.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,f){const m=[],w=this.transform;if(!w)return m;const S="globe"===w.projection.name,M=Xl(w.center.lng);for(const P in this._tiles){const R=this._tiles[P];if(f&&R.clearQueryDebugViz(),R.holdingForFade())continue;let z;if(S){const V=R.tileID.canonical;if(0===V.z){const G=[Math.abs(ue(M,...Dp(V,-1))-M),Math.abs(ue(M,...Dp(V,1))-M)];z=[0,2*G.indexOf(Math.min(...G))-1]}else{const G=[Math.abs(ue(M,...Dp(V,-1))-M),Math.abs(ue(M,...Dp(V,0))-M),Math.abs(ue(M,...Dp(V,1))-M)];z=[G.indexOf(Math.min(...G))-1]}}else z=[0];for(const V of z){const G=i.containsTile(R,w,a,V);G&&m.push(G)}}return m}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of a)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(H0(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=ji.now())return!0}return!1}setFeatureState(i,a,f){this._state.updateState(i=i||"_geojsonTileLayer",a,f)}removeFeatureState(i,a,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,f)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,f){const m=this._tiles[i];m&&m.setDependencies(a,f)}reloadTilesForDependencies(i,a){for(const f in this._tiles)this._tiles[f].hasDependency(i,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(i,a))}_preloadTiles(i,a){const f=new Map,m=Array.isArray(i)?i:[i],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const M of m){const P=M.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const R of P)f.set(R.key,R);this.usedForTerrain&&M.updateElevation(!1)}Ne(Array.from(f.values()),(M,P)=>{const R=new Tp(M,this._source.tileSize*M.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(R,z=>{"raster-dem"===this._source.type&&R.dem&&this._backfillDEM(R),P(z,R)})},a)}}function q0(s,i){const a=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return s.overscaledZ-i.overscaledZ||f-a||i.canonical.y-s.canonical.y||i.canonical.x-s.canonical.x}function H0(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function Dp(s,i){const a=1<<s.z;return[s.x/a+i,(s.x+1)/a+i]}Wf.maxOverzooming=10,Wf.maxUnderzooming=3;class $g{constructor(i,a,f){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=f}static create(i,a,f){const m=f||i.findDEMTileFor(a);if(!m||!m.dem)return;const w=m.dem,S=m.tileID,M=1<<a.canonical.z-S.canonical.z;return new $g(m,m.tileSize/jr/M,[(a.canonical.x/M-S.canonical.x)*w.dim,(a.canonical.y/M-S.canonical.y)*w.dim])}tileCoordToPixel(i,a){const f=a*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),w=Math.floor(f);return new Q(m,w)}getElevationAt(i,a,f,m){const w=i*this._scale+this._offset[0],S=a*this._scale+this._offset[1],M=Math.floor(w),P=Math.floor(S),R=this._dem;return m=!!m,f?Ii(Ii(R.get(M,P,m),R.get(M,P+1,m),S-P),Ii(R.get(M+1,P,m),R.get(M+1,P+1,m),S-P),w-M):R.get(M,P,m)}getElevationAtPixel(i,a,f){return this._dem.get(i,a,!!f)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*fc(1,i)*this._dem.stride}}class X0{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new F(jr,16,0),this.featureIndexArray=new Nf,this.promoteId=a}insert(i,a,f,m,w,S=0){const M=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,w,S);const P=this.grid;for(let R=0;R<a.length;R++){const z=a[R],V=[1/0,1/0,-1/0,-1/0];for(let G=0;G<z.length;G++){const Z=z[G];V[0]=Math.min(V[0],Z.x),V[1]=Math.min(V[1],Z.y),V[2]=Math.max(V[2],Z.x),V[3]=Math.max(V[3],Z.y)}V[0]<jr&&V[1]<jr&&V[2]>=0&&V[3]>=0&&P.insert(M,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Lc(new sf(this.rawTileData)).layers,this.sourceLayerCoder=new U0(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a,f,m){this.loadVTLayers();const w=i.params||{},S=Zc(w.filter),M=i.tileResult,P=i.transform,R=M.bufferedTilespaceBounds,z=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,(W,re,be,Xe)=>Yx(M.bufferedTilespaceGeometry,W,re,be,Xe));z.sort(Z0);let V=null;P.elevation&&z.length>0&&(V=$g.create(P.elevation,this.tileID));const G={};let Z;for(let W=0;W<z.length;W++){const re=z[W];if(re===Z)continue;Z=re;const be=this.featureIndexArray.get(re);let Xe=null;this.loadMatchingFeature(G,be,S,w.layers,w.availableImages,a,f,m,(Ke,qe,Je,at=0)=>(Xe||(Xe=wh(Ke,this.tileID.canonical,i.tileTransform)),qe.queryIntersectsFeature(M,Ke,Je,Xe,this.z,i.transform,i.pixelPosMatrix,V,at)))}return G}loadMatchingFeature(i,a,f,m,w,S,M,P,R){const{featureIndex:z,bucketIndex:V,sourceLayerIndex:G,layoutVertexArrayOffset:Z}=a,W=this.bucketLayerIDs[V];if(m&&!function(Ke,qe){for(let Je=0;Je<Ke.length;Je++)if(qe.indexOf(Ke[Je])>=0)return!0;return!1}(m,W))return;const re=this.sourceLayerCoder.decode(G),be=this.vtLayers[re].feature(z);if(f.needGeometry){const Ke=Kh(be,!0);if(!f.filter(new Ze(this.tileID.overscaledZ),Ke,this.tileID.canonical))return}else if(!f.filter(new Ze(this.tileID.overscaledZ),be))return;const Xe=this.getId(be,re);for(let Ke=0;Ke<W.length;Ke++){const qe=W[Ke];if(m&&m.indexOf(qe)<0)continue;const Je=S[qe];if(!Je)continue;let at={};void 0!==Xe&&P&&(at=P.getState(Je.sourceLayer||"_geojsonTileLayer",Xe));const Qe=Ee({},M[qe]);Qe.paint=o_(Qe.paint,Je.paint,be,at,w),Qe.layout=o_(Qe.layout,Je.layout,be,at,w);const Ut=!R||R(be,Je,at,Z);if(!Ut)continue;const Ot=new V0(be,this.z,this.x,this.y,Xe);Ot.layer=Qe;let rn=i[qe];void 0===rn&&(rn=i[qe]=[]),rn.push({featureIndex:z,feature:Ot,intersectionZ:Ut})}}lookupSymbolFeatures(i,a,f,m,w,S,M,P){const R={};this.loadVTLayers();const z=Zc(w);for(const V of i)this.loadMatchingFeature(R,{bucketIndex:f,sourceLayerIndex:m,featureIndex:V,layoutVertexArrayOffset:0},z,S,M,P,a);return R}loadFeature(i){const{featureIndex:a,sourceLayerIndex:f}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),w=this.vtFeatures[m];if(w[a])return w[a];const S=this.vtLayers[m].feature(a);return w[a]=S,S}hasLayer(i){for(const a of this.bucketLayerIDs)for(const f of a)if(i===f)return!0;return!1}getId(i,a){let f=i.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=m&&(f=i.properties[m]),"boolean"==typeof f&&(f=Number(f))}return f}}function o_(s,i,a,f,m){return Xn(s,(w,S)=>{const M=i instanceof fn?i.get(S):null;return M&&M.evaluate?M.evaluate(a,f,m):M})}function Z0(s,i){return i-s}oe(X0,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class W0{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new dl({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const f=this.getKey(i,a);return this.positions[f]}trim(){const i=this.width,a=this.height=Yt(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,f){const m=[];let w=i.length%2==1?-i[i.length-1]*f:0,S=i[0]*f,M=!0;m.push({left:w,right:S,isDash:M,zeroLength:0===i[0]});let P=i[0];for(let R=1;R<i.length;R++){M=!M;const z=i[R];w=P*f,P+=z,S=P*f,m.push({left:w,right:S,isDash:M,zeroLength:0===z})}return m}addRoundDash(i,a,f){const m=a/2;for(let w=-f;w<=f;w++){const S=this.width*(this.nextRow+f+w);let M=0,P=i[M];for(let R=0;R<this.width;R++){R/P.right>1&&(P=i[++M]);const z=Math.abs(R-P.left),V=Math.abs(R-P.right),G=Math.min(z,V);let Z;const W=w/f*(m+1);if(P.isDash){const re=m-Math.abs(W);Z=Math.sqrt(G*G+re*re)}else Z=m-Math.sqrt(G*G+W*W);this.image.data[S+R]=Math.max(0,Math.min(255,Z+128))}}}addRegularDash(i,a){for(let P=i.length-1;P>=0;--P){const R=i[P],z=i[P+1];R.zeroLength?i.splice(P,1):z&&z.isDash===R.isDash&&(z.left=R.left,i.splice(P,1))}const f=i[0],m=i[i.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const w=this.width*this.nextRow;let S=0,M=i[S];for(let P=0;P<this.width;P++){P/M.right>1&&(M=i[++S]);const R=Math.abs(P-M.left),z=Math.abs(P-M.right),V=Math.min(R,z);this.image.data[w+P]=Math.max(0,Math.min(255,(M.isDash?V:-V)+a+128))}}addDash(i,a){const f=this.getKey(i,a);if(this.positions[f])return this.positions[f];const m="round"===a,w=m?7:0,S=2*w+1;if(this.nextRow+S>this.height)return zn("LineAtlas out of space"),null;0===i.length&&i.push(1);let M=0;for(let z=0;z<i.length;z++)i[z]<0&&(zn("Negative value is found in line dasharray, replacing values with 0"),i[z]=0),M+=i[z];if(0!==M){const z=this.width/M,V=this.getDashRanges(i,this.width,z);m?this.addRoundDash(V,z,w):this.addRegularDash(V,"square"===a?.5*z:0)}const P=this.nextRow+w;this.nextRow+=S;const R={tl:[P,w],br:[M,0]};return this.positions[f]=R,R}}oe(W0,"LineAtlas");class qg{constructor(i){const a={},f=[];for(const M in i){const P=i[M],R=a[M]={};for(const z in P.glyphs){const V=P.glyphs[+z];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const G=V.metrics.localGlyph?2:1,Z={x:0,y:0,w:V.bitmap.width+2*G,h:V.bitmap.height+2*G};f.push(Z),R[z]=Z}}const{w:m,h:w}=Ay(f),S=new dl({width:m||1,height:w||1});for(const M in i){const P=i[M];for(const R in P.glyphs){const z=P.glyphs[+R];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const V=a[M][R],G=z.metrics.localGlyph?2:1;dl.copy(z.bitmap,S,{x:0,y:0},{x:V.x+G,y:V.y+G},z.bitmap)}}this.image=S,this.positions=a}}oe(qg,"GlyphAtlas");class Hw{constructor(i){this.tileID=new es(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=lf(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,a,f,m,w){this.status="parsing",this.data=i,this.collisionBoxArray=new Rm;const S=new U0(Object.keys(i.layers).sort()),M=new X0(this.tileID,this.promoteId);M.bucketLayerIDs=[];const P={},R=new W0(256,256),z={featureIndex:M,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:R,availableImages:f},V=a.familiesBySource[this.source];for(const at in V){const Qe=i.layers[at];if(!Qe)continue;let Ut=!1,Ot=!1;for(const Ht of V[at])"symbol"===Ht[0].type?Ut=!0:Ot=!0;if(!0===this.isSymbolTile&&!Ut||!1===this.isSymbolTile&&!Ot)continue;1===Qe.version&&zn(`Vector tile source "${this.source}" layer "${at}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const rn=S.encode(at),In=[];for(let Ht=0;Ht<Qe.length;Ht++){const an=Qe.feature(Ht),ln=M.getId(an,at);In.push({feature:an,id:ln,index:Ht,sourceLayerIndex:rn})}for(const Ht of V[at]){const an=Ht[0];void 0!==this.isSymbolTile&&"symbol"===an.type!==this.isSymbolTile||an.minzoom&&this.zoom<Math.floor(an.minzoom)||an.maxzoom&&this.zoom>=an.maxzoom||"none"!==an.visibility&&(s_(Ht,this.zoom,f),(P[an.id]=an.createBucket({index:M.bucketLayerIDs.length,layers:Ht,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:rn,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(In,z,this.tileID.canonical,this.tileTransform),M.bucketLayerIDs.push(Ht.map(ln=>ln.id)))}}let G,Z,W,re;R.trim();const be={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Xe=Xn(z.glyphDependencies,at=>Object.keys(at).map(Number));Object.keys(Xe).length?m.send("getGlyphs",{uid:this.uid,stacks:Xe},(at,Qe)=>{G||(G=at,Z=Qe,Je.call(this))},void 0,!1,be):Z={};const Ke=Object.keys(z.iconDependencies);Ke.length?m.send("getImages",{icons:Ke,source:this.source,tileID:this.tileID,type:"icons"},(at,Qe)=>{G||(G=at,W=Qe,Je.call(this))},void 0,!1,be):W={};const qe=Object.keys(z.patternDependencies);function Je(){if(G)return w(G);if(Z&&W&&re){const at=new qg(Z),Qe=new xp(W,re);for(const Ut in P){const Ot=P[Ut];Ot instanceof ff?(s_(Ot.layers,this.zoom,f),Aw(Ot,Z,at.positions,W,Qe.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):Ot.hasPattern&&(Ot instanceof nf||Ot instanceof mg||Ot instanceof jf)&&(s_(Ot.layers,this.zoom,f),Ot.addFeatures(z,this.tileID.canonical,Qe.patternPositions,f,this.tileTransform))}this.status="done",w(null,{buckets:gt(P).filter(Ut=>!Ut.isEmpty()),featureIndex:M,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:at.image,lineAtlas:R,imageAtlas:Qe,glyphMap:this.returnDependencies?Z:null,iconMap:this.returnDependencies?W:null,glyphPositions:this.returnDependencies?at.positions:null})}}qe.length?m.send("getImages",{icons:qe,source:this.source,tileID:this.tileID,type:"patterns"},(at,Qe)=>{G||(G=at,re=Qe,Je.call(this))},void 0,!1,be):re={},Je.call(this)}}function s_(s,i,a){const f=new Ze(i);for(const m of s)m.recalculate(f,a)}class Y0{constructor(i){this.entries={},this.scheduler=i}request(i,a,f,m){const w=this.entries[i]=this.entries[i]||{callbacks:[]};if(w.result){const[S,M]=w.result;return this.scheduler?this.scheduler.add(()=>{m(S,M)},a):m(S,M),()=>{}}return w.callbacks.push(m),w.cancel||(w.cancel=f((S,M)=>{w.result=[S,M];for(const P of w.callbacks)this.scheduler?this.scheduler.add(()=>{P(S,M)},a):P(S,M);setTimeout(()=>delete this.entries[i],3e3)})),()=>{w.result||(w.callbacks=w.callbacks.filter(S=>S!==m),w.callbacks.length||(w.cancel(),delete this.entries[i]))}}}function K0(s,i,a){const f=JSON.stringify(s.request);return s.data&&(this.deduped.entries[f]={result:[null,s.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},m=>{const w=vi(s.request,(S,M,P,R)=>{S?m(S):M&&m(null,{vectorTile:a?void 0:new Lc(new sf(M)),rawData:M,cacheControl:P,expires:R})});return()=>{w.cancel(),m()}},i)}p.ARRAY_TYPE=Il,p.AUTH_ERR_MSG=Ns,p.Aabb=nl,p.Actor=class{constructor(s,i,a){this.target=s,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Mn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Jr()?s:Ce,this.scheduler=new $w}send(s,i,a,f,m=!1,w){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=w,this.callbacks[S]=a);const M=Or(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:s,hasCallback:!!a,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:Qt(i,M)},M),{cancel:()=>{a&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(s){const i=s.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const f=this.cancelCallbacks[a];delete this.cancelCallbacks[a],f&&f.cancel()}else if(i.mustQueue||Jr()){const f=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,i),f&&f.metadata||{type:"message"})}else this.processTask(a,i)}processTask(s,i){if("<response>"===i.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(i.error?a(xt(i.error)):a(null,xt(i.data)))}else{const a=Or(this.globalScope)?void 0:[],f=i.hasCallback?(w,S)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:w?Qt(w):null,data:Qt(S,a)},a)}:w=>{},m=xt(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,f);else if(this.parent.getWorkerSource){const w=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,w[0],m.source)[w[1]](m,f)}else f(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Sd,p.Color=wt,p.ColorMode=Dl,p.CullFaceMode=zc,p.DEMData=Gg,p.DataConstantProperty=Ft,p.DedupedRequest=Y0,p.DepthMode=Zf,p.EXTENT=jr,p.Elevation=class{isDataAvailableAtPoint(s){const i=this._source();if(this.isUsingMockSource()||!i||s.y<0||s.y>1)return!1;const a=i.getSource().maxzoom,f=1<<a,m=Math.floor(s.x),w=Math.floor((s.x-m)*f),S=Math.floor(s.y*f),M=this.findDEMTileFor(new es(a,m,a,w,S));return!(!M||!M.dem)}getAtPointOrZero(s,i=0){return this.getAtPoint(s,i)||0}getAtPoint(s,i,a=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const f=this._source();if(!f||s.y<0||s.y>1)return i;const m=f.getSource().maxzoom,w=1<<m,S=Math.floor(s.x),M=s.x-S,P=new es(m,S,m,Math.floor(M*w),Math.floor(s.y*w)),R=this.findDEMTileFor(P);if(!R||!R.dem)return i;const z=R.dem,V=1<<R.tileID.canonical.z,G=(M*V-R.tileID.canonical.x)*z.dim,Z=(s.y*V-R.tileID.canonical.y)*z.dim,W=Math.floor(G),re=Math.floor(Z);return(a?this.exaggeration():1)*Ii(Ii(z.get(W,re),z.get(W,re+1),Z-re),Ii(z.get(W+1,re),z.get(W+1,re+1),Z-re),G-W)}getAtTileOffset(s,i,a){const f=1<<s.canonical.z;return this.getAtPointOrZero(new Ff(s.wrap+(s.canonical.x+i/jr)/f,(s.canonical.y+a/jr)/f))}getAtTileOffsetFunc(s,i,a,f){return m=>{const w=this.getAtTileOffset(s,m.x,m.y),S=f.upVector(s.canonical,m.x,m.y);return Wl(S,S,w*f.upVectorScale(s.canonical,i,a).metersToTile),S}}getForTilePoints(s,i,a,f){if(this.isUsingMockSource())return!1;const m=$g.create(this,s,f);return!!m&&(i.forEach(w=>{w[2]=this.exaggeration()*m.getElevationAt(w[0],w[1],a)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(s);if(!i||!i.dem)return null;const a=i.dem.tree,f=i.tileID,m=1<<s.canonical.z-f.canonical.z;let w=s.canonical.x/m-f.canonical.x,S=s.canonical.y/m-f.canonical.y,M=0;for(let P=0;P<s.canonical.z-f.canonical.z&&!a.leaves[M];P++){w*=2,S*=2;const R=2*Math.floor(S)+Math.floor(w);M=a.childOffsets[M]+R,w%=1,S%=1}return{min:this.exaggeration()*a.minimums[M],max:this.exaggeration()*a.maximums[M]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=ks,p.EvaluationParameters=Ze,p.Event=Gi,p.Evented=ia,p.FillExtrusionBucket=jf,p.Frustum=ry,p.FrustumCorners=ny,p.GLOBE_METERS_TO_ECEF=M0,p.GLOBE_RADIUS=Mh,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const i=new wi,a=new Du,f=65;for(let m=0;m<f;m++)for(let w=0;w<f;w++)i.emplaceBack(w,m);this._gridSegments=[];for(let m=0,w=0;m<bp.length;m++){const S=bp[m];for(let P=0;P<S;P++)for(let R=0;R<64;R++){const z=P*f+R;a.emplaceBack(z+1,z,z+f),a.emplaceBack(z+f,z+f+1,z+1)}const M=64*S*2;this._gridSegments.push(_a.simpleSegment(0,w,(S+1)*f,M)),w+=M}this._gridBuffer=s.createVertexBuffer(i,Gf.members),this._gridIndexBuffer=s.createIndexBuffer(a,!0)}_createPoles(s){const i=new Du;for(let m=0;m<=64;m++)i.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(i,!0);const a=new Au,f=new Au;this._poleSegments=[];for(let m=0,w=0;m<5;m++){const S=360/(1<<m);a.emplaceBack(0,-Mh,0,.5,0),f.emplaceBack(0,-Mh,0,.5,1);for(let M=0;M<=64;M++){const P=M/64,R=Ii(0,S,P),[z,V,G]=Nd(bi,L0,R,Mh);a.emplaceBack(z,V,G,P,0),f.emplaceBack(z,V,G,P,1)}this._poleSegments.push(_a.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,T0,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(f,T0,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,i){if(!this._wireframeSegments){const a=new Cl,f=64,m=f+1;this._wireframeSegments=[];for(let w=0,S=0;w<bp.length;w++){const M=bp[w];for(let R=0;R<M;R++)for(let z=0;z<f;z++){const V=R*m+z;a.emplaceBack(V,V+1),a.emplaceBack(V,V+m),a.emplaceBack(V,V+m+1)}const P=M*f*3;this._wireframeSegments.push(_a.simpleSegment(0,S,(M+1)*m,P)),S+=P}this._wireframeIndexBuffer=s.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},p.GlyphManager=Rd,p.ImagePosition=Py,p.LivePerformanceUtils=nn,p.LngLat=po,p.LngLatBounds=xh,p.LocalGlyphMode=Kl,p.MAX_MERCATOR_LATITUDE=Qc,p.MercatorCoordinate=Ff,p.ONE_EM=24,p.OverscaledTileID=es,p.PerformanceMarkers=ht,p.Properties=Bn,p.RGBAImage=pl,p.Ray=ty,p.RequestManager=class{constructor(s,i,a){this._transformRequestFn=s,this._customAccessToken=i,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let i="";for(let a=0;a<10;a++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ge,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,i){return this._transformRequestFn&&this._transformRequestFn(s,i)||{url:s}}normalizeStyleURL(s,i){if(!Ci(s))return s;const a=as(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeGlyphsURL(s,i){if(!Ci(s))return s;const a=as(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeSourceURL(s,i,a,f){if(!Ci(s))return s;const m=as(s);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),a&&m.params.push(`language=${a}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||i)}normalizeSpriteURL(s,i,a,f){const m=as(s);return Ci(s)?(m.path=`/styles/v1${m.path}/sprite${i}${a}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${i}${a}`,$r(m))}normalizeTileURL(s,i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!Ci(s))return s;const f=as(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||a&&"raster"!==f.authority&&512===a?"@2x":""}${Lt.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${yt.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${yt.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(w){for(const S of w){const M=S.match(/^access_token=(.*)$/);if(M)return M[1]}return null}(f.params)||yt.ACCESS_TOKEN;return yt.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(s,i){const a=as(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let f="mapbox://";a.path.match(/^\/raster\/v1\//)?f+=`raster/${a.path.replace(`/${yt.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${a.path.replace(`/${yt.TILE_URL_VERSION}/`,"")}`;let m=a.params;return i&&(m=m.filter(w=>!w.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(s,i){const a=!!i&&Ci(i),f=[];for(const m of s.tiles||[])Ys(m)?f.push(this.canonicalizeTileURL(m,a)):f.push(m);return f}_makeAPIURL(s,i){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=as(yt.API_URL);if(s.protocol=f.protocol,s.authority=f.authority,"http"===s.protocol){const m=s.params.indexOf("secure");m>=0&&s.params.splice(m,1)}if("/"!==f.path&&(s.path=`${f.path}${s.path}`),!yt.REQUIRE_ACCESS_TOKEN)return $r(s);if(i=i||yt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(m=>-1===m.indexOf("access_token")),s.params.push(`access_token=${i||""}`),$r(s)}},p.ResourceType=lr,p.SegmentVector=_a,p.SourceCache=Wf,p.StencilMode=r_,p.StructArrayLayout1ui2=hd,p.StructArrayLayout2f1f2i16=el,p.StructArrayLayout2i4=wi,p.StructArrayLayout2ui4=Cl,p.StructArrayLayout3f12=El,p.StructArrayLayout3ui6=Du,p.StructArrayLayout4i8=ms,p.StructArrayLayout5f20=Au,p.Texture=Ml,p.Tile=Tp,p.Transitionable=Wt,p.Uniform1f=Wp,p.Uniform1i=class extends $l{constructor(s){super(s),this.current=0}set(s,i,a){this.fetchUniformLocation(s,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends $l{constructor(s){super(s),this.current=[0,0]}set(s,i,a){this.fetchUniformLocation(s,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},p.Uniform3f=class extends $l{constructor(s){super(s),this.current=[0,0,0]}set(s,i,a){this.fetchUniformLocation(s,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},p.Uniform4f=ql,p.UniformColor=Zh,p.UniformMatrix2f=class extends $l{constructor(s){super(s),this.current=rp}set(s,i,a){if(this.fetchUniformLocation(s,i))for(let f=0;f<4;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends $l{constructor(s){super(s),this.current=Yp}set(s,i,a){if(this.fetchUniformLocation(s,i))for(let f=0;f<9;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends $l{constructor(s){super(s),this.current=vv}set(s,i,a){if(this.fetchUniformLocation(s,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let f=1;f<16;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},p.UnwrappedTileID=e0,p.ValidationError=Wn,p.VectorTileFeature=tf,p.VectorTileWorkerSource=class extends ia{constructor(s,i,a,f,m){super(),this.actor=s,this.layerIndex=i,this.availableImages=a,this.loadVectorData=m||K0,this.loading={},this.loaded={},this.deduped=new Y0(s.scheduler),this.isSpriteLoaded=f,this.scheduler=s.scheduler}loadTile(s,i){const a=s.uid,f=s&&s.request,m=f&&f.collectResourceTiming,w=this.loading[a]=new Hw(s);w.abort=this.loadVectorData(s,(S,M)=>{const P=!this.loading[a];if(delete this.loading[a],P||S||!M)return w.status="done",P||(this.loaded[a]=w),i(S);const R=M.rawData,z={};M.expires&&(z.expires=M.expires),M.cacheControl&&(z.cacheControl=M.cacheControl),w.vectorTile=M.vectorTile||new Lc(new sf(R));const V=()=>{w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,(G,Z)=>{if(G||!Z)return i(G);const W={};if(m){const re=rr(f);re.length>0&&(W.resourceTiming=JSON.parse(JSON.stringify(re)))}i(null,Ee({rawTileData:R.slice(0)},Z,z,W))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[a]=w})}reloadTile(s,i){const a=this.loaded,f=s.uid,m=this;if(a&&a[f]){const w=a[f];w.showCollisionBoxes=s.showCollisionBoxes,w.enableTerrain=!!s.enableTerrain,w.projection=s.projection,w.tileTransform=lf(s.tileID.canonical,s.projection);const S=(M,P)=>{const R=w.reloadCallback;R&&(delete w.reloadCallback,w.parse(w.vectorTile,m.layerIndex,this.availableImages,m.actor,R)),i(M,P)};"parsing"===w.status?w.reloadCallback=S:"done"===w.status&&(w.vectorTile?w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,S):S())}}abortTile(s,i){const a=s.uid,f=this.loading[a];f&&(f.abort&&f.abort(),delete this.loading[a]),i()}removeTile(s,i){const a=this.loaded,f=s.uid;a&&a[f]&&delete a[f],i()}},p.WritingMode=Yl,p.ZoomHistory=mn,p.add=eh,p.addDynamicAttributes=Hy,p.adjoint=function(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=i[4],M=i[5],P=i[6],R=i[7],z=i[8];return s[0]=S*z-M*R,s[1]=m*R-f*z,s[2]=f*M-m*S,s[3]=M*P-w*z,s[4]=a*z-m*P,s[5]=m*w-a*M,s[6]=w*R-S*P,s[7]=f*P-a*R,s[8]=a*S-f*w,s},p.asyncAll=Ne,p.bezier=Ge,p.bindAll=Mn,p.boundsAttributes=Ip,p.bufferConvexPolygon=function(s,i){const a=[];for(let f=0;f<s.length;f++){const m=kt(f-1,-1,s.length-1),w=kt(f+1,-1,s.length-1),S=s[f],M=s[w],P=s[m].sub(S).unit(),R=M.sub(S).unit(),z=R.angleWithSep(P.x,P.y),V=P.add(R).unit().mult(-1*i/Math.sin(z/2));a.push(S.add(V))}return a},p.cacheEntryPossiblyAdded=function(s){Pr++,Pr>qt&&(s.getActor().send("enforceCacheSizeLimit",mt),Pr=0)},p.calculateGlobeLabelMatrix=function(s,i){const{x:a,y:f}=s.point,m=Rw(a,f,s.worldSize/s._pixelsPerMercatorPixel,0,0);return _d(m,m,Cp(kc(i)))},p.calculateGlobeMatrix=function(s){const{x:i,y:a}=s.point,{lng:f,lat:m}=s._center;return Rw(i,a,s.worldSize,f,m)},p.calculateGlobeMercatorMatrix=function(s){const i=s.pixelsPerMeter,a=i/fc(1,s.center.lat),f=dc(new Float64Array(16));return sp(f,f,[s.point.x,s.point.y,0]),Jh(f,f,[a,a,i]),Float32Array.from(f)},p.circumferenceAtLatitude=kf,p.clamp=ue,p.clearTileCache=function(s){if(!pn())return;const i=Ce.caches.delete(me);s&&i.catch(s).then(()=>s())},p.clipLine=y0,p.clone=function(s){var i=new Il(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},p.clone$1=sr,p.collisionCircleLayout=Ey,p.config=yt,p.conjugate=function(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=i[3],s},p.create=function(){var s=new Il(16);return Il!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=Mv,p.createExpression=ea,p.createLayout=Un,p.createStyleLayer=function(s){return"custom"===s.type?new jw(s):new Gw[s.type](s)},p.cross=lp,p.degToRad=le,p.distance=function(s,i){return Math.hypot(i[0]-s[0],i[1]-s[1],i[2]-s[2])},p.div=function(s,i,a){return s[0]=i[0]/a[0],s[1]=i[1]/a[1],s[2]=i[2]/a[2],s},p.dot=pc,p.earthRadius=Yh,p.ease=$e,p.easeCubicInOut=_t,p.ecefToLatLng=function([s,i,a]){const f=Math.hypot(s,i,a),m=Math.atan2(s,a),w=.5*Math.PI-Math.acos(-i/f);return new po(we(m),we(w))},p.emitValidationErrors=T,p.endsWith=jt,p.enforceCacheSizeLimit=function(s){yn(),se&&se.then(i=>{i.keys().then(a=>{for(let f=0;f<a.length-s;f++)i.delete(a[f])})})},p.evaluateSizeForFeature=_p,p.evaluateSizeForZoom=yc,p.evaluateVariableOffset=E0,p.evented=Be,p.exactEquals=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]},p.exactEquals$1=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]},p.exported=ji,p.exported$1=Lt,p.extend=Ee,p.extend$1=Na,p.fillExtrusionHeightLift=Yv,p.filterObject=Qn,p.fromMat4=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],s},p.fromQuat=function(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=a+a,M=f+f,P=m+m,R=a*S,z=f*S,V=f*M,G=m*S,Z=m*M,W=m*P,re=w*S,be=w*M,Xe=w*P;return s[0]=1-V-W,s[1]=z+Xe,s[2]=G-be,s[3]=0,s[4]=z-Xe,s[5]=1-R-W,s[6]=Z+re,s[7]=0,s[8]=G+be,s[9]=Z-re,s[10]=1-R-V,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,i){var a=Math.sin(i),f=Math.cos(i);return s[0]=f,s[1]=a,s[2]=0,s[3]=-a,s[4]=f,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=fl,p.furthestTileCorner=function(s){const i=Math.round((s+45+360)%360/90)%4;return J[i]},p.getAABBPointSquareDist=function(s,i,a){let f=0;for(let m=0;m<2;++m){const w=a?a[m]:0;s[m]>w&&(f+=(s[m]-w)*(s[m]-w)),i[m]<w&&(f+=(w-i[m])*(w-i[m]))}return f},p.getAnchorAlignment=Oy,p.getAnchorJustification=Ag,p.getBounds=function(s){let i=1/0,a=1/0,f=-1/0,m=-1/0;for(const w of s)i=Math.min(i,w.x),a=Math.min(a,w.y),f=Math.max(f,w.x),m=Math.max(m,w.y);return{min:new Q(i,a),max:new Q(f,m)}},p.getColumn=ve,p.getGridMatrix=function(s,i,a,f){const m=i.getNorth(),w=i.getSouth(),S=i.getWest(),M=i.getEast(),P=1<<s.z,R=M-S,z=m-w,V=R/64,G=-z/bp[a],Z=[0,V,0,G,0,0,m,S,0];if(s.z>0){const W=180/f;Xm(Z,Z,[W/R+1,0,0,0,W/z+1,0,-.5*W/V,.5*W/G,1])}return Z[2]=P,Z[5]=s.x,Z[8]=s.y,Z},p.getImage=Ko,p.getJSON=function(s,i){return _i(Ee(s,{type:"json"}),i)},p.getLatitudinalLod=function(s){const i=80.051129;s=ue(s,-80.051129,i)/i*90;const a=Math.pow(Math.abs(Math.sin(le(s))),3);return Math.round(a*(bp.length-1))},p.getMapSessionAPI=Ct,p.getPerformanceMeasurement=rr,p.getProjection=z0,p.getRTLTextPluginStatus=Ae,p.getReferrer=Lr,p.getTilePoint=function(s,{x:i,y:a},f=0){return new Q(((i-f)*s.scale-s.x)*jr,(a*s.scale-s.y)*jr)},p.getTileVec3=function(s,i,a=0){return Bf(((i.x-a)*s.scale-s.x)*jr,(i.y*s.scale-s.y)*jr,gd(i.z,i.y))},p.getVideo=function(s,i){const a=Ce.document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let f=0;f<s.length;f++){const m=Ce.document.createElement("source");Pi(s[f])||(a.crossOrigin="Anonymous"),m.src=s[f],a.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const i=[0,0,0],a=dc(new Float64Array(16));return _d(a,s.pixelMatrix,s.globeMatrix),va(i,i,a),new Q(i[0],i[1])},p.globeDenormalizeECEF=Cp,p.globeECEFOrigin=function(s,i){const a=[0,0,0];return va(a,a,Fd(kc(i.canonical))),va(a,a,s),a},p.globeNormalizeECEF=Fd,p.globePixelsToTileUnits=function(s,i){return jr/(512*Math.pow(2,s))*Og(kc(i))},p.globePoleMatrixForTile=function(s,i,a){const f=dc(new Float64Array(16)),m=(i/(1<<s)-.5)*Math.PI*2;return ng(f,a.globeMatrix,m),Float32Array.from(f)},p.globeTileBounds=kc,p.globeTiltAtLngLat=P0,p.globeToMercatorTransition=uf,p.globeUseCustomAntiAliasing=function(s,i,a){const f=uf(a.zoom),m=s.style.map._antialias,w=!!i.extStandardDerivatives,S=i.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===f&&!m&&!S&&w},p.identity=dc,p.identity$1=ey,p.invert=Zm,p.isFullscreen=function(){return!!Ce.document.fullscreenElement||!!Ce.document.webkitFullscreenElement},p.isLngLatBehindGlobe=function(s,i){return P0(s,i)>Math.PI/2*1.01},p.isMapAuthenticated=function(s){return lt.has(s)},p.isMapboxURL=Ci,p.isSafariWithAntialiasingBug=function(s){const i=s.navigator?s.navigator.userAgent:null;return!!Or(s)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=La,p.latLngToECEF=Ep,p.len=Jm,p.length=bh,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Zl,p.loadVectorTile=K0,p.makeRequest=_i,p.mapValue=function(s,i,a,f,m){return ue((s-i)/(a-i)*(m-f)+f,f,m)},p.mercatorScale=$x,p.mercatorXfromLng=Xl,p.mercatorYfromLat=Dc,p.mercatorZfromAltitude=fc,p.mul=Dv,p.mul$1=Jx,p.multiply=_d,p.multiply$1=Xm,p.multiply$2=Km,p.nextPowerOfTwo=Yt,p.normalize=tl,p.normalize$1=Qx,p.normalize$2=Qm,p.number=Ii,p.ortho=function(s,i,a,f,m,w,S){var M=1/(i-a),P=1/(f-m),R=1/(w-S);return s[0]=-2*M,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*R,s[11]=0,s[12]=(i+a)*M,s[13]=(m+f)*P,s[14]=(S+w)*R,s[15]=1,s},p.pbf=sf,p.perspective=function(s,i,a,f,m){var w,S=1/Math.tan(i/2);return s[0]=S/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=m&&m!==1/0?(s[10]=(m+f)*(w=1/(f-m)),s[14]=2*m*f*w):(s[10]=-1,s[14]=-2*f),s},p.pick=function(s,i){const a={};for(let f=0;f<i.length;f++){const m=i[f];m in s&&(a[m]=s[m])}return a},p.plugin=rt,p.pointGeometry=Q,p.polygonContainsPoint=md,p.polygonIntersectsBox=Yx,p.polygonIntersectsPolygon=Cv,p.polygonizeBounds=function(s,i,a=0,f=!0){const m=new Q(a,a),w=s.sub(m),S=i.add(m),M=[w,new Q(S.x,w.y),S,new Q(w.x,S.y)];return f&&M.push(w.clone()),M},p.posAttributes=Gf,p.postMapLoadEvent=ke,p.postPerformanceEvent=ot,p.postTurnstileEvent=Y,p.potpack=Ay,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=we,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:Ie,pluginURL:Fe}),Be.on("pluginStateChange",s),s},p.removeAuthState=function(s){lt.delete(s)},p.renderColorRamp=sy,p.resample=qx,p.rotateX=Wm,p.rotateX$1=Pv,p.rotateY=ng,p.rotateY$1=sg,p.rotateZ=function(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[0],S=i[1],M=i[2],P=i[3],R=i[4],z=i[5],V=i[6],G=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m+R*f,s[1]=S*m+z*f,s[2]=M*m+V*f,s[3]=P*m+G*f,s[4]=R*m-w*f,s[5]=z*m-S*f,s[6]=V*m-M*f,s[7]=G*m-P*f,s},p.rotateZ$1=function(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],M=Math.sin(a),P=Math.cos(a);return s[0]=f*P+m*M,s[1]=m*P-f*M,s[2]=w*P+S*M,s[3]=S*P-w*M,s},p.scale=Jh,p.scale$1=ig,p.scale$2=Wl,p.scaleAndAdd=xd,p.set=function(s,i,a,f){return s[0]=i,s[1]=a,s[2]=f,s},p.setCacheLimits=function(s,i){mt=s,qt=i},p.setColumn=function(s,i,a){s[4*i+0]=a[0],s[4*i+1]=a[1],s[4*i+2]=a[2],s[4*i+3]=a[3]},p.setRTLTextPlugin=function(s,i,a=!1){if(Ie===X||Ie===K||Ie===_e)throw new Error("setRTLTextPlugin cannot be called multiple times.");Fe=ji.resolveURL(s),Ie=X,Le=i,Se(),a||et()},p.smoothstep=on,p.spec=zt,p.squaredLength=function(s){var i=s[0],a=s[1],f=s[2];return i*i+a*a+f*f},p.storeAuthState=function(s,i){i?lt.add(s):lt.delete(s)},p.sub=Ac,p.subtract=Ym,p.symbolSize=yw,p.tileAABB=function(s,i,a,f,m,w,S,M,P){if("globe"===P.name)return function Lw(s,i,a){const f=i/s.worldSize,m=s.globeMatrix;if(a.z<=1){const Ot=kc(a).getCorners();return Uy(Ot,m,f),nl.fromPoints(Ot)}const w=Rg(a),S=jy(w);Uy(S,m,f);const M=Number.MAX_VALUE,P=[-M,-M,-M],R=[M,M,M];if(w.contains(s.center)){for(const In of S)up(R,R,In),vd(P,P,In);P[2]=0;const Ot=s.point,rn=[Ot.x*f,Ot.y*f,0];return up(R,R,rn),vd(P,P,rn),new nl(R,P)}const z=[m[12]*f,m[13]*f,m[14]*f],V=w.getCenter(),G=ue(s.center.lat,-85.051129,Qc),Z=ue(V.lat,-85.051129,Qc),W=Xl(s.center.lng),re=Dc(G);let be=W-Xl(V.lng);const Xe=re-Dc(Z);be>.5?be-=1:be<-.5&&(be+=1);let Ke=0;Math.abs(be)>Math.abs(Xe)?Ke=be>=0?1:3:(Ke=Xe>=0?0:2,xd(z,z,[m[4]*f,m[5]*f,m[6]*f],-Math.sin(le(Xe>=0?w.getSouth():w.getNorth()))*Mh));const qe=S[Ke],Je=S[(Ke+1)%4],at=new Od(qe,Je,z),Qe=[By(at,0)||qe[0],By(at,1)||qe[1],By(at,2)||qe[2]],Ut=uf(s.zoom);if(Ut>0){const Ot=function({x:In,y:Ht,z:an},ln,_n,Tn,Jt){const Hn=1/(1<<an);let Fr=In*Hn,er=Fr+Hn,yr=Ht*Hn,Yn=yr+Hn,Gr=0;const si=(Fr+er)/2-Tn;return si>.5?Gr=-1:si<-.5&&(Gr=1),Fr=((Fr+Gr)*ln-(Tn*=ln))*_n+Tn,er=((er+Gr)*ln-Tn)*_n+Tn,yr=(yr*ln-(Jt*=ln))*_n+Jt,Yn=(Yn*ln-Jt)*_n+Jt,[[Fr,Yn,0],[er,Yn,0],[er,yr,0],[Fr,yr,0]]}(a,i,s._pixelsPerMercatorPixel,W,re);for(let In=0;In<S.length;In++)ih(S[In],Ot[In],Ut);const rn=eh([],Ot[Ke],Ot[(Ke+1)%4]);Wl(rn,rn,.5),ih(Qe,rn,Ut)}for(const Ot of S)up(R,R,Ot),vd(P,P,Ot);return R[2]=Math.min(qe[2],Je[2]),up(R,R,Qe),vd(P,P,Qe),new nl(R,P)}(s,i,new Sd(a,f,m));const R=lf({z:a,x:f,y:m},P);return new nl([(w+R.x/R.scale)*i,i*(R.y/R.scale),S],[(w+R.x2/R.scale)*i,i*(R.y2/R.scale),M])},p.tileCornersToBounds=Rg,p.tileTransform=lf,p.transformMat3=function(s,i,a){var f=i[0],m=i[1],w=i[2];return s[0]=f*a[0]+m*a[3]+w*a[6],s[1]=f*a[1]+m*a[4]+w*a[7],s[2]=f*a[2]+m*a[5]+w*a[8],s},p.transformMat4=va,p.transformMat4$1=gc,p.transformQuat=Av,p.transitionTileAABBinECEF=A0,p.translate=sp,p.transpose=function(s,i){if(s===i){var a=i[1],f=i[2],m=i[5];s[1]=i[3],s[2]=i[6],s[3]=a,s[5]=i[7],s[6]=f,s[7]=m}else s[0]=i[0],s[1]=i[3],s[2]=i[6],s[3]=i[1],s[4]=i[4],s[5]=i[7],s[6]=i[2],s[7]=i[5],s[8]=i[8];return s},p.triggerPluginCompletionEvent=De,p.uniqueId=vt,p.updateGlobeVertexNormal=function(s,i,a,f,m){const w=5*i+2;s.float32[w+0]=a,s.float32[w+1]=f,s.float32[w+2]=m},p.validateCustomStyleLayer=function(s){const i=[],a=s.id;return void 0===a&&i.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},p.validateFilter=s=>x(wl(s)),p.validateFog=s=>x(gs(s)),p.validateLayer=s=>x(Yr(s)),p.validateLight=s=>x(ga(s)),p.validateSource=s=>x(hl(s)),p.validateStyle=u,p.validateTerrain=s=>x(Gl(s)),p.values=gt,p.vectorTile=yg,p.version=We,p.warnOnce=zn,p.window=Ce,p.wrap=kt}),Ue(0,function(p){function Ce(Oe){if("number"==typeof Oe||"boolean"==typeof Oe||"string"==typeof Oe||null==Oe)return JSON.stringify(Oe);if(Array.isArray(Oe)){let ie="[";for(const ke of Oe)ie+=`${Ce(ke)},`;return`${ie}]`}let Y="{";for(const ie of Object.keys(Oe).sort())Y+=`${ie}:${Ce(Oe[ie])},`;return`${Y}}`}function We(Oe){let Y="";for(const ie of p.refProperties)Y+=`/${Ce(Oe[ie])}`;return Y}class dt{constructor(Y){this.keyCache={},Y&&this.replace(Y)}replace(Y){this._layerConfigs={},this._layers={},this.update(Y,[])}update(Y,ie){for(const Ye of Y)this._layerConfigs[Ye.id]=Ye,(this._layers[Ye.id]=p.createStyleLayer(Ye)).compileFilter(),this.keyCache[Ye.id]&&delete this.keyCache[Ye.id];for(const Ye of ie)delete this.keyCache[Ye],delete this._layerConfigs[Ye],delete this._layers[Ye];this.familiesBySource={};const ke=function(Ye,ot){const Mt={};for(let lt=0;lt<Ye.length;lt++){const ht=ot&&ot[Ye[lt].id]||We(Ye[lt]);ot&&(ot[Ye[lt].id]=ht);let nn=Mt[ht];nn||(nn=Mt[ht]=[]),nn.push(Ye[lt])}const Ct=[];for(const lt in Mt)Ct.push(Mt[lt]);return Ct}(p.values(this._layerConfigs),this.keyCache);for(const Ye of ke){const ot=Ye.map(Rn=>this._layers[Rn.id]),Mt=ot[0];if("none"===Mt.visibility)continue;const Ct=Mt.source||"";let lt=this.familiesBySource[Ct];lt||(lt=this.familiesBySource[Ct]={});const ht=Mt.sourceLayer||"_geojsonTileLayer";let nn=lt[ht];nn||(nn=lt[ht]=[]),nn.push(ot)}}}class yt{loadTile(Y,ie){const{uid:ke,encoding:Ye,rawImageData:ot,padding:Mt,buildQuadTree:Ct}=Y,lt=p.window.ImageBitmap&&ot instanceof p.window.ImageBitmap?this.getImageData(ot,Mt):ot;ie(null,new p.DEMData(ke,lt,Ye,Mt<1,Ct))}getImageData(Y,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(Y.width,Y.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=Y.width,this.offscreenCanvas.height=Y.height,this.offscreenCanvasContext.drawImage(Y,0,0,Y.width,Y.height);const ke=this.offscreenCanvasContext.getImageData(-ie,-ie,Y.width+2*ie,Y.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ke}}var Lt=function Oe(Y,ie){var ke,Ye=Y&&Y.type;if("FeatureCollection"===Ye)for(ke=0;ke<Y.features.length;ke++)Oe(Y.features[ke],ie);else if("GeometryCollection"===Ye)for(ke=0;ke<Y.geometries.length;ke++)Oe(Y.geometries[ke],ie);else if("Feature"===Ye)Oe(Y.geometry,ie);else if("Polygon"===Ye)un(Y.coordinates,ie);else if("MultiPolygon"===Ye)for(ke=0;ke<Y.coordinates.length;ke++)un(Y.coordinates[ke],ie);return Y};function un(Oe,Y){if(0!==Oe.length){Gt(Oe[0],Y);for(var ie=1;ie<Oe.length;ie++)Gt(Oe[ie],!Y)}}function Gt(Oe,Y){for(var ie=0,ke=0,Ye=0,ot=Oe.length,Mt=ot-1;Ye<ot;Mt=Ye++){var Ct=(Oe[Ye][0]-Oe[Mt][0])*(Oe[Mt][1]+Oe[Ye][1]),lt=ie+Ct;ke+=Math.abs(ie)>=Math.abs(Ct)?ie-lt+Ct:Ct-lt+ie,ie=lt}ie+ke>=0!=!!Y&&Oe.reverse()}const Tt=p.VectorTileFeature.prototype.toGeoJSON;class Xt{constructor(Y){this._feature=Y,this.extent=p.EXTENT,this.type=Y.type,this.properties=Y.tags,"id"in Y&&!isNaN(Y.id)&&(this.id=parseInt(Y.id,10))}loadGeometry(){if(1===this._feature.type){const Y=[];for(const ie of this._feature.geometry)Y.push([new p.pointGeometry(ie[0],ie[1])]);return Y}{const Y=[];for(const ie of this._feature.geometry){const ke=[];for(const Ye of ie)ke.push(new p.pointGeometry(Ye[0],Ye[1]));Y.push(ke)}return Y}}toGeoJSON(Y,ie,ke){return Tt.call(this,Y,ie,ke)}}class Dn{constructor(Y){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=Y.length,this._features=Y}feature(Y){return new Xt(this._features[Y])}}var ge={exports:{}},Me=p.pointGeometry,de=p.vectorTile.VectorTileFeature,Q=fe;function fe(Oe,Y){this.options=Y||{},this.features=Oe,this.length=Oe.length}function ze(Oe,Y){this.id="number"==typeof Oe.id?Oe.id:void 0,this.type=Oe.type,this.rawGeometry=1===Oe.type?[Oe.geometry]:Oe.geometry,this.properties=Oe.tags,this.extent=Y||4096}fe.prototype.feature=function(Oe){return new ze(this.features[Oe],this.options.extent)},ze.prototype.loadGeometry=function(){var Oe=this.rawGeometry;this.geometry=[];for(var Y=0;Y<Oe.length;Y++){for(var ie=Oe[Y],ke=[],Ye=0;Ye<ie.length;Ye++)ke.push(new Me(ie[Ye][0],ie[Ye][1]));this.geometry.push(ke)}return this.geometry},ze.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Oe=this.geometry,Y=1/0,ie=-1/0,ke=1/0,Ye=-1/0,ot=0;ot<Oe.length;ot++)for(var Mt=Oe[ot],Ct=0;Ct<Mt.length;Ct++){var lt=Mt[Ct];Y=Math.min(Y,lt.x),ie=Math.max(ie,lt.x),ke=Math.min(ke,lt.y),Ye=Math.max(Ye,lt.y)}return[Y,ke,ie,Ye]},ze.prototype.toGeoJSON=de.prototype.toGeoJSON;var pe=p.pbf,le=Q;function we(Oe){var Y=new pe;return function(ie,ke){for(var Ye in ie.layers)ke.writeMessage(3,J,ie.layers[Ye])}(Oe,Y),Y.finish()}function J(Oe,Y){var ie;Y.writeVarintField(15,Oe.version||1),Y.writeStringField(1,Oe.name||""),Y.writeVarintField(5,Oe.extent||4096);var ke={keys:[],values:[],keycache:{},valuecache:{}};for(ie=0;ie<Oe.length;ie++)ke.feature=Oe.feature(ie),Y.writeMessage(2,_t,ke);var Ye=ke.keys;for(ie=0;ie<Ye.length;ie++)Y.writeStringField(3,Ye[ie]);var ot=ke.values;for(ie=0;ie<ot.length;ie++)Y.writeMessage(4,kt,ot[ie])}function _t(Oe,Y){var ie=Oe.feature;void 0!==ie.id&&Y.writeVarintField(1,ie.id),Y.writeMessage(2,Ge,Oe),Y.writeVarintField(3,ie.type),Y.writeMessage(4,on,ie)}function Ge(Oe,Y){var ie=Oe.feature,ke=Oe.keys,Ye=Oe.values,ot=Oe.keycache,Mt=Oe.valuecache;for(var Ct in ie.properties){var lt=ie.properties[Ct],ht=ot[Ct];if(null!==lt){void 0===ht&&(ke.push(Ct),ot[Ct]=ht=ke.length-1),Y.writeVarint(ht);var nn=typeof lt;"string"!==nn&&"boolean"!==nn&&"number"!==nn&&(lt=JSON.stringify(lt));var Rn=nn+":"+lt,cn=Mt[Rn];void 0===cn&&(Ye.push(lt),Mt[Rn]=cn=Ye.length-1),Y.writeVarint(cn)}}}function $e(Oe,Y){return(Y<<3)+(7&Oe)}function ue(Oe){return Oe<<1^Oe>>31}function on(Oe,Y){for(var ie=Oe.loadGeometry(),ke=Oe.type,Ye=0,ot=0,Mt=ie.length,Ct=0;Ct<Mt;Ct++){var lt=ie[Ct],ht=1;1===ke&&(ht=lt.length),Y.writeVarint($e(1,ht));for(var nn=3===ke?lt.length-1:lt.length,Rn=0;Rn<nn;Rn++){1===Rn&&1!==ke&&Y.writeVarint($e(2,nn-1));var cn=lt[Rn].x-Ye,rr=lt[Rn].y-ot;Y.writeVarint(ue(cn)),Y.writeVarint(ue(rr)),Ye+=cn,ot+=rr}3===ke&&Y.writeVarint($e(7,1))}}function kt(Oe,Y){var ie=typeof Oe;"string"===ie?Y.writeStringField(1,Oe):"boolean"===ie?Y.writeBooleanField(7,Oe):"number"===ie&&(Oe%1!=0?Y.writeDoubleField(3,Oe):Oe<0?Y.writeSVarintField(6,Oe):Y.writeVarintField(5,Oe))}function Ne(Oe,Y,ie,ke,Ye,ot){if(Ye-ke<=ie)return;const Mt=ke+Ye>>1;gt(Oe,Y,Mt,ke,Ye,ot%2),Ne(Oe,Y,ie,ke,Mt-1,ot+1),Ne(Oe,Y,ie,Mt+1,Ye,ot+1)}function gt(Oe,Y,ie,ke,Ye,ot){for(;Ye>ke;){if(Ye-ke>600){const ht=Ye-ke+1,nn=ie-ke+1,Rn=Math.log(ht),cn=.5*Math.exp(2*Rn/3),rr=.5*Math.sqrt(Rn*cn*(ht-cn)/ht)*(nn-ht/2<0?-1:1);gt(Oe,Y,ie,Math.max(ke,Math.floor(ie-nn*cn/ht+rr)),Math.min(Ye,Math.floor(ie+(ht-nn)*cn/ht+rr)),ot)}const Mt=Y[2*ie+ot];let Ct=ke,lt=Ye;for(Ee(Oe,Y,ke,ie),Y[2*Ye+ot]>Mt&&Ee(Oe,Y,ke,Ye);Ct<lt;){for(Ee(Oe,Y,Ct,lt),Ct++,lt--;Y[2*Ct+ot]<Mt;)Ct++;for(;Y[2*lt+ot]>Mt;)lt--}Y[2*ke+ot]===Mt?Ee(Oe,Y,ke,lt):(lt++,Ee(Oe,Y,lt,Ye)),lt<=ie&&(ke=lt+1),ie<=lt&&(Ye=lt-1)}}function Ee(Oe,Y,ie,ke){it(Oe,ie,ke),it(Y,2*ie,2*ke),it(Y,2*ie+1,2*ke+1)}function it(Oe,Y,ie){const ke=Oe[Y];Oe[Y]=Oe[ie],Oe[ie]=ke}function vt(Oe,Y,ie,ke){const Ye=Oe-ie,ot=Y-ke;return Ye*Ye+ot*ot}ge.exports=we,ge.exports.fromVectorTileJs=we,ge.exports.fromGeojsonVt=function(Oe,Y){Y=Y||{};var ie={};for(var ke in Oe)ie[ke]=new le(Oe[ke].features,Y),ie[ke].name=ke,ie[ke].version=Y.version,ie[ke].extent=Y.extent;return we({layers:ie})},ge.exports.GeoJSONWrapper=le;const Re=Oe=>Oe[0],Yt=Oe=>Oe[1];class $t{constructor(Y,ie=Re,ke=Yt,Ye=64,ot=Float64Array){this.nodeSize=Ye,this.points=Y;const Mt=Y.length<65536?Uint16Array:Uint32Array,Ct=this.ids=new Mt(Y.length),lt=this.coords=new ot(2*Y.length);for(let ht=0;ht<Y.length;ht++)Ct[ht]=ht,lt[2*ht]=ie(Y[ht]),lt[2*ht+1]=ke(Y[ht]);Ne(Ct,lt,Ye,0,Ct.length-1,0)}range(Y,ie,ke,Ye){return function(ot,Mt,Ct,lt,ht,nn,Rn){const cn=[0,ot.length-1,0],rr=[];let cr,ir;for(;cn.length;){const Mr=cn.pop(),Dr=cn.pop(),ji=cn.pop();if(Dr-ji<=Rn){for(let Gi=ji;Gi<=Dr;Gi++)cr=Mt[2*Gi],ir=Mt[2*Gi+1],cr>=Ct&&cr<=ht&&ir>=lt&&ir<=nn&&rr.push(ot[Gi]);continue}const tr=Math.floor((ji+Dr)/2);cr=Mt[2*tr],ir=Mt[2*tr+1],cr>=Ct&&cr<=ht&&ir>=lt&&ir<=nn&&rr.push(ot[tr]);const gr=(Mr+1)%2;(0===Mr?Ct<=cr:lt<=ir)&&(cn.push(ji),cn.push(tr-1),cn.push(gr)),(0===Mr?ht>=cr:nn>=ir)&&(cn.push(tr+1),cn.push(Dr),cn.push(gr))}return rr}(this.ids,this.coords,Y,ie,ke,Ye,this.nodeSize)}within(Y,ie,ke){return function(Ye,ot,Mt,Ct,lt,ht){const nn=[0,Ye.length-1,0],Rn=[],cn=lt*lt;for(;nn.length;){const rr=nn.pop(),cr=nn.pop(),ir=nn.pop();if(cr-ir<=ht){for(let gr=ir;gr<=cr;gr++)vt(ot[2*gr],ot[2*gr+1],Mt,Ct)<=cn&&Rn.push(Ye[gr]);continue}const Mr=Math.floor((ir+cr)/2),Dr=ot[2*Mr],ji=ot[2*Mr+1];vt(Dr,ji,Mt,Ct)<=cn&&Rn.push(Ye[Mr]);const tr=(rr+1)%2;(0===rr?Mt-lt<=Dr:Ct-lt<=ji)&&(nn.push(ir),nn.push(Mr-1),nn.push(tr)),(0===rr?Mt+lt>=Dr:Ct+lt>=ji)&&(nn.push(Mr+1),nn.push(cr),nn.push(tr))}return Rn}(this.ids,this.coords,Y,ie,ke,this.nodeSize)}}const Mn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Oe=>Oe},jt=Math.fround||(Xn=new Float32Array(1),Oe=>(Xn[0]=+Oe,Xn[0]));var Xn;class Qn{constructor(Y){this.options=_r(Object.create(Mn),Y),this.trees=new Array(this.options.maxZoom+1)}load(Y){const{log:ie,minZoom:ke,maxZoom:Ye,nodeSize:ot}=this.options;ie&&console.time("total time");const Mt=`prepare ${Y.length} points`;ie&&console.time(Mt),this.points=Y;let Ct=[];for(let lt=0;lt<Y.length;lt++)Y[lt].geometry&&Ct.push(kn(Y[lt],lt));this.trees[Ye+1]=new $t(Ct,Or,St,ot,Float32Array),ie&&console.timeEnd(Mt);for(let lt=Ye;lt>=ke;lt--){const ht=+Date.now();Ct=this._cluster(Ct,lt),this.trees[lt]=new $t(Ct,Or,St,ot,Float32Array),ie&&console.log("z%d: %d clusters in %dms",lt,Ct.length,+Date.now()-ht)}return ie&&console.timeEnd("total time"),this}getClusters(Y,ie){let ke=((Y[0]+180)%360+360)%360-180;const Ye=Math.max(-90,Math.min(90,Y[1]));let ot=180===Y[2]?180:((Y[2]+180)%360+360)%360-180;const Mt=Math.max(-90,Math.min(90,Y[3]));if(Y[2]-Y[0]>=360)ke=-180,ot=180;else if(ke>ot){const nn=this.getClusters([ke,Ye,180,Mt],ie),Rn=this.getClusters([-180,Ye,ot,Mt],ie);return nn.concat(Rn)}const Ct=this.trees[this._limitZoom(ie)],lt=Ct.range(pr(ke),Jr(Mt),pr(ot),Jr(Ye)),ht=[];for(const nn of lt){const Rn=Ct.points[nn];ht.push(Rn.numPoints?zn(Rn):this.points[Rn.index])}return ht}getChildren(Y){const ie=this._getOriginId(Y),ke=this._getOriginZoom(Y),Ye="No cluster with the specified id.",ot=this.trees[ke];if(!ot)throw new Error(Ye);const Mt=ot.points[ie];if(!Mt)throw new Error(Ye);const Ct=this.options.radius/(this.options.extent*Math.pow(2,ke-1)),lt=ot.within(Mt.x,Mt.y,Ct),ht=[];for(const nn of lt){const Rn=ot.points[nn];Rn.parentId===Y&&ht.push(Rn.numPoints?zn(Rn):this.points[Rn.index])}if(0===ht.length)throw new Error(Ye);return ht}getLeaves(Y,ie,ke){const Ye=[];return this._appendLeaves(Ye,Y,ie=ie||10,ke=ke||0,0),Ye}getTile(Y,ie,ke){const Ye=this.trees[this._limitZoom(Y)],ot=Math.pow(2,Y),{extent:Mt,radius:Ct}=this.options,lt=Ct/Mt,ht=(ke-lt)/ot,nn=(ke+1+lt)/ot,Rn={features:[]};return this._addTileFeatures(Ye.range((ie-lt)/ot,ht,(ie+1+lt)/ot,nn),Ye.points,ie,ke,ot,Rn),0===ie&&this._addTileFeatures(Ye.range(1-lt/ot,ht,1,nn),Ye.points,ot,ke,ot,Rn),ie===ot-1&&this._addTileFeatures(Ye.range(0,ht,lt/ot,nn),Ye.points,-1,ke,ot,Rn),Rn.features.length?Rn:null}getClusterExpansionZoom(Y){let ie=this._getOriginZoom(Y)-1;for(;ie<=this.options.maxZoom;){const ke=this.getChildren(Y);if(ie++,1!==ke.length)break;Y=ke[0].properties.cluster_id}return ie}_appendLeaves(Y,ie,ke,Ye,ot){const Mt=this.getChildren(ie);for(const Ct of Mt){const lt=Ct.properties;if(lt&&lt.cluster?ot+lt.point_count<=Ye?ot+=lt.point_count:ot=this._appendLeaves(Y,lt.cluster_id,ke,Ye,ot):ot<Ye?ot++:Y.push(Ct),Y.length===ke)break}return ot}_addTileFeatures(Y,ie,ke,Ye,ot,Mt){for(const Ct of Y){const lt=ie[Ct],ht=lt.numPoints;let nn,Rn,cn;if(ht)nn=wn(lt),Rn=lt.x,cn=lt.y;else{const ir=this.points[lt.index];nn=ir.properties,Rn=pr(ir.geometry.coordinates[0]),cn=Jr(ir.geometry.coordinates[1])}const rr={type:1,geometry:[[Math.round(this.options.extent*(Rn*ot-ke)),Math.round(this.options.extent*(cn*ot-Ye))]],tags:nn};let cr;ht?cr=lt.id:this.options.generateId?cr=lt.index:this.points[lt.index].id&&(cr=this.points[lt.index].id),void 0!==cr&&(rr.id=cr),Mt.features.push(rr)}}_limitZoom(Y){return Math.max(this.options.minZoom,Math.min(Math.floor(+Y),this.options.maxZoom+1))}_cluster(Y,ie){const ke=[],{radius:Ye,extent:ot,reduce:Mt,minPoints:Ct}=this.options,lt=Ye/(ot*Math.pow(2,ie));for(let ht=0;ht<Y.length;ht++){const nn=Y[ht];if(nn.zoom<=ie)continue;nn.zoom=ie;const Rn=this.trees[ie+1],cn=Rn.within(nn.x,nn.y,lt),rr=nn.numPoints||1;let cr=rr;for(const ir of cn){const Mr=Rn.points[ir];Mr.zoom>ie&&(cr+=Mr.numPoints||1)}if(cr>rr&&cr>=Ct){let ir=nn.x*rr,Mr=nn.y*rr,Dr=Mt&&rr>1?this._map(nn,!0):null;const ji=(ht<<5)+(ie+1)+this.points.length;for(const tr of cn){const gr=Rn.points[tr];if(gr.zoom<=ie)continue;gr.zoom=ie;const Gi=gr.numPoints||1;ir+=gr.x*Gi,Mr+=gr.y*Gi,gr.parentId=ji,Mt&&(Dr||(Dr=this._map(nn,!0)),Mt(Dr,this._map(gr)))}nn.parentId=ji,ke.push(sr(ir/cr,Mr/cr,ji,cr,Dr))}else if(ke.push(nn),cr>1)for(const ir of cn){const Mr=Rn.points[ir];Mr.zoom<=ie||(Mr.zoom=ie,ke.push(Mr))}}return ke}_getOriginId(Y){return Y-this.points.length>>5}_getOriginZoom(Y){return(Y-this.points.length)%32}_map(Y,ie){if(Y.numPoints)return ie?_r({},Y.properties):Y.properties;const ke=this.points[Y.index].properties,Ye=this.options.map(ke);return ie&&Ye===ke?_r({},Ye):Ye}}function sr(Oe,Y,ie,ke,Ye){return{x:jt(Oe),y:jt(Y),zoom:1/0,id:ie,parentId:-1,numPoints:ke,properties:Ye}}function kn(Oe,Y){const[ie,ke]=Oe.geometry.coordinates;return{x:jt(pr(ie)),y:jt(Jr(ke)),zoom:1/0,index:Y,parentId:-1}}function zn(Oe){return{type:"Feature",id:Oe.id,properties:wn(Oe),geometry:{type:"Point",coordinates:[(Y=Oe.x,360*(Y-.5)),ki(Oe.y)]}};var Y}function wn(Oe){const Y=Oe.numPoints,ie=Y>=1e4?`${Math.round(Y/1e3)}k`:Y>=1e3?Math.round(Y/100)/10+"k":Y;return _r(_r({},Oe.properties),{cluster:!0,cluster_id:Oe.id,point_count:Y,point_count_abbreviated:ie})}function pr(Oe){return Oe/360+.5}function Jr(Oe){const Y=Math.sin(Oe*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function ki(Oe){const Y=(180-360*Oe)*Math.PI/180;return 360*Math.atan(Math.exp(Y))/Math.PI-90}function _r(Oe,Y){for(const ie in Y)Oe[ie]=Y[ie];return Oe}function Or(Oe){return Oe.x}function St(Oe){return Oe.y}function ve(Oe,Y,ie,ke){for(var Ye,ot=ke,Mt=ie-Y>>1,Ct=ie-Y,lt=Oe[Y],ht=Oe[Y+1],nn=Oe[ie],Rn=Oe[ie+1],cn=Y+3;cn<ie;cn+=3){var rr=me(Oe[cn],Oe[cn+1],lt,ht,nn,Rn);if(rr>ot)Ye=cn,ot=rr;else if(rr===ot){var cr=Math.abs(cn-Mt);cr<Ct&&(Ye=cn,Ct=cr)}}ot>ke&&(Ye-Y>3&&ve(Oe,Y,Ye,ke),Oe[Ye+2]=ot,ie-Ye>3&&ve(Oe,Ye,ie,ke))}function me(Oe,Y,ie,ke,Ye,ot){var Mt=Ye-ie,Ct=ot-ke;if(0!==Mt||0!==Ct){var lt=((Oe-ie)*Mt+(Y-ke)*Ct)/(Mt*Mt+Ct*Ct);lt>1?(ie=Ye,ke=ot):lt>0&&(ie+=Mt*lt,ke+=Ct*lt)}return(Mt=Oe-ie)*Mt+(Ct=Y-ke)*Ct}function se(Oe,Y,ie,ke){var Ye={id:void 0===Oe?null:Oe,type:Y,geometry:ie,tags:ke,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ot){var Mt=ot.geometry,Ct=ot.type;if("Point"===Ct||"MultiPoint"===Ct||"LineString"===Ct)Ve(ot,Mt);else if("Polygon"===Ct||"MultiLineString"===Ct)for(var lt=0;lt<Mt.length;lt++)Ve(ot,Mt[lt]);else if("MultiPolygon"===Ct)for(lt=0;lt<Mt.length;lt++)for(var ht=0;ht<Mt[lt].length;ht++)Ve(ot,Mt[lt][ht])}(Ye),Ye}function Ve(Oe,Y){for(var ie=0;ie<Y.length;ie+=3)Oe.minX=Math.min(Oe.minX,Y[ie]),Oe.minY=Math.min(Oe.minY,Y[ie+1]),Oe.maxX=Math.max(Oe.maxX,Y[ie]),Oe.maxY=Math.max(Oe.maxY,Y[ie+1])}function mt(Oe,Y,ie,ke){if(Y.geometry){var Ye=Y.geometry.coordinates,ot=Y.geometry.type,Mt=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2),Ct=[],lt=Y.id;if(ie.promoteId?lt=Y.properties[ie.promoteId]:ie.generateId&&(lt=ke||0),"Point"===ot)qt(Ye,Ct);else if("MultiPoint"===ot)for(var ht=0;ht<Ye.length;ht++)qt(Ye[ht],Ct);else if("LineString"===ot)pn(Ye,Ct,Mt,!1);else if("MultiLineString"===ot){if(ie.lineMetrics){for(ht=0;ht<Ye.length;ht++)pn(Ye[ht],Ct=[],Mt,!1),Oe.push(se(lt,"LineString",Ct,Y.properties));return}yn(Ye,Ct,Mt,!1)}else if("Polygon"===ot)yn(Ye,Ct,Mt,!0);else{if("MultiPolygon"!==ot){if("GeometryCollection"===ot){for(ht=0;ht<Y.geometry.geometries.length;ht++)mt(Oe,{id:lt,geometry:Y.geometry.geometries[ht],properties:Y.properties},ie,ke);return}throw new Error("Input data is not a valid GeoJSON object.")}for(ht=0;ht<Ye.length;ht++){var nn=[];yn(Ye[ht],nn,Mt,!0),Ct.push(nn)}}Oe.push(se(lt,ot,Ct,Y.properties))}}function qt(Oe,Y){Y.push(Kt(Oe[0])),Y.push(Pr(Oe[1])),Y.push(0)}function pn(Oe,Y,ie,ke){for(var Ye,ot,Mt=0,Ct=0;Ct<Oe.length;Ct++){var lt=Kt(Oe[Ct][0]),ht=Pr(Oe[Ct][1]);Y.push(lt),Y.push(ht),Y.push(0),Ct>0&&(Mt+=ke?(Ye*ht-lt*ot)/2:Math.sqrt(Math.pow(lt-Ye,2)+Math.pow(ht-ot,2))),Ye=lt,ot=ht}var nn=Y.length-3;Y[2]=1,ve(Y,0,nn,ie),Y[nn+2]=1,Y.size=Math.abs(Mt),Y.start=0,Y.end=Y.size}function yn(Oe,Y,ie,ke){for(var Ye=0;Ye<Oe.length;Ye++){var ot=[];pn(Oe[Ye],ot,ie,ke),Y.push(ot)}}function Kt(Oe){return Oe/360+.5}function Pr(Oe){var Y=Math.sin(Oe*Math.PI/180),ie=.5-.25*Math.log((1+Y)/(1-Y))/Math.PI;return ie<0?0:ie>1?1:ie}function lr(Oe,Y,ie,ke,Ye,ot,Mt,Ct){if(ke/=Y,ot>=(ie/=Y)&&Mt<ke)return Oe;if(Mt<ie||ot>=ke)return null;for(var lt=[],ht=0;ht<Oe.length;ht++){var nn=Oe[ht],Rn=nn.geometry,cn=nn.type,rr=0===Ye?nn.minX:nn.minY,cr=0===Ye?nn.maxX:nn.maxY;if(rr>=ie&&cr<ke)lt.push(nn);else if(!(cr<ie||rr>=ke)){var ir=[];if("Point"===cn||"MultiPoint"===cn)On(Rn,ir,ie,ke,Ye);else if("LineString"===cn)Lr(Rn,ir,ie,ke,Ye,!1,Ct.lineMetrics);else if("MultiLineString"===cn)vi(Rn,ir,ie,ke,Ye,!1);else if("Polygon"===cn)vi(Rn,ir,ie,ke,Ye,!0);else if("MultiPolygon"===cn)for(var Mr=0;Mr<Rn.length;Mr++){var Dr=[];vi(Rn[Mr],Dr,ie,ke,Ye,!0),Dr.length&&ir.push(Dr)}if(ir.length){if(Ct.lineMetrics&&"LineString"===cn){for(Mr=0;Mr<ir.length;Mr++)lt.push(se(nn.id,cn,ir[Mr],nn.tags));continue}"LineString"!==cn&&"MultiLineString"!==cn||(1===ir.length?(cn="LineString",ir=ir[0]):cn="MultiLineString"),"Point"!==cn&&"MultiPoint"!==cn||(cn=3===ir.length?"Point":"MultiPoint"),lt.push(se(nn.id,cn,ir,nn.tags))}}}return lt.length?lt:null}function On(Oe,Y,ie,ke,Ye){for(var ot=0;ot<Oe.length;ot+=3){var Mt=Oe[ot+Ye];Mt>=ie&&Mt<=ke&&(Y.push(Oe[ot]),Y.push(Oe[ot+1]),Y.push(Oe[ot+2]))}}function Lr(Oe,Y,ie,ke,Ye,ot,Mt){for(var Ct,lt,ht=_i(Oe),nn=0===Ye?Ri:Sr,Rn=Oe.start,cn=0;cn<Oe.length-3;cn+=3){var rr=Oe[cn],cr=Oe[cn+1],ir=Oe[cn+2],Mr=Oe[cn+3],Dr=Oe[cn+4],ji=0===Ye?rr:cr,tr=0===Ye?Mr:Dr,gr=!1;Mt&&(Ct=Math.sqrt(Math.pow(rr-Mr,2)+Math.pow(cr-Dr,2))),ji<ie?tr>ie&&(lt=nn(ht,rr,cr,Mr,Dr,ie),Mt&&(ht.start=Rn+Ct*lt)):ji>ke?tr<ke&&(lt=nn(ht,rr,cr,Mr,Dr,ke),Mt&&(ht.start=Rn+Ct*lt)):Pi(ht,rr,cr,ir),tr<ie&&ji>=ie&&(lt=nn(ht,rr,cr,Mr,Dr,ie),gr=!0),tr>ke&&ji<=ke&&(lt=nn(ht,rr,cr,Mr,Dr,ke),gr=!0),!ot&&gr&&(Mt&&(ht.end=Rn+Ct*lt),Y.push(ht),ht=_i(Oe)),Mt&&(Rn+=Ct)}var Gi=Oe.length-3;rr=Oe[Gi],cr=Oe[Gi+1],ir=Oe[Gi+2],(ji=0===Ye?rr:cr)>=ie&&ji<=ke&&Pi(ht,rr,cr,ir),Gi=ht.length-3,ot&&Gi>=3&&(ht[Gi]!==ht[0]||ht[Gi+1]!==ht[1])&&Pi(ht,ht[0],ht[1],ht[2]),ht.length&&Y.push(ht)}function _i(Oe){var Y=[];return Y.size=Oe.size,Y.start=Oe.start,Y.end=Oe.end,Y}function vi(Oe,Y,ie,ke,Ye,ot){for(var Mt=0;Mt<Oe.length;Mt++)Lr(Oe[Mt],Y,ie,ke,Ye,ot,!1)}function Pi(Oe,Y,ie,ke){Oe.push(Y),Oe.push(ie),Oe.push(ke)}function Ri(Oe,Y,ie,ke,Ye,ot){var Mt=(ot-Y)/(ke-Y);return Oe.push(ot),Oe.push(ie+(Ye-ie)*Mt),Oe.push(1),Mt}function Sr(Oe,Y,ie,ke,Ye,ot){var Mt=(ot-ie)/(Ye-ie);return Oe.push(Y+(ke-Y)*Mt),Oe.push(ot),Oe.push(1),Mt}function ds(Oe,Y){for(var ie=[],ke=0;ke<Oe.length;ke++){var Ye,ot=Oe[ke],Mt=ot.type;if("Point"===Mt||"MultiPoint"===Mt||"LineString"===Mt)Ye=Ko(ot.geometry,Y);else if("MultiLineString"===Mt||"Polygon"===Mt){Ye=[];for(var Ct=0;Ct<ot.geometry.length;Ct++)Ye.push(Ko(ot.geometry[Ct],Y))}else if("MultiPolygon"===Mt)for(Ye=[],Ct=0;Ct<ot.geometry.length;Ct++){for(var lt=[],ht=0;ht<ot.geometry[Ct].length;ht++)lt.push(Ko(ot.geometry[Ct][ht],Y));Ye.push(lt)}ie.push(se(ot.id,Mt,Ye,ot.tags))}return ie}function Ko(Oe,Y){var ie=[];ie.size=Oe.size,void 0!==Oe.start&&(ie.start=Oe.start,ie.end=Oe.end);for(var ke=0;ke<Oe.length;ke+=3)ie.push(Oe[ke]+Y,Oe[ke+1],Oe[ke+2]);return ie}function Ns(Oe,Y){if(Oe.transformed)return Oe;var ie,ke,Ye,ot=1<<Oe.z,Mt=Oe.x,Ct=Oe.y;for(ie=0;ie<Oe.features.length;ie++){var lt=Oe.features[ie],ht=lt.geometry,nn=lt.type;if(lt.geometry=[],1===nn)for(ke=0;ke<ht.length;ke+=2)lt.geometry.push(Ci(ht[ke],ht[ke+1],Y,ot,Mt,Ct));else for(ke=0;ke<ht.length;ke++){var Rn=[];for(Ye=0;Ye<ht[ke].length;Ye+=2)Rn.push(Ci(ht[ke][Ye],ht[ke][Ye+1],Y,ot,Mt,Ct));lt.geometry.push(Rn)}}return Oe.transformed=!0,Oe}function Ci(Oe,Y,ie,ke,Ye,ot){return[Math.round(ie*(Oe*ke-Ye)),Math.round(ie*(Y*ke-ot))]}function Ys(Oe,Y,ie,ke,Ye){for(var ot=Y===Ye.maxZoom?0:Ye.tolerance/((1<<Y)*Ye.extent),Mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ie,y:ke,z:Y,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ct=0;Ct<Oe.length;Ct++){Mt.numFeatures++,oi(Mt,Oe[Ct],ot,Ye);var lt=Oe[Ct].minX,ht=Oe[Ct].minY,nn=Oe[Ct].maxX,Rn=Oe[Ct].maxY;lt<Mt.minX&&(Mt.minX=lt),ht<Mt.minY&&(Mt.minY=ht),nn>Mt.maxX&&(Mt.maxX=nn),Rn>Mt.maxY&&(Mt.maxY=Rn)}return Mt}function oi(Oe,Y,ie,ke){var Ye=Y.geometry,ot=Y.type,Mt=[];if("Point"===ot||"MultiPoint"===ot)for(var Ct=0;Ct<Ye.length;Ct+=3)Mt.push(Ye[Ct]),Mt.push(Ye[Ct+1]),Oe.numPoints++,Oe.numSimplified++;else if("LineString"===ot)An(Mt,Ye,Oe,ie,!1,!1);else if("MultiLineString"===ot||"Polygon"===ot)for(Ct=0;Ct<Ye.length;Ct++)An(Mt,Ye[Ct],Oe,ie,"Polygon"===ot,0===Ct);else if("MultiPolygon"===ot)for(var lt=0;lt<Ye.length;lt++){var ht=Ye[lt];for(Ct=0;Ct<ht.length;Ct++)An(Mt,ht[Ct],Oe,ie,!0,0===Ct)}if(Mt.length){var nn=Y.tags||null;if("LineString"===ot&&ke.lineMetrics){for(var Rn in nn={},Y.tags)nn[Rn]=Y.tags[Rn];nn.mapbox_clip_start=Ye.start/Ye.size,nn.mapbox_clip_end=Ye.end/Ye.size}var cn={geometry:Mt,type:"Polygon"===ot||"MultiPolygon"===ot?3:"LineString"===ot||"MultiLineString"===ot?2:1,tags:nn};null!==Y.id&&(cn.id=Y.id),Oe.features.push(cn)}}function An(Oe,Y,ie,ke,Ye,ot){var Mt=ke*ke;if(ke>0&&Y.size<(Ye?Mt:ke))ie.numPoints+=Y.length/3;else{for(var Ct=[],lt=0;lt<Y.length;lt+=3)(0===ke||Y[lt+2]>Mt)&&(ie.numSimplified++,Ct.push(Y[lt]),Ct.push(Y[lt+1])),ie.numPoints++;Ye&&function(ht,nn){for(var Rn=0,cn=0,rr=ht.length,cr=rr-2;cn<rr;cr=cn,cn+=2)Rn+=(ht[cn]-ht[cr])*(ht[cn+1]+ht[cr+1]);if(Rn>0===nn)for(cn=0,rr=ht.length;cn<rr/2;cn+=2){var ir=ht[cn],Mr=ht[cn+1];ht[cn]=ht[rr-2-cn],ht[cn+1]=ht[rr-1-cn],ht[rr-2-cn]=ir,ht[rr-1-cn]=Mr}}(Ct,ot),Oe.push(Ct)}}function Ks(Oe,Y){var ie=(Y=this.options=function(Ye,ot){for(var Mt in ot)Ye[Mt]=ot[Mt];return Ye}(Object.create(this.options),Y)).debug;if(ie&&console.time("preprocess data"),Y.maxZoom<0||Y.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Y.promoteId&&Y.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ye,ot,Mt,Ct,lt,ht,ke=function(Ye,ot){var Mt=[];if("FeatureCollection"===Ye.type)for(var Ct=0;Ct<Ye.features.length;Ct++)mt(Mt,Ye.features[Ct],ot,Ct);else mt(Mt,"Feature"===Ye.type?Ye:{geometry:Ye},ot);return Mt}(Oe,Y);this.tiles={},this.tileCoords=[],ie&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Y.indexMaxZoom,Y.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ct=Ye=ke,lt=lr(Ye,1,-1-(Mt=(ot=Y).buffer/ot.extent),Mt,0,-1,2,ot),ht=lr(Ye,1,1-Mt,2+Mt,0,-1,2,ot),(lt||ht)&&(Ct=lr(Ye,1,-Mt,1+Mt,0,-1,2,ot)||[],lt&&(Ct=ds(lt,1).concat(Ct)),ht&&(Ct=Ct.concat(ds(ht,-1)))),(ke=Ct).length&&this.splitTile(ke,0,0,0),ie&&(ke.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function as(Oe,Y,ie){return 32*((1<<Oe)*ie+Y)+Oe}function $r(Oe,Y){const ie=Oe.tileID.canonical;if(!this._geoJSONIndex)return Y(null,null);const ke=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!ke)return Y(null,null);const Ye=new Dn(ke.features);let ot=ge.exports(Ye);0===ot.byteOffset&&ot.byteLength===ot.buffer.byteLength||(ot=new Uint8Array(ot)),Y(null,{vectorTile:Ye,rawData:ot.buffer})}Ks.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ks.prototype.splitTile=function(Oe,Y,ie,ke,Ye,ot,Mt){for(var Ct=[Oe,Y,ie,ke],lt=this.options,ht=lt.debug;Ct.length;){ke=Ct.pop(),ie=Ct.pop(),Y=Ct.pop(),Oe=Ct.pop();var nn=1<<Y,Rn=as(Y,ie,ke),cn=this.tiles[Rn];if(!cn&&(ht>1&&console.time("creation"),cn=this.tiles[Rn]=Ys(Oe,Y,ie,ke,lt),this.tileCoords.push({z:Y,x:ie,y:ke}),ht)){ht>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Y,ie,ke,cn.numFeatures,cn.numPoints,cn.numSimplified),console.timeEnd("creation"));var rr="z"+Y;this.stats[rr]=(this.stats[rr]||0)+1,this.total++}if(cn.source=Oe,Ye){if(Y===lt.maxZoom||Y===Ye)continue;var cr=1<<Ye-Y;if(ie!==Math.floor(ot/cr)||ke!==Math.floor(Mt/cr))continue}else if(Y===lt.indexMaxZoom||cn.numPoints<=lt.indexMaxPoints)continue;if(cn.source=null,0!==Oe.length){ht>1&&console.time("clipping");var ir,Mr,Dr,ji,tr,gr,Gi=.5*lt.buffer/lt.extent,ks=.5-Gi,ia=.5+Gi,zt=1+Gi;ir=Mr=Dr=ji=null,tr=lr(Oe,nn,ie-Gi,ie+ia,0,cn.minX,cn.maxX,lt),gr=lr(Oe,nn,ie+ks,ie+zt,0,cn.minX,cn.maxX,lt),Oe=null,tr&&(ir=lr(tr,nn,ke-Gi,ke+ia,1,cn.minY,cn.maxY,lt),Mr=lr(tr,nn,ke+ks,ke+zt,1,cn.minY,cn.maxY,lt),tr=null),gr&&(Dr=lr(gr,nn,ke-Gi,ke+ia,1,cn.minY,cn.maxY,lt),ji=lr(gr,nn,ke+ks,ke+zt,1,cn.minY,cn.maxY,lt),gr=null),ht>1&&console.timeEnd("clipping"),Ct.push(ir||[],Y+1,2*ie,2*ke),Ct.push(Mr||[],Y+1,2*ie,2*ke+1),Ct.push(Dr||[],Y+1,2*ie+1,2*ke),Ct.push(ji||[],Y+1,2*ie+1,2*ke+1)}}},Ks.prototype.getTile=function(Oe,Y,ie){var ke=this.options,Ye=ke.extent,ot=ke.debug;if(Oe<0||Oe>24)return null;var Mt=1<<Oe,Ct=as(Oe,Y=(Y%Mt+Mt)%Mt,ie);if(this.tiles[Ct])return Ns(this.tiles[Ct],Ye);ot>1&&console.log("drilling down to z%d-%d-%d",Oe,Y,ie);for(var lt,ht=Oe,nn=Y,Rn=ie;!lt&&ht>0;)ht--,nn=Math.floor(nn/2),Rn=Math.floor(Rn/2),lt=this.tiles[as(ht,nn,Rn)];return lt&&lt.source?(ot>1&&console.log("found parent tile z%d-%d-%d",ht,nn,Rn),ot>1&&console.time("drilling down"),this.splitTile(lt.source,ht,nn,Rn,Oe,Y,ie),ot>1&&console.timeEnd("drilling down"),this.tiles[Ct]?Ns(this.tiles[Ct],Ye):null):null};class Ha extends p.VectorTileWorkerSource{constructor(Y,ie,ke,Ye,ot){super(Y,ie,ke,Ye,$r),ot&&(this.loadGeoJSON=ot)}loadData(Y,ie){const ke=Y&&Y.request,Ye=ke&&ke.collectResourceTiming;this.loadGeoJSON(Y,(ot,Mt)=>{if(ot||!Mt)return ie(ot);if("object"!=typeof Mt)return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));{Lt(Mt,!0);try{if(Y.filter){const lt=p.createExpression(Y.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===lt.result)throw new Error(lt.value.map(nn=>`${nn.key}: ${nn.message}`).join(", "));Mt={type:"FeatureCollection",features:Mt.features.filter(nn=>lt.value.evaluate({zoom:0},nn))}}this._geoJSONIndex=Y.cluster?new Qn(function({superclusterOptions:lt,clusterProperties:ht}){if(!ht||!lt)return lt;const nn={},Rn={},cn={accumulated:null,zoom:0},rr={properties:null},cr=Object.keys(ht);for(const ir of cr){const[Mr,Dr]=ht[ir],ji=p.createExpression(Dr),tr=p.createExpression("string"==typeof Mr?[Mr,["accumulated"],["get",ir]]:Mr);nn[ir]=ji.value,Rn[ir]=tr.value}return lt.map=ir=>{rr.properties=ir;const Mr={};for(const Dr of cr)Mr[Dr]=nn[Dr].evaluate(cn,rr);return Mr},lt.reduce=(ir,Mr)=>{rr.properties=Mr;for(const Dr of cr)cn.accumulated=ir[Dr],ir[Dr]=Rn[Dr].evaluate(cn,rr)},lt}(Y)).load(Mt.features):new Ks(lt=Mt,Y.geojsonVtOptions)}catch(lt){return ie(lt)}this.loaded={};const Ct={};if(Ye){const lt=p.getPerformanceMeasurement(ke);lt&&(Ct.resourceTiming={},Ct.resourceTiming[Y.source]=JSON.parse(JSON.stringify(lt)))}ie(null,Ct)}var lt})}reloadTile(Y,ie){const ke=this.loaded;return ke&&ke[Y.uid]?super.reloadTile(Y,ie):this.loadTile(Y,ie)}loadGeoJSON(Y,ie){if(Y.request)p.getJSON(Y.request,ie);else{if("string"!=typeof Y.data)return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`));try{return ie(null,JSON.parse(Y.data))}catch{return ie(new Error(`Input data given to '${Y.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(Y,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(ke){ie(ke)}}getClusterChildren(Y,ie){try{ie(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(ke){ie(ke)}}getClusterLeaves(Y,ie){try{ie(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(ke){ie(ke)}}}class ns{constructor(Y){this.self=Y,this.actor=new p.Actor(Y,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Ha},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ie,ke)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=ke},this.self.registerRTLTextPlugin=ie=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ie.applyArabicShaping,p.plugin.processBidirectionalText=ie.processBidirectionalText,p.plugin.processStyledBidirectionalText=ie.processStyledBidirectionalText}}clearCaches(Y,ie,ke){delete this.layerIndexes[Y],delete this.availableImages[Y],delete this.workerSources[Y],delete this.demWorkerSources[Y],ke()}checkIfReady(Y,ie,ke){ke()}setReferrer(Y,ie){this.referrer=ie}spriteLoaded(Y,ie){this.isSpriteLoaded[Y]=ie;for(const ke in this.workerSources[Y]){const Ye=this.workerSources[Y][ke];for(const ot in Ye)Ye[ot]instanceof p.VectorTileWorkerSource&&(Ye[ot].isSpriteLoaded=ie,Ye[ot].fire(new p.Event("isSpriteLoaded")))}}setImages(Y,ie,ke){this.availableImages[Y]=ie;for(const Ye in this.workerSources[Y]){const ot=this.workerSources[Y][Ye];for(const Mt in ot)ot[Mt].availableImages=ie}ke()}enableTerrain(Y,ie,ke){this.terrain=ie,ke()}setProjection(Y,ie){this.projections[Y]=p.getProjection(ie)}setLayers(Y,ie,ke){this.getLayerIndex(Y).replace(ie),ke()}updateLayers(Y,ie,ke){this.getLayerIndex(Y).update(ie.layers,ie.removedIds),ke()}loadTile(Y,ie,ke){const Ye=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Ye.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ie.type,ie.source).loadTile(Ye,ke)}loadDEMTile(Y,ie,ke){const Ye=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ie):ie;this.getDEMWorkerSource(Y,ie.source).loadTile(Ye,ke)}reloadTile(Y,ie,ke){const Ye=this.enableTerrain?p.extend({enableTerrain:this.terrain},ie):ie;Ye.projection=this.projections[Y]||this.defaultProjection,this.getWorkerSource(Y,ie.type,ie.source).reloadTile(Ye,ke)}abortTile(Y,ie,ke){this.getWorkerSource(Y,ie.type,ie.source).abortTile(ie,ke)}removeTile(Y,ie,ke){this.getWorkerSource(Y,ie.type,ie.source).removeTile(ie,ke)}removeSource(Y,ie,ke){if(!this.workerSources[Y]||!this.workerSources[Y][ie.type]||!this.workerSources[Y][ie.type][ie.source])return;const Ye=this.workerSources[Y][ie.type][ie.source];delete this.workerSources[Y][ie.type][ie.source],void 0!==Ye.removeSource?Ye.removeSource(ie,ke):ke()}loadWorkerSource(Y,ie,ke){try{this.self.importScripts(ie.url),ke()}catch(Ye){ke(Ye.toString())}}syncRTLPluginState(Y,ie,ke){try{p.plugin.setState(ie);const Ye=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=Ye){this.self.importScripts(Ye);const ot=p.plugin.isParsed();ke(ot?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ye}`),ot)}}catch(Ye){ke(Ye.toString())}}getAvailableImages(Y){let ie=this.availableImages[Y];return ie||(ie=[]),ie}getLayerIndex(Y){let ie=this.layerIndexes[Y];return ie||(ie=this.layerIndexes[Y]=new dt),ie}getWorkerSource(Y,ie,ke){return this.workerSources[Y]||(this.workerSources[Y]={}),this.workerSources[Y][ie]||(this.workerSources[Y][ie]={}),this.workerSources[Y][ie][ke]||(this.workerSources[Y][ie][ke]=new this.workerSourceTypes[ie]({send:(ot,Mt,Ct,lt,ht,nn)=>{this.actor.send(ot,Mt,Ct,Y,ht,nn)},scheduler:this.actor.scheduler},this.getLayerIndex(Y),this.getAvailableImages(Y),this.isSpriteLoaded[Y])),this.workerSources[Y][ie][ke]}getDEMWorkerSource(Y,ie){return this.demWorkerSources[Y]||(this.demWorkerSources[Y]={}),this.demWorkerSources[Y][ie]||(this.demWorkerSources[Y][ie]=new yt),this.demWorkerSources[Y][ie]}enforceCacheSizeLimit(Y,ie){p.enforceCacheSizeLimit(ie)}getWorkerPerformanceMetrics(Y,ie,ke){ke(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new ns(self)),ns}),Ue(0,function(p){function Ce(v,l){if(Array.isArray(v)){if(!Array.isArray(l)||v.length!==l.length)return!1;for(let g=0;g<v.length;g++)if(!Ce(v[g],l[g]))return!1;return!0}if("object"==typeof v&&null!==v&&null!==l){if("object"!=typeof l||Object.keys(v).length!==Object.keys(l).length)return!1;for(const g in v)if(!Ce(v[g],l[g]))return!1;return!0}return v===l}var We=dt;function dt(v){return l=v,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,I,A=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(A);try{I=new Worker(O),b=!0}catch{b=!1}return I&&I.terminate(),URL.revokeObjectURL(O),b}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var b=document.createElement("canvas");b.width=b.height=1;var I=b.getContext("2d");if(!I)return!1;var A=I.getImageData(0,0,1,1);return A&&A.width===b.width}()||(void 0===yt[g=l&&l.failIfMajorPerformanceCaveat]&&(yt[g]=function(b){var I,O,U,j,A=(O=b,U=document.createElement("canvas"),(j=Object.create(dt.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,U.getContext("webgl",j)||U.getContext("experimental-webgl",j));if(!A)return!1;try{I=A.createShader(A.VERTEX_SHADER)}catch{return!1}return!(!I||A.isContextLost())&&(A.shaderSource(I,"void main() {}"),A.compileShader(I),!0===A.getShaderParameter(I,A.COMPILE_STATUS))}(g)),!yt[g]||document.documentMode));var l,g}var yt={};function Lt(v,l,g){const b=p.window.document.createElement(v);return void 0!==l&&(b.className=l),g&&g.appendChild(b),b}function un(v,l,g){const b=p.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const I of Object.keys(l))b.setAttributeNS(null,I,l[I]);return g&&g.appendChild(b),b}dt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Gt=p.window.document&&p.window.document.documentElement.style,Tt=Gt&&void 0!==Gt.userSelect?"userSelect":"WebkitUserSelect";let Xt;function Dn(){Gt&&Tt&&(Xt=Gt[Tt],Gt[Tt]="none")}function ge(){Gt&&Tt&&(Gt[Tt]=Xt)}function Me(v){v.preventDefault(),v.stopPropagation(),p.window.removeEventListener("click",Me,!0)}function de(){p.window.addEventListener("click",Me,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Me,!0)},0)}function Q(v,l){const g=v.getBoundingClientRect();return pe(v,g,l)}function fe(v,l){const g=v.getBoundingClientRect(),b=[];for(let I=0;I<l.length;I++)b.push(pe(v,g,l[I]));return b}function ze(v){return void 0!==p.window.InstallTrigger&&2===v.button&&v.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button}function pe(v,l,g){const b=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new p.pointGeometry((g.clientX-l.left)*b,(g.clientY-l.top)*b)}function le(v,l){var g=l[0],b=l[1],I=l[2],A=l[3],O=g*A-I*b;return O?(v[0]=A*(O=1/O),v[1]=-b*O,v[2]=-I*O,v[3]=g*O,v):null}function we(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class J extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:b}of this.requestors)this._notify(g,b);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,g){this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let b=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),b=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),b=!1),this._validateContent(g.content,g)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),b=!1),b}_validateStretch(l,g){if(!l)return!0;let b=0;for(const I of l){if(I[0]<b||I[1]<I[0]||g<I[1])return!1;b=I[1]}return!0}_validateContent(l,g){return!(l&&(4!==l.length||l[0]<0||g.data.width<l[0]||l[1]<0||g.data.height<l[1]||l[2]<0||g.data.width<l[2]||l[3]<0||g.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,g){g.version=this.images[l].version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let b=!0;if(!this.isLoaded())for(const I of l)this.images[I]||(b=!1);this.isLoaded()||b?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const b={};for(const I of l){this.images[I]||this.fire(new p.Event("styleimagemissing",{id:I}));const A=this.images[I];A?b[I]={data:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:Boolean(A.userImage&&A.userImage.render)}:p.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,b)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],b=this.getImage(l);if(!b)return null;if(g&&g.position.version===b.version)return g.position;if(g)g.position.version=b.version;else{const I={w:b.data.width+2,h:b.data.height+2,x:0,y:0},A=new p.ImagePosition(I,b);this.patterns[l]={bin:I,position:A}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const A in this.patterns)l.push(this.patterns[A].bin);const{w:g,h:b}=p.potpack(l),I=this.atlasImage;I.resize({width:g||1,height:b||1});for(const A in this.patterns){const{bin:O}=this.patterns[A],U=O.x+1,j=O.y+1,H=this.images[A].data,X=H.width,K=H.height;p.RGBAImage.copy(H,I,{x:0,y:0},{x:U,y:j},{width:X,height:K}),p.RGBAImage.copy(H,I,{x:0,y:K-1},{x:U,y:j-1},{width:X,height:1}),p.RGBAImage.copy(H,I,{x:0,y:0},{x:U,y:j+K},{width:X,height:1}),p.RGBAImage.copy(H,I,{x:X-1,y:0},{x:U-1,y:j},{width:1,height:K}),p.RGBAImage.copy(H,I,{x:0,y:0},{x:U+X,y:j},{width:1,height:K})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const b=this.images[g];we(b)&&this.updateImage(g,b)}}}const _t=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(v,l){return function([g,b,I]){const A=p.degToRad(b+90),O=p.degToRad(I);return{x:g*Math.cos(A)*Math.sin(O),y:g*Math.sin(A)*Math.sin(O),z:g*Math.cos(O),azimuthal:b,polar:I}}(v.expression.evaluate(l))}interpolate(v,l,g){return{x:p.number(v.x,l.x,g),y:p.number(v.y,l.y,g),z:p.number(v.z,l.z,g),azimuthal:p.number(v.azimuthal,l.azimuthal,g),polar:p.number(v.polar,l.polar,g)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),Ge="-transition";class $e extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(_t),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(p.validateLight,l,g))for(const b in l){const I=l[b];p.endsWith(b,Ge)?this._transitionable.setTransition(b.slice(0,-Ge.length),I):this._transitionable.setValue(b,I)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,b){return(!b||!1!==b.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ue=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),on="-transition";class kt extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(ue),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=g}get(){return this._transitionable.serialize()}set(l){for(const g in l){const b=l[g];p.endsWith(g,on)?this._transitionable.setTransition(g.slice(0,-on.length),b):this._transitionable.setValue(g,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function Ne(v,l,g,b){const I=p.smoothstep(45,65,g),[A,O]=gt(v,b),U=p.length(l);let j=1-Math.min(1,Math.exp((U-A)/(O-A)*-6));return j*=j*j,j=Math.min(1,1.00747*j),j*I*v.alpha}function gt(v,l){const g=.5/Math.tan(.5*l);return[v.range[0]+g,v.range[1]+g]}const Ee=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])}),it="-transition";class vt extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(Ee),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const l=this._transform,g="globe"===l.projection.name,b=p.globeToMercatorTransition(l.zoom),I=this.properties.get("range"),A=[.5,3];return{range:g?[p.number(A[0],I[0],b),p.number(A[1],I[1],b)]:I,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,g={}){if(!this._validate(p.validateFog,l,g)){for(const b of Object.keys(p.spec.fog))l&&void 0===l[b]&&(l[b]=p.spec.fog[b].default);for(const b in l){const I=l[b];p.endsWith(b,it)?this._transitionable.setTransition(b.slice(0,-it.length),I):this._transitionable.setValue(b,I)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*g.a}getOpacityAtLatLng(l,g){return this._transform.projection.supportsFog?function(b,I,A){const O=p.MercatorCoordinate.fromLngLat(I),U=A.elevation?A.elevation.getAtPointOrZero(O):0,j=[O.x,O.y,U];return p.transformMat4(j,j,A.mercatorFogMatrix),Ne(b,j,A.pitch,A._fov)}(this.state,l,g):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?gt(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,b){return(!b||!1!==b.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Re{constructor(l,g){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const b=this.workerPool.acquire(this.id);for(let I=0;I<b.length;I++){const A=new Re.Actor(b[I],g,this.id);A.name=`Worker ${I}`,this.actors.push(A)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,g,b){p.asyncAll(this.actors,(I,A)=>{I.send(l,g,A)},b=b||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Yt(v,l,g){return l*(p.EXTENT/(v.tileSize*Math.pow(2,g-v.tileID.overscaledZ)))}Re.Actor=p.Actor;class $t{constructor(l,g,b,I){this.screenBounds=l,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=b,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,I)}static createFromScreenPoints(l,g){let b,I;if(l instanceof p.pointGeometry||"number"==typeof l[0]){const A=p.pointGeometry.convert(l);b=[A],I=g.isPointAboveHorizon(A)}else{const A=p.pointGeometry.convert(l[0]),O=p.pointGeometry.convert(l[1]);b=[A,O],I=p.polygonizeBounds(A,O).every(U=>g.isPointAboveHorizon(U))}return new $t(b,g.getCameraPoint(),I,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const g=this.screenBounds[0],b=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<b.x?I.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?I[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(I[3]=this.cameraPoint)),p.bufferConvexPolygon(I,l)}bufferedCameraGeometryGlobe(l){const g=this.screenBounds[0],b=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,b,l),A=this.cameraPoint.clone();switch(3*((A.y>g.y)+(A.y>b.y))+((A.x>g.x)+(A.x>b.x))){case 0:I[0]=A,I[4]=A.clone();break;case 1:I.splice(1,0,A);break;case 2:I[1]=A;break;case 3:I.splice(4,0,A);break;case 5:I.splice(2,0,A);break;case 6:I[3]=A;break;case 7:I.splice(3,0,A);break;case 8:I[2]=A}return I}containsTile(l,g,b,I=0){const A=l.queryPadding/g._pixelsPerMercatorPixel+1,O=b?this._bufferedCameraMercator(A,g):this._bufferedScreenMercator(A,g);let U=l.tileID.wrap+(O.unwrapped?I:0);const j=O.polygon.map(De=>p.getTilePoint(l.tileTransform,De,U));if(!p.polygonIntersectsBox(j,0,0,p.EXTENT,p.EXTENT))return;U=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?I:0);const H=this.screenGeometryMercator.polygon.map(De=>p.getTileVec3(l.tileTransform,De,U)),X=H.map(De=>new p.pointGeometry(De[0],De[1])),K=g.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),_e=p.getTileVec3(l.tileTransform,K,U),Le=H.map(De=>{const Se=p.sub(De,De,_e);return p.normalize(Se,Se),new p.Ray(_e,Se)}),Ie=Yt(l,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:X,tilespaceRays:Le,bufferedTilespaceGeometry:j,bufferedTilespaceBounds:(Fe=p.getBounds(j),Fe.min.x=p.clamp(Fe.min.x,0,p.EXTENT),Fe.min.y=p.clamp(Fe.min.y,0,p.EXTENT),Fe.max.x=p.clamp(Fe.max.x,0,p.EXTENT),Fe.max.y=p.clamp(Fe.max.y,0,p.EXTENT),Fe),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:Ie};var Fe}_bufferedScreenMercator(l,g){const b=Xn(l);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),g):{polygon:this.bufferedScreenGeometry(l).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._screenRaycastCache[b]=I,I}}_bufferedCameraMercator(l,g){const b=Xn(l);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),g):{polygon:this.bufferedCameraGeometry(l).map(A=>g.pointCoordinate3D(A)),unwrapped:!0},this._cameraRaycastCache[b]=I,I}}_projectAndResample(l,g){const b=function(A,O){const U=p.multiply([],O.pixelMatrix,O.globeMatrix),j=[0,-p.GLOBE_RADIUS,0,1],H=[0,p.GLOBE_RADIUS,0,1],X=[0,0,0,1];p.transformMat4$1(j,j,U),p.transformMat4$1(H,H,U),p.transformMat4$1(X,X,U);const K=new p.pointGeometry(j[0]/j[3],j[1]/j[3]),_e=new p.pointGeometry(H[0]/H[3],H[1]/H[3]),Le=p.polygonContainsPoint(A,K)&&j[3]<X[3],Ie=p.polygonContainsPoint(A,_e)&&H[3]<X[3];if(!Le&&!Ie)return null;const Fe=function(ut,Rt,Wt){for(let Vt=1;Vt<ut.length;Vt++){const Ln=jt(Rt.pointCoordinate3D(ut[Vt-1]).x),Dt=jt(Rt.pointCoordinate3D(ut[Vt]).x);if(Wt<0){if(Ln<Dt)return{idx:Vt,t:-Ln/(Dt-1-Ln)}}else if(Dt<Ln)return{idx:Vt,t:(1-Ln)/(Dt+1-Ln)}}return null}(A,O,Le?-1:1);if(!Fe)return null;const{idx:De,t:Se}=Fe;let Be=De>1?Mn(A.slice(0,De),O):[],Ae=De<A.length?Mn(A.slice(De),O):[];Be=Be.map(ut=>new p.pointGeometry(jt(ut.x),ut.y)),Ae=Ae.map(ut=>new p.pointGeometry(jt(ut.x),ut.y));const et=[...Be];0===et.length&&et.push(Ae[Ae.length-1]);const rt=p.number(et[et.length-1].y,(0===Ae.length?Be[0]:Ae[0]).y,Se);let Ze;return Ze=Le?[new p.pointGeometry(0,rt),new p.pointGeometry(0,0),new p.pointGeometry(1,0),new p.pointGeometry(1,rt)]:[new p.pointGeometry(1,rt),new p.pointGeometry(1,1),new p.pointGeometry(0,1),new p.pointGeometry(0,rt)],et.push(...Ze),0===Ae.length?et.push(Be[0]):et.push(...Ae),{polygon:et.map(ut=>new p.MercatorCoordinate(ut.x,ut.y)),unwrapped:!1}}(l,g);if(b)return b;const I=function(A,O){let U=!1,j=-1/0,H=0;for(let K=0;K<A.length-1;K++)A[K].x>j&&(j=A[K].x,H=K);for(let K=0;K<A.length-1;K++){const _e=(H+K)%(A.length-1),Le=A[_e],Ie=A[_e+1];Math.abs(Le.x-Ie.x)>.5&&(Le.x<Ie.x?(Le.x+=1,0===_e&&(A[A.length-1].x+=1)):(Ie.x+=1,_e+1===A.length-1&&(A[0].x+=1)),U=!0)}const X=p.mercatorXfromLng(O.center.lng);return U&&X<Math.abs(X-1)&&A.forEach(K=>{K.x-=1}),{polygon:A,unwrapped:U}}(Mn(l,g).map(A=>new p.pointGeometry(jt(A.x),A.y)),g);return{polygon:I.polygon.map(A=>new p.MercatorCoordinate(A.x,A.y)),unwrapped:I.unwrapped}}}function Mn(v,l){return p.resample(v,g=>{const b=l.pointCoordinate3D(g);g.x=b.x,g.y=b.y},1/256)}function jt(v){return v<0?1+v%1:v%1}function Xn(v){return 100*v|0}function Qn(v,l,g,b,I){const A=function(O,U){if(O)return I(O);if(U){v.url&&U.tiles&&v.tiles&&delete v.tiles;const j=p.pick(p.extend(U,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);U.vector_layers&&(j.vectorLayers=U.vector_layers,j.vectorLayerIds=j.vectorLayers.map(H=>H.id)),j.tiles=l.canonicalizeTileset(j,v.url),I(null,j)}};return v.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(v.url,null,g,b),p.ResourceType.Source),A):p.exported.frame(()=>A(null,v))}class sr{constructor(l,g,b){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=b||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),b=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*g),I=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*g),A=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*g),O=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*g);return l.x>=b&&l.x<A&&l.y>=I&&l.y<O}}class kn{constructor(l,g,b){this.context=l;const I=l.gl;this.buffer=I.createBuffer(),this.dynamicDraw=Boolean(b),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class wn{constructor(l,g,b,I){this.length=g.length,this.attributes=b,this.itemSize=g.bytesPerElement,this.dynamicDraw=I,this.context=l;const A=l.gl;this.buffer=A.createBuffer(),l.bindVertexBuffer.set(this.buffer),A.bufferData(A.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?A.DYNAMIC_DRAW:A.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let b=0;b<this.attributes.length;b++){const I=g.attributes[this.attributes[b].name];void 0!==I&&l.enableVertexAttribArray(I)}}setVertexAttribPointers(l,g,b){for(let I=0;I<this.attributes.length;I++){const A=this.attributes[I],O=g.attributes[A.name];void 0!==O&&l.vertexAttribPointer(O,A.components,l[zn[A.type]],!1,this.itemSize,A.offset+this.itemSize*(b||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class pr{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Jr extends pr{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class ki extends pr{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class _r extends pr{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class Or extends pr{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class St extends pr{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ve extends pr{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class me extends pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class se extends pr{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class Ve extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class mt extends pr{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class qt extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class pn extends pr{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class yn extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class Kt extends pr{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class Pr extends pr{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class lr extends pr{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class On extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class Lr extends pr{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class _i extends pr{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class vi extends pr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class Pi extends pr{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Ri extends pr{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class Sr extends pr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class ds extends pr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Ko extends pr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class Ns extends pr{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ci extends pr{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class Ys extends pr{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class oi extends pr{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class An extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class Ks extends pr{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class as extends pr{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class $r extends as{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Ha extends as{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class ns extends Ha{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Oe{constructor(l,g,b,I){this.context=l,this.width=g,this.height=b;const A=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new $r(l,A),I&&(this.depthAttachment=new Ha(l,A))}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const b=this.depthAttachment.get();b&&l.deleteRenderbuffer(b)}l.deleteFramebuffer(this.framebuffer)}}class Y{constructor(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Jr(this),this.clearDepth=new ki(this),this.clearStencil=new _r(this),this.colorMask=new Or(this),this.depthMask=new St(this),this.stencilMask=new ve(this),this.stencilFunc=new me(this),this.stencilOp=new se(this),this.stencilTest=new Ve(this),this.depthRange=new mt(this),this.depthTest=new qt(this),this.depthFunc=new pn(this),this.blend=new yn(this),this.blendFunc=new Kt(this),this.blendColor=new Pr(this),this.blendEquation=new lr(this),this.cullFace=new On(this),this.cullFaceSide=new Lr(this),this.frontFace=new _i(this),this.program=new vi(this),this.activeTexture=new Pi(this),this.viewport=new Ri(this),this.bindFramebuffer=new Sr(this),this.bindRenderbuffer=new ds(this),this.bindTexture=new Ko(this),this.bindVertexBuffer=new Ns(this),this.bindElementBuffer=new Ci(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ys(this),this.pixelStoreUnpack=new oi(this),this.pixelStoreUnpackPremultiplyAlpha=new An(this),this.pixelStoreUnpackFlipY=new Ks(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new kn(this,l,g)}createVertexBuffer(l,g,b){return new wn(this,l,g,b)}createRenderbuffer(l,g,b){const I=this.gl,A=I.createRenderbuffer();return this.bindRenderbuffer.set(A),I.renderbufferStorage(I.RENDERBUFFER,l,g,b),this.bindRenderbuffer.set(null),A}createFramebuffer(l,g,b){return new Oe(this,l,g,b)}clear({color:l,depth:g,stencil:b}){const I=this.gl;let A=0;l&&(A|=I.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(A|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==b&&(A|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),I.clear(A)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){Ce(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ie extends p.Evented{constructor(l,g,b,I){super(),this.id=l,this.dispatcher=b,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},g),p.extend(this,p.pick(g,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Qn(this._options,this.map._requestManager,null,null,(l,g)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(p.extend(this,g),g.bounds&&(this.tileBounds=new sr(g.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(g.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const b=p.exported.devicePixelRatio>=2,I=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(I,p.ResourceType.Tile),(A,O,U,j)=>(delete l.request,l.aborted?(l.state="unloaded",g(null)):A?(l.state="errored",g(A)):O?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:U,expires:j}),l.setTexture(O,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(l,g,b){l.setTexture(g,b)}static unloadTileData(l,g){l.texture&&g.saveTileTexture(l.texture)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}}let ke;function Ye(v,l,g,b,I,A,O,U){const j=[v,g,I,l,b,A,1,1,1],H=[O,U,1],X=p.adjoint([],j),[K,_e,Le]=p.transformMat3(H,H,p.transpose(X,X));return p.multiply$1(j,[K,0,0,0,_e,0,0,0,Le],j)}class ot extends p.Evented{constructor(l,g,b,I){super(),this.id=l,this.dispatcher=b,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=g,this._dirty=!1}load(l,g){this._loaded=g||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(b,I)=>{if(this._imageRequest=null,this._loaded=!0,b)this.fire(new p.ErrorEvent(b));else if(I){const{HTMLImageElement:A}=p.window;this.image=I instanceof A?p.exported.getImageData(I):I,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const g=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(b){let I=1/0,A=1/0,O=-1/0,U=-1/0;for(const K of b)I=Math.min(I,K.x),A=Math.min(A,K.y),O=Math.max(O,K.x),U=Math.max(U,K.y);const j=Math.max(O-I,U-A),H=Math.max(0,Math.floor(-Math.log(j)/Math.LN2)),X=Math.pow(2,H);return new p.CanonicalTileID(H,Math.floor((I+O)/2*X),Math.floor((A+U)/2*X))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const j in this.tiles){const H=this.tiles[j];"loaded"!==H.state&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray)return;const g=p.tileTransform(this.tileID,this.map.transform.projection),[b,I,A,O]=this.coordinates.map(j=>{const H=g.projection.project(j[0],j[1]);return p.getTilePoint(g,H)._round()});this.perspectiveTransform=function(j,H,X,K,_e,Le,Ie,Fe,De,Se){const Be=Ye(0,0,j,0,0,H,j,H),Ae=Ye(X,K,_e,Le,Ie,Fe,De,Se);return p.multiply$1(Ae,p.adjoint(Be,Be),Ae),[Ae[6]/Ae[8]*j/p.EXTENT,Ae[7]/Ae[8]*H/p.EXTENT]}(this.width,this.height,b.x,b.y,I.x,I.y,O.x,O.y,A.x,A.y);const U=this._boundsArray=new p.StructArrayLayout4i8;U.emplaceBack(b.x,b.y,0,0),U.emplaceBack(I.x,I.y,p.EXTENT,0),U.emplaceBack(O.x,O.y,0,p.EXTENT),U.emplaceBack(A.x,A.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(U,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,g=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const Mt={vector:class extends p.Evented{constructor(v,l,g,b){if(super(),this.id=v,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(l,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(v){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Qn(this._options,this.map._requestManager,l,g,(b,I)=>{this._tileJSONRequest=null,this._loaded=!0,b?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),g&&2!==g.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new p.ErrorEvent(b))):I&&(p.extend(this,I),I.bounds&&(this.tileBounds=new sr(I.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(I.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),v&&v(b)})}loaded(){return this._loaded}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}onAdd(v){this.map=v,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const v=this.map.style._getSourceCaches(this.id);for(const l of v)l.clearTiles()})}setSourceProperty(v){v(),this.reload()}setTiles(v){return this._options.tiles=v,this.reload(),this}setUrl(v){return this.url=v,this._options.url=v,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(v,l){const g=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:v.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,v.actor&&"expired"!==v.state)"loading"===v.state?v.reloadCallback=l:v.request=v.actor.send("reloadTile",b,I.bind(this));else if(v.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)v.request=v.actor.send("loadTile",b,I.bind(this),void 0,!0);else{const A=p.loadVectorTile.call({deduped:this._deduped},b,(O,U)=>{O||!U?I.call(this,O):(b.data={cacheControl:U.cacheControl,expires:U.expires,rawData:U.rawData.slice(0)},v.actor&&v.actor.send("loadTile",b,I.bind(this),void 0,!0))},!0);v.request={cancel:A}}function I(A,O){return delete v.request,v.aborted?l(null):A&&404!==A.status?l(A):(O&&O.resourceTiming&&(v.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&v.setExpiryData(O),v.loadVectorData(O,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(v.reloadCallback&&(this.loadTile(v,v.reloadCallback),v.reloadCallback=null)))}}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.actor&&v.actor.send("abortTile",{uid:v.uid,type:this.type,source:this.id})}unloadTile(v){v.unloadVectorData(),v.actor&&v.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:ie,"raster-dem":class extends ie{constructor(v,l,g,b){super(v,l,g,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const g=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(I,A){I&&(v.state="errored",l(I)),A&&(v.dem=A,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(I,A,O,U){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(I)v.state="errored",l(I);else if(A){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:O,expires:U});const j=p.window.ImageBitmap&&A instanceof p.window.ImageBitmap&&(null==ke&&(ke=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),ke),H=1-(A.width-p.prevPowerOfTwo(A.width))/2;H<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const X=j?A:p.exported.getImageData(A,H),K={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:X,encoding:this.encoding,padding:H};v.actor&&"expired"!==v.state||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",K,b.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(v){const l=v.canonical,g=Math.pow(2,l.z),b=(l.x-1+g)%g,I=0===l.x?v.wrap-1:v.wrap,A=(l.x+1+g)%g,O=l.x+1===g?v.wrap+1:v.wrap,U={};return U[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y).key]={backfilled:!1},U[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y).key]={backfilled:!1},l.y>0&&(U[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y-1).key]={backfilled:!1},U[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},U[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y-1).key]={backfilled:!1}),l.y+1<g&&(U[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y+1).key]={backfilled:!1},U[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},U[new p.OverscaledTileID(v.overscaledZ,O,l.z,A,l.y+1).key]={backfilled:!1}),U}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends p.Evented{constructor(v,l,g,b){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const I=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*I,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*I,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*I,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},l),this}getClusterLeaves(v,l,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:l,offset:g},b),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(v.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(g,b)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new p.ErrorEvent(g));else{const I={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(I.resourceTiming=b.resourceTiming[this.id]),this.fire(new p.Event("data",I)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,l){const g=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(g,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(b,I)=>(delete v.request,v.unloadVectorData(),v.aborted?l(null):b?l(b):(v.loadVectorData(I,this.map.painter,"reloadTile"===g),l(null))),void 0,"loadTile"===g)}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ot{constructor(v,l,g,b){super(v,l,g,b),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,g)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(v,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ot,canvas:class extends ot{constructor(v,l,g,b){super(v,l,g,b),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(I=>!Array.isArray(I)||2!==I.length||I.some(A=>"number"!=typeof A))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends p.Evented{constructor(v,l,g,b){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=l,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new sr(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this._map=v,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:l,y:g,z:b}=v.canonical;return this._implementation.hasTile({x:l,y:g,z:b})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,l){const{x:g,y:b,z:I}=v.tileID.canonical,A=new p.window.AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:g,y:b,z:I},{signal:A.signal})).then(function(O){return delete v.request,v.aborted?(v.state="unloaded",l(null)):void 0===O?(v.state="errored",l(null)):null===O?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",l(null)):(U=O)instanceof p.window.ImageData||U instanceof p.window.HTMLCanvasElement||U instanceof p.window.ImageBitmap||U instanceof p.window.HTMLImageElement?(this.loadTileData(v,O),v.state="loaded",void l(null)):(v.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var U}.bind(this)).catch(O=>{20!==O.code&&(v.state="errored",l(O))}),v.request.cancel=()=>A.abort()}loadTileData(v,l){ie.loadTileData(v,l,this._map.painter)}unloadTileData(v){ie.unloadTileData(v,this._map.painter)}unloadTile(v,l){if(this.unloadTileData(v),this._implementation.unloadTile){const{x:g,y:b,z:I}=v.tileID.canonical;this._implementation.unloadTile({x:g,y:b,z:I})}l()}abortTile(v,l){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Ct=function(v,l,g,b){const I=new Mt[l.type](v,l,g,b);if(I.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${I.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],I),I};function lt(v,l){const g=p.identity([]);return p.scale(g,g,[.5*v.width,.5*-v.height,1]),p.translate(g,g,[1,-1,0]),p.multiply(g,g,v.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(g)}function ht(v,l,g,b,I,A,O,U=!1){const j=v.tilesIn(b,O,U);j.sort(Rn);const H=[];for(const K of j)H.push({wrappedTileID:K.tile.tileID.wrapped().key,queryResults:K.tile.queryRenderedFeatures(l,g,v._state,K,I,A,lt(v.transform,K.tile.tileID),U)});const X=function(K){const _e={},Le={};for(const Ie of K){const Fe=Ie.queryResults,De=Ie.wrappedTileID,Se=Le[De]=Le[De]||{};for(const Be in Fe){const Ae=Fe[Be],et=Se[Be]=Se[Be]||{},rt=_e[Be]=_e[Be]||[];for(const Ze of Ae)et[Ze.featureIndex]||(et[Ze.featureIndex]=!0,rt.push(Ze))}}return _e}(H);for(const K in X)X[K].forEach(_e=>{const Le=_e.feature,Ie=Le.layer;Ie&&"background"!==Ie.type&&"sky"!==Ie.type&&(Le.source=Ie.source,Ie["source-layer"]&&(Le.sourceLayer=Ie["source-layer"]),Le.state=void 0!==Le.id?v.getFeatureState(Ie["source-layer"],Le.id):{})});return X}function nn(v,l){const g=v.getRenderableIds().map(A=>v.getTileByID(A)),b=[],I={};for(let A=0;A<g.length;A++){const O=g[A],U=O.tileID.canonical.key;I[U]||(I[U]=!0,O.querySourceFeatures(b,l))}return b}function Rn(v,l){const g=v.tileID,b=l.tileID;return g.overscaledZ-b.overscaledZ||g.canonical.y-b.canonical.y||g.wrap-b.wrap||g.canonical.x-b.canonical.x}function cn(){return null!=Pf.workerClass?new Pf.workerClass:new p.window.Worker(Pf.workerUrl)}const rr="mapboxgl_preloaded_worker_pool";class cr{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<cr.workerCount;)this.workers.push(new cn);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[rr]}numActive(){return Object.keys(this.active).length}}let ir;function Mr(){return ir||(ir=new cr),ir}function Dr(v,l){const g={};for(const b in v)"ref"!==b&&(g[b]=v[b]);return p.refProperties.forEach(b=>{b in l&&(g[b]=l[b])}),g}function ji(v){v=v.slice();const l=Object.create(null);for(let g=0;g<v.length;g++)l[v[g].id]=v[g];for(let g=0;g<v.length;g++)"ref"in v[g]&&(v[g]=Dr(v[g],l[v[g].ref]));return v}cr.workerCount=2;const tr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function gr(v,l,g){g.push({command:tr.addSource,args:[v,l[v]]})}function Gi(v,l,g){l.push({command:tr.removeSource,args:[v]}),g[v]=!0}function ks(v,l,g,b){Gi(v,g,b),gr(v,l,g)}function ia(v,l,g){let b;for(b in v[g])if(v[g].hasOwnProperty(b)&&"data"!==b&&!Ce(v[g][b],l[g][b]))return!1;for(b in l[g])if(l[g].hasOwnProperty(b)&&"data"!==b&&!Ce(v[g][b],l[g][b]))return!1;return!0}function zt(v,l,g,b,I,A){let O;for(O in l=l||{},v=v||{})v.hasOwnProperty(O)&&(Ce(v[O],l[O])||g.push({command:A,args:[b,O,l[O],I]}));for(O in l)l.hasOwnProperty(O)&&!v.hasOwnProperty(O)&&(Ce(v[O],l[O])||g.push({command:A,args:[b,O,l[O],I]}))}function Na(v){return v.id}function so(v,l){return v[l.id]=l,v}class Hi{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let g=1,b=this._distances[g];const I=l*this.paddedLength+this.padding;for(;b<I&&g<this._distances.length;)b=this._distances[++g];const A=g-1,O=this._distances[A],U=b-O,j=U>0?(I-O)/U:0;return this.points[A].mult(1-j).add(this.points[g].mult(j))}}class Ki{constructor(l,g,b){const I=this.boxCells=[],A=this.circleCells=[];this.xCellCount=Math.ceil(l/b),this.yCellCount=Math.ceil(g/b);for(let O=0;O<this.xCellCount*this.yCellCount;O++)I.push([]),A.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,b,I,A){this._forEachCell(g,b,I,A,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(I),this.bboxes.push(A)}insertCircle(l,g,b,I){this._forEachCell(g-I,b-I,g+I,b+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(b),this.circles.push(I)}_insertBoxCell(l,g,b,I,A,O){this.boxCells[A].push(O)}_insertCircleCell(l,g,b,I,A,O){this.circleCells[A].push(O)}_query(l,g,b,I,A,O){if(b<0||l>this.width||I<0||g>this.height)return!A&&[];const U=[];if(l<=0&&g<=0&&this.width<=b&&this.height<=I){if(A)return!0;for(let j=0;j<this.boxKeys.length;j++)U.push({key:this.boxKeys[j],x1:this.bboxes[4*j],y1:this.bboxes[4*j+1],x2:this.bboxes[4*j+2],y2:this.bboxes[4*j+3]});for(let j=0;j<this.circleKeys.length;j++){const H=this.circles[3*j],X=this.circles[3*j+1],K=this.circles[3*j+2];U.push({key:this.circleKeys[j],x1:H-K,y1:X-K,x2:H+K,y2:X+K})}return O?U.filter(O):U}return this._forEachCell(l,g,b,I,this._queryCell,U,{hitTest:A,seenUids:{box:{},circle:{}}},O),A?U.length>0:U}_queryCircle(l,g,b,I,A){const O=l-b,U=l+b,j=g-b,H=g+b;if(U<0||O>this.width||H<0||j>this.height)return!I&&[];const X=[];return this._forEachCell(O,j,U,H,this._queryCellCircle,X,{hitTest:I,circle:{x:l,y:g,radius:b},seenUids:{box:{},circle:{}}},A),I?X.length>0:X}query(l,g,b,I,A){return this._query(l,g,b,I,!1,A)}hitTest(l,g,b,I,A){return this._query(l,g,b,I,!0,A)}hitTestCircle(l,g,b,I){return this._queryCircle(l,g,b,!0,I)}_queryCell(l,g,b,I,A,O,U,j){const H=U.seenUids,X=this.boxCells[A];if(null!==X){const _e=this.bboxes;for(const Le of X)if(!H.box[Le]){H.box[Le]=!0;const Ie=4*Le;if(l<=_e[Ie+2]&&g<=_e[Ie+3]&&b>=_e[Ie+0]&&I>=_e[Ie+1]&&(!j||j(this.boxKeys[Le]))){if(U.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[Le],x1:_e[Ie],y1:_e[Ie+1],x2:_e[Ie+2],y2:_e[Ie+3]})}}}const K=this.circleCells[A];if(null!==K){const _e=this.circles;for(const Le of K)if(!H.circle[Le]){H.circle[Le]=!0;const Ie=3*Le;if(this._circleAndRectCollide(_e[Ie],_e[Ie+1],_e[Ie+2],l,g,b,I)&&(!j||j(this.circleKeys[Le]))){if(U.hitTest)return O.push(!0),!0;{const Fe=_e[Ie],De=_e[Ie+1],Se=_e[Ie+2];O.push({key:this.circleKeys[Le],x1:Fe-Se,y1:De-Se,x2:Fe+Se,y2:De+Se})}}}}}_queryCellCircle(l,g,b,I,A,O,U,j){const H=U.circle,X=U.seenUids,K=this.boxCells[A];if(null!==K){const Le=this.bboxes;for(const Ie of K)if(!X.box[Ie]){X.box[Ie]=!0;const Fe=4*Ie;if(this._circleAndRectCollide(H.x,H.y,H.radius,Le[Fe+0],Le[Fe+1],Le[Fe+2],Le[Fe+3])&&(!j||j(this.boxKeys[Ie])))return O.push(!0),!0}}const _e=this.circleCells[A];if(null!==_e){const Le=this.circles;for(const Ie of _e)if(!X.circle[Ie]){X.circle[Ie]=!0;const Fe=3*Ie;if(this._circlesCollide(Le[Fe],Le[Fe+1],Le[Fe+2],H.x,H.y,H.radius)&&(!j||j(this.circleKeys[Ie])))return O.push(!0),!0}}}_forEachCell(l,g,b,I,A,O,U,j){const H=this._convertToXCellCoord(l),X=this._convertToYCellCoord(g),K=this._convertToXCellCoord(b),_e=this._convertToYCellCoord(I);for(let Le=H;Le<=K;Le++)for(let Ie=X;Ie<=_e;Ie++)if(A.call(this,l,g,b,I,this.xCellCount*Ie+Le,O,U,j))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,b,I,A,O){const U=I-l,j=A-g,H=b+O;return H*H>U*U+j*j}_circleAndRectCollide(l,g,b,I,A,O,U){const j=(O-I)/2,H=Math.abs(l-(I+j));if(H>j+b)return!1;const X=(U-A)/2,K=Math.abs(g-(A+X));if(K>X+b)return!1;if(H<=j||K<=X)return!0;const _e=H-j,Le=K-X;return _e*_e+Le*Le<=b*b}}const du=Math.tan(85*Math.PI/180);function Ea(v,l,g,b,I,A,O){const U=p.create();if(g)if("globe"===A.name){const j=p.calculateGlobeLabelMatrix(I,l);p.multiply(U,U,j)}else{const j=le([],O);U[0]=j[0],U[1]=j[1],U[4]=j[2],U[5]=j[3],b||p.rotateZ(U,U,I.angle)}else p.multiply(U,I.labelPlaneMatrix,v);return U}function Ca(v,l,g,b,I,A,O){const U=Ea(v,l,g,b,I,A,O);return"globe"===A.name&&g||(U[2]=U[6]=U[10]=U[14]=0),U}function Fi(v,l,g,b,I,A,O){if(g){if("globe"===A.name){const U=Ea(v,l,g,b,I,A,O);return p.invert(U,U),p.multiply(U,v,U),U}{const U=p.clone(v),j=p.identity([]);return j[0]=O[0],j[1]=O[1],j[4]=O[2],j[5]=O[3],p.multiply(U,U,j),b||p.rotateZ(U,U,-I.angle),U}}return I.glCoordMatrix}function gn(v,l,g=0){const b=[v.x,v.y,g,1];g?p.transformMat4$1(b,b,l):q(b,b,l);const I=b[3];return{point:[b[0]/I,b[1]/I,b[2]/I],signedDistanceFromCamera:I}}function or(v,l){const g=[v[0],v[1],v[2],1];p.transformMat4$1(g,g,l);const b=g[3];return{point:[g[0]/b,g[1]/b,g[2]/b],signedDistanceFromCamera:b}}function Vr(v,l){return Math.min(.5+v/l*.5,1.5)}function Eu(v,l){const g=v[0]/v[3],b=v[1]/v[3];return g>=-l[0]&&g<=l[0]&&b>=-l[1]&&b<=l[1]}function sl(v,l,g,b,I,A,O,U,j,H){const X=g.transform,K=b?v.textSizeData:v.iconSizeData,_e=p.evaluateSizeForZoom(K,g.transform.zoom),Le="globe"===X.projection.name,Ie=[256/g.width*2+1,256/g.height*2+1],Fe=b?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Fe.clear();let De=null;Le&&(De=b?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const Se=v.lineVertexArray,Be=b?v.text.placedSymbolArray:v.icon.placedSymbolArray,Ae=g.transform.width/g.transform.height;let et=!1;for(let rt=0;rt<Be.length;rt++){const Ze=Be.get(rt);if(Ze.writingMode!==p.WritingMode.vertical||et||0!==rt&&Be.get(rt-1).writingMode===p.WritingMode.horizontal||(et=!0),(Ze.hidden||Ze.writingMode===p.WritingMode.vertical)&&!et){k(Ze.numGlyphs,Fe);continue}et=!1;const ut=new p.pointGeometry(Ze.tileAnchorX,Ze.tileAnchorY),Rt=j?j(ut):[0,0,0],Wt=X.projection.projectTilePoint(ut.x,ut.y,H.canonical),Vt=[Wt.x+Rt[0],Wt.y+Rt[1],Wt.z+Rt[2]],Ln=[...Vt,1];if(p.transformMat4$1(Ln,Ln,l),!Eu(Ln,Ie)){k(Ze.numGlyphs,Fe);continue}const Dt=Vr(g.transform.cameraToCenterDistance,Ln[3]),dn=p.evaluateSizeForFeature(K,_e,Ze),fn=O?dn/Dt:dn*Dt,Ft=gn(new p.pointGeometry(Vt[0],Vt[1]),I,Vt[2]);if(Ft.signedDistanceFromCamera<=0){k(Ze.numGlyphs,Fe);continue}let bt={};const Jn=O?null:j,Nn=oa(Ze,fn,!1,U,l,I,A,v.glyphOffsetArray,Se,Fe,De,Ft.point,ut,bt,Ae,Jn,X.projection,H,O);et=Nn.useVertical,Jn&&Nn.needsFlipping&&(bt={}),(Nn.notEnoughRoom||et||Nn.needsFlipping&&oa(Ze,fn,!0,U,l,I,A,v.glyphOffsetArray,Se,Fe,De,Ft.point,ut,bt,Ae,Jn,X.projection,H,O).notEnoughRoom)&&k(Ze.numGlyphs,Fe)}b?(v.text.dynamicLayoutVertexBuffer.updateData(Fe),De&&v.text.globeExtVertexBuffer.updateData(De)):(v.icon.dynamicLayoutVertexBuffer.updateData(Fe),De&&v.icon.globeExtVertexBuffer.updateData(De))}function hn(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe){const De=U.glyphStartIndex+U.numGlyphs,Se=U.lineStartIndex,Be=U.lineStartIndex+U.lineLength,Ae=l.getoffsetX(U.glyphStartIndex),et=l.getoffsetX(De-1),rt=Fn(v*Ae,g,b,I,A,O,U.segment,Se,Be,j,H,X,K,_e,!0,Le,Ie,Fe);if(!rt)return null;const Ze=Fn(v*et,g,b,I,A,O,U.segment,Se,Be,j,H,X,K,_e,!0,Le,Ie,Fe);return Ze?{first:rt,last:Ze}:null}function Wu(v,l,g,b){return v.writingMode===p.WritingMode.horizontal&&Math.abs(g.y-l.y)>Math.abs(g.x-l.x)*b?{useVertical:!0}:v.writingMode===p.WritingMode.vertical?l.y<g.y?{needsFlipping:!0}:null:0!==v.flipState&&function(I,A,O){const U=(A.x-I.x)*O;return 0===U||Math.abs((A.y-I.y)/U)>du}(l,g,b)?1===v.flipState?{needsFlipping:!0}:null:l.x>g.x?{needsFlipping:!0}:null}function oa(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe,De,Se,Be){const Ae=l/24,et=v.lineOffsetX*Ae,rt=v.lineOffsetY*Ae;let Ze=[];if(v.numGlyphs>1){const ut=v.glyphStartIndex+v.numGlyphs,Rt=v.lineStartIndex,Wt=v.lineStartIndex+v.lineLength,Vt=hn(Ae,U,et,rt,g,K,_e,v,j,A,Le,Fe,!1,De,Se,Be);if(!Vt)return{notEnoughRoom:!0};const Ln=or(Vt.first.point,O).point,Dt=or(Vt.last.point,O).point,dn=new p.pointGeometry(Ln[0],Ln[1]),fn=new p.pointGeometry(Dt[0],Dt[1]);if(b&&!g){const Ft=Wu(v,dn,fn,Ie);if(v.flipState=Ft&&Ft.needsFlipping?1:2,Ft)return Ft}Ze=[Vt.first];for(let Ft=v.glyphStartIndex+1;Ft<ut-1;Ft++){const bt=Fn(Ae*U.getoffsetX(Ft),et,rt,g,K,_e,v.segment,Rt,Wt,j,A,Le,Fe,!1,!1,De,Se,Be);if(!bt)return{notEnoughRoom:!0};Ze.push(bt)}Ze.push(Vt.last)}else{if(b&&!g){const Rt=gn(_e,I).point,Wt=v.lineStartIndex+v.segment+1,Vt=new p.pointGeometry(j.getx(Wt),j.gety(Wt)),Ln=gn(Vt,I),Dt=Ln.signedDistanceFromCamera>0?Ln.point:Br(_e,Vt,Rt,1,I,void 0,De,Se.canonical),dn=Wu(v,new p.pointGeometry(Rt[0],Rt[1]),new p.pointGeometry(Dt[0],Dt[1]),Ie);if(v.flipState=dn&&dn.needsFlipping?1:2,dn)return dn}const ut=Fn(Ae*U.getoffsetX(v.glyphStartIndex),et,rt,g,K,_e,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,j,A,Le,Fe,!1,!1,De,Se,Be);if(!ut)return{notEnoughRoom:!0};Ze=[ut]}if(X)for(const ut of Ze)p.updateGlobeVertexNormal(X,H.length+0,ut.up[0],ut.up[1],ut.up[2]),p.updateGlobeVertexNormal(X,H.length+1,ut.up[0],ut.up[1],ut.up[2]),p.updateGlobeVertexNormal(X,H.length+2,ut.up[0],ut.up[1],ut.up[2]),p.updateGlobeVertexNormal(X,H.length+3,ut.up[0],ut.up[1],ut.up[2]),p.addDynamicAttributes(H,ut.point[0],ut.point[1],ut.point[2],ut.angle);else for(const ut of Ze)p.addDynamicAttributes(H,ut.point[0],ut.point[1],ut.point[2],ut.angle);return{}}function Nl(v,l,g,b,I){const A=b.projectTilePoint(v.x,v.y,l);if(!I)return gn(A,g,A.z);const O=I(v);return gn(new p.pointGeometry(A.x+O[0],A.y+O[1]),g,A.z+O[2])}function Br(v,l,g,b,I,A,O,U){const j=Nl(v.add(v.sub(l)._unit()),U,I,O,A).point,H=p.sub([],g,j);return p.scaleAndAdd([],g,H,b/p.length(H))}function Fn(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe,De,Se){const Be=b?v-l:v+l;let Ae=Be>0?1:-1,et=0;b&&(Ae*=-1,et=Math.PI),Ae<0&&(et+=Math.PI);let rt=Ae>0?U+O:U+O+1,Ze=I,ut=I,Rt=0,Wt=0;const Vt=Math.abs(Be),Ln=[],Dt=[];let dn=A;const fn=()=>{const Un=rt-Ae;return 0===Rt?A:new p.pointGeometry(H.getx(Un),H.gety(Un))},Ft=()=>{const Un=fn();return Br(Un,dn||Un,ut,Vt-Rt+1,X,_e,Fe,De.canonical)};for(;Rt+Wt<=Vt;){if(rt+=Ae,rt<U||rt>=j)return null;if(ut=Ze,Ln.push(Ze),Le&&Dt.push(dn||fn()),Ze=K[rt],void 0===Ze){dn=new p.pointGeometry(H.getx(rt),H.gety(rt));const Un=Nl(dn,De.canonical,X,Fe,_e);Ze=Un.signedDistanceFromCamera>0?K[rt]=Un.point:Ft()}else dn=null;Rt+=Wt,Wt=p.distance(ut,Ze)}dn=dn||new p.pointGeometry(H.getx(rt),H.gety(rt));const bt=fn();Ie&&_e&&(K[rt]=Ze=void 0===K[rt]?Ze:Ft(),Wt=p.distance(ut,Ze));const Jn=(Vt-Rt)/Wt,Nn=dn.sub(bt).mult(Jn)._add(bt),Vn=p.sub([],Ze,ut),Bn=p.scaleAndAdd([],ut,Vn,Jn);let fr=[0,0,1],qr=Vn[0],kr=Vn[1];if(Se&&(fr=Fe.upVector(De.canonical,Nn.x,Nn.y),0!==fr[0]||0!==fr[1]||1!==fr[2])){const Un=[1,0,0],Zr=[0,1,0];Un[0]=fr[2],Un[1]=0,Un[2]=-fr[0],p.cross(Zr,fr,Un),p.normalize(Un,Un),p.normalize(Zr,Zr),qr=p.dot(Vn,Un),kr=p.dot(Vn,Zr)}if(g){const Un=p.cross([],fr,Vn);p.normalize(Un,Un),p.scaleAndAdd(Bn,Bn,Un,g*Ae)}const wr=et+Math.atan2(kr,qr);return Ln.push(Bn),Le&&Dt.push(Nn),{point:Bn,angle:wr,path:Ln,tilePath:Dt,up:fr}}const Cc=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function k(v,l){for(let g=0;g<v;g++){const b=l.length;l.resize(b+4),l.float32.set(Cc,4*b)}}function q(v,l,g){const b=l[0],I=l[1];return v[0]=g[0]*b+g[4]*I+g[12],v[1]=g[1]*b+g[5]*I+g[13],v[3]=g[3]*b+g[7]*I+g[15],v}const he=100;class pt{constructor(l,g,b=new Ki(l.width+200,l.height+200,25),I=new Ki(l.width+200,l.height+200,25)){this.transform=l,this.grid=b,this.ignoredGrid=I,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+he,this.screenBottomBoundary=l.height+he,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=g}placeCollisionBox(l,g,b,I,A,O,U,j){let H=b.projectedAnchorX,X=b.projectedAnchorY,K=b.projectedAnchorZ;const _e=b.elevation,Le=b.tileID;if(_e&&Le){const rt=l.getProjection().upVector(Le.canonical,b.tileAnchorX,b.tileAnchorY),Ze=l.getProjection().upVectorScale(Le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;H+=rt[0]*_e*Ze,X+=rt[1]*_e*Ze,K+=rt[2]*_e*Ze}const Ie=this.projectAndGetPerspectiveRatio(U,[H,X,K],b.tileID,"globe"===l.projection.name||!!_e||this.transform.pitch>0,l.getProjection()),Fe=O*Ie.perspectiveRatio,De=(b.x1*g+I.x-b.padding)*Fe+Ie.point.x,Se=(b.y1*g+I.y-b.padding)*Fe+Ie.point.y,Be=(b.x2*g+I.x+b.padding)*Fe+Ie.point.x,Ae=(b.y2*g+I.y+b.padding)*Fe+Ie.point.y,et=Ie.perspectiveRatio<=.55||Ie.occluded;return!this.isInsideGrid(De,Se,Be,Ae)||!A&&this.grid.hitTest(De,Se,Be,Ae,j)||et?{box:[],offscreen:!1,occluded:Ie.occluded}:{box:[De,Se,Be,Ae],offscreen:this.isOffscreen(De,Se,Be,Ae),occluded:!1}}placeCollisionCircles(l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe){const De=[],Se=this.transform.elevation,Be=Se?Se.getAtTileOffsetFunc(Fe,this.transform.center.lat,this.transform.worldSize,l.getProjection()):bt=>[0,0,0],Ae=new p.pointGeometry(b.tileAnchorX,b.tileAnchorY),et=l.getProjection().projectTilePoint(b.tileAnchorX,b.tileAnchorY,Fe.canonical),rt=Be(Ae),Ze=[et.x+rt[0],et.y+rt[1],et.z+rt[2]],ut="globe"===l.projection.name,Rt=this.projectAndGetPerspectiveRatio(U,[Ze[0],Ze[1],Ze[2]],Fe,ut||!!Se||this.transform.pitch>0,l.getProjection()),{perspectiveRatio:Wt}=Rt,Vt=(K?O/Wt:O*Wt)/p.ONE_EM,Ln=gn(new p.pointGeometry(Ze[0],Ze[1]),j,Ze[2]).point,Dt=Rt.signedDistanceFromCamera>0?hn(Vt,A,b.lineOffsetX*Vt,b.lineOffsetY*Vt,!1,Ln,Ae,b,I,j,{},Se&&!K?Be:null,K&&!!Se,l.getProjection(),Fe,K):null;let dn=!1,fn=!1,Ft=!0;if(Dt&&!Rt.occluded){const bt=.5*Le*Wt+Ie,Jn=new p.pointGeometry(-100,-100),Nn=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Vn=new Hi,Bn=Dt.first,fr=Dt.last;let qr=[];for(let Un=Bn.path.length-1;Un>=1;Un--)qr.push(Bn.path[Un]);for(let Un=1;Un<fr.path.length;Un++)qr.push(fr.path[Un]);const kr=2.5*bt;if(H){const Un=qr.map(Se&&!ut?(Zr,wi)=>{const $o=Be(wi<Bn.path.length-1?Bn.tilePath[Bn.path.length-1-wi]:fr.tilePath[wi-Bn.path.length+2]);return Zr[2]=$o[2],or(Zr,H)}:Zr=>or(Zr,H));qr=Un.some(Zr=>Zr.signedDistanceFromCamera<=0)?[]:Un.map(Zr=>Zr.point)}let wr=[];if(qr.length>0){const Un=qr.map(qo=>new p.pointGeometry(qo[0],qo[1]));let Zr=1/0,wi=-1/0,$o=1/0,ms=-1/0;for(let qo=0;qo<Un.length;qo++)Zr=Math.min(Zr,Un[qo].x),$o=Math.min($o,Un[qo].y),wi=Math.max(wi,Un[qo].x),ms=Math.max(ms,Un[qo].y);wr=Zr>=Jn.x&&wi<=Nn.x&&$o>=Jn.y&&ms<=Nn.y?[Un]:wi<Jn.x||Zr>Nn.x||ms<Jn.y||$o>Nn.y?[]:p.clipLine([Un],Jn.x,Jn.y,Nn.x,Nn.y)}for(const Un of wr){Vn.reset(Un,.25*bt);let Zr=0;Zr=Vn.length<=.5*bt?1:Math.ceil(Vn.paddedLength/kr)+1;for(let wi=0;wi<Zr;wi++){const $o=wi/Math.max(Zr-1,1),ms=Vn.lerp($o),qo=ms.x+he,ja=ms.y+he;De.push(qo,ja,bt,0);const Uu=qo-bt,Wa=ja-bt,As=qo+bt,Ps=ja+bt;if(Ft=Ft&&this.isOffscreen(Uu,Wa,As,Ps),fn=fn||this.isInsideGrid(Uu,Wa,As,Ps),!g&&this.grid.hitTestCircle(qo,ja,bt,_e)&&(dn=!0,!X))return{circles:[],offscreen:!1,collisionDetected:dn,occluded:!1}}}}return{circles:!X&&dn||!fn?[]:De,offscreen:Ft,collisionDetected:dn,occluded:Rt.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let b=1/0,I=1/0,A=-1/0,O=-1/0;for(const X of l){const K=new p.pointGeometry(X.x+he,X.y+he);b=Math.min(b,K.x),I=Math.min(I,K.y),A=Math.max(A,K.x),O=Math.max(O,K.y),g.push(K)}const U=this.grid.query(b,I,A,O).concat(this.ignoredGrid.query(b,I,A,O)),j={},H={};for(const X of U){const K=X.key;if(void 0===j[K.bucketInstanceId]&&(j[K.bucketInstanceId]={}),j[K.bucketInstanceId][K.featureIndex])continue;const _e=[new p.pointGeometry(X.x1,X.y1),new p.pointGeometry(X.x2,X.y1),new p.pointGeometry(X.x2,X.y2),new p.pointGeometry(X.x1,X.y2)];p.polygonIntersectsPolygon(g,_e)&&(j[K.bucketInstanceId][K.featureIndex]=!0,void 0===H[K.bucketInstanceId]&&(H[K.bucketInstanceId]=[]),H[K.bucketInstanceId].push(K.featureIndex))}return H}insertCollisionBox(l,g,b,I,A){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:I,collisionGroupID:A},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,b,I,A){const O=g?this.ignoredGrid:this.grid,U={bucketInstanceId:b,featureIndex:I,collisionGroupID:A};for(let j=0;j<l.length;j+=4)O.insertCircle(U,l[j],l[j+1],l[j+2])}projectAndGetPerspectiveRatio(l,g,b,I,A){const O=[g[0],g[1],g[2],1];let U=!1;if(g[2]||this.transform.pitch>0){p.transformMat4$1(O,O,l);const j="globe"===A.name;this.fogState&&b&&!j&&(U=function(H,X,K,_e,Le,Ie){const Fe=Ie.calculateFogTileMatrix(Le),De=[X,K,_e];return p.transformMat4(De,De,Fe),Ne(H,De,Ie.pitch,Ie._fov)}(this.fogState,g[0],g[1],g[2],b.toUnwrapped(),this.transform)>.9)}else q(O,O,l);return{point:new p.pointGeometry((O[0]/O[3]+1)/2*this.transform.width+he,(-O[1]/O[3]+1)/2*this.transform.height+he),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(A)/O[3]*.5,1.5),signedDistanceFromCamera:O[3],occluded:I&&O[2]>O[3]||U}}isOffscreen(l,g,b,I){return b<he||l>=this.screenRightBoundary||I<he||g>this.screenBottomBoundary}isInsideGrid(l,g,b,I){return b>=0&&l<this.gridRightBoundary&&I>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function Bt(v,l,g){const b=l.createTileMatrix(v,v.worldSize,g.toUnwrapped());return p.multiply(new Float32Array(16),v.projMatrix,b)}function je(v,l,g){if(l.projection.name===g.projection.name)return v.projMatrix;const b=g.clone();return b.setProjection(l.projection),Bt(b,l.getProjection(),v)}function At(v,l,g){return l.name===g.projection.name?v.projMatrix:Bt(g,l,v)}class Cn{constructor(l,g,b,I){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):I&&b?1:0,this.placed=b}isHidden(){return 0===this.opacity&&!this.placed}}class vn{constructor(l,g,b,I,A,O=!1){this.text=new Cn(l?l.text:null,g,b,A),this.icon=new Cn(l?l.icon:null,g,I,A),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class jn{constructor(l,g,b,I=!1){this.text=l,this.icon=g,this.skipFade=b,this.clipped=I}}class wt{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class Sn{constructor(l,g,b,I,A){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=b,this.bucketIndex=I,this.tileID=A}}class Pn{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:b=>b.collisionGroupID===g}}return this.collisionGroups[l]}}function $n(v,l,g,b,I){const{horizontalAlign:A,verticalAlign:O}=p.getAnchorAlignment(v),U=-(A-.5)*l,j=-(O-.5)*g,H=p.evaluateVariableOffset(v,b);return new p.pointGeometry(U+H[0]*I,j+H[1]*I)}function Ar(v,l,g,b,I){const A=new p.pointGeometry(v,l);return g&&A._rotate(b?I:-I),A}class $s{constructor(l,g,b,I,A){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new pt(this.transform,A),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new Pn(b),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,b,I){const A=b.getBucket(g),O=b.latestFeatureIndex;if(!A||!O||g.id!==A.layerIds[0])return;const U=A.layers[0].layout,j=b.collisionBoxArray,H=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),X=b.tileSize/p.EXTENT,K=b.tileID.toUnwrapped();this.transform.setProjection(A.projection);const _e=(Le=b.tileID,Ie=A.getProjection(),Fe=this.transform,Ie.name===this.projection?Fe.calculateProjMatrix(Le.toUnwrapped()):Bt(Fe,Ie,Le));var Le,Ie,Fe;const De="map"===U.get("text-pitch-alignment"),Se="map"===U.get("text-rotation-alignment");g.compileFilter();const Be=g.dynamicFilter(),Ae=g.dynamicFilterNeedsFeature(),et=this.transform.calculatePixelsToTileUnitsMatrix(b),rt=Ca(_e,b.tileID.canonical,De,Se,this.transform,A.getProjection(),et);let Ze=null;if(De){const Wt=Fi(_e,b.tileID.canonical,De,Se,this.transform,A.getProjection(),et);Ze=p.multiply([],this.transform.labelPlaneMatrix,Wt)}let ut=null;Be&&b.latestFeatureIndex&&(ut={unwrappedTileID:K,dynamicFilter:Be,dynamicFilterNeedsFeature:Ae,featureIndex:b.latestFeatureIndex}),this.retainedQueryData[A.bucketInstanceId]=new Sn(A.bucketInstanceId,O,A.sourceLayerIndex,A.index,b.tileID);const Rt={bucket:A,layout:U,posMatrix:_e,textLabelPlaneMatrix:rt,labelToScreenMatrix:Ze,clippingData:ut,scale:H,textPixelRatio:X,holdingForFade:b.holdingForFade(),collisionBoxArray:j,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(A.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(A.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(A.sourceID)};if(I)for(const Wt of A.sortKeyRanges){const{sortKey:Vt,symbolInstanceStart:Ln,symbolInstanceEnd:Dt}=Wt;l.push({sortKey:Vt,symbolInstanceStart:Ln,symbolInstanceEnd:Dt,parameters:Rt})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Rt})}attemptAnchorPlacement(l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe,De,Se,Be){const Ae=[_e.textOffset0,_e.textOffset1],et=$n(l,b,I,Ae,A),rt=this.collisionIndex.placeCollisionBox(Ie,A,g,Ar(et.x,et.y,O,U,this.transform.angle),K,j,H,X.predicate);if(De){const Ze=Ie.getSymbolInstanceIconSize(Be,this.transform.zoom,_e.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(Ie,Ze,De,Ar(et.x,et.y,O,U,this.transform.angle),K,j,H,X.predicate).box.length)return}if(rt.box.length>0){let Ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID]&&this.prevPlacement.placements[_e.crossTileID].text&&(Ze=this.prevPlacement.variableOffsets[_e.crossTileID].anchor),this.variableOffsets[_e.crossTileID]={textOffset:Ae,width:b,height:I,anchor:l,textScale:A,prevAnchor:Ze},this.markUsedJustification(Ie,l,_e,Fe),Ie.allowVerticalPlacement&&(this.markUsedOrientation(Ie,Fe,_e),this.placedOrientations[_e.crossTileID]=Fe),{shift:et,placedGlyphBoxes:rt}}}placeLayerBucketPart(l,g,b,I){const{bucket:A,layout:O,posMatrix:U,textLabelPlaneMatrix:j,labelToScreenMatrix:H,clippingData:X,textPixelRatio:K,holdingForFade:_e,collisionBoxArray:Le,partiallyEvaluatedTextSize:Ie,partiallyEvaluatedIconSize:Fe,collisionGroup:De}=l.parameters,Se=O.get("text-optional"),Be=O.get("icon-optional"),Ae=O.get("text-allow-overlap"),et=O.get("icon-allow-overlap"),rt="map"===O.get("text-rotation-alignment"),Ze="map"===O.get("text-pitch-alignment"),ut="none"!==O.get("icon-text-fit"),Rt="viewport-y"===O.get("symbol-z-order");this.transform.setProjection(A.projection);let Wt=Ae&&(et||!A.hasIconData()||Be),Vt=et&&(Ae||!A.hasTextData()||Se);!A.collisionArrays&&Le&&A.deserializeCollisionBoxes(Le),b&&I&&A.updateCollisionDebugBuffers(this.transform.zoom,Le);const Ln=(Dt,dn,fn)=>{if(X){const As={zoom:this.transform.zoom,pitch:this.transform.pitch};let Ps=null;if(X.dynamicFilterNeedsFeature){const lo=this.retainedQueryData[A.bucketInstanceId];Ps=X.featureIndex.loadFeature({featureIndex:Dt.featureIndex,bucketIndex:lo.bucketIndex,sourceLayerIndex:lo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,X.dynamicFilter)(As,Ps,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new p.pointGeometry(Dt.tileAnchorX,Dt.tileAnchorY),this.transform.calculateDistanceTileData(X.unwrappedTileID)))return this.placements[Dt.crossTileID]=new jn(!1,!1,!1,!0),void(g[Dt.crossTileID]=!0)}if(g[Dt.crossTileID])return;if(_e)return void(this.placements[Dt.crossTileID]=new jn(!1,!1,!1));let Ft=!1,bt=!1,Jn=!0,Nn=!1,Vn=!1,Bn=null,fr={box:null,offscreen:null,occluded:null},qr={box:null,offscreen:null,occluded:null},kr=null,wr=null,Un=null,Zr=0,wi=0,$o=0;fn.textFeatureIndex?Zr=fn.textFeatureIndex:Dt.useRuntimeCollisionCircles&&(Zr=Dt.featureIndex),fn.verticalTextFeatureIndex&&(wi=fn.verticalTextFeatureIndex);const ms=As=>{As.tileID=this.retainedQueryData[A.bucketInstanceId].tileID,(this.transform.elevation||As.elevation)&&(As.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[A.bucketInstanceId].tileID,As.tileAnchorX,As.tileAnchorY):0)},qo=fn.textBox;if(qo){ms(qo);const As=lo=>{let ya=p.WritingMode.horizontal;if(A.allowVerticalPlacement&&!lo&&this.prevPlacement){const uu=this.prevPlacement.placedOrientations[Dt.crossTileID];uu&&(this.placedOrientations[Dt.crossTileID]=uu,ya=uu,this.markUsedOrientation(A,ya,Dt))}return ya},Ps=(lo,ya)=>{if(A.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&fn.verticalTextBox){for(const uu of A.writingModes)if(uu===p.WritingMode.vertical?(fr=ya(),qr=fr):fr=lo(),fr&&fr.box&&fr.box.length)break}else fr=lo()};if(O.get("text-variable-anchor")){let lo=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Dt.crossTileID]){const cs=this.prevPlacement.variableOffsets[Dt.crossTileID];lo.indexOf(cs.anchor)>0&&(lo=lo.filter(el=>el!==cs.anchor),lo.unshift(cs.anchor))}const ya=(cs,el,Wc)=>{const El=A.getSymbolInstanceTextSize(Ie,Dt,this.transform.zoom,dn),Du=(cs.x2-cs.x1)*El+2*cs.padding,_h=(cs.y2-cs.y1)*El+2*cs.padding,Yc=ut&&!et?el:null;Yc&&ms(Yc);let Va={box:[],offscreen:!1,occluded:!1};const Au=Ae?2*lo.length:lo.length;for(let Kc=0;Kc<Au;++Kc){const Cl=this.attemptAnchorPlacement(lo[Kc%lo.length],cs,Du,_h,El,rt,Ze,K,U,De,Kc>=lo.length,Dt,dn,A,Wc,Yc,Ie,Fe);if(Cl&&(Va=Cl.placedGlyphBoxes,Va&&Va.box&&Va.box.length)){Ft=!0,Bn=Cl.shift;break}}return Va};Ps(()=>ya(qo,fn.iconBox,p.WritingMode.horizontal),()=>{const cs=fn.verticalTextBox;return cs&&ms(cs),A.allowVerticalPlacement&&!(fr&&fr.box&&fr.box.length)&&Dt.numVerticalGlyphVertices>0&&cs?ya(cs,fn.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),fr&&(Ft=fr.box,Jn=fr.offscreen,Nn=fr.occluded);const uu=As(fr&&fr.box);if(!Ft&&this.prevPlacement){const cs=this.prevPlacement.variableOffsets[Dt.crossTileID];cs&&(this.variableOffsets[Dt.crossTileID]=cs,this.markUsedJustification(A,cs.anchor,Dt,uu))}}else{const lo=(ya,uu)=>{const cs=A.getSymbolInstanceTextSize(Ie,Dt,this.transform.zoom,dn),el=this.collisionIndex.placeCollisionBox(A,cs,ya,new p.pointGeometry(0,0),Ae,K,U,De.predicate);return el&&el.box&&el.box.length&&(this.markUsedOrientation(A,uu,Dt),this.placedOrientations[Dt.crossTileID]=uu),el};Ps(()=>lo(qo,p.WritingMode.horizontal),()=>{const ya=fn.verticalTextBox;return A.allowVerticalPlacement&&Dt.numVerticalGlyphVertices>0&&ya?(ms(ya),lo(ya,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),As(fr&&fr.box&&fr.box.length)}}if(kr=fr,Ft=kr&&kr.box&&kr.box.length>0,Jn=kr&&kr.offscreen,Nn=kr&&kr.occluded,Dt.useRuntimeCollisionCircles){const As=A.text.placedSymbolArray.get(Dt.centerJustifiedTextSymbolIndex>=0?Dt.centerJustifiedTextSymbolIndex:Dt.verticalPlacedTextSymbolIndex),Ps=p.evaluateSizeForFeature(A.textSizeData,Ie,As),lo=O.get("text-padding");wr=this.collisionIndex.placeCollisionCircles(A,Ae,As,A.lineVertexArray,A.glyphOffsetArray,Ps,U,j,H,b,Ze,De.predicate,Dt.collisionCircleDiameter*Ps/p.ONE_EM,lo,this.retainedQueryData[A.bucketInstanceId].tileID),Ft=Ae||wr.circles.length>0&&!wr.collisionDetected,Jn=Jn&&wr.offscreen,Nn=wr.occluded}if(fn.iconFeatureIndex&&($o=fn.iconFeatureIndex),fn.iconBox){const As=Ps=>{ms(Ps);const lo=ut&&Bn?Ar(Bn.x,Bn.y,rt,Ze,this.transform.angle):new p.pointGeometry(0,0),ya=A.getSymbolInstanceIconSize(Fe,this.transform.zoom,Dt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,ya,Ps,lo,et,K,U,De.predicate)};qr&&qr.box&&qr.box.length&&fn.verticalIconBox?(Un=As(fn.verticalIconBox),bt=Un.box.length>0):(Un=As(fn.iconBox),bt=Un.box.length>0),Jn=Jn&&Un.offscreen,Vn=Un.occluded}const ja=Se||0===Dt.numHorizontalGlyphVertices&&0===Dt.numVerticalGlyphVertices,Uu=Be||0===Dt.numIconVertices;if(ja||Uu?Uu?ja||(bt=bt&&Ft):Ft=bt&&Ft:bt=Ft=bt&&Ft,Ft&&kr&&kr.box&&this.collisionIndex.insertCollisionBox(kr.box,O.get("text-ignore-placement"),A.bucketInstanceId,qr&&qr.box&&wi?wi:Zr,De.ID),bt&&Un&&this.collisionIndex.insertCollisionBox(Un.box,O.get("icon-ignore-placement"),A.bucketInstanceId,$o,De.ID),wr&&(Ft&&this.collisionIndex.insertCollisionCircles(wr.circles,O.get("text-ignore-placement"),A.bucketInstanceId,Zr,De.ID),b)){const As=A.bucketInstanceId;let Ps=this.collisionCircleArrays[As];void 0===Ps&&(Ps=this.collisionCircleArrays[As]=new wt);for(let lo=0;lo<wr.circles.length;lo+=4)Ps.circles.push(wr.circles[lo+0]),Ps.circles.push(wr.circles[lo+1]),Ps.circles.push(wr.circles[lo+2]),Ps.circles.push(wr.collisionDetected?1:0)}const Wa="globe"!==A.projection.name;Wt=Wt&&(Wa||!Nn),Vt=Vt&&(Wa||!Vn),this.placements[Dt.crossTileID]=new jn(Ft||Wt,bt||Vt,Jn||A.justReloaded),g[Dt.crossTileID]=!0};if(Rt){const Dt=A.getSortedSymbolIndexes(this.transform.angle);for(let dn=Dt.length-1;dn>=0;--dn){const fn=Dt[dn];Ln(A.symbolInstances.get(fn),fn,A.collisionArrays[fn])}}else for(let Dt=l.symbolInstanceStart;Dt<l.symbolInstanceEnd;Dt++)Ln(A.symbolInstances.get(Dt),Dt,A.collisionArrays[Dt]);if(b&&A.bucketInstanceId in this.collisionCircleArrays){const Dt=this.collisionCircleArrays[A.bucketInstanceId];p.invert(Dt.invProjMatrix,U),Dt.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(l,g,b,I){let A;A=I===p.WritingMode.vertical?b.verticalPlacedTextSymbolIndex:{left:b.leftJustifiedTextSymbolIndex,center:b.centerJustifiedTextSymbolIndex,right:b.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(g)];const O=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex,b.verticalPlacedTextSymbolIndex];for(const U of O)U>=0&&(l.text.placedSymbolArray.get(U).crossTileID=A>=0&&U!==A?0:b.crossTileID)}markUsedOrientation(l,g,b){const I=g===p.WritingMode.horizontal||g===p.WritingMode.horizontalOnly?g:0,A=g===p.WritingMode.vertical?g:0,O=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex].filter(U=>-1!==U);for(const U of O)l.text.placedSymbolArray.get(U).placedOrientation=I;-1!==b.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(b.verticalPlacedTextSymbolIndex).placedOrientation=A)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let b=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const I=g?g.symbolFadeChange(l):1,A=g?g.opacities:{},O=g?g.variableOffsets:{},U=g?g.placedOrientations:{};for(const j in this.placements){const H=this.placements[j],X=A[j];X?(this.opacities[j]=new vn(X,I,H.text,H.icon,null,H.clipped),b=b||H.text!==X.text.placed||H.icon!==X.icon.placed):(this.opacities[j]=new vn(null,I,H.text,H.icon,H.skipFade,H.clipped),b=b||H.text||H.icon)}for(const j in A){const H=A[j];if(!this.opacities[j]){const X=new vn(H,I,!1,!1);X.isHidden()||(this.opacities[j]=X,b=b||H.text.placed||H.icon.placed)}}for(const j in O)this.variableOffsets[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.variableOffsets[j]=O[j]);for(const j in U)this.placedOrientations[j]||!this.opacities[j]||this.opacities[j].isHidden()||(this.placedOrientations[j]=U[j]);b?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const b={};for(const I of g){const A=I.getBucket(l);A&&I.latestFeatureIndex&&l.id===A.layerIds[0]&&this.updateBucketOpacities(A,b,I.collisionBoxArray)}}updateBucketOpacities(l,g,b){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const I=l.layers[0].layout,A=!!l.layers[0].dynamicFilter(),O=new vn(null,0,!1,!1,!0),U=I.get("text-allow-overlap"),j=I.get("icon-allow-overlap"),H=I.get("text-variable-anchor"),X="map"===I.get("text-rotation-alignment"),K="map"===I.get("text-pitch-alignment"),_e="none"!==I.get("icon-text-fit"),Le=new vn(null,0,U&&(j||!l.hasIconData()||I.get("icon-optional")),j&&(U||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&b&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(b);const Ie=(De,Se,Be)=>{for(let Ae=0;Ae<Se/4;Ae++)De.opacityVertexArray.emplaceBack(Be)};let Fe=0;for(let De=0;De<l.symbolInstances.length;De++){const Se=l.symbolInstances.get(De),{numHorizontalGlyphVertices:Be,numVerticalGlyphVertices:Ae,crossTileID:et}=Se;let rt=this.opacities[et];g[et]?rt=O:rt||(rt=Le,this.opacities[et]=rt),g[et]=!0;const Ze=Be>0||Ae>0,ut=Se.numIconVertices>0,Rt=this.placedOrientations[Se.crossTileID],Wt=Rt===p.WritingMode.vertical,Vt=Rt===p.WritingMode.horizontal||Rt===p.WritingMode.horizontalOnly;if(!Ze&&!ut||rt.isHidden()||Fe++,Ze){const Ln=bn(rt.text);Ie(l.text,Be,Wt?ao:Ln),Ie(l.text,Ae,Vt?ao:Ln);const Dt=rt.text.isHidden();[Se.rightJustifiedTextSymbolIndex,Se.centerJustifiedTextSymbolIndex,Se.leftJustifiedTextSymbolIndex].forEach(Ft=>{Ft>=0&&(l.text.placedSymbolArray.get(Ft).hidden=Dt||Wt?1:0)}),Se.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(Se.verticalPlacedTextSymbolIndex).hidden=Dt||Vt?1:0);const dn=this.variableOffsets[Se.crossTileID];dn&&this.markUsedJustification(l,dn.anchor,Se,Rt);const fn=this.placedOrientations[Se.crossTileID];fn&&(this.markUsedJustification(l,"left",Se,fn),this.markUsedOrientation(l,fn,Se))}if(ut){const Ln=bn(rt.icon);Se.placedIconSymbolIndex>=0&&(Ie(l.icon,Se.numIconVertices,Wt?ao:Ln),l.icon.placedSymbolArray.get(Se.placedIconSymbolIndex).hidden=rt.icon.isHidden()),Se.verticalPlacedIconSymbolIndex>=0&&(Ie(l.icon,Se.numVerticalIconVertices,Vt?ao:Ln),l.icon.placedSymbolArray.get(Se.verticalPlacedIconSymbolIndex).hidden=rt.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const Ln=l.collisionArrays[De];if(Ln){let Dt=new p.pointGeometry(0,0),dn=!0;if(Ln.textBox||Ln.verticalTextBox){if(H){const Ft=this.variableOffsets[et];Ft?(Dt=$n(Ft.anchor,Ft.width,Ft.height,Ft.textOffset,Ft.textScale),X&&Dt._rotate(K?this.transform.angle:-this.transform.angle)):dn=!1}A&&(dn=!rt.clipped),Ln.textBox&&sn(l.textCollisionBox.collisionVertexArray,rt.text.placed,!dn||Wt,Dt.x,Dt.y),Ln.verticalTextBox&&sn(l.textCollisionBox.collisionVertexArray,rt.text.placed,!dn||Vt,Dt.x,Dt.y)}const fn=dn&&Boolean(!Vt&&Ln.verticalIconBox);Ln.iconBox&&sn(l.iconCollisionBox.collisionVertexArray,rt.icon.placed,fn,_e?Dt.x:0,_e?Dt.y:0),Ln.verticalIconBox&&sn(l.iconCollisionBox.collisionVertexArray,rt.icon.placed,!fn,_e?Dt.x:0,_e?Dt.y:0)}}}if(l.fullyClipped=0===Fe,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const De=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=De.invProjMatrix,l.placementViewportMatrix=De.viewportMatrix,l.collisionCircleArray=De.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const b=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*b>l}setStale(){this.stale=!0}}function sn(v,l,g,b,I){v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0)}const qn=Math.pow(2,25),Si=Math.pow(2,24),ar=Math.pow(2,17),Rr=Math.pow(2,16),Zn=Math.pow(2,9),Yu=Math.pow(2,8),eu=Math.pow(2,1);function bn(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;const l=v.placed?1:0,g=Math.floor(127*v.opacity);return g*qn+l*Si+g*ar+l*Rr+g*Zn+l*Yu+g*eu+l}const ao=0;class Jo{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,g,b,I,A){const O=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(O,I,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,A())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((U,j)=>U.sortKey-j.sortKey));this._currentPartIndex<O.length;){const U=O[this._currentPartIndex];if(g.placeLayerBucketPart(U,this._seenCrossTileIDs,b,0===U.symbolInstanceStart),this._currentPartIndex++,A())return!0}return!1}}class ca{constructor(l,g,b,I,A,O,U,j){this.placement=new $s(l,A,O,U,j),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(l,g,b){const I=p.exported.now(),A=()=>{const O=p.exported.now()-I;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=g[l[this._currentPlacementIndex]],U=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=U)&&(!O.maxzoom||O.maxzoom>U)){if(this._inProgressLayer||(this._inProgressLayer=new Jo(O)),this._inProgressLayer.continuePlacement(b[O.source],this.placement,this._showCollisionBoxes,O,A))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const pu=512/p.EXTENT/2;class Ss{constructor(l,g,b){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=b;for(let I=0;I<g.length;I++){const A=g.get(I),O=A.key;this.indexedSymbolInstances[O]||(this.indexedSymbolInstances[O]=[]),this.indexedSymbolInstances[O].push({crossTileID:A.crossTileID,coord:this.getScaledCoordinates(A,l)})}}getScaledCoordinates(l,g){const b=pu/Math.pow(2,g.canonical.z-this.tileID.canonical.z);return{x:Math.floor((g.canonical.x*p.EXTENT+l.tileAnchorX)*b),y:Math.floor((g.canonical.y*p.EXTENT+l.tileAnchorY)*b)}}findMatches(l,g,b){const I=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z);for(let A=0;A<l.length;A++){const O=l.get(A);if(O.crossTileID)continue;const U=this.indexedSymbolInstances[O.key];if(!U)continue;const j=this.getScaledCoordinates(O,g);for(const H of U)if(Math.abs(H.coord.x-j.x)<=I&&Math.abs(H.coord.y-j.y)<=I&&!b[H.crossTileID]){b[H.crossTileID]=!0,O.crossTileID=H.crossTileID;break}}}}class yl{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(0!==g)for(const b in this.indexes){const I=this.indexes[b],A={};for(const O in I){const U=I[O];U.tileID=U.tileID.unwrapTo(U.tileID.wrap+g),A[U.tileID.key]=U}this.indexes[b]=A}this.lng=l}addBucket(l,g,b){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let A=0;A<g.symbolInstances.length;A++)g.symbolInstances.get(A).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const I=this.usedCrossTileIDs[l.overscaledZ];for(const A in this.indexes){const O=this.indexes[A];if(Number(A)>l.overscaledZ)for(const U in O){const j=O[U];j.tileID.isChildOf(l)&&j.findMatches(g.symbolInstances,l,I)}else{const U=O[l.scaledTo(Number(A)).key];U&&U.findMatches(g.symbolInstances,l,I)}}for(let A=0;A<g.symbolInstances.length;A++){const O=g.symbolInstances.get(A);O.crossTileID||(O.crossTileID=b.generate(),I[O.crossTileID]=!0)}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new Ss(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const b in g.indexedSymbolInstances)for(const I of g.indexedSymbolInstances[b])delete this.usedCrossTileIDs[l][I.crossTileID]}removeStaleBuckets(l){let g=!1;for(const b in this.indexes){const I=this.indexes[b];for(const A in I)l[I[A].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,I[A]),delete I[A],g=!0)}return g}}class al{constructor(){this.layerIndexes={},this.crossTileIDs=new yl,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,b,I){let A=this.layerIndexes[l.id];void 0===A&&(A=this.layerIndexes[l.id]=new vs);let O=!1;const U={};"globe"!==I.name&&A.handleWrapJump(b);for(const j of g){const H=j.getBucket(l);H&&l.id===H.layerIds[0]&&(H.bucketInstanceId||(H.bucketInstanceId=++this.maxBucketInstanceId),A.addBucket(j.tileID,H,this.crossTileIDs)&&(O=!0),U[H.bucketInstanceId]=!0)}return A.removeStaleBuckets(U)&&(O=!0),O}pruneUnusedLayers(l){const g={};l.forEach(b=>{g[b]=!0});for(const b in this.layerIndexes)g[b]||delete this.layerIndexes[b]}}const us=(v,l)=>p.emitValidationErrors(v,l&&l.filter(g=>"source.canvas"!==g.identifier)),uo=p.pick(tr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),jo=p.pick(tr,["setCenter","setZoom","setBearing","setPitch"]),kl={version:8,layers:[],sources:{}},Xr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Fs extends p.Evented{constructor(l,g={}){super(),this.map=l,this.dispatcher=new Re(Mr(),this),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,g.localFontFamily?p.LocalGlyphMode.all:g.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new al,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const b=this;this._rtlTextPluginCallback=Fs.registerForPluginStateChange(I=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(A,O)=>{if(p.triggerPluginCompletionEvent(A),O&&O.every(U=>U))for(const U in b._sourceCaches){const j=b._sourceCaches[U],H=j.getSource().type;"vector"!==H&&"geojson"!==H||j.reload()}})}),this.on("data",I=>{if("source"!==I.dataType||"metadata"!==I.sourceDataType)return;const A=this.getSource(I.sourceId);if(A&&A.vectorLayerIds)for(const O in this._layers){const U=this._layers[O];U.source===A.id&&this._validateLayer(U)}})}loadURL(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const b="boolean"==typeof g.validate?g.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,g.accessToken);const I=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(I,(A,O)=>{this._request=null,A?this.fire(new p.ErrorEvent(A)):O&&this._load(O,b)})}loadJSON(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==g.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(kl,!1)}_updateLayerCount(l,g){const b=g?1:-1;l.is3D()&&(this._num3DLayers+=b),"circle"===l.type&&(this._numCircleLayers+=b),"symbol"===l.type&&(this._numSymbolLayers+=b)}_load(l,g){if(g&&us(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const I in l.sources)this.addSource(I,l.sources[I],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const b=ji(this.stylesheet.layers);this._order=b.map(I=>I.id),this._layers={},this._serializedLayers={};for(let I of b)I=p.createStyleLayer(I),I.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=I,this._serializedLayers[I.id]=I.serialize(),this._updateLayerCount(I,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new $e(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(g,b,I){let A,O,U;const j=p.exported.devicePixelRatio>1?"@2x":"";let H=p.getJSON(b.transformRequest(b.normalizeSpriteURL(g,j,".json"),p.ResourceType.SpriteJSON),(_e,Le)=>{H=null,U||(U=_e,A=Le,K())}),X=p.getImage(b.transformRequest(b.normalizeSpriteURL(g,j,".png"),p.ResourceType.SpriteImage),(_e,Le)=>{X=null,U||(U=_e,O=Le,K())});function K(){if(U)I(U);else if(A&&O){const _e=p.exported.getImageData(O),Le={};for(const Ie in A){const{width:Fe,height:De,x:Se,y:Be,sdf:Ae,pixelRatio:et,stretchX:rt,stretchY:Ze,content:ut}=A[Ie],Rt=new p.RGBAImage({width:Fe,height:De});p.RGBAImage.copy(_e,Rt,{x:Se,y:Be},{x:0,y:0},{width:Fe,height:De}),Le[Ie]={data:Rt,pixelRatio:et,sdf:Ae,stretchX:rt,stretchY:Ze,content:ut}}I(null,Le)}}return{cancel(){H&&(H.cancel(),H=null),X&&(X.cancel(),X=null)}}}(l,this.map._requestManager,(g,b)=>{if(this._spriteRequest=null,g)this.fire(new p.ErrorEvent(g));else if(b)for(const I in b)this.imageManager.addImage(I,b[I]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const g=this.getSource(l.source);if(!g)return;const b=l.sourceLayer;b&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(b))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${b}" does not exist on source "${g.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const g=[];for(const b of l){const I=this._layers[b];"custom"!==I.type&&g.push(I.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&Xr[l.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const I=Object.keys(this._updatedLayers),A=Object.keys(this._removedLayers);(I.length||A.length)&&this._updateWorkerLayers(I,A);for(const O in this._updatedSources){const U=this._updatedSources[O];"reload"===U?this._reloadSource(O):"clear"===U&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const b={};for(const I in this._sourceCaches){const A=this._sourceCaches[I];b[I]=A.used,A.used=!1}for(const I of this._order){const A=this._layers[I];if(A.recalculate(l,this._availableImages),!A.isHidden(l.zoom)){const U=this._getLayerSourceCache(A);U&&(U.used=!0)}const O=this.map.painter;if(O){const U=A.getProgramIds();if(!U)continue;const j=A.getProgramConfiguration(l.zoom);for(const H of U)O.useProgram(H,j)}}for(const I in b){const A=this._sourceCaches[I];b[I]!==A.used&&A.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),us(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=ji(l.layers);const g=function(I,A){if(!I)return[{command:tr.setStyle,args:[A]}];let O=[];try{if(!Ce(I.version,A.version))return[{command:tr.setStyle,args:[A]}];Ce(I.center,A.center)||O.push({command:tr.setCenter,args:[A.center]}),Ce(I.zoom,A.zoom)||O.push({command:tr.setZoom,args:[A.zoom]}),Ce(I.bearing,A.bearing)||O.push({command:tr.setBearing,args:[A.bearing]}),Ce(I.pitch,A.pitch)||O.push({command:tr.setPitch,args:[A.pitch]}),Ce(I.sprite,A.sprite)||O.push({command:tr.setSprite,args:[A.sprite]}),Ce(I.glyphs,A.glyphs)||O.push({command:tr.setGlyphs,args:[A.glyphs]}),Ce(I.transition,A.transition)||O.push({command:tr.setTransition,args:[A.transition]}),Ce(I.light,A.light)||O.push({command:tr.setLight,args:[A.light]}),Ce(I.fog,A.fog)||O.push({command:tr.setFog,args:[A.fog]}),Ce(I.projection,A.projection)||O.push({command:tr.setProjection,args:[A.projection]});const U={},j=[];!function(K,_e,Le,Ie){let Fe;for(Fe in _e=_e||{},K=K||{})K.hasOwnProperty(Fe)&&(_e.hasOwnProperty(Fe)||Gi(Fe,Le,Ie));for(Fe in _e)_e.hasOwnProperty(Fe)&&(K.hasOwnProperty(Fe)?Ce(K[Fe],_e[Fe])||("geojson"===K[Fe].type&&"geojson"===_e[Fe].type&&ia(K,_e,Fe)?Le.push({command:tr.setGeoJSONSourceData,args:[Fe,_e[Fe].data]}):ks(Fe,_e,Le,Ie)):gr(Fe,_e,Le))}(I.sources,A.sources,j,U);const H=[];I.layers&&I.layers.forEach(K=>{K.source&&U[K.source]?O.push({command:tr.removeLayer,args:[K.id]}):H.push(K)});let X=I.terrain;X&&U[X.source]&&(O.push({command:tr.setTerrain,args:[void 0]}),X=void 0),O=O.concat(j),Ce(X,A.terrain)||O.push({command:tr.setTerrain,args:[A.terrain]}),function(K,_e,Le){_e=_e||[];const Ie=(K=K||[]).map(Na),Fe=_e.map(Na),De=K.reduce(so,{}),Se=_e.reduce(so,{}),Be=Ie.slice(),Ae=Object.create(null);let et,rt,Ze,ut,Rt,Wt,Vt;for(et=0,rt=0;et<Ie.length;et++)Ze=Ie[et],Se.hasOwnProperty(Ze)?rt++:(Le.push({command:tr.removeLayer,args:[Ze]}),Be.splice(Be.indexOf(Ze,rt),1));for(et=0,rt=0;et<Fe.length;et++)Ze=Fe[Fe.length-1-et],Be[Be.length-1-et]!==Ze&&(De.hasOwnProperty(Ze)?(Le.push({command:tr.removeLayer,args:[Ze]}),Be.splice(Be.lastIndexOf(Ze,Be.length-rt),1)):rt++,Wt=Be[Be.length-et],Le.push({command:tr.addLayer,args:[Se[Ze],Wt]}),Be.splice(Be.length-et,0,Ze),Ae[Ze]=!0);for(et=0;et<Fe.length;et++)if(Ze=Fe[et],ut=De[Ze],Rt=Se[Ze],!Ae[Ze]&&!Ce(ut,Rt))if(Ce(ut.source,Rt.source)&&Ce(ut["source-layer"],Rt["source-layer"])&&Ce(ut.type,Rt.type)){for(Vt in zt(ut.layout,Rt.layout,Le,Ze,null,tr.setLayoutProperty),zt(ut.paint,Rt.paint,Le,Ze,null,tr.setPaintProperty),Ce(ut.filter,Rt.filter)||Le.push({command:tr.setFilter,args:[Ze,Rt.filter]}),Ce(ut.minzoom,Rt.minzoom)&&Ce(ut.maxzoom,Rt.maxzoom)||Le.push({command:tr.setLayerZoomRange,args:[Ze,Rt.minzoom,Rt.maxzoom]}),ut)ut.hasOwnProperty(Vt)&&"layout"!==Vt&&"paint"!==Vt&&"filter"!==Vt&&"metadata"!==Vt&&"minzoom"!==Vt&&"maxzoom"!==Vt&&(0===Vt.indexOf("paint.")?zt(ut[Vt],Rt[Vt],Le,Ze,Vt.slice(6),tr.setPaintProperty):Ce(ut[Vt],Rt[Vt])||Le.push({command:tr.setLayerProperty,args:[Ze,Vt,Rt[Vt]]}));for(Vt in Rt)Rt.hasOwnProperty(Vt)&&!ut.hasOwnProperty(Vt)&&"layout"!==Vt&&"paint"!==Vt&&"filter"!==Vt&&"metadata"!==Vt&&"minzoom"!==Vt&&"maxzoom"!==Vt&&(0===Vt.indexOf("paint.")?zt(ut[Vt],Rt[Vt],Le,Ze,Vt.slice(6),tr.setPaintProperty):Ce(ut[Vt],Rt[Vt])||Le.push({command:tr.setLayerProperty,args:[Ze,Vt,Rt[Vt]]}))}else Le.push({command:tr.removeLayer,args:[Ze]}),Wt=Be[Be.lastIndexOf(Ze)+1],Le.push({command:tr.addLayer,args:[Rt,Wt]})}(H,A.layers,O)}catch(U){console.warn("Unable to compute style diff:",U),O=[{command:tr.setStyle,args:[A]}]}return O}(this.serialize(),l).filter(I=>!(I.command in jo));if(0===g.length)return!1;const b=g.filter(I=>!(I.command in uo));if(b.length>0)throw new Error(`Unimplemented: ${b.map(I=>I.command).join(", ")}.`);return g.forEach(I=>{"setTransition"!==I.command&&"setProjection"!==I.command&&this[I.command].apply(this,I.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,g){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,g),this._afterImageUpdated(l),this)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,g,b={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(p.validateSource,`sources.${l}`,g,null,b))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const I=Ct(l,g,this.dispatcher,this);I.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:I.serialize(),sourceId:l}));const A=O=>{const U=(O?"symbol:":"other:")+l,j=this._sourceCaches[U]=new p.SourceCache(U,I,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[l]=j,j.style=this,j.onAdd(this.map)};A(!1),"vector"!==g.type&&"geojson"!==g.type||A(!0),I.onAdd&&I.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const g=this.getSource(l);if(!g)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${I}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const b=this._getSourceCaches(l);for(const I of b)delete this._sourceCaches[I.id],delete this._updatedSources[I.id],I.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:I.getSource().id})),I.setEventedParent(null),I.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,g){this._checkLoaded(),this.getSource(l).setData(g),this._changed=!0}getSource(l){const g=this._getSourceCache(l);return g&&g.getSource()}_getSources(){const l=[];for(const g in this._otherSourceCaches){const b=this._getSourceCache(g);b&&l.push(b.getSource())}return l}addLayer(l,g,b={}){this._checkLoaded();const I=l.id;if(this.getLayer(I))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${I}" already exists on this map`)));let A;if("custom"===l.type){if(us(this,p.validateCustomStyleLayer(l)))return;A=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(I,l.source),l=p.clone$1(l),l=p.extend(l,{source:I})),this._validate(p.validateLayer,`layers.${I}`,l,{arrayIndex:-1},b))return;A=p.createStyleLayer(l),this._validateLayer(A),A.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[A.id]=A.serialize(),this._updateLayerCount(A,!0)}const O=g?this._order.indexOf(g):this._order.length;if(g&&-1===O)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(O,0,I),this._layerOrderChanged=!0,this._layers[I]=A;const U=this._getLayerSourceCache(A);if(this._removedLayers[I]&&A.source&&U&&"custom"!==A.type){const j=this._removedLayers[I];delete this._removedLayers[I],j.type!==A.type?this._updatedSources[A.source]="clear":(this._updatedSources[A.source]="reload",U.pause())}this._updateLayer(A),A.onAdd&&A.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const b=this._order.indexOf(l);this._order.splice(b,1);const I=g?this._order.indexOf(g):this._order.length;g&&-1===I?this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(I,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const b=this._order.indexOf(l);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const g in this._layers)if(this._layers[g].type===l)return!0;return!1}setLayerZoomRange(l,g,b){this._checkLoaded();const I=this.getLayer(l);I?I.minzoom===g&&I.maxzoom===b||(null!=g&&(I.minzoom=g),null!=b&&(I.maxzoom=b),this._updateLayer(I)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,g,b={}){this._checkLoaded();const I=this.getLayer(l);if(I){if(!Ce(I.filter,g))return null==g?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(p.validateFilter,`layers.${I.id}.filter`,g,{layerType:I.type},b)||(I.filter=p.clone$1(g),this._updateLayer(I)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const g=this.getLayer(l);return g&&p.clone$1(g.filter)}setLayoutProperty(l,g,b,I={}){this._checkLoaded();const A=this.getLayer(l);A?Ce(A.getLayoutProperty(g),b)||(A.setLayoutProperty(g,b,I),this._updateLayer(A)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,g){const b=this.getLayer(l);if(b)return b.getLayoutProperty(g);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,g,b,I={}){this._checkLoaded();const A=this.getLayer(l);A?Ce(A.getPaintProperty(g),b)||(A.setPaintProperty(g,b,I)&&this._updateLayer(A),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,g){const b=this.getLayer(l);return b&&b.getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const b=l.source,I=l.sourceLayer,A=this.getSource(b);if(!A)return void this.fire(new p.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const O=A.type;if("geojson"===O&&I)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===O&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const U=this._getSourceCaches(b);for(const j of U)j.setFeatureState(I,l.id,g)}removeFeatureState(l,g){this._checkLoaded();const b=l.source,I=this.getSource(b);if(!I)return void this.fire(new p.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const A=I.type,O="vector"===A?l.sourceLayer:void 0;if("vector"===A&&!O)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const U=this._getSourceCaches(b);for(const j of U)j.removeFeatureState(O,l.id,g)}getFeatureState(l){this._checkLoaded();const g=l.source,b=l.sourceLayer,I=this.getSource(g);if(I){if("vector"!==I.type||b)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(b,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const g in this._sourceCaches){const b=this._sourceCaches[g].getSource();l[b.id]||(l[b.id]=b.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(l){this._updatedLayers[l.id]=!0;const g=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[l.source]="reload",g.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const g=O=>"fill-extrusion"===this._layers[O].type,b={},I=[];for(let O=this._order.length-1;O>=0;O--){const U=this._order[O];if(g(U)){b[U]=O;for(const j of l){const H=j[U];if(H)for(const X of H)I.push(X)}}}I.sort((O,U)=>U.intersectionZ-O.intersectionZ);const A=[];for(let O=this._order.length-1;O>=0;O--){const U=this._order[O];if(g(U))for(let j=I.length-1;j>=0;j--){const H=I[j].feature;if(b[H.layer.id]<O)break;A.push(H),I.pop()}else for(const j of l){const H=j[U];if(H)for(const X of H)A.push(X.feature)}}return A}queryRenderedFeatures(l,g,b){g&&g.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const I={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const j of g.layers){const H=this._layers[j];if(!H)return this.fire(new p.ErrorEvent(new Error(`The layer '${j}' does not exist in the map's style and cannot be queried for features.`))),[];I[H.source]=!0}}const A=[];g.availableImages=this._availableImages;const O=g&&g.layers?g.layers.some(j=>{const H=this.getLayer(j);return H&&H.is3D()}):this.has3DLayers(),U=$t.createFromScreenPoints(l,b);for(const j in this._sourceCaches){const H=this._sourceCaches[j].getSource().id;g.layers&&!I[H]||A.push(ht(this._sourceCaches[j],this._layers,this._serializedLayers,U,g,b,O,!!this.map._showQueryGeometry))}return this.placement&&A.push(function(j,H,X,K,_e,Le,Ie){const Fe={},De=Le.queryRenderedSymbols(K),Se=[];for(const Be of Object.keys(De).map(Number))Se.push(Ie[Be]);Se.sort(Rn);for(const Be of Se){const Ae=Be.featureIndex.lookupSymbolFeatures(De[Be.bucketInstanceId],H,Be.bucketIndex,Be.sourceLayerIndex,_e.filter,_e.layers,_e.availableImages,j);for(const et in Ae){const rt=Fe[et]=Fe[et]||[],Ze=Ae[et];Ze.sort((ut,Rt)=>{const Wt=Be.featureSortOrder;if(Wt){const Vt=Wt.indexOf(ut.featureIndex);return Wt.indexOf(Rt.featureIndex)-Vt}return Rt.featureIndex-ut.featureIndex});for(const ut of Ze)rt.push(ut)}}for(const Be in Fe)Fe[Be].forEach(Ae=>{const et=Ae.feature,rt=X(j[Be]).getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=rt});return Fe}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),U.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(A)}querySourceFeatures(l,g){g&&g.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const b=this._getSourceCaches(l);let I=[];for(const A of b)I=I.concat(nn(A,g));return I}addSourceType(l,g,b){return Fs.getSourceType(l)?b(new Error(`A source type called "${l}" already exists.`)):(Fs.setSourceType(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},b):b(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const b=this.light.getLight();let I=!1;for(const O in l)if(!Ce(l[O],b[O])){I=!0;break}if(!I)return;const A=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,g),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,g=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===g){if("object"==typeof l.source){const b="terrain-dem-src";this.addSource(b,l.source),l=p.clone$1(l),l=p.extend(l,{source:b})}if(this._validate(p.validateTerrain,"terrain",l))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode)this._createTerrain(l,g);else{const b=this.terrain,I=b.get();for(const A of Object.keys(p.spec.terrain))!l.hasOwnProperty(A)&&p.spec.terrain[A].default&&(l[A]=p.spec.terrain[A].default);for(const A in l)if(!Ce(l[A],I[A])){b.set(l),this.stylesheet.terrain=l;const O=this._setTransitionParameters({duration:0});b.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const g=this.fog=new vt(l,this.map.transform);this.stylesheet.fog=l;const b=this._setTransitionParameters({duration:0});g.updateTransitions(b)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,b=g.get();0===Object.keys(l).length&&g.set(l);for(const I in l)if(!Ce(l[I],b[I])){g.set(l),this.stylesheet.fog=l;const A=this._setTransitionParameters({duration:0});g.updateTransitions(A);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(b=>this.isLayerDraped(this._layers[b])),g=this._order.filter(b=>!this.isLayerDraped(this._layers[b]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...g)}_createTerrain(l,g){const b=this.terrain=new kt(l,g);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const I=this._setTransitionParameters({duration:0});b.updateTransitions(I)}_force3DLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"symbol"===g.type&&this._updateLayer(g)}}_validate(l,g,b,I,A={}){return(!A||!1!==A.validate)&&us(this,l.call(p.validateStyle,p.extend({key:g,style:this.serialize(),value:b,styleSpec:p.spec},I)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const g=this._getSourceCaches(l);for(const b of g)b.clearTiles()}_reloadSource(l){const g=this._getSourceCaches(l);for(const b of g)b.resume(),b.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const g in this._sourceCaches)this._sourceCaches[g].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const g=this._sourceCaches[l];g.resume(),g.reload()}}_updatePlacement(l,g,b,I,A=!1){let O=!1,U=!1;const j={};for(const H of this._order){const X=this._layers[H];if("symbol"!==X.type)continue;if(!j[X.source]){const _e=this._getLayerSourceCache(X);if(!_e)continue;j[X.source]=_e.getRenderableIds(!0).map(Le=>_e.getTileByID(Le)).sort((Le,Ie)=>Ie.tileID.overscaledZ-Le.tileID.overscaledZ||(Le.tileID.isLessThan(Ie.tileID)?-1:1))}const K=this.crossTileSymbolIndex.addLayer(X,j[X.source],l.center.lng,l.projection);O=O||K}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),A=A||this._layerOrderChanged||0===b,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(A||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new ca(l,this._order,A,g,b,I,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,j),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),U=!0),O&&this.pauseablePlacement.placement.setStale()),U||O)for(const H of this._order){const X=this._layers[H];"symbol"===X.type&&this.placement.updateLayerOpacities(X,j[X.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,b){this.imageManager.getImages(g.icons,b),this._updateTilesForChangedImages();const I=A=>{A&&A.setDependencies(g.tileID.key,g.type,g.icons)};I(this._otherSourceCaches[g.source]),I(this._symbolSourceCaches[g.source])}getGlyphs(l,g,b){this.glyphManager.getGlyphs(g.stacks,b)}getResource(l,g,b){return p.makeRequest(g,b)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const g=[];return this._otherSourceCaches[l]&&g.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&g.push(this._symbolSourceCaches[l]),g}_isSourceCacheLoaded(l){const g=this._getSourceCaches(l);return 0===g.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):g.every(b=>b.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Fs.getSourceType=function(v){return Mt[v]},Fs.setSourceType=function(v,l){Mt[v]=l},Fs.registerForPluginStateChange=p.registerForPluginStateChange;var Hc="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ka="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",sa="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Cu="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",li="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let Ku={},tu={};const Su=[];xs(Hc,Su),xs(sa,Su),xs(Cu,Su),xs(li,Su),Ku=gi("",sa),tu=gi(li,Cu);const Xi=gi("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),vr=Hc,_l="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Fl={background:gi("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:gi("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:gi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:gi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:gi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:gi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:gi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:gi("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:gi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:gi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:gi("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:gi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:gi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:gi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:gi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:gi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:gi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:gi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:gi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:gi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxGradient:gi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ka),skyboxCapture:gi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:gi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function xs(v,l){const g=v.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let b of g)if(b=b.trim(),"#"===b[0]&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const I=b.split(" ");for(const A of I)l.includes(A)||l.push(A)}}function gi(v,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I={},A=[...Su];return xs(v,A),xs(l,A),{fragmentSource:v=v.replace(g,(O,U,j,H,X)=>(I[X]=!0,"define"===U?`\n#ifndef HAS_UNIFORM_u_${X}\nvarying ${j} ${H} ${X};\n#else\nuniform ${j} ${H} u_${X};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${X}\n    ${j} ${H} ${X} = u_${X};\n#endif\n`)),vertexSource:l=l.replace(g,(O,U,j,H,X)=>{const K="float"===H?"vec2":"vec4",_e=X.match(/color/)?"color":K;return I[X]?"define"===U?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nattribute ${j} ${K} a_${X};\nvarying ${j} ${H} ${X};\n#else\nuniform ${j} ${H} u_${X};\n#endif\n`:"vec4"===_e?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = a_${X};\n#else\n    ${j} ${H} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${X} = unpack_mix_${_e}(a_${X}, u_${X}_t);\n#else\n    ${j} ${H} ${X} = u_${X};\n#endif\n`:"define"===U?`\n#ifndef HAS_UNIFORM_u_${X}\nuniform lowp float u_${X}_t;\nattribute ${j} ${K} a_${X};\n#else\nuniform ${j} ${H} u_${X};\n#endif\n`:"vec4"===_e?`\n#ifndef HAS_UNIFORM_u_${X}\n    ${j} ${H} ${X} = a_${X};\n#else\n    ${j} ${H} ${X} = u_${X};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${X}\n    ${j} ${H} ${X} = unpack_mix_${_e}(a_${X}, u_${X}_t);\n#else\n    ${j} ${H} ${X} = u_${X};\n#endif\n`}),staticAttributes:b,usedDefines:A}}class nu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,g,b,I,A,O,U){this.context=l;let j=this.boundPaintVertexBuffers.length!==I.length;for(let X=0;!j&&X<I.length;X++)this.boundPaintVertexBuffers[X]!==I[X]&&(j=!0);let H=this.boundDynamicVertexBuffers.length!==U.length;for(let X=0;!H&&X<U.length;X++)this.boundDynamicVertexBuffers[X]!==U[X]&&(H=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==b||j||H||this.boundIndexBuffer!==A||this.boundVertexOffset!==O)this.freshBind(g,b,I,A,O,U);else{l.bindVertexArrayOES.set(this.vao);for(const X of U)X&&X.bind();A&&A.dynamicDraw&&A.bind()}}freshBind(l,g,b,I,A,O){let U;const j=l.numAttributes,H=this.context,X=H.gl;if(H.extVertexArrayObject)this.vao&&this.destroy(),this.vao=H.extVertexArrayObject.createVertexArrayOES(),H.bindVertexArrayOES.set(this.vao),U=0,this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=I,this.boundVertexOffset=A,this.boundDynamicVertexBuffers=O;else{U=H.currentNumAttributes||0;for(let K=j;K<U;K++)X.disableVertexAttribArray(K)}g.enableAttributes(X,l),g.bind(),g.setVertexAttribPointers(X,l,A);for(const K of b)K.enableAttributes(X,l),K.bind(),K.setVertexAttribPointers(X,l,A);for(const K of O)K&&(K.enableAttributes(X,l),K.bind(),K.setVertexAttribPointers(X,l,A));I&&I.bind(),H.currentNumAttributes=j}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function ru(v,l){const g=Math.pow(2,l.canonical.z),b=l.canonical.y;return[new p.MercatorCoordinate(0,b/g).toLngLat().lat,new p.MercatorCoordinate(0,(b+1)/g).toLngLat().lat]}function Sa(v,l,g,b,I,A,O){const U=v.context,j=U.gl,H=g.fbo;if(!H)return;v.prepareDrawTile();const X=v.useProgram("hillshade");U.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_2D,H.colorAttachment.get());const K=((Fe,De,Se,Be)=>{const Ae=Se.paint.get("hillshade-shadow-color"),et=Se.paint.get("hillshade-highlight-color"),rt=Se.paint.get("hillshade-accent-color");let Ze=Se.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Se.paint.get("hillshade-illumination-anchor")&&(Ze-=Fe.transform.angle);const ut=!Fe.options.moving;return{u_matrix:Be||Fe.transform.calculateProjMatrix(De.tileID.toUnwrapped(),ut),u_image:0,u_latrange:ru(0,De.tileID),u_light:[Se.paint.get("hillshade-exaggeration"),Ze],u_shadow:Ae,u_highlight:et,u_accent:rt}})(v,g,b,v.terrain?l.projMatrix:null);v.prepareDrawProgram(U,X,l.toUnwrapped());const{tileBoundsBuffer:_e,tileBoundsIndexBuffer:Le,tileBoundsSegments:Ie}=v.getTileBoundsBuffers(g);X.draw(U,j.TRIANGLES,I,A,O,p.CullFaceMode.disabled,K,b.id,_e,Le,Ie)}function gu(v,l,g){if(!l.needsDEMTextureUpload)return;const b=v.context,I=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(g.stride);const A=g.getPixels();l.demTexture?l.demTexture.update(A,{premultiply:!1}):l.demTexture=new p.Texture(b,A,I.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Gn(v,l,g,b,I,A){const O=v.context,U=O.gl;if(!l.dem)return;const j=l.dem;if(O.activeTexture.set(U.TEXTURE1),gu(v,l,j),!l.demTexture)return;l.demTexture.bind(U.NEAREST,U.CLAMP_TO_EDGE);const H=j.dim;O.activeTexture.set(U.TEXTURE0);let X=l.fbo;if(!X){const Ie=new p.Texture(O,{width:H,height:H,data:null},U.RGBA);Ie.bind(U.LINEAR,U.CLAMP_TO_EDGE),X=l.fbo=O.createFramebuffer(H,H,!0),X.colorAttachment.set(Ie.texture)}O.bindFramebuffer.set(X.framebuffer),O.viewport.set([0,0,H,H]);const{tileBoundsBuffer:K,tileBoundsIndexBuffer:_e,tileBoundsSegments:Le}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw(O,U.TRIANGLES,b,I,A,p.CullFaceMode.disabled,((Ie,Fe)=>{const De=Fe.stride,Se=p.create();return p.ortho(Se,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(Se,Se,[0,-p.EXTENT,0]),{u_matrix:Se,u_image:1,u_dimension:[De,De],u_zoom:Ie.overscaledZ,u_unpack:Fe.unpackVector}})(l.tileID,j),g.id,K,_e,Le),l.needsHillshadePrepare=!1}const Ia=v=>({u_matrix:new p.UniformMatrix4f(v),u_image0:new p.Uniform1i(v),u_skirt_height:new p.Uniform1f(v)}),xr=(v,l)=>({u_matrix:v,u_image0:0,u_skirt_height:l}),Fu=(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:g,u_zoom_transition:I,u_merc_center:A,u_image0:0,u_frustum_tl:O,u_frustum_tr:U,u_frustum_br:j,u_frustum_bl:H,u_globe_pos:X,u_globe_radius:K,u_viewport:_e,u_grid_matrix:Le?Float32Array.from(Le):new Float32Array(9)});function Is(v,l){return null!=v&&null!=l&&!(!v.hasData()||!l.hasData())&&null!=v.demTexture&&null!=l.demTexture&&v.tileID.key!==l.tileID.key}const Ta=new class{constructor(){this.operations={}}newMorphing(v,l,g,b,I){if(v in this.operations){const A=this.operations[v];A.to.tileID.key!==g.tileID.key&&(A.queued=g)}else this.operations[v]={startTime:b,phase:0,duration:I,from:l,to:g,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const g=this.operations[l];for(g.phase=(v-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},ci={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ii(v,l){const g=1<<v.z;return!l&&(0===v.x||v.x===g-1)||0===v.y||v.y===g-1}const Ji=v=>({u_matrix:v});function iu(v,l,g,b,I){if(I>0){const A=p.exported.now(),O=(A-v.timeAdded)/I,U=l?(A-l.timeAdded)/I:-1,j=g.getSource(),H=b.coveringZoomLevel({tileSize:j.tileSize,roundZoom:j.roundZoom}),X=!l||Math.abs(l.tileID.overscaledZ-H)>Math.abs(v.tileID.overscaledZ-H),K=X&&v.refreshedUponExpiration?1:p.clamp(X?O:1-U,0,1);return v.refreshedUponExpiration&&O>=1&&(v.refreshedUponExpiration=!1),l?{opacity:1,mix:1-K}:{opacity:K,mix:0}}return{opacity:1,mix:0}}class Qo extends p.SourceCache{constructor(l){const g={type:"raster-dem",maxzoom:l.transform.maxZoom},b=new Re(Mr(),null),I=Ct("mock-dem",g,b,l.style);super("mock-dem",I,!1),I.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,g){l.state="loaded",g(null)}}class vl extends p.SourceCache{constructor(l){const g=Ct("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Re(Mr(),null),l.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,g,b){if(l.freezeTileCoverage)return;this.transform=l;const I=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((A,O)=>{if(A[O.key]="",!this._tiles[O.key]){const U=new p.Tile(O,this._source.tileSize*O.overscaleFactor(),l.tileZoom);U.state="loaded",this._tiles[O.key]=U}return A},{});for(const A in this._tiles)A in I||(this.freeFBO(A),this._tiles[A].unloadVectorData(),delete this._tiles[A])}freeFBO(l){const g=this.proxyCachedFBO[l];if(void 0!==g){const b=Object.values(g);this.renderCachePool.push(...b),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class zl extends p.OverscaledTileID{constructor(l,g,b){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=g,this.projMatrix=b}}class zs extends p.Elevation{constructor(l,g){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[b,I,A]=function(j){const H=new p.StructArrayLayout4i8,X=new p.StructArrayLayout3ui6,K=131;H.reserve(17161),X.reserve(33800);const _e=p.EXTENT/128,Le=p.EXTENT+_e/2,Ie=Le+_e;for(let De=-_e;De<Ie;De+=_e)for(let Se=-_e;Se<Ie;Se+=_e){const Be=Se<0||Se>Le||De<0||De>Le?24575:0,Ae=p.clamp(Math.round(Se),0,p.EXTENT),et=p.clamp(Math.round(De),0,p.EXTENT);H.emplaceBack(Ae+Be,et,Ae,et)}const Fe=(De,Se)=>{const Be=Se*K+De;X.emplaceBack(Be+1,Be,Be+K),X.emplaceBack(Be+K,Be+K+1,Be+1)};for(let De=1;De<129;De++)for(let Se=1;Se<129;Se++)Fe(Se,De);return[0,129].forEach(De=>{for(let Se=0;Se<130;Se++)Fe(Se,De),Fe(De,Se)}),[H,X,32768]}(),O=l.context;this.gridBuffer=O.createVertexBuffer(b,p.boundsAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(I),this.gridSegments=p.SegmentVector.simpleSegment(0,0,b.length,I.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,b.length,A),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new vl(g.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const U=O.gl;this._overlapStencilMode=new p.StencilMode({func:U.GEQUAL,mask:255},0,255,U.KEEP,U.KEEP,U.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Qo(g.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency()}update(l,g,b){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const I=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(I.get("source")),this._exaggeration=I.get("exaggeration");const A=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(g,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,A(),this._initializing=!0),A(),g.updateElevation(!b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=0===b._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(b.center),-1),this._emptyDEMTextureDirty=!this._initializing);const I=this.proxyCoords=g.getIds().map(j=>{const H=g.getTileByID(j).tileID;return H.projMatrix=b.calculateProjMatrix(H.toUnwrapped()),H});(function(j,H){const X=H.transform.pointCoordinate(H.transform.getCameraPoint()),K=new p.pointGeometry(X.x,X.y);j.sort((_e,Le)=>{if(Le.overscaledZ-_e.overscaledZ)return Le.overscaledZ-_e.overscaledZ;const Ie=new p.pointGeometry(_e.canonical.x+(1<<_e.canonical.z)*_e.wrap,_e.canonical.y),Fe=new p.pointGeometry(Le.canonical.x+(1<<Le.canonical.z)*Le.wrap,Le.canonical.y),De=K.mult(1<<_e.canonical.z);return De.x-=.5,De.y-=.5,De.distSqr(Ie)-De.distSqr(Fe)})})(I,this.painter),this._previousZoom=b.zoom;const A=this.proxyToSource||{};this.proxyToSource={},I.forEach(j=>{this.proxyToSource[j.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const j in O){const H=O[j];if(!H.used||(H!==this.sourceCache&&this.resetTileLookupCache(H.id),this._setupProxiedCoordsForOrtho(H,l[j],A),H.usedForTerrain))continue;const X=l[j];H.getSource().reparseOverscaled&&this._assignTerrainTiles(X)}this.proxiedCoords[g.id]=I.map(j=>new zl(j,j.key,this.orthoMatrix)),this._assignTerrainTiles(I),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(A),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const U={};this._visibleDemTiles=[];for(const j of this.proxyCoords){const H=this.terrainTileForTile[j.key];if(!H)continue;const X=H.tileID.key;X in U||(this._visibleDemTiles.push(H),U[X]=X)}}_assignTerrainTiles(l){this._initializing||l.forEach(g=>{if(this.terrainTileForTile[g.key])return;const b=this._findTileCoveringTileID(g,this.sourceCache);b&&(this.terrainTileForTile[g.key]=b)})}_prepareDEMTextures(){const l=this.painter.context,g=l.gl;for(const b in this.terrainTileForTile){const I=this.terrainTileForTile[b],A=I.dem;!A||I.demTexture&&!I.needsDEMTextureUpload||(l.activeTexture.set(g.TEXTURE1),gu(this.painter,I,A))}}_prepareDemTileUniforms(l,g,b,I){if(!g||null==g.demTexture)return!1;const A=l.tileID.canonical,O=Math.pow(2,g.tileID.canonical.z-A.z),U=I||"";return b[`u_dem_tl${U}`]=[A.x*O%1,A.y*O%1],b[`u_dem_scale${U}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,g=l.gl;if(!this._emptyDepthBufferTexture){const b=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,b,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const g=this._visibleDemTiles.reduce((b,I)=>{if(!I.dem)return b;const A=I.dem.tree.minimums[0];return A>0&&l++,b+A},0);return l?g/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,g=l.gl;l.activeTexture.set(g.TEXTURE2);const b=this._getLoadedAreaMinimum(),I=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(b,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let A=this._emptyDEMTexture;return A?A.update(I,{premultiply:!1}):A=this._emptyDEMTexture=new p.Texture(l,I,g.RGBA,{premultiply:!1}),A}setupElevationDraw(l,g,b){const I=this.painter.context,A=I.gl,O=(U=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(U),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var U;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let j=null,H=null,X=1;if(b&&b.morphing&&this._useVertexMorphing){const K=b.morphing.srcDemTile,_e=b.morphing.dstDemTile;X=b.morphing.phase,K&&_e&&(this._prepareDemTileUniforms(l,K,O,"_prev")&&(H=K),this._prepareDemTileUniforms(l,_e,O)&&(j=_e))}if(H&&j?(I.activeTexture.set(A.TEXTURE2),j.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),I.activeTexture.set(A.TEXTURE4),H.demTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE,A.NEAREST),O.u_dem_lerp=X):(j=this.terrainTileForTile[l.tileID.key],I.activeTexture.set(A.TEXTURE2),(this._prepareDemTileUniforms(l,j,O)?j.demTexture:this.emptyDEMTexture).bind(A.NEAREST,A.CLAMP_TO_EDGE)),I.activeTexture.set(A.TEXTURE3),b&&b.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(A.NEAREST,A.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),b&&b.useMeterToDem&&j){const K=(1<<j.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=K}if(b&&b.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),g.setTerrainUniformValues(I,O),"globe"===this.painter.transform.projection.name){const K=this.globeUniformValues(this.painter.transform,l.tileID.canonical,b&&b.useDenormalizedUpVectorScale);g.setGlobeUniformValues(I,K)}}globeUniformValues(l,g,b){const I=l.projection;return{u_tile_tl_up:I.upVector(g,0,0),u_tile_tr_up:I.upVector(g,p.EXTENT,0),u_tile_br_up:I.upVector(g,p.EXTENT,p.EXTENT),u_tile_bl_up:I.upVector(g,0,p.EXTENT),u_tile_up_scale:b?p.GLOBE_METERS_TO_ECEF:I.upVectorScale(g,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const g=this.painter,b=this.painter.context;0!==l.length&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(I,A,O,U,j){if("globe"===I.transform.projection.name)!function(H,X,K,_e,Le){const Ie=H.context,Fe=Ie.gl;let De,Se;const Be=H.options.showTerrainWireframe?2:0,Ae=H.transform,et=p.globeUseCustomAntiAliasing(H,Ie,Ae),rt=(Ft,bt)=>{if(Se===Ft)return;const Jn=[ci[Ft],"PROJECTION_GLOBE_VIEW"];et&&Jn.push("CUSTOM_ANTIALIASING"),bt&&Jn.push(ci[Be]),De=H.useProgram("globeRaster",null,Jn),Se=Ft},Ze=H.colorModeForRenderPass(),ut=new p.DepthMode(Fe.LEQUAL,p.DepthMode.ReadWrite,H.depthRangeFor3D);Ta.update(Le);const Rt=p.calculateGlobeMercatorMatrix(Ae),Wt=[p.mercatorXfromLng(Ae.center.lng),p.mercatorYfromLat(Ae.center.lat)],Vt=Be?[!1,!0]:[!1],Ln=H.globeSharedBuffers,Dt=[Ae.width*p.exported.devicePixelRatio,Ae.height*p.exported.devicePixelRatio],dn=Float32Array.from(Ae.globeMatrix),fn={useDenormalizedUpVectorScale:!0};if(Vt.forEach(Ft=>{Se=-1;const bt=Ft?Fe.LINES:Fe.TRIANGLES;for(const Jn of _e){const Nn=K.getTile(Jn),Vn=p.StencilMode.disabled,Bn=X.prevTerrainTileForTile[Jn.key],fr=X.terrainTileForTile[Jn.key];Is(Bn,fr)&&Ta.newMorphing(Jn.key,Bn,fr,Le,250),Ie.activeTexture.set(Fe.TEXTURE0),Nn.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE);const qr=Ta.getMorphValuesForProxy(Jn.key),kr=qr?1:0;qr&&p.extend$1(fn,{morphing:{srcDemTile:qr.from,dstDemTile:qr.to,phase:p.easeCubicInOut(qr.phase)}});const wr=p.tileCornersToBounds(Jn.canonical),Un=p.getLatitudinalLod(wr.getCenter().lat),Zr=p.getGridMatrix(Jn.canonical,wr,Un,Ae.worldSize/Ae._pixelsPerMercatorPixel),wi=p.globeNormalizeECEF(p.globeTileBounds(Jn.canonical)),$o=Fu(Ae.projMatrix,dn,Rt,wi,p.globeToMercatorTransition(Ae.zoom),Wt,Ae.frustumCorners.TL,Ae.frustumCorners.TR,Ae.frustumCorners.BR,Ae.frustumCorners.BL,Ae.globeCenterInViewSpace,Ae.globeRadius,Dt,Zr);if(rt(kr,Ft),X.setupElevationDraw(Nn,De,fn),H.prepareDrawProgram(Ie,De,Jn.toUnwrapped()),Ln){const[ms,qo,ja]=Ft?Ln.getWirefameBuffers(H.context,Un):Ln.getGridBuffers(Un);De.draw(Ie,bt,ut,Vn,Ze,p.CullFaceMode.backCCW,$o,"globe_raster",ms,qo,ja)}}}),Ln){const Ft=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];et&&Ft.push("CUSTOM_ANTIALIASING"),De=H.useProgram("globeRaster",null,Ft);for(const bt of _e){const{x:Jn,y:Nn,z:Vn}=bt.canonical,Bn=0===Nn,fr=Nn===(1<<Vn)-1,[qr,kr,wr,Un]=Ln.getPoleBuffers(Vn);if(Un&&(Bn||fr)){const Zr=K.getTile(bt);Ie.activeTexture.set(Fe.TEXTURE0),Zr.texture.bind(Fe.LINEAR,Fe.CLAMP_TO_EDGE);let wi=p.globePoleMatrixForTile(Vn,Jn,Ae);const $o=p.globeNormalizeECEF(p.globeTileBounds(bt.canonical)),ms=(qo,ja)=>qo.draw(Ie,Fe.TRIANGLES,ut,p.StencilMode.disabled,Ze,p.CullFaceMode.disabled,Fu(Ae.projMatrix,wi,wi,$o,0,Wt,Ae.frustumCorners.TL,Ae.frustumCorners.TR,Ae.frustumCorners.BR,Ae.frustumCorners.BL,Ae.globeCenterInViewSpace,Ae.globeRadius,Dt),"globe_pole_raster",ja,wr,Un);X.setupElevationDraw(Zr,De,fn),H.prepareDrawProgram(Ie,De,bt.toUnwrapped()),Bn&&ms(De,qr),fr&&(wi=p.scale(p.create(),wi,[1,-1,1]),ms(De,kr))}}}}(I,A,O,U,j);else{const H=I.context,X=H.gl;let K,_e;const Le=I.options.showTerrainWireframe?2:0,Ie=(Ae,et)=>{if(_e===Ae)return;const rt=[ci[Ae]];et&&rt.push(ci[Le]),K=I.useProgram("terrainRaster",null,rt),_e=Ae},Fe=I.colorModeForRenderPass(),De=new p.DepthMode(X.LEQUAL,p.DepthMode.ReadWrite,I.depthRangeFor3D);Ta.update(j);const Se=I.transform,Be=6*Math.pow(1.5,22-Se.zoom)*A.exaggeration();(Le?[!1,!0]:[!1]).forEach(Ae=>{_e=-1;const et=Ae?X.LINES:X.TRIANGLES,[rt,Ze]=Ae?A.getWirefameBuffer():[A.gridIndexBuffer,A.gridSegments];for(const ut of U){const Rt=O.getTile(ut),Wt=p.StencilMode.disabled,Vt=A.prevTerrainTileForTile[ut.key],Ln=A.terrainTileForTile[ut.key];Is(Vt,Ln)&&Ta.newMorphing(ut.key,Vt,Ln,j,250),H.activeTexture.set(X.TEXTURE0),Rt.texture.bind(X.LINEAR,X.CLAMP_TO_EDGE,X.LINEAR_MIPMAP_NEAREST);const Dt=Ta.getMorphValuesForProxy(ut.key),dn=Dt?1:0;let fn;Dt&&(fn={morphing:{srcDemTile:Dt.from,dstDemTile:Dt.to,phase:p.easeCubicInOut(Dt.phase)}});const Ft=xr(ut.projMatrix,Ii(ut.canonical,Se.renderWorldCopies)?Be/10:Be);Ie(dn,Ae),A.setupElevationDraw(Rt,K,fn),I.prepareDrawProgram(H,K,ut.toUnwrapped()),K.draw(H,et,De,Wt,Fe,p.CullFaceMode.backCCW,Ft,"terrain_raster",A.gridBuffer,rt,Ze)}})}}(g,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const g=this.painter,b=this.painter.context,I=this.proxySourceCache,A=this.proxiedCoords[I.id],O=this._drapedRenderBatches.shift(),U=[],j=g.style.order;let H=0;for(const X of A){const K=I.getTileByID(X.proxyTileKey),_e=I.proxyCachedFBO[X.key]?I.proxyCachedFBO[X.key][l]:void 0,Le=void 0!==_e?I.renderCache[_e]:this.pool[H++],Ie=void 0!==_e;if(K.texture=Le.tex,Ie&&!Le.dirty){U.push(K.tileID);continue}let Fe;b.bindFramebuffer.set(Le.fb.framebuffer),this.renderedToTile=!1,Le.dirty&&(b.clear({color:p.Color.transparent,stencil:0}),Le.dirty=!1);for(let De=O.start;De<=O.end;++De){const Se=g.style._layers[j[De]];if(Se.isHidden(g.transform.zoom))continue;const Be=g.style._getLayerSourceCache(Se),Ae=Be?this.proxyToSource[X.key][Be.id]:[X];if(!Ae)continue;const et=Ae;b.viewport.set([0,0,Le.fb.width,Le.fb.height]),Fe!==(Be?Be.id:null)&&(this._setupStencil(Le,Ae,Se,Be),Fe=Be?Be.id:null),g.renderLayer(g,Be,Se,et)}this.renderedToTile?(Le.dirty=!0,U.push(K.tileID)):Ie||--H,5===H&&(H=0,this.renderToBackBuffer(U))}return this.renderToBackBuffer(U),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),O.end+1}postRender(){}renderCacheEfficiency(l){const g=l.order.length;if(0===g)return{efficiency:100};let b,I=0,A=0,O=!1;for(let U=0;U<g;++U){const j=l._layers[l.order[U]];this._style.isLayerDraped(j)?(O&&++I,++A):O||(O=!0,b=j.id)}return 0===A?{efficiency:100}:{efficiency:100*(1-I/A),firstUndrapedLayer:b}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{l=Math.min(l,g.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,g,b){if(!this._visibleDemTiles)return null;const I=this._visibleDemTiles.filter(A=>A.dem).map(A=>{const O=A.tileID,U=1<<O.overscaledZ,{x:j,y:H}=O.canonical,X=j/U,K=(j+1)/U,_e=H/U,Le=(H+1)/U;return{minx:X,miny:_e,maxx:K,maxy:Le,t:A.dem.tree.raycastRoot(X,_e,K,Le,l,g,b),tile:A}});I.sort((A,O)=>(null!==A.t?A.t:Number.MAX_VALUE)-(null!==O.t?O.t:Number.MAX_VALUE));for(const A of I){if(null==A.t)return null;const O=A.tile.dem.tree.raycast(A.minx,A.miny,A.maxx,A.maxy,l,g,b);if(null!=O)return O}return null}_createFBO(){const l=this.painter.context,g=l.gl,b=this.drapeBufferSize;l.activeTexture.set(g.TEXTURE0);const I=new p.Texture(l,{width:b[0],height:b[1],data:null},g.RGBA);I.bind(g.LINEAR,g.CLAMP_TO_EDGE);const A=l.createFramebuffer(b[0],b[1],!1);return A.colorAttachment.set(I.texture),A.depthAttachment=new ns(l,A.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,A.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):A.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:A,tex:I,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const g=this._style._layers[l],b=g.isHidden(this.painter.transform.zoom),I=g.getCrossfadeParameters(),A=!!I&&1!==I.t,O=g.hasTransition();return"custom"!==g.type&&!b&&(A||O)})}_clearRasterFadeFromRenderCache(){let l=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof ie){l=!0;break}if(l)for(let g=0;g<this._style.order.length;++g){const b=this._style._layers[this._style.order[g]],I=b.isHidden(this.painter.transform.zoom),A=this._style._getLayerSourceCache(b);if("raster"!==b.type||I||!A)continue;const O=b.paint.get("raster-fade-duration");for(const U of this.proxyCoords){const j=this.proxyToSource[U.key][A.id];if(j)for(const H of j){const X=iu(A.getTile(H),A.findLoadedParent(H,0),A,this.painter.transform,O);(1!==X.opacity||0!==X.mix)&&this._clearRenderCacheForTile(A.id,H)}}}}_setupDrapedRenderBatches(){const l=this._style.order,g=l.length;if(0===g)return;const b=[];let I,A=0,O=this._style._layers[l[A]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++A<g;)O=this._style._layers[l[A]];for(;A<g;++A){const U=this._style._layers[l[A]];U.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(U)?void 0===I&&(I=A):void 0!==I&&(b.push({start:I,end:A-1}),I=void 0))}void 0!==I&&b.push({start:I,end:A-1}),this._drapedRenderBatches=b}_setupRenderCache(l){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const O=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let U=0;U<O.length;++U){const j=Object.values(O[U]);g.renderCachePool.push(...j)}}return}this._clearRasterFadeFromRenderCache();const b=this.proxyCoords,I=this._tilesDirty;for(let O=b.length-1;O>=0;O--){const U=b[O];if(g.getTileByID(U.key),void 0!==g.proxyCachedFBO[U.key]){const j=l[U.key],H=this.proxyToSource[U.key];let X=0;for(const K in H){const _e=H[K],Le=j[K];if(!Le||Le.length!==_e.length||_e.some((Ie,Fe)=>Ie!==Le[Fe]||I[K]&&I[K].hasOwnProperty(Ie.key))){X=-1;break}++X}for(const K in g.proxyCachedFBO[U.key])g.renderCache[g.proxyCachedFBO[U.key][K]].dirty=X<0||X!==Object.values(j).length}}const A=[...this._drapedRenderBatches];A.sort((O,U)=>U.end-U.start-(O.end-O.start));for(const O of A)for(const U of b){if(g.proxyCachedFBO[U.key])continue;let j=g.renderCachePool.pop();void 0===j&&g.renderCache.length<50&&(j=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==j&&(g.proxyCachedFBO[U.key]={},g.proxyCachedFBO[U.key][O.start]=j,g.renderCache[j].dirty=!0)}this._tilesDirty={}}_setupStencil(l,g,b,I){if(!I||!this._sourceTilesOverlap[I.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const A=this.painter.context,O=A.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let U;if(b.isTileClipped())U=g.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);U=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+U>255&&(A.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=U,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,g){const b=this.painter,I=this.painter.context,A=I.gl;b._tileClippingMaskIDs={},I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=b.useProgram("clippingMask");for(const U of l){const j=b._tileClippingMaskIDs[U.key]=--g;O.draw(I,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},j,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Ji(U.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(l){const g=this.painter.transform;if(l.x<0||l.x>g.width||l.y<0||l.y>g.height)return null;const b=[l.x,l.y,1,1];p.transformMat4$1(b,b,g.pixelMatrixInverse),p.scale$1(b,b,1/b[3]),b[0]/=g.worldSize,b[1]/=g.worldSize;const I=g._camera.position,A=p.mercatorZfromAltitude(1,g.center.lat),O=[I[0],I[1],I[2]/A,0],U=p.subtract([],b.slice(0,3),O);p.normalize(U,U);const j=this.raycast(O,U,this._exaggeration);return null!==j&&j?(p.scaleAndAdd(O,O,U,j),O[3]=O[2],O[2]*=A,O):null}drawDepth(){const l=this.painter,g=l.context,b=this.proxySourceCache,I=Math.ceil(l.width),A=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===I&&this._depthFBO.height===A||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=g.gl,U=g.createFramebuffer(I,A,!0);g.activeTexture.set(O.TEXTURE0);const j=new p.Texture(g,{width:I,height:A,data:null},O.RGBA);j.bind(O.NEAREST,O.CLAMP_TO_EDGE),U.colorAttachment.set(j.texture);const H=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,I,A);U.depthAttachment.set(H),this._depthFBO=U,this._depthTexture=j}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,I,A]),function(O,U,j,H){if("globe"===O.transform.projection.name)return;const X=O.context,K=X.gl;X.clear({depth:1});const _e=O.useProgram("terrainDepth"),Le=new p.DepthMode(K.LESS,p.DepthMode.ReadWrite,O.depthRangeFor3D);for(const Ie of H){const Fe=j.getTile(Ie),De=xr(Ie.projMatrix,0);U.setupElevationDraw(Fe,_e),_e.draw(X,K.TRIANGLES,Le,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,De,"terrain_depth",U.gridBuffer,U.gridIndexBuffer,U.gridNoSkirtSegments)}}(l,this,b,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,g,b){if(l.getSource()instanceof ot)return this._setupProxiedCoordsForImageSource(l,g,b);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const I=this.proxiedCoords[l.id]=[],A=this.proxyCoords;for(let U=0;U<A.length;U++){const j=A[U],H=this._findTileCoveringTileID(j,l);if(H){const X=this._createProxiedId(j,H,b[j.key]&&b[j.key][l.id]);I.push(X),this.proxyToSource[j.key][l.id]=[X]}}let O=!1;for(let U=0;U<g.length;U++){const j=l.getTile(g[U]);if(!j||!j.hasData())continue;const H=this._findTileCoveringTileID(j.tileID,this.proxySourceCache);if(H&&H.tileID.canonical.z!==j.tileID.canonical.z){const X=this.proxyToSource[H.tileID.key][l.id],K=this._createProxiedId(H.tileID,j,b[H.tileID.key]&&b[H.tileID.key][l.id]);X?X.splice(X.length-1,0,K):this.proxyToSource[H.tileID.key][l.id]=[K],I.push(K),O=!0}}this._sourceTilesOverlap[l.id]=O}_setupProxiedCoordsForImageSource(l,g,b){if(!l.getSource().loaded())return;const I=this.proxiedCoords[l.id]=[],A=this.proxyCoords,O=l.getSource(),U=new p.pointGeometry(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),j=O.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((X,K)=>(X.min.x=Math.min(X.min.x,K.x-U.x),X.min.y=Math.min(X.min.y,K.y-U.y),X.max.x=Math.max(X.max.x,K.x-U.x),X.max.y=Math.max(X.max.y,K.y-U.y),X),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),H=(X,K)=>{const _e=X.wrap+X.canonical.x/(1<<X.canonical.z),Le=X.canonical.y/(1<<X.canonical.z),Ie=p.EXTENT/(1<<X.canonical.z),Fe=K.wrap+K.canonical.x/(1<<K.canonical.z),De=K.canonical.y/(1<<K.canonical.z);return _e+Ie<Fe+j.min.x||_e>Fe+j.max.x||Le+Ie<De+j.min.y||Le>De+j.max.y};for(let X=0;X<A.length;X++){const K=A[X];for(let _e=0;_e<g.length;_e++){const Le=l.getTile(g[_e]);if(!Le||!Le.hasData()||H(K,Le.tileID))continue;const Ie=this._createProxiedId(K,Le,b[K.key]&&b[K.key][l.id]),Fe=this.proxyToSource[K.key][l.id];Fe?Fe.push(Ie):this.proxyToSource[K.key][l.id]=[Ie],I.push(Ie)}}}_createProxiedId(l,g,b){let I=this.orthoMatrix;if(b){const A=b.find(O=>O.key===g.tileID.key);if(A)return A}if(g.tileID.key!==l.key){const A=l.canonical.z-g.tileID.canonical.z;let O,U,j;I=p.create();const H=g.tileID.wrap-l.wrap<<l.overscaledZ;A>0?(O=p.EXTENT>>A,U=O*((g.tileID.canonical.x<<A)-l.canonical.x+H),j=O*((g.tileID.canonical.y<<A)-l.canonical.y)):(O=p.EXTENT<<-A,U=p.EXTENT*(g.tileID.canonical.x-(l.canonical.x+H<<-A)),j=p.EXTENT*(g.tileID.canonical.y-(l.canonical.y<<-A))),p.ortho(I,0,O,0,O,0,1),p.translate(I,I,[U,j,0])}return new zl(g.tileID,l.key,I)}_findTileCoveringTileID(l,g){let b=g.getTile(l);if(b&&b.hasData())return b;const I=this._findCoveringTileCache[g.id],A=I[l.key];if(b=A?g.getTileByID(A):null,b&&b.hasData()||null===A)return b;let O=b?b.tileID:l,U=O.overscaledZ;const j=g.getSource().minzoom,H=[];if(!A){const K=g.getSource().maxzoom;if(l.canonical.z>=K){const _e=l.canonical.z-K;g.getSource().reparseOverscaled?(U=Math.max(l.canonical.z+2,g.transform.tileZoom),O=new p.OverscaledTileID(U,l.wrap,K,l.canonical.x>>_e,l.canonical.y>>_e)):0!==_e&&(U=K,O=new p.OverscaledTileID(U,l.wrap,K,l.canonical.x>>_e,l.canonical.y>>_e))}O.key!==l.key&&(H.push(O.key),b=g.getTile(O))}const X=K=>{H.forEach(_e=>{I[_e]=K}),H.length=0};for(U-=1;U>=j&&(!b||!b.hasData());U--){b&&X(b.tileID.key);const K=O.calculateScaledKey(U);if(b=g.getTileByID(K),b&&b.hasData())break;const _e=I[K];if(null===_e)break;void 0===_e?H.push(K):b=g.getTileByID(_e)}return X(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,g){let b=this._tilesDirty[l];b||(b=this._tilesDirty[l]={}),b[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(g){let b=0;const I=new p.StructArrayLayout2ui4,A=131;for(let O=1;O<129;O++){for(let U=1;U<129;U++)b=O*A+U,I.emplaceBack(b,b+1),I.emplaceBack(b,b+A),I.emplaceBack(b+1,b+A),128===O&&I.emplaceBack(b+A,b+A+1);I.emplaceBack(b+1,b+1+A)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mi{static cacheKey(l,g,b,I){let A=`${g}${I?I.cacheKey:""}`;for(const O of b)l.usedDefines.includes(O)&&(A+=`/${O}`);return A}constructor(l,g,b,I,A,O){const U=l.gl;this.program=U.createProgram();const j=function(De){const Se=[];for(let Be=0;Be<De.length;Be++){if(null===De[Be])continue;const Ae=De[Be].split(" ");Se.push(Ae.pop())}return Se}(b.staticAttributes),H=I?I.getBinderAttributes():[],X=j.concat(H);let K=I?I.defines():[];K=K.concat(O.map(De=>`#define ${De}`));const _e=K.concat(l.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(_l):_l,_l,vr,Xi.fragmentSource,tu.fragmentSource,b.fragmentSource).join("\n"),Le=K.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",vr,Xi.vertexSource,tu.vertexSource,Ku.vertexSource,b.vertexSource).join("\n"),Ie=U.createShader(U.FRAGMENT_SHADER);if(U.isContextLost())return void(this.failedToCreate=!0);U.shaderSource(Ie,_e),U.compileShader(Ie),U.attachShader(this.program,Ie);const Fe=U.createShader(U.VERTEX_SHADER);if(U.isContextLost())this.failedToCreate=!0;else{U.shaderSource(Fe,Le),U.compileShader(Fe),U.attachShader(this.program,Fe),this.attributes={},this.numAttributes=X.length;for(let De=0;De<this.numAttributes;De++)X[De]&&(U.bindAttribLocation(this.program,De,X[De]),this.attributes[X[De]]=De);U.linkProgram(this.program),U.deleteShader(Fe),U.deleteShader(Ie),this.fixedUniforms=A(l),this.binderUniforms=I?I.getUniforms(l):[],O.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(De=l),u_dem_prev:new p.Uniform1i(De),u_dem_unpack:new p.Uniform4f(De),u_dem_tl:new p.Uniform2f(De),u_dem_scale:new p.Uniform1f(De),u_dem_tl_prev:new p.Uniform2f(De),u_dem_scale_prev:new p.Uniform1f(De),u_dem_size:new p.Uniform1f(De),u_dem_lerp:new p.Uniform1f(De),u_exaggeration:new p.Uniform1f(De),u_depth:new p.Uniform1i(De),u_depth_size_inv:new p.Uniform2f(De),u_meter_to_dem:new p.Uniform1f(De),u_label_plane_matrix_inv:new p.UniformMatrix4f(De)}),O.includes("GLOBE")&&(this.globeUniforms=(De=>({u_tile_tl_up:new p.Uniform3f(De),u_tile_tr_up:new p.Uniform3f(De),u_tile_br_up:new p.Uniform3f(De),u_tile_bl_up:new p.Uniform3f(De),u_tile_up_scale:new p.Uniform1f(De)}))(l)),O.includes("FOG")&&(this.fogUniforms=(De=>({u_fog_matrix:new p.UniformMatrix4f(De),u_fog_range:new p.Uniform2f(De),u_fog_color:new p.Uniform4f(De),u_fog_horizon_blend:new p.Uniform1f(De),u_fog_temporal_offset:new p.Uniform1f(De),u_frustum_tl:new p.Uniform3f(De),u_frustum_tr:new p.Uniform3f(De),u_frustum_br:new p.Uniform3f(De),u_frustum_bl:new p.Uniform3f(De),u_globe_pos:new p.Uniform3f(De),u_globe_radius:new p.Uniform1f(De),u_globe_transition:new p.Uniform1f(De),u_is_globe:new p.Uniform1i(De),u_viewport:new p.Uniform2f(De)}))(l))}var De}setTerrainUniformValues(l,g){if(!this.terrainUniforms)return;const b=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I]&&b[I].set(this.program,I,g[I])}}setGlobeUniformValues(l,g){if(!this.globeUniforms)return;const b=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I]&&b[I].set(this.program,I,g[I])}}setFogUniformValues(l,g){if(!this.fogUniforms)return;const b=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I].set(this.program,I,g[I])}}draw(l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe){const De=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(b),l.setStencilMode(I),l.setColorMode(A),l.setCullFace(O);for(const Be of Object.keys(this.fixedUniforms))this.fixedUniforms[Be].set(this.program,Be,U[Be]);Ie&&Ie.setUniforms(this.program,l,this.binderUniforms,_e,{zoom:Le});const Se={[De.LINES]:2,[De.TRIANGLES]:3,[De.LINE_STRIP]:1}[g];for(const Be of K.get()){const Ae=Be.vaos||(Be.vaos={});(Ae[j]||(Ae[j]=new nu)).bind(l,this,H,Ie?Ie.getPaintVertexBuffers():[],X,Be.vertexOffset,Fe||[]),De.drawElements(g,Be.primitiveLength*Se,De.UNSIGNED_SHORT,Be.primitiveOffset*Se*2)}}}function Wr(v,l,g){const b=1/Yt(g,1,l.transform.tileZoom),I=Math.pow(2,g.tileID.overscaledZ),A=g.tileSize*Math.pow(2,l.transform.tileZoom)/I,O=A*(g.tileID.canonical.x+g.tileID.wrap*I),U=A*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[b,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[O>>16,U>>16],u_pixel_coord_lower:[65535&O,65535&U]}}const zu=p.create(),qs=(v,l,g,b,I,A,O,U,j,H,X)=>{const K=l.style.light,_e=K.properties.get("position"),Le=[_e.x,_e.y,_e.z],Ie=p.create$1();"viewport"===K.properties.get("anchor")&&(p.fromRotation(Ie,-l.transform.angle),p.transformMat3(Le,Le,Ie));const Fe=K.properties.get("color"),De=l.transform,Se={u_matrix:v,u_lightpos:Le,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[Fe.r,Fe.g,Fe.b],u_vertical_gradient:+g,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:zu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:I,u_edge_radius:A};return"globe"===De.projection.name&&(Se.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],Se.u_zoom_transition=j,Se.u_inv_rot_matrix=X,Se.u_merc_center=H,Se.u_up_dir=De.projection.upVector(new p.CanonicalTileID(0,0,0),H[0]*p.EXTENT,H[1]*p.EXTENT),Se.u_height_lift=U),Se},Js=(v,l,g,b,I,A,O,U,j,H,X,K,_e)=>{const Le=qs(v,l,g,b,I,A,O,H,X,K,_e),Ie={u_height_factor:-Math.pow(2,O.overscaledZ)/j.tileSize/8};return p.extend(Le,Wr(U,l,j),Ie)},Bs=v=>({u_matrix:v}),ou=(v,l,g,b)=>p.extend(Bs(v),Wr(g,l,b)),ul=(v,l)=>({u_matrix:v,u_world:l}),Ju=(v,l,g,b,I)=>p.extend(ou(v,l,g,b),{u_world:I}),Ts=p.create(),mu=(v,l,g,b,I,A)=>{const O=v.transform,U="globe"===O.projection.name;let j;if("map"===A.paint.get("circle-pitch-alignment"))if(U){const X=p.globePixelsToTileUnits(O.zoom,l.canonical)*O._pixelsPerMercatorPixel;j=Float32Array.from([X,0,0,X])}else j=O.calculatePixelsToTileUnitsMatrix(g);else j=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const H={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:v.translatePosMatrix(l.projMatrix,g,A.paint.get("circle-translate"),A.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:Ts,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){H.u_inv_rot_matrix=b,H.u_merc_center=I,H.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],H.u_zoom_transition=p.globeToMercatorTransition(O.zoom);const X=I[0]*p.EXTENT,K=I[1]*p.EXTENT;H.u_up_dir=O.projection.upVector(new p.CanonicalTileID(0,0,0),X,K)}return H},Zs=v=>{const l=[];return"map"===v.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===v.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},Ma=(v,l,g,b)=>{const I=p.EXTENT/g.tileSize;return{u_matrix:v,u_camera_to_center_distance:l.getCameraToCenterDistance(b),u_extrude_scale:[l.pixelsToGLUnits[0]/I,l.pixelsToGLUnits[1]/I]}},Qs=(v,l,g=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:g}),Et=p.create(),en=(v,l,g,b,I,A,O)=>{const U=v.transform,j="globe"===U.projection.name,H=j?p.globePixelsToTileUnits(U.zoom,l.canonical)*U._pixelsPerMercatorPixel:Yt(g,1,A),X={u_matrix:l.projMatrix,u_extrude_scale:H,u_intensity:O,u_inv_rot_matrix:Et,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(j){X.u_inv_rot_matrix=b,X.u_merc_center=I,X.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],X.u_zoom_transition=p.globeToMercatorTransition(U.zoom);const K=I[0]*p.EXTENT,_e=I[1]*p.EXTENT;X.u_up_dir=U.projection.upVector(new p.CanonicalTileID(0,0,0),K,_e)}return X},En=(v,l,g,b,I,A,O,U)=>{const j=v.transform,H=j.calculatePixelsToTileUnitsMatrix(l),X={u_matrix:mr(v,l,g,I),u_pixels_to_tile_units:H,u_device_pixel_ratio:O,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:A,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:U};if(xi(g)){const K=Nr(l,v.transform);X.u_texsize=l.lineAtlasTexture.size,X.u_scale=[K,b.fromScale,b.toScale],X.u_mix=b.t}return X},hr=(v,l,g,b,I,A)=>{const O=v.transform,U=Nr(l,O);return{u_matrix:mr(v,l,g,I),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:A,u_image:0,u_scale:[U,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Nr(v,l){return 1/Yt(v,1,l.tileZoom)}function mr(v,l,g,b){return v.translatePosMatrix(b||l.tileID.projMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function xi(v){const l=v.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const zi=(v,l,g,b,I,A)=>{return{u_matrix:v,u_tl_parent:l,u_scale_parent:g,u_fade_t:b.mix,u_opacity:b.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(U=I.paint.get("raster-saturation"),U>0?1-1/(1.001-U):-U),u_contrast_factor:(O=I.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:Ms(I.paint.get("raster-hue-rotate")),u_perspective_transform:A};var O,U};function Ms(v){v*=Math.PI/180;const l=Math.sin(v),g=Math.cos(v);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const hi=p.create(),Kn=(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe)=>{const De=I.transform,Se={u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:De.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:De.width/De.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:A,u_label_plane_matrix:O,u_coord_matrix:U,u_is_text:+j,u_pitch_with_map:+b,u_texsize:H,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hi,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hi,u_up_vector:[0,-1,0]};return"globe"===Fe.name&&(Se.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],Se.u_zoom_transition=K,Se.u_inv_rot_matrix=Le,Se.u_merc_center=_e,Se.u_camera_forward=De._camera.forward(),Se.u_ecef_origin=p.globeECEFOrigin(De.globeMatrix,X.toUnwrapped()),Se.u_tile_matrix=Float32Array.from(De.globeMatrix),Se.u_up_vector=Ie),Se},Ur=(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe,De)=>p.extend(Kn(v,l,g,b,I,A,O,U,j,H,K,_e,Le,Ie,Fe,De),{u_gamma_scale:b?I.transform.cameraToCenterDistance*Math.cos(I.terrain?0:I.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+X}),Zi=(v,l,g,b,I,A,O,U,j,H,X,K,_e,Le,Ie,Fe)=>p.extend(Ur(v,l,g,b,I,A,O,U,!0,j,!0,X,K,_e,Le,Ie,Fe),{u_texsize_icon:H,u_texture_icon:1}),rs=(v,l,g)=>({u_matrix:v,u_opacity:l,u_color:g}),Fa=(v,l,g,b,I,A)=>p.extend(function(O,U,j,H){const X=j.imageManager.getPattern(O.from.toString()),K=j.imageManager.getPattern(O.to.toString()),{width:_e,height:Le}=j.imageManager.getPixelSize(),Ie=Math.pow(2,H.tileID.overscaledZ),Fe=H.tileSize*Math.pow(2,j.transform.tileZoom)/Ie,De=Fe*(H.tileID.canonical.x+H.tileID.wrap*Ie),Se=Fe*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:X.tl,u_pattern_br_a:X.br,u_pattern_tl_b:K.tl,u_pattern_br_b:K.br,u_texsize:[_e,Le],u_mix:U.t,u_pattern_size_a:X.displaySize,u_pattern_size_b:K.displaySize,u_scale_a:U.fromScale,u_scale_b:U.toScale,u_tile_units_to_pixels:1/Yt(H,1,j.transform.tileZoom),u_pixel_coord_upper:[De>>16,Se>>16],u_pixel_coord_lower:[65535&De,65535&Se]}}(b,A,g,I),{u_matrix:v,u_opacity:l}),Vo={fillExtrusion:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v)}),fillExtrusionPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_height_factor:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v)}),fill:v=>({u_matrix:new p.UniformMatrix4f(v)}),fillPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v)}),fillOutline:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v)}),fillOutlinePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v)}),circle:v=>({u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),collisionBox:v=>({u_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.Uniform2f(v)}),collisionCircle:v=>({u_matrix:new p.UniformMatrix4f(v),u_inv_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_viewport_size:new p.Uniform2f(v)}),debug:v=>({u_color:new p.UniformColor(v),u_matrix:new p.UniformMatrix4f(v),u_overlay:new p.Uniform1i(v),u_overlay_scale:new p.Uniform1f(v)}),clippingMask:v=>({u_matrix:new p.UniformMatrix4f(v)}),heatmap:v=>({u_extrude_scale:new p.Uniform1f(v),u_intensity:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),heatmapTexture:v=>({u_image:new p.Uniform1i(v),u_color_ramp:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v)}),hillshade:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_latrange:new p.Uniform2f(v),u_light:new p.Uniform2f(v),u_shadow:new p.UniformColor(v),u_highlight:new p.UniformColor(v),u_accent:new p.UniformColor(v)}),hillshadePrepare:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_dimension:new p.Uniform2f(v),u_zoom:new p.Uniform1f(v),u_unpack:new p.Uniform4f(v)}),line:v=>({u_matrix:new p.UniformMatrix4f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_units_to_pixels:new p.Uniform2f(v),u_dash_image:new p.Uniform1i(v),u_gradient_image:new p.Uniform1i(v),u_image_height:new p.Uniform1f(v),u_texsize:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_mix:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v),u_trim_offset:new p.Uniform2f(v)}),linePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_texsize:new p.Uniform2f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_units_to_pixels:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v)}),raster:v=>({u_matrix:new p.UniformMatrix4f(v),u_tl_parent:new p.Uniform2f(v),u_scale_parent:new p.Uniform1f(v),u_fade_t:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_image0:new p.Uniform1i(v),u_image1:new p.Uniform1i(v),u_brightness_low:new p.Uniform1f(v),u_brightness_high:new p.Uniform1f(v),u_saturation_factor:new p.Uniform1f(v),u_contrast_factor:new p.Uniform1f(v),u_spin_weights:new p.Uniform3f(v),u_perspective_transform:new p.Uniform2f(v)}),symbolIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_texture:new p.Uniform1i(v)}),symbolSDF:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_is_halo:new p.Uniform1i(v)}),symbolTextAndIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texsize_icon:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_texture_icon:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_is_halo:new p.Uniform1i(v)}),background:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_color:new p.UniformColor(v)}),backgroundPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_pattern_tl_a:new p.Uniform2f(v),u_pattern_br_a:new p.Uniform2f(v),u_pattern_tl_b:new p.Uniform2f(v),u_pattern_br_b:new p.Uniform2f(v),u_texsize:new p.Uniform2f(v),u_mix:new p.Uniform1f(v),u_pattern_size_a:new p.Uniform2f(v),u_pattern_size_b:new p.Uniform2f(v),u_scale_a:new p.Uniform1f(v),u_scale_b:new p.Uniform1f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v)}),terrainRaster:Ia,terrainDepth:Ia,skybox:v=>({u_matrix:new p.UniformMatrix4f(v),u_sun_direction:new p.Uniform3f(v),u_cubemap:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxGradient:v=>({u_matrix:new p.UniformMatrix4f(v),u_color_ramp:new p.Uniform1i(v),u_center_direction:new p.Uniform3f(v),u_radius:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxCapture:v=>({u_matrix_3f:new p.UniformMatrix3f(v),u_sun_direction:new p.Uniform3f(v),u_sun_intensity:new p.Uniform1f(v),u_color_tint_r:new p.Uniform4f(v),u_color_tint_m:new p.Uniform4f(v),u_luminance:new p.Uniform1f(v)}),globeRaster:v=>({u_proj_matrix:new p.UniformMatrix4f(v),u_globe_matrix:new p.UniformMatrix4f(v),u_normalize_matrix:new p.UniformMatrix4f(v),u_merc_matrix:new p.UniformMatrix4f(v),u_zoom_transition:new p.Uniform1f(v),u_merc_center:new p.Uniform2f(v),u_image0:new p.Uniform1i(v),u_grid_matrix:new p.UniformMatrix3f(v),u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_globe_pos:new p.Uniform3f(v),u_globe_radius:new p.Uniform1f(v),u_viewport:new p.Uniform2f(v)}),globeAtmosphere:v=>({u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_horizon:new p.Uniform1f(v),u_transition:new p.Uniform1f(v),u_fadeout_range:new p.Uniform1f(v),u_color:new p.Uniform4f(v),u_high_color:new p.Uniform4f(v),u_space_color:new p.Uniform4f(v),u_star_intensity:new p.Uniform1f(v),u_star_density:new p.Uniform1f(v),u_star_size:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v),u_horizon_angle:new p.Uniform1f(v),u_rotation_matrix:new p.UniformMatrix4f(v)})};let Hs;function fi(v,l,g,b,I,A,O){const U=v.context,j=U.gl,H=v.transform,X=v.useProgram("collisionBox"),K=[];let _e=0,Le=0;for(let et=0;et<b.length;et++){const rt=b[et],Ze=l.getTile(rt),ut=Ze.getBucket(g);if(!ut)continue;const Rt=je(rt,ut,H);let Wt=Rt;0===I[0]&&0===I[1]||(Wt=v.translatePosMatrix(Rt,Ze,I,A));const Vt=O?ut.textCollisionBox:ut.iconCollisionBox,Ln=ut.collisionCircleArray;if(Ln.length>0){const Dt=p.create(),dn=Wt;p.mul(Dt,ut.placementInvProjMatrix,H.glCoordMatrix),p.mul(Dt,Dt,ut.placementViewportMatrix),K.push({circleArray:Ln,circleOffset:Le,transform:dn,invTransform:Dt,projection:ut.getProjection()}),_e+=Ln.length/4,Le=_e}Vt&&(v.terrain&&v.terrain.setupElevationDraw(Ze,X),X.draw(U,j.LINES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,Ma(Wt,H,Ze,ut.getProjection()),g.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,H.zoom,null,[Vt.collisionVertexBuffer,Vt.collisionVertexBufferExt]))}if(!O||!K.length)return;const Ie=v.useProgram("collisionCircle"),Fe=new p.StructArrayLayout2f1f2i16;Fe.resize(4*_e),Fe._trim();let De=0;for(const et of K)for(let rt=0;rt<et.circleArray.length/4;rt++){const Ze=4*rt,ut=et.circleArray[Ze+0],Rt=et.circleArray[Ze+1],Wt=et.circleArray[Ze+2],Vt=et.circleArray[Ze+3];Fe.emplace(De++,ut,Rt,Wt,Vt,0),Fe.emplace(De++,ut,Rt,Wt,Vt,1),Fe.emplace(De++,ut,Rt,Wt,Vt,2),Fe.emplace(De++,ut,Rt,Wt,Vt,3)}(!Hs||Hs.length<2*_e)&&(Hs=function(et){const rt=2*et,Ze=new p.StructArrayLayout3ui6;Ze.resize(rt),Ze._trim();for(let ut=0;ut<rt;ut++){const Rt=6*ut;Ze.uint16[Rt+0]=4*ut+0,Ze.uint16[Rt+1]=4*ut+1,Ze.uint16[Rt+2]=4*ut+2,Ze.uint16[Rt+3]=4*ut+2,Ze.uint16[Rt+4]=4*ut+3,Ze.uint16[Rt+5]=4*ut+0}return Ze}(_e));const Se=U.createIndexBuffer(Hs,!0),Be=U.createVertexBuffer(Fe,p.collisionCircleLayout.members,!0);for(const et of K){const rt={u_matrix:et.transform,u_inv_matrix:et.invTransform,u_camera_to_center_distance:(Ae=H).getCameraToCenterDistance(et.projection),u_viewport_size:[Ae.width,Ae.height]};Ie.draw(U,j.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,rt,g.id,Be,Se,p.SegmentVector.simpleSegment(0,2*et.circleOffset,et.circleArray.length,et.circleArray.length/2),null,H.zoom)}var Ae;Be.destroy(),Se.destroy()}const Xa=p.create();function ls(v,l,g,b,I,A){const{horizontalAlign:O,verticalAlign:U}=p.getAnchorAlignment(v),j=-(O-.5)*l,H=-(U-.5)*g,X=p.evaluateVariableOffset(v,b);return new p.pointGeometry((j/I+X[0])*A,(H/I+X[1])*A)}function Qr(v,l,g,b,I,A,O,U,j,H,X){const K=v.text.placedSymbolArray,_e=v.text.dynamicLayoutVertexArray,Le=v.icon.dynamicLayoutVertexArray,Ie={},Fe=At(U,v.getProjection(),A),De=A.elevation,Se=v.getProjection().upVectorScale(U.canonical,A.center.lat,A.worldSize);_e.clear();for(let Be=0;Be<K.length;Be++){const Ae=K.get(Be),et=v.allowVerticalPlacement&&!Ae.placedOrientation,rt=Ae.hidden||!Ae.crossTileID||et?null:b[Ae.crossTileID];if(rt){const Ze=new p.pointGeometry(Ae.tileAnchorX,Ae.tileAnchorY),ut=v.getProjection().upVector(U.canonical,Ze.x,Ze.y),Rt=De?De.getAtTileOffset(U,Ze.x,Ze.y):0,Wt=or([Ae.projectedAnchorX+Rt*ut[0]*Se.metersToTile,Ae.projectedAnchorY+Rt*ut[1]*Se.metersToTile,Ae.projectedAnchorZ+Rt*ut[2]*Se.metersToTile],g?Fe:O),Vt=Vr(A.getCameraToCenterDistance(v.getProjection()),Wt.signedDistanceFromCamera);let Ln=I.evaluateSizeForFeature(v.textSizeData,H,Ae)*Vt/p.ONE_EM;g&&(Ln*=v.tilePixelRatio/j);const{width:Dt,height:dn,anchor:fn,textOffset:Ft,textScale:bt}=rt,Jn=ls(fn,Dt,dn,Ft,bt,Ln);let Nn;if(g){const Bn=Ze.add(Jn),{x:fr,y:qr,z:kr}=v.getProjection().projectTilePoint(Bn.x,Bn.y,U.canonical);Nn=or([fr+Rt*ut[0]*Se.metersToTile,qr+Rt*ut[1]*Se.metersToTile,kr+Rt*ut[2]*Se.metersToTile],O).point}else{const Bn=l?Jn.rotate(-A.angle):Jn;Nn=[Wt.point[0]+Bn.x,Wt.point[1]+Bn.y,0]}const Vn=v.allowVerticalPlacement&&Ae.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let Bn=0;Bn<Ae.numGlyphs;Bn++)p.addDynamicAttributes(_e,Nn[0],Nn[1],Nn[2],Vn);X&&Ae.associatedIconIndex>=0&&(Ie[Ae.associatedIconIndex]={shiftedAnchor:Nn,angle:Vn})}else k(Ae.numGlyphs,_e)}if(X){Le.clear();const Be=v.icon.placedSymbolArray;for(let Ae=0;Ae<Be.length;Ae++){const et=Be.get(Ae);if(et.hidden)k(et.numGlyphs,Le);else{const rt=Ie[Ae];if(rt)for(let Ze=0;Ze<et.numGlyphs;Ze++)p.addDynamicAttributes(Le,rt.shiftedAnchor[0],rt.shiftedAnchor[1],rt.shiftedAnchor[2],rt.angle);else k(et.numGlyphs,Le)}}v.icon.dynamicLayoutVertexBuffer.updateData(Le)}v.text.dynamicLayoutVertexBuffer.updateData(_e)}function Qu(v,l,g){return g.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function Qi(v,l,g,b,I,A,O,U,j,H,X,K){const _e=v.context,Le=_e.gl,Ie=v.transform,Fe="map"===U,De="map"===j,Se=Fe&&"point"!==g.layout.get("symbol-placement"),Be=Fe&&!De&&!Se,Ae=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let et=!1;const rt=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ze=[p.mercatorXfromLng(Ie.center.lng),p.mercatorYfromLat(Ie.center.lat)],ut=g.layout.get("text-variable-anchor"),Rt="globe"===Ie.projection.name,Wt=[],Vt=[0,-1,0];let Ln=Vt;!Rt&&!Ie.mercatorFromTransition||Fe||(Ln=function(Dt){const dn=Dt._camera.getWorldToCamera(Dt.worldSize,1),fn=p.multiply([],dn,Dt.globeMatrix);p.invert(fn,fn);const Ft=[0,0,0],bt=[0,1,0,0];return p.transformMat4$1(bt,bt,fn),Ft[0]=bt[0],Ft[1]=bt[1],Ft[2]=bt[2],p.normalize(Ft,Ft),Ft}(Ie));for(const Dt of b){const dn=l.getTile(Dt),fn=dn.getBucket(g);if(!fn||"mercator"===fn.projection.name&&Rt)continue;const Ft=I?fn.text:fn.icon;if(!Ft||fn.fullyClipped||!Ft.segments.get().length)continue;const bt=Ft.programConfigurations.get(g.id),Jn=I||fn.sdfIcons,Nn=I?fn.textSizeData:fn.iconSizeData,Vn=De||0!==Ie.pitch,Bn=p.evaluateSizeForZoom(Nn,Ie.zoom);let fr,qr,kr,wr,Un=[0,0],Zr=null;if(I){if(qr=dn.glyphAtlasTexture,kr=Le.LINEAR,fr=dn.glyphAtlasTexture.size,fn.iconsInText){Un=dn.imageAtlasTexture.size,Zr=dn.imageAtlasTexture;const Va="composite"===Nn.kind||"camera"===Nn.kind;wr=Vn||v.options.rotating||v.options.zooming||Va?Le.LINEAR:Le.NEAREST}}else{const Va=1!==g.layout.get("icon-size").constantOr(0)||fn.iconsNeedLinear;qr=dn.imageAtlasTexture,kr=Jn||v.options.rotating||v.options.zooming||Va||Vn?Le.LINEAR:Le.NEAREST,fr=dn.imageAtlasTexture.size}const wi="globe"===fn.projection.name,$o=wi?Ln:Vt,ms=wi?p.globeToMercatorTransition(Ie.zoom):0,qo=At(Dt,fn.getProjection(),Ie),ja=Ie.calculatePixelsToTileUnitsMatrix(dn),Uu=Ea(qo,dn.tileID.canonical,De,Fe,Ie,fn.getProjection(),ja),Wa=v.terrain&&De&&Se?p.invert(p.create(),Uu):Xa,As=Fi(qo,dn.tileID.canonical,De,Fe,Ie,fn.getProjection(),ja),Ps=ut&&fn.hasTextData(),lo="none"!==g.layout.get("icon-text-fit")&&Ps&&fn.hasIconData();if(Se){const Va=Ie.elevation,Au=Va?Va.getAtTileOffsetFunc(Dt,Ie.center.lat,Ie.worldSize,fn.getProjection()):Cl=>[0,0,0],Kc=Ca(qo,dn.tileID.canonical,De,Fe,Ie,fn.getProjection(),ja);sl(fn,qo,v,I,Kc,As,De,H,Au,Dt)}const ya=Se||I&&ut||lo,uu=v.translatePosMatrix(qo,dn,A,O),cs=ya?Xa:Uu,el=v.translatePosMatrix(As,dn,A,O,!0),Wc=fn.getProjection().createInversionMatrix(Ie,Dt.canonical),El=[];v.terrainRenderModeElevated()&&De&&El.push("PITCH_WITH_MAP_TERRAIN"),wi&&El.push("PROJECTION_GLOBE_VIEW"),ya&&El.push("PROJECTED_POS_ON_VIEWPORT");const Du=Jn&&0!==g.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1);let _h;_h=Jn?fn.iconsInText?Zi(Nn.kind,Bn,Be,De,v,uu,cs,el,fr,Un,Dt,ms,Ze,Wc,$o,fn.getProjection()):Ur(Nn.kind,Bn,Be,De,v,uu,cs,el,I,fr,!0,Dt,ms,Ze,Wc,$o,fn.getProjection()):Kn(Nn.kind,Bn,Be,De,v,uu,cs,el,I,fr,Dt,ms,Ze,Wc,$o,fn.getProjection());const Yc={program:v.useProgram(Qu(Jn,I,fn),bt,El),buffers:Ft,uniformValues:_h,atlasTexture:qr,atlasTextureIcon:Zr,atlasInterpolation:kr,atlasInterpolationIcon:wr,isSDF:Jn,hasHalo:Du,tile:dn,labelPlaneMatrixInv:Wa};if(Ae&&fn.canOverlap){et=!0;const Va=Ft.segments.get();for(const Au of Va)Wt.push({segments:new p.SegmentVector([Au]),sortKey:Au.sortKey,state:Yc})}else Wt.push({segments:Ft.segments,sortKey:0,state:Yc})}et&&Wt.sort((Dt,dn)=>Dt.sortKey-dn.sortKey);for(const Dt of Wt){const dn=Dt.state;if(v.terrain&&v.terrain.setupElevationDraw(dn.tile,dn.program,{useDepthForOcclusion:!Rt,labelPlaneMatrixInv:dn.labelPlaneMatrixInv}),_e.activeTexture.set(Le.TEXTURE0),dn.atlasTexture.bind(dn.atlasInterpolation,Le.CLAMP_TO_EDGE),dn.atlasTextureIcon&&(_e.activeTexture.set(Le.TEXTURE1),dn.atlasTextureIcon&&dn.atlasTextureIcon.bind(dn.atlasInterpolationIcon,Le.CLAMP_TO_EDGE)),dn.isSDF){const fn=dn.uniformValues;dn.hasHalo&&(fn.u_is_halo=1,Vi(dn.buffers,Dt.segments,g,v,dn.program,rt,X,K,fn)),fn.u_is_halo=0}Vi(dn.buffers,Dt.segments,g,v,dn.program,rt,X,K,dn.uniformValues)}}function Vi(v,l,g,b,I,A,O,U,j){const H=b.context,X=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.globeExtVertexBuffer];I.draw(H,H.gl.TRIANGLES,A,O,U,p.CullFaceMode.disabled,j,g.id,v.layoutVertexBuffer,v.indexBuffer,l,g.paint,b.transform.zoom,v.programConfigurations.get(g.id),X)}function ha(v,l,g,b,I,A,O){const U=v.context.gl,j=g.paint.get("fill-pattern"),H=j&&j.constantOr(1),X=g.getCrossfadeParameters();let K,_e,Le,Ie,Fe;O?(_e=H&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",K=U.LINES):(_e=H?"fillPattern":"fill",K=U.TRIANGLES);for(const De of b){const Se=l.getTile(De);if(H&&!Se.patternsLoaded())continue;const Be=Se.getBucket(g);if(!Be)continue;v.prepareDrawTile();const Ae=Be.programConfigurations.get(g.id),et=v.useProgram(_e,Ae);H&&(v.context.activeTexture.set(U.TEXTURE0),Se.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ae.updatePaintBuffers(X));const rt=j.constantOr(null);if(rt&&Se.imageAtlas){const ut=Se.imageAtlas,Rt=ut.patternPositions[rt.to.toString()],Wt=ut.patternPositions[rt.from.toString()];Rt&&Wt&&Ae.setConstantPatternPositions(Rt,Wt)}const Ze=v.translatePosMatrix(De.projMatrix,Se,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(O){Ie=Be.indexBuffer2,Fe=Be.segments2;const ut=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];Le="fillOutlinePattern"===_e&&H?Ju(Ze,v,X,Se,ut):ul(Ze,ut)}else Ie=Be.indexBuffer,Fe=Be.segments,Le=H?ou(Ze,v,X,Se):Bs(Ze);v.prepareDrawProgram(v.context,et,De.toUnwrapped()),et.draw(v.context,K,I,v.stencilModeForClipping(De),A,p.CullFaceMode.disabled,Le,g.id,Be.layoutVertexBuffer,Ie,Fe,g.paint,v.transform.zoom,Ae)}}function eo(v,l,g,b,I,A,O){const U=v.context,j=U.gl,H=v.transform,X=g.paint.get("fill-extrusion-pattern"),K=X.constantOr(1),_e=g.getCrossfadeParameters(),Le=g.paint.get("fill-extrusion-opacity"),Ie=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],Fe=g.layout.get("fill-extrusion-edge-radius"),De="globe"===H.projection.name?p.fillExtrusionHeightLift():0,Se="globe"===H.projection.name,Be=Se?p.globeToMercatorTransition(H.zoom):0,Ae=[p.mercatorXfromLng(H.center.lng),p.mercatorYfromLat(H.center.lat)],et=[];Se&&(et.push("PROJECTION_GLOBE_VIEW"),v.style.terrainSetForDrapingOnly()&&et.push("TERRAIN")),Ie[0]>0&&et.push("FAUX_AO");for(const rt of b){const Ze=l.getTile(rt),ut=Ze.getBucket(g);if(!ut||ut.projection.name!==H.projection.name)continue;const Rt=ut.programConfigurations.get(g.id),Wt=v.useProgram(K?"fillExtrusionPattern":"fillExtrusion",Rt,et);if(v.terrain){const bt=v.terrain;if(v.style.terrainSetForDrapingOnly())bt.setupElevationDraw(Ze,Wt,{useMeterToDem:!0});else{if(!ut.enableTerrain)continue;if(bt.setupElevationDraw(Ze,Wt,{useMeterToDem:!0}),is(U,l,rt,ut,g,bt),!ut.centroidVertexBuffer){const Jn=Wt.attributes.a_centroid_pos;void 0!==Jn&&j.vertexAttrib2f(Jn,0,0)}}}K&&(v.context.activeTexture.set(j.TEXTURE0),Ze.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Rt.updatePaintBuffers(_e));const Vt=X.constantOr(null);if(Vt&&Ze.imageAtlas){const bt=Ze.imageAtlas,Jn=bt.patternPositions[Vt.to.toString()],Nn=bt.patternPositions[Vt.from.toString()];Jn&&Nn&&Rt.setConstantPatternPositions(Jn,Nn)}const Ln=v.translatePosMatrix(rt.projMatrix,Ze,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),Dt=H.projection.createInversionMatrix(H,rt.canonical),dn=g.paint.get("fill-extrusion-vertical-gradient"),fn=K?Js(Ln,v,dn,Le,Ie,Fe,rt,_e,Ze,De,Be,Ae,Dt):qs(Ln,v,dn,Le,Ie,Fe,rt,De,Be,Ae,Dt);v.prepareDrawProgram(U,Wt,rt.toUnwrapped());const Ft=[];v.terrain&&Ft.push(ut.centroidVertexBuffer),Se&&Ft.push(ut.layoutVertexExtBuffer),Wt.draw(U,U.gl.TRIANGLES,I,A,O,p.CullFaceMode.backCCW,fn,g.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,g.paint,v.transform.zoom,Rt,Ft)}}function is(v,l,g,b,I,A){const O=[Se=>{let Be=Se.canonical.x-1,Ae=Se.wrap;return Be<0&&(Be=(1<<Se.canonical.z)-1,Ae--),new p.OverscaledTileID(Se.overscaledZ,Ae,Se.canonical.z,Be,Se.canonical.y)},Se=>{let Be=Se.canonical.x+1,Ae=Se.wrap;return Be===1<<Se.canonical.z&&(Be=0,Ae++),new p.OverscaledTileID(Se.overscaledZ,Ae,Se.canonical.z,Be,Se.canonical.y)},Se=>new p.OverscaledTileID(Se.overscaledZ,Se.wrap,Se.canonical.z,Se.canonical.x,(0===Se.canonical.y?1<<Se.canonical.z:Se.canonical.y)-1),Se=>new p.OverscaledTileID(Se.overscaledZ,Se.wrap,Se.canonical.z,Se.canonical.x,Se.canonical.y===(1<<Se.canonical.z)-1?0:Se.canonical.y+1)],U=Se=>{const Be=l.getSource().minzoom,Ae=rt=>{const Ze=l.getTileByID(rt);if(Ze&&Ze.hasData())return Ze.getBucket(I)},et=[0,-1,1];for(const rt of et){if(Se.overscaledZ+rt<Be)continue;const Ze=Ae(Se.calculateScaledKey(Se.overscaledZ+rt));if(Ze)return Ze}},j=[0,0,0],H=(Se,Be)=>(j[0]=Math.min(Se.min.y,Be.min.y),j[1]=Math.max(Se.max.y,Be.max.y),j[2]=p.EXTENT-Be.min.x>Se.max.x?Be.min.x-p.EXTENT:Se.max.x,j),X=(Se,Be)=>(j[0]=Math.min(Se.min.x,Be.min.x),j[1]=Math.max(Se.max.x,Be.max.x),j[2]=p.EXTENT-Be.min.y>Se.max.y?Be.min.y-p.EXTENT:Se.max.y,j),K=[(Se,Be)=>H(Se,Be),(Se,Be)=>H(Be,Se),(Se,Be)=>X(Se,Be),(Se,Be)=>X(Be,Se)],_e=new p.pointGeometry(0,0);let Le,Ie,Fe;const De=(Se,Be,Ae,et,rt)=>{const Ze=[[et?Ae:Se,et?Se:Ae,0],[et?Ae:Be,et?Be:Ae,0]],ut=rt<0?p.EXTENT+rt:rt,Rt=[et?ut:(Se+Be)/2,et?(Se+Be)/2:ut,0];return 0===Ae&&rt<0||0!==Ae&&rt>0?A.getForTilePoints(Fe,[Rt],!0,Ie):Ze.push(Rt),A.getForTilePoints(g,Ze,!0,Le),Math.max(Ze[0][2],Ze[1][2],Rt[2])/A.exaggeration()};for(let Se=0;Se<4;Se++){const Be=(Se<2?1:5)-Se,Ae=b.borders[Se];if(0===Ae.length)continue;const et=Fe=O[Se](g),rt=U(et);if(!(rt&&rt instanceof p.FillExtrusionBucket&&rt.enableTerrain)||b.borderDoneWithNeighborZ[Se]===rt.canonical.z&&rt.borderDoneWithNeighborZ[Be]===b.canonical.z||(Ie=A.findDEMTileFor(et),!Ie||!Ie.dem))continue;if(!Le){const Wt=A.findDEMTileFor(g);if(!Wt||!Wt.dem)return;Le=Wt}const Ze=rt.borders[Be];let ut=0;const Rt=rt.borderDoneWithNeighborZ[Be]!==b.canonical.z;if(b.canonical.z===rt.canonical.z){for(let Wt=0;Wt<Ae.length;Wt++){const Vt=b.featuresOnBorder[Ae[Wt]],Ln=Vt.borders[Se];let Dt;for(;ut<Ze.length&&(Dt=rt.featuresOnBorder[Ze[ut]],!(Dt.borders[Be][1]>Ln[0]+3));)Rt&&rt.encodeCentroid(void 0,Dt,!1),ut++;if(Dt&&ut<Ze.length){const dn=ut;let fn=0;for(;!(Dt.borders[Be][0]>Ln[1]-3)&&(fn++,++ut!==Ze.length);)Dt=rt.featuresOnBorder[Ze[ut]];if(Dt=rt.featuresOnBorder[Ze[dn]],Vt.intersectsCount()>1||Dt.intersectsCount()>1||1!==fn){1!==fn&&(ut=dn),b.encodeCentroid(void 0,Vt,!1),Rt&&rt.encodeCentroid(void 0,Dt,!1);continue}const Ft=K[Se](Vt,Dt),bt=Se%2?p.EXTENT-1:0;_e.x=De(Ft[0],Math.min(p.EXTENT-1,Ft[1]),bt,Se<2,Ft[2]),_e.y=0,b.encodeCentroid(_e,Vt,!1),Rt&&rt.encodeCentroid(_e,Dt,!1)}else b.encodeCentroid(void 0,Vt,!1)}b.borderDoneWithNeighborZ[Se]=rt.canonical.z,b.needsCentroidUpdate=!0,Rt&&(rt.borderDoneWithNeighborZ[Be]=b.canonical.z,rt.needsCentroidUpdate=!0)}else{for(const Wt of Ae)b.encodeCentroid(void 0,b.featuresOnBorder[Wt],!1);if(Rt){for(const Wt of Ze)rt.encodeCentroid(void 0,rt.featuresOnBorder[Wt],!1);rt.borderDoneWithNeighborZ[Be]=b.canonical.z,rt.needsCentroidUpdate=!0}b.borderDoneWithNeighborZ[Se]=rt.canonical.z,b.needsCentroidUpdate=!0}}(b.needsCentroidUpdate||!b.centroidVertexBuffer&&0!==b.centroidVertexArray.length)&&b.uploadCentroid(v)}const fo=new p.Color(1,0,0,1),$i=new p.Color(0,1,0,1),su=new p.Color(0,0,1,1),Za=new p.Color(1,0,1,1),qi=new p.Color(0,1,1,1);function Go(v,l,g){const b=v.context,I=v.transform,A=b.gl,O="globe"===I.projection.name,U=O?["PROJECTION_GLOBE_VIEW"]:null;let j=g.projMatrix;if(O&&p.globeToMercatorTransition(I.zoom)>0){const Vt=p.transitionTileAABBinECEF(g.canonical,I),Ln=p.globeDenormalizeECEF(Vt);j=p.multiply(new Float32Array(16),I.globeMatrix,Ln),p.multiply(j,I.projMatrix,j)}const H=v.useProgram("debug",null,U),X=l.getTileByID(g.key);v.terrain&&v.terrain.setupElevationDraw(X,H);const K=p.DepthMode.disabled,_e=p.StencilMode.disabled,Le=v.colorModeForRenderPass();b.activeTexture.set(A.TEXTURE0),v.emptyTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),O?X._makeGlobeTileDebugBuffers(v.context,I):X._makeDebugTileBoundsBuffers(v.context,I.projection);const Fe=X._tileDebugBuffer||v.debugBuffer,De=X._tileDebugIndexBuffer||v.debugIndexBuffer,Se=X._tileDebugSegments||v.debugSegments;H.draw(b,A.LINE_STRIP,K,_e,Le,p.CullFaceMode.disabled,Qs(j,p.Color.red),"$debug",Fe,De,Se,null,null,null,[X._globeTileDebugBorderBuffer]);const Be=X.latestRawTileData,Ae=Math.floor((Be&&Be.byteLength||0)/1024),et=l.getTile(g).tileSize,rt=512/Math.min(et,512)*(g.overscaledZ/I.zoom)*.5;let Ze=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Ze+=` => ${g.overscaledZ}`),Ze+=` ${Ae}kb`,function(Vt,Ln){Vt.initDebugOverlayCanvas();const Dt=Vt.debugOverlayCanvas,dn=Vt.context.gl,fn=Vt.debugOverlayCanvas.getContext("2d");fn.clearRect(0,0,Dt.width,Dt.height),fn.shadowColor="white",fn.shadowBlur=2,fn.lineWidth=1.5,fn.strokeStyle="white",fn.textBaseline="top",fn.font="bold 36px Open Sans, sans-serif",fn.fillText(Ln,5,5),fn.strokeText(Ln,5,5),Vt.debugOverlayTexture.update(Dt),Vt.debugOverlayTexture.bind(dn.LINEAR,dn.CLAMP_TO_EDGE)}(v,Ze);const ut=X._tileDebugTextBuffer||v.debugBuffer,Rt=X._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,Wt=X._tileDebugTextSegments||v.debugSegments;H.draw(b,A.TRIANGLES,K,_e,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Qs(j,p.Color.transparent,rt),"$debug",ut,Rt,Wt,null,null,null,[X._globeTileDebugTextBuffer])}function no(v,l,g,b){os(v,0,l+g/2,v.transform.width,g,b)}function za(v,l,g,b){os(v,l-g/2,0,g,v.transform.height,b)}function os(v,l,g,b,I,A){const O=v.context,U=O.gl;U.enable(U.SCISSOR_TEST),U.scissor(l*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio,I*p.exported.devicePixelRatio),O.clear({color:A}),U.disable(U.SCISSOR_TEST)}const yu=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ba}=yu;function Wi(v,l,g,b){v.emplaceBack(l,g,b)}class ei{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,Wi(this.vertexArray,-1,-1,1),Wi(this.vertexArray,1,-1,1),Wi(this.vertexArray,-1,1,1),Wi(this.vertexArray,1,1,1),Wi(this.vertexArray,-1,-1,-1),Wi(this.vertexArray,1,-1,-1),Wi(this.vertexArray,-1,1,-1),Wi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,Ba),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function ps(v,l,g,b,I,A){const O=v.gl,U=l.paint.get("sky-atmosphere-color"),j=l.paint.get("sky-atmosphere-halo-color"),H=l.paint.get("sky-atmosphere-sun-intensity"),X={u_matrix_3f:p.fromMat4(p.create$1(),b),u_sun_direction:I,u_sun_intensity:H,u_color_tint_r:[(Ie=U).r,Ie.g,Ie.b,Ie.a],u_color_tint_m:[(Fe=j).r,Fe.g,Fe.b,Fe.a],u_luminance:5e-5};var Ie,Fe;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+A,l.skyboxTexture,0),g.draw(v,O.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,X,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const ro=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Xc{constructor(l){const g=new p.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const b=new p.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(g,ro.members),this.indexBuffer=l.createIndexBuffer(b),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const aa={symbol:function(v,l,g,b,I){if("translucent"!==v.renderPass)return;const A=p.StencilMode.disabled,O=v.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(U,j,H,X,K,_e,Le){const Ie=j.transform,Fe="map"===K,De="map"===_e;for(const Se of U){const Be=X.getTile(Se),Ae=Be.getBucket(H);if(!Ae||!Ae.text||!Ae.text.segments.get().length)continue;const et=p.evaluateSizeForZoom(Ae.textSizeData,Ie.zoom),rt=At(Se,Ae.getProjection(),Ie),Ze=Ie.calculatePixelsToTileUnitsMatrix(Be),ut=Ea(rt,Be.tileID.canonical,De,Fe,Ie,Ae.getProjection(),Ze),Rt="none"!==H.layout.get("icon-text-fit")&&Ae.hasIconData();if(et){const Wt=Math.pow(2,Ie.zoom-Be.tileID.overscaledZ);Qr(Ae,Fe,De,Le,p.symbolSize,Ie,ut,Se,Wt,et,Rt)}}}(b,v,g,l,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),I),0!==g.paint.get("icon-opacity").constantOr(1)&&Qi(v,l,g,b,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),A,O),0!==g.paint.get("text-opacity").constantOr(1)&&Qi(v,l,g,b,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),A,O),l.map.showCollisionBoxes&&(fi(v,l,g,b,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),fi(v,l,g,b,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,g,b){if("translucent"!==v.renderPass)return;const I=g.paint.get("circle-opacity"),A=g.paint.get("circle-stroke-width"),O=g.paint.get("circle-stroke-opacity"),U=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===I.constantOr(1)&&(0===A.constantOr(1)||0===O.constantOr(1)))return;const j=v.context,H=j.gl,X=v.transform,K=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),_e=p.StencilMode.disabled,Le=v.colorModeForRenderPass(),Ie="globe"===X.projection.name,Fe=[p.mercatorXfromLng(X.center.lng),p.mercatorYfromLat(X.center.lat)],De=[];for(let Be=0;Be<b.length;Be++){const Ae=b[Be],et=l.getTile(Ae),rt=et.getBucket(g);if(!rt||rt.projection.name!==X.projection.name)continue;const Ze=rt.programConfigurations.get(g.id),ut=Zs(g);Ie&&ut.push("PROJECTION_GLOBE_VIEW");const Rt=v.useProgram("circle",Ze,ut),Wt=rt.layoutVertexBuffer,Vt=rt.globeExtVertexBuffer,Ln=rt.indexBuffer,Dt=X.projection.createInversionMatrix(X,Ae.canonical),dn={programConfiguration:Ze,program:Rt,layoutVertexBuffer:Wt,globeExtVertexBuffer:Vt,indexBuffer:Ln,uniformValues:mu(v,Ae,et,Dt,Fe,g),tile:et};if(U){const fn=rt.segments.get();for(const Ft of fn)De.push({segments:new p.SegmentVector([Ft]),sortKey:Ft.sortKey,state:dn})}else De.push({segments:rt.segments,sortKey:0,state:dn})}U&&De.sort((Be,Ae)=>Be.sortKey-Ae.sortKey);const Se={useDepthForOcclusion:!Ie};for(const Be of De){const{programConfiguration:Ae,program:et,layoutVertexBuffer:rt,globeExtVertexBuffer:Ze,indexBuffer:ut,uniformValues:Rt,tile:Wt}=Be.state,Vt=Be.segments;v.terrain&&v.terrain.setupElevationDraw(Wt,et,Se),v.prepareDrawProgram(j,et,Wt.tileID.toUnwrapped()),et.draw(j,H.TRIANGLES,K,_e,Le,p.CullFaceMode.disabled,Rt,g.id,rt,ut,Vt,g.paint,X.zoom,Ae,[Ze])}},heatmap:function(v,l,g,b){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){const I=v.context,A=I.gl,O=p.StencilMode.disabled,U=new p.ColorMode([A.ONE,A.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(Le,Ie,Fe,De){const Se=Le.gl,Be=Ie.width*De,Ae=Ie.height*De;Le.activeTexture.set(Se.TEXTURE1),Le.viewport.set([0,0,Be,Ae]);let et=Fe.heatmapFbo;if(!et||et&&(et.width!==Be||et.height!==Ae)){et&&et.destroy();const rt=Se.createTexture();Se.bindTexture(Se.TEXTURE_2D,rt),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_S,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_WRAP_T,Se.CLAMP_TO_EDGE),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MIN_FILTER,Se.LINEAR),Se.texParameteri(Se.TEXTURE_2D,Se.TEXTURE_MAG_FILTER,Se.LINEAR),et=Fe.heatmapFbo=Le.createFramebuffer(Be,Ae,!1),function(Ze,ut,Rt,Wt,Vt,Ln){const Dt=Ze.gl;Dt.texImage2D(Dt.TEXTURE_2D,0,Dt.RGBA,Vt,Ln,0,Dt.RGBA,Ze.extRenderToTextureHalfFloat?Ze.extTextureHalfFloat.HALF_FLOAT_OES:Dt.UNSIGNED_BYTE,null),Wt.colorAttachment.set(Rt)}(Le,0,rt,et,Be,Ae)}else Se.bindTexture(Se.TEXTURE_2D,et.colorAttachment.get()),Le.bindFramebuffer.set(et.framebuffer)})(I,v,g,"globe"===v.transform.projection.name?.5:.25),I.clear({color:p.Color.transparent});const j=v.transform,H="globe"===j.projection.name,X=H?["PROJECTION_GLOBE_VIEW"]:null,K=H?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,_e=[p.mercatorXfromLng(j.center.lng),p.mercatorYfromLat(j.center.lat)];for(let Le=0;Le<b.length;Le++){const Ie=b[Le];if(l.hasRenderableParent(Ie))continue;const Fe=l.getTile(Ie),De=Fe.getBucket(g);if(!De||De.projection.name!==j.projection.name)continue;const Se=De.programConfigurations.get(g.id),Be=v.useProgram("heatmap",Se,X),{zoom:Ae}=v.transform;v.terrain&&v.terrain.setupElevationDraw(Fe,Be),v.prepareDrawProgram(I,Be,Ie.toUnwrapped());const et=j.projection.createInversionMatrix(j,Ie.canonical);Be.draw(I,A.TRIANGLES,p.DepthMode.disabled,O,U,K,en(v,Ie,Fe,et,_e,Ae,g.paint.get("heatmap-intensity")),g.id,De.layoutVertexBuffer,De.indexBuffer,De.segments,g.paint,v.transform.zoom,Se,H?[De.globeExtVertexBuffer]:null)}I.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(I,A){const O=I.context,U=O.gl,j=A.heatmapFbo;if(!j)return;O.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,j.colorAttachment.get()),O.activeTexture.set(U.TEXTURE1);let H=A.colorRampTexture;H||(H=A.colorRampTexture=new p.Texture(O,A.colorRamp,U.RGBA)),H.bind(U.LINEAR,U.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(O,U.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,I.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:A.paint.get("heatmap-opacity")},A.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,A.paint,I.transform.zoom)}(v,g))},line:function(v,l,g,b){if("translucent"!==v.renderPass)return;const I=g.paint.get("line-opacity"),A=g.paint.get("line-width");if(0===I.constantOr(1)||0===A.constantOr(1))return;const O=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),U=v.colorModeForRenderPass(),j=v.terrain&&v.terrain.renderingToTexture?1:p.exported.devicePixelRatio,H=g.paint.get("line-dasharray"),X=H.constantOr(1),K=g.layout.get("line-cap"),_e=g.paint.get("line-pattern"),Le=_e.constantOr(1),Ie=g.paint.get("line-gradient"),Fe=g.getCrossfadeParameters(),De=Le?"linePattern":"line",Se=v.context,Be=Se.gl,Ae=(rt=>{const Ze=[];xi(rt)&&Ze.push("RENDER_LINE_DASH"),rt.paint.get("line-gradient")&&Ze.push("RENDER_LINE_GRADIENT");const ut=rt.paint.get("line-trim-offset");0===ut[0]&&0===ut[1]||Ze.push("RENDER_LINE_TRIM_OFFSET");const Rt=rt.paint.get("line-pattern").constantOr(1),Wt=1!==rt.paint.get("line-opacity").constantOr(1);return!Rt&&Wt&&Ze.push("RENDER_LINE_ALPHA_DISCARD"),Ze})(g);let et=Ae.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(et=!1);for(const rt of b){const Ze=l.getTile(rt);if(Le&&!Ze.patternsLoaded())continue;const ut=Ze.getBucket(g);if(!ut)continue;v.prepareDrawTile();const Rt=ut.programConfigurations.get(g.id),Wt=v.useProgram(De,Rt,Ae),Vt=_e.constantOr(null);if(Vt&&Ze.imageAtlas){const Nn=Ze.imageAtlas,Vn=Nn.patternPositions[Vt.to.toString()],Bn=Nn.patternPositions[Vt.from.toString()];Vn&&Bn&&Rt.setConstantPatternPositions(Vn,Bn)}const Ln=H.constantOr(null),Dt=K.constantOr(null);if(!Le&&Ln&&Dt&&Ze.lineAtlas){const Nn=Ze.lineAtlas,Vn=Nn.getDash(Ln.to,Dt),Bn=Nn.getDash(Ln.from,Dt);Vn&&Bn&&Rt.setConstantPatternPositions(Vn,Bn)}let[dn,fn]=g.paint.get("line-trim-offset");("round"===Dt||"square"===Dt)&&dn!==fn&&(0===dn&&(dn-=1),1===fn&&(fn+=1));const Ft=v.terrain?rt.projMatrix:null,bt=Le?hr(v,Ze,g,Fe,Ft,j):En(v,Ze,g,Fe,Ft,ut.lineClipsArray.length,j,[dn,fn]);if(Ie){const Nn=ut.gradients[g.id];let Vn=Nn.texture;if(g.gradientVersion!==Nn.version){let Bn=256;if(g.stepInterpolant){const fr=l.getSource().maxzoom,qr=rt.canonical.z===fr?Math.ceil(1<<v.transform.maxZoom-rt.canonical.z):1;Bn=p.clamp(p.nextPowerOfTwo(ut.maxLineLength/p.EXTENT*1024*qr),256,Se.maxTextureSize)}Nn.gradient=p.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:Bn,image:Nn.gradient||void 0,clips:ut.lineClipsArray}),Nn.texture?Nn.texture.update(Nn.gradient):Nn.texture=new p.Texture(Se,Nn.gradient,Be.RGBA),Nn.version=g.gradientVersion,Vn=Nn.texture}Se.activeTexture.set(Be.TEXTURE1),Vn.bind(g.stepInterpolant?Be.NEAREST:Be.LINEAR,Be.CLAMP_TO_EDGE)}X&&(Se.activeTexture.set(Be.TEXTURE0),Ze.lineAtlasTexture.bind(Be.LINEAR,Be.REPEAT),Rt.updatePaintBuffers(Fe)),Le&&(Se.activeTexture.set(Be.TEXTURE0),Ze.imageAtlasTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Rt.updatePaintBuffers(Fe)),v.prepareDrawProgram(Se,Wt,rt.toUnwrapped());const Jn=Nn=>{Wt.draw(Se,Be.TRIANGLES,O,Nn,U,p.CullFaceMode.disabled,bt,g.id,ut.layoutVertexBuffer,ut.indexBuffer,ut.segments,g.paint,v.transform.zoom,Rt,[ut.layoutVertexBuffer2])};if(et){const Nn=v.stencilModeForClipping(rt).ref;0===Nn&&v.terrain&&Se.clear({stencil:0});const Vn={func:Be.EQUAL,mask:255};bt.u_alpha_discard_threshold=.8,Jn(new p.StencilMode(Vn,Nn,255,Be.KEEP,Be.KEEP,Be.INVERT)),bt.u_alpha_discard_threshold=0,Jn(new p.StencilMode(Vn,Nn,255,Be.KEEP,Be.KEEP,Be.KEEP))}else Jn(v.stencilModeForClipping(rt))}et&&(v.resetStencilClippingMasks(),v.terrain&&Se.clear({stencil:0}))},fill:function(v,l,g,b){const I=g.paint.get("fill-color"),A=g.paint.get("fill-opacity");if(0===A.constantOr(1))return;const O=v.colorModeForRenderPass(),U=g.paint.get("fill-pattern"),j=v.opaquePassEnabledForLayer()&&!U.constantOr(1)&&1===I.constantOr(p.Color.transparent).a&&1===A.constantOr(0)?"opaque":"translucent";if(v.renderPass===j){const H=v.depthModeForSublayer(1,"opaque"===v.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);ha(v,l,g,b,H,O,!1)}if("translucent"===v.renderPass&&g.paint.get("fill-antialias")){const H=v.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);ha(v,l,g,b,H,O,!0)}},"fill-extrusion":function(v,l,g,b){const I=g.paint.get("fill-extrusion-opacity");if(0!==I&&"translucent"===v.renderPass){const A=new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);if(1!==I||g.paint.get("fill-extrusion-pattern").constantOr(1))eo(v,l,g,b,A,p.StencilMode.disabled,p.ColorMode.disabled),eo(v,l,g,b,A,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const O=v.colorModeForRenderPass();eo(v,l,g,b,A,p.StencilMode.disabled,O)}}},hillshade:function(v,l,g,b){if("offscreen"!==v.renderPass&&"translucent"!==v.renderPass)return;const I=v.context,A=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),O=v.colorModeForRenderPass(),U=v.terrain&&v.terrain.renderingToTexture,[j,H]="translucent"!==v.renderPass||U?[{},b]:v.stencilConfigForOverlap(b);for(const X of H){const K=l.getTile(X);if(K.needsHillshadePrepare&&"offscreen"===v.renderPass)Gn(v,K,g,A,p.StencilMode.disabled,O);else if("translucent"===v.renderPass){const _e=U&&v.terrain?v.terrain.stencilModeForRTTOverlap(X):j[X.overscaledZ];Sa(v,X,K,g,A,_e,O)}}I.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,g,b,I,A){if("translucent"!==v.renderPass||0===g.paint.get("raster-opacity")||!b.length)return;const O=v.context,U=O.gl,j=l.getSource(),H=v.useProgram("raster"),X=v.colorModeForRenderPass(),K=v.terrain&&v.terrain.renderingToTexture,[_e,Le]=j instanceof ot||K?[{},b]:v.stencilConfigForOverlap(b),Ie=Le[Le.length-1].overscaledZ,Fe=!v.options.moving;for(const De of Le){const Se=K?p.DepthMode.disabled:v.depthModeForSublayer(De.overscaledZ-Ie,1===g.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,U.LESS),Be=De.toUnwrapped(),Ae=l.getTile(De);if(K&&(!Ae||!Ae.hasData()))continue;const et=K?De.projMatrix:v.transform.calculateProjMatrix(Be,Fe),rt=v.terrain&&K?v.terrain.stencilModeForRTTOverlap(De):_e[De.overscaledZ],Ze=A?0:g.paint.get("raster-fade-duration");Ae.registerFadeDuration(Ze);const ut=l.findLoadedParent(De,0),Rt=iu(Ae,ut,l,v.transform,Ze);let Wt,Vt;v.terrain&&v.terrain.prepareDrawTile();const Ln="nearest"===g.paint.get("raster-resampling")?U.NEAREST:U.LINEAR;O.activeTexture.set(U.TEXTURE0),Ae.texture.bind(Ln,U.CLAMP_TO_EDGE),O.activeTexture.set(U.TEXTURE1),ut?(ut.texture.bind(Ln,U.CLAMP_TO_EDGE),Wt=Math.pow(2,ut.tileID.overscaledZ-Ae.tileID.overscaledZ),Vt=[Ae.tileID.canonical.x*Wt%1,Ae.tileID.canonical.y*Wt%1]):Ae.texture.bind(Ln,U.CLAMP_TO_EDGE);const Dt=zi(et,Vt||[0,0],Wt||1,Rt,g,j instanceof ot?j.perspectiveTransform:[0,0]);if(v.prepareDrawProgram(O,H,Be),j instanceof ot)j.boundsBuffer&&j.boundsSegments&&H.draw(O,U.TRIANGLES,Se,p.StencilMode.disabled,X,p.CullFaceMode.disabled,Dt,g.id,j.boundsBuffer,v.quadTriangleIndexBuffer,j.boundsSegments);else{const{tileBoundsBuffer:dn,tileBoundsIndexBuffer:fn,tileBoundsSegments:Ft}=v.getTileBoundsBuffers(Ae);H.draw(O,U.TRIANGLES,Se,rt,X,p.CullFaceMode.disabled,Dt,g.id,dn,fn,Ft)}}v.resetStencilClippingMasks()},background:function(v,l,g,b){const I=g.paint.get("background-color"),A=g.paint.get("background-opacity");if(0===A)return;const O=v.context,U=O.gl,j=v.transform,H=j.tileSize,X=g.paint.get("background-pattern");if(v.isPatternMissing(X))return;const K=!X&&1===I.a&&1===A&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==K)return;const _e=p.StencilMode.disabled,Le=v.depthModeForSublayer(0,"opaque"===K?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),Ie=v.colorModeForRenderPass(),Fe=v.useProgram(X?"backgroundPattern":"background");let De,Se=b;Se||(De=v.getBackgroundTiles(),Se=Object.values(De).map(Ae=>Ae.tileID)),X&&(O.activeTexture.set(U.TEXTURE0),v.imageManager.bind(v.context));const Be=g.getCrossfadeParameters();for(const Ae of Se){const et=Ae.toUnwrapped(),rt=b?Ae.projMatrix:v.transform.calculateProjMatrix(et);v.prepareDrawTile();const Ze=l?l.getTile(Ae):De?De[Ae.key]:new p.Tile(Ae,H,j.zoom,v),ut=X?Fa(rt,A,v,X,{tileID:Ae,tileSize:H},Be):rs(rt,A,I);v.prepareDrawProgram(O,Fe,et);const{tileBoundsBuffer:Rt,tileBoundsIndexBuffer:Wt,tileBoundsSegments:Vt}=v.getTileBoundsBuffers(Ze);Fe.draw(O,U.TRIANGLES,Le,_e,Ie,p.CullFaceMode.disabled,ut,g.id,Rt,Wt,Vt)}},sky:function(v,l,g){const b=v.transform,I="mercator"===b.projection.name||"globe"===b.projection.name?1:p.smoothstep(7,8,b.zoom),A=g.paint.get("sky-opacity")*I;if(0===A)return;const O=v.context,U=g.paint.get("sky-type"),j=new p.DepthMode(O.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),H=v.frameCounter/1e3%1;"atmosphere"===U?"offscreen"===v.renderPass?g.needsSkyboxCapture(v)&&(function(X,K,_e,Le){const Ie=X.context,Fe=Ie.gl;let De=K.skyboxFbo;if(!De){De=K.skyboxFbo=Ie.createFramebuffer(32,32,!1),K.skyboxGeometry=new ei(Ie),K.skyboxTexture=Ie.gl.createTexture(),Fe.bindTexture(Fe.TEXTURE_CUBE_MAP,K.skyboxTexture),Fe.texParameteri(Fe.TEXTURE_CUBE_MAP,Fe.TEXTURE_WRAP_S,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_CUBE_MAP,Fe.TEXTURE_WRAP_T,Fe.CLAMP_TO_EDGE),Fe.texParameteri(Fe.TEXTURE_CUBE_MAP,Fe.TEXTURE_MIN_FILTER,Fe.LINEAR),Fe.texParameteri(Fe.TEXTURE_CUBE_MAP,Fe.TEXTURE_MAG_FILTER,Fe.LINEAR);for(let et=0;et<6;++et)Fe.texImage2D(Fe.TEXTURE_CUBE_MAP_POSITIVE_X+et,0,Fe.RGBA,32,32,0,Fe.RGBA,Fe.UNSIGNED_BYTE,null)}Ie.bindFramebuffer.set(De.framebuffer),Ie.viewport.set([0,0,32,32]);const Se=K.getCenter(X,!0),Be=X.useProgram("skyboxCapture"),Ae=new Float64Array(16);p.identity(Ae),p.rotateY(Ae,Ae,.5*-Math.PI),ps(Ie,K,Be,Ae,Se,0),p.identity(Ae),p.rotateY(Ae,Ae,.5*Math.PI),ps(Ie,K,Be,Ae,Se,1),p.identity(Ae),p.rotateX(Ae,Ae,.5*-Math.PI),ps(Ie,K,Be,Ae,Se,2),p.identity(Ae),p.rotateX(Ae,Ae,.5*Math.PI),ps(Ie,K,Be,Ae,Se,3),p.identity(Ae),ps(Ie,K,Be,Ae,Se,4),p.identity(Ae),p.rotateY(Ae,Ae,Math.PI),ps(Ie,K,Be,Ae,Se,5),Ie.viewport.set([0,0,X.width,X.height])}(v,g),g.markSkyboxValid(v)):"sky"===v.renderPass&&function(X,K,_e,Le,Ie){const Fe=X.context,De=Fe.gl,Se=X.transform,Be=X.useProgram("skybox");Fe.activeTexture.set(De.TEXTURE0),De.bindTexture(De.TEXTURE_CUBE_MAP,K.skyboxTexture);const Ae={u_matrix:Se.skyboxMatrix,u_sun_direction:K.getCenter(X,!1),u_cubemap:0,u_opacity:Le,u_temporal_offset:Ie};X.prepareDrawProgram(Fe,Be),Be.draw(Fe,De.TRIANGLES,_e,p.StencilMode.disabled,X.colorModeForRenderPass(),p.CullFaceMode.backCW,Ae,"skybox",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(v,g,j,A,H):"gradient"===U&&"sky"===v.renderPass&&function(X,K,_e,Le,Ie){const Fe=X.context,De=Fe.gl,Se=X.transform,Be=X.useProgram("skyboxGradient");K.skyboxGeometry||(K.skyboxGeometry=new ei(Fe)),Fe.activeTexture.set(De.TEXTURE0);let Ae=K.colorRampTexture;Ae||(Ae=K.colorRampTexture=new p.Texture(Fe,K.colorRamp,De.RGBA)),Ae.bind(De.LINEAR,De.CLAMP_TO_EDGE);const et=(rt=Se.skyboxMatrix,Ze=K.getCenter(X,!1),ut=K.paint.get("sky-gradient-radius"),Rt=Le,Wt=Ie,{u_matrix:rt,u_color_ramp:0,u_center_direction:Ze,u_radius:p.degToRad(ut),u_opacity:Rt,u_temporal_offset:Wt});var rt,Ze,ut,Rt,Wt;X.prepareDrawProgram(Fe,Be),Be.draw(Fe,De.TRIANGLES,_e,p.StencilMode.disabled,X.colorModeForRenderPass(),p.CullFaceMode.backCW,et,"skyboxGradient",K.skyboxGeometry.vertexBuffer,K.skyboxGeometry.indexBuffer,K.skyboxGeometry.segment)}(v,g,j,A,H)},debug:function(v,l,g){for(let b=0;b<g.length;b++)Go(v,l,g[b])},custom:function(v,l,g){const b=v.context,I=g.implementation;if(v.transform.projection.unsupportedLayers&&v.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===v.renderPass){const A=I.prerender;A&&(v.setCustomLayerDefaults(),b.setColorMode(v.colorModeForRenderPass()),A.call(I,b.gl,v.transform.customLayerMatrix()),b.setDirty(),v.setBaseState())}else if("translucent"===v.renderPass){v.setCustomLayerDefaults(),b.setColorMode(v.colorModeForRenderPass()),b.setStencilMode(p.StencilMode.disabled);const A="3d"===I.renderingMode?new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,p.DepthMode.ReadOnly);b.setDepthMode(A),I.render(b.gl,v.transform.customLayerMatrix()),b.setDirty(),v.setBaseState(),b.bindFramebuffer.set(null)}}};class Xs{constructor(l,g){this.context=new Y(l),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new al,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,g){const b=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new zs(this,l));const I=this._terrain;this.transform.elevation=b?I:null,I.update(l,this.transform,g)}_updateFog(l){const g=l.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[b,I]=g.getFovAdjustedRange(this.transform._fov);if(b>I)return void(this.transform.fogCullDistSq=null);const A=b+.78*(I-b);this.transform.fogCullDistSq=A*A}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,g){if(this.width=l*p.exported.devicePixelRatio,this.height=g*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style.order)this.style._layers[b].resize()}setup(){const l=this.context,g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(g,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const b=new p.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(p.EXTENT,0),b.emplaceBack(0,p.EXTENT),b.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(b,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const I=new p.StructArrayLayout2i4;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(-1,1),I.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(I,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const A=new p.StructArrayLayout4i8;A.emplaceBack(0,0,0,0),A.emplaceBack(p.EXTENT,0,p.EXTENT,0),A.emplaceBack(0,p.EXTENT,0,p.EXTENT),A.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(A,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const O=new p.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const U=new p.StructArrayLayout1ui2;for(const H of[0,1,3,2,0])U.emplaceBack(H);this.debugIndexBuffer=l.createIndexBuffer(U),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const j=this.context.gl;this.stencilClearMode=new p.StencilMode({func:j.ALWAYS,mask:0},0,255,j.ZERO,j.ZERO,j.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new Xc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,g.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Ji(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,g,b){if(!g||this.currentStencilSource===g.id||!l.isTileClipped()||!b||0===b.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let U=!1;for(const j of b)if(void 0===this._tileClippingMaskIDs[j.key]){U=!0;break}if(!U)return}this.currentStencilSource=g.id;const I=this.context,A=I.gl;this.nextStencilID+b.length>256&&this.clearStencil(),I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const U of b){const j=g.getTile(U),H=this._tileClippingMaskIDs[U.key]=this.nextStencilID++,{tileBoundsBuffer:X,tileBoundsIndexBuffer:K,tileBoundsSegments:_e}=this.getTileBoundsBuffers(j);O.draw(I,A.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:A.ALWAYS,mask:0},H,255,A.KEEP,A.KEEP,A.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Ji(U.projMatrix),"$clipping",X,K,_e)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new p.StencilMode({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const g=this.context.gl;return new p.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,b=l.sort((O,U)=>U.overscaledZ-O.overscaledZ),I=b[b.length-1].overscaledZ,A=b[0].overscaledZ-I+1;if(A>1){this.currentStencilSource=void 0,this.nextStencilID+A>256&&this.clearStencil();const O={};for(let U=0;U<A;U++)O[U+I]=new p.StencilMode({func:g.GEQUAL,mask:255},U+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=A,[O,b]}return[{[I]:p.StencilMode.disabled},b]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,g,b){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(b||this.context.gl.LEQUAL,g,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const b=this.style.order,I=this.style._sourceCaches;for(const j in I){const H=I[j];H.used&&H.prepare(this.context)}const A={},O={},U={};for(const j in I){const H=I[j];A[j]=H.getVisibleCoordinates(),O[j]=A[j].slice().reverse(),U[j]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let j=0;j<b.length;j++)if(this.style._layers[b[j]].is3D()){this.opaquePassCutoff=j;break}if(this.terrain&&(this.terrain.updateTileBinding(U),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),p.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const j of b){const H=this.style._layers[j],X=l._getLayerSourceCache(H);if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const K=X?O[X.id]:void 0;("custom"===H.type||H.isSky()||K&&K.length)&&this.renderLayer(this,X,H,K)}if(this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const j=this.style._layers[b[this.currentLayer]],H=l._getLayerSourceCache(j);if(j.isSky())continue;const X=H?O[H.id]:void 0;this._renderTileClippingMasks(j,H,X),this.renderLayer(this,H,j,X)}if(this.style.fog&&this.transform.projection.supportsFog&&function(j,H){const X=j.context,K=X.gl,_e=j.transform,Le=new p.DepthMode(K.LEQUAL,p.DepthMode.ReadOnly,[0,1]),Ie=j.useProgram("globeAtmosphere",null,"globe"===_e.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Fe=p.globeToMercatorTransition(_e.zoom),De=H.properties.get("color").toArray01(),Se=H.properties.get("high-color").toArray01(),Be=H.properties.get("space-color").toArray01PremultipliedAlpha(),Ae=p.identity$1([]);p.rotateY$1(Ae,Ae,-p.degToRad(_e._center.lng)),p.rotateX$1(Ae,Ae,p.degToRad(_e._center.lat)),p.rotateZ$1(Ae,Ae,_e.angle),p.rotateX$1(Ae,Ae,-_e._pitch);const et=p.fromQuat(new Float32Array(16),Ae),rt=p.mapValue(H.properties.get("star-intensity"),0,1,0,.25),ut=p.mapValue(H.properties.get("horizon-blend"),0,1,5e-4,.25),Rt=p.globeUseCustomAntiAliasing(j,X,_e)&&5e-4===ut?_e.worldSize/(2*Math.PI*1.025)-1:_e.globeRadius,Wt=j.frameCounter/1e3%1,Vt=p.length(_e.globeCenterInViewSpace),Ln=Math.sqrt(Math.pow(Vt,2)-Math.pow(Rt,2)),Dt=Math.acos(Ln/Vt),dn={u_frustum_tl:_e.frustumCorners.TL,u_frustum_tr:_e.frustumCorners.TR,u_frustum_br:_e.frustumCorners.BR,u_frustum_bl:_e.frustumCorners.BL,u_horizon:_e.frustumCorners.horizon,u_transition:Fe,u_fadeout_range:ut,u_color:De,u_high_color:Se,u_space_color:Be,u_star_intensity:rt,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Wt,u_horizon_angle:Dt,u_rotation_matrix:et};j.prepareDrawProgram(X,Ie);const fn=j.atmosphereBuffer;fn&&Ie.draw(X,K.TRIANGLES,Le,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,dn,"skybox",fn.vertexBuffer,fn.indexBuffer,fn.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const j=this.style._layers[b[this.currentLayer]],H=l._getLayerSourceCache(j);j.isSky()&&this.renderLayer(this,H,j,H?O[H.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;){const j=this.style._layers[b[this.currentLayer]],H=l._getLayerSourceCache(j);if(j.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(j)){if(j.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const X=H?("symbol"===j.type?U:O)[H.id]:void 0;this._renderTileClippingMasks(j,H,H?A[H.id]:void 0),this.renderLayer(this,H,j,X),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let j=null;p.values(this.style._layers).forEach(H=>{const X=l._getLayerSourceCache(H);X&&!H.isHidden(this.transform.zoom)&&(!j||j.getSource().maxzoom<X.getSource().maxzoom)&&(j=X)}),j&&this.options.showTileBoundaries&&aa.debug(this,j,j.getVisibleCoordinates())}this.options.showPadding&&function(j){const H=j.transform.padding;no(j,j.transform.height-(H.top||0),3,fo),no(j,H.bottom||0,3,$i),za(j,H.left||0,3,su),za(j,j.transform.width-(H.right||0),3,Za);const X=j.transform.centerPoint;var K,_e,Le,Ie;os(K=j,(_e=X.x)-1,(Le=j.transform.height-X.y)-10,2,20,Ie=qi),os(K,_e-10,Le-1,20,2,Ie)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}}renderLayer(l,g,b,I){b.isHidden(this.transform.zoom)||("background"===b.type||"sky"===b.type||"custom"===b.type||I&&I.length)&&(this.id=b.id,this.gpuTimingStart(b),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(b.type)||aa[b.type](l,g,b,I,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),b.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,g=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),l.beginQueryEXT(l.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const g={};for(const b in l){const I=l[b],A=this.context.extTimerQuery,O=A.getQueryObjectEXT(I.query,A.QUERY_RESULT_EXT)/1e6;A.deleteQueryEXT(I.query),g[b]=O}return g}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let b=0;for(const I of l)b+=g.getQueryObjectEXT(I,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(I);return b}translatePosMatrix(l,g,b,I,A){if(!b[0]&&!b[1])return l;const O=A?"map"===I?this.transform.angle:0:"viewport"===I?-this.transform.angle:0;if(O){const H=Math.sin(O),X=Math.cos(O);b=[b[0]*X-b[1]*H,b[0]*H+b[1]*X]}const U=[A?b[0]:Yt(g,b[0],this.transform.zoom),A?b[1]:Yt(g,b[1],this.transform.zoom),0],j=new Float32Array(16);return p.translate(j,l,U),j}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const g=this.imageManager.getPattern(l.from.toString()),b=this.imageManager.getPattern(l.to.toString());return!g||!b}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,g=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),g&&!l&&0!==g.getOpacity(this.transform.pitch)&&b.push("FOG"),l&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(l,g,b){this.cache=this.cache||{};const I=b||[],A=this.currentGlobalDefines().concat(I),O=mi.cacheKey(Fl[l],l,A,g);return this.cache[O]||(this.cache[O]=new mi(this.context,l,Fl[l],g,Vo[l],A)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,g,b){if(this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const A=I.getOpacity(this.transform.pitch),O=((U,j,H,X,K,_e,Le,Ie,Fe,De,Se)=>{const Be=U.transform,Ae=j.properties.get("color").toArray01();Ae[3]=X;const et=U.frameCounter/1e3%1;return{u_fog_matrix:H?Be.calculateFogTileMatrix(H):U.identityMat,u_fog_range:j.getFovAdjustedRange(Be._fov),u_fog_color:Ae,u_fog_horizon_blend:j.properties.get("horizon-blend"),u_fog_temporal_offset:et,u_frustum_tl:K,u_frustum_tr:_e,u_frustum_br:Le,u_frustum_bl:Ie,u_globe_pos:Fe,u_globe_radius:De,u_viewport:Se,u_globe_transition:p.globeToMercatorTransition(Be.zoom),u_is_globe:+("globe"===Be.projection.name)}})(this,I,b,A,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);g.setFogUniformValues(l,O)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const l=this.context.gl,g=l.createTexture();return l.bindTexture(l.TEXTURE_2D,g),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,g=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(const I of b)g[I.key]=l[I.key]||new p.Tile(I,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class Us{constructor(l=0,g=0,b=0,I=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(b)||b<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=b,this.right=I}interpolate(l,g,b){return null!=g.top&&null!=l.top&&(this.top=p.number(l.top,g.top,b)),null!=g.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,g.bottom,b)),null!=g.left&&null!=l.left&&(this.left=p.number(l.left,g.left,b)),null!=g.right&&null!=l.right&&(this.right=p.number(l.right,g.right,b)),this}getCenter(l,g){const b=p.clamp((this.left+l-this.right)/2,0,l),I=p.clamp((this.top+g-this.bottom)/2,0,g);return new p.pointGeometry(b,I)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new Us(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function xl(v,l){const g=p.getColumn(v,3);p.fromQuat(v,l),p.setColumn(v,3,g)}function oc(v,l){const g=p.identity$1([]);return p.rotateZ$1(g,g,-l),p.rotateX$1(g,g,-v),g}function au(v,l){const g=[v[0],v[1],0],b=[l[0],l[1],0];if(p.length(g)>=1e-15){const O=p.normalize([],g);p.scale$2(b,O,p.dot(b,O)),l[0]=b[0],l[1]=b[1]}const I=p.cross([],l,v);if(p.len(I)<1e-15)return null;const A=Math.atan2(-I[1],I[0]);return oc(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),A)}class ll{constructor(l,g){this.position=l,this.orientation=g}get position(){return this._position}set position(l){if(l){const g=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(g.x=p.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(l,g){if(this.orientation=null,!this.position)return;const b=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,I=this.position,A=p.MercatorCoordinate.fromLngLat(l,b),O=[A.x-I.x,A.y-I.y,A.z-I.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=au(O,g)}setPitchBearing(l,g){this.orientation=oc(p.degToRad(l),p.degToRad(-g))}}class ea{constructor(l,g){this._transform=p.identity([]),this.orientation=g,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var g;l&&p.setColumn(this._transform,3,[(g=l)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&xl(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,g){this._orientation=oc(l,g),xl(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,g){const b=new Float64Array(16);return p.invert(b,this.getWorldToCamera(l,g)),b}getWorldToCameraPosition(l,g,b){const I=this.position;p.scale$2(I,I,-l);const A=new Float64Array(16);return p.fromScaling(A,[b,b,b]),p.translate(A,A,I),A[10]*=g,A}getWorldToCamera(l,g){const b=new Float64Array(16),I=new Float64Array(4),A=this.position;return p.conjugate(I,this._orientation),p.scale$2(A,A,-l),p.fromQuat(b,I),p.translate(b,b,A),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=g,b[9]*=g,b[10]*=g,b[11]*=g,b}getCameraToClipPerspective(l,g,b,I){const A=new Float64Array(16);return p.perspective(A,l,g,b,I),A}getDistanceToElevation(l){const g=0===l?0:p.mercatorZfromAltitude(l,this.position[1]),b=this.forward();return(g-this.position[2])/b[2]}clone(){return new ea([...this.position],[...this.orientation])}}function Bu(v,l){const g=mh(v.projection,v.zoom,v.width,v.height),b=function(A,O,U,j,H){const X=new p.LngLat(U.lng-180*Bl,U.lat),K=new p.LngLat(U.lng+180*Bl,U.lat),_e=A.project(X.lng,X.lat),Le=A.project(K.lng,K.lat),Ie=-Math.atan2(Le.y-_e.y,Le.x-_e.x),Fe=p.MercatorCoordinate.fromLngLat(U);Fe.y=p.clamp(Fe.y,-.999975,.999975);const De=Fe.toLngLat(),Se=A.project(De.lng,De.lat),Be=p.MercatorCoordinate.fromLngLat(De);Be.x+=Bl;const Ae=Be.toLngLat(),et=A.project(Ae.lng,Ae.lat),rt=Wn(et.x-Se.x,et.y-Se.y,Ie),Ze=p.MercatorCoordinate.fromLngLat(De);Ze.y+=Bl;const ut=Ze.toLngLat(),Rt=A.project(ut.lng,ut.lat),Wt=Wn(Rt.x-Se.x,Rt.y-Se.y,Ie),Vt=Math.abs(rt.x)/Math.abs(Wt.y),Ln=p.identity([]);p.rotateZ(Ln,Ln,-Ie*(1-(H?0:j)));const Dt=p.identity([]);return p.scale(Dt,Dt,[1,1-(1-Vt)*j,1]),Dt[4]=-Wt.x/Wt.y*j,p.rotateZ(Dt,Dt,Ie),p.multiply(Dt,Ln,Dt),Dt}(v.projection,0,v.center,g,l),I=ws(v);return p.scale(b,b,[I,I,1]),b}function ws(v){const l=v.projection,g=mh(v.projection,v.zoom,v.width,v.height),b=ua(l,v.center),I=ua(l,p.LngLat.convert(l.center));return Math.pow(2,b*g+(1-g)*I)}function mh(v,l,g,b,I=1/0){const A=v.range;if(!A)return 0;const O=Math.min(I,Math.max(g,b)),U=Math.log(O/1024)/Math.LN2;return p.smoothstep(A[0]+U,A[1]+U,l)}const Bl=1/4e4;function ua(v,l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),b=new p.LngLat(l.lng-180*Bl,g),I=new p.LngLat(l.lng+180*Bl,g),A=v.project(b.lng,g),O=v.project(I.lng,g),U=p.MercatorCoordinate.fromLngLat(b),j=p.MercatorCoordinate.fromLngLat(I),H=O.x-A.x,X=O.y-A.y,K=j.x-U.x,_e=j.y-U.y,Le=Math.sqrt((K*K+_e*_e)/(H*H+X*X));return Math.log(Le)/Math.LN2}function Wn(v,l,g){const b=Math.cos(g),I=Math.sin(g);return{x:v*b-l*I,y:v*I+l*b}}class Iu{constructor(l,g,b,I,A,O,U){this.tileSize=512,this._renderWorldCopies=void 0===A||A,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=b??0,this._maxPitch=I??60,this.setProjection(O),this.setMaxBounds(U),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Us,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ea,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Iu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(l||g)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const b=!Ce(g,this.getProjection());return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const g=l!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const g=-l*Math.PI/180;var b,I,A,O,U,j,H,X,K,_e;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(b=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b),I=this.rotationMatrix,O=this.angle,U=(A=this.rotationMatrix)[0],j=A[1],H=A[2],X=A[3],K=Math.sin(O),_e=Math.cos(O),I[0]=U*_e+H*K,I[1]=j*_e+X*K,I[2]=U*-K+H*_e,I[3]=j*-K+X*_e)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop();let I=0,A=0;for(let O=0;O<g.length;O++){const U=new p.pointGeometry(g[O][0]*this.width,b+g[O][1]*(this.height-b)),j=l.pointCoordinate(U);if(!j)continue;const H=1/Math.hypot(j[0]-this._camera.position[0],j[1]-this._camera.position[1]);I+=j[3]*H,A+=H}return 0===A?NaN:I/A}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*g,I=this._mercatorZfromZoom(l),A=this._mercatorZfromZoom(this._maxZoom),O=Math.max(I-b,A);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let b;b=l.z<this._camera.position[2]?[g.x,g.y,g.z]:[l.x,l.y,l.z];const I=p.length(p.sub([],this._camera.position,b));return p.clamp(this._zoomFromMercatorZ(I),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let g=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(l.orientation)),l.position){const b=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(b,this._camera.position)||(this._setCameraPosition(b),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,g=new ll;return g.position=new p.MercatorCoordinate(l[0],l[1],l[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const g=p.transformQuat([],[0,0,-1],l),b=p.transformQuat([],[0,-1,0],l);if(b[2]<0)return!1;const I=au(g,b);return!!I&&(this._camera.orientation=I,!0)}_setCameraPosition(l){const g=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,I=this.cameraToCenterDistance;l[2]=p.clamp(l[2],I/b,I/g),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,b){this._unmodified=!1,this._edgeInsets.interpolate(l,g,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const b=this.pointCoordinate(new p.pointGeometry(0,0)),I=this.pointCoordinate(new p.pointGeometry(this.width,0)),A=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),O=this.pointCoordinate(new p.pointGeometry(0,this.height)),U=Math.floor(Math.min(b.x,I.x,A.x,O.x)),j=Math.floor(Math.max(b.x,I.x,A.x,O.x)),H=1;for(let X=U-H;X<=j+H;X++)0!==X&&g.push(new p.UnwrappedTileID(X,l))}return g}coveringTiles(l){let g=this.coveringZoomLevel(l);const b=g,I=this.elevation&&!l.isTerrainDEM,A="mercator"===this.projection.name;if(void 0!==l.minzoom&&g<l.minzoom)return[];void 0!==l.maxzoom&&g>l.maxzoom&&(g=l.maxzoom);const O=this.locationCoordinate(this.center),U=this.center.lat,j=1<<g,H=[j*O.x,j*O.y,0],X="globe"===this.projection.name,K=!X,_e=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,K),Le=X?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Ie=j*p.mercatorZfromAltitude(1,this.center.lat),Fe=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),De=[j*Le.x,j*Le.y,Fe*(K?1:Ie)],Se=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Be=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,Ae=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,et=l.isTerrainDEM?-Ae:this._elevation?this._elevation.getMinElevationBelowMSL():0,rt=this.projection.isReprojectedInTileSpace?ws(this):1,Ze=bt=>{const Nn=new p.MercatorCoordinate(bt.x+25e-6,bt.y,bt.z),Vn=new p.MercatorCoordinate(bt.x,bt.y+25e-6,bt.z),Bn=bt.toLngLat(),fr=Nn.toLngLat(),qr=Vn.toLngLat(),kr=this.locationCoordinate(Bn),wr=this.locationCoordinate(fr),Un=this.locationCoordinate(qr),Zr=Math.hypot(wr.x-kr.x,wr.y-kr.y),wi=Math.hypot(Un.x-kr.x,Un.y-kr.y);return Math.sqrt(Zr*wi)*rt/25e-6},ut=bt=>{const Jn=Ae,Nn=et;return{aabb:p.tileAABB(this,j,0,0,0,bt,Nn,Jn,this.projection),zoom:0,x:0,y:0,minZ:Nn,maxZ:Jn,wrap:bt,fullyVisible:!1}},Rt=[];let Wt=[];const Vt=g,Ln=l.reparseOverscaled?b:g,Dt=bt=>bt*bt,dn=Dt((Fe-this._centerAltitude)*Ie),fn=bt=>{if(!this._elevation||!bt.tileID||!A)return;const Jn=this._elevation.getMinMaxForTile(bt.tileID),Nn=bt.aabb;Jn?(Nn.min[2]=Jn.min,Nn.max[2]=Jn.max,Nn.center[2]=(Nn.min[2]+Nn.max[2])/2):(bt.shouldSplit=Ft(bt),bt.shouldSplit||(Nn.min[2]=Nn.max[2]=Nn.center[2]=this._centerAltitude))},Ft=bt=>{if(bt.zoom<Be)return!0;if(bt.zoom===Vt)return!1;if(null!=bt.shouldSplit)return bt.shouldSplit;const Jn=bt.aabb.distanceX(De),Nn=bt.aabb.distanceY(De);let Vn=dn,Bn=1;if(X){Vn=Dt(bt.aabb.distanceZ(De));const kr=Math.pow(2,bt.zoom),wr=p.latFromMercatorY((bt.y+1)/kr),Un=p.latFromMercatorY(bt.y/kr),Zr=Math.min(Math.max(U,wr),Un),wi=p.circumferenceAtLatitude(Zr)/p.circumferenceAtLatitude(U);if(Bn=Zr===U?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,wi/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&bt.zoom===Vt-1&&wi>=.9)return!0}else if(I&&(Vn=Dt(bt.aabb.distanceZ(De)*Ie)),this.projection.isReprojectedInTileSpace&&b<=5){const kr=Math.pow(2,bt.zoom),wr=Ze(new p.MercatorCoordinate((bt.x+.5)/kr,(bt.y+.5)/kr));Bn=wr>.85?1:wr}const fr=Jn*Jn+Nn*Nn+Vn;return fr<Dt((1<<Vt-bt.zoom)*Se*Bn*((kr,wr)=>{if(wr*Dt(.707)<kr)return 1;const Un=Math.sqrt(wr/kr);return Un/(1.4144271570014144+(Math.pow(1.1,Un-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Vn,dn),fr))};if(this.renderWorldCopies)for(let bt=1;bt<=3;bt++)Rt.push(ut(-bt)),Rt.push(ut(bt));for(Rt.push(ut(0));Rt.length>0;){const bt=Rt.pop(),Jn=bt.x,Nn=bt.y;let Vn=bt.fullyVisible;if(!Vn){const Bn=bt.aabb.intersects(_e);if(0===Bn)continue;Vn=2===Bn}if(bt.zoom!==Vt&&Ft(bt))for(let Bn=0;Bn<4;Bn++){const fr=(Jn<<1)+Bn%2,qr=(Nn<<1)+(Bn>>1),kr={aabb:A?bt.aabb.quadrant(Bn):p.tileAABB(this,j,bt.zoom+1,fr,qr,bt.wrap,bt.minZ,bt.maxZ,this.projection),zoom:bt.zoom+1,x:fr,y:qr,wrap:bt.wrap,fullyVisible:Vn,tileID:void 0,shouldSplit:void 0,minZ:bt.minZ,maxZ:bt.maxZ};I&&!X&&(kr.tileID=new p.OverscaledTileID(bt.zoom+1===Vt?Ln:bt.zoom+1,bt.wrap,bt.zoom+1,fr,qr),fn(kr)),Rt.push(kr)}else{const Bn=bt.zoom===Vt?Ln:bt.zoom;if(l.minzoom&&l.minzoom>Bn)continue;const fr=H[0]-(.5+Jn+(bt.wrap<<bt.zoom))*(1<<g-bt.zoom),qr=H[1]-.5-Nn,kr=bt.tileID?bt.tileID:new p.OverscaledTileID(Bn,bt.wrap,bt.zoom,Jn,Nn);Wt.push({tileID:kr,distanceSq:fr*fr+qr*qr})}}if(this.fogCullDistSq){const bt=this.fogCullDistSq,Jn=this.horizonLineFromTop();Wt=Wt.filter(Nn=>{const Vn=[0,0,0,1],Bn=[p.EXTENT,p.EXTENT,0,1],fr=this.calculateFogTileMatrix(Nn.tileID.toUnwrapped());p.transformMat4$1(Vn,Vn,fr),p.transformMat4$1(Bn,Bn,fr);const qr=p.getAABBPointSquareDist(Vn,Bn);if(0===qr)return!0;let kr=!1;const wr=this._elevation;if(wr&&qr>bt&&0!==Jn){const Un=this.calculateProjMatrix(Nn.tileID.toUnwrapped());let Zr;l.isTerrainDEM||(Zr=wr.getMinMaxForTile(Nn.tileID)),Zr||(Zr={min:et,max:Ae});const wi=p.furthestTileCorner(this.rotation),$o=[wi[0]*p.EXTENT,wi[1]*p.EXTENT,Zr.max];p.transformMat4($o,$o,Un),kr=(1-$o[1])*this.height*.5<Jn}return qr<bt||kr})}return Wt.sort((bt,Jn)=>bt.distanceSq-Jn.distanceSq).map(bt=>bt.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),b=this.projection.project(l.lng,g);return new p.pointGeometry(b.x*this.worldSize,b.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(l,g){let b,I;const A=this.centerPoint;if("globe"===this.projection.name){const U=this.worldSize;b=(g.x-A.x)/U,I=(g.y-A.y)/U}else{const U=this.pointCoordinate(g),j=this.pointCoordinate(A);b=U.x-j.x,I=U.y-j.y}const O=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(O.x-b,O.y-I))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,g){const b=g?p.mercatorZfromAltitude(g,l.lat):void 0,I=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(I.x,I.y,b)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,g){const b=g??this._centerAltitude,I=[l.x,l.y,0,1],A=[l.x,l.y,1,1];p.transformMat4$1(I,I,this.pixelMatrixInverse),p.transformMat4$1(A,A,this.pixelMatrixInverse);const O=A[3];p.scale$1(I,I,1/I[3]),p.scale$1(A,A,1/O);const U=I[2],j=A[2];return{p0:I,p1:A,t:U===j?0:(b-U)/(j-U)}}screenPointToMercatorRay(l){const g=[l.x,l.y,0,1],b=[l.x,l.y,1,1];return p.transformMat4$1(g,g,this.pixelMatrixInverse),p.transformMat4$1(b,b,this.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),p.scale$1(b,b,1/b[3]),g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,b[2]=p.mercatorZfromAltitude(b[2],this._center.lat)*this.worldSize,p.scale$1(g,g,1/this.worldSize),p.scale$1(b,b,1/this.worldSize),new p.Ray([g[0],g[1],g[2]],p.normalize([],p.sub([],b,g)))}rayIntersectionCoordinate(l){const{p0:g,p1:b,t:I}=l,A=p.mercatorZfromAltitude(g[2],this._center.lat),O=p.mercatorZfromAltitude(b[2],this._center.lat);return new p.MercatorCoordinate(p.number(g[0],b[0],I)/this.worldSize,p.number(g[1],b[1],I)/this.worldSize,p.number(A,O,I))}pointCoordinate(l,g=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,g)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let g=this.projection.pointCoordinate3D(this,l.x,l.y);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let b=0,I=this.horizonLineFromTop();if(l.y>I)return this.pointCoordinate(l);const A=.02*I,O=l.clone();for(let U=0;U<10&&I-b>A;U++){O.y=p.number(b,I,.66);const j=this.projection.pointCoordinate3D(this,O.x,O.y);j?(I=O.y,g=j):b=O.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}_coordinatePoint(l,g){const b=g&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,I=[l.x*this.worldSize,l.y*this.worldSize,b+l.toAltitude(),1];return p.transformMat4$1(I,I,this.pixelMatrix),I[3]>0?new p.pointGeometry(I[0]/I[3],I[1]/I[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:l,left:g}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,A=this.pointCoordinate3D(new p.pointGeometry(g,l)),O=this.pointCoordinate3D(new p.pointGeometry(I,l)),U=this.pointCoordinate3D(new p.pointGeometry(I,b)),j=this.pointCoordinate3D(new p.pointGeometry(g,b));let H=Math.min(A.x,j.x),X=Math.max(O.x,U.x),K=Math.min(A.y,O.y),_e=Math.max(j.y,U.y);const Le=Math.pow(2,-this.zoom)/16,Ie=(Se,Be,Ae,et)=>{const rt=(Se+Ae)/2,Ze=(Be+et)/2,ut=new p.pointGeometry(rt,Ze),Rt=this.pointCoordinate3D(ut),Wt=Math.max(0,H-Rt.x,K-Rt.y,Rt.x-X,Rt.y-_e);H=Math.min(H,Rt.x),X=Math.max(X,Rt.x),K=Math.min(K,Rt.y),_e=Math.max(_e,Rt.y),Wt>Le&&(Ie(Se,Be,rt,Ze),Ie(rt,Ze,Ae,et))};Ie(g,l,I,l),Ie(I,l,I,b),Ie(I,b,g,b),Ie(g,b,g,l);const Fe=new p.LngLat(p.lngFromMercatorX(X),p.latFromMercatorY(K)),De=new p.LngLat(p.lngFromMercatorX(H),p.latFromMercatorY(_e));return new p.LngLatBounds(De,Fe)}_getBounds(l,g){if("globe"===this.projection.name)return this._getGlobeBounds();const b=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),I=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),A=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),O=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let U=this.pointCoordinate(b,l),j=this.pointCoordinate(I,l);const H=this.pointCoordinate(A,g),X=this.pointCoordinate(O,g),K=(_e,Le)=>(Le.y-_e.y)/(Le.x-_e.x);return U.y>1&&j.y>=0?U=new p.MercatorCoordinate((1-X.y)/K(X,U)+X.x,1):U.y<0&&j.y<=1&&(U=new p.MercatorCoordinate(-X.y/K(X,U)+X.x,0)),j.y>1&&U.y>=0?j=new p.MercatorCoordinate((1-H.y)/K(H,j)+H.x,1):j.y<0&&U.y<=1&&(j=new p.MercatorCoordinate(-H.y/K(H,j)+H.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(j)).extend(this.coordinateLocation(X)).extend(this.coordinateLocation(H))}_getBounds3D(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBounds(0,0);const g=l.visibleDemTiles.reduce((b,I)=>{if(I.dem){const A=I.dem.tree;b.min=Math.min(b.min,A.minimums[0]),b.max=Math.max(b.max,A.maximums[0])}return b},{min:Number.MAX_VALUE,max:0});return this._getBounds(g.min*l.exaggeration(),g.max*l.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(l=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,b=this.height/2-g*(1-this._horizonShift);return l?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,g){return this.projection.createTileMatrix(this,g,l)}calculateDistanceTileData(l){const g=l.key,b=this._distanceTileDataCache;if(b[g])return b[g];const I=l.canonical,A=1/this.height,O=this.cameraWorldSize/this.zoomScale(I.z),U=(I.x+Math.pow(2,I.z)*l.wrap)*O,j=I.y*O,H=this.point,X=this.angle,K=Math.sin(-X),_e=-Math.cos(-X);return b[g]={bearing:[K,_e],center:[(H.x-U)*A,(H.y-j)*A],scale:O/p.EXTENT*A},b[g]}calculateFogTileMatrix(l){const g=l.key,b=this._fogTileMatrixCache;if(b[g])return b[g];const I=this.projection.createTileMatrix(this,this.cameraWorldSize,l);return p.multiply(I,this.worldToFogMatrix,I),b[g]=new Float32Array(I),b[g]}calculateProjMatrix(l,g=!1){const b=l.key,I=g?this._alignedProjMatrixCache:this._projMatrixCache;if(I[b])return I[b];const A=this.calculatePosMatrix(l,this.worldSize);return p.multiply(A,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,A),I[b]=new Float32Array(A),I[b]}calculatePixelsToTileUnitsMatrix(l){const g=l.tileID.key,b=this._pixelsToTileUnitsCache;if(b[g])return b[g];const I=function(A,O){const{scale:U}=A.tileTransform,j=U*p.EXTENT/(A.tileSize*Math.pow(2,O.zoom-A.tileID.overscaledZ+A.tileID.canonical.z));return H=new Float32Array(4),_e=(X=O.inverseAdjustmentMatrix)[1],Le=X[2],Ie=X[3],De=(K=[j,j])[1],H[0]=X[0]*(Fe=K[0]),H[1]=_e*Fe,H[2]=Le*De,H[3]=Ie*De,H;var H,X,K,_e,Le,Ie,Fe,De}(l,this);return b[g]=I,b[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),I=this._camera.forward(),A=p.mercatorZfromAltitude(1,this._center.lat);b[2]/=A,I[2]/=A,p.normalize(I,I);const O=l.raycast(b,I,l.exaggeration());if(O){const U=p.scaleAndAdd([],b,I,O),j=new p.MercatorCoordinate(U[0],U[1],p.mercatorZfromAltitude(U[2],p.latFromMercatorY(U[1]))),H=(j.z+p.length([j.x-b[0],j.y-b[1],j.z-b[2]*A]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(H),this._centerAltitude=j.toAltitude(),this._center=this.coordinateLocation(j),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),I=l.getAtPointOrZero(new p.MercatorCoordinate(...b)),A=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),O=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*I;if(O<A){const U=this.locationCoordinate(this._center,this._centerAltitude),j=[U.x-b[0],U.y-b[1],U.z-b[2]],H=p.length(j);j[2]-=(A-O)/this._pixelsPerMercatorPixel;const X=p.length(j);if(0===X)return;p.scale$2(j,j,H/X*this._pixelsPerMercatorPixel),this._camera.position=[U.x-j[0],U.y-j[1],U.z*this._pixelsPerMercatorPixel-j[2]],this._camera.orientation=au(j,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const _e=this.center;return _e.lat=p.clamp(_e.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(_e.lng=p.clamp(_e.lng,this.minLng,this.maxLng)),this.center=_e,void(this._constraining=!1)}const g=this._unmodified,{x:b,y:I}=this.point;let A=0,O=b,U=I;const j=this.width/2,H=this.height/2,X=this.worldMinY*this.scale,K=this.worldMaxY*this.scale;if(I-H<X&&(U=X+H),I+H>K&&(U=K-H),K-X<this.height&&(A=Math.max(A,this.height/(K-X)),U=(K+X)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const _e=this.worldMinX*this.scale,Le=this.worldMaxX*this.scale,Ie=this.worldSize/2-(_e+Le)/2;O=(b+Ie+this.worldSize)%this.worldSize-Ie,O-j<_e&&(O=_e+j),O+j>Le&&(O=Le-j),Le-_e<this.width&&(A=Math.max(A,this.width/(Le-_e)),O=(Le+_e)/2)}O===b&&U===I||(this.center=this.unproject(new p.pointGeometry(O,U))),A&&(this.zoom+=this.scaleZoom(A)),this._constrainCameraAltitude(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const b=mh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const I=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);A[8]=2*-l.x/this.width,A[9]=2*l.y/this.height;let O=p.mul([],A,I);if(this.projection.isReprojectedInTileSpace){const rt=this.locationCoordinate(this.center),Ze=p.identity([]);p.translate(Ze,Ze,[rt.x*this.worldSize,rt.y*this.worldSize,0]),p.multiply(Ze,Ze,Bu(this)),p.translate(Ze,Ze,[-rt.x*this.worldSize,-rt.y*this.worldSize,0]),p.multiply(O,O,Ze),this.inverseAdjustmentMatrix=function(ut){const Rt=Bu(ut,!0);return le([],[Rt[0],Rt[1],Rt[4],Rt[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],O,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=O,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const U=p.invert([],A);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height);const j=new Float32Array(16);p.identity(j),p.scale(j,j,[1,-1,1]),p.rotateX(j,j,this._pitch),p.rotateZ(j,j,this.angle);const H=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),X=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;H[8]=2*-l.x/this.width,H[9]=2*(l.y+X)/this.height,this.skyboxMatrix=p.multiply(j,H,j);const K=this.point,_e=K.x,Le=K.y,Ie=this.width%2/2,Fe=this.height%2/2,De=Math.cos(this.angle),Se=Math.sin(this.angle),Be=_e-Math.round(_e)+De*Ie+Se*Fe,Ae=Le-Math.round(Le)+De*Fe+Se*Ie,et=new Float64Array(O);if(p.translate(et,et,[Be>.5?Be-1:Be,Ae>.5?Ae-1:Ae,0]),this.alignedProjMatrix=et,O=p.create(),p.scale(O,O,[this.width/2,-this.height/2,1]),p.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=p.create(),p.scale(O,O,[1,-1,1]),p.translate(O,O,[-1,-1,0]),p.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=p.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const rt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(rt,rt,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSize,g=this.cameraPixelsPerMeter,b=this._camera.position,I=1/this.height/this._pixelsPerMercatorPixel,A=[l,l,g];p.scale$2(A,A,I),p.scale$2(b,b,-1),p.multiply$2(b,b,A);const O=p.create();p.translate(O,O,b),p.scale(O,O,A),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,g,I)}_computeCameraPosition(l){const g=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),I=this.point,A=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-l/this.worldSize*this._centerAltitude;return[I.x/this.worldSize-b[0]*A,I.y/this.worldSize-b[1]*A,l/this.worldSize*this._centerAltitude-b[2]*A]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],I=l[2];let A=1;this.projection.wrap&&(this.center=this.center.wrap()),I>0&&(A=Math.min((g-b)/I,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,A),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,g=this._camera.forward(),{pitch:b,bearing:I}=this._camera.getPitchBearing(),A=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),U=Math.max((l[2]-A)/Math.cos(b),O),j=this._zoomFromMercatorZ(U);p.scaleAndAdd(l,l,g,U),this._pitch=p.clamp(b,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(I,-Math.PI,Math.PI),this._setZoom(p.clamp(j,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){const g=O=>{const U=this.getCameraToCenterDistance(this.projection,O);return this.scaleZoom(U/(l*this.tileSize))};let b,I=g(this.zoom),A=Math.abs(I-g(I));for(;b!==A;)I=g(I),b=A,A=Math.abs(I-g(I));return I}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,g){const b=Math.min(l.x,g.x),I=Math.max(l.x,g.x),A=Math.min(l.y,g.y),O=Math.max(l.y,g.y);if(A<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const U=[new p.pointGeometry(b,A),new p.pointGeometry(I,O),new p.pointGeometry(b,O),new p.pointGeometry(I,A)],j=this.renderWorldCopies?-3:0,H=this.renderWorldCopies?4:1;for(const X of U){const K=this.pointRayIntersection(X);if(K.t<0)return!0;const _e=this.rayIntersectionCoordinate(K);if(_e.x<j||_e.y<0||_e.x>H||_e.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,g){const b=p.length(p.sub([],this._camera.position,l)),I=this._zoomFromMercatorZ(b)+g;return b-this._mercatorZfromZoom(I)}getCameraPoint(){if("globe"===this.projection.name){const l=function(g,b){const I=[g[0],g[1],g[2],1];p.transformMat4$1(I,I,b);const A=Math.max(I[3],1e-6);return[I[0]/A,I[1]/A,I[2]/A,A]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.pointGeometry(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,l))}}getCameraToCenterDistance(l,g=this.zoom){const b=mh(l,g,this.width,this.height,1024),I=l.pixelSpaceConversion(this.center.lat,this.worldSize,b);return.5/Math.tan(.5*this._fov)*this.height*I}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function sc(v,l){let g=!1,b=null;const I=()=>{b=null,g&&(v(),b=setTimeout(I,l),g=!1)};return()=>(g=!0,b||I(),b)}class Ul{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=sc(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const g=ta(l);if(this._hashName){const b=this._hashName;let I=!1;const A=p.window.location.hash.slice(1).split("&").map(O=>{const U=O.split("=")[0];return U===b?(I=!0,`${U}=${g}`):O}).filter(O=>O);return I||A.push(`${b}=${g}`),`#${A.join("&")}`}return`#${g}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let g;return l.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(g=b)}),(g&&g[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(b=>isNaN(b))){const b=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(g[3]||0):l.getBearing();return l.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:b,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function ta(v,l){const g=v.getCenter(),b=Math.round(100*v.getZoom())/100,I=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),A=Math.pow(10,I),O=Math.round(g.lng*A)/A,U=Math.round(g.lat*A)/A,j=v.getBearing(),H=v.getPitch();let X=l?`/${O}/${U}/${b}`:`${b}/${U}/${O}`;return(j||H)&&(X+="/"+Math.round(10*j)/10),H&&(X+=`/${Math.round(H)}`),X}const js={linearity:.3,easing:p.bezier(0,0,.3,1)},Sc=p.extend({deceleration:2500,maxSpeed:1400},js),fa=p.extend({deceleration:20,maxSpeed:1400},js),qh=p.extend({deceleration:1e3,maxSpeed:360},js),Zc=p.extend({deceleration:1e3,maxSpeed:90},js);class da{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=p.exported.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const g={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:A}of this._inertiaBuffer)g.zoom+=A.zoomDelta||0,g.bearing+=A.bearingDelta||0,g.pitch+=A.pitchDelta||0,A.panDelta&&g.pan._add(A.panDelta),A.around&&(g.around=A.around),A.pinchAround&&(g.pinchAround=A.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(g.pan.mag()){const A=Da(g.pan.mag(),b,p.extend({},Sc,l||{}));I.offset=g.pan.mult(A.amount/g.pan.mag()),I.center=this._map.transform.center,cl(I,A)}if(g.zoom){const A=Da(g.zoom,b,fa);I.zoom=this._map.transform.zoom+A.amount,cl(I,A)}if(g.bearing){const A=Da(g.bearing,b,qh);I.bearing=this._map.transform.bearing+p.clamp(A.amount,-179,179),cl(I,A)}if(g.pitch){const A=Da(g.pitch,b,Zc);I.pitch=this._map.transform.pitch+A.amount,cl(I,A)}if(I.zoom||I.bearing){const A=void 0===g.pinchAround?g.around:g.pinchAround;I.around=A?this._map.unproject(A):this._map.getCenter()}return this.clear(),I.noMoveStart=!0,I}}function cl(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function Da(v,l,g){const{maxSpeed:b,linearity:I,deceleration:A}=g,O=p.clamp(v*I/(l/1e3),-b,b),U=Math.abs(O)/(A*I);return{easing:g.easing,duration:1e3*U,amount:O*(U/2)}}class na extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b,I={}){const A=Q(g.getCanvasContainer(),b),O=g.unproject(A);super(l,p.extend({point:A,lngLat:O,originalEvent:b},I)),this._defaultPrevented=!1,this.target=g}}class jl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b){const I="touchend"===l?b.changedTouches:b.touches,A=fe(g.getCanvasContainer(),I),O=A.map(j=>g.unproject(j)),U=A.reduce((j,H,X,K)=>j.add(H.div(K.length)),new p.pointGeometry(0,0));super(l,{points:A,point:U,lngLats:O,lngLat:g.unproject(U),originalEvent:b}),this._defaultPrevented=!1}}class ud extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b){super(l,{originalEvent:b}),this._defaultPrevented=!1}}class Hh{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new ud(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new na(l.type,this._map,l))}mouseup(l){this._map.fire(new na(l.type,this._map,l))}preclick(l){const g=p.extend({},l);g.type="preclick",this._map.fire(new na(g.type,this._map,g))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(l),this._map.fire(new na(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new na(l.type,this._map,l))}mouseover(l){this._map.fire(new na(l.type,this._map,l))}mouseout(l){this._map.fire(new na(l.type,this._map,l))}touchstart(l){return this._firePreventable(new jl(l.type,this._map,l))}touchmove(l){this._map.fire(new jl(l.type,this._map,l))}touchend(l){this._map.fire(new jl(l.type,this._map,l))}touchcancel(l){this._map.fire(new jl(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tu{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new na(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new na("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new na(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ac{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&0===l.button&&(Dn(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const b=g,I=this._startPos,A=this._lastPos;if(!I||!A||A.equals(b)||!this._box&&b.dist(I)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=Lt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const O=Math.min(I.x,b.x),U=Math.max(I.x,b.x),j=Math.min(I.y,b.y),H=Math.max(I.y,b.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${j}px)`,this._box.style.width=U-O+"px",this._box.style.height=H-j+"px")})}mouseupWindow(l,g){if(!this._active)return;const b=this._startPos,I=g;if(b&&0===l.button){if(this.reset(),de(),b.x!==I.x||b.y!==I.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:A=>A.fitScreenCoordinates(b,I,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ge(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new p.Event(l,{originalEvent:g}))}}function Vl(v,l){const g={};for(let b=0;b<v.length;b++)g[v[b].identifier]=l[b];return g}class uc{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,g,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),b.length===this.numTouches&&(this.centroid=function(I){const A=new p.pointGeometry(0,0);for(const O of I)A._add(O);return A.div(I.length)}(g),this.touches=Vl(b,g)))}touchmove(l,g,b){if(this.aborted||!this.centroid)return;const I=Vl(b,g);for(const A in this.touches){const O=this.touches[A],U=I[A];(!U||U.dist(O)>30)&&(this.aborted=!0)}}touchend(l,g,b){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===b.length){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class wl{constructor(l){this.singleTap=new uc(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,g,b){this.singleTap.touchstart(l,g,b)}touchmove(l,g,b){this.singleTap.touchmove(l,g,b)}touchend(l,g,b){const I=this.singleTap.touchend(l,g,b);if(I){const A=l.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(I)<30;if(A&&O||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class pa{constructor(){this._zoomIn=new wl({numTouches:1,numTaps:2}),this._zoomOut=new wl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,b){this._zoomIn.touchstart(l,g,b),this._zoomOut.touchstart(l,g,b)}touchmove(l,g,b){this._zoomIn.touchmove(l,g,b),this._zoomOut.touchmove(l,g,b)}touchend(l,g,b){const I=this._zoomIn.touchend(l,g,b),A=this._zoomOut.touchend(l,g,b);return I?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(I)},{originalEvent:l})}):A?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(A)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ic={0:1,2:2};class bl{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,g){return!1}_move(l,g){return{}}mousedown(l,g){if(this._lastPoint)return;const b=ze(l);this._correctButton(l,b)&&(this._lastPoint=g,this._eventButton=b)}mousemoveWindow(l,g){const b=this._lastPoint;if(b)if(l.preventDefault(),null!=this._eventButton&&function(I,A){const O=Ic[A];return void 0===I.buttons||(I.buttons&O)!==O}(l,this._eventButton))this.reset();else if(this._moved||!(g.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(b,g)}mouseupWindow(l){this._lastPoint&&ze(l)===this._eventButton&&(this._moved&&de(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vs extends bl{mousedown(l,g){super.mousedown(l,g),this._lastPoint&&(this._active=!0)}_correctButton(l,g){return 0===g&&!l.ctrlKey}_move(l,g){return{around:g,panDelta:g.sub(l)}}}class Yr extends bl{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const b=.8*(g.x-l.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(l){l.preventDefault()}}class Ua extends bl{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const b=-.5*(g.y-l.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(l){l.preventDefault()}}class Aa{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(l,g,b){return this._calculateTransform(l,g,b)}touchmove(l,g,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===b.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,g,b)}}touchend(l,g,b){this._calculateTransform(l,g,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,b){b.length>0&&(this._active=!0);const I=Vl(b,g),A=new p.pointGeometry(0,0),O=new p.pointGeometry(0,0);let U=0;for(const H in I){const X=I[H],K=this._touches[H];K&&(A._add(X),O._add(X.sub(K)),U++,I[H]=X)}if(this._touches=I,U<this._minTouches||!O.mag())return;const j=O.div(U);return this._sum._add(j),this._sum.mag()<this._clickTolerance?void 0:{around:A.div(U),panDelta:j}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Lt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class hl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,g,b){return{}}touchstart(l,g,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,b){const I=this._firstTwoTouches;if(!I)return;l.preventDefault();const[A,O]=I,U=ga(b,g,A),j=ga(b,g,O);if(!U||!j)return;const H=this._aroundCenter?null:U.add(j).div(2);return this._move([U,j],H,l)}touchend(l,g,b){if(!this._firstTwoTouches)return;const[I,A]=this._firstTwoTouches,O=ga(b,g,I),U=ga(b,g,A);O&&U||(this._active&&de(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ga(v,l,g){for(let b=0;b<v.length;b++)if(v[b].identifier===g)return l[b]}function Gl(v,l){return Math.log(v/l)/Math.LN2}class gs extends hl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const b=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Gl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Gl(this._distance,b),pinchAround:g}}}function Ds(v,l){return 180*v.angleWith(l)/Math.PI}class ma extends hl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const b=this._vector;if(this._vector=l[0].sub(l[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ds(this._vector,b),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;const I=Ds(l,b);return Math.abs(I)<g}}function Tc(v){return Math.abs(v.y)>Math.abs(v.x)}class u extends hl{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,Tc(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,b){const I=this._lastPoints;if(!I)return;const A=l[0].sub(I[0]),O=l[1].sub(I[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(A,O,b.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(A.y+O.y)/2*-.5})}gestureBeginsVertically(l,g,b){if(void 0!==this._valid)return this._valid;const I=l.mag()>=2,A=g.mag()>=2;if(!I&&!A)return;if(!I||!A)return null==this._firstMove&&(this._firstMove=b),b-this._firstMove<100&&void 0;const O=l.y>0==g.y>0;return Tc(l)&&Tc(g)&&O}}const h={panStep:100,bearingStep:15,pitchStep:10};class y{constructor(){const l=h;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,b=0,I=0,A=0,O=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?b=-1:(l.preventDefault(),A=-1);break;case 39:l.shiftKey?b=1:(l.preventDefault(),A=1);break;case 38:l.shiftKey?I=1:(l.preventDefault(),O=-1);break;case 40:l.shiftKey?I=-1:(l.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(b=0,I=0),{cameraAnimation:U=>{const j=U.getZoom();U.easeTo({duration:300,easeId:"keyboardHandler",easing:x,zoom:g?Math.round(j)+g*(l.shiftKey?2:1):j,bearing:U.getBearing()+b*this._bearingStep,pitch:U.getPitch()+I*this._pitchStep,offset:[-A*this._panStep,-O*this._panStep],center:U.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function x(v){return v*(2-v)}const T=4.000244140625;class F{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const b=p.exported.now(),I=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,0!==g&&g%T==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(I*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=Q(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const j="wheel"===this._type&&Math.abs(this._delta)>T?this._wheelZoomRate:this._defaultZoomRate;let H=2/(1+Math.exp(-Math.abs(this._delta*j)));this._delta<0&&0!==H&&(H=1/H);const X=g(),K=Math.pow(2,X),_e="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(_e*H))),"wheel"===this._type&&(this._startZoom=X,this._easing=this._smoothOutEasing(200)),this._delta=0}const b="number"==typeof this._targetZoom?this._targetZoom:g(),I=this._startZoom,A=this._easing;let O,U=!1;if("wheel"===this._type&&I&&A){const j=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),H=A(j);O=p.number(I,b,H),j<1?this._frameId||(this._frameId=!0):U=!0}else O=b,U=!0;return this._active=!0,U&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!U,zoomDelta:O-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=p.ease;if(this._prevEase){const b=this._prevEase,I=(p.exported.now()-b.start)/b.duration,A=b.easing(I+.01)-b.easing(I),O=.27/Math.sqrt(A*A+1e-4)*.01,U=Math.sqrt(.0729-O*O);g=p.bezier(O,U,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Lt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class ${constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ee{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,g){return l.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(l.shiftKey?-1:1),around:b.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class oe{constructor(){this._tap=new wl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,g,b){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=g[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(l,g,b))}touchmove(l,g,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const I=g[0],A=I.y-this._swipePoint.y;return this._swipePoint=I,l.preventDefault(),this._active=!0,{zoomDelta:A/128}}}else this._tap.touchmove(l,g,b)}touchend(l,g,b){this._tapTime?this._swipePoint&&0===b.length&&this.reset():this._tap.touchend(l,g,b)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class st{constructor(l,g,b){this._el=l,this._mousePan=g,this._touchPan=b}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zt{constructor(l,g,b){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qt{constructor(l,g,b,I){this._el=l,this._touchZoom=g,this._touchRotate=b,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const xt=v=>v.zoom||v.drag||v.pitch||v.rotate;class mn extends p.Event{}class ur{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,g){const b=p.sub([],g,l);this.radius=p.length(b[2]<0?p.div([],b,this.constants):[b[0],b[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const g=p.scale$2([],l,this.radius);if(g[2]>0){const b=p.scale$2([],[0,0,1],p.dot(g,[0,0,1])),I=p.scale$2([],p.normalize([],[g[0],g[1],0]),this.radius),A=p.add([],g,p.scale$2([],p.sub([],p.add([],I,b),g),2));g[0]=A[0],g[1]=A[1]}return g}}function Cr(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class ti{constructor(l,g){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new da(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new ur,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),p.bindAll(["handleEvent","handleWindowEvent"],this);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[I,A,O]of this._listeners)I.addEventListener(A,I===p.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[l,g,b]of this._listeners)l.removeEventListener(g,l===p.window.document?this.handleWindowEvent:this.handleEvent,b)}_addDefaultHandlers(l){const g=this._map,b=g.getCanvasContainer();this._add("mapEvent",new Hh(g,l));const I=g.boxZoom=new ac(g,l);this._add("boxZoom",I);const A=new pa,O=new ee;g.doubleClickZoom=new $(O,A),this._add("tapZoom",A),this._add("clickZoom",O);const U=new oe;this._add("tapDragZoom",U);const j=g.touchPitch=new u(g);this._add("touchPitch",j);const H=new Yr(l),X=new Ua(l);g.dragRotate=new Zt(l,H,X),this._add("mouseRotate",H,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]);const K=new Vs(l),_e=new Aa(g,l);g.dragPan=new st(b,K,_e),this._add("mousePan",K),this._add("touchPan",_e,["touchZoom","touchRotate"]);const Le=new ma,Ie=new gs;g.touchZoomRotate=new Qt(b,Ie,Le,U),this._add("touchRotate",Le,["touchPan","touchZoom"]),this._add("touchZoom",Ie,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Tu(g));const Fe=g.scrollZoom=new F(g,this);this._add("scrollZoom",Fe,["mousePan"]);const De=g.keyboard=new y;this._add("keyboard",De);for(const Se of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[Se]&&g[Se].enable(l[Se])}_add(l,g,b){this._handlers.push({handlerName:l,handler:g,allowed:b}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!xt(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,g,b){for(const I in l)if(I!==b&&(!g||g.indexOf(I)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const g=[];for(const b of l)this._el.contains(b.target)&&g.push(b);return g}handleEvent(l,g){this._updatingCamera=!0;const b="renderFrame"===l.type,I=b?void 0:l,A={needsRenderFrame:!1},O={},U={},j=l.touches?this._getMapTouches(l.touches):void 0,H=j?fe(this._el,j):b?void 0:Q(this._el,l);for(const{handlerName:_e,handler:Le,allowed:Ie}of this._handlers){if(!Le.isEnabled())continue;let Fe;this._blockedByActive(U,Ie,_e)?Le.reset():Le[g||l.type]&&(Fe=Le[g||l.type](l,H,j),this.mergeHandlerResult(A,O,Fe,_e,I),Fe&&Fe.needsRenderFrame&&this._triggerRenderFrame()),(Fe||Le.isActive())&&(U[_e]=Le)}const X={};for(const _e in this._previousActiveHandlers)U[_e]||(X[_e]=I);this._previousActiveHandlers=U,(Object.keys(X).length||Cr(A))&&(this._changes.push([A,O,X]),this._triggerRenderFrame()),(Object.keys(U).length||Cr(A))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:K}=A;K&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],K(this._map))}mergeHandlerResult(l,g,b,I,A){if(!b)return;p.extend(l,b);const O={handlerName:I,originalEvent:b.originalEvent||A};void 0!==b.zoomDelta&&(g.zoom=O),void 0!==b.panDelta&&(g.drag=O),void 0!==b.pitchDelta&&(g.pitch=O),void 0!==b.bearingDelta&&(g.rotate=O)}_applyChanges(){const l={},g={},b={};for(const[I,A,O]of this._changes)I.panDelta&&(l.panDelta=(l.panDelta||new p.pointGeometry(0,0))._add(I.panDelta)),I.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+I.pitchDelta),void 0!==I.around&&(l.around=I.around),void 0!==I.aroundCoord&&(l.aroundCoord=I.aroundCoord),void 0!==I.pinchAround&&(l.pinchAround=I.pinchAround),I.noInertia&&(l.noInertia=I.noInertia),p.extend(g,A),p.extend(b,O);this._updateMapTransform(l,g,b),this._changes=[]}_updateMapTransform(l,g,b){const I=this._map,A=I.transform,O=Be=>[Be.x,Be.y,Be.z];if((Be=>{const Ae=this._eventsInProgress.drag;return Ae&&!this._handlersById[Ae.handlerName].isActive()})()&&!Cr(l)){const Be=A.zoom;A.cameraElevationReference="sea",A.recenterOnTerrain(),A.cameraElevationReference="ground",Be!==A.zoom&&this._map._update(!0)}if(!Cr(l))return void this._fireEvents(g,b,!0);let{panDelta:U,zoomDelta:j,bearingDelta:H,pitchDelta:X,around:K,aroundCoord:_e,pinchAround:Le}=l;void 0!==Le&&(K=Le),(Be=>g.drag&&!this._eventsInProgress.drag)()&&K&&(this._dragOrigin=O(A.pointCoordinate3D(K)),this._trackingEllipsoid.setup(A._camera.position,this._dragOrigin)),A.cameraElevationReference="sea",I._stop(!0),K=K||I.transform.centerPoint,H&&(A.bearing+=H),X&&(A.pitch+=X),A._updateCameraState();const Ie=[0,0,0];if(U)if("mercator"===A.projection.name){const Be=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(K).dir),Ae=this._trackingEllipsoid.projectRay(A.screenPointToMercatorRay(K.sub(U)).dir);Ie[0]=Ae[0]-Be[0],Ie[1]=Ae[1]-Be[1]}else{const Be=A.pointCoordinate(K);if("globe"===A.projection.name){U=U.rotate(-A.angle);const Ae=A._pixelsPerMercatorPixel/A.worldSize;Ie[0]=-U.x*p.mercatorScale(p.latFromMercatorY(Be.y))*Ae,Ie[1]=-U.y*p.mercatorScale(A.center.lat)*Ae}else{const Ae=A.pointCoordinate(K.sub(U));Be&&Ae&&(Ie[0]=Ae.x-Be.x,Ie[1]=Ae.y-Be.y)}}const Fe=A.zoom,De=[0,0,0];if(j){const Be=O(_e||A.pointCoordinate3D(K)),Ae={dir:p.normalize([],p.sub([],Be,A._camera.position))};if(Ae.dir[2]<0){const et=A.zoomDeltaToMovement(Be,j);p.scale$2(De,Ae.dir,et)}}const Se=p.add(Ie,Ie,De);A._translateCameraConstrained(Se),j&&Math.abs(A.zoom-Fe)>1e-4&&A.recenterOnTerrain(),A.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,b,!0)}_fireEvents(l,g,b){const I=xt(this._eventsInProgress),A=xt(l),O={};for(const X in l){const{originalEvent:K}=l[X];this._eventsInProgress[X]||(O[`${X}start`]=K),this._eventsInProgress[X]=l[X]}!I&&A&&this._fireEvent("movestart",A.originalEvent);for(const X in O)this._fireEvent(X,O[X]);A&&this._fireEvent("move",A.originalEvent);for(const X in l){const{originalEvent:K}=l[X];this._fireEvent(X,K)}const U={};let j;for(const X in this._eventsInProgress){const{handlerName:K,originalEvent:_e}=this._eventsInProgress[X];this._handlersById[K].isActive()||(delete this._eventsInProgress[X],j=g[K]||_e,U[`${X}end`]=j)}for(const X in U)this._fireEvent(X,U[X]);const H=xt(this._eventsInProgress);if(b&&(I||A)&&!H){this._updatingCamera=!0;const X=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),K=_e=>0!==_e&&-this._bearingSnap<_e&&_e<this._bearingSnap;X?(K(X.bearing||this._map.getBearing())&&(X.bearing=0),this._map.easeTo(X,{originalEvent:j})):(this._map.fire(new p.Event("moveend",{originalEvent:j})),K(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new p.Event(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new mn("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const bs="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ws extends p.Evented{constructor(l,g){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,b){return l=p.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},g),b)}panTo(l,g,b){return this.easeTo(p.extend({center:l},g),b)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,b){return this.easeTo(p.extend({zoom:l},g),b)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,b){return this.easeTo(p.extend({bearing:l},g),b)}resetNorth(l,g){return this.rotateTo(0,p.extend({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=p.LngLatBounds.convert(l);const b=g&&g.bearing||0,I=l.getNorthWest(),A=l.getSouthEast();return this._cameraForBounds(this.transform,I,A,b,g)}_extendCameraOptions(l){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const b=l.padding;l.padding={top:b,bottom:b,right:b,left:b}}return l.padding=p.extend(g,l.padding),l}_minimumAABBFrustumDistance(l,g){const b=g.max[0]-g.min[0],I=g.max[1]-g.min[1];return b/I>l.aspect?b/(2*Math.tan(.5*l.fovX)*l.aspect):I/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,g,b,I,A){const O=l.clone(),U=this._extendCameraOptions(A);O.bearing=I;const j=p.LngLat.convert(g),H=p.LngLat.convert(b),X=.5*(j.lat+H.lat),K=.5*(j.lng+H.lng),_e=p.latLngToECEF(X,K),Le=p.normalize([],_e),Ie=p.normalize([],p.cross([],Le,[0,1,0])),Fe=p.cross([],Ie,Le),De=[Ie[0],Ie[1],Ie[2],0,Fe[0],Fe[1],Fe[2],0,Le[0],Le[1],Le[2],0,0,0,0,1],Se=[_e,p.latLngToECEF(j.lat,j.lng),p.latLngToECEF(H.lat,j.lng),p.latLngToECEF(H.lat,H.lng),p.latLngToECEF(j.lat,H.lng),p.latLngToECEF(X,j.lng),p.latLngToECEF(X,H.lng),p.latLngToECEF(j.lat,K),p.latLngToECEF(H.lat,K)];let Be=p.Aabb.fromPoints(Se.map(Nn=>[p.dot(Ie,Nn),p.dot(Fe,Nn),p.dot(Le,Nn)]));const Ae=p.transformMat4([],Be.center,De);0===p.squaredLength(Ae)&&p.set(Ae,0,0,1),p.normalize(Ae,Ae),p.scale$2(Ae,Ae,p.GLOBE_RADIUS),O.center=p.ecefToLatLng(Ae);const et=O.getWorldToCameraMatrix(),rt=p.invert(new Float64Array(16),et);Be=p.Aabb.applyTransform(Be,p.multiply([],et,De)),p.transformMat4(Ae,Ae,et);const Ze=.5*(Be.max[2]-Be.min[2]),ut=this._minimumAABBFrustumDistance(O,Be),Rt=p.scale$2([],[0,0,1],Ze),Wt=p.add(Rt,Ae,Rt),Vt=ut+(0===O.pitch?0:p.distance(Ae,Wt)),Ln=O.globeCenterInViewSpace,Dt=p.sub([],Ae,[Ln[0],Ln[1],Ln[2]]);p.normalize(Dt,Dt),p.scale$2(Dt,Dt,Vt);const dn=p.add([],Ae,Dt);p.transformMat4(dn,dn,rt);const fn=p.earthRadius/p.GLOBE_RADIUS,Ft=p.length(dn),bt=p.mercatorZfromAltitude(Ft*fn-p.earthRadius,0),Jn=Math.min(O.zoomFromMercatorZAdjusted(bt),U.maxZoom);return Jn>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"mercator"}),O.zoom=Jn,this._cameraForBounds(O,g,b,I,A)):{center:O.center,zoom:Jn,bearing:I}}queryTerrainElevation(l,g){const b=this.transform.elevation;return b?(g=p.extend({},{exaggerated:!0},g),b.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,g.exaggerated)):null}_cameraForBounds(l,g,b,I,A){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,g,b,I,A);const O=l.clone(),U=this._extendCameraOptions(A),j=O.padding;O.bearing=I;const H=p.LngLat.convert(g),X=p.LngLat.convert(b),K=new p.LngLat(H.lng,X.lat),_e=new p.LngLat(X.lng,H.lat),Le=O.project(H),Ie=O.project(X),Fe=this.queryTerrainElevation(H),De=this.queryTerrainElevation(X),Se=this.queryTerrainElevation(K),Be=this.queryTerrainElevation(_e),Ae=[[Le.x,Le.y,Math.min(Fe||0,De||0,Se||0,Be||0)],[Ie.x,Ie.y,Math.max(Fe||0,De||0,Se||0,Be||0)]];let et=p.Aabb.fromPoints(Ae);const rt=O.getWorldToCameraMatrix(),Ze=p.invert(new Float64Array(16),rt);et=p.Aabb.applyTransform(et,rt);const ut=p.sub([],et.max,et.min),Rt=j.left||0,Wt=j.right||0,Vt=j.bottom||0,Ln=j.top||0,{left:Dt,right:dn,top:fn,bottom:Ft}=U.padding,bt=.5*(Rt+Wt),Jn=.5*(Ln+Vt),Nn=Math.min(O.scaleZoom(O.scale*Math.min((O.width-(Rt+Wt+Dt+dn))/ut[0],(O.height-(Vt+Ln+Ft+fn))/ut[1])),U.maxZoom),Vn=O.scale/O.zoomScale(Nn);et=new p.Aabb([et.min[0]-(Dt+bt)*Vn,et.min[1]-(Ft+Jn)*Vn,et.min[2]],[et.max[0]+(dn+bt)*Vn,et.max[1]+(fn+Jn)*Vn,et.max[2]]);const Bn=.5*ut[2],fr=this._minimumAABBFrustumDistance(O,et),qr=[0,0,1,0];p.transformMat4$1(qr,qr,rt),p.normalize$2(qr,qr);const kr=p.scale$2([],qr,fr+Bn),wr=p.add([],et.center,kr),Un=("number"==typeof U.offset.x&&"number"==typeof U.offset.y?new p.pointGeometry(U.offset.x,U.offset.y):p.pointGeometry.convert(U.offset)).rotate(-p.degToRad(I));et.center[0]-=Un.x*Vn,et.center[1]+=Un.y*Vn,p.transformMat4(et.center,et.center,Ze),p.transformMat4(wr,wr,Ze);const Zr=[et.center[0],et.center[1],wr[2]*O.pixelsPerMeter];p.scale$2(Zr,Zr,1/O.worldSize);const wi=p.lngFromMercatorX(Zr[0]),$o=p.latFromMercatorY(Zr[1]),ms=Math.min(O._zoomFromMercatorZ(Zr[2]),U.maxZoom),qo=new p.LngLat(wi,$o);return O.mercatorFromTransition&&ms<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"globe"}),O.zoom=ms,this._cameraForBounds(O,g,b,I,A)):{center:qo,zoom:ms,bearing:I}}fitBounds(l,g,b){const I=this.cameraForBounds(l,g);return this._fitInternal(I,g,b)}fitScreenCoordinates(l,g,b,I,A){const O=p.pointGeometry.convert(l),U=p.pointGeometry.convert(g),j=new p.pointGeometry(Math.min(O.x,U.x),Math.min(O.y,U.y)),H=new p.pointGeometry(Math.max(O.x,U.x),Math.max(O.y,U.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(O,U))return this;const X=this.transform.pointLocation3D(j),K=this.transform.pointLocation3D(H),_e=this.transform.pointLocation3D(new p.pointGeometry(j.x,H.y)),Le=this.transform.pointLocation3D(new p.pointGeometry(H.x,j.y)),Ie=[Math.min(X.lng,K.lng,_e.lng,Le.lng),Math.min(X.lat,K.lat,_e.lat,Le.lat)],Fe=[Math.max(X.lng,K.lng,_e.lng,Le.lng),Math.max(X.lat,K.lat,_e.lat,Le.lat)],De=this._cameraForBounds(this.transform,Ie,Fe,b,I);return this._fitInternal(De,I,A)}_fitInternal(l,g,b){return l?(delete(g=p.extend(l,g)).padding,g.linear?this.easeTo(g,b):this.flyTo(g,b)):this}jumpTo(l,g){this.stop();const b=l.preloadOnly?this.transform.clone():this.transform;let I=!1,A=!1,O=!1;return"zoom"in l&&b.zoom!==+l.zoom&&(I=!0,b.zoom=+l.zoom),void 0!==l.center&&(b.center=p.LngLat.convert(l.center)),"bearing"in l&&b.bearing!==+l.bearing&&(A=!0,b.bearing=+l.bearing),"pitch"in l&&b.pitch!==+l.pitch&&(O=!0,b.pitch=+l.pitch),null==l.padding||b.isPaddingEqual(l.padding)||(b.padding=l.padding),l.preloadOnly?(this._preloadTiles(b),this):(this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),I&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),A&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),O&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(bs),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,g){const b=this.transform;if(!b.projection.supportsFreeCamera)return p.warnOnce(bs),this;this.stop();const I=b.zoom,A=b.pitch,O=b.bearing;b.setFreeCameraOptions(l);const U=I!==b.zoom,j=A!==b.pitch,H=O!==b.bearing;return this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),U&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),H&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),j&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)),this}easeTo(l,g){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||!l.essential&&p.exported.prefersReducedMotion)&&(l.duration=0);const b=this.transform,I=this.getZoom(),A=this.getBearing(),O=this.getPitch(),U=this.getPadding(),j="zoom"in l?+l.zoom:I,H="bearing"in l?this._normalizeBearing(l.bearing,A):A,X="pitch"in l?+l.pitch:O,K="padding"in l?l.padding:b.padding,_e=p.pointGeometry.convert(l.offset);let Le,Ie,Fe;if("globe"===b.projection.name){const Wt=p.MercatorCoordinate.fromLngLat(b.center),Vt=_e.rotate(-b.angle);Wt.x+=Vt.x/b.worldSize,Wt.y+=Vt.y/b.worldSize;const Ln=Wt.toLngLat(),Dt=p.LngLat.convert(l.center||Ln);this._normalizeCenter(Dt),Le=b.centerPoint.add(Vt),Ie=new p.pointGeometry(Wt.x,Wt.y).mult(b.worldSize),Fe=new p.pointGeometry(p.mercatorXfromLng(Dt.lng),p.mercatorYfromLat(Dt.lat)).mult(b.worldSize).sub(Ie)}else{Le=b.centerPoint.add(_e);const Wt=b.pointLocation(Le),Vt=p.LngLat.convert(l.center||Wt);this._normalizeCenter(Vt),Ie=b.project(Wt),Fe=b.project(Vt).sub(Ie)}const De=b.zoomScale(j-I);let Se,Be;l.around&&(Se=p.LngLat.convert(l.around),Be=b.locationPoint(Se));const Ae=this._zooming||j!==I,et=this._rotating||A!==H,rt=this._pitching||X!==O,Ze=!b.isPaddingEqual(K),ut=Wt=>Vt=>{if(Ae&&(Wt.zoom=p.number(I,j,Vt)),et&&(Wt.bearing=p.number(A,H,Vt)),rt&&(Wt.pitch=p.number(O,X,Vt)),Ze&&(Wt.interpolatePadding(U,K,Vt),Le=Wt.centerPoint.add(_e)),Se)Wt.setLocationAtPoint(Se,Be);else{const Ln=Wt.zoomScale(Wt.zoom-I),Dt=j>I?Math.min(2,De):Math.max(.5,De),dn=Math.pow(Dt,1-Vt),fn=Wt.unproject(Ie.add(Fe.mult(Vt*dn)).mult(Ln));Wt.setLocationAtPoint(Wt.renderWorldCopies?fn.wrap():fn,Le)}return l.preloadOnly||this._fireMoveEvents(g),Wt};if(l.preloadOnly){const Wt=this._emulate(ut,l.duration,b);return this._preloadTiles(Wt),this}const Rt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Ae,this._rotating=et,this._pitching=rt,this._padding=Ze,this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,Rt),this._ease(ut(b),Wt=>{b.recenterOnTerrain(),this._afterEase(g,Wt)},l),this}_prepareEase(l,g,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||b.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!b.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!b.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!b.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const b=this._zooming,I=this._rotating,A=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new p.Event("zoomend",l)),I&&this.fire(new p.Event("rotateend",l)),A&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,g){if(!l.essential&&p.exported.prefersReducedMotion){const Vn=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Vn,g)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const b=this.transform,I=this.getZoom(),A=this.getBearing(),O=this.getPitch(),U=this.getPadding(),j="zoom"in l?p.clamp(+l.zoom,b.minZoom,b.maxZoom):I,H="bearing"in l?this._normalizeBearing(l.bearing,A):A,X="pitch"in l?+l.pitch:O,K="padding"in l?l.padding:b.padding,_e=b.zoomScale(j-I),Le=p.pointGeometry.convert(l.offset);let Ie=b.centerPoint.add(Le);const Fe=b.pointLocation(Ie),De=p.LngLat.convert(l.center||Fe);this._normalizeCenter(De);const Se=b.project(Fe),Be=b.project(De).sub(Se);let Ae=l.curve;const et=Math.max(b.width,b.height),rt=et/_e,Ze=Be.mag();if("minZoom"in l){const Vn=p.clamp(Math.min(l.minZoom,I,j),b.minZoom,b.maxZoom),Bn=et/b.zoomScale(Vn-I);Ae=Math.sqrt(Bn/Ze*2)}const ut=Ae*Ae;function Rt(Vn){const Bn=(rt*rt-et*et+(Vn?-1:1)*ut*ut*Ze*Ze)/(2*(Vn?rt:et)*ut*Ze);return Math.log(Math.sqrt(Bn*Bn+1)-Bn)}function Wt(Vn){return(Math.exp(Vn)-Math.exp(-Vn))/2}function Vt(Vn){return(Math.exp(Vn)+Math.exp(-Vn))/2}const Ln=Rt(0);let Dt=function(Vn){return Vt(Ln)/Vt(Ln+Ae*Vn)},dn=function(Vn){return et*((Vt(Ln)*(Wt(Bn=Ln+Ae*Vn)/Vt(Bn))-Wt(Ln))/ut)/Ze;var Bn},fn=(Rt(1)-Ln)/Ae;if(Math.abs(Ze)<1e-6||!isFinite(fn)){if(Math.abs(et-rt)<1e-6)return this.easeTo(l,g);const Vn=rt<et?-1:1;fn=Math.abs(Math.log(rt/et))/Ae,dn=function(){return 0},Dt=function(Bn){return Math.exp(Vn*Ae*Bn)}}l.duration="duration"in l?+l.duration:1e3*fn/("screenSpeed"in l?+l.screenSpeed/Ae:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Ft=A!==H,bt=X!==O,Jn=!b.isPaddingEqual(K),Nn=Vn=>Bn=>{const fr=Bn*fn,qr=1/Dt(fr);Vn.zoom=1===Bn?j:I+Vn.scaleZoom(qr),Ft&&(Vn.bearing=p.number(A,H,Bn)),bt&&(Vn.pitch=p.number(O,X,Bn)),Jn&&(Vn.interpolatePadding(U,K,Bn),Ie=Vn.centerPoint.add(Le));const kr=1===Bn?De:Vn.unproject(Se.add(Be.mult(dn(fr))).mult(qr));return Vn.setLocationAtPoint(Vn.renderWorldCopies?kr.wrap():kr,Ie),Vn._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(g),Vn};if(l.preloadOnly){const Vn=this._emulate(Nn,l.duration,b);return this._preloadTiles(Vn),this}return this._zooming=!0,this._rotating=Ft,this._pitching=bt,this._padding=Jn,this._prepareEase(g,!1),this._ease(Nn(b),()=>this._afterEase(g),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,g)}if(!l){const b=this.handlers;b&&b.stop(!1)}return this}_ease(l,g,b){!1===b.animate||0===b.duration?(l(1),g()):(this._easeStart=p.exported.now(),this._easeOptions=b,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,g){l=p.wrap(l,-180,180);const b=Math.abs(l-g);return Math.abs(l-360-g)<b&&(l-=360),Math.abs(l+360-g)<b&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const b=l.lng-g.center.lng;l.lng+=b>180?-360:b<-180?360:0}_emulate(l,g,b){const I=Math.ceil(15*g/1e3),A=[],O=l(b.clone());for(let U=0;U<=I;U++){const j=O(U/I);A.push(j.clone())}return A}}class ra{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const g=this.options&&this.options.compact;return this._map=l,this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Lt("button","mapboxgl-ctrl-attrib-button",this._container),Lt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Lt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const b=this._map._getUIString(`AttributionControl.${g}`);l.setAttribute("aria-label",b),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",b)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const b=g.reduce((I,A,O)=>(A.value&&(I+=`${A.key}=${A.value}${O<g.length-1?"&":""}`),I),"?");l.href=`${p.config.FEEDBACK_URL}/${b}#${ta(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const g=this._map.style._sourceCaches;for(const I in g){const A=g[I];if(A.used){const O=A.getSource();O.attribution&&l.indexOf(O.attribution)<0&&l.push(O.attribution)}}l.sort((I,A)=>I.length-A.length),l=l.filter((I,A)=>{for(let O=A+1;O<l.length;O++)if(l[O].indexOf(I)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const b=l.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,l.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _u{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=Lt("div","mapboxgl-ctrl");const g=Lt("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const g in l){const b=l[g].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const g=l[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class lc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,b=g?this._queue.concat(g):this._queue;for(const I of b)if(I.id===l)return void(I.cancelled=!0)}run(l=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const b of g)if(!b.cancelled&&(b.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Tf(v,l,g){if(v=new p.LngLat(v.lng,v.lat),l){const b=new p.LngLat(v.lng-360,v.lat),I=new p.LngLat(v.lng+360,v.lat),A=360*Math.ceil(Math.abs(v.lng-g.center.lng)/360),O=g.locationPoint(v).distSqr(l),U=l.x<0||l.y<0||l.x>g.width||l.y>g.height;g.locationPoint(b).distSqr(l)<O&&(U||Math.abs(b.lng-g.center.lng)<A)?v=b:g.locationPoint(I).distSqr(l)<O&&(U||Math.abs(I.lng-g.center.lng)<A)&&(v=I)}for(;Math.abs(v.lng-g.center.lng)>180;){const b=g.locationPoint(v);if(b.x>=0&&b.y>=0&&b.x<=g.width&&b.y<=g.height)break;v.lng>g.center.lng?v.lng-=360:v.lng+=360}return v}const Kd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Mf extends p.Evented{constructor(l,g){if(super(),(l instanceof p.window.HTMLElement||g)&&(l=p.extend({element:l},g)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Lt("div");const I=41,A=27,O=un("svg",{display:"block",height:I*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${I}`},this._element),U=un("radialGradient",{id:"shadowGradient"},un("defs",{},O));un("stop",{offset:"10%","stop-opacity":.4},U),un("stop",{offset:"100%","stop-opacity":.05},U),un("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),un("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),un("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),un("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=p.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",I=>{I.preventDefault()}),this._element.addEventListener("mousedown",I=>{I.preventDefault()});const b=this._element.classList;for(const I in Kd)b.remove(`mapboxgl-marker-anchor-${I}`);b.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const I=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(24.6+I)],"bottom-right":[-I,-1*(24.6+I)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const g=l.code,b=l.charCode||l.keyCode;"Space"!==g&&"Enter"!==g&&32!==b&&13!==b||this.togglePopup()}_onMapClick(l){const g=l.originalEvent.target,b=this._element;this._popup&&(g===b||b.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,g=this._pos;if(!l||!g)return!1;const b=l.unproject(g),I=l.getFreeCameraOptions();if(!I.position)return!1;const A=I.position.toLngLat();return A.distanceTo(b)<.9*A.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const g=this._pos;if(!g||g.x<0||g.x>l.transform.width||g.y<0||g.y>l.transform.height)return void this._clearFadeTimer();const b=l.unproject(g);let I;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?I=0:(I=1-l._queryFogOpacity(b),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(I*=this._occludedOpacity)),this._element.style.opacity=`${I}`,this._element.style.pointerEvents=I>0?"auto":"none",this._popup&&this._popup._setOpacity(I),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${Kd[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const l=this._pos,g=this._map,b=this.getPitchAlignment();if(!g||!l||"map"!==b)return"";if(!g._showingGlobe()){const j=g.getPitch();return j?`rotateX(${j}deg)`:""}const I=p.radToDeg(p.globeTiltAtLngLat(g.transform,this._lngLat)),A=l.sub(p.globeCenterToScreenPoint(g.transform)),O=Math.abs(A.x)+Math.abs(A.y);if(0===O)return"";const U=I/O;return`rotateX(${-A.y*U}deg) rotateY(${A.x*U}deg)`}_calculateZTransform(){const l=this._pos,g=this._map;if(!g||!l)return"";let b=0;const I=this.getRotationAlignment();if("map"===I)if(g._showingGlobe()){const A=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(A);b=p.radToDeg(Math.atan2(O.y,O.x))-90}else b=-g.getBearing();else if("horizon"===I){const A=p.smoothstep(4,6,g.getZoom()),O=p.globeCenterToScreenPoint(g.transform);O.y+=A*g.transform.height;const U=l.sub(O),j=p.radToDeg(Math.atan2(U.y,U.x));b=(j>90?j-270:j+90)*(1-A)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=Tf(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.pointGeometry.convert(l),this._update(),this}_onMove(l){const g=this._map;if(!g)return;const b=this._pointerdownPos,I=this._positionDelta;if(b&&I){if(!this._isDragging){const A=this._clickTolerance||g._clickTolerance;if(l.point.dist(b)<A)return;this._isDragging=!0}this._pos=l.point.sub(I),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const g=this._map,b=this._pos;g&&b&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(b),this._pointerdownPos=l.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const g=this._map;return g&&(l?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Mu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},cc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ld(v=new p.pointGeometry(0,0),l="bottom"){if("number"==typeof v){const g=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(l){case"top":return new p.pointGeometry(0,v);case"top-left":return new p.pointGeometry(g,g);case"top-right":return new p.pointGeometry(-g,g);case"bottom":return new p.pointGeometry(0,-v);case"bottom-left":return new p.pointGeometry(g,-g);case"bottom-right":return new p.pointGeometry(-g,-g);case"left":return new p.pointGeometry(v,0);case"right":return new p.pointGeometry(-v,0)}return new p.pointGeometry(0,0)}return v instanceof p.pointGeometry||Array.isArray(v)?p.pointGeometry.convert(v):p.pointGeometry.convert(v[l]||[0,0])}class yh{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const g=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,g,b){this._start=this.getValue(g),this._end=l,this._startTime=g,this._endTime=g+b}}const hc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Jd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Df(v){v.parentNode&&v.parentNode.removeChild(v)}const qp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Hp{constructor(l,g,b=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new Yr({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,b&&(this.mousePitch=new Ua({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(l,g){this.mouseRotate.mousedown(l,g),this.mousePitch&&this.mousePitch.mousedown(l,g),Dn()}move(l,g){const b=this.map,I=this.mouseRotate.mousemoveWindow(l,g),A=I&&I.bearingDelta;if(A&&b.setBearing(b.getBearing()+A),this.mousePitch){const O=this.mousePitch.mousemoveWindow(l,g),U=O&&O.pitchDelta;U&&b.setPitch(b.getPitch()+U)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ge(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Q(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Q(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=fe(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=fe(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const cd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Af={maxWidth:100,unit:"metric"};function Qd(v,l,g){const b=Xh(l),I=b/l,A={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[g];this._map._requestDomTask(()=>{this._container.style.width=v*I+"px",this._container.innerHTML=`${b}&nbsp;${A}`})}function Xh(v){const l=Math.pow(10,`${Math.floor(v)}`.length-1);let g=v/l;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(b){const I=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*I)/I}(g),l*g}const Pf={version:p.version,supported:We,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends Ws{constructor(v){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(v=p.extend({},Jd,v)).minZoom&&null!=v.maxZoom&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=v.minPitch&&null!=v.maxPitch&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=v.minPitch&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=v.maxPitch&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(v.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Iu(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new lc,this._domRenderTaskQueue=new lc,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},hc,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new yh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,"string"==typeof v.container){if(this._container=p.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new ti(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new Ul("string"==typeof v.hash&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,p.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new ra({customAttribution:v.customAttribution})),this._logoControl=new _u,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(v,l){if(void 0===l&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=v.onAdd(this);this._controls.push(v);const b=this._controlPositions[l];return-1!==l.indexOf("bottom")?b.insertBefore(g,b.firstChild):b.appendChild(g),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",v)).fire(new p.Event("move",v)),this.fire(new p.Event("resize",v)),l&&this.fire(new p.Event("moveend",v)),this}getBounds(){return"globe"===this.transform.projection.name&&p.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(p.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return"auto"===v?p.window.navigator.language:Array.isArray(v)?0===v.length?void 0:v.map(l=>"auto"===l?p.window.navigator.language:l):v}setLanguage(v){const l=this._parseLanguage(v);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(v){return this._lazyInitEmptyStyle(),v?"string"==typeof v&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const v=this.transform,l=v.projection.name;let g;"globe"===l&&v.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(v.setMercatorFromTransition(),g=!0):"mercator"===l&&v.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(v.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(v,l){return this._updateProjection(v||l||{name:"mercator"})}_updateProjection(v){let l;if(l="globe"===v.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(v){return this.transform.locationPoint3D(p.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(p.pointGeometry.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(v,l,g){if("mouseenter"===v||"mouseover"===v){let b=!1;const I=O=>{const U=l.filter(H=>this.getLayer(H)),j=U.length?this.queryRenderedFeatures(O.point,{layers:U}):[];j.length?b||(b=!0,g.call(this,new na(v,this,O.originalEvent,{features:j}))):b=!1},A=()=>{b=!1};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:A}}}if("mouseleave"===v||"mouseout"===v){let b=!1;const I=O=>{const U=l.filter(j=>this.getLayer(j));(U.length?this.queryRenderedFeatures(O.point,{layers:U}):[]).length?b=!0:b&&(b=!1,g.call(this,new na(v,this,O.originalEvent)))},A=O=>{b&&(b=!1,g.call(this,new na(v,this,O.originalEvent)))};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:A}}}{const b=I=>{const A=l.filter(U=>this.getLayer(U)),O=A.length?this.queryRenderedFeatures(I.point,{layers:A}):[];O.length&&(I.features=O,g.call(this,I),delete I.features)};return{layers:new Set(l),listener:g,delegates:{[v]:b}}}}on(v,l,g){if(void 0===g)return super.on(v,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(v,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(b);for(const I in b.delegates)this.on(I,b.delegates[I]);return this}once(v,l,g){if(void 0===g)return super.once(v,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(v,l,g);for(const I in b.delegates)this.once(I,b.delegates[I]);return this}off(v,l,g){if(void 0===g)return super.off(v,l);l=new Set(Array.isArray(l)?l:[l]);const b=(A,O)=>{if(A.size!==O.size)return!1;for(const U of A)if(!O.has(U))return!1;return!0},I=this._delegatedListeners?this._delegatedListeners[v]:void 0;return I&&(A=>{for(let O=0;O<A.length;O++){const U=A[O];if(U.listener===g&&b(U.layers,l)){for(const j in U.delegates)this.off(j,U.delegates[j]);return A.splice(O,1),this}}})(I),this}queryRenderedFeatures(v,l){return this.style?(void 0!==l||void 0===v||v instanceof p.pointGeometry||Array.isArray(v)||(l=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}setStyle(v,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(null==l)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v&&(this.style=new Fs(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof v?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Fs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if("string"==typeof v){const g=this._requestManager.normalizeStyleURL(v),b=this._requestManager.transformRequest(g,p.ResourceType.Style);p.getJSON(b,(I,A)=>{I?this.fire(new p.ErrorEvent(I)):A&&this._updateDiff(A,l)})}else"object"==typeof v&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v)&&this._update(!0)}catch(g){p.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){return!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const l in v){const g=v[l]._tiles;for(const b in g){const I=g[b];if("loaded"!==I.state&&"errored"!==I.state)return!1}}return!0}addSourceType(v,l,g){this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,g)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,l,{pixelRatio:g=1,sdf:b=!1,stretchX:I,stretchY:A,content:O}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:U,height:j,data:H}=p.exported.getImageData(l);this.style.addImage(v,{data:new p.RGBAImage({width:U,height:j},H),pixelRatio:g,stretchX:I,stretchY:A,content:O,sdf:b,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:U,height:j}=l,H=l;this.style.addImage(v,{data:new p.RGBAImage({width:U,height:j},new Uint8Array(H.data)),pixelRatio:g,stretchX:I,stretchY:A,content:O,sdf:b,version:0,userImage:H}),H.onAdd&&H.onAdd(this,v)}}updateImage(v,l){const g=this.style.getImage(v);if(!g)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:I,height:A}=b;void 0!==I&&void 0!==A?I===g.data.width&&A===g.data.height?(g.data.replace(b.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(v,g)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${I}, ${A})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,l){p.getImage(this._requestManager.transformRequest(v,p.ResourceType.Image),(g,b)=>{l(g,b instanceof p.window.HTMLImageElement?p.exported.getImageData(b):b)})}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,l,g){return this.style.setLayerZoomRange(v,l,g),this._update(!0)}setFilter(v,l,g={}){return this.style.setFilter(v,l,g),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,g,b={}){return this.style.setPaintProperty(v,l,g,b),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,g,b={}){return this.style.setLayoutProperty(v,l,g,b),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(v),this.transform):0}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let g,b,I,A=this._container;for(;A&&(!b||!I);){const O=p.window.getComputedStyle(A).transform;O&&"none"!==O&&(g=O.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(b=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(I=g[3])),A=A.parentElement}this._containerWidth=b?Math.abs(v/b):v,this._containerHeight=I?Math.abs(l/I):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=Lt("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=Lt("div","mapboxgl-canvas-container",v);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=Lt("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=Lt("div","mapboxgl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=Lt("div",`mapboxgl-ctrl-${I}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const g=p.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(v),this._canvas.height=g*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);-1!==l&&this._markers.splice(l,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const l=this._popups.indexOf(v);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const v=p.extend({},We.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);l?(p.storeAuthState(l,!0),this.painter=new Xs(l,this.transform),this.on("data",g=>{"source"===g.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(l)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;const g=this.painter.context.extTimerQuery,b=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();let I=!1;const A=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const j=this.transform.zoom,H=this.transform.pitch,X=p.exported.now();this.style.zoomHistory.update(j,X);const K=new p.EvaluationParameters(j,{now:X,fadeDuration:A,pitch:H,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),_e=K.crossFadingFactor();1===_e&&_e===this._crossFadingFactor||(I=!0,this._crossFadingFactor=_e),this.style.update(K)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let O=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),O=this._updateAverageElevation(b),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):O=this._updateAverageElevation(b),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,A,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:A,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const j=p.exported.now()-b;g.endQueryEXT(g.TIME_ELAPSED_EXT,l),setTimeout(()=>{const H=g.getQueryObjectEXT(l,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:j,gpuTime:H})),p.window.performance.mark("frame-gpu",{startTime:b,detail:{gpuTime:H}})},50)}if(this.listens("gpu-timing-layer")){const j=this.painter.collectGpuTimers();setTimeout(()=>{const H=this.painter.queryGpuTimers(j);this.fire(new p.Event("gpu-timing-layer",{layerTimes:H}))},50)}if(this.listens("gpu-timing-deferred-render")){const j=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const H=this.painter.queryGpuTimeDeferredRender(j);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:H}))},50)}const U=this._sourcesDirty||this._styleDirty||this._placementDirty||O;if(U||this._repaint)this.triggerRepaint();else{const j=!this.isMoving()&&this.loaded();if(j&&(O=this._updateAverageElevation(b,!0)),O)this.triggerRepaint();else if(this._triggerFrame(!1),j&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const H=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:H})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||U||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const l of this._markers)v&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!v||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(v,l=!1){const g=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const b=this.transform.averageElevation;let I=this.transform.sampleAverageElevation(),A=!1;this.transform.elevation&&(A=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(I)?I=0:this._averageElevationLastSampledAt=v;const O=Math.abs(b-I);if(O>1){if(this._isInitialLoad||A)return this._averageElevation.jumpTo(I),g(I);this._averageElevation.easeTo(I,v,300)}else if(O>1e-4)return this._averageElevation.jumpTo(I),g(I)}return!!this._averageElevation.isEasing(v)&&g(this._averageElevation.getValue(v))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===p.AUTH_ERR_MSG||401===v.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof _u&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const g=this.painter.context.gl,b=g.createFramebuffer();function I(A){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,A,0);const O=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,O),O}return g.bindFramebuffer(g.FRAMEBUFFER,b),this._canvasPixelComparison(I(v),l.canvasCopies.map(I),l.timeStamps)}_canvasPixelComparison(v,l,g){let b=g[1]-g[0];const I=v.length/4;for(let A=0;A<l.length;A++){const O=l[A];let U=0;for(let j=0;j<O.length;j+=4)O[j]===v[j]&&O[j+1]===v[j+1]&&O[j+2]===v[j+2]&&O[j+3]===v[j+3]&&(U+=1);b+=(g[A+2]-g[A+1])*(1-U/I)}return b}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Df(this._canvasContainer),Df(this._controlContainer),Df(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(l)}))}_preloadTiles(v){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(g,b)=>g._preloadTiles(v,b),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,v&&this._update())}_setCacheLimits(v,l){p.setCacheLimits(v,l)}get version(){return p.version}},NavigationControl:class{constructor(v){this.options=p.extend({},qp,v),this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),Lt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),Lt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:l}):g.resetNorth({},{originalEvent:l}))}),this._compassIcon=Lt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const l=v.getZoom(),g=l===v.getMaxZoom(),b=l===v.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Hp(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,l){const g=Lt("button",v,this._container);return g.type="button",g.addEventListener("click",l),g}_setButtonTitle(v,l){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",g),v.firstElementChild&&v.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends p.Evented{constructor(v){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},cd,v),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=sc(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const l=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,v(g)};void 0!==this._supportsGeolocation?v(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(g=>l("denied"!==g.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),g=v.coords;return!!l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(v),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",v)),this._finish()}}_updateCamera(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude),g=v.coords.accuracy,b=this._map.getBearing(),I=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(g),I,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,l=p.mercatorZfromAltitude(1,v._center.lat)*v.worldSize,g=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(1===v.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===v.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=Lt("button","mapboxgl-ctrl-geolocate",this._container),Lt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===v){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Lt("div","mapboxgl-user-location"),this._dotElement.appendChild(Lt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Lt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Mf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Lt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:!0===v.absolute&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ra,ScaleControl:class{constructor(v){this.options=p.extend({},Af,v),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Qd.bind(this)),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,l=this._map,g=l._containerHeight/2,b=l._containerWidth/2-v/2,I=l.unproject([b,g]),A=l.unproject([b+v,g]),O=I.distanceTo(A);if("imperial"===this.options.unit){const U=3.2808*O;U>5280?this._setScale(v,U/5280,"mile"):this._setScale(v,U,"foot")}else"nautical"===this.options.unit?this._setScale(v,O/1852,"nautical-mile"):O>=1e3?this._setScale(v,O/1e3,"kilometer"):this._setScale(v,O,"meter")}_setScale(v,l,g){const b=Xh(l),I=b/l;this._map._requestDomTask(()=>{this._container.style.width=v*I+"px",this._container.innerHTML="nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:g}).format(b):`${b}&nbsp;nm`})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof p.window.HTMLElement?this._container=v.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=Lt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Lt("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(v){super(),this.options=p.extend(Object.create(Mu),v),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=p.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(p.window.document.createTextNode(v))}setHTML(v){const l=p.window.document.createDocumentFragment(),g=p.window.document.createElement("body");let b;for(g.innerHTML=v;b=g.firstChild,b;)l.appendChild(b);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=Lt("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(v),this.options.closeButton){const g=this._closeButton=Lt("button","mapboxgl-popup-close-button",l);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._updateClassList(),l}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._map,g=this._container,b=this._pos;if(!l||!g||!b)return"bottom";const I=g.offsetWidth,A=g.offsetHeight,O=b.x<I/2,U=b.x>l.transform.width-I/2;if(b.y+v<A)return O?"top-left":U?"top-right":"top";if(b.y>l.transform.height-A){if(O)return"bottom-left";if(U)return"bottom-right"}return O?"left":U?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),v.className=l.join(" ")}_update(v){const l=this._map,g=this._content;if(!l||!this._lngLat&&!this._trackPointer||!g)return;let b=this._container;if(b||(b=this._container=Lt("div","mapboxgl-popup",l.getContainer()),this._tip=Lt("div","mapboxgl-popup-tip",b),b.appendChild(g)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Tf(this._lngLat,this._pos,l.transform)),!this._trackPointer||v){const I=this._pos=this._trackPointer&&v?v:l.project(this._lngLat),A=ld(this.options.offset),O=this._anchor=this._getAnchor(A.y),U=ld(this.options.offset,O),j=I.add(U).round();l._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Kd[O]} translate(${j.x}px,${j.y}px)`)})}if(!this._marker&&l._showingGlobe()){const I=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(I)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(cc);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:Mf,Style:Fs,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:ll,Evented:p.Evented,config:p.config,prewarm:function(){Mr().acquire(rr)},clearPrewarmedResources:function(){const v=ir;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(rr),ir=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(v){p.config.ACCESS_TOKEN=v},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(v){p.config.API_URL=v},get workerCount(){return cr.workerCount},set workerCount(v){cr.workerCount=v},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){p.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){p.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Pf}),Te}()},5943:xn=>{"use strict";var It=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Te=Object.prototype.propertyIsEnumerable;function Ue(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}xn.exports=function ft(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var Ce={},We=0;We<10;We++)Ce["_"+String.fromCharCode(We)]=We;if("0123456789"!==Object.getOwnPropertyNames(Ce).map(function(Lt){return Ce[Lt]}).join(""))return!1;var yt={};return"abcdefghijklmnopqrst".split("").forEach(function(Lt){yt[Lt]=Lt}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},yt)).join("")}catch{return!1}}()?Object.assign:function(p,Ce){for(var We,yt,dt=Ue(p),Lt=1;Lt<arguments.length;Lt++){for(var un in We=Object(arguments[Lt]))He.call(We,un)&&(dt[un]=We[un]);if(It){yt=It(We);for(var Gt=0;Gt<yt.length;Gt++)Te.call(We,yt[Gt])&&(dt[yt[Gt]]=We[yt[Gt]])}}return dt}},1175:xn=>{"use strict";var It=function(He){return He!=He};xn.exports=function(Te,Ue){return 0===Te&&0===Ue?1/Te==1/Ue:!!(Te===Ue||It(Te)&&It(Ue))}},2e3:(xn,It,He)=>{"use strict";var Te=He(2358),Ue=He(5685),ft=He(1175),p=He(6305),Ce=He(3859),We=Ue(p(),Object);Te(We,{getPolyfill:p,implementation:ft,shim:Ce}),xn.exports=We},6305:(xn,It,He)=>{"use strict";var Te=He(1175);xn.exports=function(){return"function"==typeof Object.is?Object.is:Te}},3859:(xn,It,He)=>{"use strict";var Te=He(6305),Ue=He(2358);xn.exports=function(){var p=Te();return Ue(Object,{is:p},{is:function(){return Object.is!==p}}),p}},2450:(xn,It,He)=>{"use strict";var Te;if(!Object.keys){var Ue=Object.prototype.hasOwnProperty,ft=Object.prototype.toString,p=He(9978),Ce=Object.prototype.propertyIsEnumerable,We=!Ce.call({toString:null},"toString"),dt=Ce.call(function(){},"prototype"),yt=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Lt=function(Xt){var Dn=Xt.constructor;return Dn&&Dn.prototype===Xt},un={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Gt=function(){if(typeof window>"u")return!1;for(var Xt in window)try{if(!un["$"+Xt]&&Ue.call(window,Xt)&&null!==window[Xt]&&"object"==typeof window[Xt])try{Lt(window[Xt])}catch{return!0}}catch{return!0}return!1}();Te=function(Dn){var ge=null!==Dn&&"object"==typeof Dn,Me="[object Function]"===ft.call(Dn),de=p(Dn),Q=ge&&"[object String]"===ft.call(Dn),fe=[];if(!ge&&!Me&&!de)throw new TypeError("Object.keys called on a non-object");var ze=dt&&Me;if(Q&&Dn.length>0&&!Ue.call(Dn,0))for(var pe=0;pe<Dn.length;++pe)fe.push(String(pe));if(de&&Dn.length>0)for(var le=0;le<Dn.length;++le)fe.push(String(le));else for(var we in Dn)(!ze||"prototype"!==we)&&Ue.call(Dn,we)&&fe.push(String(we));if(We)for(var J=function(Xt){if(typeof window>"u"||!Gt)return Lt(Xt);try{return Lt(Xt)}catch{return!1}}(Dn),_t=0;_t<yt.length;++_t)(!J||"constructor"!==yt[_t])&&Ue.call(Dn,yt[_t])&&fe.push(yt[_t]);return fe}}xn.exports=Te},1356:(xn,It,He)=>{"use strict";var Te=Array.prototype.slice,Ue=He(9978),ft=Object.keys,p=ft?function(dt){return ft(dt)}:He(2450),Ce=Object.keys;p.shim=function(){if(Object.keys){var dt=function(){var yt=Object.keys(arguments);return yt&&yt.length===arguments.length}(1,2);dt||(Object.keys=function(Lt){return Ue(Lt)?Ce(Te.call(Lt)):Ce(Lt)})}else Object.keys=p;return Object.keys||p},xn.exports=p},9978:xn=>{"use strict";var It=Object.prototype.toString;xn.exports=function(Te){var Ue=It.call(Te),ft="[object Arguments]"===Ue;return ft||(ft="[object Array]"!==Ue&&null!==Te&&"object"==typeof Te&&"number"==typeof Te.length&&Te.length>=0&&"[object Function]"===It.call(Te.callee)),ft}},1766:xn=>{xn.exports=function(He,Te,Ue,ft){var p=He[0],Ce=He[1],We=!1;void 0===Ue&&(Ue=0),void 0===ft&&(ft=Te.length);for(var dt=(ft-Ue)/2,yt=0,Lt=dt-1;yt<dt;Lt=yt++){var un=Te[Ue+2*yt+0],Gt=Te[Ue+2*yt+1],Xt=Te[Ue+2*Lt+1];Gt>Ce!=Xt>Ce&&p<(Te[Ue+2*Lt+0]-un)*(Ce-Gt)/(Xt-Gt)+un&&(We=!We)}return We}},3870:(xn,It,He)=>{var Te=He(1766),Ue=He(2260);xn.exports=function(p,Ce,We,dt){return Ce.length>0&&Array.isArray(Ce[0])?Ue(p,Ce,We,dt):Te(p,Ce,We,dt)},xn.exports.nested=Ue,xn.exports.flat=Te},2260:xn=>{xn.exports=function(He,Te,Ue,ft){var p=He[0],Ce=He[1],We=!1;void 0===Ue&&(Ue=0),void 0===ft&&(ft=Te.length);for(var dt=ft-Ue,yt=0,Lt=dt-1;yt<dt;Lt=yt++){var un=Te[yt+Ue][0],Gt=Te[yt+Ue][1],Xt=Te[Lt+Ue][1];Gt>Ce!=Xt>Ce&&p<(Te[Lt+Ue][0]-un)*(Ce-Gt)/(Xt-Gt)+un&&(We=!We)}return We}},9855:function(xn){xn.exports=function(){"use strict";function It(St,ve){if(!(St instanceof ve))throw new TypeError("Cannot call a class as a function")}function He(St,ve){for(var me=0;me<ve.length;me++){var se=ve[me];se.enumerable=se.enumerable||!1,se.configurable=!0,"value"in se&&(se.writable=!0),Object.defineProperty(St,se.key,se)}}function Te(St,ve,me){return ve&&He(St.prototype,ve),me&&He(St,me),St}var Ue=function St(ve,me){this.next=null,this.key=ve,this.data=me,this.left=null,this.right=null};function ft(St,ve){return St>ve?1:St<ve?-1:0}function p(St,ve,me){for(var se=new Ue(null,null),Ve=se,mt=se;;){var qt=me(St,ve.key);if(qt<0){if(null===ve.left)break;if(me(St,ve.left.key)<0&&(ve.left=(pn=ve.left).right,pn.right=ve,null===(ve=pn).left))break;mt.left=ve,mt=ve,ve=ve.left}else{if(!(qt>0))break;if(null===ve.right)break;var pn;if(me(St,ve.right.key)>0&&(ve.right=(pn=ve.right).left,pn.left=ve,null===(ve=pn).right))break;Ve.right=ve,Ve=ve,ve=ve.right}}return Ve.right=ve.left,mt.left=ve.right,ve.left=se.right,ve.right=se.left,ve}function Ce(St,ve,me,se){var Ve=new Ue(St,ve);if(null===me)return Ve.left=Ve.right=null,Ve;var mt=se(St,(me=p(St,me,se)).key);return mt<0?(Ve.left=me.left,Ve.right=me,me.left=null):mt>=0&&(Ve.right=me.right,Ve.left=me,me.right=null),Ve}function We(St,ve,me){var se=null,Ve=null;if(ve){var mt=me((ve=p(St,ve,me)).key,St);0===mt?(se=ve.left,Ve=ve.right):mt<0?(Ve=ve.right,ve.right=null,se=ve):(se=ve.left,ve.left=null,Ve=ve)}return{left:se,right:Ve}}function yt(St,ve,me,se,Ve){if(St){se(ve+(me?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+Ve(St)+"\n");var mt=ve+(me?"    ":"\u2502   ");St.left&&yt(St.left,mt,!1,se,Ve),St.right&&yt(St.right,mt,!0,se,Ve)}}var Lt=function(){function St(ve){void 0===ve&&(ve=ft),this._root=null,this._size=0,this._comparator=ve}return St.prototype.insert=function(ve,me){return this._size++,this._root=Ce(ve,me,this._root,this._comparator)},St.prototype.add=function(ve,me){var se=new Ue(ve,me);null===this._root&&(se.left=se.right=null,this._size++,this._root=se);var Ve=this._comparator,mt=p(ve,this._root,Ve),qt=Ve(ve,mt.key);return 0===qt?this._root=mt:(qt<0?(se.left=mt.left,se.right=mt,mt.left=null):qt>0&&(se.right=mt.right,se.left=mt,mt.right=null),this._size++,this._root=se),this._root},St.prototype.remove=function(ve){this._root=this._remove(ve,this._root,this._comparator)},St.prototype._remove=function(ve,me,se){var Ve;return null===me?null:0===se(ve,(me=p(ve,me,se)).key)?(null===me.left?Ve=me.right:(Ve=p(ve,me.left,se)).right=me.right,this._size--,Ve):me},St.prototype.pop=function(){var ve=this._root;if(ve){for(;ve.left;)ve=ve.left;return this._root=p(ve.key,this._root,this._comparator),this._root=this._remove(ve.key,this._root,this._comparator),{key:ve.key,data:ve.data}}return null},St.prototype.findStatic=function(ve){for(var me=this._root,se=this._comparator;me;){var Ve=se(ve,me.key);if(0===Ve)return me;me=Ve<0?me.left:me.right}return null},St.prototype.find=function(ve){return this._root&&(this._root=p(ve,this._root,this._comparator),0!==this._comparator(ve,this._root.key))?null:this._root},St.prototype.contains=function(ve){for(var me=this._root,se=this._comparator;me;){var Ve=se(ve,me.key);if(0===Ve)return!0;me=Ve<0?me.left:me.right}return!1},St.prototype.forEach=function(ve,me){for(var se=this._root,Ve=[],mt=!1;!mt;)null!==se?(Ve.push(se),se=se.left):0!==Ve.length?(se=Ve.pop(),ve.call(me,se),se=se.right):mt=!0;return this},St.prototype.range=function(ve,me,se,Ve){for(var mt=[],qt=this._comparator,pn=this._root;0!==mt.length||pn;)if(pn)mt.push(pn),pn=pn.left;else{if(qt((pn=mt.pop()).key,me)>0)break;if(qt(pn.key,ve)>=0&&se.call(Ve,pn))return this;pn=pn.right}return this},St.prototype.keys=function(){var ve=[];return this.forEach(function(me){return ve.push(me.key)}),ve},St.prototype.values=function(){var ve=[];return this.forEach(function(me){return ve.push(me.data)}),ve},St.prototype.min=function(){return this._root?this.minNode(this._root).key:null},St.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},St.prototype.minNode=function(ve){if(void 0===ve&&(ve=this._root),ve)for(;ve.left;)ve=ve.left;return ve},St.prototype.maxNode=function(ve){if(void 0===ve&&(ve=this._root),ve)for(;ve.right;)ve=ve.right;return ve},St.prototype.at=function(ve){for(var me=this._root,se=!1,Ve=0,mt=[];!se;)if(me)mt.push(me),me=me.left;else if(mt.length>0){if(me=mt.pop(),Ve===ve)return me;Ve++,me=me.right}else se=!0;return null},St.prototype.next=function(ve){var me=this._root,se=null;if(ve.right){for(se=ve.right;se.left;)se=se.left;return se}for(var Ve=this._comparator;me;){var mt=Ve(ve.key,me.key);if(0===mt)break;mt<0?(se=me,me=me.left):me=me.right}return se},St.prototype.prev=function(ve){var me=this._root,se=null;if(null!==ve.left){for(se=ve.left;se.right;)se=se.right;return se}for(var Ve=this._comparator;me;){var mt=Ve(ve.key,me.key);if(0===mt)break;mt<0?me=me.left:(se=me,me=me.right)}return se},St.prototype.clear=function(){return this._root=null,this._size=0,this},St.prototype.toList=function(){return function Tt(St){for(var ve=St,me=[],se=!1,Ve=new Ue(null,null),mt=Ve;!se;)ve?(me.push(ve),ve=ve.left):me.length>0?ve=(ve=mt=mt.next=me.pop()).right:se=!0;return mt.next=null,Ve.next}(this._root)},St.prototype.load=function(ve,me,se){void 0===me&&(me=[]),void 0===se&&(se=!1);var Ve=ve.length,mt=this._comparator;if(se&&ge(ve,me,0,Ve-1,mt),null===this._root)this._root=un(ve,me,0,Ve),this._size=Ve;else{var qt=function Dn(St,ve,me){for(var se=new Ue(null,null),Ve=se,mt=St,qt=ve;null!==mt&&null!==qt;)me(mt.key,qt.key)<0?(Ve.next=mt,mt=mt.next):(Ve.next=qt,qt=qt.next),Ve=Ve.next;return null!==mt?Ve.next=mt:null!==qt&&(Ve.next=qt),se.next}(this.toList(),function Gt(St,ve){for(var me=new Ue(null,null),se=me,Ve=0;Ve<St.length;Ve++)se=se.next=new Ue(St[Ve],ve[Ve]);return se.next=null,me.next}(ve,me),mt);this._root=Xt({head:qt},0,Ve=this._size+Ve)}return this},St.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(St.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(St.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),St.prototype.toString=function(ve){void 0===ve&&(ve=function(Ve){return String(Ve.key)});var me=[];return yt(this._root,"",!0,function(se){return me.push(se)},ve),me.join("")},St.prototype.update=function(ve,me,se){var Ve=this._comparator,mt=We(ve,this._root,Ve),qt=mt.left,pn=mt.right;Ve(ve,me)<0?pn=Ce(me,se,pn,Ve):qt=Ce(me,se,qt,Ve),this._root=function dt(St,ve,me){return null===ve?St:(null===St||((ve=p(St.key,ve,me)).left=St),ve)}(qt,pn,Ve)},St.prototype.split=function(ve){return We(ve,this._root,this._comparator)},St}();function un(St,ve,me,se){var Ve=se-me;if(Ve>0){var mt=me+Math.floor(Ve/2),yn=new Ue(St[mt],ve[mt]);return yn.left=un(St,ve,me,mt),yn.right=un(St,ve,mt+1,se),yn}return null}function Xt(St,ve,me){var se=me-ve;if(se>0){var Ve=ve+Math.floor(se/2),mt=Xt(St,ve,Ve),qt=St.head;return qt.left=mt,St.head=St.head.next,qt.right=Xt(St,Ve+1,me),qt}return null}function ge(St,ve,me,se,Ve){if(!(me>=se)){for(var mt=St[me+se>>1],qt=me-1,pn=se+1;;){do{qt++}while(Ve(St[qt],mt)<0);do{pn--}while(Ve(St[pn],mt)>0);if(qt>=pn)break;var yn=St[qt];St[qt]=St[pn],St[pn]=yn,yn=ve[qt],ve[qt]=ve[pn],ve[pn]=yn}ge(St,ve,me,pn,Ve),ge(St,ve,pn+1,se,Ve)}}var Me=function(ve,me){return ve.ll.x<=me.x&&me.x<=ve.ur.x&&ve.ll.y<=me.y&&me.y<=ve.ur.y},de=function(ve,me){return me.ur.x<ve.ll.x||ve.ur.x<me.ll.x||me.ur.y<ve.ll.y||ve.ur.y<me.ll.y?null:{ll:{x:ve.ll.x<me.ll.x?me.ll.x:ve.ll.x,y:ve.ll.y<me.ll.y?me.ll.y:ve.ll.y},ur:{x:ve.ur.x<me.ur.x?ve.ur.x:me.ur.x,y:ve.ur.y<me.ur.y?ve.ur.y:me.ur.y}}},Q=Number.EPSILON;void 0===Q&&(Q=Math.pow(2,-52));var fe=Q*Q,ze=function(ve,me){if(-Q<ve&&ve<Q&&-Q<me&&me<Q)return 0;var se=ve-me;return se*se<fe*ve*me?0:ve<me?-1:1},pe=function(){function St(){It(this,St),this.reset()}return Te(St,[{key:"reset",value:function(){this.xRounder=new le,this.yRounder=new le}},{key:"round",value:function(me,se){return{x:this.xRounder.round(me),y:this.yRounder.round(se)}}}]),St}(),le=function(){function St(){It(this,St),this.tree=new Lt,this.round(0)}return Te(St,[{key:"round",value:function(me){var se=this.tree.add(me),Ve=this.tree.prev(se);if(null!==Ve&&0===ze(se.key,Ve.key))return this.tree.remove(me),Ve.key;var mt=this.tree.next(se);return null!==mt&&0===ze(se.key,mt.key)?(this.tree.remove(me),mt.key):me}}]),St}(),we=new pe,J=function(ve,me){return ve.x*me.y-ve.y*me.x},_t=function(ve,me){return ve.x*me.x+ve.y*me.y},Ge=function(ve,me,se){var qt=J({x:me.x-ve.x,y:me.y-ve.y},{x:se.x-ve.x,y:se.y-ve.y});return ze(qt,0)},$e=function(ve){return Math.sqrt(_t(ve,ve))},ue=function(ve,me,se){var Ve={x:me.x-ve.x,y:me.y-ve.y},mt={x:se.x-ve.x,y:se.y-ve.y};return J(mt,Ve)/$e(mt)/$e(Ve)},on=function(ve,me,se){var Ve={x:me.x-ve.x,y:me.y-ve.y},mt={x:se.x-ve.x,y:se.y-ve.y};return _t(mt,Ve)/$e(mt)/$e(Ve)},kt=function(ve,me,se){return 0===me.y?null:{x:ve.x+me.x/me.y*(se-ve.y),y:se}},Ne=function(ve,me,se){return 0===me.x?null:{x:se,y:ve.y+me.y/me.x*(se-ve.x)}},Ee=function(){function St(ve,me){It(this,St),void 0===ve.events?ve.events=[this]:ve.events.push(this),this.point=ve,this.isLeft=me}return Te(St,null,[{key:"compare",value:function(me,se){var Ve=St.comparePoints(me.point,se.point);return 0!==Ve?Ve:(me.point!==se.point&&me.link(se),me.isLeft!==se.isLeft?me.isLeft?1:-1:vt.compare(me.segment,se.segment))}},{key:"comparePoints",value:function(me,se){return me.x<se.x?-1:me.x>se.x?1:me.y<se.y?-1:me.y>se.y?1:0}}]),Te(St,[{key:"link",value:function(me){if(me.point===this.point)throw new Error("Tried to link already linked events");for(var se=me.point.events,Ve=0,mt=se.length;Ve<mt;Ve++){var qt=se[Ve];this.point.events.push(qt),qt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var me=this.point.events.length,se=0;se<me;se++){var Ve=this.point.events[se];if(void 0===Ve.segment.consumedBy)for(var mt=se+1;mt<me;mt++){var qt=this.point.events[mt];void 0===qt.consumedBy&&Ve.otherSE.point.events===qt.otherSE.point.events&&Ve.segment.consume(qt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var me=[],se=0,Ve=this.point.events.length;se<Ve;se++){var mt=this.point.events[se];mt!==this&&!mt.segment.ringOut&&mt.segment.isInResult()&&me.push(mt)}return me}},{key:"getLeftmostComparator",value:function(me){var se=this,Ve=new Map,mt=function(pn){var yn=pn.otherSE;Ve.set(pn,{sine:ue(se.point,me.point,yn.point),cosine:on(se.point,me.point,yn.point)})};return function(qt,pn){Ve.has(qt)||mt(qt),Ve.has(pn)||mt(pn);var yn=Ve.get(qt),Kt=yn.sine,Pr=yn.cosine,lr=Ve.get(pn),On=lr.sine,Lr=lr.cosine;return Kt>=0&&On>=0?Pr<Lr?1:Pr>Lr?-1:0:Kt<0&&On<0?Pr<Lr?-1:Pr>Lr?1:0:On<Kt?-1:On>Kt?1:0}}}]),St}(),it=0,vt=function(){function St(ve,me,se,Ve){It(this,St),this.id=++it,this.leftSE=ve,ve.segment=this,ve.otherSE=me,this.rightSE=me,me.segment=this,me.otherSE=ve,this.rings=se,this.windings=Ve}return Te(St,null,[{key:"compare",value:function(me,se){var Ve=me.leftSE.point.x,mt=se.leftSE.point.x,qt=me.rightSE.point.x,pn=se.rightSE.point.x;if(pn<Ve)return 1;if(qt<mt)return-1;var yn=me.leftSE.point.y,Kt=se.leftSE.point.y,Pr=me.rightSE.point.y,lr=se.rightSE.point.y;if(Ve<mt){if(Kt<yn&&Kt<Pr)return 1;if(Kt>yn&&Kt>Pr)return-1;var On=me.comparePoint(se.leftSE.point);if(On<0)return 1;if(On>0)return-1;var Lr=se.comparePoint(me.rightSE.point);return 0!==Lr?Lr:-1}if(Ve>mt){if(yn<Kt&&yn<lr)return-1;if(yn>Kt&&yn>lr)return 1;var _i=se.comparePoint(me.leftSE.point);if(0!==_i)return _i;var vi=me.comparePoint(se.rightSE.point);return vi<0?1:vi>0?-1:1}if(yn<Kt)return-1;if(yn>Kt)return 1;if(qt<pn){var Pi=se.comparePoint(me.rightSE.point);if(0!==Pi)return Pi}if(qt>pn){var Ri=me.comparePoint(se.rightSE.point);if(Ri<0)return 1;if(Ri>0)return-1}if(qt!==pn){var Sr=Pr-yn,ds=qt-Ve,Ko=lr-Kt,Ns=pn-mt;if(Sr>ds&&Ko<Ns)return 1;if(Sr<ds&&Ko>Ns)return-1}return qt>pn?1:qt<pn||Pr<lr?-1:Pr>lr?1:me.id<se.id?-1:me.id>se.id?1:0}}]),Te(St,[{key:"replaceRightSE",value:function(me){this.rightSE=me,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var me=this.leftSE.point.y,se=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:me<se?me:se},ur:{x:this.rightSE.point.x,y:me>se?me:se}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(me){return me.x===this.leftSE.point.x&&me.y===this.leftSE.point.y||me.x===this.rightSE.point.x&&me.y===this.rightSE.point.y}},{key:"comparePoint",value:function(me){if(this.isAnEndpoint(me))return 0;var se=this.leftSE.point,Ve=this.rightSE.point,mt=this.vector();if(se.x===Ve.x)return me.x===se.x?0:me.x<se.x?1:-1;if(me.x===se.x+(me.y-se.y)/mt.y*mt.x)return 0;var Kt=se.y+(me.x-se.x)/mt.x*mt.y;return me.y===Kt?0:me.y<Kt?-1:1}},{key:"getIntersection",value:function(me){var se=this.bbox(),Ve=me.bbox(),mt=de(se,Ve);if(null===mt)return null;var qt=this.leftSE.point,pn=this.rightSE.point,yn=me.leftSE.point,Kt=me.rightSE.point,Pr=Me(se,yn)&&0===this.comparePoint(yn),lr=Me(Ve,qt)&&0===me.comparePoint(qt),On=Me(se,Kt)&&0===this.comparePoint(Kt),Lr=Me(Ve,pn)&&0===me.comparePoint(pn);if(lr&&Pr)return Lr&&!On?pn:!Lr&&On?Kt:null;if(lr)return On&&qt.x===Kt.x&&qt.y===Kt.y?null:qt;if(Pr)return Lr&&pn.x===yn.x&&pn.y===yn.y?null:yn;if(Lr&&On)return null;if(Lr)return pn;if(On)return Kt;var _i=function(ve,me,se,Ve){if(0===me.x)return Ne(se,Ve,ve.x);if(0===Ve.x)return Ne(ve,me,se.x);if(0===me.y)return kt(se,Ve,ve.y);if(0===Ve.y)return kt(ve,me,se.y);var mt=J(me,Ve);if(0==mt)return null;var qt={x:se.x-ve.x,y:se.y-ve.y},pn=J(qt,me)/mt,yn=J(qt,Ve)/mt;return{x:(ve.x+yn*me.x+(se.x+pn*Ve.x))/2,y:(ve.y+yn*me.y+(se.y+pn*Ve.y))/2}}(qt,this.vector(),yn,me.vector());return null!==_i&&Me(mt,_i)?we.round(_i.x,_i.y):null}},{key:"split",value:function(me){var se=[],Ve=void 0!==me.events,mt=new Ee(me,!0),qt=new Ee(me,!1),pn=this.rightSE;this.replaceRightSE(qt),se.push(qt),se.push(mt);var yn=new St(mt,pn,this.rings.slice(),this.windings.slice());return Ee.comparePoints(yn.leftSE.point,yn.rightSE.point)>0&&yn.swapEvents(),Ee.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),Ve&&(mt.checkForConsuming(),qt.checkForConsuming()),se}},{key:"swapEvents",value:function(){var me=this.rightSE;this.rightSE=this.leftSE,this.leftSE=me,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var se=0,Ve=this.windings.length;se<Ve;se++)this.windings[se]*=-1}},{key:"consume",value:function(me){for(var se=this,Ve=me;se.consumedBy;)se=se.consumedBy;for(;Ve.consumedBy;)Ve=Ve.consumedBy;var mt=St.compare(se,Ve);if(0!==mt){if(mt>0){var qt=se;se=Ve,Ve=qt}if(se.prev===Ve){var pn=se;se=Ve,Ve=pn}for(var yn=0,Kt=Ve.rings.length;yn<Kt;yn++){var Pr=Ve.rings[yn],lr=Ve.windings[yn],On=se.rings.indexOf(Pr);-1===On?(se.rings.push(Pr),se.windings.push(lr)):se.windings[On]+=lr}Ve.rings=null,Ve.windings=null,Ve.consumedBy=se,Ve.leftSE.consumedBy=se.leftSE,Ve.rightSE.consumedBy=se.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var me=this.beforeState();this._afterState={rings:me.rings.slice(0),windings:me.windings.slice(0),multiPolys:[]};for(var se=this._afterState.rings,Ve=this._afterState.windings,mt=this._afterState.multiPolys,qt=0,pn=this.rings.length;qt<pn;qt++){var yn=this.rings[qt],Kt=this.windings[qt],Pr=se.indexOf(yn);-1===Pr?(se.push(yn),Ve.push(Kt)):Ve[Pr]+=Kt}for(var lr=[],On=[],Lr=0,_i=se.length;Lr<_i;Lr++)if(0!==Ve[Lr]){var vi=se[Lr],Pi=vi.poly;if(-1===On.indexOf(Pi))if(vi.isExterior)lr.push(Pi);else{-1===On.indexOf(Pi)&&On.push(Pi);var Ri=lr.indexOf(vi.poly);-1!==Ri&&lr.splice(Ri,1)}}for(var Sr=0,ds=lr.length;Sr<ds;Sr++){var Ko=lr[Sr].multiPoly;-1===mt.indexOf(Ko)&&mt.push(Ko)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var me=this.beforeState().multiPolys,se=this.afterState().multiPolys;switch(wn.type){case"union":this._isInResult=0===me.length!=(0===se.length);break;case"intersection":var qt,pn;me.length<se.length?(qt=me.length,pn=se.length):(qt=se.length,pn=me.length),this._isInResult=pn===wn.numMultiPolys&&qt<pn;break;case"xor":var yn=Math.abs(me.length-se.length);this._isInResult=yn%2==1;break;case"difference":var Kt=function(lr){return 1===lr.length&&lr[0].isSubject};this._isInResult=Kt(me)!==Kt(se);break;default:throw new Error("Unrecognized operation type found ".concat(wn.type))}return this._isInResult}}],[{key:"fromRing",value:function(me,se,Ve){var mt,qt,pn,yn=Ee.comparePoints(me,se);if(yn<0)mt=me,qt=se,pn=1;else{if(!(yn>0))throw new Error("Tried to create degenerate segment at [".concat(me.x,", ").concat(me.y,"]"));mt=se,qt=me,pn=-1}return new St(new Ee(mt,!0),new Ee(qt,!1),[Ve],[pn])}}]),St}(),Re=function(){function St(ve,me,se){if(It(this,St),!Array.isArray(ve)||0===ve.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=me,this.isExterior=se,this.segments=[],"number"!=typeof ve[0][0]||"number"!=typeof ve[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var Ve=we.round(ve[0][0],ve[0][1]);this.bbox={ll:{x:Ve.x,y:Ve.y},ur:{x:Ve.x,y:Ve.y}};for(var mt=Ve,qt=1,pn=ve.length;qt<pn;qt++){if("number"!=typeof ve[qt][0]||"number"!=typeof ve[qt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var yn=we.round(ve[qt][0],ve[qt][1]);yn.x===mt.x&&yn.y===mt.y||(this.segments.push(vt.fromRing(mt,yn,this)),yn.x<this.bbox.ll.x&&(this.bbox.ll.x=yn.x),yn.y<this.bbox.ll.y&&(this.bbox.ll.y=yn.y),yn.x>this.bbox.ur.x&&(this.bbox.ur.x=yn.x),yn.y>this.bbox.ur.y&&(this.bbox.ur.y=yn.y),mt=yn)}(Ve.x!==mt.x||Ve.y!==mt.y)&&this.segments.push(vt.fromRing(mt,Ve,this))}return Te(St,[{key:"getSweepEvents",value:function(){for(var me=[],se=0,Ve=this.segments.length;se<Ve;se++){var mt=this.segments[se];me.push(mt.leftSE),me.push(mt.rightSE)}return me}}]),St}(),Yt=function(){function St(ve,me){if(It(this,St),!Array.isArray(ve))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Re(ve[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var se=1,Ve=ve.length;se<Ve;se++){var mt=new Re(ve[se],this,!1);mt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=mt.bbox.ll.x),mt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=mt.bbox.ll.y),mt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=mt.bbox.ur.x),mt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=mt.bbox.ur.y),this.interiorRings.push(mt)}this.multiPoly=me}return Te(St,[{key:"getSweepEvents",value:function(){for(var me=this.exteriorRing.getSweepEvents(),se=0,Ve=this.interiorRings.length;se<Ve;se++)for(var mt=this.interiorRings[se].getSweepEvents(),qt=0,pn=mt.length;qt<pn;qt++)me.push(mt[qt]);return me}}]),St}(),$t=function(){function St(ve,me){if(It(this,St),!Array.isArray(ve))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof ve[0][0][0]&&(ve=[ve])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var se=0,Ve=ve.length;se<Ve;se++){var mt=new Yt(ve[se],this);mt.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=mt.bbox.ll.x),mt.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=mt.bbox.ll.y),mt.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=mt.bbox.ur.x),mt.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=mt.bbox.ur.y),this.polys.push(mt)}this.isSubject=me}return Te(St,[{key:"getSweepEvents",value:function(){for(var me=[],se=0,Ve=this.polys.length;se<Ve;se++)for(var mt=this.polys[se].getSweepEvents(),qt=0,pn=mt.length;qt<pn;qt++)me.push(mt[qt]);return me}}]),St}(),Mn=function(){function St(ve){It(this,St),this.events=ve;for(var me=0,se=ve.length;me<se;me++)ve[me].segment.ringOut=this;this.poly=null}return Te(St,null,[{key:"factory",value:function(me){for(var se=[],Ve=0,mt=me.length;Ve<mt;Ve++){var qt=me[Ve];if(qt.isInResult()&&!qt.ringOut){for(var pn=null,yn=qt.leftSE,Kt=qt.rightSE,Pr=[yn],lr=yn.point,On=[];pn=yn,Pr.push(yn=Kt),yn.point!==lr;)for(;;){var Lr=yn.getAvailableLinkedEvents();if(0===Lr.length){var _i=Pr[0].point,vi=Pr[Pr.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(_i.x,",")+" ".concat(_i.y,"]. Last matching segment found ends at")+" [".concat(vi.x,", ").concat(vi.y,"]."))}if(1===Lr.length){Kt=Lr[0].otherSE;break}for(var Pi=null,Ri=0,Sr=On.length;Ri<Sr;Ri++)if(On[Ri].point===yn.point){Pi=Ri;break}if(null===Pi){On.push({index:Pr.length,point:yn.point});var Ns=yn.getLeftmostComparator(pn);Kt=Lr.sort(Ns)[0].otherSE;break}var ds=On.splice(Pi)[0],Ko=Pr.splice(ds.index);Ko.unshift(Ko[0].otherSE),se.push(new St(Ko.reverse()))}se.push(new St(Pr))}}return se}}]),Te(St,[{key:"getGeom",value:function(){for(var me=this.events[0].point,se=[me],Ve=1,mt=this.events.length-1;Ve<mt;Ve++){var qt=this.events[Ve].point;0!==Ge(qt,me,this.events[Ve+1].point)&&(se.push(qt),me=qt)}if(1===se.length)return null;0===Ge(se[0],me,se[1])&&se.shift(),se.push(se[0]);for(var Pr=this.isExteriorRing()?1:-1,lr=this.isExteriorRing()?0:se.length-1,On=this.isExteriorRing()?se.length:-1,Lr=[],_i=lr;_i!=On;_i+=Pr)Lr.push([se[_i].x,se[_i].y]);return Lr}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var me=this.enclosingRing();this._isExteriorRing=!me||!me.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var me=this.events[0],se=1,Ve=this.events.length;se<Ve;se++){var mt=this.events[se];Ee.compare(me,mt)>0&&(me=mt)}for(var qt=me.segment.prevInResult(),pn=qt?qt.prevInResult():null;;){if(!qt)return null;if(!pn)return qt.ringOut;if(pn.ringOut!==qt.ringOut)return pn.ringOut.enclosingRing()!==qt.ringOut?qt.ringOut:qt.ringOut.enclosingRing();qt=pn.prevInResult(),pn=qt?qt.prevInResult():null}}}]),St}(),jt=function(){function St(ve){It(this,St),this.exteriorRing=ve,ve.poly=this,this.interiorRings=[]}return Te(St,[{key:"addInterior",value:function(me){this.interiorRings.push(me),me.poly=this}},{key:"getGeom",value:function(){var me=[this.exteriorRing.getGeom()];if(null===me[0])return null;for(var se=0,Ve=this.interiorRings.length;se<Ve;se++){var mt=this.interiorRings[se].getGeom();null!==mt&&me.push(mt)}return me}}]),St}(),Xn=function(){function St(ve){It(this,St),this.rings=ve,this.polys=this._composePolys(ve)}return Te(St,[{key:"getGeom",value:function(){for(var me=[],se=0,Ve=this.polys.length;se<Ve;se++){var mt=this.polys[se].getGeom();null!==mt&&me.push(mt)}return me}},{key:"_composePolys",value:function(me){for(var se=[],Ve=0,mt=me.length;Ve<mt;Ve++){var qt=me[Ve];if(!qt.poly)if(qt.isExteriorRing())se.push(new jt(qt));else{var pn=qt.enclosingRing();pn.poly||se.push(new jt(pn)),pn.poly.addInterior(qt)}}return se}}]),St}(),Qn=function(){function St(ve){var me=arguments.length>1&&void 0!==arguments[1]?arguments[1]:vt.compare;It(this,St),this.queue=ve,this.tree=new Lt(me),this.segments=[]}return Te(St,[{key:"process",value:function(me){var se=me.segment,Ve=[];if(me.consumedBy)return me.isLeft?this.queue.remove(me.otherSE):this.tree.remove(se),Ve;var mt=me.isLeft?this.tree.insert(se):this.tree.find(se);if(!mt)throw new Error("Unable to find segment #".concat(se.id," ")+"[".concat(se.leftSE.point.x,", ").concat(se.leftSE.point.y,"] -> ")+"[".concat(se.rightSE.point.x,", ").concat(se.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var qt=mt,pn=mt,yn=void 0,Kt=void 0;void 0===yn;)null===(qt=this.tree.prev(qt))?yn=null:void 0===qt.key.consumedBy&&(yn=qt.key);for(;void 0===Kt;)null===(pn=this.tree.next(pn))?Kt=null:void 0===pn.key.consumedBy&&(Kt=pn.key);if(me.isLeft){var Pr=null;if(yn){var lr=yn.getIntersection(se);if(null!==lr&&(se.isAnEndpoint(lr)||(Pr=lr),!yn.isAnEndpoint(lr)))for(var On=this._splitSafely(yn,lr),Lr=0,_i=On.length;Lr<_i;Lr++)Ve.push(On[Lr])}var vi=null;if(Kt){var Pi=Kt.getIntersection(se);if(null!==Pi&&(se.isAnEndpoint(Pi)||(vi=Pi),!Kt.isAnEndpoint(Pi)))for(var Ri=this._splitSafely(Kt,Pi),Sr=0,ds=Ri.length;Sr<ds;Sr++)Ve.push(Ri[Sr])}if(null!==Pr||null!==vi){var Ko;Ko=null===Pr?vi:null===vi||Ee.comparePoints(Pr,vi)<=0?Pr:vi,this.queue.remove(se.rightSE),Ve.push(se.rightSE);for(var Ci=se.split(Ko),Ys=0,oi=Ci.length;Ys<oi;Ys++)Ve.push(Ci[Ys])}Ve.length>0?(this.tree.remove(se),Ve.push(me)):(this.segments.push(se),se.prev=yn)}else{if(yn&&Kt){var An=yn.getIntersection(Kt);if(null!==An){if(!yn.isAnEndpoint(An))for(var Ks=this._splitSafely(yn,An),as=0,$r=Ks.length;as<$r;as++)Ve.push(Ks[as]);if(!Kt.isAnEndpoint(An))for(var Ha=this._splitSafely(Kt,An),ns=0,Oe=Ha.length;ns<Oe;ns++)Ve.push(Ha[ns])}}this.tree.remove(se)}return Ve}},{key:"_splitSafely",value:function(me,se){this.tree.remove(me);var Ve=me.rightSE;this.queue.remove(Ve);var mt=me.split(se);return mt.push(Ve),void 0===me.consumedBy&&this.tree.insert(me),mt}}]),St}(),sr=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,kn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,wn=new(function(){function St(){It(this,St)}return Te(St,[{key:"run",value:function(me,se,Ve){wn.type=me,we.reset();for(var mt=[new $t(se,!0)],qt=0,pn=Ve.length;qt<pn;qt++)mt.push(new $t(Ve[qt],!1));if(wn.numMultiPolys=mt.length,"difference"===wn.type)for(var yn=mt[0],Kt=1;Kt<mt.length;)null!==de(mt[Kt].bbox,yn.bbox)?Kt++:mt.splice(Kt,1);if("intersection"===wn.type)for(var Pr=0,lr=mt.length;Pr<lr;Pr++)for(var On=mt[Pr],Lr=Pr+1,_i=mt.length;Lr<_i;Lr++)if(null===de(On.bbox,mt[Lr].bbox))return[];for(var vi=new Lt(Ee.compare),Pi=0,Ri=mt.length;Pi<Ri;Pi++)for(var Sr=mt[Pi].getSweepEvents(),ds=0,Ko=Sr.length;ds<Ko;ds++)if(vi.insert(Sr[ds]),vi.size>sr)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var Ns=new Qn(vi),Ci=vi.size,Ys=vi.pop();Ys;){var oi=Ys.key;if(vi.size===Ci){var An=oi.segment;throw new Error("Unable to pop() ".concat(oi.isLeft?"left":"right"," SweepEvent ")+"[".concat(oi.point.x,", ").concat(oi.point.y,"] from segment #").concat(An.id," ")+"[".concat(An.leftSE.point.x,", ").concat(An.leftSE.point.y,"] -> ")+"[".concat(An.rightSE.point.x,", ").concat(An.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(vi.size>sr)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(Ns.segments.length>kn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ks=Ns.process(oi),as=0,$r=Ks.length;as<$r;as++){var Ha=Ks[as];void 0===Ha.consumedBy&&vi.insert(Ha)}Ci=vi.size,Ys=vi.pop()}we.reset();var ns=Mn.factory(Ns.segments);return new Xn(ns).getGeom()}}]),St}());return{union:function(ve){for(var me=arguments.length,se=new Array(me>1?me-1:0),Ve=1;Ve<me;Ve++)se[Ve-1]=arguments[Ve];return wn.run("union",ve,se)},intersection:function(ve){for(var me=arguments.length,se=new Array(me>1?me-1:0),Ve=1;Ve<me;Ve++)se[Ve-1]=arguments[Ve];return wn.run("intersection",ve,se)},xor:function(ve){for(var me=arguments.length,se=new Array(me>1?me-1:0),Ve=1;Ve<me;Ve++)se[Ve-1]=arguments[Ve];return wn.run("xor",ve,se)},difference:function(ve){for(var me=arguments.length,se=new Array(me>1?me-1:0),Ve=1;Ve<me;Ve++)se[Ve-1]=arguments[Ve];return wn.run("difference",ve,se)}}}()},3544:(xn,It,He)=>{"use strict";xn.exports=Ue,xn.exports.default=Ue;var Te=He(6709);function Ue(de,Q){if(!(this instanceof Ue))return new Ue(de,Q);this._maxEntries=Math.max(4,de||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),Q&&this._initFormat(Q),this.clear()}function ft(de,Q,fe){if(!fe)return Q.indexOf(de);for(var ze=0;ze<Q.length;ze++)if(fe(de,Q[ze]))return ze;return-1}function p(de,Q){Ce(de,0,de.children.length,Q,de)}function Ce(de,Q,fe,ze,pe){pe||(pe=ge(null)),pe.minX=1/0,pe.minY=1/0,pe.maxX=-1/0,pe.maxY=-1/0;for(var we,le=Q;le<fe;le++)we=de.children[le],We(pe,de.leaf?ze(we):we);return pe}function We(de,Q){return de.minX=Math.min(de.minX,Q.minX),de.minY=Math.min(de.minY,Q.minY),de.maxX=Math.max(de.maxX,Q.maxX),de.maxY=Math.max(de.maxY,Q.maxY),de}function dt(de,Q){return de.minX-Q.minX}function yt(de,Q){return de.minY-Q.minY}function Lt(de){return(de.maxX-de.minX)*(de.maxY-de.minY)}function un(de){return de.maxX-de.minX+(de.maxY-de.minY)}function Gt(de,Q){return(Math.max(Q.maxX,de.maxX)-Math.min(Q.minX,de.minX))*(Math.max(Q.maxY,de.maxY)-Math.min(Q.minY,de.minY))}function Tt(de,Q){var fe=Math.max(de.minX,Q.minX),ze=Math.max(de.minY,Q.minY),pe=Math.min(de.maxX,Q.maxX),le=Math.min(de.maxY,Q.maxY);return Math.max(0,pe-fe)*Math.max(0,le-ze)}function Xt(de,Q){return de.minX<=Q.minX&&de.minY<=Q.minY&&Q.maxX<=de.maxX&&Q.maxY<=de.maxY}function Dn(de,Q){return Q.minX<=de.maxX&&Q.minY<=de.maxY&&Q.maxX>=de.minX&&Q.maxY>=de.minY}function ge(de){return{children:de,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Me(de,Q,fe,ze,pe){for(var we,le=[Q,fe];le.length;)!((fe=le.pop())-(Q=le.pop())<=ze)&&(we=Q+Math.ceil((fe-Q)/ze/2)*ze,Te(de,we,Q,fe,pe),le.push(Q,we,we,fe))}Ue.prototype={all:function(){return this._all(this.data,[])},search:function(de){var Q=this.data,fe=[],ze=this.toBBox;if(!Dn(de,Q))return fe;for(var le,we,J,_t,pe=[];Q;){for(le=0,we=Q.children.length;le<we;le++)J=Q.children[le],Dn(de,_t=Q.leaf?ze(J):J)&&(Q.leaf?fe.push(J):Xt(de,_t)?this._all(J,fe):pe.push(J));Q=pe.pop()}return fe},collides:function(de){var Q=this.data,fe=this.toBBox;if(!Dn(de,Q))return!1;for(var pe,le,we,J,ze=[];Q;){for(pe=0,le=Q.children.length;pe<le;pe++)if(we=Q.children[pe],Dn(de,J=Q.leaf?fe(we):we)){if(Q.leaf||Xt(de,J))return!0;ze.push(we)}Q=ze.pop()}return!1},load:function(de){if(!de||!de.length)return this;if(de.length<this._minEntries){for(var Q=0,fe=de.length;Q<fe;Q++)this.insert(de[Q]);return this}var ze=this._build(de.slice(),0,de.length-1,0);if(this.data.children.length)if(this.data.height===ze.height)this._splitRoot(this.data,ze);else{if(this.data.height<ze.height){var pe=this.data;this.data=ze,ze=pe}this._insert(ze,this.data.height-ze.height-1,!0)}else this.data=ze;return this},insert:function(de){return de&&this._insert(de,this.data.height-1),this},clear:function(){return this.data=ge([]),this},remove:function(de,Q){if(!de)return this;for(var we,J,_t,Ge,fe=this.data,ze=this.toBBox(de),pe=[],le=[];fe||pe.length;){if(fe||(fe=pe.pop(),J=pe[pe.length-1],we=le.pop(),Ge=!0),fe.leaf&&-1!==(_t=ft(de,fe.children,Q)))return fe.children.splice(_t,1),pe.push(fe),this._condense(pe),this;Ge||fe.leaf||!Xt(fe,ze)?J?(we++,fe=J.children[we],Ge=!1):fe=null:(pe.push(fe),le.push(we),we=0,J=fe,fe=fe.children[0])}return this},toBBox:function(de){return de},compareMinX:dt,compareMinY:yt,toJSON:function(){return this.data},fromJSON:function(de){return this.data=de,this},_all:function(de,Q){for(var fe=[];de;)de.leaf?Q.push.apply(Q,de.children):fe.push.apply(fe,de.children),de=fe.pop();return Q},_build:function(de,Q,fe,ze){var we,pe=fe-Q+1,le=this._maxEntries;if(pe<=le)return p(we=ge(de.slice(Q,fe+1)),this.toBBox),we;ze||(ze=Math.ceil(Math.log(pe)/Math.log(le)),le=Math.ceil(pe/Math.pow(le,ze-1))),(we=ge([])).leaf=!1,we.height=ze;var Ge,$e,ue,on,J=Math.ceil(pe/le),_t=J*Math.ceil(Math.sqrt(le));for(Me(de,Q,fe,_t,this.compareMinX),Ge=Q;Ge<=fe;Ge+=_t)for(Me(de,Ge,ue=Math.min(Ge+_t-1,fe),J,this.compareMinY),$e=Ge;$e<=ue;$e+=J)on=Math.min($e+J-1,ue),we.children.push(this._build(de,$e,on,ze-1));return p(we,this.toBBox),we},_chooseSubtree:function(de,Q,fe,ze){for(var pe,le,we,J,_t,Ge,$e,ue;ze.push(Q),!Q.leaf&&ze.length-1!==fe;){for($e=ue=1/0,pe=0,le=Q.children.length;pe<le;pe++)_t=Lt(we=Q.children[pe]),(Ge=Gt(de,we)-_t)<ue?(ue=Ge,$e=_t<$e?_t:$e,J=we):Ge===ue&&_t<$e&&($e=_t,J=we);Q=J||Q.children[0]}return Q},_insert:function(de,Q,fe){var pe=fe?de:(0,this.toBBox)(de),le=[],we=this._chooseSubtree(pe,this.data,Q,le);for(we.children.push(de),We(we,pe);Q>=0&&le[Q].children.length>this._maxEntries;)this._split(le,Q),Q--;this._adjustParentBBoxes(pe,le,Q)},_split:function(de,Q){var fe=de[Q],ze=fe.children.length,pe=this._minEntries;this._chooseSplitAxis(fe,pe,ze);var le=this._chooseSplitIndex(fe,pe,ze),we=ge(fe.children.splice(le,fe.children.length-le));we.height=fe.height,we.leaf=fe.leaf,p(fe,this.toBBox),p(we,this.toBBox),Q?de[Q-1].children.push(we):this._splitRoot(fe,we)},_splitRoot:function(de,Q){this.data=ge([de,Q]),this.data.height=de.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(de,Q,fe){var ze,pe,le,we,J,_t,Ge,$e;for(_t=Ge=1/0,ze=Q;ze<=fe-Q;ze++)we=Tt(pe=Ce(de,0,ze,this.toBBox),le=Ce(de,ze,fe,this.toBBox)),J=Lt(pe)+Lt(le),we<_t?(_t=we,$e=ze,Ge=J<Ge?J:Ge):we===_t&&J<Ge&&(Ge=J,$e=ze);return $e},_chooseSplitAxis:function(de,Q,fe){var ze=de.leaf?this.compareMinX:dt,pe=de.leaf?this.compareMinY:yt;this._allDistMargin(de,Q,fe,ze)<this._allDistMargin(de,Q,fe,pe)&&de.children.sort(ze)},_allDistMargin:function(de,Q,fe,ze){de.children.sort(ze);var _t,Ge,pe=this.toBBox,le=Ce(de,0,Q,pe),we=Ce(de,fe-Q,fe,pe),J=un(le)+un(we);for(_t=Q;_t<fe-Q;_t++)Ge=de.children[_t],We(le,de.leaf?pe(Ge):Ge),J+=un(le);for(_t=fe-Q-1;_t>=Q;_t--)Ge=de.children[_t],We(we,de.leaf?pe(Ge):Ge),J+=un(we);return J},_adjustParentBBoxes:function(de,Q,fe){for(var ze=fe;ze>=0;ze--)We(Q[ze],de)},_condense:function(de){for(var fe,Q=de.length-1;Q>=0;Q--)0===de[Q].children.length?Q>0?(fe=de[Q-1].children).splice(fe.indexOf(de[Q]),1):this.clear():p(de[Q],this.toBBox)},_initFormat:function(de){var Q=["return a"," - b",";"];this.compareMinX=new Function("a","b",Q.join(de[0])),this.compareMinY=new Function("a","b",Q.join(de[1])),this.toBBox=new Function("a","return {minX: a"+de[0]+", minY: a"+de[1]+", maxX: a"+de[2]+", maxY: a"+de[3]+"};")}}},6709:function(xn){xn.exports=function(){"use strict";function He(ft,p,Ce,We,dt){for(;We>Ce;){if(We-Ce>600){var yt=We-Ce+1,Lt=p-Ce+1,un=Math.log(yt),Gt=.5*Math.exp(2*un/3),Tt=.5*Math.sqrt(un*Gt*(yt-Gt)/yt)*(Lt-yt/2<0?-1:1);He(ft,p,Math.max(Ce,Math.floor(p-Lt*Gt/yt+Tt)),Math.min(We,Math.floor(p+(yt-Lt)*Gt/yt+Tt)),dt)}var ge=ft[p],Me=Ce,de=We;for(Te(ft,Ce,p),dt(ft[We],ge)>0&&Te(ft,Ce,We);Me<de;){for(Te(ft,Me,de),Me++,de--;dt(ft[Me],ge)<0;)Me++;for(;dt(ft[de],ge)>0;)de--}0===dt(ft[Ce],ge)?Te(ft,Ce,de):Te(ft,++de,We),de<=p&&(Ce=de+1),p<=de&&(We=de-1)}}function Te(ft,p,Ce){var We=ft[p];ft[p]=ft[Ce],ft[Ce]=We}function Ue(ft,p){return ft<p?-1:ft>p?1:0}return function It(ft,p,Ce,We,dt){He(ft,p,Ce||0,We||ft.length-1,dt||Ue)}}()},4468:(xn,It,He)=>{"use strict";var Te=He(9582).functionsHaveConfigurableNames(),Ue=Object,ft=TypeError;xn.exports=function(){if(null!=this&&this!==Ue(this))throw new ft("RegExp.prototype.flags getter called on non-object");var Ce="";return this.hasIndices&&(Ce+="d"),this.global&&(Ce+="g"),this.ignoreCase&&(Ce+="i"),this.multiline&&(Ce+="m"),this.dotAll&&(Ce+="s"),this.unicode&&(Ce+="u"),this.sticky&&(Ce+="y"),Ce},Te&&Object.defineProperty&&Object.defineProperty(xn.exports,"name",{value:"get flags"})},9235:(xn,It,He)=>{"use strict";var Te=He(2358),Ue=He(5685),ft=He(4468),p=He(6343),Ce=He(1956),We=Ue(p());Te(We,{getPolyfill:p,implementation:ft,shim:Ce}),xn.exports=We},6343:(xn,It,He)=>{"use strict";var Te=He(4468),Ue=He(2358).supportsDescriptors,ft=Object.getOwnPropertyDescriptor;xn.exports=function(){if(Ue&&"gim"===/a/gim.flags){var Ce=ft(RegExp.prototype,"flags");if(Ce&&"function"==typeof Ce.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var We="",dt={};if(Object.defineProperty(dt,"hasIndices",{get:function(){We+="d"}}),Object.defineProperty(dt,"sticky",{get:function(){We+="y"}}),"dy"===We)return Ce.get}}return Te}},1956:(xn,It,He)=>{"use strict";var Te=He(2358).supportsDescriptors,Ue=He(6343),ft=Object.getOwnPropertyDescriptor,p=Object.defineProperty,Ce=TypeError,We=Object.getPrototypeOf,dt=/a/;xn.exports=function(){if(!Te||!We)throw new Ce("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Lt=Ue(),un=We(dt),Gt=ft(un,"flags");return(!Gt||Gt.get!==Lt)&&p(un,"flags",{configurable:!0,enumerable:!1,get:Lt}),Lt}},7563:function(xn,It){!function(He){"use strict";function ft(Xt,Dn,ge,Me,de){let Q,fe,ze,pe,le=Dn[0],we=Me[0],J=0,_t=0;we>le==we>-le?(Q=le,le=Dn[++J]):(Q=we,we=Me[++_t]);let Ge=0;if(J<Xt&&_t<ge)for(we>le==we>-le?(ze=Q-((fe=le+Q)-le),le=Dn[++J]):(ze=Q-((fe=we+Q)-we),we=Me[++_t]),Q=fe,0!==ze&&(de[Ge++]=ze);J<Xt&&_t<ge;)we>le==we>-le?(ze=Q-((fe=Q+le)-(pe=fe-Q))+(le-pe),le=Dn[++J]):(ze=Q-((fe=Q+we)-(pe=fe-Q))+(we-pe),we=Me[++_t]),Q=fe,0!==ze&&(de[Ge++]=ze);for(;J<Xt;)ze=Q-((fe=Q+le)-(pe=fe-Q))+(le-pe),le=Dn[++J],Q=fe,0!==ze&&(de[Ge++]=ze);for(;_t<ge;)ze=Q-((fe=Q+we)-(pe=fe-Q))+(we-pe),we=Me[++_t],Q=fe,0!==ze&&(de[Ge++]=ze);return 0===Q&&0!==Ge||(de[Ge++]=Q),Ge}function p(Xt){return new Float64Array(Xt)}const yt=p(4),Lt=p(8),un=p(12),Gt=p(16),Tt=p(4);He.orient2d=function(Xt,Dn,ge,Me,de,Q){const fe=(Dn-Q)*(ge-de),ze=(Xt-de)*(Me-Q),pe=fe-ze;if(0===fe||0===ze||fe>0!=ze>0)return pe;const le=Math.abs(fe+ze);return Math.abs(pe)>=33306690738754716e-32*le?pe:-function(we,J,_t,Ge,$e,ue,on){let kt,Ne,gt,Ee,it,vt,Re,Yt,$t,Mn,jt,Xn,Qn,sr,kn,zn,wn,pr;const Jr=we-$e,ki=_t-$e,_r=J-ue,Or=Ge-ue;it=(kn=(Yt=Jr-(Re=(vt=134217729*Jr)-(vt-Jr)))*(Mn=Or-($t=(vt=134217729*Or)-(vt-Or)))-((sr=Jr*Or)-Re*$t-Yt*$t-Re*Mn))-(jt=kn-(wn=(Yt=_r-(Re=(vt=134217729*_r)-(vt-_r)))*(Mn=ki-($t=(vt=134217729*ki)-(vt-ki)))-((zn=_r*ki)-Re*$t-Yt*$t-Re*Mn))),yt[0]=kn-(jt+it)+(it-wn),it=(Qn=sr-((Xn=sr+jt)-(it=Xn-sr))+(jt-it))-(jt=Qn-zn),yt[1]=Qn-(jt+it)+(it-zn),it=(pr=Xn+jt)-Xn,yt[2]=Xn-(pr-it)+(jt-it),yt[3]=pr;let St=function(mt,qt){let pn=qt[0];for(let yn=1;yn<4;yn++)pn+=qt[yn];return pn}(0,yt),ve=22204460492503146e-32*on;if(St>=ve||-St>=ve||(kt=we-(Jr+(it=we-Jr))+(it-$e),gt=_t-(ki+(it=_t-ki))+(it-$e),Ne=J-(_r+(it=J-_r))+(it-ue),Ee=Ge-(Or+(it=Ge-Or))+(it-ue),0===kt&&0===Ne&&0===gt&&0===Ee)||(ve=11093356479670487e-47*on+33306690738754706e-32*Math.abs(St),(St+=Jr*Ee+Or*kt-(_r*gt+ki*Ne))>=ve||-St>=ve))return St;it=(kn=(Yt=kt-(Re=(vt=134217729*kt)-(vt-kt)))*(Mn=Or-($t=(vt=134217729*Or)-(vt-Or)))-((sr=kt*Or)-Re*$t-Yt*$t-Re*Mn))-(jt=kn-(wn=(Yt=Ne-(Re=(vt=134217729*Ne)-(vt-Ne)))*(Mn=ki-($t=(vt=134217729*ki)-(vt-ki)))-((zn=Ne*ki)-Re*$t-Yt*$t-Re*Mn))),Tt[0]=kn-(jt+it)+(it-wn),it=(Qn=sr-((Xn=sr+jt)-(it=Xn-sr))+(jt-it))-(jt=Qn-zn),Tt[1]=Qn-(jt+it)+(it-zn),it=(pr=Xn+jt)-Xn,Tt[2]=Xn-(pr-it)+(jt-it),Tt[3]=pr;const me=ft(4,yt,4,Tt,Lt);it=(kn=(Yt=Jr-(Re=(vt=134217729*Jr)-(vt-Jr)))*(Mn=Ee-($t=(vt=134217729*Ee)-(vt-Ee)))-((sr=Jr*Ee)-Re*$t-Yt*$t-Re*Mn))-(jt=kn-(wn=(Yt=_r-(Re=(vt=134217729*_r)-(vt-_r)))*(Mn=gt-($t=(vt=134217729*gt)-(vt-gt)))-((zn=_r*gt)-Re*$t-Yt*$t-Re*Mn))),Tt[0]=kn-(jt+it)+(it-wn),it=(Qn=sr-((Xn=sr+jt)-(it=Xn-sr))+(jt-it))-(jt=Qn-zn),Tt[1]=Qn-(jt+it)+(it-zn),it=(pr=Xn+jt)-Xn,Tt[2]=Xn-(pr-it)+(jt-it),Tt[3]=pr;const se=ft(me,Lt,4,Tt,un);it=(kn=(Yt=kt-(Re=(vt=134217729*kt)-(vt-kt)))*(Mn=Ee-($t=(vt=134217729*Ee)-(vt-Ee)))-((sr=kt*Ee)-Re*$t-Yt*$t-Re*Mn))-(jt=kn-(wn=(Yt=Ne-(Re=(vt=134217729*Ne)-(vt-Ne)))*(Mn=gt-($t=(vt=134217729*gt)-(vt-gt)))-((zn=Ne*gt)-Re*$t-Yt*$t-Re*Mn))),Tt[0]=kn-(jt+it)+(it-wn),it=(Qn=sr-((Xn=sr+jt)-(it=Xn-sr))+(jt-it))-(jt=Qn-zn),Tt[1]=Qn-(jt+it)+(it-zn),it=(pr=Xn+jt)-Xn,Tt[2]=Xn-(pr-it)+(jt-it),Tt[3]=pr;const Ve=ft(se,un,4,Tt,Gt);return Gt[Ve-1]}(Xt,Dn,ge,Me,de,Q,le)},He.orient2dfast=function(Xt,Dn,ge,Me,de,Q){return(Dn-Q)*(ge-de)-(Xt-de)*(Me-Q)},Object.defineProperty(He,"__esModule",{value:!0})}(It)},9231:xn=>{"use strict";xn.exports={eudist:function(He,Te,Ue){for(var ft=He.length,p=0,Ce=0;Ce<ft;Ce++){var We=(He[Ce]||0)-(Te[Ce]||0);p+=We*We}return Ue?Math.sqrt(p):p},mandist:function(He,Te,Ue){for(var ft=He.length,p=0,Ce=0;Ce<ft;Ce++)p+=Math.abs((He[Ce]||0)-(Te[Ce]||0));return Ue?Math.sqrt(p):p},dist:function(He,Te,Ue){var ft=Math.abs(He-Te);return Ue?ft:ft*ft}}},5561:(xn,It,He)=>{"use strict";var Te=He(9231),Ue=Te.eudist,ft=Te.dist;xn.exports={kmrand:function(Ce,We){for(var dt={},yt=[],Lt=We<<2,un=Ce.length,Gt=Ce[0].length>0;yt.length<We&&Lt-- >0;){var Tt=Ce[Math.floor(Math.random()*un)],Xt=Gt?Tt.join("_"):""+Tt;dt[Xt]||(dt[Xt]=!0,yt.push(Tt))}if(yt.length<We)throw new Error("Error initializating clusters");return yt},kmpp:function(Ce,We){var dt=Ce[0].length?Ue:ft,yt=[],Lt=Ce.length,un=Ce[0].length>0,Tt=Ce[Math.floor(Math.random()*Lt)];for(un&&Tt.join("_"),yt.push(Tt);yt.length<We;){for(var Dn=[],ge=yt.length,Me=0,de=[],Q=0;Q<Lt;Q++){for(var fe=1/0,ze=0;ze<ge;ze++){var pe=dt(Ce[Q],yt[ze]);pe<=fe&&(fe=pe)}Dn[Q]=fe}for(var le=0;le<Lt;le++)Me+=Dn[le];for(var we=0;we<Lt;we++)de[we]={i:we,v:Ce[we],pr:Dn[we]/Me,cs:0};de.sort(function($e,ue){return $e.pr-ue.pr}),de[0].cs=de[0].pr;for(var J=1;J<Lt;J++)de[J].cs=de[J-1].cs+de[J].pr;for(var _t=Math.random(),Ge=0;Ge<Lt-1&&de[Ge++].cs<_t;);yt.push(de[Ge-1].v)}return yt}}},9475:(xn,It,He)=>{"use strict";var Te=He(9231),Ue=He(5561),ft=Te.eudist,We=Ue.kmrand,dt=Ue.kmpp;function Lt(Gt,Tt,Xt){Xt=Xt||[];for(var Dn=0;Dn<Gt;Dn++)Xt[Dn]=Tt;return Xt}xn.exports=function un(Gt,Tt,Xt,Dn){var ge=[],Me=[],de=[],Q=[],fe=!1,ze=Dn||1e4,pe=Gt.length,le=Gt[0].length,we=le>0,J=[];if(Xt)ge="kmrand"==Xt?We(Gt,Tt):"kmpp"==Xt?dt(Gt,Tt):Xt;else for(var _t={};ge.length<Tt;){var Ge=Math.floor(Math.random()*pe);_t[Ge]||(_t[Ge]=!0,ge.push(Gt[Ge]))}do{Lt(Tt,0,J);for(var $e=0;$e<pe;$e++){for(var ue=1/0,on=0,kt=0;kt<Tt;kt++)(Q=we?ft(Gt[$e],ge[kt]):Math.abs(Gt[$e]-ge[kt]))<=ue&&(ue=Q,on=kt);de[$e]=on,J[on]++}for(var Ne=[],Ee=(Me=[],0);Ee<Tt;Ee++)Ne[Ee]=we?Lt(le,0,Ne[Ee]):0,Me[Ee]=ge[Ee];if(we){for(var it=0;it<Tt;it++)ge[it]=[];for(var vt=0;vt<pe;vt++)for(var Yt=Ne[de[vt]],$t=Gt[vt],Mn=0;Mn<le;Mn++)Yt[Mn]+=$t[Mn];fe=!0;for(var jt=0;jt<Tt;jt++){for(var Xn=ge[jt],Qn=Ne[jt],sr=Me[jt],kn=J[jt],zn=0;zn<le;zn++)Xn[zn]=Qn[zn]/kn||0;if(fe)for(var wn=0;wn<le;wn++)if(sr[wn]!=Xn[wn]){fe=!1;break}}}else{for(var pr=0;pr<pe;pr++)Ne[de[pr]]+=Gt[pr];for(var ki=0;ki<Tt;ki++)ge[ki]=Ne[ki]/J[ki]||0;fe=!0;for(var _r=0;_r<Tt;_r++)if(Me[_r]!=ge[_r]){fe=!1;break}}fe=fe||--ze<=0}while(!fe);return{it:1e4-ze,k:Tt,idxs:de,centroids:ge}}},7253:(xn,It,He)=>{"use strict";He.r(It),He.d(It,{default:()=>Te});class Te{constructor(p=[],Ce=Ue){if(this.data=p,this.length=this.data.length,this.compare=Ce,this.length>0)for(let We=(this.length>>1)-1;We>=0;We--)this._down(We)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],Ce=this.data.pop();return this.length--,this.length>0&&(this.data[0]=Ce,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:Ce,compare:We}=this,dt=Ce[p];for(;p>0;){const yt=p-1>>1,Lt=Ce[yt];if(We(dt,Lt)>=0)break;Ce[p]=Lt,p=yt}Ce[p]=dt}_down(p){const{data:Ce,compare:We}=this,dt=this.length>>1,yt=Ce[p];for(;p<dt;){let Lt=1+(p<<1),un=Ce[Lt];const Gt=Lt+1;if(Gt<this.length&&We(Ce[Gt],un)<0&&(Lt=Gt,un=Ce[Gt]),We(un,yt)>=0)break;Ce[p]=un,p=Lt}Ce[p]=yt}}function Ue(ft,p){return ft<p?-1:ft>p?1:0}},770:function(xn,It){!function(He){"use strict";function Te(){}function Ue(u){this.message=u||""}function ft(u){this.message=u||""}function p(u){this.message=u||""}function Ce(){}function We(u){return null===u?ot:u.color}function dt(u){return null===u?null:u.parent}function yt(u,h){null!==u&&(u.color=h)}function Lt(u){return null===u?null:u.left}function un(u){return null===u?null:u.right}function Gt(){this.root_=null,this.size_=0}function Tt(){}function Xt(){this.array_=[],arguments[0]instanceof Ci&&this.addAll(arguments[0])}function Dn(){}function ge(u){this.message=u||""}function Me(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(u){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),y=Math.max(Math.min(h.length,9007199254740991),0)||0,x=1 in arguments&&parseInt(Number(arguments[1]),10)||0;x=x<0?Math.max(y+x,0):Math.min(x,y);var T=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:y;for(T=T<0?Math.max(y+arguments[2],0):Math.min(T,y);x<T;)h[x]=u,++x;return h},writable:!0}),Number.isFinite=Number.isFinite||function(u){return"number"==typeof u&&isFinite(u)},Number.isInteger=Number.isInteger||function(u){return"number"==typeof u&&isFinite(u)&&Math.floor(u)===u},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(u){return u!=u},Math.trunc=Math.trunc||function(u){return u<0?Math.ceil(u):Math.floor(u)};var de=function(){};de.prototype.interfaces_=function(){return[]},de.prototype.getClass=function(){return de},de.prototype.equalsWithTolerance=function(u,h,y){return Math.abs(u-h)<=y};var Q=function(u){function h(y){u.call(this,y),this.name="IllegalArgumentException",this.message=y,this.stack=(new u).stack}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(Error),fe=function(){},ze={MAX_VALUE:{configurable:!0}};fe.isNaN=function(u){return Number.isNaN(u)},fe.doubleToLongBits=function(u){return u},fe.longBitsToDouble=function(u){return u},fe.isInfinite=function(u){return!Number.isFinite(u)},ze.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(fe,ze);var pe=function(){},le=function(){},we=function(){},J=function u(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=u.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=u.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},_t={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};J.prototype.setOrdinate=function(u,h){switch(u){case J.X:this.x=h;break;case J.Y:this.y=h;break;case J.Z:this.z=h;break;default:throw new Q("Invalid ordinate index: "+u)}},J.prototype.equals2D=function(){if(1===arguments.length){var u=arguments[0];return this.x===u.x&&this.y===u.y}if(2===arguments.length){var h=arguments[0],y=arguments[1];return!!de.equalsWithTolerance(this.x,h.x,y)&&!!de.equalsWithTolerance(this.y,h.y,y)}},J.prototype.getOrdinate=function(u){switch(u){case J.X:return this.x;case J.Y:return this.y;case J.Z:return this.z}throw new Q("Invalid ordinate index: "+u)},J.prototype.equals3D=function(u){return this.x===u.x&&this.y===u.y&&(this.z===u.z||fe.isNaN(this.z))&&fe.isNaN(u.z)},J.prototype.equals=function(u){return u instanceof J&&this.equals2D(u)},J.prototype.equalInZ=function(u,h){return de.equalsWithTolerance(this.z,u.z,h)},J.prototype.compareTo=function(u){return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0},J.prototype.clone=function(){},J.prototype.copy=function(){return new J(this)},J.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},J.prototype.distance3D=function(u){var h=this.x-u.x,y=this.y-u.y,x=this.z-u.z;return Math.sqrt(h*h+y*y+x*x)},J.prototype.distance=function(u){var h=this.x-u.x,y=this.y-u.y;return Math.sqrt(h*h+y*y)},J.prototype.hashCode=function(){var u=17;return 37*(u=37*u+J.hashCode(this.x))+J.hashCode(this.y)},J.prototype.setCoordinate=function(u){this.x=u.x,this.y=u.y,this.z=u.z},J.prototype.interfaces_=function(){return[pe,le,Te]},J.prototype.getClass=function(){return J},J.hashCode=function(){if(1===arguments.length){var h=fe.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},_t.DimensionalComparator.get=function(){return Ge},_t.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},_t.NULL_ORDINATE.get=function(){return fe.NaN},_t.X.get=function(){return 0},_t.Y.get=function(){return 1},_t.Z.get=function(){return 2},Object.defineProperties(J,_t);var Ge=function(u){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new Q("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};Ge.prototype.compare=function(u,h){var y=u,x=h,T=Ge.compare(y.x,x.x);if(0!==T)return T;var F=Ge.compare(y.y,x.y);return 0!==F?F:this._dimensionsToTest<=2?0:Ge.compare(y.z,x.z)},Ge.prototype.interfaces_=function(){return[we]},Ge.prototype.getClass=function(){return Ge},Ge.compare=function(u,h){return u<h?-1:u>h?1:fe.isNaN(u)?fe.isNaN(h)?0:-1:fe.isNaN(h)?1:0};var $e=function(){};$e.prototype.create=function(){},$e.prototype.interfaces_=function(){return[]},$e.prototype.getClass=function(){return $e};var ue=function(){},on={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue},ue.toLocationSymbol=function(u){switch(u){case ue.EXTERIOR:return"e";case ue.BOUNDARY:return"b";case ue.INTERIOR:return"i";case ue.NONE:return"-"}throw new Q("Unknown location value: "+u)},on.INTERIOR.get=function(){return 0},on.BOUNDARY.get=function(){return 1},on.EXTERIOR.get=function(){return 2},on.NONE.get=function(){return-1},Object.defineProperties(ue,on);var kt=function(u,h){return u.interfaces_&&u.interfaces_().indexOf(h)>-1},Ne=function(){},gt={LOG_10:{configurable:!0}};Ne.prototype.interfaces_=function(){return[]},Ne.prototype.getClass=function(){return Ne},Ne.log10=function(u){var h=Math.log(u);return fe.isInfinite(h)||fe.isNaN(h)?h:h/Ne.LOG_10},Ne.min=function(u,h,y,x){var T=u;return h<T&&(T=h),y<T&&(T=y),x<T&&(T=x),T},Ne.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1],y=arguments[2];return u<h?h:u>y?y:u}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x=arguments[0],T=arguments[1],F=arguments[2];return x<T?T:x>F?F:x}},Ne.wrap=function(u,h){return u<0?h- -u%h:u%h},Ne.max=function(){if(3===arguments.length){var h=arguments[1],y=arguments[2],x=arguments[0];return h>x&&(x=h),y>x&&(x=y),x}if(4===arguments.length){var F=arguments[1],$=arguments[2],ee=arguments[3],oe=arguments[0];return F>oe&&(oe=F),$>oe&&(oe=$),ee>oe&&(oe=ee),oe}},Ne.average=function(u,h){return(u+h)/2},gt.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Ne,gt);var Ee=function(u){this.str=u};Ee.prototype.append=function(u){this.str+=u},Ee.prototype.setCharAt=function(u,h){this.str=this.str.substr(0,u)+h+this.str.substr(u+1)},Ee.prototype.toString=function(u){return this.str};var it=function(u){this.value=u};it.prototype.intValue=function(){return this.value},it.prototype.compareTo=function(u){return this.value<u?-1:this.value>u?1:0},it.isNaN=function(u){return Number.isNaN(u)};var vt=function(){};vt.isWhitespace=function(u){return u<=32&&u>=0||127===u},vt.toUpperCase=function(u){return u.toUpperCase()};var Re=function u(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof u?this.init(arguments[0]):"string"==typeof arguments[0]&&u.call(this,u.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Yt={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Re.prototype.le=function(u){return(this._hi<u._hi||this._hi===u._hi)&&this._lo<=u._lo},Re.prototype.extractSignificantDigits=function(u,h){var y=this.abs(),x=Re.magnitude(y._hi),T=Re.TEN.pow(x);(y=y.divide(T)).gt(Re.TEN)?(y=y.divide(Re.TEN),x+=1):y.lt(Re.ONE)&&(y=y.multiply(Re.TEN),x-=1);for(var F=x+1,$=new Ee,ee=Re.MAX_PRINT_DIGITS-1,oe=0;oe<=ee;oe++){u&&oe===F&&$.append(".");var st=Math.trunc(y._hi);if(st<0)break;var Zt=!1,Qt=0;st>9?(Zt=!0,Qt="9"):Qt="0"+st,$.append(Qt),y=y.subtract(Re.valueOf(st)).multiply(Re.TEN),Zt&&y.selfAdd(Re.TEN);var xt=!0,mn=Re.magnitude(y._hi);if(mn<0&&Math.abs(mn)>=ee-oe&&(xt=!1),!xt)break}return h[0]=x,$.toString()},Re.prototype.sqr=function(){return this.multiply(this)},Re.prototype.doubleValue=function(){return this._hi+this._lo},Re.prototype.subtract=function(){return arguments[0]instanceof Re?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Re.prototype.equals=function(){if(1===arguments.length){var u=arguments[0];return this._hi===u._hi&&this._lo===u._lo}},Re.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Re.prototype.selfSubtract=function(){if(arguments[0]instanceof Re){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u._hi,-u._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Re.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Re.prototype.min=function(u){return this.le(u)?this:u},Re.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Re){var u=arguments[0];return this.selfDivide(u._hi,u._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var y=arguments[0],T=null,F=null,$=null,ee=null,oe=null,st=null,Zt=null,Qt=null;return this._hi=Qt=(oe=this._hi/y)+(st=(this._hi-(Zt=oe*y)-(Qt=(T=(st=Re.SPLIT*oe)-(T=st-oe))*($=(Qt=Re.SPLIT*y)-($=Qt-y))-Zt+T*(ee=y-$)+(F=oe-T)*$+F*ee)+this._lo-oe*arguments[1])/y),this._lo=oe-Qt+st,this}},Re.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Re.prototype.divide=function(){if(arguments[0]instanceof Re){var u=arguments[0],h=null,y=null,x=null,T=null,F=null,$=null,ee=null,oe=null;return y=(F=this._hi/u._hi)-(h=($=Re.SPLIT*F)-(h=$-F)),oe=h*(x=(oe=Re.SPLIT*u._hi)-(x=oe-u._hi))-(ee=F*u._hi)+h*(T=u._hi-x)+y*x+y*T,new Re(oe=F+($=(this._hi-ee-oe+this._lo-F*u._lo)/u._hi),F-oe+$)}if("number"==typeof arguments[0]){var st=arguments[0];return fe.isNaN(st)?Re.createNaN():Re.copy(this).selfDivide(st,0)}},Re.prototype.ge=function(u){return(this._hi>u._hi||this._hi===u._hi)&&this._lo>=u._lo},Re.prototype.pow=function(u){if(0===u)return Re.valueOf(1);var h=new Re(this),y=Re.valueOf(1),x=Math.abs(u);if(x>1)for(;x>0;)x%2==1&&y.selfMultiply(h),(x/=2)>0&&(h=h.sqr());else y=h;return u<0?y.reciprocal():y},Re.prototype.ceil=function(){if(this.isNaN())return Re.NaN;var u=Math.ceil(this._hi),h=0;return u===this._hi&&(h=Math.ceil(this._lo)),new Re(u,h)},Re.prototype.compareTo=function(u){return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0},Re.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Re.prototype.setValue=function(){return arguments[0]instanceof Re||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Re.prototype.max=function(u){return this.ge(u)?this:u},Re.prototype.sqrt=function(){if(this.isZero())return Re.valueOf(0);if(this.isNegative())return Re.NaN;var u=1/Math.sqrt(this._hi),y=Re.valueOf(this._hi*u),x=this.subtract(y.sqr())._hi*(.5*u);return y.add(x)},Re.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Re){var u=arguments[0];return this.selfAdd(u._hi,u._lo)}if("number"==typeof arguments[0]){var h=arguments[0],y=null,x=null,T=null,$=null,ee=null;return this._hi=(y=(T=this._hi+h)+(ee=h-($=T-this._hi)+(this._hi-(T-$))+this._lo))+(x=ee+(T-y)),this._lo=x+(y-this._hi),this}}else if(2===arguments.length){var oe=arguments[0],st=arguments[1],Zt=null,Qt=null,xt=null,mn=null,ur=null,Cr=null,ti=null;ur=(mn=this._hi+oe)-(Cr=mn-this._hi),xt=(Qt=this._lo+st)-(ti=Qt-this._lo);var bs=(Zt=mn+(Cr=(ur=oe-Cr+(this._hi-ur))+Qt))+(Cr=(xt=st-ti+(this._lo-xt))+(Cr+(mn-Zt))),Ws=Cr+(Zt-bs);return this._hi=bs,this._lo=Ws,this}},Re.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Re){var u=arguments[0];return this.selfMultiply(u._hi,u._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var y=arguments[0],T=null,F=null,$=null,ee=null,oe=null,st=null;T=(oe=Re.SPLIT*this._hi)-this._hi,T=oe-T;var Zt=(oe=this._hi*y)+(st=T*($=(st=Re.SPLIT*y)-($=st-y))-oe+T*(ee=y-$)+(F=this._hi-T)*$+F*ee+(this._hi*arguments[1]+this._lo*y)),Qt=st+(T=oe-Zt);return this._hi=Zt,this._lo=Qt,this}},Re.prototype.selfSqr=function(){return this.selfMultiply(this)},Re.prototype.floor=function(){if(this.isNaN())return Re.NaN;var u=Math.floor(this._hi),h=0;return u===this._hi&&(h=Math.floor(this._lo)),new Re(u,h)},Re.prototype.negate=function(){return this.isNaN()?this:new Re(-this._hi,-this._lo)},Re.prototype.clone=function(){},Re.prototype.multiply=function(){if(arguments[0]instanceof Re){var u=arguments[0];return u.isNaN()?Re.createNaN():Re.copy(this).selfMultiply(u)}if("number"==typeof arguments[0]){var h=arguments[0];return fe.isNaN(h)?Re.createNaN():Re.copy(this).selfMultiply(h,0)}},Re.prototype.isNaN=function(){return fe.isNaN(this._hi)},Re.prototype.intValue=function(){return Math.trunc(this._hi)},Re.prototype.toString=function(){var u=Re.magnitude(this._hi);return u>=-3&&u<=20?this.toStandardNotation():this.toSciNotation()},Re.prototype.toStandardNotation=function(){var u=this.getSpecialNumberString();if(null!==u)return u;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!0,h),x=h[0]+1,T=y;return"."===y.charAt(0)?T="0"+y:x<0?T="0."+Re.stringOfChar("0",-x)+y:-1===y.indexOf(".")&&(T=y+Re.stringOfChar("0",x-y.length)+".0"),this.isNegative()?"-"+T:T},Re.prototype.reciprocal=function(){var h,x,T,$,u=null,y=null,F=null,ee=null;h=(T=1/this._hi)-(u=(F=Re.SPLIT*T)-(u=F-T)),y=(ee=Re.SPLIT*this._hi)-this._hi;var oe=T+(F=(1-($=T*this._hi)-(ee=u*(y=ee-y)-$+u*(x=this._hi-y)+h*y+h*x)-T*this._lo)/this._hi);return new Re(oe,T-oe+F)},Re.prototype.toSciNotation=function(){if(this.isZero())return Re.SCI_NOT_ZERO;var u=this.getSpecialNumberString();if(null!==u)return u;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!1,h),x=Re.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===y.charAt(0))throw new Error("Found leading zero: "+y);var T="";y.length>1&&(T=y.substring(1));var F=y.charAt(0)+"."+T;return this.isNegative()?"-"+F+x:F+x},Re.prototype.abs=function(){return this.isNaN()?Re.NaN:this.isNegative()?this.negate():new Re(this)},Re.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Re.prototype.lt=function(u){return(this._hi<u._hi||this._hi===u._hi)&&this._lo<u._lo},Re.prototype.add=function(){if(arguments[0]instanceof Re){var u=arguments[0];return Re.copy(this).selfAdd(u)}if("number"==typeof arguments[0]){var h=arguments[0];return Re.copy(this).selfAdd(h)}},Re.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Re){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var x=arguments[1];this._hi=arguments[0],this._lo=x}},Re.prototype.gt=function(u){return(this._hi>u._hi||this._hi===u._hi)&&this._lo>u._lo},Re.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Re.prototype.trunc=function(){return this.isNaN()?Re.NaN:this.isPositive()?this.floor():this.ceil()},Re.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Re.prototype.interfaces_=function(){return[Te,pe,le]},Re.prototype.getClass=function(){return Re},Re.sqr=function(u){return Re.valueOf(u).selfMultiply(u)},Re.valueOf=function(){return"string"==typeof arguments[0]?Re.parse(arguments[0]):"number"==typeof arguments[0]?new Re(arguments[0]):void 0},Re.sqrt=function(u){return Re.valueOf(u).sqrt()},Re.parse=function(u){for(var h=0,y=u.length;vt.isWhitespace(u.charAt(h));)h++;var x=!1;if(h<y){var T=u.charAt(h);"-"!==T&&"+"!==T||(h++,"-"===T&&(x=!0))}for(var F=new Re,$=0,ee=0,oe=0;!(h>=y);){var st=u.charAt(h);if(h++,vt.isDigit(st)){var Zt=st-"0";F.selfMultiply(Re.TEN),F.selfAdd(Zt),$++}else{if("."!==st){if("e"===st||"E"===st){var Qt=u.substring(h);try{oe=it.parseInt(Qt)}catch(ti){throw ti instanceof Error?new Error("Invalid exponent "+Qt+" in string "+u):ti}break}throw new Error("Unexpected character '"+st+"' at position "+h+" in string "+u)}ee=$}}var xt=F,mn=$-ee-oe;if(0===mn)xt=F;else if(mn>0){var ur=Re.TEN.pow(mn);xt=F.divide(ur)}else if(mn<0){var Cr=Re.TEN.pow(-mn);xt=F.multiply(Cr)}return x?xt.negate():xt},Re.createNaN=function(){return new Re(fe.NaN,fe.NaN)},Re.copy=function(u){return new Re(u)},Re.magnitude=function(u){var h=Math.abs(u),y=Math.log(h)/Math.log(10),x=Math.trunc(Math.floor(y));return 10*Math.pow(10,x)<=h&&(x+=1),x},Re.stringOfChar=function(u,h){for(var y=new Ee,x=0;x<h;x++)y.append(u);return y.toString()},Yt.PI.get=function(){return new Re(3.141592653589793,12246467991473532e-32)},Yt.TWO_PI.get=function(){return new Re(6.283185307179586,24492935982947064e-32)},Yt.PI_2.get=function(){return new Re(1.5707963267948966,6123233995736766e-32)},Yt.E.get=function(){return new Re(2.718281828459045,14456468917292502e-32)},Yt.NaN.get=function(){return new Re(fe.NaN,fe.NaN)},Yt.EPS.get=function(){return 123259516440783e-46},Yt.SPLIT.get=function(){return 134217729},Yt.MAX_PRINT_DIGITS.get=function(){return 32},Yt.TEN.get=function(){return Re.valueOf(10)},Yt.ONE.get=function(){return Re.valueOf(1)},Yt.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Yt.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Re,Yt);var $t=function(){},Mn={DP_SAFE_EPSILON:{configurable:!0}};$t.prototype.interfaces_=function(){return[]},$t.prototype.getClass=function(){return $t},$t.orientationIndex=function(u,h,y){var x=$t.orientationIndexFilter(u,h,y);if(x<=1)return x;var T=Re.valueOf(h.x).selfAdd(-u.x),F=Re.valueOf(h.y).selfAdd(-u.y),$=Re.valueOf(y.x).selfAdd(-h.x),ee=Re.valueOf(y.y).selfAdd(-h.y);return T.selfMultiply(ee).selfSubtract(F.selfMultiply($)).signum()},$t.signOfDet2x2=function(u,h,y,x){return u.multiply(x).selfSubtract(h.multiply(y)).signum()},$t.intersection=function(u,h,y,x){var T=Re.valueOf(x.y).selfSubtract(y.y).selfMultiply(Re.valueOf(h.x).selfSubtract(u.x)),F=Re.valueOf(x.x).selfSubtract(y.x).selfMultiply(Re.valueOf(h.y).selfSubtract(u.y)),$=T.subtract(F),ee=Re.valueOf(x.x).selfSubtract(y.x).selfMultiply(Re.valueOf(u.y).selfSubtract(y.y)),oe=Re.valueOf(x.y).selfSubtract(y.y).selfMultiply(Re.valueOf(u.x).selfSubtract(y.x)),st=ee.subtract(oe).selfDivide($).doubleValue(),Zt=Re.valueOf(u.x).selfAdd(Re.valueOf(h.x).selfSubtract(u.x).selfMultiply(st)).doubleValue(),Qt=Re.valueOf(h.x).selfSubtract(u.x).selfMultiply(Re.valueOf(u.y).selfSubtract(y.y)),xt=Re.valueOf(h.y).selfSubtract(u.y).selfMultiply(Re.valueOf(u.x).selfSubtract(y.x)),mn=Qt.subtract(xt).selfDivide($).doubleValue(),ur=Re.valueOf(y.y).selfAdd(Re.valueOf(x.y).selfSubtract(y.y).selfMultiply(mn)).doubleValue();return new J(Zt,ur)},$t.orientationIndexFilter=function(u,h,y){var x=null,T=(u.x-y.x)*(h.y-y.y),F=(u.y-y.y)*(h.x-y.x),$=T-F;if(T>0){if(F<=0)return $t.signum($);x=T+F}else{if(!(T<0)||F>=0)return $t.signum($);x=-T-F}var ee=$t.DP_SAFE_EPSILON*x;return $>=ee||-$>=ee?$t.signum($):2},$t.signum=function(u){return u>0?1:u<0?-1:0},Mn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties($t,Mn);var jt=function(){},Xn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Xn.X.get=function(){return 0},Xn.Y.get=function(){return 1},Xn.Z.get=function(){return 2},Xn.M.get=function(){return 3},jt.prototype.setOrdinate=function(u,h,y){},jt.prototype.size=function(){},jt.prototype.getOrdinate=function(u,h){},jt.prototype.getCoordinate=function(){},jt.prototype.getCoordinateCopy=function(u){},jt.prototype.getDimension=function(){},jt.prototype.getX=function(u){},jt.prototype.clone=function(){},jt.prototype.expandEnvelope=function(u){},jt.prototype.copy=function(){},jt.prototype.getY=function(u){},jt.prototype.toCoordinateArray=function(){},jt.prototype.interfaces_=function(){return[le]},jt.prototype.getClass=function(){return jt},Object.defineProperties(jt,Xn);var Qn=function(){},sr=function(u){function h(){u.call(this,"Projective point not representable on the Cartesian plane.")}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Qn),kn=function(){};kn.arraycopy=function(u,h,y,x,T){for(var F=0,$=h;$<h+T;$++)y[x+F]=u[$],F++},kn.getProperty=function(u){return{"line.separator":"\n"}[u]};var zn=function u(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var x=arguments[1];this.x=arguments[0],this.y=x,this.w=1}else if(arguments[0]instanceof u&&arguments[1]instanceof u){var T=arguments[0],F=arguments[1];this.x=T.y*F.w-F.y*T.w,this.y=F.x*T.w-T.x*F.w,this.w=T.x*F.y-F.x*T.y}else if(arguments[0]instanceof J&&arguments[1]instanceof J){var $=arguments[0],ee=arguments[1];this.x=$.y-ee.y,this.y=ee.x-$.x,this.w=$.x*ee.y-ee.x*$.y}}else if(3===arguments.length){var st=arguments[1],Zt=arguments[2];this.x=arguments[0],this.y=st,this.w=Zt}else if(4===arguments.length){var Qt=arguments[0],xt=arguments[1],mn=arguments[2],ur=arguments[3],Cr=Qt.y-xt.y,ti=xt.x-Qt.x,bs=Qt.x*xt.y-xt.x*Qt.y,Ws=mn.y-ur.y,ra=ur.x-mn.x,_u=mn.x*ur.y-ur.x*mn.y;this.x=ti*_u-ra*bs,this.y=Ws*bs-Cr*_u,this.w=Cr*ra-Ws*ti}};zn.prototype.getY=function(){var u=this.y/this.w;if(fe.isNaN(u)||fe.isInfinite(u))throw new sr;return u},zn.prototype.getX=function(){var u=this.x/this.w;if(fe.isNaN(u)||fe.isInfinite(u))throw new sr;return u},zn.prototype.getCoordinate=function(){var u=new J;return u.x=this.getX(),u.y=this.getY(),u},zn.prototype.interfaces_=function(){return[]},zn.prototype.getClass=function(){return zn},zn.intersection=function(u,h,y,x){var T=u.y-h.y,F=h.x-u.x,$=u.x*h.y-h.x*u.y,ee=y.y-x.y,oe=x.x-y.x,st=y.x*x.y-x.x*y.y,Zt=T*oe-ee*F,Qt=(F*st-oe*$)/Zt,xt=(ee*$-T*st)/Zt;if(fe.isNaN(Qt)||fe.isInfinite(Qt)||fe.isNaN(xt)||fe.isInfinite(xt))throw new sr;return new J(Qt,xt)};var wn=function u(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof J){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof u&&this.init(arguments[0]);else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.init(x.x,T.x,x.y,T.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},pr={serialVersionUID:{configurable:!0}};wn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},wn.prototype.equals=function(u){if(!(u instanceof wn))return!1;var h=u;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},wn.prototype.intersection=function(u){return this.isNull()||u.isNull()||!this.intersects(u)?new wn:new wn(this._minx>u._minx?this._minx:u._minx,this._maxx<u._maxx?this._maxx:u._maxx,this._miny>u._miny?this._miny:u._miny,this._maxy<u._maxy?this._maxy:u._maxy)},wn.prototype.isNull=function(){return this._maxx<this._minx},wn.prototype.getMaxX=function(){return this._maxx},wn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];return this.covers(u.x,u.y)}if(arguments[0]instanceof wn){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&x>=this._miny&&x<=this._maxy}},wn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof wn){var u=arguments[0];return!this.isNull()&&!u.isNull()&&!(u._minx>this._maxx||u._maxx<this._minx||u._miny>this._maxy||u._maxy<this._miny)}if(arguments[0]instanceof J){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&!(y>this._maxx||y<this._minx||x>this._maxy||x<this._miny)}},wn.prototype.getMinY=function(){return this._miny},wn.prototype.getMinX=function(){return this._minx},wn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];this.expandToInclude(u.x,u.y)}else if(arguments[0]instanceof wn){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=x,this._maxy=x):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),x<this._miny&&(this._miny=x),x>this._maxy&&(this._maxy=x))}},wn.prototype.minExtent=function(){if(this.isNull())return 0;var u=this.getWidth(),h=this.getHeight();return u<h?u:h},wn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},wn.prototype.compareTo=function(u){var h=u;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},wn.prototype.translate=function(u,h){if(this.isNull())return null;this.init(this.getMinX()+u,this.getMaxX()+u,this.getMinY()+h,this.getMaxY()+h)},wn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},wn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},wn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},wn.prototype.maxExtent=function(){if(this.isNull())return 0;var u=this.getWidth(),h=this.getHeight();return u>h?u:h},wn.prototype.expandBy=function(){if(1===arguments.length){var u=arguments[0];this.expandBy(u,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},wn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof wn)return this.covers(arguments[0]);if(arguments[0]instanceof J)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},wn.prototype.centre=function(){return this.isNull()?null:new J((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},wn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];this.init(u.x,u.x,u.y,u.y)}else if(arguments[0]instanceof wn){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.init(y.x,x.x,y.y,x.y)}else if(4===arguments.length){var T=arguments[0],F=arguments[1],$=arguments[2],ee=arguments[3];T<F?(this._minx=T,this._maxx=F):(this._minx=F,this._maxx=T),$<ee?(this._miny=$,this._maxy=ee):(this._miny=ee,this._maxy=$)}},wn.prototype.getMaxY=function(){return this._maxy},wn.prototype.distance=function(u){if(this.intersects(u))return 0;var h=0;this._maxx<u._minx?h=u._minx-this._maxx:this._minx>u._maxx&&(h=this._minx-u._maxx);var y=0;return this._maxy<u._miny?y=u._miny-this._maxy:this._miny>u._maxy&&(y=this._miny-u._maxy),0===h?y:0===y?h:Math.sqrt(h*h+y*y)},wn.prototype.hashCode=function(){var u=17;return 37*(u=37*(u=37*(u=37*u+J.hashCode(this._minx))+J.hashCode(this._maxx))+J.hashCode(this._miny))+J.hashCode(this._maxy)},wn.prototype.interfaces_=function(){return[pe,Te]},wn.prototype.getClass=function(){return wn},wn.intersects=function(){if(3===arguments.length){var u=arguments[0],h=arguments[1],y=arguments[2];return y.x>=(u.x<h.x?u.x:h.x)&&y.x<=(u.x>h.x?u.x:h.x)&&y.y>=(u.y<h.y?u.y:h.y)&&y.y<=(u.y>h.y?u.y:h.y)}if(4===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2],$=arguments[3],ee=Math.min(F.x,$.x),oe=Math.max(F.x,$.x),st=Math.min(x.x,T.x),Zt=Math.max(x.x,T.x);return!(st>oe||Zt<ee||(ee=Math.min(F.y,$.y),oe=Math.max(F.y,$.y),st=Math.min(x.y,T.y),Zt=Math.max(x.y,T.y),st>oe||Zt<ee))}},pr.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(wn,pr);var Jr={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},ki=function(u){this.geometryFactory=u||new Br};ki.prototype.read=function(u){var h,y;u=u.replace(/[\n\r]/g," ");var T=Jr.typeStr.exec(u);if(-1!==u.search("EMPTY")&&((T=Jr.emptyTypeStr.exec(u))[2]=void 0),T&&(y=T[1].toLowerCase(),Or[y]&&(h=Or[y].apply(this,[T[2]]))),void 0===h)throw new Error("Could not parse WKT "+u);return h},ki.prototype.write=function(u){return this.extractGeometry(u)},ki.prototype.extractGeometry=function(u){var h=u.getGeometryType().toLowerCase();if(!_r[h])return null;var y=h.toUpperCase();return u.isEmpty()?y+" EMPTY":y+"("+_r[h].apply(this,[u])+")"};var _r={coordinate:function(u){return u.x+" "+u.y},point:function(u){return _r.coordinate.call(this,u._coordinates._coordinates[0])},multipoint:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+_r.point.apply(this,[u._geometries[y]])+")");return h.join(",")},linestring:function(u){for(var h=[],y=0,x=u._points._coordinates.length;y<x;++y)h.push(_r.coordinate.apply(this,[u._points._coordinates[y]]));return h.join(",")},linearring:function(u){for(var h=[],y=0,x=u._points._coordinates.length;y<x;++y)h.push(_r.coordinate.apply(this,[u._points._coordinates[y]]));return h.join(",")},multilinestring:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+_r.linestring.apply(this,[u._geometries[y]])+")");return h.join(",")},polygon:function(u){var h=[];h.push("("+_r.linestring.apply(this,[u._shell])+")");for(var y=0,x=u._holes.length;y<x;++y)h.push("("+_r.linestring.apply(this,[u._holes[y]])+")");return h.join(",")},multipolygon:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+_r.polygon.apply(this,[u._geometries[y]])+")");return h.join(",")},geometrycollection:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push(this.extractGeometry(u._geometries[y]));return h.join(",")}},Or={point:function(u){if(void 0===u)return this.geometryFactory.createPoint();var h=u.trim().split(Jr.spaces);return this.geometryFactory.createPoint(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(u){if(void 0===u)return this.geometryFactory.createMultiPoint();for(var h,y=u.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(Jr.trimParens,"$1"),x.push(Or.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(x)},linestring:function(u){if(void 0===u)return this.geometryFactory.createLineString();for(var h,y=u.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].trim().split(Jr.spaces),x.push(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(x)},linearring:function(u){if(void 0===u)return this.geometryFactory.createLinearRing();for(var h,y=u.trim().split(","),x=[],T=0,F=y.length;T<F;++T)h=y[T].trim().split(Jr.spaces),x.push(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(x)},multilinestring:function(u){if(void 0===u)return this.geometryFactory.createMultiLineString();for(var h,y=u.trim().split(Jr.parenComma),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(Jr.trimParens,"$1"),x.push(Or.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(x)},polygon:function(u){if(void 0===u)return this.geometryFactory.createPolygon();for(var h,y,x,T,F=u.trim().split(Jr.parenComma),$=[],ee=0,oe=F.length;ee<oe;++ee)h=F[ee].replace(Jr.trimParens,"$1"),y=Or.linestring.apply(this,[h]),x=this.geometryFactory.createLinearRing(y._points),0===ee?T=x:$.push(x);return this.geometryFactory.createPolygon(T,$)},multipolygon:function(u){if(void 0===u)return this.geometryFactory.createMultiPolygon();for(var h,y=u.trim().split(Jr.doubleParenComma),x=[],T=0,F=y.length;T<F;++T)h=y[T].replace(Jr.trimParens,"$1"),x.push(Or.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(x)},geometrycollection:function(u){if(void 0===u)return this.geometryFactory.createGeometryCollection();for(var h=(u=u.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),y=[],x=0,T=h.length;x<T;++x)y.push(this.read(h[x]));return this.geometryFactory.createGeometryCollection(y)}},St=function(u){this.parser=new ki(u)};St.prototype.write=function(u){return this.parser.write(u)},St.toLineString=function(u,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+u.x+" "+u.y+", "+h.x+" "+h.y+" )"};var ve=function(u){function h(y){u.call(this,y),this.name="RuntimeException",this.message=y,this.stack=(new u).stack}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(Error),me=function(u){function h(){u.call(this),0===arguments.length?u.call(this):1===arguments.length&&u.call(this,arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ve),se=function(){};se.prototype.interfaces_=function(){return[]},se.prototype.getClass=function(){return se},se.shouldNeverReachHere=function(){if(0===arguments.length)se.shouldNeverReachHere(null);else if(1===arguments.length){var u=arguments[0];throw new me("Should never reach here"+(null!==u?": "+u:""))}},se.isTrue=function(){var h;if(1===arguments.length)se.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new me:new me(h)},se.equals=function(){var u,h,y;if(2===arguments.length)se.equals(u=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(y=arguments[2],!(h=arguments[1]).equals(u=arguments[0])))throw new me("Expected "+u+" but encountered "+h+(null!==y?": "+y:""))};var Ve=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new J,this._intPt[1]=new J,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},mt={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Ve.prototype.getIndexAlongSegment=function(u,h){return this.computeIntLineIndex(),this._intLineIndex[u][h]},Ve.prototype.getTopologySummary=function(){var u=new Ee;return this.isEndPoint()&&u.append(" endpoint"),this._isProper&&u.append(" proper"),this.isCollinear()&&u.append(" collinear"),u.toString()},Ve.prototype.computeIntersection=function(u,h,y,x){this._inputLines[0][0]=u,this._inputLines[0][1]=h,this._inputLines[1][0]=y,this._inputLines[1][1]=x,this._result=this.computeIntersect(u,h,y,x)},Ve.prototype.getIntersectionNum=function(){return this._result},Ve.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var u=arguments[0];this.getEdgeDistance(u,0)>this.getEdgeDistance(u,1)?(this._intLineIndex[u][0]=0,this._intLineIndex[u][1]=1):(this._intLineIndex[u][0]=1,this._intLineIndex[u][1]=0)}},Ve.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},Ve.prototype.setPrecisionModel=function(u){this._precisionModel=u},Ve.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var u=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[u][0])&&!this._intPt[h].equals2D(this._inputLines[u][1]))return!0;return!1}},Ve.prototype.getIntersection=function(u){return this._intPt[u]},Ve.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},Ve.prototype.hasIntersection=function(){return this._result!==Ve.NO_INTERSECTION},Ve.prototype.getEdgeDistance=function(u,h){return Ve.computeEdgeDistance(this._intPt[h],this._inputLines[u][0],this._inputLines[u][1])},Ve.prototype.isCollinear=function(){return this._result===Ve.COLLINEAR_INTERSECTION},Ve.prototype.toString=function(){return St.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+St.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},Ve.prototype.getEndpoint=function(u,h){return this._inputLines[u][h]},Ve.prototype.isIntersection=function(u){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(u))return!0;return!1},Ve.prototype.getIntersectionAlongSegment=function(u,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[u][h]]},Ve.prototype.interfaces_=function(){return[]},Ve.prototype.getClass=function(){return Ve},Ve.computeEdgeDistance=function(u,h,y){var x=Math.abs(y.x-h.x),T=Math.abs(y.y-h.y),F=-1;if(u.equals(h))F=0;else if(u.equals(y))F=x>T?x:T;else{var $=Math.abs(u.x-h.x),ee=Math.abs(u.y-h.y);0!==(F=x>T?$:ee)||u.equals(h)||(F=Math.max($,ee))}return se.isTrue(!(0===F&&!u.equals(h)),"Bad distance calculation"),F},Ve.nonRobustComputeEdgeDistance=function(u,h,y){var x=u.x-h.x,T=u.y-h.y,F=Math.sqrt(x*x+T*T);return se.isTrue(!(0===F&&!u.equals(h)),"Invalid distance calculation"),F},mt.DONT_INTERSECT.get=function(){return 0},mt.DO_INTERSECT.get=function(){return 1},mt.COLLINEAR.get=function(){return 2},mt.NO_INTERSECTION.get=function(){return 0},mt.POINT_INTERSECTION.get=function(){return 1},mt.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Ve,mt);var qt=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(y){var x=new wn(this._inputLines[0][0],this._inputLines[0][1]),T=new wn(this._inputLines[1][0],this._inputLines[1][1]);return x.contains(y)&&T.contains(y)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return u.prototype.computeIntersection.apply(this,arguments);var y=arguments[0],x=arguments[1],T=arguments[2];if(this._isProper=!1,wn.intersects(x,T,y)&&0===Kt.orientationIndex(x,T,y)&&0===Kt.orientationIndex(T,x,y))return this._isProper=!0,(y.equals(x)||y.equals(T))&&(this._isProper=!1),this._result=u.POINT_INTERSECTION,null;this._result=u.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(y,x,T,F,$){$.x=this.smallestInAbsValue(y.x,x.x,T.x,F.x),$.y=this.smallestInAbsValue(y.y,x.y,T.y,F.y),y.x-=$.x,y.y-=$.y,x.x-=$.x,x.y-=$.y,T.x-=$.x,T.y-=$.y,F.x-=$.x,F.y-=$.y},h.prototype.safeHCoordinateIntersection=function(y,x,T,F){var $=null;try{$=zn.intersection(y,x,T,F)}catch(ee){if(!(ee instanceof sr))throw ee;$=h.nearestEndpoint(y,x,T,F)}return $},h.prototype.intersection=function(y,x,T,F){var $=this.intersectionWithNormalization(y,x,T,F);return this.isInSegmentEnvelopes($)||($=new J(h.nearestEndpoint(y,x,T,F))),null!==this._precisionModel&&this._precisionModel.makePrecise($),$},h.prototype.smallestInAbsValue=function(y,x,T,F){var $=y,ee=Math.abs($);return Math.abs(x)<ee&&($=x,ee=Math.abs(x)),Math.abs(T)<ee&&($=T,ee=Math.abs(T)),Math.abs(F)<ee&&($=F),$},h.prototype.checkDD=function(y,x,T,F,$){var ee=$t.intersection(y,x,T,F),oe=this.isInSegmentEnvelopes(ee);kn.out.println("DD in env = "+oe+"  --------------------- "+ee),$.distance(ee)>1e-4&&kn.out.println("Distance = "+$.distance(ee))},h.prototype.intersectionWithNormalization=function(y,x,T,F){var $=new J(y),ee=new J(x),oe=new J(T),st=new J(F),Zt=new J;this.normalizeToEnvCentre($,ee,oe,st,Zt);var Qt=this.safeHCoordinateIntersection($,ee,oe,st);return Qt.x+=Zt.x,Qt.y+=Zt.y,Qt},h.prototype.computeCollinearIntersection=function(y,x,T,F){var $=wn.intersects(y,x,T),ee=wn.intersects(y,x,F),oe=wn.intersects(T,F,y),st=wn.intersects(T,F,x);return $&&ee?(this._intPt[0]=T,this._intPt[1]=F,u.COLLINEAR_INTERSECTION):oe&&st?(this._intPt[0]=y,this._intPt[1]=x,u.COLLINEAR_INTERSECTION):$&&oe?(this._intPt[0]=T,this._intPt[1]=y,!T.equals(y)||ee||st?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):$&&st?(this._intPt[0]=T,this._intPt[1]=x,!T.equals(x)||ee||oe?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):ee&&oe?(this._intPt[0]=F,this._intPt[1]=y,!F.equals(y)||$||st?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):ee&&st?(this._intPt[0]=F,this._intPt[1]=x,!F.equals(x)||$||oe?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):u.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(y,x,T,F,$){var ee=y.x<x.x?y.x:x.x,oe=y.y<x.y?y.y:x.y,st=y.x>x.x?y.x:x.x,Zt=y.y>x.y?y.y:x.y,Qt=T.x<F.x?T.x:F.x,xt=T.y<F.y?T.y:F.y,mn=T.x>F.x?T.x:F.x,ur=T.y>F.y?T.y:F.y,ti=((oe>xt?oe:xt)+(Zt<ur?Zt:ur))/2;$.x=((ee>Qt?ee:Qt)+(st<mn?st:mn))/2,$.y=ti,y.x-=$.x,y.y-=$.y,x.x-=$.x,x.y-=$.y,T.x-=$.x,T.y-=$.y,F.x-=$.x,F.y-=$.y},h.prototype.computeIntersect=function(y,x,T,F){if(this._isProper=!1,!wn.intersects(y,x,T,F))return u.NO_INTERSECTION;var $=Kt.orientationIndex(y,x,T),ee=Kt.orientationIndex(y,x,F);if($>0&&ee>0||$<0&&ee<0)return u.NO_INTERSECTION;var oe=Kt.orientationIndex(T,F,y),st=Kt.orientationIndex(T,F,x);return oe>0&&st>0||oe<0&&st<0?u.NO_INTERSECTION:0===$&&0===ee&&0===oe&&0===st?this.computeCollinearIntersection(y,x,T,F):(0===$||0===ee||0===oe||0===st?(this._isProper=!1,y.equals2D(T)||y.equals2D(F)?this._intPt[0]=y:x.equals2D(T)||x.equals2D(F)?this._intPt[0]=x:0===$?this._intPt[0]=new J(T):0===ee?this._intPt[0]=new J(F):0===oe?this._intPt[0]=new J(y):0===st&&(this._intPt[0]=new J(x))):(this._isProper=!0,this._intPt[0]=this.intersection(y,x,T,F)),u.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(y,x,T,F){var $=y,ee=Kt.distancePointLine(y,T,F),oe=Kt.distancePointLine(x,T,F);return oe<ee&&(ee=oe,$=x),(oe=Kt.distancePointLine(T,y,x))<ee&&(ee=oe,$=T),(oe=Kt.distancePointLine(F,y,x))<ee&&(ee=oe,$=F),$},h}(Ve),pn=function(){};pn.prototype.interfaces_=function(){return[]},pn.prototype.getClass=function(){return pn},pn.orientationIndex=function(u,h,y){return pn.signOfDet2x2(h.x-u.x,h.y-u.y,y.x-h.x,y.y-h.y)},pn.signOfDet2x2=function(u,h,y,x){var T=null,F=null,$=null;if(T=1,0===u||0===x)return 0===h||0===y?0:h>0?y>0?-T:T:y>0?T:-T;if(0===h||0===y)return x>0?u>0?T:-T:u>0?-T:T;if(h>0?x>0?h<=x||(T=-T,F=u,u=y,y=F,F=h,h=x,x=F):h<=-x?(T=-T,y=-y,x=-x):(F=u,u=-y,y=F,F=h,h=-x,x=F):x>0?-h<=x?(T=-T,u=-u,h=-h):(F=-u,u=y,y=F,F=-h,h=x,x=F):h>=x?(u=-u,h=-h,y=-y,x=-x):(T=-T,F=-u,u=-y,y=F,F=-h,h=-x,x=F),u>0){if(!(y>0&&u<=y))return T}else{if(y>0||!(u>=y))return-T;T=-T,u=-u,y=-y}for(;;){if((x-=($=Math.floor(y/u))*h)<0)return-T;if(x>h)return T;if(u>(y-=$*u)+y){if(h<x+x)return T}else{if(h>x+x)return-T;y=u-y,x=h-x,T=-T}if(0===x)return 0===y?0:-T;if(0===y||(u-=($=Math.floor(u/y))*y,(h-=$*x)<0))return T;if(h>x)return-T;if(y>u+u){if(x<h+h)return-T}else{if(x>h+h)return T;u=y-u,h=x-h,T=-T}if(0===h)return 0===u?0:T;if(0===u)return-T}};var yn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};yn.prototype.countSegment=function(u,h){if(u.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(u.y===this._p.y&&h.y===this._p.y){var y=u.x,x=h.x;return y>x&&(y=h.x,x=u.x),this._p.x>=y&&this._p.x<=x&&(this._isPointOnSegment=!0),null}if(u.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&u.y<=this._p.y){var F=u.y-this._p.y,ee=h.y-this._p.y,oe=pn.signOfDet2x2(u.x-this._p.x,F,h.x-this._p.x,ee);if(0===oe)return this._isPointOnSegment=!0,null;ee<F&&(oe=-oe),oe>0&&this._crossingCount++}},yn.prototype.isPointInPolygon=function(){return this.getLocation()!==ue.EXTERIOR},yn.prototype.getLocation=function(){return this._isPointOnSegment?ue.BOUNDARY:this._crossingCount%2==1?ue.INTERIOR:ue.EXTERIOR},yn.prototype.isOnSegment=function(){return this._isPointOnSegment},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn},yn.locatePointInRing=function(){if(arguments[0]instanceof J&&kt(arguments[1],jt)){for(var h=arguments[1],y=new yn(arguments[0]),x=new J,T=new J,F=1;F<h.size();F++)if(h.getCoordinate(F,x),h.getCoordinate(F-1,T),y.countSegment(x,T),y.isOnSegment())return y.getLocation();return y.getLocation()}if(arguments[0]instanceof J&&arguments[1]instanceof Array){for(var ee=arguments[1],oe=new yn(arguments[0]),st=1;st<ee.length;st++)if(oe.countSegment(ee[st],ee[st-1]),oe.isOnSegment())return oe.getLocation();return oe.getLocation()}};var Kt=function(){},Pr={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Kt.prototype.interfaces_=function(){return[]},Kt.prototype.getClass=function(){return Kt},Kt.orientationIndex=function(u,h,y){return $t.orientationIndex(u,h,y)},Kt.signedArea=function(){if(arguments[0]instanceof Array){var u=arguments[0];if(u.length<3)return 0;for(var h=0,y=u[0].x,x=1;x<u.length-1;x++)h+=(u[x].x-y)*(u[x-1].y-u[x+1].y);return h/2}if(kt(arguments[0],jt)){var $=arguments[0],ee=$.size();if(ee<3)return 0;var oe=new J,st=new J,Zt=new J;$.getCoordinate(0,st),$.getCoordinate(1,Zt);var Qt=st.x;Zt.x-=Qt;for(var xt=0,mn=1;mn<ee-1;mn++)oe.y=st.y,st.x=Zt.x,st.y=Zt.y,$.getCoordinate(mn+1,Zt),Zt.x-=Qt,xt+=st.x*(oe.y-Zt.y);return xt/2}},Kt.distanceLineLine=function(u,h,y,x){if(u.equals(h))return Kt.distancePointLine(u,y,x);if(y.equals(x))return Kt.distancePointLine(x,u,h);var T=!1;if(wn.intersects(u,h,y,x)){var F=(h.x-u.x)*(x.y-y.y)-(h.y-u.y)*(x.x-y.x);if(0===F)T=!0;else{var ee=((u.y-y.y)*(h.x-u.x)-(u.x-y.x)*(h.y-u.y))/F,oe=((u.y-y.y)*(x.x-y.x)-(u.x-y.x)*(x.y-y.y))/F;(oe<0||oe>1||ee<0||ee>1)&&(T=!0)}}else T=!0;return T?Ne.min(Kt.distancePointLine(u,y,x),Kt.distancePointLine(h,y,x),Kt.distancePointLine(y,u,h),Kt.distancePointLine(x,u,h)):0},Kt.isPointInRing=function(u,h){return Kt.locatePointInRing(u,h)!==ue.EXTERIOR},Kt.computeLength=function(u){var h=u.size();if(h<=1)return 0;var y=0,x=new J;u.getCoordinate(0,x);for(var T=x.x,F=x.y,$=1;$<h;$++){u.getCoordinate($,x);var ee=x.x,oe=x.y,st=ee-T,Zt=oe-F;y+=Math.sqrt(st*st+Zt*Zt),T=ee,F=oe}return y},Kt.isCCW=function(u){var h=u.length-1;if(h<3)throw new Q("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=u[0],x=0,T=1;T<=h;T++){var F=u[T];F.y>y.y&&(y=F,x=T)}var $=x;do{($-=1)<0&&($=h)}while(u[$].equals2D(y)&&$!==x);var ee=x;do{ee=(ee+1)%h}while(u[ee].equals2D(y)&&ee!==x);var oe=u[$],st=u[ee];if(oe.equals2D(y)||st.equals2D(y)||oe.equals2D(st))return!1;var Zt=Kt.computeOrientation(oe,y,st);return 0===Zt?oe.x>st.x:Zt>0},Kt.locatePointInRing=function(u,h){return yn.locatePointInRing(u,h)},Kt.distancePointLinePerpendicular=function(u,h,y){var x=(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y);return Math.abs(((h.y-u.y)*(y.x-h.x)-(h.x-u.x)*(y.y-h.y))/x)*Math.sqrt(x)},Kt.computeOrientation=function(u,h,y){return Kt.orientationIndex(u,h,y)},Kt.distancePointLine=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];if(0===h.length)throw new Q("Line array must contain at least one vertex");for(var y=u.distance(h[0]),x=0;x<h.length-1;x++){var T=Kt.distancePointLine(u,h[x],h[x+1]);T<y&&(y=T)}return y}if(3===arguments.length){var F=arguments[0],$=arguments[1],ee=arguments[2];if($.x===ee.x&&$.y===ee.y)return F.distance($);var oe=(ee.x-$.x)*(ee.x-$.x)+(ee.y-$.y)*(ee.y-$.y),st=((F.x-$.x)*(ee.x-$.x)+(F.y-$.y)*(ee.y-$.y))/oe;return st<=0?F.distance($):st>=1?F.distance(ee):Math.abs((($.y-F.y)*(ee.x-$.x)-($.x-F.x)*(ee.y-$.y))/oe)*Math.sqrt(oe)}},Kt.isOnLine=function(u,h){for(var y=new qt,x=1;x<h.length;x++)if(y.computeIntersection(u,h[x-1],h[x]),y.hasIntersection())return!0;return!1},Pr.CLOCKWISE.get=function(){return-1},Pr.RIGHT.get=function(){return Kt.CLOCKWISE},Pr.COUNTERCLOCKWISE.get=function(){return 1},Pr.LEFT.get=function(){return Kt.COUNTERCLOCKWISE},Pr.COLLINEAR.get=function(){return 0},Pr.STRAIGHT.get=function(){return Kt.COLLINEAR},Object.defineProperties(Kt,Pr);var lr=function(){};lr.prototype.filter=function(u){},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr};var On=function(){var u=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=u,this._SRID=u.getSRID()},Lr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};On.prototype.isGeometryCollection=function(){return this.getSortIndex()===On.SORTINDEX_GEOMETRYCOLLECTION},On.prototype.getFactory=function(){return this._factory},On.prototype.getGeometryN=function(u){return this},On.prototype.getArea=function(){return 0},On.prototype.isRectangle=function(){return!1},On.prototype.equals=function(){if(arguments[0]instanceof On){var u=arguments[0];return null!==u&&this.equalsTopo(u)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof On&&this.equalsExact(h)}},On.prototype.equalsExact=function(u){return this===u||this.equalsExact(u,0)},On.prototype.geometryChanged=function(){this.apply(On.geometryChangedFilter)},On.prototype.geometryChangedAction=function(){this._envelope=null},On.prototype.equalsNorm=function(u){return null!==u&&this.norm().equalsExact(u.norm())},On.prototype.getLength=function(){return 0},On.prototype.getNumGeometries=function(){return 1},On.prototype.compareTo=function(){if(1===arguments.length){var u=arguments[0],h=u;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(u)}if(2===arguments.length){var y=arguments[0],x=arguments[1];return this.getSortIndex()!==y.getSortIndex()?this.getSortIndex()-y.getSortIndex():this.isEmpty()&&y.isEmpty()?0:this.isEmpty()?-1:y.isEmpty()?1:this.compareToSameClass(y,x)}},On.prototype.getUserData=function(){return this._userData},On.prototype.getSRID=function(){return this._SRID},On.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},On.prototype.checkNotGeometryCollection=function(u){if(u.getSortIndex()===On.SORTINDEX_GEOMETRYCOLLECTION)throw new Q("This method does not support GeometryCollection arguments")},On.prototype.equal=function(u,h,y){return 0===y?u.equals(h):u.distance(h)<=y},On.prototype.norm=function(){var u=this.copy();return u.normalize(),u},On.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},On.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new wn(this._envelope)},On.prototype.setSRID=function(u){this._SRID=u},On.prototype.setUserData=function(u){this._userData=u},On.prototype.compare=function(u,h){for(var y=u.iterator(),x=h.iterator();y.hasNext()&&x.hasNext();){var T=y.next(),F=x.next(),$=T.compareTo(F);if(0!==$)return $}return y.hasNext()?1:x.hasNext()?-1:0},On.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},On.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===On.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===On.SORTINDEX_MULTIPOINT||this.getSortIndex()===On.SORTINDEX_MULTILINESTRING||this.getSortIndex()===On.SORTINDEX_MULTIPOLYGON},On.prototype.interfaces_=function(){return[le,pe,Te]},On.prototype.getClass=function(){return On},On.hasNonEmptyElements=function(u){for(var h=0;h<u.length;h++)if(!u[h].isEmpty())return!0;return!1},On.hasNullElements=function(u){for(var h=0;h<u.length;h++)if(null===u[h])return!0;return!1},Lr.serialVersionUID.get=function(){return 0x799ea46522854c00},Lr.SORTINDEX_POINT.get=function(){return 0},Lr.SORTINDEX_MULTIPOINT.get=function(){return 1},Lr.SORTINDEX_LINESTRING.get=function(){return 2},Lr.SORTINDEX_LINEARRING.get=function(){return 3},Lr.SORTINDEX_MULTILINESTRING.get=function(){return 4},Lr.SORTINDEX_POLYGON.get=function(){return 5},Lr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Lr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Lr.geometryChangedFilter.get=function(){return _i},Object.defineProperties(On,Lr);var _i=function(){};_i.interfaces_=function(){return[lr]},_i.filter=function(u){u.geometryChangedAction()};var vi=function(){};vi.prototype.filter=function(u){},vi.prototype.interfaces_=function(){return[]},vi.prototype.getClass=function(){return vi};var Pi=function(){},Ri={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Pi.prototype.isInBoundary=function(u){},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},Ri.Mod2BoundaryNodeRule.get=function(){return Sr},Ri.EndPointBoundaryNodeRule.get=function(){return ds},Ri.MultiValentEndPointBoundaryNodeRule.get=function(){return Ko},Ri.MonoValentEndPointBoundaryNodeRule.get=function(){return Ns},Ri.MOD2_BOUNDARY_RULE.get=function(){return new Sr},Ri.ENDPOINT_BOUNDARY_RULE.get=function(){return new ds},Ri.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ko},Ri.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ns},Ri.OGC_SFS_BOUNDARY_RULE.get=function(){return Pi.MOD2_BOUNDARY_RULE},Object.defineProperties(Pi,Ri);var Sr=function(){};Sr.prototype.isInBoundary=function(u){return u%2==1},Sr.prototype.interfaces_=function(){return[Pi]},Sr.prototype.getClass=function(){return Sr};var ds=function(){};ds.prototype.isInBoundary=function(u){return u>0},ds.prototype.interfaces_=function(){return[Pi]},ds.prototype.getClass=function(){return ds};var Ko=function(){};Ko.prototype.isInBoundary=function(u){return u>1},Ko.prototype.interfaces_=function(){return[Pi]},Ko.prototype.getClass=function(){return Ko};var Ns=function(){};Ns.prototype.isInBoundary=function(u){return 1===u},Ns.prototype.interfaces_=function(){return[Pi]},Ns.prototype.getClass=function(){return Ns};var Ci=function(){};Ci.prototype.add=function(){},Ci.prototype.addAll=function(){},Ci.prototype.isEmpty=function(){},Ci.prototype.iterator=function(){},Ci.prototype.size=function(){},Ci.prototype.toArray=function(){},Ci.prototype.remove=function(){},(Ue.prototype=new Error).name="IndexOutOfBoundsException";var Ys=function(){};Ys.prototype.hasNext=function(){},Ys.prototype.next=function(){},Ys.prototype.remove=function(){};var oi=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(Ci);(ft.prototype=new Error).name="NoSuchElementException";var An=function(u){function h(){u.call(this),this.array_=[],arguments[0]instanceof Ci&&this.addAll(arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[u,Ci]},h.prototype.add=function(y){return 1===arguments.length?this.array_.push(y):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.set=function(y,x){var T=this.array_[y];return this.array_[y]=x,T},h.prototype.iterator=function(){return new Ks(this)},h.prototype.get=function(y){if(y<0||y>=this.size())throw new Ue;return this.array_[y]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.remove=function(y){for(var x=!1,T=0,F=this.array_.length;T<F;T++)if(this.array_[T]===y){this.array_.splice(T,1),x=!0;break}return x},h}(oi),Ks=function(u){function h(y){u.call(this),this.arrayList_=y,this.position_=0}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new ft;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(y){return this.arrayList_.set(this.position_-1,y)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(Ys),as=function(u){function h(){if(u.call(this),0!==arguments.length)if(1===arguments.length){var x=arguments[0];this.ensureCapacity(x.length),this.add(x,!0)}else if(2===arguments.length){var T=arguments[0],F=arguments[1];this.ensureCapacity(T.length),this.add(T,F)}}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={coordArrayType:{configurable:!0}};return y.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(x){return this.get(x)},h.prototype.addAll=function(){if(2===arguments.length){for(var T=arguments[1],F=!1,$=arguments[0].iterator();$.hasNext();)this.add($.next(),T),F=!0;return F}return u.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var x=u.prototype.clone.call(this),T=0;T<this.size();T++)x.add(T,this.get(T).copy());return x},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)u.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof J&&"boolean"==typeof arguments[1]){var $=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D($))return null;u.prototype.add.call(this,$)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var st=arguments[0],Zt=arguments[1];if(arguments[2])for(var Qt=0;Qt<st.length;Qt++)this.add(st[Qt],Zt);else for(var xt=st.length-1;xt>=0;xt--)this.add(st[xt],Zt);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof J){var mn=arguments[0],ur=arguments[1];if(!arguments[2]){var Cr=this.size();if(Cr>0&&(mn>0&&this.get(mn-1).equals2D(ur)||mn<Cr&&this.get(mn).equals2D(ur)))return null}u.prototype.add.call(this,mn,ur)}}else if(4===arguments.length){var ti=arguments[0],bs=arguments[1],Ws=arguments[2],ra=arguments[3],_u=1;Ws>ra&&(_u=-1);for(var lc=Ws;lc!==ra;lc+=_u)this.add(ti[lc],bs);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new J(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,y),h}(An),$r=function(){},Ha={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Ha.ForwardComparator.get=function(){return ns},Ha.BidirectionalComparator.get=function(){return Oe},Ha.coordArrayType.get=function(){return new Array(0).fill(null)},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.isRing=function(u){return!(u.length<4||!u[0].equals2D(u[u.length-1]))},$r.ptNotInList=function(u,h){for(var y=0;y<u.length;y++){var x=u[y];if($r.indexOf(x,h)<0)return x}return null},$r.scroll=function(u,h){var y=$r.indexOf(h,u);if(y<0)return null;var x=new Array(u.length).fill(null);kn.arraycopy(u,y,x,0,u.length-y),kn.arraycopy(u,0,x,u.length-y,y),kn.arraycopy(x,0,u,0,u.length)},$r.equals=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];if(u===h)return!0;if(null===u||null===h||u.length!==h.length)return!1;for(var y=0;y<u.length;y++)if(!u[y].equals(h[y]))return!1;return!0}if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2];if(x===T)return!0;if(null===x||null===T||x.length!==T.length)return!1;for(var $=0;$<x.length;$++)if(0!==F.compare(x[$],T[$]))return!1;return!0}},$r.intersection=function(u,h){for(var y=new as,x=0;x<u.length;x++)h.intersects(u[x])&&y.add(u[x],!0);return y.toCoordinateArray()},$r.hasRepeatedPoints=function(u){for(var h=1;h<u.length;h++)if(u[h-1].equals(u[h]))return!0;return!1},$r.removeRepeatedPoints=function(u){return $r.hasRepeatedPoints(u)?new as(u,!1).toCoordinateArray():u},$r.reverse=function(u){for(var h=u.length-1,y=Math.trunc(h/2),x=0;x<=y;x++){var T=u[x];u[x]=u[h-x],u[h-x]=T}},$r.removeNull=function(u){for(var h=0,y=0;y<u.length;y++)null!==u[y]&&h++;var x=new Array(h).fill(null);if(0===h)return x;for(var T=0,F=0;F<u.length;F++)null!==u[F]&&(x[T++]=u[F]);return x},$r.copyDeep=function(){if(1===arguments.length){for(var u=arguments[0],h=new Array(u.length).fill(null),y=0;y<u.length;y++)h[y]=new J(u[y]);return h}if(5===arguments.length)for(var x=arguments[0],T=arguments[1],F=arguments[2],$=arguments[3],ee=arguments[4],oe=0;oe<ee;oe++)F[$+oe]=new J(x[T+oe])},$r.isEqualReversed=function(u,h){for(var y=0;y<u.length;y++)if(0!==u[y].compareTo(h[u.length-y-1]))return!1;return!0},$r.envelope=function(u){for(var h=new wn,y=0;y<u.length;y++)h.expandToInclude(u[y]);return h},$r.toCoordinateArray=function(u){return u.toArray($r.coordArrayType)},$r.atLeastNCoordinatesOrNothing=function(u,h){return h.length>=u?h:[]},$r.indexOf=function(u,h){for(var y=0;y<h.length;y++)if(u.equals(h[y]))return y;return-1},$r.increasingDirection=function(u){for(var h=0;h<Math.trunc(u.length/2);h++){var x=u[h].compareTo(u[u.length-1-h]);if(0!==x)return x}return 1},$r.compare=function(u,h){for(var y=0;y<u.length&&y<h.length;){var x=u[y].compareTo(h[y]);if(0!==x)return x;y++}return y<h.length?-1:y<u.length?1:0},$r.minCoordinate=function(u){for(var h=null,y=0;y<u.length;y++)(null===h||h.compareTo(u[y])>0)&&(h=u[y]);return h},$r.extract=function(u,h,y){h=Ne.clamp(h,0,u.length);var x=(y=Ne.clamp(y,-1,u.length))-h+1;y<0&&(x=0),h>=u.length&&(x=0),y<h&&(x=0);var T=new Array(x).fill(null);if(0===x)return T;for(var F=0,$=h;$<=y;$++)T[F++]=u[$];return T},Object.defineProperties($r,Ha);var ns=function(){};ns.prototype.compare=function(u,h){return $r.compare(u,h)},ns.prototype.interfaces_=function(){return[we]},ns.prototype.getClass=function(){return ns};var Oe=function(){};Oe.prototype.compare=function(u,h){var y=u,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;var T=$r.compare(y,x);return $r.isEqualReversed(y,x)?0:T},Oe.prototype.OLDcompare=function(u,h){var y=u,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;for(var T=$r.increasingDirection(y),F=$r.increasingDirection(x),$=T>0?0:y.length-1,ee=F>0?0:y.length-1,oe=0;oe<y.length;oe++){var st=y[$].compareTo(x[ee]);if(0!==st)return st;$+=T,ee+=F}return 0},Oe.prototype.interfaces_=function(){return[we]},Oe.prototype.getClass=function(){return Oe};var Y=function(){};Y.prototype.get=function(){},Y.prototype.put=function(){},Y.prototype.size=function(){},Y.prototype.values=function(){},Y.prototype.entrySet=function(){};var ie=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(Y);(p.prototype=new Error).name="OperationNotSupported",(Ce.prototype=new Ci).contains=function(){};var ke=function(u){function h(){u.call(this),this.array_=[],arguments[0]instanceof Ci&&this.addAll(arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.contains=function(y){for(var x=0,T=this.array_.length;x<T;x++)if(this.array_[x]===y)return!0;return!1},h.prototype.add=function(y){return!this.contains(y)&&(this.array_.push(y),!0)},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.remove=function(y){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.iterator=function(){return new Ye(this)},h}(Ce),Ye=function(u){function h(y){u.call(this),this.hashSet_=y,this.position_=0}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new ft;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(Ys),ot=0;(Gt.prototype=new ie).get=function(u){for(var h=this.root_;null!==h;){var y=u.compareTo(h.key);if(y<0)h=h.left;else{if(!(y>0))return h.value;h=h.right}}return null},Gt.prototype.put=function(u,h){if(null===this.root_)return this.root_={key:u,value:h,left:null,right:null,parent:null,color:ot,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var y,x,T=this.root_;do{if(y=T,(x=u.compareTo(T.key))<0)T=T.left;else{if(!(x>0)){var F=T.value;return T.value=h,F}T=T.right}}while(null!==T);var $={key:u,left:null,right:null,value:h,parent:y,color:ot,getValue:function(){return this.value},getKey:function(){return this.key}};return x<0?y.left=$:y.right=$,this.fixAfterInsertion($),this.size_++,null},Gt.prototype.fixAfterInsertion=function(u){for(u.color=1;null!=u&&u!==this.root_&&1===u.parent.color;)if(dt(u)===Lt(dt(dt(u)))){var h=un(dt(dt(u)));1===We(h)?(yt(dt(u),ot),yt(h,ot),yt(dt(dt(u)),1),u=dt(dt(u))):(u===un(dt(u))&&(u=dt(u),this.rotateLeft(u)),yt(dt(u),ot),yt(dt(dt(u)),1),this.rotateRight(dt(dt(u))))}else{var y=Lt(dt(dt(u)));1===We(y)?(yt(dt(u),ot),yt(y,ot),yt(dt(dt(u)),1),u=dt(dt(u))):(u===Lt(dt(u))&&(u=dt(u),this.rotateRight(u)),yt(dt(u),ot),yt(dt(dt(u)),1),this.rotateLeft(dt(dt(u))))}this.root_.color=ot},Gt.prototype.values=function(){var u=new An,h=this.getFirstEntry();if(null!==h)for(u.add(h.value);null!==(h=Gt.successor(h));)u.add(h.value);return u},Gt.prototype.entrySet=function(){var u=new ke,h=this.getFirstEntry();if(null!==h)for(u.add(h);null!==(h=Gt.successor(h));)u.add(h);return u},Gt.prototype.rotateLeft=function(u){if(null!=u){var h=u.right;u.right=h.left,null!=h.left&&(h.left.parent=u),h.parent=u.parent,null===u.parent?this.root_=h:u.parent.left===u?u.parent.left=h:u.parent.right=h,h.left=u,u.parent=h}},Gt.prototype.rotateRight=function(u){if(null!=u){var h=u.left;u.left=h.right,null!=h.right&&(h.right.parent=u),h.parent=u.parent,null===u.parent?this.root_=h:u.parent.right===u?u.parent.right=h:u.parent.left=h,h.right=u,u.parent=h}},Gt.prototype.getFirstEntry=function(){var u=this.root_;if(null!=u)for(;null!=u.left;)u=u.left;return u},Gt.successor=function(u){if(null===u)return null;if(null!==u.right){for(var h=u.right;null!==h.left;)h=h.left;return h}for(var y=u.parent,x=u;null!==y&&x===y.right;)x=y,y=y.parent;return y},Gt.prototype.size=function(){return this.size_};var Mt=function(){};Mt.prototype.interfaces_=function(){return[]},Mt.prototype.getClass=function(){return Mt},Tt.prototype=new Ce,(Xt.prototype=new Tt).contains=function(u){for(var h=0,y=this.array_.length;h<y;h++)if(0===this.array_[h].compareTo(u))return!0;return!1},Xt.prototype.add=function(u){if(this.contains(u))return!1;for(var h=0,y=this.array_.length;h<y;h++)if(1===this.array_[h].compareTo(u))return this.array_.splice(h,0,u),!0;return this.array_.push(u),!0},Xt.prototype.addAll=function(u){for(var h=u.iterator();h.hasNext();)this.add(h.next());return!0},Xt.prototype.remove=function(u){throw new p},Xt.prototype.size=function(){return this.array_.length},Xt.prototype.isEmpty=function(){return 0===this.array_.length},Xt.prototype.toArray=function(){for(var u=[],h=0,y=this.array_.length;h<y;h++)u.push(this.array_[h]);return u},Xt.prototype.iterator=function(){return new Ct(this)};var Ct=function(u){this.treeSet_=u,this.position_=0};Ct.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new ft;return this.treeSet_.array_[this.position_++]},Ct.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Ct.prototype.remove=function(){throw new p};var lt=function(){};lt.sort=function(){var u,h,y,T=arguments[0];if(1===arguments.length)T.sort(function($,ee){return $.compareTo(ee)});else if(2===arguments.length)y=arguments[1],T.sort(function($,ee){return y.compare($,ee)});else if(3===arguments.length){(h=T.slice(arguments[1],arguments[2])).sort();var F=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length));for(T.splice(0,T.length),u=0;u<F.length;u++)T.push(F[u])}else if(4===arguments.length)for(h=T.slice(arguments[1],arguments[2]),y=arguments[3],h.sort(function($,ee){return y.compare($,ee)}),F=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length)),T.splice(0,T.length),u=0;u<F.length;u++)T.push(F[u])},lt.asList=function(u){for(var h=new An,y=0,x=u.length;y<x;y++)h.add(u[y]);return h};var ht=function(){},nn={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};nn.P.get=function(){return 0},nn.L.get=function(){return 1},nn.A.get=function(){return 2},nn.FALSE.get=function(){return-1},nn.TRUE.get=function(){return-2},nn.DONTCARE.get=function(){return-3},nn.SYM_FALSE.get=function(){return"F"},nn.SYM_TRUE.get=function(){return"T"},nn.SYM_DONTCARE.get=function(){return"*"},nn.SYM_P.get=function(){return"0"},nn.SYM_L.get=function(){return"1"},nn.SYM_A.get=function(){return"2"},ht.prototype.interfaces_=function(){return[]},ht.prototype.getClass=function(){return ht},ht.toDimensionSymbol=function(u){switch(u){case ht.FALSE:return ht.SYM_FALSE;case ht.TRUE:return ht.SYM_TRUE;case ht.DONTCARE:return ht.SYM_DONTCARE;case ht.P:return ht.SYM_P;case ht.L:return ht.SYM_L;case ht.A:return ht.SYM_A}throw new Q("Unknown dimension value: "+u)},ht.toDimensionValue=function(u){switch(vt.toUpperCase(u)){case ht.SYM_FALSE:return ht.FALSE;case ht.SYM_TRUE:return ht.TRUE;case ht.SYM_DONTCARE:return ht.DONTCARE;case ht.SYM_P:return ht.P;case ht.SYM_L:return ht.L;case ht.SYM_A:return ht.A}throw new Q("Unknown dimension symbol: "+u)},Object.defineProperties(ht,nn);var Rn=function(){};Rn.prototype.filter=function(u){},Rn.prototype.interfaces_=function(){return[]},Rn.prototype.getClass=function(){return Rn};var cn=function(){};cn.prototype.filter=function(u,h){},cn.prototype.isDone=function(){},cn.prototype.isGeometryChanged=function(){},cn.prototype.interfaces_=function(){return[]},cn.prototype.getClass=function(){return cn};var rr=function(u){function h(x,T){if(u.call(this,T),this._geometries=x||[],u.hasNullElements(this._geometries))throw new Q("geometries must not contain null elements")}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var x=new wn,T=0;T<this._geometries.length;T++)x.expandToInclude(this._geometries[T].getEnvelopeInternal());return x},h.prototype.getGeometryN=function(x){return this._geometries[x]},h.prototype.getSortIndex=function(){return u.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var x=new Array(this.getNumPoints()).fill(null),T=-1,F=0;F<this._geometries.length;F++)for(var $=this._geometries[F].getCoordinates(),ee=0;ee<$.length;ee++)x[++T]=$[ee];return x},h.prototype.getArea=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getArea();return x},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(this._geometries.length!==F._geometries.length)return!1;for(var $=0;$<this._geometries.length;$++)if(!this._geometries[$].equalsExact(F._geometries[$],T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<this._geometries.length;x++)this._geometries[x].normalize();lt.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var x=ht.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getBoundaryDimension());return x},h.prototype.getDimension=function(){for(var x=ht.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getDimension());return x},h.prototype.getLength=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getNumPoints();return x},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),F=0;F<this._geometries.length;F++)T[F]=this._geometries[F].reverse();return this.getFactory().createGeometryCollection(T)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0],T=new Xt(lt.asList(this._geometries)),F=new Xt(lt.asList(x._geometries));return this.compare(T,F)}if(2===arguments.length){for(var ee=arguments[1],oe=arguments[0],st=this.getNumGeometries(),Zt=oe.getNumGeometries(),Qt=0;Qt<st&&Qt<Zt;){var xt=this.getGeometryN(Qt),mn=oe.getGeometryN(Qt),ur=xt.compareToSameClass(mn,ee);if(0!==ur)return ur;Qt++}return Qt<st?1:Qt<Zt?-1:0}},h.prototype.apply=function(){if(kt(arguments[0],vi))for(var x=arguments[0],T=0;T<this._geometries.length;T++)this._geometries[T].apply(x);else if(kt(arguments[0],cn)){var F=arguments[0];if(0===this._geometries.length)return null;for(var $=0;$<this._geometries.length&&(this._geometries[$].apply(F),!F.isDone());$++);F.isGeometryChanged()&&this.geometryChanged()}else if(kt(arguments[0],Rn)){var ee=arguments[0];ee.filter(this);for(var oe=0;oe<this._geometries.length;oe++)this._geometries[oe].apply(ee)}else if(kt(arguments[0],lr)){var st=arguments[0];st.filter(this);for(var Zt=0;Zt<this._geometries.length;Zt++)this._geometries[Zt].apply(st)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),se.shouldNeverReachHere(),null},h.prototype.clone=function(){var x=u.prototype.clone.call(this);x._geometries=new Array(this._geometries.length).fill(null);for(var T=0;T<this._geometries.length;T++)x._geometries[T]=this._geometries[T].clone();return x},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.isEmpty=function(){for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,y),h}(On),cr=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return On.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var x=this._geometries.length,T=new Array(x).fill(null),F=0;F<this._geometries.length;F++)T[x-1-F]=this._geometries[F].reverse();return this.getFactory().createMultiLineString(T)},h.prototype.getBoundary=function(){return new ir(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[Mt]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,y),h}(rr),ir=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var u=arguments[0],h=Pi.MOD2_BOUNDARY_RULE;this._geom=u,this._geomFact=u.getFactory(),this._bnRule=h}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this._geom=y,this._geomFact=y.getFactory(),this._bnRule=x}};ir.prototype.boundaryMultiLineString=function(u){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(u);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},ir.prototype.getBoundary=function(){return this._geom instanceof gr?this.boundaryLineString(this._geom):this._geom instanceof cr?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},ir.prototype.boundaryLineString=function(u){return this._geom.isEmpty()?this.getEmptyMultiPoint():u.isClosed()?this._bnRule.isInBoundary(2)?u.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([u.getStartPoint(),u.getEndPoint()])},ir.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},ir.prototype.computeBoundaryCoordinates=function(u){var h=new An;this._endpointMap=new Gt;for(var y=0;y<u.getNumGeometries();y++){var x=u.getGeometryN(y);0!==x.getNumPoints()&&(this.addEndpoint(x.getCoordinateN(0)),this.addEndpoint(x.getCoordinateN(x.getNumPoints()-1)))}for(var T=this._endpointMap.entrySet().iterator();T.hasNext();){var F=T.next(),$=F.getValue().count;this._bnRule.isInBoundary($)&&h.add(F.getKey())}return $r.toCoordinateArray(h)},ir.prototype.addEndpoint=function(u){var h=this._endpointMap.get(u);null===h&&(h=new Mr,this._endpointMap.put(u,h)),h.count++},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir},ir.getBoundary=function(){return 1===arguments.length?new ir(arguments[0]).getBoundary():2===arguments.length?new ir(arguments[0],arguments[1]).getBoundary():void 0};var Mr=function(){this.count=null};Mr.prototype.interfaces_=function(){return[]},Mr.prototype.getClass=function(){return Mr};var Dr=function(){},ji={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Dr.prototype.interfaces_=function(){return[]},Dr.prototype.getClass=function(){return Dr},Dr.chars=function(u,h){for(var y=new Array(h).fill(null),x=0;x<h;x++)y[x]=u;return String(y)},Dr.getStackTrace=function(){if(1===arguments.length){var u=arguments[0],h=new function(){},y=new function(){}(h);return u.printStackTrace(y),h.toString()}if(2===arguments.length){for(var T=arguments[1],F="",$=new function(){}(new function(){}(Dr.getStackTrace(arguments[0]))),ee=0;ee<T;ee++)try{F+=$.readLine()+Dr.NEWLINE}catch(oe){if(!(oe instanceof Dn))throw oe;se.shouldNeverReachHere()}return F}},Dr.split=function(u,h){for(var y=h.length,x=new An,T=""+u,F=T.indexOf(h);F>=0;){var $=T.substring(0,F);x.add($),F=(T=T.substring(F+y)).indexOf(h)}T.length>0&&x.add(T);for(var ee=new Array(x.size()).fill(null),oe=0;oe<ee.length;oe++)ee[oe]=x.get(oe);return ee},Dr.toString=function(){if(1===arguments.length)return Dr.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},Dr.spaces=function(u){return Dr.chars(" ",u)},ji.NEWLINE.get=function(){return kn.getProperty("line.separator")},ji.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(Dr,ji);var tr=function(){};tr.prototype.interfaces_=function(){return[]},tr.prototype.getClass=function(){return tr},tr.copyCoord=function(u,h,y,x){for(var T=Math.min(u.getDimension(),y.getDimension()),F=0;F<T;F++)y.setOrdinate(x,F,u.getOrdinate(h,F))},tr.isRing=function(u){var h=u.size();return 0===h||!(h<=3)&&u.getOrdinate(0,jt.X)===u.getOrdinate(h-1,jt.X)&&u.getOrdinate(0,jt.Y)===u.getOrdinate(h-1,jt.Y)},tr.isEqual=function(u,h){var y=u.size();if(y!==h.size())return!1;for(var x=Math.min(u.getDimension(),h.getDimension()),T=0;T<y;T++)for(var F=0;F<x;F++){var $=u.getOrdinate(T,F),ee=h.getOrdinate(T,F);if(!(u.getOrdinate(T,F)===h.getOrdinate(T,F)||fe.isNaN($)&&fe.isNaN(ee)))return!1}return!0},tr.extend=function(u,h,y){var x=u.create(y,h.getDimension()),T=h.size();if(tr.copy(h,0,x,0,T),T>0)for(var F=T;F<y;F++)tr.copy(h,T-1,x,F,1);return x},tr.reverse=function(u){for(var h=u.size()-1,y=Math.trunc(h/2),x=0;x<=y;x++)tr.swap(u,x,h-x)},tr.swap=function(u,h,y){if(h===y)return null;for(var x=0;x<u.getDimension();x++){var T=u.getOrdinate(h,x);u.setOrdinate(h,x,u.getOrdinate(y,x)),u.setOrdinate(y,x,T)}},tr.copy=function(u,h,y,x,T){for(var F=0;F<T;F++)tr.copyCoord(u,h+F,y,x+F)},tr.toString=function(){if(1===arguments.length){var u=arguments[0],h=u.size();if(0===h)return"()";var y=u.getDimension(),x=new Ee;x.append("(");for(var T=0;T<h;T++){T>0&&x.append(" ");for(var F=0;F<y;F++)F>0&&x.append(","),x.append(Dr.toString(u.getOrdinate(T,F)))}return x.append(")"),x.toString()}},tr.ensureValidRing=function(u,h){var y=h.size();return 0===y?h:y<=3?tr.createClosedRing(u,h,4):h.getOrdinate(0,jt.X)===h.getOrdinate(y-1,jt.X)&&h.getOrdinate(0,jt.Y)===h.getOrdinate(y-1,jt.Y)?h:tr.createClosedRing(u,h,y+1)},tr.createClosedRing=function(u,h,y){var x=u.create(y,h.getDimension()),T=h.size();tr.copy(h,0,x,0,T);for(var F=T;F<y;F++)tr.copy(h,0,x,F,1);return x};var gr=function(u){function h(x,T){u.call(this,T),this._points=null,this.init(x)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new wn:this._points.expandEnvelope(new wn)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return u.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(this._points.size()!==F._points.size())return!1;for(var $=0;$<this._points.size();$++)if(!this.equal(this._points.getCoordinate($),F._points.getCoordinate($),T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<Math.trunc(this._points.size()/2);x++){var T=this._points.size()-1-x;if(!this._points.getCoordinate(x).equals(this._points.getCoordinate(T)))return this._points.getCoordinate(x).compareTo(this._points.getCoordinate(T))>0&&tr.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?ht.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return Kt.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var x=this._points.copy();return tr.reverse(x),this.getFactory().createLineString(x)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var x=arguments[0],T=0,F=0;T<this._points.size()&&F<x._points.size();){var $=this._points.getCoordinate(T).compareTo(x._points.getCoordinate(F));if(0!==$)return $;T++,F++}return T<this._points.size()?1:F<x._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(kt(arguments[0],vi))for(var x=arguments[0],T=0;T<this._points.size();T++)x.filter(this._points.getCoordinate(T));else if(kt(arguments[0],cn)){var F=arguments[0];if(0===this._points.size())return null;for(var $=0;$<this._points.size()&&(F.filter(this._points,$),!F.isDone());$++);F.isGeometryChanged()&&this.geometryChanged()}else(kt(arguments[0],Rn)||kt(arguments[0],lr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new ir(this).getBoundary()},h.prototype.isEquivalentClass=function(x){return x instanceof h},h.prototype.clone=function(){var x=u.prototype.clone.call(this);return x._points=this._points.clone(),x},h.prototype.getCoordinateN=function(x){return this._points.getCoordinate(x)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(x){if(null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),1===x.size())throw new Q("Invalid number of points in LineString (found "+x.size()+" - must be 0 or >= 2)");this._points=x},h.prototype.isCoordinate=function(x){for(var T=0;T<this._points.size();T++)if(this._points.getCoordinate(T).equals(x))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(x){return this.getFactory().createPoint(this._points.getCoordinate(x))},h.prototype.interfaces_=function(){return[Mt]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,y),h}(On),Gi=function(){};Gi.prototype.interfaces_=function(){return[]},Gi.prototype.getClass=function(){return Gi};var ks=function(u){function h(x,T){u.call(this,T),this._coordinates=x||null,this.init(this._coordinates)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new wn;var x=new wn;return x.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),x},h.prototype.getSortIndex=function(){return u.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&(!(!this.isEmpty()||!x.isEmpty())||this.isEmpty()===x.isEmpty()&&this.equal(x.getCoordinate(),this.getCoordinate(),T))}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0];return this.getCoordinate().compareTo(x.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(kt(arguments[0],vi)){var x=arguments[0];if(this.isEmpty())return null;x.filter(this.getCoordinate())}else if(kt(arguments[0],cn)){var T=arguments[0];if(this.isEmpty())return null;T.filter(this._coordinates,0),T.isGeometryChanged()&&this.geometryChanged()}else(kt(arguments[0],Rn)||kt(arguments[0],lr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var x=u.prototype.clone.call(this);return x._coordinates=this._coordinates.clone(),x},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(x){null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),se.isTrue(x.size()<=1),this._coordinates=x},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[Gi]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,y),h}(On),ia=function(){};ia.prototype.interfaces_=function(){return[]},ia.prototype.getClass=function(){return ia};var zt=function(u){function h(x,T,F){if(u.call(this,F),this._shell=null,this._holes=null,null===x&&(x=this.getFactory().createLinearRing()),null===T&&(T=[]),u.hasNullElements(T))throw new Q("holes must not contain null elements");if(x.isEmpty()&&u.hasNonEmptyElements(T))throw new Q("shell is empty but holes are not");this._shell=x,this._holes=T}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return u.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var x=new Array(this.getNumPoints()).fill(null),T=-1,F=this._shell.getCoordinates(),$=0;$<F.length;$++)x[++T]=F[$];for(var ee=0;ee<this._holes.length;ee++)for(var oe=this._holes[ee].getCoordinates(),st=0;st<oe.length;st++)x[++T]=oe[st];return x},h.prototype.getArea=function(){var x=0;x+=Math.abs(Kt.signedArea(this._shell.getCoordinateSequence()));for(var T=0;T<this._holes.length;T++)x-=Math.abs(Kt.signedArea(this._holes[T].getCoordinateSequence()));return x},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var x=this._shell.getCoordinateSequence(),T=this.getEnvelopeInternal(),F=0;F<5;F++){var $=x.getX(F);if($!==T.getMinX()&&$!==T.getMaxX())return!1;var ee=x.getY(F);if(ee!==T.getMinY()&&ee!==T.getMaxY())return!1}for(var oe=x.getX(0),st=x.getY(0),Zt=1;Zt<=4;Zt++){var Qt=x.getX(Zt),xt=x.getY(Zt);if(Qt!==oe==(xt!==st))return!1;oe=Qt,st=xt}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var F=x;if(!this._shell.equalsExact(F._shell,T)||this._holes.length!==F._holes.length)return!1;for(var oe=0;oe<this._holes.length;oe++)if(!this._holes[oe].equalsExact(F._holes[oe],T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var x=0;x<this._holes.length;x++)this.normalize(this._holes[x],!1);lt.sort(this._holes)}else if(2===arguments.length){var T=arguments[0],F=arguments[1];if(T.isEmpty())return null;var $=new Array(T.getCoordinates().length-1).fill(null);kn.arraycopy(T.getCoordinates(),0,$,0,$.length);var ee=$r.minCoordinate(T.getCoordinates());$r.scroll($,ee),kn.arraycopy($,0,T.getCoordinates(),0,$.length),T.getCoordinates()[$.length]=$[0],Kt.isCCW(T.getCoordinates())===F&&$r.reverse(T.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var x=0;x+=this._shell.getLength();for(var T=0;T<this._holes.length;T++)x+=this._holes[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=this._shell.getNumPoints(),T=0;T<this._holes.length;T++)x+=this._holes[T].getNumPoints();return x},h.prototype.reverse=function(){var x=this.copy();x._shell=this._shell.copy().reverse(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].copy().reverse();return x},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var ee=arguments[1],oe=arguments[0],Qt=this._shell.compareToSameClass(oe._shell,ee);if(0!==Qt)return Qt;for(var xt=this.getNumInteriorRing(),mn=oe.getNumInteriorRing(),ur=0;ur<xt&&ur<mn;){var Cr=this.getInteriorRingN(ur),ti=oe.getInteriorRingN(ur),bs=Cr.compareToSameClass(ti,ee);if(0!==bs)return bs;ur++}return ur<xt?1:ur<mn?-1:0}},h.prototype.apply=function(x){if(kt(x,vi)){this._shell.apply(x);for(var T=0;T<this._holes.length;T++)this._holes[T].apply(x)}else if(kt(x,cn)){if(this._shell.apply(x),!x.isDone())for(var F=0;F<this._holes.length&&(this._holes[F].apply(x),!x.isDone());F++);x.isGeometryChanged()&&this.geometryChanged()}else if(kt(x,Rn))x.filter(this);else if(kt(x,lr)){x.filter(this),this._shell.apply(x);for(var $=0;$<this._holes.length;$++)this._holes[$].apply(x)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var x=new Array(this._holes.length+1).fill(null);x[0]=this._shell;for(var T=0;T<this._holes.length;T++)x[T+1]=this._holes[T];return x.length<=1?this.getFactory().createLinearRing(x[0].getCoordinateSequence()):this.getFactory().createMultiLineString(x)},h.prototype.clone=function(){var x=u.prototype.clone.call(this);x._shell=this._shell.clone(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].clone();return x},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var x=this._shell.copy(),T=new Array(this._holes.length).fill(null),F=0;F<T.length;F++)T[F]=this._holes[F].copy();return new h(x,T,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(x){return this._holes[x]},h.prototype.interfaces_=function(){return[ia]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,y),h}(On),Na=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return On.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():u.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[Gi]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,y),h}(rr),so=function(u){function h(x,T){x instanceof J&&T instanceof Br&&(x=T.getCoordinateSequenceFactory().create(x)),u.call(this,x,T),this.validateConstruction()}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return On.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return ht.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||u.prototype.isClosed.call(this)},h.prototype.reverse=function(){var x=this._points.copy();return tr.reverse(x),this.getFactory().createLinearRing(x)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!u.prototype.isClosed.call(this))throw new Q("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new Q("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.MINIMUM_VALID_SIZE.get=function(){return 4},y.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,y),h}(gr),Hi=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return On.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),F=0;F<this._geometries.length;F++)T[F]=this._geometries[F].reverse();return this.getFactory().createMultiPolygon(T)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var x=new An,T=0;T<this._geometries.length;T++)for(var F=this._geometries[T].getBoundary(),$=0;$<F.getNumGeometries();$++)x.add(F.getGeometryN($));var ee=new Array(x.size()).fill(null);return this.getFactory().createMultiLineString(x.toArray(ee))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[ia]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,y),h}(rr),Ki=function(u){this._factory=u||null,this._isUserDataCopied=!1},du={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Ki.prototype.setCopyUserData=function(u){this._isUserDataCopied=u},Ki.prototype.edit=function(u,h){if(null===u)return null;var y=this.editInternal(u,h);return this._isUserDataCopied&&y.setUserData(u.getUserData()),y},Ki.prototype.editInternal=function(u,h){return null===this._factory&&(this._factory=u.getFactory()),u instanceof rr?this.editGeometryCollection(u,h):u instanceof zt?this.editPolygon(u,h):u instanceof ks||u instanceof gr?h.edit(u,this._factory):(se.shouldNeverReachHere("Unsupported Geometry class: "+u.getClass().getName()),null)},Ki.prototype.editGeometryCollection=function(u,h){for(var y=h.edit(u,this._factory),x=new An,T=0;T<y.getNumGeometries();T++){var F=this.edit(y.getGeometryN(T),h);null===F||F.isEmpty()||x.add(F)}return y.getClass()===Na?this._factory.createMultiPoint(x.toArray([])):y.getClass()===cr?this._factory.createMultiLineString(x.toArray([])):y.getClass()===Hi?this._factory.createMultiPolygon(x.toArray([])):this._factory.createGeometryCollection(x.toArray([]))},Ki.prototype.editPolygon=function(u,h){var y=h.edit(u,this._factory);if(null===y&&(y=this._factory.createPolygon(null)),y.isEmpty())return y;var x=this.edit(y.getExteriorRing(),h);if(null===x||x.isEmpty())return this._factory.createPolygon();for(var T=new An,F=0;F<y.getNumInteriorRing();F++){var $=this.edit(y.getInteriorRingN(F),h);null===$||$.isEmpty()||T.add($)}return this._factory.createPolygon(x,T.toArray([]))},Ki.prototype.interfaces_=function(){return[]},Ki.prototype.getClass=function(){return Ki},Ki.GeometryEditorOperation=function(){},du.NoOpGeometryOperation.get=function(){return Ea},du.CoordinateOperation.get=function(){return Ca},du.CoordinateSequenceOperation.get=function(){return Fi},Object.defineProperties(Ki,du);var Ea=function(){};Ea.prototype.edit=function(u,h){return u},Ea.prototype.interfaces_=function(){return[Ki.GeometryEditorOperation]},Ea.prototype.getClass=function(){return Ea};var Ca=function(){};Ca.prototype.edit=function(u,h){var y=this.editCoordinates(u.getCoordinates(),u);return null===y?u:u instanceof so?h.createLinearRing(y):u instanceof gr?h.createLineString(y):u instanceof ks?y.length>0?h.createPoint(y[0]):h.createPoint():u},Ca.prototype.interfaces_=function(){return[Ki.GeometryEditorOperation]},Ca.prototype.getClass=function(){return Ca};var Fi=function(){};Fi.prototype.edit=function(u,h){return u instanceof so?h.createLinearRing(this.edit(u.getCoordinateSequence(),u)):u instanceof gr?h.createLineString(this.edit(u.getCoordinateSequence(),u)):u instanceof ks?h.createPoint(this.edit(u.getCoordinateSequence(),u)):u},Fi.prototype.interfaces_=function(){return[Ki.GeometryEditorOperation]},Fi.prototype.getClass=function(){return Fi};var gn=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var h=0;h<u;h++)this._coordinates[h]=new J}else if(kt(arguments[0],jt)){var y=arguments[0];if(null===y)return this._coordinates=new Array(0).fill(null),null;this._dimension=y.getDimension(),this._coordinates=new Array(y.size()).fill(null);for(var x=0;x<this._coordinates.length;x++)this._coordinates[x]=y.getCoordinateCopy(x)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var T=arguments[0],F=arguments[1];this._coordinates=T,this._dimension=F,null===T&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var $=arguments[0],ee=arguments[1];this._coordinates=new Array($).fill(null),this._dimension=ee;for(var oe=0;oe<$;oe++)this._coordinates[oe]=new J}},or={serialVersionUID:{configurable:!0}};gn.prototype.setOrdinate=function(u,h,y){switch(h){case jt.X:this._coordinates[u].x=y;break;case jt.Y:this._coordinates[u].y=y;break;case jt.Z:this._coordinates[u].z=y;break;default:throw new Q("invalid ordinateIndex")}},gn.prototype.size=function(){return this._coordinates.length},gn.prototype.getOrdinate=function(u,h){switch(h){case jt.X:return this._coordinates[u].x;case jt.Y:return this._coordinates[u].y;case jt.Z:return this._coordinates[u].z}return fe.NaN},gn.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],y=arguments[1];y.x=this._coordinates[h].x,y.y=this._coordinates[h].y,y.z=this._coordinates[h].z}},gn.prototype.getCoordinateCopy=function(u){return new J(this._coordinates[u])},gn.prototype.getDimension=function(){return this._dimension},gn.prototype.getX=function(u){return this._coordinates[u].x},gn.prototype.clone=function(){for(var u=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)u[h]=this._coordinates[h].clone();return new gn(u,this._dimension)},gn.prototype.expandEnvelope=function(u){for(var h=0;h<this._coordinates.length;h++)u.expandToInclude(this._coordinates[h]);return u},gn.prototype.copy=function(){for(var u=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)u[h]=this._coordinates[h].copy();return new gn(u,this._dimension)},gn.prototype.toString=function(){if(this._coordinates.length>0){var u=new Ee(17*this._coordinates.length);u.append("("),u.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)u.append(", "),u.append(this._coordinates[h]);return u.append(")"),u.toString()}return"()"},gn.prototype.getY=function(u){return this._coordinates[u].y},gn.prototype.toCoordinateArray=function(){return this._coordinates},gn.prototype.interfaces_=function(){return[jt,Te]},gn.prototype.getClass=function(){return gn},or.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(gn,or);var Vr=function(){},Eu={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Vr.prototype.readResolve=function(){return Vr.instance()},Vr.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new gn(arguments[0]);if(kt(arguments[0],jt))return new gn(arguments[0])}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return x>3&&(x=3),x<2?new gn(y):new gn(y,x)}},Vr.prototype.interfaces_=function(){return[$e,Te]},Vr.prototype.getClass=function(){return Vr},Vr.instance=function(){return Vr.instanceObject},Eu.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Eu.instanceObject.get=function(){return new Vr},Object.defineProperties(Vr,Eu);var sl=function(u){function h(){u.call(this),this.map_=new Map}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.get=function(y){return this.map_.get(y)||null},h.prototype.put=function(y,x){return this.map_.set(y,x),x},h.prototype.values=function(){for(var y=new An,x=this.map_.values(),T=x.next();!T.done;)y.add(T.value),T=x.next();return y},h.prototype.entrySet=function(){var y=new ke;return this.map_.entries().forEach(function(x){return y.add(x)}),y},h.prototype.size=function(){return this.map_.size()},h}(Y),hn=function u(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=u.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof oa){var h=arguments[0];this._modelType=h,h===u.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var y=arguments[0];this._modelType=u.FIXED,this.setScale(y)}else if(arguments[0]instanceof u){var x=arguments[0];this._modelType=x._modelType,this._scale=x._scale}},Wu={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};hn.prototype.equals=function(u){return u instanceof hn&&this._modelType===u._modelType&&this._scale===u._scale},hn.prototype.compareTo=function(u){var h=u,y=this.getMaximumSignificantDigits(),x=h.getMaximumSignificantDigits();return new it(y).compareTo(new it(x))},hn.prototype.getScale=function(){return this._scale},hn.prototype.isFloating=function(){return this._modelType===hn.FLOATING||this._modelType===hn.FLOATING_SINGLE},hn.prototype.getType=function(){return this._modelType},hn.prototype.toString=function(){var u="UNKNOWN";return this._modelType===hn.FLOATING?u="Floating":this._modelType===hn.FLOATING_SINGLE?u="Floating-Single":this._modelType===hn.FIXED&&(u="Fixed (Scale="+this.getScale()+")"),u},hn.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var u=arguments[0];return fe.isNaN(u)||this._modelType===hn.FLOATING_SINGLE?u:this._modelType===hn.FIXED?Math.round(u*this._scale)/this._scale:u}if(arguments[0]instanceof J){var h=arguments[0];if(this._modelType===hn.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},hn.prototype.getMaximumSignificantDigits=function(){var u=16;return this._modelType===hn.FLOATING?u=16:this._modelType===hn.FLOATING_SINGLE?u=6:this._modelType===hn.FIXED&&(u=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),u},hn.prototype.setScale=function(u){this._scale=Math.abs(u)},hn.prototype.interfaces_=function(){return[Te,pe]},hn.prototype.getClass=function(){return hn},hn.mostPrecise=function(u,h){return u.compareTo(h)>=0?u:h},Wu.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Wu.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(hn,Wu);var oa=function u(h){this._name=h||null,u.nameToTypeMap.put(h,this)},Nl={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};oa.prototype.readResolve=function(){return oa.nameToTypeMap.get(this._name)},oa.prototype.toString=function(){return this._name},oa.prototype.interfaces_=function(){return[Te]},oa.prototype.getClass=function(){return oa},Nl.serialVersionUID.get=function(){return-552860263173159e4},Nl.nameToTypeMap.get=function(){return new sl},Object.defineProperties(oa,Nl),hn.Type=oa,hn.FIXED=new oa("FIXED"),hn.FLOATING=new oa("FLOATING"),hn.FLOATING_SINGLE=new oa("FLOATING SINGLE");var Br=function u(){this._precisionModel=new hn,this._SRID=0,this._coordinateSequenceFactory=u.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?kt(arguments[0],$e)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof hn&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Fn={serialVersionUID:{configurable:!0}};Br.prototype.toGeometry=function(u){return u.isNull()?this.createPoint(null):u.getMinX()===u.getMaxX()&&u.getMinY()===u.getMaxY()?this.createPoint(new J(u.getMinX(),u.getMinY())):u.getMinX()===u.getMaxX()||u.getMinY()===u.getMaxY()?this.createLineString([new J(u.getMinX(),u.getMinY()),new J(u.getMaxX(),u.getMaxY())]):this.createPolygon(this.createLinearRing([new J(u.getMinX(),u.getMinY()),new J(u.getMinX(),u.getMaxY()),new J(u.getMaxX(),u.getMaxY()),new J(u.getMaxX(),u.getMinY()),new J(u.getMinX(),u.getMinY())]),null)},Br.prototype.createLineString=function(u){return u?u instanceof Array?new gr(this.getCoordinateSequenceFactory().create(u),this):kt(u,jt)?new gr(u,this):void 0:new gr(this.getCoordinateSequenceFactory().create([]),this)},Br.prototype.createMultiLineString=function(){return 0===arguments.length?new cr(null,this):1===arguments.length?new cr(arguments[0],this):void 0},Br.prototype.buildGeometry=function(u){for(var h=null,y=!1,x=!1,T=u.iterator();T.hasNext();){var F=T.next(),$=F.getClass();null===h&&(h=$),$!==h&&(y=!0),F.isGeometryCollectionOrDerived()&&(x=!0)}if(null===h)return this.createGeometryCollection();if(y||x)return this.createGeometryCollection(Br.toGeometryArray(u));var ee=u.iterator().next();if(u.size()>1){if(ee instanceof zt)return this.createMultiPolygon(Br.toPolygonArray(u));if(ee instanceof gr)return this.createMultiLineString(Br.toLineStringArray(u));if(ee instanceof ks)return this.createMultiPoint(Br.toPointArray(u));se.shouldNeverReachHere("Unhandled class: "+ee.getClass().getName())}return ee},Br.prototype.createMultiPointFromCoords=function(u){return this.createMultiPoint(null!==u?this.getCoordinateSequenceFactory().create(u):null)},Br.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];return this.createPoint(null!==u?this.getCoordinateSequenceFactory().create([u]):null)}if(kt(arguments[0],jt))return new ks(arguments[0],this)}},Br.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},Br.prototype.createPolygon=function(){if(0===arguments.length)return new zt(null,null,this);if(1===arguments.length){if(kt(arguments[0],jt))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof so)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new zt(arguments[0],arguments[1],this)},Br.prototype.getSRID=function(){return this._SRID},Br.prototype.createGeometryCollection=function(){return 0===arguments.length?new rr(null,this):1===arguments.length?new rr(arguments[0],this):void 0},Br.prototype.createGeometry=function(u){return new Ki(this).edit(u,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},Br.prototype.getPrecisionModel=function(){return this._precisionModel},Br.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var u=arguments[0];return this.createLinearRing(null!==u?this.getCoordinateSequenceFactory().create(u):null)}if(kt(arguments[0],jt))return new so(arguments[0],this)}},Br.prototype.createMultiPolygon=function(){return 0===arguments.length?new Hi(null,this):1===arguments.length?new Hi(arguments[0],this):void 0},Br.prototype.createMultiPoint=function(){if(0===arguments.length)return new Na(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Na(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(kt(arguments[0],jt)){var y=arguments[0];if(null===y)return this.createMultiPoint(new Array(0).fill(null));for(var x=new Array(y.size()).fill(null),T=0;T<y.size();T++){var F=this.getCoordinateSequenceFactory().create(1,y.getDimension());tr.copy(y,T,F,0,1),x[T]=this.createPoint(F)}return this.createMultiPoint(x)}}},Br.prototype.interfaces_=function(){return[Te]},Br.prototype.getClass=function(){return Br},Br.toMultiPolygonArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toGeometryArray=function(u){if(null===u)return null;var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.getDefaultCoordinateSequenceFactory=function(){return Vr.instance()},Br.toMultiLineStringArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toLineStringArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toMultiPointArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toLinearRingArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toPointArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.toPolygonArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},Br.createPointFromInternalCoord=function(u,h){return h.getPrecisionModel().makePrecise(u),h.getFactory().createPoint(u)},Fn.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(Br,Fn);var Cc=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],k=function(u){this.geometryFactory=u||new Br};k.prototype.read=function(u){var h,y=(h="string"==typeof u?JSON.parse(u):u).type;if(!q[y])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==Cc.indexOf(y)?q[y].apply(this,[h.coordinates]):q[y].apply(this,"GeometryCollection"===y?[h.geometries]:[h])},k.prototype.write=function(u){var h=u.getGeometryType();if(!he[h])throw new Error("Geometry is not supported");return he[h].apply(this,[u])};var q={Feature:function(u){var h={};for(var y in u)h[y]=u[y];if(u.geometry){if(!q[u.geometry.type])throw new Error("Unknown GeoJSON type: "+u.type);h.geometry=this.read(u.geometry)}return u.bbox&&(h.bbox=q.bbox.apply(this,[u.bbox])),h},FeatureCollection:function(u){var h={};if(u.features){h.features=[];for(var y=0;y<u.features.length;++y)h.features.push(this.read(u.features[y]))}return u.bbox&&(h.bbox=this.parse.bbox.apply(this,[u.bbox])),h},coordinates:function(u){for(var h=[],y=0;y<u.length;++y){var x=u[y];h.push(new J(x[0],x[1]))}return h},bbox:function(u){return this.geometryFactory.createLinearRing([new J(u[0],u[1]),new J(u[2],u[1]),new J(u[2],u[3]),new J(u[0],u[3]),new J(u[0],u[1])])},Point:function(u){var h=new J(u[0],u[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(u){for(var h=[],y=0;y<u.length;++y)h.push(q.Point.apply(this,[u[y]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(u){var h=q.coordinates.apply(this,[u]);return this.geometryFactory.createLineString(h)},MultiLineString:function(u){for(var h=[],y=0;y<u.length;++y)h.push(q.LineString.apply(this,[u[y]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(u){for(var h=q.coordinates.apply(this,[u[0]]),y=this.geometryFactory.createLinearRing(h),x=[],T=1;T<u.length;++T){var $=q.coordinates.apply(this,[u[T]]),ee=this.geometryFactory.createLinearRing($);x.push(ee)}return this.geometryFactory.createPolygon(y,x)},MultiPolygon:function(u){for(var h=[],y=0;y<u.length;++y)h.push(q.Polygon.apply(this,[u[y]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(u){for(var h=[],y=0;y<u.length;++y)h.push(this.read(u[y]));return this.geometryFactory.createGeometryCollection(h)}},he={coordinate:function(u){return[u.x,u.y]},Point:function(u){return{type:"Point",coordinates:he.coordinate.apply(this,[u.getCoordinate()])}},MultiPoint:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=he.Point.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(u){for(var h=[],y=u.getCoordinates(),x=0;x<y.length;++x)h.push(he.coordinate.apply(this,[y[x]]));return{type:"LineString",coordinates:h}},MultiLineString:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=he.LineString.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(u){var h=[],y=he.LineString.apply(this,[u._shell]);h.push(y.coordinates);for(var x=0;x<u._holes.length;++x){var F=he.LineString.apply(this,[u._holes[x]]);h.push(F.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=he.Polygon.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var x=u._geometries[y],T=x.getGeometryType();h.push(he[T].apply(this,[x]))}return{type:"GeometryCollection",geometries:h}}},pt=function(u){this.geometryFactory=u||new Br,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new k(this.geometryFactory)};pt.prototype.read=function(u){var h=this.parser.read(u);return this.precisionModel.getType()===hn.FIXED&&this.reducePrecision(h),h},pt.prototype.reducePrecision=function(u){var h,y;if(u.coordinate)this.precisionModel.makePrecise(u.coordinate);else if(u.points)for(h=0,y=u.points.length;h<y;h++)this.precisionModel.makePrecise(u.points[h]);else if(u.geometries)for(h=0,y=u.geometries.length;h<y;h++)this.reducePrecision(u.geometries[h])};var Bt=function(){this.parser=new k(this.geometryFactory)};Bt.prototype.write=function(u){return this.parser.write(u)};var je=function(){},At={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};je.prototype.interfaces_=function(){return[]},je.prototype.getClass=function(){return je},je.opposite=function(u){return u===je.LEFT?je.RIGHT:u===je.RIGHT?je.LEFT:u},At.ON.get=function(){return 0},At.LEFT.get=function(){return 1},At.RIGHT.get=function(){return 2},Object.defineProperties(je,At),(ge.prototype=new Error).name="EmptyStackException",(Me.prototype=new oi).add=function(u){return this.array_.push(u),!0},Me.prototype.get=function(u){if(u<0||u>=this.size())throw new Error;return this.array_[u]},Me.prototype.push=function(u){return this.array_.push(u),u},Me.prototype.pop=function(u){if(0===this.array_.length)throw new ge;return this.array_.pop()},Me.prototype.peek=function(){if(0===this.array_.length)throw new ge;return this.array_[this.array_.length-1]},Me.prototype.empty=function(){return 0===this.array_.length},Me.prototype.isEmpty=function(){return this.empty()},Me.prototype.search=function(u){return this.array_.indexOf(u)},Me.prototype.size=function(){return this.array_.length},Me.prototype.toArray=function(){for(var u=[],h=0,y=this.array_.length;h<y;h++)u.push(this.array_[h]);return u};var Cn=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Cn.prototype.getCoordinate=function(){return this._minCoord},Cn.prototype.getRightmostSide=function(u,h){var y=this.getRightmostSideOfSegment(u,h);return y<0&&(y=this.getRightmostSideOfSegment(u,h-1)),y<0&&(this._minCoord=null,this.checkForRightmostCoordinate(u)),y},Cn.prototype.findRightmostEdgeAtVertex=function(){var u=this._minDe.getEdge().getCoordinates();se.isTrue(this._minIndex>0&&this._minIndex<u.length,"rightmost point expected to be interior vertex of edge");var h=u[this._minIndex-1],y=u[this._minIndex+1],x=Kt.computeOrientation(this._minCoord,y,h),T=!1;(h.y<this._minCoord.y&&y.y<this._minCoord.y&&x===Kt.COUNTERCLOCKWISE||h.y>this._minCoord.y&&y.y>this._minCoord.y&&x===Kt.CLOCKWISE)&&(T=!0),T&&(this._minIndex=this._minIndex-1)},Cn.prototype.getRightmostSideOfSegment=function(u,h){var y=u.getEdge().getCoordinates();if(h<0||h+1>=y.length||y[h].y===y[h+1].y)return-1;var x=je.LEFT;return y[h].y<y[h+1].y&&(x=je.RIGHT),x},Cn.prototype.getEdge=function(){return this._orientedDe},Cn.prototype.checkForRightmostCoordinate=function(u){for(var h=u.getEdge().getCoordinates(),y=0;y<h.length-1;y++)(null===this._minCoord||h[y].x>this._minCoord.x)&&(this._minDe=u,this._minIndex=y,this._minCoord=h[y])},Cn.prototype.findRightmostEdgeAtNode=function(){var u=this._minDe.getNode().getEdges();this._minDe=u.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},Cn.prototype.findEdge=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next();y.isForward()&&this.checkForRightmostCoordinate(y)}se.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===je.LEFT&&(this._orientedDe=this._minDe.getSym())},Cn.prototype.interfaces_=function(){return[]},Cn.prototype.getClass=function(){return Cn};var vn=function(u){function h(y,x){u.call(this,h.msgWithCoord(y,x)),this.pt=x?new J(x):null,this.name="TopologyException"}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(y,x){return x?y:y+" [ "+x+" ]"},h}(ve),jn=function(){this.array_=[]};jn.prototype.addLast=function(u){this.array_.push(u)},jn.prototype.removeFirst=function(){return this.array_.shift()},jn.prototype.isEmpty=function(){return 0===this.array_.length};var wt=function(){this._finder=null,this._dirEdgeList=new An,this._nodes=new An,this._rightMostCoord=null,this._env=null,this._finder=new Cn};wt.prototype.clearVisitedEdges=function(){for(var u=this._dirEdgeList.iterator();u.hasNext();)u.next().setVisited(!1)},wt.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},wt.prototype.computeNodeDepth=function(u){for(var h=null,y=u.getEdges().iterator();y.hasNext();){var x=y.next();if(x.isVisited()||x.getSym().isVisited()){h=x;break}}if(null===h)throw new vn("unable to find edge to compute depths at "+u.getCoordinate());u.getEdges().computeDepths(h);for(var T=u.getEdges().iterator();T.hasNext();){var F=T.next();F.setVisited(!0),this.copySymDepths(F)}},wt.prototype.computeDepth=function(u){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths(je.RIGHT,u),this.copySymDepths(h),this.computeDepths(h)},wt.prototype.create=function(u){this.addReachable(u),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},wt.prototype.findResultEdges=function(){for(var u=this._dirEdgeList.iterator();u.hasNext();){var h=u.next();h.getDepth(je.RIGHT)>=1&&h.getDepth(je.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},wt.prototype.computeDepths=function(u){var h=new ke,y=new jn,x=u.getNode();for(y.addLast(x),h.add(x),u.setVisited(!0);!y.isEmpty();){var T=y.removeFirst();h.add(T),this.computeNodeDepth(T);for(var F=T.getEdges().iterator();F.hasNext();){var $=F.next().getSym();if(!$.isVisited()){var ee=$.getNode();h.contains(ee)||(y.addLast(ee),h.add(ee))}}}},wt.prototype.compareTo=function(u){return this._rightMostCoord.x<u._rightMostCoord.x?-1:this._rightMostCoord.x>u._rightMostCoord.x?1:0},wt.prototype.getEnvelope=function(){if(null===this._env){for(var u=new wn,h=this._dirEdgeList.iterator();h.hasNext();)for(var y=h.next().getEdge().getCoordinates(),x=0;x<y.length-1;x++)u.expandToInclude(y[x]);this._env=u}return this._env},wt.prototype.addReachable=function(u){var h=new Me;for(h.add(u);!h.empty();){var y=h.pop();this.add(y,h)}},wt.prototype.copySymDepths=function(u){var h=u.getSym();h.setDepth(je.LEFT,u.getDepth(je.RIGHT)),h.setDepth(je.RIGHT,u.getDepth(je.LEFT))},wt.prototype.add=function(u,h){u.setVisited(!0),this._nodes.add(u);for(var y=u.getEdges().iterator();y.hasNext();){var x=y.next();this._dirEdgeList.add(x);var T=x.getSym().getNode();T.isVisited()||h.push(T)}},wt.prototype.getNodes=function(){return this._nodes},wt.prototype.getDirectedEdges=function(){return this._dirEdgeList},wt.prototype.interfaces_=function(){return[pe]},wt.prototype.getClass=function(){return wt};var Sn=function u(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var y=arguments[0];this.init(1),this.location[je.ON]=y}else if(arguments[0]instanceof u){var x=arguments[0];if(this.init(x.location.length),null!==x)for(var T=0;T<this.location.length;T++)this.location[T]=x.location[T]}}else if(3===arguments.length){var F=arguments[0],$=arguments[1],ee=arguments[2];this.init(3),this.location[je.ON]=F,this.location[je.LEFT]=$,this.location[je.RIGHT]=ee}};Sn.prototype.setAllLocations=function(u){for(var h=0;h<this.location.length;h++)this.location[h]=u},Sn.prototype.isNull=function(){for(var u=0;u<this.location.length;u++)if(this.location[u]!==ue.NONE)return!1;return!0},Sn.prototype.setAllLocationsIfNull=function(u){for(var h=0;h<this.location.length;h++)this.location[h]===ue.NONE&&(this.location[h]=u)},Sn.prototype.isLine=function(){return 1===this.location.length},Sn.prototype.merge=function(u){if(u.location.length>this.location.length){var h=new Array(3).fill(null);h[je.ON]=this.location[je.ON],h[je.LEFT]=ue.NONE,h[je.RIGHT]=ue.NONE,this.location=h}for(var y=0;y<this.location.length;y++)this.location[y]===ue.NONE&&y<u.location.length&&(this.location[y]=u.location[y])},Sn.prototype.getLocations=function(){return this.location},Sn.prototype.flip=function(){if(this.location.length<=1)return null;var u=this.location[je.LEFT];this.location[je.LEFT]=this.location[je.RIGHT],this.location[je.RIGHT]=u},Sn.prototype.toString=function(){var u=new Ee;return this.location.length>1&&u.append(ue.toLocationSymbol(this.location[je.LEFT])),u.append(ue.toLocationSymbol(this.location[je.ON])),this.location.length>1&&u.append(ue.toLocationSymbol(this.location[je.RIGHT])),u.toString()},Sn.prototype.setLocations=function(u,h,y){this.location[je.ON]=u,this.location[je.LEFT]=h,this.location[je.RIGHT]=y},Sn.prototype.get=function(u){return u<this.location.length?this.location[u]:ue.NONE},Sn.prototype.isArea=function(){return this.location.length>1},Sn.prototype.isAnyNull=function(){for(var u=0;u<this.location.length;u++)if(this.location[u]===ue.NONE)return!0;return!1},Sn.prototype.setLocation=function(){1===arguments.length?this.setLocation(je.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},Sn.prototype.init=function(u){this.location=new Array(u).fill(null),this.setAllLocations(ue.NONE)},Sn.prototype.isEqualOnSide=function(u,h){return this.location[h]===u.location[h]},Sn.prototype.allPositionsEqual=function(u){for(var h=0;h<this.location.length;h++)if(this.location[h]!==u)return!1;return!0},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn};var Pn=function u(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new Sn(h),this.elt[1]=new Sn(h)}else if(arguments[0]instanceof u){var y=arguments[0];this.elt[0]=new Sn(y.elt[0]),this.elt[1]=new Sn(y.elt[1])}}else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.elt[0]=new Sn(ue.NONE),this.elt[1]=new Sn(ue.NONE),this.elt[x].setLocation(T)}else if(3===arguments.length){var F=arguments[0],$=arguments[1],ee=arguments[2];this.elt[0]=new Sn(F,$,ee),this.elt[1]=new Sn(F,$,ee)}else if(4===arguments.length){var oe=arguments[0],st=arguments[1],Zt=arguments[2],Qt=arguments[3];this.elt[0]=new Sn(ue.NONE,ue.NONE,ue.NONE),this.elt[1]=new Sn(ue.NONE,ue.NONE,ue.NONE),this.elt[oe].setLocations(st,Zt,Qt)}};Pn.prototype.getGeometryCount=function(){var u=0;return this.elt[0].isNull()||u++,this.elt[1].isNull()||u++,u},Pn.prototype.setAllLocations=function(u,h){this.elt[u].setAllLocations(h)},Pn.prototype.isNull=function(u){return this.elt[u].isNull()},Pn.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var u=arguments[0];this.setAllLocationsIfNull(0,u),this.setAllLocationsIfNull(1,u)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Pn.prototype.isLine=function(u){return this.elt[u].isLine()},Pn.prototype.merge=function(u){for(var h=0;h<2;h++)null===this.elt[h]&&null!==u.elt[h]?this.elt[h]=new Sn(u.elt[h]):this.elt[h].merge(u.elt[h])},Pn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Pn.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(je.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Pn.prototype.toString=function(){var u=new Ee;return null!==this.elt[0]&&(u.append("A:"),u.append(this.elt[0].toString())),null!==this.elt[1]&&(u.append(" B:"),u.append(this.elt[1].toString())),u.toString()},Pn.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Pn.prototype.isAnyNull=function(u){return this.elt[u].isAnyNull()},Pn.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(je.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Pn.prototype.isEqualOnSide=function(u,h){return this.elt[0].isEqualOnSide(u.elt[0],h)&&this.elt[1].isEqualOnSide(u.elt[1],h)},Pn.prototype.allPositionsEqual=function(u,h){return this.elt[u].allPositionsEqual(h)},Pn.prototype.toLine=function(u){this.elt[u].isArea()&&(this.elt[u]=new Sn(this.elt[u].location[0]))},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.toLineLabel=function(u){for(var h=new Pn(ue.NONE),y=0;y<2;y++)h.setLocation(y,u.getLocation(y));return h};var $n=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new An,this._pts=new An,this._label=new Pn(ue.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new An,this._geometryFactory=null;var u=arguments[0];this._geometryFactory=arguments[1],this.computePoints(u),this.computeRing()};$n.prototype.computeRing=function(){if(null!==this._ring)return null;for(var u=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)u[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(u),this._isHole=Kt.isCCW(this._ring.getCoordinates())},$n.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},$n.prototype.computePoints=function(u){this._startDe=u;var h=u,y=!0;do{if(null===h)throw new vn("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new vn("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var x=h.getLabel();se.isTrue(x.isArea()),this.mergeLabel(x),this.addPoints(h.getEdge(),h.isForward(),y),y=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},$n.prototype.getLinearRing=function(){return this._ring},$n.prototype.getCoordinate=function(u){return this._pts.get(u)},$n.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var u=this._startDe;do{var h=u.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),u=this.getNext(u)}while(u!==this._startDe);this._maxNodeDegree*=2},$n.prototype.addPoints=function(u,h,y){var x=u.getCoordinates();if(h){var T=1;y&&(T=0);for(var F=T;F<x.length;F++)this._pts.add(x[F])}else{var $=x.length-2;y&&($=x.length-1);for(var ee=$;ee>=0;ee--)this._pts.add(x[ee])}},$n.prototype.isHole=function(){return this._isHole},$n.prototype.setInResult=function(){var u=this._startDe;do{u.getEdge().setInResult(!0),u=u.getNext()}while(u!==this._startDe)},$n.prototype.containsPoint=function(u){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(u)||!Kt.isPointInRing(u,h.getCoordinates()))return!1;for(var y=this._holes.iterator();y.hasNext();)if(y.next().containsPoint(u))return!1;return!0},$n.prototype.addHole=function(u){this._holes.add(u)},$n.prototype.isShell=function(){return null===this._shell},$n.prototype.getLabel=function(){return this._label},$n.prototype.getEdges=function(){return this._edges},$n.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},$n.prototype.getShell=function(){return this._shell},$n.prototype.mergeLabel=function(){if(1===arguments.length){var u=arguments[0];this.mergeLabel(u,0),this.mergeLabel(u,1)}else if(2===arguments.length){var y=arguments[1],x=arguments[0].getLocation(y,je.RIGHT);if(x===ue.NONE)return null;if(this._label.getLocation(y)===ue.NONE)return this._label.setLocation(y,x),null}},$n.prototype.setShell=function(u){this._shell=u,null!==u&&u.addHole(this)},$n.prototype.toPolygon=function(u){for(var h=new Array(this._holes.size()).fill(null),y=0;y<this._holes.size();y++)h[y]=this._holes.get(y).getLinearRing();return u.createPolygon(this.getLinearRing(),h)},$n.prototype.interfaces_=function(){return[]},$n.prototype.getClass=function(){return $n};var Ar=function(u){function h(){u.call(this,arguments[0],arguments[1])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.setEdgeRing=function(y,x){y.setMinEdgeRing(x)},h.prototype.getNext=function(y){return y.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}($n),$s=function(u){function h(){u.call(this,arguments[0],arguments[1])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var y=new An,x=this._startDe;do{if(null===x.getMinEdgeRing()){var T=new Ar(x,this._geometryFactory);y.add(T)}x=x.getNext()}while(x!==this._startDe);return y},h.prototype.setEdgeRing=function(y,x){y.setEdgeRing(x)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var y=this._startDe;do{y.getNode().getEdges().linkMinimalDirectedEdges(this),y=y.getNext()}while(y!==this._startDe)},h.prototype.getNext=function(y){return y.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}($n),sn=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};sn.prototype.setVisited=function(u){this._isVisited=u},sn.prototype.setInResult=function(u){this._isInResult=u},sn.prototype.isCovered=function(){return this._isCovered},sn.prototype.isCoveredSet=function(){return this._isCoveredSet},sn.prototype.setLabel=function(u){this._label=u},sn.prototype.getLabel=function(){return this._label},sn.prototype.setCovered=function(u){this._isCovered=u,this._isCoveredSet=!0},sn.prototype.updateIM=function(u){se.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(u)},sn.prototype.isInResult=function(){return this._isInResult},sn.prototype.isVisited=function(){return this._isVisited},sn.prototype.interfaces_=function(){return[]},sn.prototype.getClass=function(){return sn};var qn=function(u){function h(){u.call(this),this._coord=null,this._edges=null;var x=arguments[1];this._coord=arguments[0],this._edges=x,this._label=new Pn(0,ue.NONE)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var y=this.getEdges().getEdges().iterator();y.hasNext();)if(y.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(y){y.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(y){},h.prototype.computeMergedLocation=function(y,x){var T=ue.NONE;if(T=this._label.getLocation(x),!y.isNull(x)){var F=y.getLocation(x);T!==ue.BOUNDARY&&(T=F)}return T},h.prototype.setLabel=function(){if(2!==arguments.length)return u.prototype.setLabel.apply(this,arguments);var y=arguments[0],x=arguments[1];null===this._label?this._label=new Pn(y,x):this._label.setLocation(y,x)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof Pn)for(var x=arguments[0],T=0;T<2;T++){var F=this.computeMergedLocation(x,T);this._label.getLocation(T)===ue.NONE&&this._label.setLocation(T,F)}},h.prototype.add=function(y){this._edges.insert(y),y.setNode(this)},h.prototype.setLabelBoundary=function(y){if(null===this._label)return null;var x=ue.NONE;null!==this._label&&(x=this._label.getLocation(y)),this._label.setLocation(y,x===ue.BOUNDARY?ue.INTERIOR:ue.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(sn),Si=function(){this.nodeMap=new Gt,this.nodeFact=null,this.nodeFact=arguments[0]};Si.prototype.find=function(u){return this.nodeMap.get(u)},Si.prototype.addNode=function(){if(arguments[0]instanceof J){var u=arguments[0],h=this.nodeMap.get(u);return null===h&&(h=this.nodeFact.createNode(u),this.nodeMap.put(u,h)),h}if(arguments[0]instanceof qn){var y=arguments[0],x=this.nodeMap.get(y.getCoordinate());return null===x?(this.nodeMap.put(y.getCoordinate(),y),y):(x.mergeLabel(y),x)}},Si.prototype.print=function(u){for(var h=this.iterator();h.hasNext();)h.next().print(u)},Si.prototype.iterator=function(){return this.nodeMap.values().iterator()},Si.prototype.values=function(){return this.nodeMap.values()},Si.prototype.getBoundaryNodes=function(u){for(var h=new An,y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().getLocation(u)===ue.BOUNDARY&&h.add(x)}return h},Si.prototype.add=function(u){var h=u.getCoordinate();this.addNode(h).add(u)},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si};var ar=function(){},Rr={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};ar.prototype.interfaces_=function(){return[]},ar.prototype.getClass=function(){return ar},ar.isNorthern=function(u){return u===ar.NE||u===ar.NW},ar.isOpposite=function(u,h){return u!==h&&(u-h+4)%4==2},ar.commonHalfPlane=function(u,h){if(u===h)return u;if((u-h+4)%4==2)return-1;var y=u<h?u:h;return 0===y&&3===(u>h?u:h)?3:y},ar.isInHalfPlane=function(u,h){return h===ar.SE?u===ar.SE||u===ar.SW:u===h||u===h+1},ar.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1];if(0===u&&0===h)throw new Q("Cannot compute the quadrant for point ( "+u+", "+h+" )");return u>=0?h>=0?ar.NE:ar.SE:h>=0?ar.NW:ar.SW}if(arguments[0]instanceof J&&arguments[1]instanceof J){var y=arguments[0],x=arguments[1];if(x.x===y.x&&x.y===y.y)throw new Q("Cannot compute the quadrant for two identical points "+y);return x.x>=y.x?x.y>=y.y?ar.NE:ar.SE:x.y>=y.y?ar.NW:ar.SW}},Rr.NE.get=function(){return 0},Rr.NW.get=function(){return 1},Rr.SW.get=function(){return 2},Rr.SE.get=function(){return 3},Object.defineProperties(ar,Rr);var Zn=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var y=arguments[1],x=arguments[2];this._edge=arguments[0],this.init(y,x),this._label=null}else if(4===arguments.length){var F=arguments[1],$=arguments[2],ee=arguments[3];this._edge=arguments[0],this.init(F,$),this._label=ee}};Zn.prototype.compareDirection=function(u){return this._dx===u._dx&&this._dy===u._dy?0:this._quadrant>u._quadrant?1:this._quadrant<u._quadrant?-1:Kt.computeOrientation(u._p0,u._p1,this._p1)},Zn.prototype.getDy=function(){return this._dy},Zn.prototype.getCoordinate=function(){return this._p0},Zn.prototype.setNode=function(u){this._node=u},Zn.prototype.print=function(u){var h=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),x=y.lastIndexOf("."),T=y.substring(x+1);u.print("  "+T+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},Zn.prototype.compareTo=function(u){return this.compareDirection(u)},Zn.prototype.getDirectedCoordinate=function(){return this._p1},Zn.prototype.getDx=function(){return this._dx},Zn.prototype.getLabel=function(){return this._label},Zn.prototype.getEdge=function(){return this._edge},Zn.prototype.getQuadrant=function(){return this._quadrant},Zn.prototype.getNode=function(){return this._node},Zn.prototype.toString=function(){var u=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),y=h.lastIndexOf(".");return"  "+h.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label},Zn.prototype.computeLabel=function(u){},Zn.prototype.init=function(u,h){this._p0=u,this._p1=h,this._dx=h.x-u.x,this._dy=h.y-u.y,this._quadrant=ar.quadrant(this._dx,this._dy),se.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Zn.prototype.interfaces_=function(){return[pe]},Zn.prototype.getClass=function(){return Zn};var Yu=function(u){function h(){var y=arguments[0],x=arguments[1];if(u.call(this,y),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=x,x)this.init(y.getCoordinate(0),y.getCoordinate(1));else{var T=y.getNumPoints()-1;this.init(y.getCoordinate(T),y.getCoordinate(T-1))}this.computeDirectedLabel()}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(y){return this._depth[y]},h.prototype.setVisited=function(y){this._isVisited=y},h.prototype.computeDirectedLabel=function(){this._label=new Pn(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(y,x){if(-999!==this._depth[y]&&this._depth[y]!==x)throw new vn("assigned depths do not match",this.getCoordinate());this._depth[y]=x},h.prototype.isInteriorAreaEdge=function(){for(var y=!0,x=0;x<2;x++)this._label.isArea(x)&&this._label.getLocation(x,je.LEFT)===ue.INTERIOR&&this._label.getLocation(x,je.RIGHT)===ue.INTERIOR||(y=!1);return y},h.prototype.setNextMin=function(y){this._nextMin=y},h.prototype.print=function(y){u.prototype.print.call(this,y),y.print(" "+this._depth[je.LEFT]+"/"+this._depth[je.RIGHT]),y.print(" ("+this.getDepthDelta()+")"),this._isInResult&&y.print(" inResult")},h.prototype.setMinEdgeRing=function(y){this._minEdgeRing=y},h.prototype.isLineEdge=function(){var y=this._label.isLine(0)||this._label.isLine(1),x=!this._label.isArea(0)||this._label.allPositionsEqual(0,ue.EXTERIOR),T=!this._label.isArea(1)||this._label.allPositionsEqual(1,ue.EXTERIOR);return y&&x&&T},h.prototype.setEdgeRing=function(y){this._edgeRing=y},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var y=this._edge.getDepthDelta();return this._isForward||(y=-y),y},h.prototype.setInResult=function(y){this._isInResult=y},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(y){this.print(y),y.print(" "),this._isForward?this._edge.print(y):this._edge.printReverse(y)},h.prototype.setSym=function(y){this._sym=y},h.prototype.setVisitedEdge=function(y){this.setVisited(y),this._sym.setVisited(y)},h.prototype.setEdgeDepths=function(y,x){var T=this.getEdge().getDepthDelta();this._isForward||(T=-T);var F=1;y===je.LEFT&&(F=-1);var $=je.opposite(y),ee=x+T*F;this.setDepth(y,x),this.setDepth($,ee)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(y){this._next=y},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(y,x){return y===ue.EXTERIOR&&x===ue.INTERIOR?1:y===ue.INTERIOR&&x===ue.EXTERIOR?-1:0},h}(Zn),eu=function(){};eu.prototype.createNode=function(u){return new qn(u,null)},eu.prototype.interfaces_=function(){return[]},eu.prototype.getClass=function(){return eu};var bn=function(){this._edges=new An,this._nodes=null,this._edgeEndList=new An,0===arguments.length?this._nodes=new Si(new eu):1===arguments.length&&(this._nodes=new Si(arguments[0]))};bn.prototype.printEdges=function(u){u.println("Edges:");for(var h=0;h<this._edges.size();h++){u.println("edge "+h+":");var y=this._edges.get(h);y.print(u),y.eiList.print(u)}},bn.prototype.find=function(u){return this._nodes.find(u)},bn.prototype.addNode=function(){return arguments[0]instanceof qn||arguments[0]instanceof J?this._nodes.addNode(arguments[0]):void 0},bn.prototype.getNodeIterator=function(){return this._nodes.iterator()},bn.prototype.linkResultDirectedEdges=function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkResultDirectedEdges()},bn.prototype.debugPrintln=function(u){kn.out.println(u)},bn.prototype.isBoundaryNode=function(u,h){var y=this._nodes.find(h);if(null===y)return!1;var x=y.getLabel();return null!==x&&x.getLocation(u)===ue.BOUNDARY},bn.prototype.linkAllDirectedEdges=function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkAllDirectedEdges()},bn.prototype.matchInSameDirection=function(u,h,y,x){return!!u.equals(y)&&Kt.computeOrientation(u,h,x)===Kt.COLLINEAR&&ar.quadrant(u,h)===ar.quadrant(y,x)},bn.prototype.getEdgeEnds=function(){return this._edgeEndList},bn.prototype.debugPrint=function(u){kn.out.print(u)},bn.prototype.getEdgeIterator=function(){return this._edges.iterator()},bn.prototype.findEdgeInSameDirection=function(u,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(this.matchInSameDirection(u,h,T[0],T[1])||this.matchInSameDirection(u,h,T[T.length-1],T[T.length-2]))return x}return null},bn.prototype.insertEdge=function(u){this._edges.add(u)},bn.prototype.findEdgeEnd=function(u){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var y=h.next();if(y.getEdge()===u)return y}return null},bn.prototype.addEdges=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next();this._edges.add(y);var x=new Yu(y,!0),T=new Yu(y,!1);x.setSym(T),T.setSym(x),this.add(x),this.add(T)}},bn.prototype.add=function(u){this._nodes.add(u),this._edgeEndList.add(u)},bn.prototype.getNodes=function(){return this._nodes.values()},bn.prototype.findEdge=function(u,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(u.equals(T[0])&&h.equals(T[1]))return x}return null},bn.prototype.interfaces_=function(){return[]},bn.prototype.getClass=function(){return bn},bn.linkResultDirectedEdges=function(u){for(var h=u.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var ao=function(){this._geometryFactory=null,this._shellList=new An,this._geometryFactory=arguments[0]};ao.prototype.sortShellsAndHoles=function(u,h,y){for(var x=u.iterator();x.hasNext();){var T=x.next();T.isHole()?y.add(T):h.add(T)}},ao.prototype.computePolygons=function(u){for(var h=new An,y=u.iterator();y.hasNext();){var x=y.next().toPolygon(this._geometryFactory);h.add(x)}return h},ao.prototype.placeFreeHoles=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next();if(null===x.getShell()){var T=this.findEdgeRingContaining(x,u);if(null===T)throw new vn("unable to assign hole to a shell",x.getCoordinate(0));x.setShell(T)}}},ao.prototype.buildMinimalEdgeRings=function(u,h,y){for(var x=new An,T=u.iterator();T.hasNext();){var F=T.next();if(F.getMaxNodeDegree()>2){F.linkDirectedEdgesForMinimalEdgeRings();var $=F.buildMinimalRings(),ee=this.findShell($);null!==ee?(this.placePolygonHoles(ee,$),h.add(ee)):y.addAll($)}else x.add(F)}return x},ao.prototype.containsPoint=function(u){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(u))return!0;return!1},ao.prototype.buildMaximalEdgeRings=function(u){for(var h=new An,y=u.iterator();y.hasNext();){var x=y.next();if(x.isInResult()&&x.getLabel().isArea()&&null===x.getEdgeRing()){var T=new $s(x,this._geometryFactory);h.add(T),T.setInResult()}}return h},ao.prototype.placePolygonHoles=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next();x.isHole()&&x.setShell(u)}},ao.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},ao.prototype.findEdgeRingContaining=function(u,h){for(var y=u.getLinearRing(),x=y.getEnvelopeInternal(),T=y.getCoordinateN(0),F=null,$=null,ee=h.iterator();ee.hasNext();){var oe=ee.next(),st=oe.getLinearRing(),Zt=st.getEnvelopeInternal();null!==F&&($=F.getLinearRing().getEnvelopeInternal());var Qt=!1;Zt.contains(x)&&Kt.isPointInRing(T,st.getCoordinates())&&(Qt=!0),Qt&&(null===F||$.contains(Zt))&&(F=oe)}return F},ao.prototype.findShell=function(u){for(var h=0,y=null,x=u.iterator();x.hasNext();){var T=x.next();T.isHole()||(y=T,h++)}return se.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),y},ao.prototype.add=function(){if(1===arguments.length){var u=arguments[0];this.add(u.getEdgeEnds(),u.getNodes())}else if(2===arguments.length){var h=arguments[0];bn.linkResultDirectedEdges(arguments[1]);var x=this.buildMaximalEdgeRings(h),T=new An,F=this.buildMinimalEdgeRings(x,this._shellList,T);this.sortShellsAndHoles(F,this._shellList,T),this.placeFreeHoles(this._shellList,T)}},ao.prototype.interfaces_=function(){return[]},ao.prototype.getClass=function(){return ao};var Jo=function(){};Jo.prototype.getBounds=function(){},Jo.prototype.interfaces_=function(){return[]},Jo.prototype.getClass=function(){return Jo};var ca=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};ca.prototype.getItem=function(){return this._item},ca.prototype.getBounds=function(){return this._bounds},ca.prototype.interfaces_=function(){return[Jo,Te]},ca.prototype.getClass=function(){return ca};var pu=function(){this._size=null,this._items=null,this._size=0,this._items=new An,this._items.add(null)};pu.prototype.poll=function(){if(this.isEmpty())return null;var u=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),u},pu.prototype.size=function(){return this._size},pu.prototype.reorder=function(u){for(var h=null,y=this._items.get(u);2*u<=this._size&&((h=2*u)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(y)<0);u=h)this._items.set(u,this._items.get(h));this._items.set(u,y)},pu.prototype.clear=function(){this._size=0,this._items.clear()},pu.prototype.isEmpty=function(){return 0===this._size},pu.prototype.add=function(u){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,u);u.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,u)},pu.prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu};var Ss=function(){};Ss.prototype.visitItem=function(u){},Ss.prototype.interfaces_=function(){return[]},Ss.prototype.getClass=function(){return Ss};var yl=function(){};yl.prototype.insert=function(u,h){},yl.prototype.remove=function(u,h){},yl.prototype.query=function(){},yl.prototype.interfaces_=function(){return[]},yl.prototype.getClass=function(){return yl};var vs=function(){this._childBoundables=new An,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},al={serialVersionUID:{configurable:!0}};vs.prototype.getLevel=function(){return this._level},vs.prototype.size=function(){return this._childBoundables.size()},vs.prototype.getChildBoundables=function(){return this._childBoundables},vs.prototype.addChildBoundable=function(u){se.isTrue(null===this._bounds),this._childBoundables.add(u)},vs.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},vs.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},vs.prototype.interfaces_=function(){return[Jo,Te]},vs.prototype.getClass=function(){return vs},al.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(vs,al);var us=function(){};us.reverseOrder=function(){return{compare:function(u,h){return h.compareTo(u)}}},us.min=function(u){return us.sort(u),u.get(0)},us.sort=function(u,h){var y=u.toArray();h?lt.sort(y,h):lt.sort(y);for(var x=u.iterator(),T=0,F=y.length;T<F;T++)x.next(),x.set(y[T])},us.singletonList=function(u){var h=new An;return h.add(u),h};var uo=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],y=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=y,this._distance=this.distance()};uo.prototype.expandToQueue=function(u,h){var y=uo.isComposite(this._boundable1),x=uo.isComposite(this._boundable2);if(y&&x)return uo.area(this._boundable1)>uo.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,u,h),null):(this.expand(this._boundable2,this._boundable1,u,h),null);if(y)return this.expand(this._boundable1,this._boundable2,u,h),null;if(x)return this.expand(this._boundable2,this._boundable1,u,h),null;throw new Q("neither boundable is composite")},uo.prototype.isLeaves=function(){return!(uo.isComposite(this._boundable1)||uo.isComposite(this._boundable2))},uo.prototype.compareTo=function(u){return this._distance<u._distance?-1:this._distance>u._distance?1:0},uo.prototype.expand=function(u,h,y,x){for(var T=u.getChildBoundables().iterator();T.hasNext();){var F=T.next(),$=new uo(F,h,this._itemDistance);$.getDistance()<x&&y.add($)}},uo.prototype.getBoundable=function(u){return 0===u?this._boundable1:this._boundable2},uo.prototype.getDistance=function(){return this._distance},uo.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},uo.prototype.interfaces_=function(){return[pe]},uo.prototype.getClass=function(){return uo},uo.area=function(u){return u.getBounds().getArea()},uo.isComposite=function(u){return u instanceof vs};var jo=function u(){if(this._root=null,this._built=!1,this._itemBoundables=new An,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=u.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var y=arguments[0];se.isTrue(y>1,"Node capacity must be greater than 1"),this._nodeCapacity=y}},kl={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};jo.prototype.getNodeCapacity=function(){return this._nodeCapacity},jo.prototype.lastNode=function(u){return u.get(u.size()-1)},jo.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var u=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();y instanceof vs?u+=this.size(y):y instanceof ca&&(u+=1)}return u}},jo.prototype.removeItem=function(u,h){for(var y=null,x=u.getChildBoundables().iterator();x.hasNext();){var T=x.next();T instanceof ca&&T.getItem()===h&&(y=T)}return null!==y&&(u.getChildBoundables().remove(y),!0)},jo.prototype.itemsTree=function(){if(0===arguments.length){this.build();var u=this.itemsTree(this._root);return null===u?new An:u}if(1===arguments.length){for(var h=arguments[0],y=new An,x=h.getChildBoundables().iterator();x.hasNext();){var T=x.next();if(T instanceof vs){var F=this.itemsTree(T);null!==F&&y.add(F)}else T instanceof ca?y.add(T.getItem()):se.shouldNeverReachHere()}return y.size()<=0?null:y}},jo.prototype.insert=function(u,h){se.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ca(u,h))},jo.prototype.boundablesAtLevel=function(){if(1===arguments.length){var u=arguments[0],h=new An;return this.boundablesAtLevel(u,this._root,h),h}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];if(se.isTrue(y>-2),x.getLevel()===y)return T.add(x),null;for(var F=x.getChildBoundables().iterator();F.hasNext();){var $=F.next();$ instanceof vs?this.boundablesAtLevel(y,$,T):(se.isTrue($ instanceof ca),-1===y&&T.add($))}return null}},jo.prototype.query=function(){if(1===arguments.length){var u=arguments[0];this.build();var h=new An;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.query(u,this._root,h),h}if(2===arguments.length){var y=arguments[0],x=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.query(y,this._root,x)}else if(3===arguments.length)if(kt(arguments[2],Ss)&&arguments[0]instanceof Object&&arguments[1]instanceof vs)for(var T=arguments[0],$=arguments[2],ee=arguments[1].getChildBoundables(),oe=0;oe<ee.size();oe++){var st=ee.get(oe);this.getIntersectsOp().intersects(st.getBounds(),T)&&(st instanceof vs?this.query(T,st,$):st instanceof ca?$.visitItem(st.getItem()):se.shouldNeverReachHere())}else if(kt(arguments[2],oi)&&arguments[0]instanceof Object&&arguments[1]instanceof vs)for(var Zt=arguments[0],xt=arguments[2],mn=arguments[1].getChildBoundables(),ur=0;ur<mn.size();ur++){var Cr=mn.get(ur);this.getIntersectsOp().intersects(Cr.getBounds(),Zt)&&(Cr instanceof vs?this.query(Zt,Cr,xt):Cr instanceof ca?xt.add(Cr.getItem()):se.shouldNeverReachHere())}},jo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},jo.prototype.getRoot=function(){return this.build(),this._root},jo.prototype.remove=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.remove(u,this._root,h)}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2],F=this.removeItem(x,T);if(F)return!0;for(var $=null,ee=x.getChildBoundables().iterator();ee.hasNext();){var oe=ee.next();if(this.getIntersectsOp().intersects(oe.getBounds(),y)&&oe instanceof vs&&(F=this.remove(y,oe,T))){$=oe;break}}return null!==$&&$.getChildBoundables().isEmpty()&&x.getChildBoundables().remove($),F}},jo.prototype.createHigherLevels=function(u,h){se.isTrue(!u.isEmpty());var y=this.createParentBoundables(u,h+1);return 1===y.size()?y.get(0):this.createHigherLevels(y,h+1)},jo.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var u=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();if(y instanceof vs){var x=this.depth(y);x>u&&(u=x)}}return u+1}},jo.prototype.createParentBoundables=function(u,h){se.isTrue(!u.isEmpty());var y=new An;y.add(this.createNode(h));var x=new An(u);us.sort(x,this.getComparator());for(var T=x.iterator();T.hasNext();){var F=T.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(h)),this.lastNode(y).addChildBoundable(F)}return y},jo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},jo.prototype.interfaces_=function(){return[Te]},jo.prototype.getClass=function(){return jo},jo.compareDoubles=function(u,h){return u>h?1:u<h?-1:0},kl.IntersectsOp.get=function(){return Xr},kl.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},kl.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(jo,kl);var Xr=function(){},Fs=function(){};Fs.prototype.distance=function(u,h){},Fs.prototype.interfaces_=function(){return[]},Fs.prototype.getClass=function(){return Fs};var Hc=function(u){function h(x){u.call(this,x=x||h.DEFAULT_NODE_CAPACITY)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(x,T){se.isTrue(x.length>0);for(var F=new An,$=0;$<x.length;$++)F.addAll(this.createParentBoundablesFromVerticalSlice(x[$],T));return F},h.prototype.createNode=function(x){return new ka(x)},h.prototype.size=function(){return 0===arguments.length?u.prototype.size.call(this):u.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return u.prototype.insert.apply(this,arguments);var x=arguments[0],T=arguments[1];if(x.isNull())return null;u.prototype.insert.call(this,x,T)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(x,T){for(var F=Math.trunc(Math.ceil(x.size()/T)),$=new Array(T).fill(null),ee=x.iterator(),oe=0;oe<T;oe++){$[oe]=new An;for(var st=0;ee.hasNext()&&st<F;){var Zt=ee.next();$[oe].add(Zt),st++}}return $},h.prototype.query=function(){if(1===arguments.length)return u.prototype.query.call(this,arguments[0]);2===arguments.length?u.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(kt(arguments[2],Ss)&&arguments[0]instanceof Object&&arguments[1]instanceof vs||kt(arguments[2],oi)&&arguments[0]instanceof Object&&arguments[1]instanceof vs)&&u.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(x,T){return u.prototype.createParentBoundables.call(this,x,T)},h.prototype.remove=function(){return 2===arguments.length?u.prototype.remove.call(this,arguments[0],arguments[1]):u.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?u.prototype.depth.call(this):u.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(x,T){se.isTrue(!x.isEmpty());var F=Math.trunc(Math.ceil(x.size()/this.getNodeCapacity())),$=new An(x);us.sort($,h.xComparator);var ee=this.verticalSlices($,Math.trunc(Math.ceil(Math.sqrt(F))));return this.createParentBoundablesFromVerticalSlices(ee,T)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(kt(arguments[0],Fs)){var x=arguments[0],T=new uo(this.getRoot(),this.getRoot(),x);return this.nearestNeighbour(T)}if(arguments[0]instanceof uo)return this.nearestNeighbour(arguments[0],fe.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&kt(arguments[1],Fs)){var $=arguments[0],ee=arguments[1],oe=new uo(this.getRoot(),$.getRoot(),ee);return this.nearestNeighbour(oe)}if(arguments[0]instanceof uo&&"number"==typeof arguments[1]){var st=arguments[0],Zt=arguments[1],Qt=null,xt=new pu;for(xt.add(st);!xt.isEmpty()&&Zt>0;){var mn=xt.poll(),ur=mn.getDistance();if(ur>=Zt)break;mn.isLeaves()?(Zt=ur,Qt=mn):mn.expandToQueue(xt,Zt)}return[Qt.getBoundable(0).getItem(),Qt.getBoundable(1).getItem()]}}else if(3===arguments.length){var bs=arguments[2],Ws=new ca(arguments[0],arguments[1]),ra=new uo(this.getRoot(),Ws,bs);return this.nearestNeighbour(ra)[0]}},h.prototype.interfaces_=function(){return[yl,Te]},h.prototype.getClass=function(){return h},h.centreX=function(x){return h.avg(x.getMinX(),x.getMaxX())},h.avg=function(x,T){return(x+T)/2},h.centreY=function(x){return h.avg(x.getMinY(),x.getMaxY())},y.STRtreeNode.get=function(){return ka},y.serialVersionUID.get=function(){return 0x39920f7d5f261e0},y.xComparator.get=function(){return{interfaces_:function(){return[we]},compare:function(x,T){return u.compareDoubles(h.centreX(x.getBounds()),h.centreX(T.getBounds()))}}},y.yComparator.get=function(){return{interfaces_:function(){return[we]},compare:function(x,T){return u.compareDoubles(h.centreY(x.getBounds()),h.centreY(T.getBounds()))}}},y.intersectsOp.get=function(){return{interfaces_:function(){return[u.IntersectsOp]},intersects:function(x,T){return x.intersects(T)}}},y.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,y),h}(jo),ka=function(u){function h(){u.call(this,arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var y=null,x=this.getChildBoundables().iterator();x.hasNext();){var T=x.next();null===y?y=new wn(T.getBounds()):y.expandToInclude(T.getBounds())}return y},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(vs),sa=function(){};sa.prototype.interfaces_=function(){return[]},sa.prototype.getClass=function(){return sa},sa.relativeSign=function(u,h){return u<h?-1:u>h?1:0},sa.compare=function(u,h,y){if(h.equals2D(y))return 0;var x=sa.relativeSign(h.x,y.x),T=sa.relativeSign(h.y,y.y);switch(u){case 0:return sa.compareValue(x,T);case 1:return sa.compareValue(T,x);case 2:return sa.compareValue(T,-x);case 3:return sa.compareValue(-x,T);case 4:return sa.compareValue(-x,-T);case 5:return sa.compareValue(-T,-x);case 6:return sa.compareValue(-T,x);case 7:return sa.compareValue(x,-T)}return se.shouldNeverReachHere("invalid octant value"),0},sa.compareValue=function(u,h){return u<0?-1:u>0?1:h<0?-1:h>0?1:0};var Cu=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var u=arguments[0],h=arguments[1],y=arguments[2],x=arguments[3];this._segString=u,this.coord=new J(h),this.segmentIndex=y,this._segmentOctant=x,this._isInterior=!h.equals2D(u.getCoordinate(y))};Cu.prototype.getCoordinate=function(){return this.coord},Cu.prototype.print=function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex)},Cu.prototype.compareTo=function(u){var h=u;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:sa.compare(this._segmentOctant,this.coord,h.coord)},Cu.prototype.isEndPoint=function(u){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===u},Cu.prototype.isInterior=function(){return this._isInterior},Cu.prototype.interfaces_=function(){return[pe]},Cu.prototype.getClass=function(){return Cu};var li=function(){this._nodeMap=new Gt,this._edge=null,this._edge=arguments[0]};li.prototype.getSplitCoordinates=function(){var u=new as;this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next();this.addEdgeCoordinates(y,x,u),y=x}return u.toCoordinateArray()},li.prototype.addCollapsedNodes=function(){var u=new An;this.findCollapsesFromInsertedNodes(u),this.findCollapsesFromExistingVertices(u);for(var h=u.iterator();h.hasNext();){var y=h.next().intValue();this.add(this._edge.getCoordinate(y),y)}},li.prototype.print=function(u){u.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(u)},li.prototype.findCollapsesFromExistingVertices=function(u){for(var h=0;h<this._edge.size()-2;h++){var y=this._edge.getCoordinate(h),x=this._edge.getCoordinate(h+2);y.equals2D(x)&&u.add(new it(h+1))}},li.prototype.addEdgeCoordinates=function(u,h,y){var x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);y.add(new J(u.coord),!1);for(var F=u.segmentIndex+1;F<=h.segmentIndex;F++)y.add(this._edge.getCoordinate(F));T&&y.add(new J(h.coord))},li.prototype.iterator=function(){return this._nodeMap.values().iterator()},li.prototype.addSplitEdges=function(u){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);u.add(T),y=x}},li.prototype.findCollapseIndex=function(u,h,y){if(!u.coord.equals2D(h.coord))return!1;var x=h.segmentIndex-u.segmentIndex;return h.isInterior()||x--,1===x&&(y[0]=u.segmentIndex+1,!0)},li.prototype.findCollapsesFromInsertedNodes=function(u){for(var h=new Array(1).fill(null),y=this.iterator(),x=y.next();y.hasNext();){var T=y.next();this.findCollapseIndex(x,T,h)&&u.add(new it(h[0])),x=T}},li.prototype.getEdge=function(){return this._edge},li.prototype.addEndpoints=function(){var u=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(u),u)},li.prototype.createSplitEdge=function(u,h){var y=h.segmentIndex-u.segmentIndex+2,x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);T||y--;var F=new Array(y).fill(null),$=0;F[$++]=new J(u.coord);for(var ee=u.segmentIndex+1;ee<=h.segmentIndex;ee++)F[$++]=this._edge.getCoordinate(ee);return T&&(F[$]=new J(h.coord)),new Xi(F,this._edge.getData())},li.prototype.add=function(u,h){var y=new Cu(this._edge,u,h,this._edge.getSegmentOctant(h)),x=this._nodeMap.get(y);return null!==x?(se.isTrue(x.coord.equals2D(u),"Found equal nodes with different coordinates"),x):(this._nodeMap.put(y,y),y)},li.prototype.checkSplitEdgesCorrectness=function(u){var h=this._edge.getCoordinates(),y=u.get(0).getCoordinate(0);if(!y.equals2D(h[0]))throw new ve("bad split edge start point at "+y);var x=u.get(u.size()-1).getCoordinates(),T=x[x.length-1];if(!T.equals2D(h[h.length-1]))throw new ve("bad split edge end point at "+T)},li.prototype.interfaces_=function(){return[]},li.prototype.getClass=function(){return li};var Ku=function(){};Ku.prototype.interfaces_=function(){return[]},Ku.prototype.getClass=function(){return Ku},Ku.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1];if(0===u&&0===h)throw new Q("Cannot compute the octant for point ( "+u+", "+h+" )");var y=Math.abs(u),x=Math.abs(h);return u>=0?h>=0?y>=x?0:1:y>=x?7:6:h>=0?y>=x?3:2:y>=x?4:5}if(arguments[0]instanceof J&&arguments[1]instanceof J){var T=arguments[0],F=arguments[1],$=F.x-T.x,ee=F.y-T.y;if(0===$&&0===ee)throw new Q("Cannot compute the octant for two identical points "+T);return Ku.octant($,ee)}};var tu=function(){};tu.prototype.getCoordinates=function(){},tu.prototype.size=function(){},tu.prototype.getCoordinate=function(u){},tu.prototype.isClosed=function(){},tu.prototype.setData=function(u){},tu.prototype.getData=function(){},tu.prototype.interfaces_=function(){return[]},tu.prototype.getClass=function(){return tu};var Su=function(){};Su.prototype.addIntersection=function(u,h){},Su.prototype.interfaces_=function(){return[tu]},Su.prototype.getClass=function(){return Su};var Xi=function(){this._nodeList=new li(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};Xi.prototype.getCoordinates=function(){return this._pts},Xi.prototype.size=function(){return this._pts.length},Xi.prototype.getCoordinate=function(u){return this._pts[u]},Xi.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Xi.prototype.getSegmentOctant=function(u){return u===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(u),this.getCoordinate(u+1))},Xi.prototype.setData=function(u){this._data=u},Xi.prototype.safeOctant=function(u,h){return u.equals2D(h)?0:Ku.octant(u,h)},Xi.prototype.getData=function(){return this._data},Xi.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var x=arguments[1],F=new J(arguments[0].getIntersection(arguments[3]));this.addIntersection(F,x)}},Xi.prototype.toString=function(){return St.toLineString(new gn(this._pts))},Xi.prototype.getNodeList=function(){return this._nodeList},Xi.prototype.addIntersectionNode=function(u,h){var y=h,x=y+1;return x<this._pts.length&&u.equals2D(this._pts[x])&&(y=x),this._nodeList.add(u,y)},Xi.prototype.addIntersections=function(u,h,y){for(var x=0;x<u.getIntersectionNum();x++)this.addIntersection(u,h,y,x)},Xi.prototype.interfaces_=function(){return[Su]},Xi.prototype.getClass=function(){return Xi},Xi.getNodedSubstrings=function(){if(1===arguments.length){var u=arguments[0],h=new An;return Xi.getNodedSubstrings(u,h),h}if(2===arguments.length)for(var x=arguments[1],T=arguments[0].iterator();T.hasNext();)T.next().getNodeList().addSplitEdges(x)};var vr=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new J,this.p1=new J;else if(1===arguments.length){var u=arguments[0];this.p0=new J(u.p0),this.p1=new J(u.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var x=arguments[2],T=arguments[3];this.p0=new J(arguments[0],arguments[1]),this.p1=new J(x,T)}},_l={serialVersionUID:{configurable:!0}};vr.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},vr.prototype.orientationIndex=function(){if(arguments[0]instanceof vr){var u=arguments[0],h=Kt.orientationIndex(this.p0,this.p1,u.p0),y=Kt.orientationIndex(this.p0,this.p1,u.p1);return h>=0&&y>=0||h<=0&&y<=0?Math.max(h,y):0}if(arguments[0]instanceof J)return Kt.orientationIndex(this.p0,this.p1,arguments[0])},vr.prototype.toGeometry=function(u){return u.createLineString([this.p0,this.p1])},vr.prototype.isVertical=function(){return this.p0.x===this.p1.x},vr.prototype.equals=function(u){if(!(u instanceof vr))return!1;var h=u;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},vr.prototype.intersection=function(u){var h=new qt;return h.computeIntersection(this.p0,this.p1,u.p0,u.p1),h.hasIntersection()?h.getIntersection(0):null},vr.prototype.project=function(){if(arguments[0]instanceof J){var u=arguments[0];if(u.equals(this.p0)||u.equals(this.p1))return new J(u);var h=this.projectionFactor(u),y=new J;return y.x=this.p0.x+h*(this.p1.x-this.p0.x),y.y=this.p0.y+h*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof vr){var x=arguments[0],T=this.projectionFactor(x.p0),F=this.projectionFactor(x.p1);if(T>=1&&F>=1||T<=0&&F<=0)return null;var $=this.project(x.p0);T<0&&($=this.p0),T>1&&($=this.p1);var ee=this.project(x.p1);return F<0&&(ee=this.p0),F>1&&(ee=this.p1),new vr($,ee)}},vr.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},vr.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},vr.prototype.getCoordinate=function(u){return 0===u?this.p0:this.p1},vr.prototype.distancePerpendicular=function(u){return Kt.distancePointLinePerpendicular(u,this.p0,this.p1)},vr.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},vr.prototype.midPoint=function(){return vr.midPoint(this.p0,this.p1)},vr.prototype.projectionFactor=function(u){if(u.equals(this.p0))return 0;if(u.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,x=h*h+y*y;return x<=0?fe.NaN:((u.x-this.p0.x)*h+(u.y-this.p0.y)*y)/x},vr.prototype.closestPoints=function(u){var h=this.intersection(u);if(null!==h)return[h,h];var y=new Array(2).fill(null),x=fe.MAX_VALUE,T=null,F=this.closestPoint(u.p0);x=F.distance(u.p0),y[0]=F,y[1]=u.p0;var $=this.closestPoint(u.p1);(T=$.distance(u.p1))<x&&(x=T,y[0]=$,y[1]=u.p1);var ee=u.closestPoint(this.p0);(T=ee.distance(this.p0))<x&&(x=T,y[0]=this.p0,y[1]=ee);var oe=u.closestPoint(this.p1);return(T=oe.distance(this.p1))<x&&(x=T,y[0]=this.p1,y[1]=oe),y},vr.prototype.closestPoint=function(u){var h=this.projectionFactor(u);return h>0&&h<1?this.project(u):this.p0.distance(u)<this.p1.distance(u)?this.p0:this.p1},vr.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},vr.prototype.getLength=function(){return this.p0.distance(this.p1)},vr.prototype.compareTo=function(u){var h=u,y=this.p0.compareTo(h.p0);return 0!==y?y:this.p1.compareTo(h.p1)},vr.prototype.reverse=function(){var u=this.p0;this.p0=this.p1,this.p1=u},vr.prototype.equalsTopo=function(u){return this.p0.equals(u.p0)&&(this.p1.equals(u.p1)||this.p0.equals(u.p1))&&this.p1.equals(u.p0)},vr.prototype.lineIntersection=function(u){try{return zn.intersection(this.p0,this.p1,u.p0,u.p1)}catch(h){if(!(h instanceof sr))throw h}return null},vr.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},vr.prototype.pointAlongOffset=function(u,h){var y=this.p0.x+u*(this.p1.x-this.p0.x),x=this.p0.y+u*(this.p1.y-this.p0.y),T=this.p1.x-this.p0.x,F=this.p1.y-this.p0.y,$=Math.sqrt(T*T+F*F),ee=0,oe=0;if(0!==h){if($<=0)throw new Error("Cannot compute offset from zero-length line segment");ee=h*T/$,oe=h*F/$}return new J(y-oe,x+ee)},vr.prototype.setCoordinates=function(){if(1===arguments.length){var u=arguments[0];this.setCoordinates(u.p0,u.p1)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=y.x,this.p1.y=y.y}},vr.prototype.segmentFraction=function(u){var h=this.projectionFactor(u);return h<0?h=0:(h>1||fe.isNaN(h))&&(h=1),h},vr.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},vr.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},vr.prototype.distance=function(){if(arguments[0]instanceof vr){var u=arguments[0];return Kt.distanceLineLine(this.p0,this.p1,u.p0,u.p1)}if(arguments[0]instanceof J)return Kt.distancePointLine(arguments[0],this.p0,this.p1)},vr.prototype.pointAlong=function(u){var h=new J;return h.x=this.p0.x+u*(this.p1.x-this.p0.x),h.y=this.p0.y+u*(this.p1.y-this.p0.y),h},vr.prototype.hashCode=function(){var u=fe.doubleToLongBits(this.p0.x);u^=31*fe.doubleToLongBits(this.p0.y);var h=Math.trunc(u)^Math.trunc(u>>32),y=fe.doubleToLongBits(this.p1.x);return y^=31*fe.doubleToLongBits(this.p1.y),h^Math.trunc(y)^Math.trunc(y>>32)},vr.prototype.interfaces_=function(){return[pe,Te]},vr.prototype.getClass=function(){return vr},vr.midPoint=function(u,h){return new J((u.x+h.x)/2,(u.y+h.y)/2)},_l.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(vr,_l);var Fl=function(){this.tempEnv1=new wn,this.tempEnv2=new wn,this._overlapSeg1=new vr,this._overlapSeg2=new vr};Fl.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var y=arguments[2],x=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),y.getLineSegment(x,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},Fl.prototype.interfaces_=function(){return[]},Fl.prototype.getClass=function(){return Fl};var xs=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],y=arguments[2],x=arguments[3];this._pts=arguments[0],this._start=h,this._end=y,this._context=x};xs.prototype.getLineSegment=function(u,h){h.p0=this._pts[u],h.p1=this._pts[u+1]},xs.prototype.computeSelect=function(u,h,y,x){if(x.tempEnv1.init(this._pts[h],this._pts[y]),y-h==1)return x.select(this,h),null;if(!u.intersects(x.tempEnv1))return null;var $=Math.trunc((h+y)/2);h<$&&this.computeSelect(u,h,$,x),$<y&&this.computeSelect(u,$,y,x)},xs.prototype.getCoordinates=function(){for(var u=new Array(this._end-this._start+1).fill(null),h=0,y=this._start;y<=this._end;y++)u[h++]=this._pts[y];return u},xs.prototype.computeOverlaps=function(u,h){this.computeOverlapsInternal(this._start,this._end,u,u._start,u._end,h)},xs.prototype.setId=function(u){this._id=u},xs.prototype.select=function(u,h){this.computeSelect(u,this._start,this._end,h)},xs.prototype.getEnvelope=function(){return null===this._env&&(this._env=new wn(this._pts[this._start],this._pts[this._end])),this._env},xs.prototype.getEndIndex=function(){return this._end},xs.prototype.getStartIndex=function(){return this._start},xs.prototype.getContext=function(){return this._context},xs.prototype.getId=function(){return this._id},xs.prototype.computeOverlapsInternal=function(u,h,y,x,T,F){var $=this._pts[u],ee=this._pts[h],oe=y._pts[x],st=y._pts[T];if(h-u==1&&T-x==1)return F.overlap(this,u,y,x),null;if(F.tempEnv1.init($,ee),F.tempEnv2.init(oe,st),!F.tempEnv1.intersects(F.tempEnv2))return null;var Zt=Math.trunc((u+h)/2),Qt=Math.trunc((x+T)/2);u<Zt&&(x<Qt&&this.computeOverlapsInternal(u,Zt,y,x,Qt,F),Qt<T&&this.computeOverlapsInternal(u,Zt,y,Qt,T,F)),Zt<h&&(x<Qt&&this.computeOverlapsInternal(Zt,h,y,x,Qt,F),Qt<T&&this.computeOverlapsInternal(Zt,h,y,Qt,T,F))},xs.prototype.interfaces_=function(){return[]},xs.prototype.getClass=function(){return xs};var gi=function(){};gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},gi.getChainStartIndices=function(u){var h=0,y=new An;y.add(new it(h));do{var x=gi.findChainEnd(u,h);y.add(new it(x)),h=x}while(h<u.length-1);return gi.toIntArray(y)},gi.findChainEnd=function(u,h){for(var y=h;y<u.length-1&&u[y].equals2D(u[y+1]);)y++;if(y>=u.length-1)return u.length-1;for(var x=ar.quadrant(u[y],u[y+1]),T=h+1;T<u.length&&(u[T-1].equals2D(u[T])||ar.quadrant(u[T-1],u[T])===x);)T++;return T-1},gi.getChains=function(){if(1===arguments.length)return gi.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],y=arguments[1],x=new An,T=gi.getChainStartIndices(h),F=0;F<T.length-1;F++){var $=new xs(h,T[F],T[F+1],y);x.add($)}return x}},gi.toIntArray=function(u){for(var h=new Array(u.size()).fill(null),y=0;y<h.length;y++)h[y]=u.get(y).intValue();return h};var nu=function(){};nu.prototype.computeNodes=function(u){},nu.prototype.getNodedSubstrings=function(){},nu.prototype.interfaces_=function(){return[]},nu.prototype.getClass=function(){return nu};var ru=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};ru.prototype.setSegmentIntersector=function(u){this._segInt=u},ru.prototype.interfaces_=function(){return[nu]},ru.prototype.getClass=function(){return ru};var Sa=function(u){function h(x){x?u.call(this,x):u.call(this),this._monoChains=new An,this._index=new Hc,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return Xi.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(x){for(var T=gi.getChains(x.getCoordinates(),x).iterator();T.hasNext();){var F=T.next();F.setId(this._idCounter++),this._index.insert(F.getEnvelope(),F),this._monoChains.add(F)}},h.prototype.computeNodes=function(x){this._nodedSegStrings=x;for(var T=x.iterator();T.hasNext();)this.add(T.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var x=new gu(this._segInt),T=this._monoChains.iterator();T.hasNext();)for(var F=T.next(),$=this._index.query(F.getEnvelope()).iterator();$.hasNext();){var ee=$.next();if(ee.getId()>F.getId()&&(F.computeOverlaps(ee,x),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.SegmentOverlapAction.get=function(){return gu},Object.defineProperties(h,y),h}(ru),gu=function(u){function h(){u.call(this),this._si=null,this._si=arguments[0]}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return u.prototype.overlap.apply(this,arguments);var x=arguments[1],T=arguments[2],F=arguments[3],$=arguments[0].getContext(),ee=T.getContext();this._si.processIntersections($,x,ee,F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Fl),Gn=function u(){if(this._quadrantSegments=u.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=u.CAP_ROUND,this._joinStyle=u.JOIN_ROUND,this._mitreLimit=u.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=u.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var x=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(x)}else if(4===arguments.length){var F=arguments[1],$=arguments[2],ee=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(F),this.setJoinStyle($),this.setMitreLimit(ee)}},Ia={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Gn.prototype.getEndCapStyle=function(){return this._endCapStyle},Gn.prototype.isSingleSided=function(){return this._isSingleSided},Gn.prototype.setQuadrantSegments=function(u){this._quadrantSegments=u,0===this._quadrantSegments&&(this._joinStyle=Gn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Gn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),u<=0&&(this._quadrantSegments=1),this._joinStyle!==Gn.JOIN_ROUND&&(this._quadrantSegments=Gn.DEFAULT_QUADRANT_SEGMENTS)},Gn.prototype.getJoinStyle=function(){return this._joinStyle},Gn.prototype.setJoinStyle=function(u){this._joinStyle=u},Gn.prototype.setSimplifyFactor=function(u){this._simplifyFactor=u<0?0:u},Gn.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Gn.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Gn.prototype.setEndCapStyle=function(u){this._endCapStyle=u},Gn.prototype.getMitreLimit=function(){return this._mitreLimit},Gn.prototype.setMitreLimit=function(u){this._mitreLimit=u},Gn.prototype.setSingleSided=function(u){this._isSingleSided=u},Gn.prototype.interfaces_=function(){return[]},Gn.prototype.getClass=function(){return Gn},Gn.bufferDistanceError=function(u){var h=Math.PI/2/u;return 1-Math.cos(h/2)},Ia.CAP_ROUND.get=function(){return 1},Ia.CAP_FLAT.get=function(){return 2},Ia.CAP_SQUARE.get=function(){return 3},Ia.JOIN_ROUND.get=function(){return 1},Ia.JOIN_MITRE.get=function(){return 2},Ia.JOIN_BEVEL.get=function(){return 3},Ia.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Ia.DEFAULT_MITRE_LIMIT.get=function(){return 5},Ia.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Gn,Ia);var xr=function(u){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Kt.COUNTERCLOCKWISE,this._inputLine=u||null},Fu={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};xr.prototype.isDeletable=function(u,h,y,x){var T=this._inputLine[u],F=this._inputLine[h],$=this._inputLine[y];return!!this.isConcave(T,F,$)&&!!this.isShallow(T,F,$,x)&&this.isShallowSampled(T,F,u,y,x)},xr.prototype.deleteShallowConcavities=function(){for(var u=1,h=this.findNextNonDeletedIndex(u),y=this.findNextNonDeletedIndex(h),x=!1;y<this._inputLine.length;){var T=!1;this.isDeletable(u,h,y,this._distanceTol)&&(this._isDeleted[h]=xr.DELETE,T=!0,x=!0),h=this.findNextNonDeletedIndex(u=T?y:h),y=this.findNextNonDeletedIndex(h)}return x},xr.prototype.isShallowConcavity=function(u,h,y,x){return Kt.computeOrientation(u,h,y)===this._angleOrientation&&Kt.distancePointLine(h,u,y)<x},xr.prototype.isShallowSampled=function(u,h,y,x,T){var F=Math.trunc((x-y)/xr.NUM_PTS_TO_CHECK);F<=0&&(F=1);for(var $=y;$<x;$+=F)if(!this.isShallow(u,h,this._inputLine[$],T))return!1;return!0},xr.prototype.isConcave=function(u,h,y){return Kt.computeOrientation(u,h,y)===this._angleOrientation},xr.prototype.simplify=function(u){this._distanceTol=Math.abs(u),u<0&&(this._angleOrientation=Kt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},xr.prototype.findNextNonDeletedIndex=function(u){for(var h=u+1;h<this._inputLine.length&&this._isDeleted[h]===xr.DELETE;)h++;return h},xr.prototype.isShallow=function(u,h,y,x){return Kt.distancePointLine(h,u,y)<x},xr.prototype.collapseLine=function(){for(var u=new as,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==xr.DELETE&&u.add(this._inputLine[h]);return u.toCoordinateArray()},xr.prototype.interfaces_=function(){return[]},xr.prototype.getClass=function(){return xr},xr.simplify=function(u,h){return new xr(u).simplify(h)},Fu.INIT.get=function(){return 0},Fu.DELETE.get=function(){return 1},Fu.KEEP.get=function(){return 1},Fu.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(xr,Fu);var Is=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new An},Ta={COORDINATE_ARRAY_TYPE:{configurable:!0}};Is.prototype.getCoordinates=function(){return this._ptList.toArray(Is.COORDINATE_ARRAY_TYPE)},Is.prototype.setPrecisionModel=function(u){this._precisionModel=u},Is.prototype.addPt=function(u){var h=new J(u);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},Is.prototype.revere=function(){},Is.prototype.addPts=function(u,h){if(h)for(var y=0;y<u.length;y++)this.addPt(u[y]);else for(var x=u.length-1;x>=0;x--)this.addPt(u[x])},Is.prototype.isRedundant=function(u){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return u.distance(h)<this._minimimVertexDistance},Is.prototype.toString=function(){return(new Br).createLineString(this.getCoordinates()).toString()},Is.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var u=new J(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(u.equals(h))return null;this._ptList.add(u)},Is.prototype.setMinimumVertexDistance=function(u){this._minimimVertexDistance=u},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is},Ta.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Is,Ta);var ci=function(){},Ii={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci},ci.toDegrees=function(u){return 180*u/Math.PI},ci.normalize=function(u){for(;u>Math.PI;)u-=ci.PI_TIMES_2;for(;u<=-Math.PI;)u+=ci.PI_TIMES_2;return u},ci.angle=function(){if(1===arguments.length){var u=arguments[0];return Math.atan2(u.y,u.x)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return Math.atan2(y.y-h.y,y.x-h.x)}},ci.isAcute=function(u,h,y){return(u.x-h.x)*(y.x-h.x)+(u.y-h.y)*(y.y-h.y)>0},ci.isObtuse=function(u,h,y){return(u.x-h.x)*(y.x-h.x)+(u.y-h.y)*(y.y-h.y)<0},ci.interiorAngle=function(u,h,y){var x=ci.angle(h,u),T=ci.angle(h,y);return Math.abs(T-x)},ci.normalizePositive=function(u){if(u<0){for(;u<0;)u+=ci.PI_TIMES_2;u>=ci.PI_TIMES_2&&(u=0)}else{for(;u>=ci.PI_TIMES_2;)u-=ci.PI_TIMES_2;u<0&&(u=0)}return u},ci.angleBetween=function(u,h,y){var x=ci.angle(h,u),T=ci.angle(h,y);return ci.diff(x,T)},ci.diff=function(u,h){var y=null;return(y=u<h?h-u:u-h)>Math.PI&&(y=2*Math.PI-y),y},ci.toRadians=function(u){return u*Math.PI/180},ci.getTurn=function(u,h){var y=Math.sin(h-u);return y>0?ci.COUNTERCLOCKWISE:y<0?ci.CLOCKWISE:ci.NONE},ci.angleBetweenOriented=function(u,h,y){var x=ci.angle(h,u),T=ci.angle(h,y)-x;return T<=-Math.PI?T+ci.PI_TIMES_2:T>Math.PI?T-ci.PI_TIMES_2:T},Ii.PI_TIMES_2.get=function(){return 2*Math.PI},Ii.PI_OVER_2.get=function(){return Math.PI/2},Ii.PI_OVER_4.get=function(){return Math.PI/4},Ii.COUNTERCLOCKWISE.get=function(){return Kt.COUNTERCLOCKWISE},Ii.CLOCKWISE.get=function(){return Kt.CLOCKWISE},Ii.NONE.get=function(){return Kt.COLLINEAR},Object.defineProperties(ci,Ii);var Ji=function u(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new vr,this._seg1=new vr,this._offset0=new vr,this._offset1=new vr,this._side=0,this._hasNarrowConcaveAngle=!1;var y=arguments[1],x=arguments[2];this._precisionModel=arguments[0],this._bufParams=y,this._li=new qt,this._filletAngleQuantum=Math.PI/2/y.getQuadrantSegments(),y.getQuadrantSegments()>=8&&y.getJoinStyle()===Gn.JOIN_ROUND&&(this._closingSegLengthFactor=u.MAX_CLOSING_SEG_LEN_FACTOR),this.init(x)},iu={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Ji.prototype.addNextSegment=function(u,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=u,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=Kt.computeOrientation(this._s0,this._s1,this._s2),x=y===Kt.CLOCKWISE&&this._side===je.LEFT||y===Kt.COUNTERCLOCKWISE&&this._side===je.RIGHT;0===y?this.addCollinear(h):x?this.addOutsideTurn(y,h):this.addInsideTurn(y,h)},Ji.prototype.addLineEndCap=function(u,h){var y=new vr(u,h),x=new vr;this.computeOffsetSegment(y,je.LEFT,this._distance,x);var T=new vr;this.computeOffsetSegment(y,je.RIGHT,this._distance,T);var ee=Math.atan2(h.y-u.y,h.x-u.x);switch(this._bufParams.getEndCapStyle()){case Gn.CAP_ROUND:this._segList.addPt(x.p1),this.addFilletArc(h,ee+Math.PI/2,ee-Math.PI/2,Kt.CLOCKWISE,this._distance),this._segList.addPt(T.p1);break;case Gn.CAP_FLAT:this._segList.addPt(x.p1),this._segList.addPt(T.p1);break;case Gn.CAP_SQUARE:var oe=new J;oe.x=Math.abs(this._distance)*Math.cos(ee),oe.y=Math.abs(this._distance)*Math.sin(ee);var st=new J(x.p1.x+oe.x,x.p1.y+oe.y),Zt=new J(T.p1.x+oe.x,T.p1.y+oe.y);this._segList.addPt(st),this._segList.addPt(Zt)}},Ji.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Ji.prototype.addMitreJoin=function(u,h,y,x){var T=!0,F=null;try{F=zn.intersection(h.p0,h.p1,y.p0,y.p1),(x<=0?1:F.distance(u)/Math.abs(x))>this._bufParams.getMitreLimit()&&(T=!1)}catch($){if(!($ instanceof sr))throw $;F=new J(0,0),T=!1}T?this._segList.addPt(F):this.addLimitedMitreJoin(h,y,x,this._bufParams.getMitreLimit())},Ji.prototype.addFilletCorner=function(u,h,y,x,T){var ee=Math.atan2(h.y-u.y,h.x-u.x),Zt=Math.atan2(y.y-u.y,y.x-u.x);x===Kt.CLOCKWISE?ee<=Zt&&(ee+=2*Math.PI):ee>=Zt&&(ee-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(u,ee,Zt,x,T),this._segList.addPt(y)},Ji.prototype.addOutsideTurn=function(u,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Ji.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Gn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Gn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,u,this._distance),this._segList.addPt(this._offset1.p0))},Ji.prototype.createSquare=function(u){this._segList.addPt(new J(u.x+this._distance,u.y+this._distance)),this._segList.addPt(new J(u.x+this._distance,u.y-this._distance)),this._segList.addPt(new J(u.x-this._distance,u.y-this._distance)),this._segList.addPt(new J(u.x-this._distance,u.y+this._distance)),this._segList.closeRing()},Ji.prototype.addSegments=function(u,h){this._segList.addPts(u,h)},Ji.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Ji.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Ji.prototype.initSideSegments=function(u,h,y){this._s1=u,this._s2=h,this._side=y,this._seg1.setCoordinates(u,h),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)},Ji.prototype.addLimitedMitreJoin=function(u,h,y,x){var T=this._seg0.p1,F=ci.angle(T,this._seg0.p0),$=ci.angleBetweenOriented(this._seg0.p0,T,this._seg1.p1)/2,ee=ci.normalize(F+$),oe=ci.normalize(ee+Math.PI),st=x*y,Zt=y-st*Math.abs(Math.sin($)),Qt=T.x+st*Math.cos(oe),xt=T.y+st*Math.sin(oe),mn=new J(Qt,xt),ur=new vr(T,mn),Cr=ur.pointAlongOffset(1,Zt),ti=ur.pointAlongOffset(1,-Zt);this._side===je.LEFT?(this._segList.addPt(Cr),this._segList.addPt(ti)):(this._segList.addPt(ti),this._segList.addPt(Cr))},Ji.prototype.computeOffsetSegment=function(u,h,y,x){var T=h===je.LEFT?1:-1,F=u.p1.x-u.p0.x,$=u.p1.y-u.p0.y,ee=Math.sqrt(F*F+$*$),oe=T*y*F/ee,st=T*y*$/ee;x.p0.x=u.p0.x-st,x.p0.y=u.p0.y+oe,x.p1.x=u.p1.x-st,x.p1.y=u.p1.y+oe},Ji.prototype.addFilletArc=function(u,h,y,x,T){var F=x===Kt.CLOCKWISE?-1:1,$=Math.abs(h-y),ee=Math.trunc($/this._filletAngleQuantum+.5);if(ee<1)return null;for(var oe=$/ee,st=0,Zt=new J;st<$;){var Qt=h+F*st;Zt.x=u.x+T*Math.cos(Qt),Zt.y=u.y+T*Math.sin(Qt),this._segList.addPt(Zt),st+=oe}},Ji.prototype.addInsideTurn=function(u,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Ji.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new J((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var x=new J((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(x)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Ji.prototype.createCircle=function(u){var h=new J(u.x+this._distance,u.y);this._segList.addPt(h),this.addFilletArc(u,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Ji.prototype.addBevelJoin=function(u,h){this._segList.addPt(u.p1),this._segList.addPt(h.p0)},Ji.prototype.init=function(u){this._distance=u,this._maxCurveSegmentError=u*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Is,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(u*Ji.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Ji.prototype.addCollinear=function(u){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Gn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Gn.JOIN_MITRE?(u&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Kt.CLOCKWISE,this._distance))},Ji.prototype.closeRing=function(){this._segList.closeRing()},Ji.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Ji.prototype.interfaces_=function(){return[]},Ji.prototype.getClass=function(){return Ji},iu.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},iu.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},iu.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},iu.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Ji,iu);var Qo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};Qo.prototype.getOffsetCurve=function(u,h){if(this._distance=h,0===h)return null;var y=h<0,x=Math.abs(h),T=this.getSegGen(x);u.length<=1?this.computePointCurve(u[0],T):this.computeOffsetCurve(u,y,T);var F=T.getCoordinates();return y&&$r.reverse(F),F},Qo.prototype.computeSingleSidedBufferCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);if(h){y.addSegments(u,!0);var T=xr.simplify(u,-x),F=T.length-1;y.initSideSegments(T[F],T[F-1],je.LEFT),y.addFirstSegment();for(var $=F-2;$>=0;$--)y.addNextSegment(T[$],!0)}else{y.addSegments(u,!1);var ee=xr.simplify(u,x),oe=ee.length-1;y.initSideSegments(ee[0],ee[1],je.LEFT),y.addFirstSegment();for(var st=2;st<=oe;st++)y.addNextSegment(ee[st],!0)}y.addLastSegment(),y.closeRing()},Qo.prototype.computeRingBufferCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);h===je.RIGHT&&(x=-x);var T=xr.simplify(u,x),F=T.length-1;y.initSideSegments(T[F-1],T[0],h);for(var $=1;$<=F;$++)y.addNextSegment(T[$],1!==$);y.closeRing()},Qo.prototype.computeLineBufferCurve=function(u,h){var y=this.simplifyTolerance(this._distance),x=xr.simplify(u,y),T=x.length-1;h.initSideSegments(x[0],x[1],je.LEFT);for(var F=2;F<=T;F++)h.addNextSegment(x[F],!0);h.addLastSegment(),h.addLineEndCap(x[T-1],x[T]);var $=xr.simplify(u,-y),ee=$.length-1;h.initSideSegments($[ee],$[ee-1],je.LEFT);for(var oe=ee-2;oe>=0;oe--)h.addNextSegment($[oe],!0);h.addLastSegment(),h.addLineEndCap($[1],$[0]),h.closeRing()},Qo.prototype.computePointCurve=function(u,h){switch(this._bufParams.getEndCapStyle()){case Gn.CAP_ROUND:h.createCircle(u);break;case Gn.CAP_SQUARE:h.createSquare(u)}},Qo.prototype.getLineCurve=function(u,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var y=Math.abs(h),x=this.getSegGen(y);return u.length<=1?this.computePointCurve(u[0],x):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(u,h<0,x):this.computeLineBufferCurve(u,x),x.getCoordinates()},Qo.prototype.getBufferParameters=function(){return this._bufParams},Qo.prototype.simplifyTolerance=function(u){return u*this._bufParams.getSimplifyFactor()},Qo.prototype.getRingCurve=function(u,h,y){if(this._distance=y,u.length<=2)return this.getLineCurve(u,y);if(0===y)return Qo.copyCoordinates(u);var x=this.getSegGen(y);return this.computeRingBufferCurve(u,h,x),x.getCoordinates()},Qo.prototype.computeOffsetCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);if(h){var T=xr.simplify(u,-x),F=T.length-1;y.initSideSegments(T[F],T[F-1],je.LEFT),y.addFirstSegment();for(var $=F-2;$>=0;$--)y.addNextSegment(T[$],!0)}else{var ee=xr.simplify(u,x),oe=ee.length-1;y.initSideSegments(ee[0],ee[1],je.LEFT),y.addFirstSegment();for(var st=2;st<=oe;st++)y.addNextSegment(ee[st],!0)}y.addLastSegment()},Qo.prototype.getSegGen=function(u){return new Ji(this._precisionModel,this._bufParams,u)},Qo.prototype.interfaces_=function(){return[]},Qo.prototype.getClass=function(){return Qo},Qo.copyCoordinates=function(u){for(var h=new Array(u.length).fill(null),y=0;y<h.length;y++)h[y]=new J(u[y]);return h};var vl=function(){this._subgraphs=null,this._seg=new vr,this._cga=new Kt,this._subgraphs=arguments[0]},zl={DepthSegment:{configurable:!0}};vl.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var u=arguments[0],h=new An,y=this._subgraphs.iterator();y.hasNext();){var x=y.next(),T=x.getEnvelope();u.y<T.getMinY()||u.y>T.getMaxY()||this.findStabbedSegments(u,x.getDirectedEdges(),h)}return h}if(3===arguments.length)if(kt(arguments[2],oi)&&arguments[0]instanceof J&&arguments[1]instanceof Yu){for(var F=arguments[0],$=arguments[1],ee=arguments[2],oe=$.getEdge().getCoordinates(),st=0;st<oe.length-1;st++)if(this._seg.p0=oe[st],this._seg.p1=oe[st+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<F.x||this._seg.isHorizontal()||F.y<this._seg.p0.y||F.y>this._seg.p1.y||Kt.computeOrientation(this._seg.p0,this._seg.p1,F)===Kt.RIGHT)){var Zt=$.getDepth(je.LEFT);this._seg.p0.equals(oe[st])||(Zt=$.getDepth(je.RIGHT));var Qt=new zs(this._seg,Zt);ee.add(Qt)}}else if(kt(arguments[2],oi)&&arguments[0]instanceof J&&kt(arguments[1],oi))for(var xt=arguments[0],ur=arguments[2],Cr=arguments[1].iterator();Cr.hasNext();){var ti=Cr.next();ti.isForward()&&this.findStabbedSegments(xt,ti,ur)}},vl.prototype.getDepth=function(u){var h=this.findStabbedSegments(u);return 0===h.size()?0:us.min(h)._leftDepth},vl.prototype.interfaces_=function(){return[]},vl.prototype.getClass=function(){return vl},zl.DepthSegment.get=function(){return zs},Object.defineProperties(vl,zl);var zs=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new vr(arguments[0]),this._leftDepth=h};zs.prototype.compareTo=function(u){var h=u;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var y=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==y||0!=(y=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?y:this._upwardSeg.compareTo(h._upwardSeg)},zs.prototype.compareX=function(u,h){var y=u.p0.compareTo(h.p0);return 0!==y?y:u.p1.compareTo(h.p1)},zs.prototype.toString=function(){return this._upwardSeg.toString()},zs.prototype.interfaces_=function(){return[pe]},zs.prototype.getClass=function(){return zs};var mi=function(u,h,y){this.p0=u||null,this.p1=h||null,this.p2=y||null};mi.prototype.area=function(){return mi.area(this.p0,this.p1,this.p2)},mi.prototype.signedArea=function(){return mi.signedArea(this.p0,this.p1,this.p2)},mi.prototype.interpolateZ=function(u){if(null===u)throw new Q("Supplied point is null.");return mi.interpolateZ(u,this.p0,this.p1,this.p2)},mi.prototype.longestSideLength=function(){return mi.longestSideLength(this.p0,this.p1,this.p2)},mi.prototype.isAcute=function(){return mi.isAcute(this.p0,this.p1,this.p2)},mi.prototype.circumcentre=function(){return mi.circumcentre(this.p0,this.p1,this.p2)},mi.prototype.area3D=function(){return mi.area3D(this.p0,this.p1,this.p2)},mi.prototype.centroid=function(){return mi.centroid(this.p0,this.p1,this.p2)},mi.prototype.inCentre=function(){return mi.inCentre(this.p0,this.p1,this.p2)},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi},mi.area=function(u,h,y){return Math.abs(((y.x-u.x)*(h.y-u.y)-(h.x-u.x)*(y.y-u.y))/2)},mi.signedArea=function(u,h,y){return((y.x-u.x)*(h.y-u.y)-(h.x-u.x)*(y.y-u.y))/2},mi.det=function(u,h,y,x){return u*x-h*y},mi.interpolateZ=function(u,h,y,x){var T=h.x,F=h.y,$=y.x-T,ee=x.x-T,oe=y.y-F,st=x.y-F,Zt=$*st-ee*oe,Qt=u.x-T,xt=u.y-F;return h.z+(st*Qt-ee*xt)/Zt*(y.z-h.z)+(-oe*Qt+$*xt)/Zt*(x.z-h.z)},mi.longestSideLength=function(u,h,y){var x=u.distance(h),T=h.distance(y),F=y.distance(u),$=x;return T>$&&($=T),F>$&&($=F),$},mi.isAcute=function(u,h,y){return!!ci.isAcute(u,h,y)&&!!ci.isAcute(h,y,u)&&!!ci.isAcute(y,u,h)},mi.circumcentre=function(u,h,y){var x=y.x,T=y.y,F=u.x-x,$=u.y-T,ee=h.x-x,oe=h.y-T,st=2*mi.det(F,$,ee,oe),Zt=mi.det($,F*F+$*$,oe,ee*ee+oe*oe),Qt=mi.det(F,F*F+$*$,ee,ee*ee+oe*oe);return new J(x-Zt/st,T+Qt/st)},mi.perpendicularBisector=function(u,h){var y=h.x-u.x,x=h.y-u.y,T=new zn(u.x+y/2,u.y+x/2,1),F=new zn(u.x-x+y/2,u.y+y+x/2,1);return new zn(T,F)},mi.angleBisector=function(u,h,y){var x=h.distance(u),T=x/(x+h.distance(y));return new J(u.x+T*(y.x-u.x),u.y+T*(y.y-u.y))},mi.area3D=function(u,h,y){var x=h.x-u.x,T=h.y-u.y,F=h.z-u.z,$=y.x-u.x,ee=y.y-u.y,oe=y.z-u.z,st=T*oe-F*ee,Zt=F*$-x*oe,Qt=x*ee-T*$;return Math.sqrt(st*st+Zt*Zt+Qt*Qt)/2},mi.centroid=function(u,h,y){return new J((u.x+h.x+y.x)/3,(u.y+h.y+y.y)/3)},mi.inCentre=function(u,h,y){var x=h.distance(y),T=u.distance(y),F=u.distance(h),$=x+T+F;return new J((x*u.x+T*h.x+F*y.x)/$,(x*u.y+T*h.y+F*y.y)/$)};var Wr=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new An;var h=arguments[1],y=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=y};Wr.prototype.addPoint=function(u){if(this._distance<=0)return null;var h=u.getCoordinates(),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,ue.EXTERIOR,ue.INTERIOR)},Wr.prototype.addPolygon=function(u){var h=this._distance,y=je.LEFT;this._distance<0&&(h=-this._distance,y=je.RIGHT);var x=u.getExteriorRing(),T=$r.removeRepeatedPoints(x.getCoordinates());if(this._distance<0&&this.isErodedCompletely(x,this._distance)||this._distance<=0&&T.length<3)return null;this.addPolygonRing(T,h,y,ue.EXTERIOR,ue.INTERIOR);for(var F=0;F<u.getNumInteriorRing();F++){var $=u.getInteriorRingN(F),ee=$r.removeRepeatedPoints($.getCoordinates());this._distance>0&&this.isErodedCompletely($,-this._distance)||this.addPolygonRing(ee,h,je.opposite(y),ue.INTERIOR,ue.EXTERIOR)}},Wr.prototype.isTriangleErodedCompletely=function(u,h){var y=new mi(u[0],u[1],u[2]),x=y.inCentre();return Kt.distancePointLine(x,y.p0,y.p1)<Math.abs(h)},Wr.prototype.addLineString=function(u){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=$r.removeRepeatedPoints(u.getCoordinates()),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,ue.EXTERIOR,ue.INTERIOR)},Wr.prototype.addCurve=function(u,h,y){if(null===u||u.length<2)return null;var x=new Xi(u,new Pn(0,ue.BOUNDARY,h,y));this._curveList.add(x)},Wr.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Wr.prototype.addPolygonRing=function(u,h,y,x,T){if(0===h&&u.length<so.MINIMUM_VALID_SIZE)return null;var F=x,$=T;u.length>=so.MINIMUM_VALID_SIZE&&Kt.isCCW(u)&&(F=T,$=x,y=je.opposite(y));var ee=this._curveBuilder.getRingCurve(u,y,h);this.addCurve(ee,F,$)},Wr.prototype.add=function(u){if(u.isEmpty())return null;u instanceof zt?this.addPolygon(u):u instanceof gr?this.addLineString(u):u instanceof ks?this.addPoint(u):(u instanceof Na||u instanceof cr||u instanceof Hi||u instanceof rr)&&this.addCollection(u)},Wr.prototype.isErodedCompletely=function(u,h){var y=u.getCoordinates();if(y.length<4)return h<0;if(4===y.length)return this.isTriangleErodedCompletely(y,h);var x=u.getEnvelopeInternal(),T=Math.min(x.getHeight(),x.getWidth());return h<0&&2*Math.abs(h)>T},Wr.prototype.addCollection=function(u){for(var h=0;h<u.getNumGeometries();h++){var y=u.getGeometryN(h);this.add(y)}},Wr.prototype.interfaces_=function(){return[]},Wr.prototype.getClass=function(){return Wr};var zu=function(){};zu.prototype.locate=function(u){},zu.prototype.interfaces_=function(){return[]},zu.prototype.getClass=function(){return zu};var qs=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var u=arguments[0];this._parent=u,this._atStart=!0,this._index=0,this._max=u.getNumGeometries()};qs.prototype.next=function(){if(this._atStart)return this._atStart=!1,qs.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new ft;var u=this._parent.getGeometryN(this._index++);return u instanceof rr?(this._subcollectionIterator=new qs(u),this._subcollectionIterator.next()):u},qs.prototype.remove=function(){throw new Error(this.getClass().getName())},qs.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},qs.prototype.interfaces_=function(){return[Ys]},qs.prototype.getClass=function(){return qs},qs.isAtomic=function(u){return!(u instanceof rr)};var Js=function(){this._geom=null,this._geom=arguments[0]};Js.prototype.locate=function(u){return Js.locate(u,this._geom)},Js.prototype.interfaces_=function(){return[zu]},Js.prototype.getClass=function(){return Js},Js.isPointInRing=function(u,h){return!!h.getEnvelopeInternal().intersects(u)&&Kt.isPointInRing(u,h.getCoordinates())},Js.containsPointInPolygon=function(u,h){if(h.isEmpty())return!1;var y=h.getExteriorRing();if(!Js.isPointInRing(u,y))return!1;for(var x=0;x<h.getNumInteriorRing();x++){var T=h.getInteriorRingN(x);if(Js.isPointInRing(u,T))return!1}return!0},Js.containsPoint=function(u,h){if(h instanceof zt)return Js.containsPointInPolygon(u,h);if(h instanceof rr)for(var y=new qs(h);y.hasNext();){var x=y.next();if(x!==h&&Js.containsPoint(u,x))return!0}return!1},Js.locate=function(u,h){return h.isEmpty()?ue.EXTERIOR:Js.containsPoint(u,h)?ue.INTERIOR:ue.EXTERIOR};var Bs=function(){this._edgeMap=new Gt,this._edgeList=null,this._ptInAreaLocation=[ue.NONE,ue.NONE]};Bs.prototype.getNextCW=function(u){this.getEdges();var h=this._edgeList.indexOf(u),y=h-1;return 0===h&&(y=this._edgeList.size()-1),this._edgeList.get(y)},Bs.prototype.propagateSideLabels=function(u){for(var h=ue.NONE,y=this.iterator();y.hasNext();){var x=y.next().getLabel();x.isArea(u)&&x.getLocation(u,je.LEFT)!==ue.NONE&&(h=x.getLocation(u,je.LEFT))}if(h===ue.NONE)return null;for(var T=h,F=this.iterator();F.hasNext();){var $=F.next(),ee=$.getLabel();if(ee.getLocation(u,je.ON)===ue.NONE&&ee.setLocation(u,je.ON,T),ee.isArea(u)){var oe=ee.getLocation(u,je.LEFT),st=ee.getLocation(u,je.RIGHT);if(st!==ue.NONE){if(st!==T)throw new vn("side location conflict",$.getCoordinate());oe===ue.NONE&&se.shouldNeverReachHere("found single null side (at "+$.getCoordinate()+")"),T=oe}else se.isTrue(ee.getLocation(u,je.LEFT)===ue.NONE,"found single null side"),ee.setLocation(u,je.RIGHT,T),ee.setLocation(u,je.LEFT,T)}}},Bs.prototype.getCoordinate=function(){var u=this.iterator();return u.hasNext()?u.next().getCoordinate():null},Bs.prototype.print=function(u){kn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(u)},Bs.prototype.isAreaLabelsConsistent=function(u){return this.computeEdgeEndLabels(u.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Bs.prototype.checkAreaLabelsConsistent=function(u){var h=this.getEdges();if(h.size()<=0)return!0;var y=h.size()-1,x=h.get(y).getLabel().getLocation(u,je.LEFT);se.isTrue(x!==ue.NONE,"Found unlabelled area edge");for(var T=x,F=this.iterator();F.hasNext();){var $=F.next().getLabel();se.isTrue($.isArea(u),"Found non-area edge");var ee=$.getLocation(u,je.LEFT),oe=$.getLocation(u,je.RIGHT);if(ee===oe||oe!==T)return!1;T=ee}return!0},Bs.prototype.findIndex=function(u){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===u)return h;return-1},Bs.prototype.iterator=function(){return this.getEdges().iterator()},Bs.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new An(this._edgeMap.values())),this._edgeList},Bs.prototype.getLocation=function(u,h,y){return this._ptInAreaLocation[u]===ue.NONE&&(this._ptInAreaLocation[u]=Js.locate(h,y[u].getGeometry())),this._ptInAreaLocation[u]},Bs.prototype.toString=function(){var u=new Ee;u.append("EdgeEndStar:   "+this.getCoordinate()),u.append("\n");for(var h=this.iterator();h.hasNext();){var y=h.next();u.append(y),u.append("\n")}return u.toString()},Bs.prototype.computeEdgeEndLabels=function(u){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(u)},Bs.prototype.computeLabelling=function(u){this.computeEdgeEndLabels(u[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],y=this.iterator();y.hasNext();)for(var x=y.next().getLabel(),T=0;T<2;T++)x.isLine(T)&&x.getLocation(T)===ue.BOUNDARY&&(h[T]=!0);for(var F=this.iterator();F.hasNext();)for(var $=F.next(),ee=$.getLabel(),oe=0;oe<2;oe++)if(ee.isAnyNull(oe)){var st=ue.NONE;if(h[oe])st=ue.EXTERIOR;else{var Zt=$.getCoordinate();st=this.getLocation(oe,Zt,u)}ee.setAllLocationsIfNull(oe,st)}},Bs.prototype.getDegree=function(){return this._edgeMap.size()},Bs.prototype.insertEdgeEnd=function(u,h){this._edgeMap.put(u,h),this._edgeList=null},Bs.prototype.interfaces_=function(){return[]},Bs.prototype.getClass=function(){return Bs};var ou=function(u){function h(){u.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var y=null,x=null,T=this._SCANNING_FOR_INCOMING,F=0;F<this._resultAreaEdgeList.size();F++){var $=this._resultAreaEdgeList.get(F),ee=$.getSym();if($.getLabel().isArea())switch(null===y&&$.isInResult()&&(y=$),T){case this._SCANNING_FOR_INCOMING:if(!ee.isInResult())continue;x=ee,T=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!$.isInResult())continue;x.setNext($),T=this._SCANNING_FOR_INCOMING}}if(T===this._LINKING_TO_OUTGOING){if(null===y)throw new vn("no outgoing dirEdge found",this.getCoordinate());se.isTrue(y.isInResult(),"unable to link last incoming dirEdge"),x.setNext(y)}},h.prototype.insert=function(y){this.insertEdgeEnd(y,y)},h.prototype.getRightmostEdge=function(){var y=this.getEdges(),x=y.size();if(x<1)return null;var T=y.get(0);if(1===x)return T;var F=y.get(x-1),$=T.getQuadrant(),ee=F.getQuadrant();return ar.isNorthern($)&&ar.isNorthern(ee)?T:ar.isNorthern($)||ar.isNorthern(ee)?0!==T.getDy()?T:0!==F.getDy()?F:(se.shouldNeverReachHere("found two horizontal edges incident on node"),null):F},h.prototype.print=function(y){kn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var x=this.iterator();x.hasNext();){var T=x.next();y.print("out "),T.print(y),y.println(),y.print("in "),T.getSym().print(y),y.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new An;for(var y=this.iterator();y.hasNext();){var x=y.next();(x.isInResult()||x.getSym().isInResult())&&this._resultAreaEdgeList.add(x)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(y){for(var x=this.iterator();x.hasNext();){var T=x.next().getLabel();T.setAllLocationsIfNull(0,y.getLocation(0)),T.setAllLocationsIfNull(1,y.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var y=null,x=null,T=this._edgeList.size()-1;T>=0;T--){var F=this._edgeList.get(T),$=F.getSym();null===x&&(x=$),null!==y&&$.setNext(y),y=F}x.setNext(y)},h.prototype.computeDepths=function(){if(1===arguments.length){var y=arguments[0],x=this.findIndex(y),T=y.getDepth(je.LEFT),F=y.getDepth(je.RIGHT),$=this.computeDepths(x+1,this._edgeList.size(),T);if(this.computeDepths(0,x,$)!==F)throw new vn("depth mismatch at "+y.getCoordinate())}else if(3===arguments.length){for(var oe=arguments[1],st=arguments[2],Zt=arguments[0];Zt<oe;Zt++){var Qt=this._edgeList.get(Zt);Qt.setEdgeDepths(je.RIGHT,st),st=Qt.getDepth(je.LEFT)}return st}},h.prototype.mergeSymLabels=function(){for(var y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().merge(x.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(y){for(var x=null,T=null,F=this._SCANNING_FOR_INCOMING,$=this._resultAreaEdgeList.size()-1;$>=0;$--){var ee=this._resultAreaEdgeList.get($),oe=ee.getSym();switch(null===x&&ee.getEdgeRing()===y&&(x=ee),F){case this._SCANNING_FOR_INCOMING:if(oe.getEdgeRing()!==y)continue;T=oe,F=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(ee.getEdgeRing()!==y)continue;T.setNextMin(ee),F=this._SCANNING_FOR_INCOMING}}F===this._LINKING_TO_OUTGOING&&(se.isTrue(null!==x,"found null for first outgoing dirEdge"),se.isTrue(x.getEdgeRing()===y,"unable to link last incoming dirEdge"),T.setNextMin(x))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var y=0,x=this.iterator();x.hasNext();)x.next().isInResult()&&y++;return y}if(1===arguments.length){for(var T=arguments[0],F=0,$=this.iterator();$.hasNext();)$.next().getEdgeRing()===T&&F++;return F}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var y=ue.NONE,x=this.iterator();x.hasNext();){var T=x.next(),F=T.getSym();if(!T.isLineEdge()){if(T.isInResult()){y=ue.INTERIOR;break}if(F.isInResult()){y=ue.EXTERIOR;break}}}if(y===ue.NONE)return null;for(var $=y,ee=this.iterator();ee.hasNext();){var oe=ee.next(),st=oe.getSym();oe.isLineEdge()?oe.getEdge().setCovered($===ue.INTERIOR):(oe.isInResult()&&($=ue.EXTERIOR),st.isInResult()&&($=ue.INTERIOR))}},h.prototype.computeLabelling=function(y){u.prototype.computeLabelling.call(this,y),this._label=new Pn(ue.NONE);for(var x=this.iterator();x.hasNext();)for(var T=x.next().getEdge().getLabel(),F=0;F<2;F++){var $=T.getLocation(F);$!==ue.INTERIOR&&$!==ue.BOUNDARY||this._label.setLocation(F,ue.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Bs),ul=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.createNode=function(y){return new qn(y,new ou)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(eu),Ju=function u(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=u.orientation(h)};Ju.prototype.compareTo=function(u){return Ju.compareOriented(this._pts,this._orientation,u._pts,u._orientation)},Ju.prototype.interfaces_=function(){return[pe]},Ju.prototype.getClass=function(){return Ju},Ju.orientation=function(u){return 1===$r.increasingDirection(u)},Ju.compareOriented=function(u,h,y,x){for(var T=h?1:-1,F=x?1:-1,$=h?u.length:-1,ee=x?y.length:-1,oe=h?0:u.length-1,st=x?0:y.length-1;;){var Zt=u[oe].compareTo(y[st]);if(0!==Zt)return Zt;var Qt=(oe+=T)===$,xt=(st+=F)===ee;if(Qt&&!xt)return-1;if(!Qt&&xt)return 1;if(Qt&&xt)return 0}};var Ts=function(){this._edges=new An,this._ocaMap=new Gt};Ts.prototype.print=function(u){u.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var y=this._edges.get(h);h>0&&u.print(","),u.print("(");for(var x=y.getCoordinates(),T=0;T<x.length;T++)T>0&&u.print(","),u.print(x[T].x+" "+x[T].y);u.println(")")}u.print(")  ")},Ts.prototype.addAll=function(u){for(var h=u.iterator();h.hasNext();)this.add(h.next())},Ts.prototype.findEdgeIndex=function(u){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(u))return h;return-1},Ts.prototype.iterator=function(){return this._edges.iterator()},Ts.prototype.getEdges=function(){return this._edges},Ts.prototype.get=function(u){return this._edges.get(u)},Ts.prototype.findEqualEdge=function(u){var h=new Ju(u.getCoordinates());return this._ocaMap.get(h)},Ts.prototype.add=function(u){this._edges.add(u);var h=new Ju(u.getCoordinates());this._ocaMap.put(h,u)},Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts};var mu=function(){};mu.prototype.processIntersections=function(u,h,y,x){},mu.prototype.isDone=function(){},mu.prototype.interfaces_=function(){return[]},mu.prototype.getClass=function(){return mu};var Zs=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};Zs.prototype.isTrivialIntersection=function(u,h,y,x){if(u===y&&1===this._li.getIntersectionNum()){if(Zs.isAdjacentSegments(h,x))return!0;if(u.isClosed()){var T=u.size()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},Zs.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},Zs.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},Zs.prototype.getLineIntersector=function(){return this._li},Zs.prototype.hasProperIntersection=function(){return this._hasProper},Zs.prototype.processIntersections=function(u,h,y,x){if(u===y&&h===x)return null;this.numTests++;var T=u.getCoordinates()[h],F=u.getCoordinates()[h+1],$=y.getCoordinates()[x],ee=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,$,ee),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(u,h,y,x)||(this._hasIntersection=!0,u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},Zs.prototype.hasIntersection=function(){return this._hasIntersection},Zs.prototype.isDone=function(){return!1},Zs.prototype.hasInteriorIntersection=function(){return this._hasInterior},Zs.prototype.interfaces_=function(){return[mu]},Zs.prototype.getClass=function(){return Zs},Zs.isAdjacentSegments=function(u,h){return 1===Math.abs(u-h)};var Ma=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],y=arguments[2];this.coord=new J(arguments[0]),this.segmentIndex=h,this.dist=y};Ma.prototype.getSegmentIndex=function(){return this.segmentIndex},Ma.prototype.getCoordinate=function(){return this.coord},Ma.prototype.print=function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex),u.println(" dist = "+this.dist)},Ma.prototype.compareTo=function(u){return this.compare(u.segmentIndex,u.dist)},Ma.prototype.isEndPoint=function(u){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===u},Ma.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Ma.prototype.getDistance=function(){return this.dist},Ma.prototype.compare=function(u,h){return this.segmentIndex<u?-1:this.segmentIndex>u?1:this.dist<h?-1:this.dist>h?1:0},Ma.prototype.interfaces_=function(){return[pe]},Ma.prototype.getClass=function(){return Ma};var Qs=function(){this._nodeMap=new Gt,this.edge=null,this.edge=arguments[0]};Qs.prototype.print=function(u){u.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(u)},Qs.prototype.iterator=function(){return this._nodeMap.values().iterator()},Qs.prototype.addSplitEdges=function(u){this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);u.add(T),y=x}},Qs.prototype.addEndpoints=function(){var u=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[u],u,0)},Qs.prototype.createSplitEdge=function(u,h){var y=h.segmentIndex-u.segmentIndex+2,T=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);T||y--;var F=new Array(y).fill(null),$=0;F[$++]=new J(u.coord);for(var ee=u.segmentIndex+1;ee<=h.segmentIndex;ee++)F[$++]=this.edge.pts[ee];return T&&(F[$]=h.coord),new Nr(F,new Pn(this.edge._label))},Qs.prototype.add=function(u,h,y){var x=new Ma(u,h,y),T=this._nodeMap.get(x);return null!==T?T:(this._nodeMap.put(x,x),x)},Qs.prototype.isIntersection=function(u){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(u))return!0;return!1},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs};var Et=function(){};Et.prototype.getChainStartIndices=function(u){var h=0,y=new An;y.add(new it(h));do{var x=this.findChainEnd(u,h);y.add(new it(x)),h=x}while(h<u.length-1);return Et.toIntArray(y)},Et.prototype.findChainEnd=function(u,h){for(var y=ar.quadrant(u[h],u[h+1]),x=h+1;x<u.length&&ar.quadrant(u[x-1],u[x])===y;)x++;return x-1},Et.prototype.interfaces_=function(){return[]},Et.prototype.getClass=function(){return Et},Et.toIntArray=function(u){for(var h=new Array(u.size()).fill(null),y=0;y<h.length;y++)h[y]=u.get(y).intValue();return h};var en=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new wn,this.env2=new wn;var u=arguments[0];this.e=u,this.pts=u.getCoordinates();var h=new Et;this.startIndex=h.getChainStartIndices(this.pts)};en.prototype.getCoordinates=function(){return this.pts},en.prototype.getMaxX=function(u){var h=this.pts[this.startIndex[u]].x,y=this.pts[this.startIndex[u+1]].x;return h>y?h:y},en.prototype.getMinX=function(u){var h=this.pts[this.startIndex[u]].x,y=this.pts[this.startIndex[u+1]].x;return h<y?h:y},en.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var u=arguments[0],h=arguments[1],y=arguments[2];this.computeIntersectsForChain(this.startIndex[u],this.startIndex[u+1],h,h.startIndex[y],h.startIndex[y+1],arguments[3])}else if(6===arguments.length){var T=arguments[0],F=arguments[1],$=arguments[2],ee=arguments[3],oe=arguments[4],st=arguments[5],Zt=this.pts[T],Qt=this.pts[F],xt=$.pts[ee],mn=$.pts[oe];if(F-T==1&&oe-ee==1)return st.addIntersections(this.e,T,$.e,ee),null;if(this.env1.init(Zt,Qt),this.env2.init(xt,mn),!this.env1.intersects(this.env2))return null;var ur=Math.trunc((T+F)/2),Cr=Math.trunc((ee+oe)/2);T<ur&&(ee<Cr&&this.computeIntersectsForChain(T,ur,$,ee,Cr,st),Cr<oe&&this.computeIntersectsForChain(T,ur,$,Cr,oe,st)),ur<F&&(ee<Cr&&this.computeIntersectsForChain(ur,F,$,ee,Cr,st),Cr<oe&&this.computeIntersectsForChain(ur,F,$,Cr,oe,st))}},en.prototype.getStartIndexes=function(){return this.startIndex},en.prototype.computeIntersects=function(u,h){for(var y=0;y<this.startIndex.length-1;y++)for(var x=0;x<u.startIndex.length-1;x++)this.computeIntersectsForChain(y,u,x,h)},en.prototype.interfaces_=function(){return[]},en.prototype.getClass=function(){return en};var En=function u(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var y=0;y<3;y++)this._depth[h][y]=u.NULL_VALUE},hr={NULL_VALUE:{configurable:!0}};En.prototype.getDepth=function(u,h){return this._depth[u][h]},En.prototype.setDepth=function(u,h,y){this._depth[u][h]=y},En.prototype.isNull=function(){if(0===arguments.length){for(var u=0;u<2;u++)for(var h=0;h<3;h++)if(this._depth[u][h]!==En.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===En.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===En.NULL_VALUE:void 0},En.prototype.normalize=function(){for(var u=0;u<2;u++)if(!this.isNull(u)){var h=this._depth[u][1];this._depth[u][2]<h&&(h=this._depth[u][2]),h<0&&(h=0);for(var y=1;y<3;y++){var x=0;this._depth[u][y]>h&&(x=1),this._depth[u][y]=x}}},En.prototype.getDelta=function(u){return this._depth[u][je.RIGHT]-this._depth[u][je.LEFT]},En.prototype.getLocation=function(u,h){return this._depth[u][h]<=0?ue.EXTERIOR:ue.INTERIOR},En.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},En.prototype.add=function(){if(1===arguments.length)for(var u=arguments[0],h=0;h<2;h++)for(var y=1;y<3;y++){var x=u.getLocation(h,y);x!==ue.EXTERIOR&&x!==ue.INTERIOR||(this.isNull(h,y)?this._depth[h][y]=En.depthAtLocation(x):this._depth[h][y]+=En.depthAtLocation(x))}else 3===arguments.length&&arguments[2]===ue.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},En.prototype.interfaces_=function(){return[]},En.prototype.getClass=function(){return En},En.depthAtLocation=function(u){return u===ue.EXTERIOR?0:u===ue.INTERIOR?1:En.NULL_VALUE},hr.NULL_VALUE.get=function(){return-1},Object.defineProperties(En,hr);var Nr=function(u){function h(){if(u.call(this),this.pts=null,this._env=null,this.eiList=new Qs(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new En,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var T=arguments[1];this.pts=arguments[0],this._label=T}}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var y=new Array(2).fill(null);return y[0]=this.pts[0],y[1]=this.pts[1],new h(y,Pn.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(y){this._isIsolated=y},h.prototype.setName=function(y){this._name=y},h.prototype.equals=function(y){if(!(y instanceof h))return!1;var x=y;if(this.pts.length!==x.pts.length)return!1;for(var T=!0,F=!0,$=this.pts.length,ee=0;ee<this.pts.length;ee++)if(this.pts[ee].equals2D(x.pts[ee])||(T=!1),this.pts[ee].equals2D(x.pts[--$])||(F=!1),!T&&!F)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(y){y.print("edge "+this._name+": "),y.print("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.print(","),y.print(this.pts[x].x+" "+this.pts[x].y);y.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(y){h.updateIM(this._label,y)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(y){y.print("edge "+this._name+": ");for(var x=this.pts.length-1;x>=0;x--)y.print(this.pts[x]+" ");y.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new en(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new wn;for(var y=0;y<this.pts.length;y++)this._env.expandToInclude(this.pts[y])}return this._env},h.prototype.addIntersection=function(y,x,T,F){var $=new J(y.getIntersection(F)),ee=x,oe=y.getEdgeDistance(T,F),st=ee+1;st<this.pts.length&&$.equals2D(this.pts[st])&&(ee=st,oe=0),this.eiList.add($,ee,oe)},h.prototype.toString=function(){var y=new Ee;y.append("edge "+this._name+": "),y.append("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.append(","),y.append(this.pts[x].x+" "+this.pts[x].y);return y.append(")  "+this._label+" "+this._depthDelta),y.toString()},h.prototype.isPointwiseEqual=function(y){if(this.pts.length!==y.pts.length)return!1;for(var x=0;x<this.pts.length;x++)if(!this.pts[x].equals2D(y.pts[x]))return!1;return!0},h.prototype.setDepthDelta=function(y){this._depthDelta=y},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(y,x,T){for(var F=0;F<y.getIntersectionNum();F++)this.addIntersection(y,x,T,F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return u.prototype.updateIM.apply(this,arguments);var y=arguments[0],x=arguments[1];x.setAtLeastIfValid(y.getLocation(0,je.ON),y.getLocation(1,je.ON),1),y.isArea()&&(x.setAtLeastIfValid(y.getLocation(0,je.LEFT),y.getLocation(1,je.LEFT),2),x.setAtLeastIfValid(y.getLocation(0,je.RIGHT),y.getLocation(1,je.RIGHT),2))},h}(sn),mr=function(u){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new Ts,this._bufParams=u||null};mr.prototype.setWorkingPrecisionModel=function(u){this._workingPrecisionModel=u},mr.prototype.insertUniqueEdge=function(u){var h=this._edgeList.findEqualEdge(u);if(null!==h){var y=h.getLabel(),x=u.getLabel();h.isPointwiseEqual(u)||(x=new Pn(u.getLabel())).flip(),y.merge(x);var T=mr.depthDelta(x),F=h.getDepthDelta()+T;h.setDepthDelta(F)}else this._edgeList.add(u),u.setDepthDelta(mr.depthDelta(u.getLabel()))},mr.prototype.buildSubgraphs=function(u,h){for(var y=new An,x=u.iterator();x.hasNext();){var T=x.next(),F=T.getRightmostCoordinate(),$=new vl(y).getDepth(F);T.computeDepth($),T.findResultEdges(),y.add(T),h.add(T.getDirectedEdges(),T.getNodes())}},mr.prototype.createSubgraphs=function(u){for(var h=new An,y=u.getNodes().iterator();y.hasNext();){var x=y.next();if(!x.isVisited()){var T=new wt;T.create(x),h.add(T)}}return us.sort(h,us.reverseOrder()),h},mr.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},mr.prototype.getNoder=function(u){if(null!==this._workingNoder)return this._workingNoder;var h=new Sa,y=new qt;return y.setPrecisionModel(u),h.setSegmentIntersector(new Zs(y)),h},mr.prototype.buffer=function(u,h){var y=this._workingPrecisionModel;null===y&&(y=u.getPrecisionModel()),this._geomFact=u.getFactory();var x=new Qo(y,this._bufParams),T=new Wr(u,h,x).getCurves();if(T.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(T,y),this._graph=new bn(new ul),this._graph.addEdges(this._edgeList.getEdges());var F=this.createSubgraphs(this._graph),$=new ao(this._geomFact);this.buildSubgraphs(F,$);var ee=$.getPolygons();return ee.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(ee)},mr.prototype.computeNodedEdges=function(u,h){var y=this.getNoder(h);y.computeNodes(u);for(var x=y.getNodedSubstrings().iterator();x.hasNext();){var T=x.next(),F=T.getCoordinates();if(2!==F.length||!F[0].equals2D(F[1])){var $=T.getData(),ee=new Nr(T.getCoordinates(),new Pn($));this.insertUniqueEdge(ee)}}},mr.prototype.setNoder=function(u){this._workingNoder=u},mr.prototype.interfaces_=function(){return[]},mr.prototype.getClass=function(){return mr},mr.depthDelta=function(u){var h=u.getLocation(0,je.LEFT),y=u.getLocation(0,je.RIGHT);return h===ue.INTERIOR&&y===ue.EXTERIOR?1:h===ue.EXTERIOR&&y===ue.INTERIOR?-1:0},mr.convertSegStrings=function(u){for(var h=new Br,y=new An;u.hasNext();){var x=u.next(),T=h.createLineString(x.getCoordinates());y.add(T)}return h.buildGeometry(y)};var xi=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var x=arguments[1],T=arguments[2],F=arguments[3];this._noder=arguments[0],this._scaleFactor=x,this._offsetX=T,this._offsetY=F,this._isScaled=!this.isIntegerPrecision()}};xi.prototype.rescale=function(){if(kt(arguments[0],Ci))for(var u=arguments[0].iterator();u.hasNext();){var h=u.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],x=0;x<y.length;x++)y[x].x=y[x].x/this._scaleFactor+this._offsetX,y[x].y=y[x].y/this._scaleFactor+this._offsetY;2===y.length&&y[0].equals2D(y[1])&&kn.out.println(y)}},xi.prototype.scale=function(){if(kt(arguments[0],Ci)){for(var u=arguments[0],h=new An,y=u.iterator();y.hasNext();){var x=y.next();h.add(new Xi(this.scale(x.getCoordinates()),x.getData()))}return h}if(arguments[0]instanceof Array){for(var T=arguments[0],F=new Array(T.length).fill(null),$=0;$<T.length;$++)F[$]=new J(Math.round((T[$].x-this._offsetX)*this._scaleFactor),Math.round((T[$].y-this._offsetY)*this._scaleFactor),T[$].z);return $r.removeRepeatedPoints(F)}},xi.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},xi.prototype.getNodedSubstrings=function(){var u=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(u),u},xi.prototype.computeNodes=function(u){var h=u;this._isScaled&&(h=this.scale(u)),this._noder.computeNodes(h)},xi.prototype.interfaces_=function(){return[nu]},xi.prototype.getClass=function(){return xi};var zi=function(){this._li=new qt,this._segStrings=null,this._segStrings=arguments[0]},Ms={fact:{configurable:!0}};zi.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var h=u.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var y=arguments[0],x=arguments[1].iterator();x.hasNext();)for(var T=x.next().getCoordinates(),F=1;F<T.length-1;F++)if(T[F].equals(y))throw new ve("found endpt/interior pt intersection at index "+F+" :pt "+y)},zi.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();)for(var h=u.next(),y=this._segStrings.iterator();y.hasNext();){var x=y.next();this.checkInteriorIntersections(h,x)}else if(2===arguments.length)for(var T=arguments[0],F=arguments[1],$=T.getCoordinates(),ee=F.getCoordinates(),oe=0;oe<$.length-1;oe++)for(var st=0;st<ee.length-1;st++)this.checkInteriorIntersections(T,oe,F,st);else if(4===arguments.length){var Zt=arguments[0],Qt=arguments[1],xt=arguments[2],mn=arguments[3];if(Zt===xt&&Qt===mn)return null;var ur=Zt.getCoordinates()[Qt],Cr=Zt.getCoordinates()[Qt+1],ti=xt.getCoordinates()[mn],bs=xt.getCoordinates()[mn+1];if(this._li.computeIntersection(ur,Cr,ti,bs),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,ur,Cr)||this.hasInteriorIntersection(this._li,ti,bs)))throw new ve("found non-noded intersection at "+ur+"-"+Cr+" and "+ti+"-"+bs)}},zi.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},zi.prototype.checkCollapses=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var h=u.next();this.checkCollapses(h)}else if(1===arguments.length)for(var y=arguments[0].getCoordinates(),x=0;x<y.length-2;x++)this.checkCollapse(y[x],y[x+1],y[x+2])},zi.prototype.hasInteriorIntersection=function(u,h,y){for(var x=0;x<u.getIntersectionNum();x++){var T=u.getIntersection(x);if(!T.equals(h)&&!T.equals(y))return!0}return!1},zi.prototype.checkCollapse=function(u,h,y){if(u.equals(y))throw new ve("found non-noded collapse at "+zi.fact.createLineString([u,h,y]))},zi.prototype.interfaces_=function(){return[]},zi.prototype.getClass=function(){return zi},Ms.fact.get=function(){return new Br},Object.defineProperties(zi,Ms);var hi=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var u=arguments[0],h=arguments[1],y=arguments[2];if(this._originalPt=u,this._pt=u,this._scaleFactor=h,this._li=y,h<=0)throw new Q("Scale factor must be non-zero");1!==h&&(this._pt=new J(this.scale(u.x),this.scale(u.y)),this._p0Scaled=new J,this._p1Scaled=new J),this.initCorners(this._pt)},Kn={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};hi.prototype.intersectsScaled=function(u,h){var y=Math.min(u.x,h.x),x=Math.max(u.x,h.x),T=Math.min(u.y,h.y),F=Math.max(u.y,h.y),$=this._maxx<y||this._minx>x||this._maxy<T||this._miny>F;if($)return!1;var ee=this.intersectsToleranceSquare(u,h);return se.isTrue(!($&&ee),"Found bad envelope test"),ee},hi.prototype.initCorners=function(u){this._minx=u.x-.5,this._maxx=u.x+.5,this._miny=u.y-.5,this._maxy=u.y+.5,this._corner[0]=new J(this._maxx,this._maxy),this._corner[1]=new J(this._minx,this._maxy),this._corner[2]=new J(this._minx,this._miny),this._corner[3]=new J(this._maxx,this._miny)},hi.prototype.intersects=function(u,h){return 1===this._scaleFactor?this.intersectsScaled(u,h):(this.copyScaled(u,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},hi.prototype.scale=function(u){return Math.round(u*this._scaleFactor)},hi.prototype.getCoordinate=function(){return this._originalPt},hi.prototype.copyScaled=function(u,h){h.x=this.scale(u.x),h.y=this.scale(u.y)},hi.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var u=hi.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new wn(this._originalPt.x-u,this._originalPt.x+u,this._originalPt.y-u,this._originalPt.y+u)}return this._safeEnv},hi.prototype.intersectsPixelClosure=function(u,h){return this._li.computeIntersection(u,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},hi.prototype.intersectsToleranceSquare=function(u,h){var y=!1,x=!1;return this._li.computeIntersection(u,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(u,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(u,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(x=!0),this._li.computeIntersection(u,h,this._corner[3],this._corner[0]),this._li.isProper()||y&&x||u.equals(this._pt)||h.equals(this._pt)))))},hi.prototype.addSnappedNode=function(u,h){var y=u.getCoordinate(h),x=u.getCoordinate(h+1);return!!this.intersects(y,x)&&(u.addIntersection(this.getCoordinate(),h),!0)},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi},Kn.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(hi,Kn);var Ur=function(){this.tempEnv1=new wn,this.selectedSegment=new vr};Ur.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Ur.prototype.interfaces_=function(){return[]},Ur.prototype.getClass=function(){return Ur};var Zi=function(){this._index=null,this._index=arguments[0]},rs={HotPixelSnapAction:{configurable:!0}};Zi.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2],T=h.getSafeEnvelope(),F=new Fa(h,y,x);return this._index.query(T,{interfaces_:function(){return[Ss]},visitItem:function($){$.select(T,F)}}),F.isNodeAdded()}},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi},rs.HotPixelSnapAction.get=function(){return Fa},Object.defineProperties(Zi,rs);var Fa=function(u){function h(){u.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var x=arguments[1],T=arguments[2];this._hotPixel=arguments[0],this._parentEdge=x,this._hotPixelVertexIndex=T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return u.prototype.select.apply(this,arguments);var x=arguments[1],T=arguments[0].getContext();if(null!==this._parentEdge&&T===this._parentEdge&&x===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(T,x)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ur),Vo=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new An};Vo.prototype.processIntersections=function(u,h,y,x){if(u===y&&h===x)return null;var T=u.getCoordinates()[h],F=u.getCoordinates()[h+1],$=y.getCoordinates()[x],ee=y.getCoordinates()[x+1];if(this._li.computeIntersection(T,F,$,ee),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var oe=0;oe<this._li.getIntersectionNum();oe++)this._interiorIntersections.add(this._li.getIntersection(oe));u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)}},Vo.prototype.isDone=function(){return!1},Vo.prototype.getInteriorIntersections=function(){return this._interiorIntersections},Vo.prototype.interfaces_=function(){return[mu]},Vo.prototype.getClass=function(){return Vo};var Hs=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var u=arguments[0];this._pm=u,this._li=new qt,this._li.setPrecisionModel(u),this._scaleFactor=u.getScale()};Hs.prototype.checkCorrectness=function(u){var h=Xi.getNodedSubstrings(u),y=new zi(h);try{y.checkValid()}catch(x){if(!(x instanceof Qn))throw x;x.printStackTrace()}},Hs.prototype.getNodedSubstrings=function(){return Xi.getNodedSubstrings(this._nodedSegStrings)},Hs.prototype.snapRound=function(u,h){var y=this.findInteriorIntersections(u,h);this.computeIntersectionSnaps(y),this.computeVertexSnaps(u)},Hs.prototype.findInteriorIntersections=function(u,h){var y=new Vo(h);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(u),y.getInteriorIntersections()},Hs.prototype.computeVertexSnaps=function(){if(kt(arguments[0],Ci))for(var u=arguments[0].iterator();u.hasNext();){var h=u.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof Xi)for(var y=arguments[0],x=y.getCoordinates(),T=0;T<x.length;T++){var F=new hi(x[T],this._scaleFactor,this._li);this._pointSnapper.snap(F,y,T)&&y.addIntersection(x[T],T)}},Hs.prototype.computeNodes=function(u){this._nodedSegStrings=u,this._noder=new Sa,this._pointSnapper=new Zi(this._noder.getIndex()),this.snapRound(u,this._li)},Hs.prototype.computeIntersectionSnaps=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next(),x=new hi(y,this._scaleFactor,this._li);this._pointSnapper.snap(x)}},Hs.prototype.interfaces_=function(){return[nu]},Hs.prototype.getClass=function(){return Hs};var fi=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Gn,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var y=arguments[1];this._argGeom=arguments[0],this._bufParams=y}},Xa={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};fi.prototype.bufferFixedPrecision=function(u){var h=new xi(new Hs(new hn(1)),u.getScale()),y=new mr(this._bufParams);y.setWorkingPrecisionModel(u),y.setNoder(h),this._resultGeometry=y.buffer(this._argGeom,this._distance)},fi.prototype.bufferReducedPrecision=function(){var u=this;if(0===arguments.length){for(var h=fi.MAX_PRECISION_DIGITS;h>=0;h--){try{u.bufferReducedPrecision(h)}catch(F){if(!(F instanceof vn))throw F;u._saveException=F}if(null!==u._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var x=fi.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),T=new hn(x);this.bufferFixedPrecision(T)}},fi.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var u=this._argGeom.getFactory().getPrecisionModel();u.getType()===hn.FIXED?this.bufferFixedPrecision(u):this.bufferReducedPrecision()},fi.prototype.setQuadrantSegments=function(u){this._bufParams.setQuadrantSegments(u)},fi.prototype.bufferOriginalPrecision=function(){try{var u=new mr(this._bufParams);this._resultGeometry=u.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof ve))throw h;this._saveException=h}},fi.prototype.getResultGeometry=function(u){return this._distance=u,this.computeGeometry(),this._resultGeometry},fi.prototype.setEndCapStyle=function(u){this._bufParams.setEndCapStyle(u)},fi.prototype.interfaces_=function(){return[]},fi.prototype.getClass=function(){return fi},fi.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new fi(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof On&&"number"==typeof arguments[1]){var x=arguments[1],T=arguments[2],F=new fi(arguments[0]);return F.setQuadrantSegments(T),F.getResultGeometry(x)}if(arguments[2]instanceof Gn&&arguments[0]instanceof On&&"number"==typeof arguments[1]){var ee=arguments[1];return new fi(arguments[0],arguments[2]).getResultGeometry(ee)}}else if(4===arguments.length){var Zt=arguments[1],Qt=arguments[2],xt=arguments[3],mn=new fi(arguments[0]);return mn.setQuadrantSegments(Qt),mn.setEndCapStyle(xt),mn.getResultGeometry(Zt)}},fi.precisionScaleFactor=function(u,h,y){var x=u.getEnvelopeInternal(),T=Ne.max(Math.abs(x.getMaxX()),Math.abs(x.getMaxY()),Math.abs(x.getMinX()),Math.abs(x.getMinY()))+2*(h>0?h:0),F=y-Math.trunc(Math.log(T)/Math.log(10)+1);return Math.pow(10,F)},Xa.CAP_ROUND.get=function(){return Gn.CAP_ROUND},Xa.CAP_BUTT.get=function(){return Gn.CAP_FLAT},Xa.CAP_FLAT.get=function(){return Gn.CAP_FLAT},Xa.CAP_SQUARE.get=function(){return Gn.CAP_SQUARE},Xa.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(fi,Xa);var ls=function(){this._pt=[new J,new J],this._distance=fe.NaN,this._isNull=!0};ls.prototype.getCoordinates=function(){return this._pt},ls.prototype.getCoordinate=function(u){return this._pt[u]},ls.prototype.setMinimum=function(){if(1===arguments.length){var u=arguments[0];this.setMinimum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},ls.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var u=arguments[0],h=arguments[1];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(h),this._distance=u.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},ls.prototype.getDistance=function(){return this._distance},ls.prototype.setMaximum=function(){if(1===arguments.length){var u=arguments[0];this.setMaximum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},ls.prototype.interfaces_=function(){return[]},ls.prototype.getClass=function(){return ls};var Qr=function(){};Qr.prototype.interfaces_=function(){return[]},Qr.prototype.getClass=function(){return Qr},Qr.computeDistance=function(){if(arguments[2]instanceof ls&&arguments[0]instanceof gr&&arguments[1]instanceof J)for(var h=arguments[1],y=arguments[2],x=arguments[0].getCoordinates(),T=new vr,F=0;F<x.length-1;F++){T.setCoordinates(x[F],x[F+1]);var $=T.closestPoint(h);y.setMinimum($,h)}else if(arguments[2]instanceof ls&&arguments[0]instanceof zt&&arguments[1]instanceof J){var ee=arguments[0],oe=arguments[1],st=arguments[2];Qr.computeDistance(ee.getExteriorRing(),oe,st);for(var Zt=0;Zt<ee.getNumInteriorRing();Zt++)Qr.computeDistance(ee.getInteriorRingN(Zt),oe,st)}else if(arguments[2]instanceof ls&&arguments[0]instanceof On&&arguments[1]instanceof J){var Qt=arguments[0],xt=arguments[1],mn=arguments[2];if(Qt instanceof gr)Qr.computeDistance(Qt,xt,mn);else if(Qt instanceof zt)Qr.computeDistance(Qt,xt,mn);else if(Qt instanceof rr)for(var ur=Qt,Cr=0;Cr<ur.getNumGeometries();Cr++){var ti=ur.getGeometryN(Cr);Qr.computeDistance(ti,xt,mn)}else mn.setMinimum(Qt.getCoordinate(),xt)}else if(arguments[2]instanceof ls&&arguments[0]instanceof vr&&arguments[1]instanceof J){var Ws=arguments[1],ra=arguments[2],_u=arguments[0].closestPoint(Ws);ra.setMinimum(_u,Ws)}};var Qu=function(u){this._maxPtDist=new ls,this._inputGeom=u||null},Qi={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Qu.prototype.computeMaxMidpointDistance=function(u){var h=new ha(this._inputGeom);u.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},Qu.prototype.computeMaxVertexDistance=function(u){var h=new Vi(this._inputGeom);u.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},Qu.prototype.findDistance=function(u){return this.computeMaxVertexDistance(u),this.computeMaxMidpointDistance(u),this._maxPtDist.getDistance()},Qu.prototype.getDistancePoints=function(){return this._maxPtDist},Qu.prototype.interfaces_=function(){return[]},Qu.prototype.getClass=function(){return Qu},Qi.MaxPointDistanceFilter.get=function(){return Vi},Qi.MaxMidpointDistanceFilter.get=function(){return ha},Object.defineProperties(Qu,Qi);var Vi=function(u){this._maxPtDist=new ls,this._minPtDist=new ls,this._geom=u||null};Vi.prototype.filter=function(u){this._minPtDist.initialize(),Qr.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Vi.prototype.getMaxPointDistance=function(){return this._maxPtDist},Vi.prototype.interfaces_=function(){return[vi]},Vi.prototype.getClass=function(){return Vi};var ha=function(u){this._maxPtDist=new ls,this._minPtDist=new ls,this._geom=u||null};ha.prototype.filter=function(u,h){if(0===h)return null;var y=u.getCoordinate(h-1),x=u.getCoordinate(h),T=new J((y.x+x.x)/2,(y.y+x.y)/2);this._minPtDist.initialize(),Qr.computeDistance(this._geom,T,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},ha.prototype.isDone=function(){return!1},ha.prototype.isGeometryChanged=function(){return!1},ha.prototype.getMaxPointDistance=function(){return this._maxPtDist},ha.prototype.interfaces_=function(){return[cn]},ha.prototype.getClass=function(){return ha};var eo=function(u){this._comps=u||null};eo.prototype.filter=function(u){u instanceof zt&&this._comps.add(u)},eo.prototype.interfaces_=function(){return[Rn]},eo.prototype.getClass=function(){return eo},eo.getPolygons=function(){if(1===arguments.length)return eo.getPolygons(arguments[0],new An);if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof zt?y.add(h):h instanceof rr&&h.apply(new eo(y)),y}};var is=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var y=arguments[1];this._lines=arguments[0],this._isForcedToLineString=y}};is.prototype.filter=function(u){if(this._isForcedToLineString&&u instanceof so){var h=u.getFactory().createLineString(u.getCoordinateSequence());return this._lines.add(h),null}u instanceof gr&&this._lines.add(u)},is.prototype.setForceToLineString=function(u){this._isForcedToLineString=u},is.prototype.interfaces_=function(){return[lr]},is.prototype.getClass=function(){return is},is.getGeometry=function(){if(1===arguments.length){var u=arguments[0];return u.getFactory().buildGeometry(is.getLines(u))}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().buildGeometry(is.getLines(h,y))}},is.getLines=function(){if(1===arguments.length)return is.getLines(arguments[0],!1);if(2===arguments.length){if(kt(arguments[0],Ci)&&kt(arguments[1],Ci)){for(var y=arguments[1],x=arguments[0].iterator();x.hasNext();){var T=x.next();is.getLines(T,y)}return y}if(arguments[0]instanceof On&&"boolean"==typeof arguments[1]){var F=arguments[0],$=arguments[1],ee=new An;return F.apply(new is(ee,$)),ee}if(arguments[0]instanceof On&&kt(arguments[1],Ci)){var oe=arguments[0],st=arguments[1];return oe instanceof gr?st.add(oe):oe.apply(new is(st)),st}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&kt(arguments[0],Ci)&&kt(arguments[1],Ci)){for(var Qt=arguments[1],xt=arguments[2],mn=arguments[0].iterator();mn.hasNext();){var ur=mn.next();is.getLines(ur,Qt,xt)}return Qt}if("boolean"==typeof arguments[2]&&arguments[0]instanceof On&&kt(arguments[1],Ci)){var ti=arguments[1];return arguments[0].apply(new is(ti,arguments[2])),ti}}};var fo=function(){if(this._boundaryRule=Pi.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var u=arguments[0];if(null===u)throw new Q("Rule must be non-null");this._boundaryRule=u}};fo.prototype.locateInternal=function(){if(arguments[0]instanceof J&&arguments[1]instanceof zt){var u=arguments[0],h=arguments[1];if(h.isEmpty())return ue.EXTERIOR;var y=h.getExteriorRing(),x=this.locateInPolygonRing(u,y);if(x===ue.EXTERIOR)return ue.EXTERIOR;if(x===ue.BOUNDARY)return ue.BOUNDARY;for(var T=0;T<h.getNumInteriorRing();T++){var F=h.getInteriorRingN(T),$=this.locateInPolygonRing(u,F);if($===ue.INTERIOR)return ue.EXTERIOR;if($===ue.BOUNDARY)return ue.BOUNDARY}return ue.INTERIOR}if(arguments[0]instanceof J&&arguments[1]instanceof gr){var ee=arguments[0],oe=arguments[1];if(!oe.getEnvelopeInternal().intersects(ee))return ue.EXTERIOR;var st=oe.getCoordinates();return oe.isClosed()||!ee.equals(st[0])&&!ee.equals(st[st.length-1])?Kt.isOnLine(ee,st)?ue.INTERIOR:ue.EXTERIOR:ue.BOUNDARY}if(arguments[0]instanceof J&&arguments[1]instanceof ks){var Zt=arguments[0];return arguments[1].getCoordinate().equals2D(Zt)?ue.INTERIOR:ue.EXTERIOR}},fo.prototype.locateInPolygonRing=function(u,h){return h.getEnvelopeInternal().intersects(u)?Kt.locatePointInRing(u,h.getCoordinates()):ue.EXTERIOR},fo.prototype.intersects=function(u,h){return this.locate(u,h)!==ue.EXTERIOR},fo.prototype.updateLocationInfo=function(u){u===ue.INTERIOR&&(this._isIn=!0),u===ue.BOUNDARY&&this._numBoundaries++},fo.prototype.computeLocation=function(u,h){if(h instanceof ks&&this.updateLocationInfo(this.locateInternal(u,h)),h instanceof gr)this.updateLocationInfo(this.locateInternal(u,h));else if(h instanceof zt)this.updateLocationInfo(this.locateInternal(u,h));else if(h instanceof cr)for(var y=h,x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.updateLocationInfo(this.locateInternal(u,T))}else if(h instanceof Hi)for(var F=h,$=0;$<F.getNumGeometries();$++){var ee=F.getGeometryN($);this.updateLocationInfo(this.locateInternal(u,ee))}else if(h instanceof rr)for(var oe=new qs(h);oe.hasNext();){var st=oe.next();st!==h&&this.computeLocation(u,st)}},fo.prototype.locate=function(u,h){return h.isEmpty()?ue.EXTERIOR:h instanceof gr||h instanceof zt?this.locateInternal(u,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(u,h),this._boundaryRule.isInBoundary(this._numBoundaries)?ue.BOUNDARY:this._numBoundaries>0||this._isIn?ue.INTERIOR:ue.EXTERIOR)},fo.prototype.interfaces_=function(){return[]},fo.prototype.getClass=function(){return fo};var $i=function u(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)u.call(this,arguments[0],u.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var T=arguments[1],F=arguments[2];this._component=arguments[0],this._segIndex=T,this._pt=F}},su={INSIDE_AREA:{configurable:!0}};$i.prototype.isInsideArea=function(){return this._segIndex===$i.INSIDE_AREA},$i.prototype.getCoordinate=function(){return this._pt},$i.prototype.getGeometryComponent=function(){return this._component},$i.prototype.getSegmentIndex=function(){return this._segIndex},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i},su.INSIDE_AREA.get=function(){return-1},Object.defineProperties($i,su);var Za=function(u){this._pts=u||null};Za.prototype.filter=function(u){u instanceof ks&&this._pts.add(u)},Za.prototype.interfaces_=function(){return[Rn]},Za.prototype.getClass=function(){return Za},Za.getPoints=function(){if(1===arguments.length){var u=arguments[0];return u instanceof ks?us.singletonList(u):Za.getPoints(u,new An)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof ks?y.add(h):h instanceof rr&&h.apply(new Za(y)),y}};var qi=function(){this._locations=null,this._locations=arguments[0]};qi.prototype.filter=function(u){(u instanceof ks||u instanceof gr||u instanceof zt)&&this._locations.add(new $i(u,0,u.getCoordinate()))},qi.prototype.interfaces_=function(){return[Rn]},qi.prototype.getClass=function(){return qi},qi.getLocations=function(u){var h=new An;return u.apply(new qi(h)),h};var Go=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new fo,this._minDistanceLocation=null,this._minDistance=fe.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=y,this._geom[1]=x,this._terminateDistance=T}};Go.prototype.computeContainmentDistance=function(){if(0===arguments.length){var u=new Array(2).fill(null);if(this.computeContainmentDistance(0,u),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=1-h,T=eo.getPolygons(this._geom[h]);if(T.size()>0){var F=qi.getLocations(this._geom[x]);if(this.computeContainmentDistance(F,T,y),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[x]=y[0],this._minDistanceLocation[h]=y[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&kt(arguments[0],oi)&&kt(arguments[1],oi)){for(var $=arguments[0],ee=arguments[1],oe=arguments[2],st=0;st<$.size();st++)for(var Zt=$.get(st),Qt=0;Qt<ee.size();Qt++)if(this.computeContainmentDistance(Zt,ee.get(Qt),oe),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof $i&&arguments[1]instanceof zt){var xt=arguments[0],mn=arguments[1],ur=arguments[2],Cr=xt.getCoordinate();if(ue.EXTERIOR!==this._ptLocator.locate(Cr,mn))return this._minDistance=0,ur[0]=xt,ur[1]=new $i(mn,Cr),null}},Go.prototype.computeMinDistanceLinesPoints=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),F=0;F<h.size();F++){var $=h.get(F);if(this.computeMinDistance(T,$,y),this._minDistance<=this._terminateDistance)return null}},Go.prototype.computeFacetDistance=function(){var u=new Array(2).fill(null),h=is.getLines(this._geom[0]),y=is.getLines(this._geom[1]),x=Za.getPoints(this._geom[0]),T=Za.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,y,u),this.updateMinDistance(u,!1),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistanceLinesPoints(h,T,u),this.updateMinDistance(u,!1),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistanceLinesPoints(y,x,u),this.updateMinDistance(u,!0),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistancePoints(x,T,u),void this.updateMinDistance(u,!1))))},Go.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},Go.prototype.updateMinDistance=function(u,h){if(null===u[0])return null;h?(this._minDistanceLocation[0]=u[1],this._minDistanceLocation[1]=u[0]):(this._minDistanceLocation[0]=u[0],this._minDistanceLocation[1]=u[1])},Go.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},Go.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof gr&&arguments[1]instanceof ks){var u=arguments[0],h=arguments[1],y=arguments[2];if(u.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var x=u.getCoordinates(),T=h.getCoordinate(),F=0;F<x.length-1;F++){var $=Kt.distancePointLine(T,x[F],x[F+1]);if($<this._minDistance){this._minDistance=$;var ee=new vr(x[F],x[F+1]).closestPoint(T);y[0]=new $i(u,F,ee),y[1]=new $i(h,0,T)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof gr&&arguments[1]instanceof gr){var oe=arguments[0],st=arguments[1],Zt=arguments[2];if(oe.getEnvelopeInternal().distance(st.getEnvelopeInternal())>this._minDistance)return null;for(var Qt=oe.getCoordinates(),xt=st.getCoordinates(),mn=0;mn<Qt.length-1;mn++)for(var ur=0;ur<xt.length-1;ur++){var Cr=Kt.distanceLineLine(Qt[mn],Qt[mn+1],xt[ur],xt[ur+1]);if(Cr<this._minDistance){this._minDistance=Cr;var ti=new vr(Qt[mn],Qt[mn+1]),bs=new vr(xt[ur],xt[ur+1]),Ws=ti.closestPoints(bs);Zt[0]=new $i(oe,mn,Ws[0]),Zt[1]=new $i(st,ur,Ws[1])}if(this._minDistance<=this._terminateDistance)return null}}},Go.prototype.computeMinDistancePoints=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),F=0;F<h.size();F++){var $=h.get(F),ee=T.getCoordinate().distance($.getCoordinate());if(ee<this._minDistance&&(this._minDistance=ee,y[0]=new $i(T,0,T.getCoordinate()),y[1]=new $i($,0,$.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},Go.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new Q("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},Go.prototype.computeMinDistanceLines=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),F=0;F<h.size();F++){var $=h.get(F);if(this.computeMinDistance(T,$,y),this._minDistance<=this._terminateDistance)return null}},Go.prototype.interfaces_=function(){return[]},Go.prototype.getClass=function(){return Go},Go.distance=function(u,h){return new Go(u,h).distance()},Go.isWithinDistance=function(u,h,y){return new Go(u,h,y).distance()<=y},Go.nearestPoints=function(u,h){return new Go(u,h).nearestPoints()};var no=function(){this._pt=[new J,new J],this._distance=fe.NaN,this._isNull=!0};no.prototype.getCoordinates=function(){return this._pt},no.prototype.getCoordinate=function(u){return this._pt[u]},no.prototype.setMinimum=function(){if(1===arguments.length){var u=arguments[0];this.setMinimum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},no.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var u=arguments[0],h=arguments[1];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(h),this._distance=u.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},no.prototype.toString=function(){return St.toLineString(this._pt[0],this._pt[1])},no.prototype.getDistance=function(){return this._distance},no.prototype.setMaximum=function(){if(1===arguments.length){var u=arguments[0];this.setMaximum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},no.prototype.interfaces_=function(){return[]},no.prototype.getClass=function(){return no};var za=function(){};za.prototype.interfaces_=function(){return[]},za.prototype.getClass=function(){return za},za.computeDistance=function(){if(arguments[2]instanceof no&&arguments[0]instanceof gr&&arguments[1]instanceof J)for(var u=arguments[0],h=arguments[1],y=arguments[2],x=new vr,T=u.getCoordinates(),F=0;F<T.length-1;F++){x.setCoordinates(T[F],T[F+1]);var $=x.closestPoint(h);y.setMinimum($,h)}else if(arguments[2]instanceof no&&arguments[0]instanceof zt&&arguments[1]instanceof J){var ee=arguments[0],oe=arguments[1],st=arguments[2];za.computeDistance(ee.getExteriorRing(),oe,st);for(var Zt=0;Zt<ee.getNumInteriorRing();Zt++)za.computeDistance(ee.getInteriorRingN(Zt),oe,st)}else if(arguments[2]instanceof no&&arguments[0]instanceof On&&arguments[1]instanceof J){var Qt=arguments[0],xt=arguments[1],mn=arguments[2];if(Qt instanceof gr)za.computeDistance(Qt,xt,mn);else if(Qt instanceof zt)za.computeDistance(Qt,xt,mn);else if(Qt instanceof rr)for(var ur=Qt,Cr=0;Cr<ur.getNumGeometries();Cr++){var ti=ur.getGeometryN(Cr);za.computeDistance(ti,xt,mn)}else mn.setMinimum(Qt.getCoordinate(),xt)}else if(arguments[2]instanceof no&&arguments[0]instanceof vr&&arguments[1]instanceof J){var Ws=arguments[1],ra=arguments[2],_u=arguments[0].closestPoint(Ws);ra.setMinimum(_u,Ws)}};var os=function(){this._g0=null,this._g1=null,this._ptDist=new no,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},yu={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};os.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},os.prototype.setDensifyFraction=function(u){if(u>1||u<=0)throw new Q("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=u},os.prototype.compute=function(u,h){this.computeOrientedDistance(u,h,this._ptDist),this.computeOrientedDistance(h,u,this._ptDist)},os.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},os.prototype.computeOrientedDistance=function(u,h,y){var x=new Ba(h);if(u.apply(x),y.setMaximum(x.getMaxPointDistance()),this._densifyFrac>0){var T=new Wi(h,this._densifyFrac);u.apply(T),y.setMaximum(T.getMaxPointDistance())}},os.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.distance=function(){if(2===arguments.length)return new os(arguments[0],arguments[1]).distance();if(3===arguments.length){var T=arguments[2],F=new os(arguments[0],arguments[1]);return F.setDensifyFraction(T),F.distance()}},yu.MaxPointDistanceFilter.get=function(){return Ba},yu.MaxDensifiedByFractionDistanceFilter.get=function(){return Wi},Object.defineProperties(os,yu);var Ba=function(){this._maxPtDist=new no,this._minPtDist=new no,this._euclideanDist=new za,this._geom=null,this._geom=arguments[0]};Ba.prototype.filter=function(u){this._minPtDist.initialize(),za.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ba.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ba.prototype.interfaces_=function(){return[vi]},Ba.prototype.getClass=function(){return Ba};var Wi=function(){this._maxPtDist=new no,this._minPtDist=new no,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};Wi.prototype.filter=function(u,h){if(0===h)return null;for(var y=u.getCoordinate(h-1),x=u.getCoordinate(h),T=(x.x-y.x)/this._numSubSegs,F=(x.y-y.y)/this._numSubSegs,$=0;$<this._numSubSegs;$++){var st=new J(y.x+$*T,y.y+$*F);this._minPtDist.initialize(),za.computeDistance(this._geom,st,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},Wi.prototype.isDone=function(){return!1},Wi.prototype.isGeometryChanged=function(){return!1},Wi.prototype.getMaxPointDistance=function(){return this._maxPtDist},Wi.prototype.interfaces_=function(){return[cn]},Wi.prototype.getClass=function(){return Wi};var ei=function(u,h,y){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=u||null,this._bufDistance=h||null,this._result=y||null},ps={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};ei.prototype.checkMaximumDistance=function(u,h,y){var x=new os(h,u);if(x.setDensifyFraction(.25),this._maxDistanceFound=x.orientedDistance(),this._maxDistanceFound>y){this._isValid=!1;var T=x.getCoordinates();this._errorLocation=T[1],this._errorIndicator=u.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+St.toLineString(T[0],T[1])+")"}},ei.prototype.isValid=function(){var u=Math.abs(this._bufDistance),h=ei.MAX_DISTANCE_DIFF_FRAC*u;return this._minValidDistance=u-h,this._maxValidDistance=u+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),ei.VERBOSE&&kn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},ei.prototype.checkNegativeValid=function(){if(!(this._input instanceof zt||this._input instanceof Hi||this._input instanceof rr))return null;var u=this.getPolygonLines(this._input);if(this.checkMinimumDistance(u,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(u,this._result,this._maxValidDistance)},ei.prototype.getErrorIndicator=function(){return this._errorIndicator},ei.prototype.checkMinimumDistance=function(u,h,y){var x=new Go(u,h,y);if(this._minDistanceFound=x.distance(),this._minDistanceFound<y){this._isValid=!1;var T=x.nearestPoints();this._errorLocation=x.nearestPoints()[1],this._errorIndicator=u.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+St.toLineString(T[0],T[1])+" )"}},ei.prototype.checkPositiveValid=function(){var u=this._result.getBoundary();if(this.checkMinimumDistance(this._input,u,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,u,this._maxValidDistance)},ei.prototype.getErrorLocation=function(){return this._errorLocation},ei.prototype.getPolygonLines=function(u){for(var h=new An,y=new is(h),x=eo.getPolygons(u).iterator();x.hasNext();)x.next().apply(y);return u.getFactory().buildGeometry(h)},ei.prototype.getErrorMessage=function(){return this._errMsg},ei.prototype.interfaces_=function(){return[]},ei.prototype.getClass=function(){return ei},ps.VERBOSE.get=function(){return!1},ps.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(ei,ps);var ro=function(u,h,y){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=u||null,this._distance=h||null,this._result=y||null},Xc={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};ro.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},ro.prototype.checkEnvelope=function(){if(this._distance<0)return null;var u=this._distance*ro.MAX_ENV_DIFF_FRAC;0===u&&(u=.001);var h=new wn(this._input.getEnvelopeInternal());h.expandBy(this._distance);var y=new wn(this._result.getEnvelopeInternal());y.expandBy(u),y.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(y)),this.report("Envelope")},ro.prototype.checkDistance=function(){var u=new ei(this._input,this._distance,this._result);u.isValid()||(this._isValid=!1,this._errorMsg=u.getErrorMessage(),this._errorLocation=u.getErrorLocation(),this._errorIndicator=u.getErrorIndicator()),this.report("Distance")},ro.prototype.checkArea=function(){var u=this._input.getArea(),h=this._result.getArea();this._distance>0&&u>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&u<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},ro.prototype.checkPolygonal=function(){this._result instanceof zt||this._result instanceof Hi||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},ro.prototype.getErrorIndicator=function(){return this._errorIndicator},ro.prototype.getErrorLocation=function(){return this._errorLocation},ro.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},ro.prototype.report=function(u){if(!ro.VERBOSE)return null;kn.out.println("Check "+u+": "+(this._isValid?"passed":"FAILED"))},ro.prototype.getErrorMessage=function(){return this._errorMsg},ro.prototype.interfaces_=function(){return[]},ro.prototype.getClass=function(){return ro},ro.isValidMsg=function(u,h,y){var x=new ro(u,h,y);return x.isValid()?null:x.getErrorMessage()},ro.isValid=function(u,h,y){return!!new ro(u,h,y).isValid()},Xc.VERBOSE.get=function(){return!1},Xc.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(ro,Xc);var aa=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};aa.prototype.getCoordinates=function(){return this._pts},aa.prototype.size=function(){return this._pts.length},aa.prototype.getCoordinate=function(u){return this._pts[u]},aa.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},aa.prototype.getSegmentOctant=function(u){return u===this._pts.length-1?-1:Ku.octant(this.getCoordinate(u),this.getCoordinate(u+1))},aa.prototype.setData=function(u){this._data=u},aa.prototype.getData=function(){return this._data},aa.prototype.toString=function(){return St.toLineString(new gn(this._pts))},aa.prototype.interfaces_=function(){return[tu]},aa.prototype.getClass=function(){return aa};var Xs=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new An,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};Xs.prototype.getInteriorIntersection=function(){return this._interiorIntersection},Xs.prototype.setCheckEndSegmentsOnly=function(u){this._isCheckEndSegmentsOnly=u},Xs.prototype.getIntersectionSegments=function(){return this._intSegments},Xs.prototype.count=function(){return this._intersectionCount},Xs.prototype.getIntersections=function(){return this._intersections},Xs.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u},Xs.prototype.setKeepIntersections=function(u){this._keepIntersections=u},Xs.prototype.processIntersections=function(u,h,y,x){if(!this._findAllIntersections&&this.hasIntersection()||u===y&&h===x||this._isCheckEndSegmentsOnly&&!this.isEndSegment(u,h)&&!this.isEndSegment(y,x))return null;var T=u.getCoordinates()[h],F=u.getCoordinates()[h+1],$=y.getCoordinates()[x],ee=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,$,ee),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=T,this._intSegments[1]=F,this._intSegments[2]=$,this._intSegments[3]=ee,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},Xs.prototype.isEndSegment=function(u,h){return 0===h||h>=u.size()-2},Xs.prototype.hasIntersection=function(){return null!==this._interiorIntersection},Xs.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},Xs.prototype.interfaces_=function(){return[mu]},Xs.prototype.getClass=function(){return Xs},Xs.createAllIntersectionsFinder=function(u){var h=new Xs(u);return h.setFindAllIntersections(!0),h},Xs.createAnyIntersectionFinder=function(u){return new Xs(u)},Xs.createIntersectionCounter=function(u){var h=new Xs(u);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var Us=function(){this._li=new qt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};Us.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},Us.prototype.getIntersections=function(){return this._segInt.getIntersections()},Us.prototype.isValid=function(){return this.execute(),this._isValid},Us.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u},Us.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Xs(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var u=new Sa;if(u.setSegmentIntersector(this._segInt),u.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},Us.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new vn(this.getErrorMessage(),this._segInt.getInteriorIntersection())},Us.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var u=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+St.toLineString(u[0],u[1])+" and "+St.toLineString(u[2],u[3])},Us.prototype.interfaces_=function(){return[]},Us.prototype.getClass=function(){return Us},Us.computeIntersections=function(u){var h=new Us(u);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var xl=function u(){this._nv=null,this._nv=new Us(u.toSegmentStrings(arguments[0]))};xl.prototype.checkValid=function(){this._nv.checkValid()},xl.prototype.interfaces_=function(){return[]},xl.prototype.getClass=function(){return xl},xl.toSegmentStrings=function(u){for(var h=new An,y=u.iterator();y.hasNext();){var x=y.next();h.add(new aa(x.getCoordinates(),x))}return h},xl.checkValid=function(u){new xl(u).checkValid()};var oc=function(u){this._mapOp=u};oc.prototype.map=function(u){for(var h=new An,y=0;y<u.getNumGeometries();y++){var x=this._mapOp.map(u.getGeometryN(y));x.isEmpty()||h.add(x)}return u.getFactory().createGeometryCollection(Br.toGeometryArray(h))},oc.prototype.interfaces_=function(){return[]},oc.prototype.getClass=function(){return oc},oc.map=function(u,h){return new oc(h).map(u)};var au=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new An,this._resultLineList=new An;var h=arguments[1],y=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=y};au.prototype.collectLines=function(u){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next();this.collectLineEdge(y,u,this._lineEdgesList),this.collectBoundaryTouchEdge(y,u,this._lineEdgesList)}},au.prototype.labelIsolatedLine=function(u,h){var y=this._ptLocator.locate(u.getCoordinate(),this._op.getArgGeometry(h));u.getLabel().setLocation(h,y)},au.prototype.build=function(u){return this.findCoveredLineEdges(),this.collectLines(u),this.buildLines(u),this._resultLineList},au.prototype.collectLineEdge=function(u,h,y){var x=u.getLabel(),T=u.getEdge();u.isLineEdge()&&(u.isVisited()||!Yr.isResultOfOp(x,h)||T.isCovered()||(y.add(T),u.setVisitedEdge(!0)))},au.prototype.findCoveredLineEdges=function(){for(var u=this._op.getGraph().getNodes().iterator();u.hasNext();)u.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next(),x=y.getEdge();if(y.isLineEdge()&&!x.isCoveredSet()){var T=this._op.isCoveredByA(y.getCoordinate());x.setCovered(T)}}},au.prototype.labelIsolatedLines=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next(),x=y.getLabel();y.isIsolated()&&(x.isNull(0)?this.labelIsolatedLine(y,0):this.labelIsolatedLine(y,1))}},au.prototype.buildLines=function(u){for(var h=this._lineEdgesList.iterator();h.hasNext();){var y=h.next(),x=this._geometryFactory.createLineString(y.getCoordinates());this._resultLineList.add(x),y.setInResult(!0)}},au.prototype.collectBoundaryTouchEdge=function(u,h,y){var x=u.getLabel();return u.isLineEdge()||u.isVisited()||u.isInteriorAreaEdge()||u.getEdge().isInResult()?null:(se.isTrue(!(u.isInResult()||u.getSym().isInResult())||!u.getEdge().isInResult()),void(Yr.isResultOfOp(x,h)&&h===Yr.INTERSECTION&&(y.add(u.getEdge()),u.setVisitedEdge(!0))))},au.prototype.interfaces_=function(){return[]},au.prototype.getClass=function(){return au};var ll=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new An;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};ll.prototype.filterCoveredNodeToPoint=function(u){var h=u.getCoordinate();if(!this._op.isCoveredByLA(h)){var y=this._geometryFactory.createPoint(h);this._resultPointList.add(y)}},ll.prototype.extractNonCoveredResultNodes=function(u){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var y=h.next();if(!(y.isInResult()||y.isIncidentEdgeInResult()||0!==y.getEdges().getDegree()&&u!==Yr.INTERSECTION)){var x=y.getLabel();Yr.isResultOfOp(x,u)&&this.filterCoveredNodeToPoint(y)}}},ll.prototype.build=function(u){return this.extractNonCoveredResultNodes(u),this._resultPointList},ll.prototype.interfaces_=function(){return[]},ll.prototype.getClass=function(){return ll};var ea=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};ea.prototype.transformPoint=function(u,h){return this._factory.createPoint(this.transformCoordinates(u.getCoordinateSequence(),u))},ea.prototype.transformPolygon=function(u,h){var y=!0,x=this.transformLinearRing(u.getExteriorRing(),u);null!==x&&x instanceof so&&!x.isEmpty()||(y=!1);for(var T=new An,F=0;F<u.getNumInteriorRing();F++){var $=this.transformLinearRing(u.getInteriorRingN(F),u);null===$||$.isEmpty()||($ instanceof so||(y=!1),T.add($))}if(y)return this._factory.createPolygon(x,T.toArray([]));var ee=new An;return null!==x&&ee.add(x),ee.addAll(T),this._factory.buildGeometry(ee)},ea.prototype.createCoordinateSequence=function(u){return this._factory.getCoordinateSequenceFactory().create(u)},ea.prototype.getInputGeometry=function(){return this._inputGeom},ea.prototype.transformMultiLineString=function(u,h){for(var y=new An,x=0;x<u.getNumGeometries();x++){var T=this.transformLineString(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},ea.prototype.transformCoordinates=function(u,h){return this.copy(u)},ea.prototype.transformLineString=function(u,h){return this._factory.createLineString(this.transformCoordinates(u.getCoordinateSequence(),u))},ea.prototype.transformMultiPoint=function(u,h){for(var y=new An,x=0;x<u.getNumGeometries();x++){var T=this.transformPoint(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},ea.prototype.transformMultiPolygon=function(u,h){for(var y=new An,x=0;x<u.getNumGeometries();x++){var T=this.transformPolygon(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},ea.prototype.copy=function(u){return u.copy()},ea.prototype.transformGeometryCollection=function(u,h){for(var y=new An,x=0;x<u.getNumGeometries();x++){var T=this.transform(u.getGeometryN(x));null!==T&&(this._pruneEmptyGeometry&&T.isEmpty()||y.add(T))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(Br.toGeometryArray(y)):this._factory.buildGeometry(y)},ea.prototype.transform=function(u){if(this._inputGeom=u,this._factory=u.getFactory(),u instanceof ks)return this.transformPoint(u,null);if(u instanceof Na)return this.transformMultiPoint(u,null);if(u instanceof so)return this.transformLinearRing(u,null);if(u instanceof gr)return this.transformLineString(u,null);if(u instanceof cr)return this.transformMultiLineString(u,null);if(u instanceof zt)return this.transformPolygon(u,null);if(u instanceof Hi)return this.transformMultiPolygon(u,null);if(u instanceof rr)return this.transformGeometryCollection(u,null);throw new Q("Unknown Geometry subtype: "+u.getClass().getName())},ea.prototype.transformLinearRing=function(u,h){var y=this.transformCoordinates(u.getCoordinateSequence(),u);if(null===y)return this._factory.createLinearRing(null);var x=y.size();return x>0&&x<4&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)},ea.prototype.interfaces_=function(){return[]},ea.prototype.getClass=function(){return ea};var Bu=function u(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new vr,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof gr&&"number"==typeof arguments[1]){var y=arguments[1];u.call(this,arguments[0].getCoordinates(),y)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var x=arguments[0],T=arguments[1];this._srcPts=x,this._isClosed=u.isClosed(x),this._snapTolerance=T}};Bu.prototype.snapVertices=function(u,h){for(var y=this._isClosed?u.size()-1:u.size(),x=0;x<y;x++){var T=u.get(x),F=this.findSnapForVertex(T,h);null!==F&&(u.set(x,new J(F)),0===x&&this._isClosed&&u.set(u.size()-1,new J(F)))}},Bu.prototype.findSnapForVertex=function(u,h){for(var y=0;y<h.length;y++){if(u.equals2D(h[y]))return null;if(u.distance(h[y])<this._snapTolerance)return h[y]}return null},Bu.prototype.snapTo=function(u){var h=new as(this._srcPts);return this.snapVertices(h,u),this.snapSegments(h,u),h.toCoordinateArray()},Bu.prototype.snapSegments=function(u,h){if(0===h.length)return null;var y=h.length;h[0].equals2D(h[h.length-1])&&(y=h.length-1);for(var x=0;x<y;x++){var T=h[x],F=this.findSegmentIndexToSnap(T,u);F>=0&&u.add(F+1,new J(T),!1)}},Bu.prototype.findSegmentIndexToSnap=function(u,h){for(var y=fe.MAX_VALUE,x=-1,T=0;T<h.size()-1;T++){if(this._seg.p0=h.get(T),this._seg.p1=h.get(T+1),this._seg.p0.equals2D(u)||this._seg.p1.equals2D(u)){if(this._allowSnappingToSourceVertices)continue;return-1}var F=this._seg.distance(u);F<this._snapTolerance&&F<y&&(y=F,x=T)}return x},Bu.prototype.setAllowSnappingToSourceVertices=function(u){this._allowSnappingToSourceVertices=u},Bu.prototype.interfaces_=function(){return[]},Bu.prototype.getClass=function(){return Bu},Bu.isClosed=function(u){return!(u.length<=1)&&u[0].equals2D(u[u.length-1])};var ws=function(u){this._srcGeom=u||null},mh={SNAP_PRECISION_FACTOR:{configurable:!0}};ws.prototype.snapTo=function(u,h){var y=this.extractTargetCoordinates(u);return new Bl(h,y).transform(this._srcGeom)},ws.prototype.snapToSelf=function(u,h){var y=this.extractTargetCoordinates(this._srcGeom),x=new Bl(u,y,!0).transform(this._srcGeom),T=x;return h&&kt(T,ia)&&(T=x.buffer(0)),T},ws.prototype.computeSnapTolerance=function(u){return this.computeMinimumSegmentLength(u)/10},ws.prototype.extractTargetCoordinates=function(u){for(var h=new Xt,y=u.getCoordinates(),x=0;x<y.length;x++)h.add(y[x]);return h.toArray(new Array(0).fill(null))},ws.prototype.computeMinimumSegmentLength=function(u){for(var h=fe.MAX_VALUE,y=0;y<u.length-1;y++){var x=u[y].distance(u[y+1]);x<h&&(h=x)}return h},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws},ws.snap=function(u,h,y){var x=new Array(2).fill(null),T=new ws(u);x[0]=T.snapTo(h,y);var F=new ws(h);return x[1]=F.snapTo(x[0],y),x},ws.computeOverlaySnapTolerance=function(){if(1===arguments.length){var u=arguments[0],h=ws.computeSizeBasedSnapTolerance(u),y=u.getPrecisionModel();if(y.getType()===hn.FIXED){var x=1/y.getScale()*2/1.415;x>h&&(h=x)}return h}if(2===arguments.length){var F=arguments[1];return Math.min(ws.computeOverlaySnapTolerance(arguments[0]),ws.computeOverlaySnapTolerance(F))}},ws.computeSizeBasedSnapTolerance=function(u){var h=u.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*ws.SNAP_PRECISION_FACTOR},ws.snapToSelf=function(u,h,y){return new ws(u).snapToSelf(h,y)},mh.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(ws,mh);var Bl=function(u){function h(y,x,T){u.call(this),this._snapTolerance=y||null,this._snapPts=x||null,this._isSelfSnap=void 0!==T&&T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.snapLine=function(y,x){var T=new Bu(y,this._snapTolerance);return T.setAllowSnappingToSourceVertices(this._isSelfSnap),T.snapTo(x)},h.prototype.transformCoordinates=function(y,x){var T=y.toCoordinateArray(),F=this.snapLine(T,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(F)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ea),ua=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};ua.prototype.getCommon=function(){return fe.longBitsToDouble(this._commonBits)},ua.prototype.add=function(u){var h=fe.doubleToLongBits(u);return this._isFirst?(this._commonBits=h,this._commonSignExp=ua.signExpBits(this._commonBits),this._isFirst=!1,null):ua.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=ua.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=ua.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},ua.prototype.toString=function(){if(1===arguments.length){var u=arguments[0],h=fe.longBitsToDouble(u),y="0000000000000000000000000000000000000000000000000000000000000000"+fe.toBinaryString(u),x=y.substring(y.length-64);return x.substring(0,1)+"  "+x.substring(1,12)+"(exp) "+x.substring(12)+" [ "+h+" ]"}},ua.prototype.interfaces_=function(){return[]},ua.prototype.getClass=function(){return ua},ua.getBit=function(u,h){return 0!=(u&1<<h)?1:0},ua.signExpBits=function(u){return u>>52},ua.zeroLowerBits=function(u,h){return u&~((1<<h)-1)},ua.numCommonMostSigMantissaBits=function(u,h){for(var y=0,x=52;x>=0;x--){if(ua.getBit(u,x)!==ua.getBit(h,x))return y;y++}return 52};var Wn=function(){this._commonCoord=null,this._ccFilter=new sc},Iu={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Wn.prototype.addCommonBits=function(u){var h=new Ul(this._commonCoord);u.apply(h),u.geometryChanged()},Wn.prototype.removeCommonBits=function(u){if(0===this._commonCoord.x&&0===this._commonCoord.y)return u;var h=new J(this._commonCoord);h.x=-h.x,h.y=-h.y;var y=new Ul(h);return u.apply(y),u.geometryChanged(),u},Wn.prototype.getCommonCoordinate=function(){return this._commonCoord},Wn.prototype.add=function(u){u.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},Wn.prototype.interfaces_=function(){return[]},Wn.prototype.getClass=function(){return Wn},Iu.CommonCoordinateFilter.get=function(){return sc},Iu.Translater.get=function(){return Ul},Object.defineProperties(Wn,Iu);var sc=function(){this._commonBitsX=new ua,this._commonBitsY=new ua};sc.prototype.filter=function(u){this._commonBitsX.add(u.x),this._commonBitsY.add(u.y)},sc.prototype.getCommonCoordinate=function(){return new J(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},sc.prototype.interfaces_=function(){return[vi]},sc.prototype.getClass=function(){return sc};var Ul=function(){this.trans=null,this.trans=arguments[0]};Ul.prototype.filter=function(u,h){var y=u.getOrdinate(h,0)+this.trans.x,x=u.getOrdinate(h,1)+this.trans.y;u.setOrdinate(h,0,y),u.setOrdinate(h,1,x)},Ul.prototype.isDone=function(){return!1},Ul.prototype.isGeometryChanged=function(){return!0},Ul.prototype.interfaces_=function(){return[cn]},Ul.prototype.getClass=function(){return Ul};var ta=function(u,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=u,this._geom[1]=h,this.computeSnapTolerance()};ta.prototype.selfSnap=function(u){return new ws(u).snapTo(u,this._snapTolerance)},ta.prototype.removeCommonBits=function(u){this._cbr=new Wn,this._cbr.add(u[0]),this._cbr.add(u[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(u[0].copy()),h[1]=this._cbr.removeCommonBits(u[1].copy()),h},ta.prototype.prepareResult=function(u){return this._cbr.addCommonBits(u),u},ta.prototype.getResultGeometry=function(u){var h=this.snap(this._geom),y=Yr.overlayOp(h[0],h[1],u);return this.prepareResult(y)},ta.prototype.checkValid=function(u){u.isValid()||kn.out.println("Snapped geometry is invalid")},ta.prototype.computeSnapTolerance=function(){this._snapTolerance=ws.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},ta.prototype.snap=function(u){var h=this.removeCommonBits(u);return ws.snap(h[0],h[1],this._snapTolerance)},ta.prototype.interfaces_=function(){return[]},ta.prototype.getClass=function(){return ta},ta.overlayOp=function(u,h,y){return new ta(u,h).getResultGeometry(y)},ta.union=function(u,h){return ta.overlayOp(u,h,Yr.UNION)},ta.intersection=function(u,h){return ta.overlayOp(u,h,Yr.INTERSECTION)},ta.symDifference=function(u,h){return ta.overlayOp(u,h,Yr.SYMDIFFERENCE)},ta.difference=function(u,h){return ta.overlayOp(u,h,Yr.DIFFERENCE)};var js=function(u,h){this._geom=new Array(2).fill(null),this._geom[0]=u,this._geom[1]=h};js.prototype.getResultGeometry=function(u){var h=null,y=!1,x=null;try{h=Yr.overlayOp(this._geom[0],this._geom[1],u),y=!0}catch(T){if(!(T instanceof ve))throw T;x=T}if(!y)try{h=ta.overlayOp(this._geom[0],this._geom[1],u)}catch(T){throw T instanceof ve?x:T}return h},js.prototype.interfaces_=function(){return[]},js.prototype.getClass=function(){return js},js.overlayOp=function(u,h,y){return new js(u,h).getResultGeometry(y)},js.union=function(u,h){return js.overlayOp(u,h,Yr.UNION)},js.intersection=function(u,h){return js.overlayOp(u,h,Yr.INTERSECTION)},js.symDifference=function(u,h){return js.overlayOp(u,h,Yr.SYMDIFFERENCE)},js.difference=function(u,h){return js.overlayOp(u,h,Yr.DIFFERENCE)};var Sc=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};Sc.prototype.computeIntersections=function(u,h){this.mce.computeIntersectsForChain(this.chainIndex,u.mce,u.chainIndex,h)},Sc.prototype.interfaces_=function(){return[]},Sc.prototype.getClass=function(){return Sc};var fa=function u(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],y=arguments[1];this._eventType=u.DELETE,this._xValue=h,this._insertEvent=y}else if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2];this._eventType=u.INSERT,this._label=x,this._xValue=T,this._obj=F}},qh={INSERT:{configurable:!0},DELETE:{configurable:!0}};fa.prototype.isDelete=function(){return this._eventType===fa.DELETE},fa.prototype.setDeleteEventIndex=function(u){this._deleteEventIndex=u},fa.prototype.getObject=function(){return this._obj},fa.prototype.compareTo=function(u){return this._xValue<u._xValue?-1:this._xValue>u._xValue?1:this._eventType<u._eventType?-1:this._eventType>u._eventType?1:0},fa.prototype.getInsertEvent=function(){return this._insertEvent},fa.prototype.isInsert=function(){return this._eventType===fa.INSERT},fa.prototype.isSameLabel=function(u){return null!==this._label&&this._label===u._label},fa.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},fa.prototype.interfaces_=function(){return[pe]},fa.prototype.getClass=function(){return fa},qh.INSERT.get=function(){return 1},qh.DELETE.get=function(){return 2},Object.defineProperties(fa,qh);var Zc=function(){};Zc.prototype.interfaces_=function(){return[]},Zc.prototype.getClass=function(){return Zc};var da=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],y=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=y};da.prototype.isTrivialIntersection=function(u,h,y,x){if(u===y&&1===this._li.getIntersectionNum()){if(da.isAdjacentSegments(h,x))return!0;if(u.isClosed()){var T=u.getNumPoints()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},da.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},da.prototype.setIsDoneIfProperInt=function(u){this._isDoneWhenProperInt=u},da.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},da.prototype.isBoundaryPointInternal=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next().getCoordinate();if(u.isIntersection(x))return!0}return!1},da.prototype.hasProperIntersection=function(){return this._hasProper},da.prototype.hasIntersection=function(){return this._hasIntersection},da.prototype.isDone=function(){return this._isDone},da.prototype.isBoundaryPoint=function(u,h){return!(null===h||!this.isBoundaryPointInternal(u,h[0])&&!this.isBoundaryPointInternal(u,h[1]))},da.prototype.setBoundaryNodes=function(u,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=u,this._bdyNodes[1]=h},da.prototype.addIntersections=function(u,h,y,x){if(u===y&&h===x)return null;this.numTests++;var T=u.getCoordinates()[h],F=u.getCoordinates()[h+1],$=y.getCoordinates()[x],ee=y.getCoordinates()[x+1];this._li.computeIntersection(T,F,$,ee),this._li.hasIntersection()&&(this._recordIsolated&&(u.setIsolated(!1),y.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(u,h,y,x)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},da.prototype.interfaces_=function(){return[]},da.prototype.getClass=function(){return da},da.isAdjacentSegments=function(u,h){return 1===Math.abs(u-h)};var cl=function(u){function h(){u.call(this),this.events=new An,this.nOverlaps=null}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.prepareEvents=function(){us.sort(this.events);for(var y=0;y<this.events.size();y++){var x=this.events.get(y);x.isDelete()&&x.getInsertEvent().setDeleteEventIndex(y)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var y=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var x=0;x<this.events.size();x++){var T=this.events.get(x);if(T.isInsert()&&this.processOverlaps(x,T.getDeleteEventIndex(),T,y),y.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof da&&kt(arguments[0],oi)&&kt(arguments[1],oi)){var F=arguments[0],$=arguments[1],ee=arguments[2];this.addEdges(F,F),this.addEdges($,$),this.computeIntersections(ee)}else if("boolean"==typeof arguments[2]&&kt(arguments[0],oi)&&arguments[1]instanceof da){var oe=arguments[0],st=arguments[1];arguments[2]?this.addEdges(oe,null):this.addEdges(oe),this.computeIntersections(st)}},h.prototype.addEdge=function(y,x){for(var T=y.getMonotoneChainEdge(),F=T.getStartIndexes(),$=0;$<F.length-1;$++){var ee=new Sc(T,$),oe=new fa(x,T.getMinX($),ee);this.events.add(oe),this.events.add(new fa(T.getMaxX($),oe))}},h.prototype.processOverlaps=function(y,x,T,F){for(var $=T.getObject(),ee=y;ee<x;ee++){var oe=this.events.get(ee);if(oe.isInsert()){var st=oe.getObject();T.isSameLabel(oe)||($.computeIntersections(st,F),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var y=arguments[0].iterator();y.hasNext();){var x=y.next();this.addEdge(x,x)}else if(2===arguments.length)for(var F=arguments[1],$=arguments[0].iterator();$.hasNext();){var ee=$.next();this.addEdge(ee,F)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Zc),Da=function(){this._min=fe.POSITIVE_INFINITY,this._max=fe.NEGATIVE_INFINITY},na={NodeComparator:{configurable:!0}};Da.prototype.getMin=function(){return this._min},Da.prototype.intersects=function(u,h){return!(this._min>h||this._max<u)},Da.prototype.getMax=function(){return this._max},Da.prototype.toString=function(){return St.toLineString(new J(this._min,0),new J(this._max,0))},Da.prototype.interfaces_=function(){return[]},Da.prototype.getClass=function(){return Da},na.NodeComparator.get=function(){return jl},Object.defineProperties(Da,na);var jl=function(){};jl.prototype.compare=function(u,h){var T=(u._min+u._max)/2,F=(h._min+h._max)/2;return T<F?-1:T>F?1:0},jl.prototype.interfaces_=function(){return[we]},jl.prototype.getClass=function(){return jl};var ud=function(u){function h(){u.call(this),this._item=null;var x=arguments[1],T=arguments[2];this._min=arguments[0],this._max=x,this._item=T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;T.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Da),Hh=function(u){function h(){u.call(this),this._node1=null,this._node2=null;var x=arguments[1];this._node1=arguments[0],this._node2=x,this.buildExtent(this._node1,this._node2)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.buildExtent=function(y,x){this._min=Math.min(y._min,x._min),this._max=Math.max(y._max,x._max)},h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;null!==this._node1&&this._node1.query(y,x,T),null!==this._node2&&this._node2.query(y,x,T)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Da),Tu=function(){this._leaves=new An,this._root=null,this._level=0};Tu.prototype.buildTree=function(){us.sort(this._leaves,new Da.NodeComparator);for(var u=this._leaves,h=null,y=new An;;){if(this.buildLevel(u,y),1===y.size())return y.get(0);h=u,u=y,y=h}},Tu.prototype.insert=function(u,h,y){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new ud(u,h,y))},Tu.prototype.query=function(u,h,y){this.init(),this._root.query(u,h,y)},Tu.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Tu.prototype.printNode=function(u){kn.out.println(St.toLineString(new J(u._min,this._level),new J(u._max,this._level)))},Tu.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Tu.prototype.buildLevel=function(u,h){this._level++,h.clear();for(var y=0;y<u.size();y+=2){var x=u.get(y);if(null===(y+1<u.size()?u.get(y):null))h.add(x);else{var T=new Hh(u.get(y),u.get(y+1));h.add(T)}}},Tu.prototype.interfaces_=function(){return[]},Tu.prototype.getClass=function(){return Tu};var ac=function(){this._items=new An};ac.prototype.visitItem=function(u){this._items.add(u)},ac.prototype.getItems=function(){return this._items},ac.prototype.interfaces_=function(){return[Ss]},ac.prototype.getClass=function(){return ac};var Vl=function(){this._index=null;var u=arguments[0];if(!kt(u,ia))throw new Q("Argument must be Polygonal");this._index=new pa(u)},uc={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Vl.prototype.locate=function(u){var h=new yn(u),y=new wl(h);return this._index.query(u.y,u.y,y),h.getLocation()},Vl.prototype.interfaces_=function(){return[zu]},Vl.prototype.getClass=function(){return Vl},uc.SegmentVisitor.get=function(){return wl},uc.IntervalIndexedGeometry.get=function(){return pa},Object.defineProperties(Vl,uc);var wl=function(){this._counter=null,this._counter=arguments[0]};wl.prototype.visitItem=function(u){var h=u;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},wl.prototype.interfaces_=function(){return[Ss]},wl.prototype.getClass=function(){return wl};var pa=function(){this._index=new Tu,this.init(arguments[0])};pa.prototype.init=function(u){for(var h=is.getLines(u).iterator();h.hasNext();){var y=h.next().getCoordinates();this.addLine(y)}},pa.prototype.addLine=function(u){for(var h=1;h<u.length;h++){var y=new vr(u[h-1],u[h]),x=Math.min(y.p0.y,y.p1.y),T=Math.max(y.p0.y,y.p1.y);this._index.insert(x,T,y)}},pa.prototype.query=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=new ac;return this._index.query(u,h,y),y.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},pa.prototype.interfaces_=function(){return[]},pa.prototype.getClass=function(){return pa};var Ic=function(u){function h(){if(u.call(this),this._parentGeom=null,this._lineEdgeMap=new sl,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new fo,2===arguments.length){var x=arguments[1],T=Pi.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=x,this._boundaryNodeRule=T,null!==x&&this.add(x)}else if(3===arguments.length){var $=arguments[1],ee=arguments[2];this._argIndex=arguments[0],this._parentGeom=$,this._boundaryNodeRule=ee,null!==$&&this.add($)}}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(y,x){var T=this._nodes.addNode(x).getLabel(),F=1;T.getLocation(y,je.ON)===ue.BOUNDARY&&F++;var $=h.determineBoundary(this._boundaryNodeRule,F);T.setLocation(y,$)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var F=arguments[1],$=arguments[2],ee=new da(arguments[0],!0,!1);return ee.setIsDoneIfProperInt($),this.createEdgeSetIntersector().computeIntersections(this._edges,ee,F||!(this._parentGeom instanceof so||this._parentGeom instanceof zt||this._parentGeom instanceof Hi)),this.addSelfIntersectionNodes(this._argIndex),ee}},h.prototype.computeSplitEdges=function(y){for(var x=this._edges.iterator();x.hasNext();)x.next().eiList.addSplitEdges(y)},h.prototype.computeEdgeIntersections=function(y,x,T){var F=new da(x,T,!0);return F.setBoundaryNodes(this.getBoundaryNodes(),y.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,y._edges,F),F},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof ks){var y=arguments[0].getCoordinate();this.insertPoint(this._argIndex,y,ue.INTERIOR)}else arguments[0]instanceof J&&this.insertPoint(this._argIndex,arguments[0],ue.INTERIOR)},h.prototype.addPolygon=function(y){this.addPolygonRing(y.getExteriorRing(),ue.EXTERIOR,ue.INTERIOR);for(var x=0;x<y.getNumInteriorRing();x++){var T=y.getInteriorRingN(x);this.addPolygonRing(T,ue.INTERIOR,ue.EXTERIOR)}},h.prototype.addEdge=function(y){this.insertEdge(y);var x=y.getCoordinates();this.insertPoint(this._argIndex,x[0],ue.BOUNDARY),this.insertPoint(this._argIndex,x[x.length-1],ue.BOUNDARY)},h.prototype.addLineString=function(y){var x=$r.removeRepeatedPoints(y.getCoordinates());if(x.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=x[0],null;var T=new Nr(x,new Pn(this._argIndex,ue.INTERIOR));this._lineEdgeMap.put(y,T),this.insertEdge(T),se.isTrue(x.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,x[0]),this.insertBoundaryPoint(this._argIndex,x[x.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var y=this.getBoundaryNodes(),x=new Array(y.size()).fill(null),T=0,F=y.iterator();F.hasNext();){var $=F.next();x[T++]=$.getCoordinate().copy()}return x},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(y,x,T){if(this.isBoundaryNode(y,x))return null;T===ue.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(y,x):this.insertPoint(y,x,T)},h.prototype.addPolygonRing=function(y,x,T){if(y.isEmpty())return null;var F=$r.removeRepeatedPoints(y.getCoordinates());if(F.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=F[0],null;var $=x,ee=T;Kt.isCCW(F)&&($=T,ee=x);var oe=new Nr(F,new Pn(this._argIndex,ue.BOUNDARY,$,ee));this._lineEdgeMap.put(y,oe),this.insertEdge(oe),this.insertPoint(this._argIndex,F[0],ue.BOUNDARY)},h.prototype.insertPoint=function(y,x,T){var F=this._nodes.addNode(x),$=F.getLabel();null===$?F._label=new Pn(y,T):$.setLocation(y,T)},h.prototype.createEdgeSetIntersector=function(){return new cl},h.prototype.addSelfIntersectionNodes=function(y){for(var x=this._edges.iterator();x.hasNext();)for(var T=x.next(),F=T.getLabel().getLocation(y),$=T.eiList.iterator();$.hasNext();){var ee=$.next();this.addSelfIntersectionNode(y,ee.coord,F)}},h.prototype.add=function(){if(1!==arguments.length)return u.prototype.add.apply(this,arguments);var y=arguments[0];if(y.isEmpty())return null;if(y instanceof Hi&&(this._useBoundaryDeterminationRule=!1),y instanceof zt)this.addPolygon(y);else if(y instanceof gr)this.addLineString(y);else if(y instanceof ks)this.addPoint(y);else if(y instanceof Na)this.addCollection(y);else if(y instanceof cr)this.addCollection(y);else if(y instanceof Hi)this.addCollection(y);else{if(!(y instanceof rr))throw new Error(y.getClass().getName());this.addCollection(y)}},h.prototype.addCollection=function(y){for(var x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.add(T)}},h.prototype.locate=function(y){return kt(this._parentGeom,ia)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new Vl(this._parentGeom)),this._areaPtLocator.locate(y)):this._ptLocator.locate(y,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):u.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(y,x){return y.isInBoundary(x)?ue.BOUNDARY:ue.INTERIOR},h}(bn),bl=function(){if(this._li=new qt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var u=arguments[0];this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new Ic(0,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=Pi.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(y.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(y.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ic(0,h,x),this._arg[1]=new Ic(1,y,x)}else if(3===arguments.length){var T=arguments[0],F=arguments[1],$=arguments[2];T.getPrecisionModel().compareTo(F.getPrecisionModel())>=0?this.setComputationPrecision(T.getPrecisionModel()):this.setComputationPrecision(F.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new Ic(0,T,$),this._arg[1]=new Ic(1,F,$)}};bl.prototype.getArgGeometry=function(u){return this._arg[u].getGeometry()},bl.prototype.setComputationPrecision=function(u){this._resultPrecisionModel=u,this._li.setPrecisionModel(this._resultPrecisionModel)},bl.prototype.interfaces_=function(){return[]},bl.prototype.getClass=function(){return bl};var Vs=function(){};Vs.prototype.interfaces_=function(){return[]},Vs.prototype.getClass=function(){return Vs},Vs.map=function(){if(arguments[0]instanceof On&&kt(arguments[1],Vs.MapOp)){for(var u=arguments[0],h=arguments[1],y=new An,x=0;x<u.getNumGeometries();x++){var T=h.map(u.getGeometryN(x));null!==T&&y.add(T)}return u.getFactory().buildGeometry(y)}if(kt(arguments[0],Ci)&&kt(arguments[1],Vs.MapOp)){for(var F=arguments[0],$=arguments[1],ee=new An,oe=F.iterator();oe.hasNext();){var st=oe.next(),Zt=$.map(st);null!==Zt&&ee.add(Zt)}return ee}},Vs.MapOp=function(){};var Yr=function(u){function h(){var y=arguments[0];u.call(this,y,arguments[1]),this._ptLocator=new fo,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new Ts,this._resultPolyList=new An,this._resultLineList=new An,this._resultPointList=new An,this._graph=new bn(new ul),this._geomFact=y.getFactory()}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(y){var x=this._edgeList.findEqualEdge(y);if(null!==x){var T=x.getLabel(),F=y.getLabel();x.isPointwiseEqual(y)||(F=new Pn(y.getLabel())).flip();var $=x.getDepth();$.isNull()&&$.add(T),$.add(F),T.merge(F)}else this._edgeList.add(y)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var y=this._graph.getEdgeEnds().iterator();y.hasNext();){var x=y.next(),T=x.getSym();x.isInResult()&&T.isInResult()&&(x.setInResult(!1),T.setInResult(!1))}},h.prototype.isCoveredByLA=function(y){return!!this.isCovered(y,this._resultLineList)||!!this.isCovered(y,this._resultPolyList)},h.prototype.computeGeometry=function(y,x,T,F){var $=new An;return $.addAll(y),$.addAll(x),$.addAll(T),$.isEmpty()?h.createEmptyResult(F,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry($)},h.prototype.mergeSymLabels=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(y,x){for(var T=x.iterator();T.hasNext();){var F=T.next();if(this._ptLocator.locate(y,F)!==ue.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var y=new An,x=this._edgeList.iterator();x.hasNext();){var T=x.next();T.isCollapsed()&&(x.remove(),y.add(T.getCollapsedEdge()))}this._edgeList.addAll(y)},h.prototype.updateNodeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getEdges().getLabel();x.getLabel().merge(T)}},h.prototype.getResultGeometry=function(y){return this.computeOverlay(y),this._resultGeom},h.prototype.insertUniqueEdges=function(y){for(var x=y.iterator();x.hasNext();){var T=x.next();this.insertUniqueEdge(T)}},h.prototype.computeOverlay=function(y){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var x=new An;this._arg[0].computeSplitEdges(x),this._arg[1].computeSplitEdges(x),this.insertUniqueEdges(x),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),xl.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(y),this.cancelDuplicateResultEdges();var T=new ao(this._geomFact);T.add(this._graph),this._resultPolyList=T.getPolygons();var F=new au(this,this._geomFact,this._ptLocator);this._resultLineList=F.build(y);var $=new ll(this,this._geomFact,this._ptLocator);this._resultPointList=$.build(y),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,y)},h.prototype.labelIncompleteNode=function(y,x){var T=this._ptLocator.locate(y.getCoordinate(),this._arg[x].getGeometry());y.getLabel().setLocation(x,T)},h.prototype.copyPoints=function(y){for(var x=this._arg[y].getNodeIterator();x.hasNext();){var T=x.next();this._graph.addNode(T.getCoordinate()).setLabel(y,T.getLabel().getLocation(y))}},h.prototype.findResultAreaEdges=function(y){for(var x=this._graph.getEdgeEnds().iterator();x.hasNext();){var T=x.next(),F=T.getLabel();F.isArea()&&!T.isInteriorAreaEdge()&&h.isResultOfOp(F.getLocation(0,je.RIGHT),F.getLocation(1,je.RIGHT),y)&&T.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var y=this._edgeList.iterator();y.hasNext();){var x=y.next(),T=x.getLabel(),F=x.getDepth();if(!F.isNull()){F.normalize();for(var $=0;$<2;$++)T.isNull($)||!T.isArea()||F.isNull($)||(0===F.getDelta($)?T.toLine($):(se.isTrue(!F.isNull($,je.LEFT),"depth of LEFT side has not been initialized"),T.setLocation($,je.LEFT,F.getLocation($,je.LEFT)),se.isTrue(!F.isNull($,je.RIGHT),"depth of RIGHT side has not been initialized"),T.setLocation($,je.RIGHT,F.getLocation($,je.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getLabel();x.isIsolated()&&(T.isNull(0)?this.labelIncompleteNode(x,0):this.labelIncompleteNode(x,1)),x.getEdges().updateLabelling(T)}},h.prototype.isCoveredByA=function(y){return!!this.isCovered(y,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(bl);Yr.overlayOp=function(u,h,y){return new Yr(u,h).getResultGeometry(y)},Yr.intersection=function(u,h){if(u.isEmpty()||h.isEmpty())return Yr.createEmptyResult(Yr.INTERSECTION,u,h,u.getFactory());if(u.isGeometryCollection()){var y=h;return oc.map(u,{interfaces_:function(){return[Vs.MapOp]},map:function(x){return x.intersection(y)}})}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),js.overlayOp(u,h,Yr.INTERSECTION)},Yr.symDifference=function(u,h){if(u.isEmpty()||h.isEmpty()){if(u.isEmpty()&&h.isEmpty())return Yr.createEmptyResult(Yr.SYMDIFFERENCE,u,h,u.getFactory());if(u.isEmpty())return h.copy();if(h.isEmpty())return u.copy()}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),js.overlayOp(u,h,Yr.SYMDIFFERENCE)},Yr.resultDimension=function(u,h,y){var x=h.getDimension(),T=y.getDimension(),F=-1;switch(u){case Yr.INTERSECTION:F=Math.min(x,T);break;case Yr.UNION:F=Math.max(x,T);break;case Yr.DIFFERENCE:F=x;break;case Yr.SYMDIFFERENCE:F=Math.max(x,T)}return F},Yr.createEmptyResult=function(u,h,y,x){var T=null;switch(Yr.resultDimension(u,h,y)){case-1:T=x.createGeometryCollection(new Array(0).fill(null));break;case 0:T=x.createPoint();break;case 1:T=x.createLineString();break;case 2:T=x.createPolygon()}return T},Yr.difference=function(u,h){return u.isEmpty()?Yr.createEmptyResult(Yr.DIFFERENCE,u,h,u.getFactory()):h.isEmpty()?u.copy():(u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),js.overlayOp(u,h,Yr.DIFFERENCE))},Yr.isResultOfOp=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=u.getLocation(0),x=u.getLocation(1);return Yr.isResultOfOp(y,x,h)}if(3===arguments.length){var T=arguments[0],F=arguments[1];switch(T===ue.BOUNDARY&&(T=ue.INTERIOR),F===ue.BOUNDARY&&(F=ue.INTERIOR),arguments[2]){case Yr.INTERSECTION:return T===ue.INTERIOR&&F===ue.INTERIOR;case Yr.UNION:return T===ue.INTERIOR||F===ue.INTERIOR;case Yr.DIFFERENCE:return T===ue.INTERIOR&&F!==ue.INTERIOR;case Yr.SYMDIFFERENCE:return T===ue.INTERIOR&&F!==ue.INTERIOR||T!==ue.INTERIOR&&F===ue.INTERIOR}return!1}},Yr.INTERSECTION=1,Yr.UNION=2,Yr.DIFFERENCE=3,Yr.SYMDIFFERENCE=4;var Ua=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new fo,this._seg=new vr;var u=arguments[0],h=arguments[1];this._g=u,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(u)};Ua.prototype.isWithinToleranceOfBoundary=function(u){for(var h=0;h<this._linework.getNumGeometries();h++)for(var y=this._linework.getGeometryN(h).getCoordinateSequence(),x=0;x<y.size()-1;x++)if(y.getCoordinate(x,this._seg.p0),y.getCoordinate(x+1,this._seg.p1),this._seg.distance(u)<=this._boundaryDistanceTolerance)return!0;return!1},Ua.prototype.getLocation=function(u){return this.isWithinToleranceOfBoundary(u)?ue.BOUNDARY:this._ptLocator.locate(u,this._g)},Ua.prototype.extractLinework=function(u){var h=new Aa;u.apply(h);var y=h.getLinework(),x=Br.toLineStringArray(y);return u.getFactory().createMultiLineString(x)},Ua.prototype.interfaces_=function(){return[]},Ua.prototype.getClass=function(){return Ua};var Aa=function(){this._linework=null,this._linework=new An};Aa.prototype.getLinework=function(){return this._linework},Aa.prototype.filter=function(u){if(u instanceof zt){var h=u;this._linework.add(h.getExteriorRing());for(var y=0;y<h.getNumInteriorRing();y++)this._linework.add(h.getInteriorRingN(y))}},Aa.prototype.interfaces_=function(){return[Rn]},Aa.prototype.getClass=function(){return Aa};var hl=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};hl.prototype.extractPoints=function(u,h,y){for(var x=u.getCoordinates(),T=0;T<x.length-1;T++)this.computeOffsetPoints(x[T],x[T+1],h,y)},hl.prototype.setSidesToGenerate=function(u,h){this._doLeft=u,this._doRight=h},hl.prototype.getPoints=function(u){for(var h=new An,y=is.getLines(this._g).iterator();y.hasNext();){var x=y.next();this.extractPoints(x,u,h)}return h},hl.prototype.computeOffsetPoints=function(u,h,y,x){var T=h.x-u.x,F=h.y-u.y,$=Math.sqrt(T*T+F*F),ee=y*T/$,oe=y*F/$,st=(h.x+u.x)/2,Zt=(h.y+u.y)/2;if(this._doLeft){var Qt=new J(st-oe,Zt+ee);x.add(Qt)}if(this._doRight){var xt=new J(st+oe,Zt-ee);x.add(xt)}},hl.prototype.interfaces_=function(){return[]},hl.prototype.getClass=function(){return hl};var ga=function u(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=u.TOLERANCE,this._testCoords=new An;var h=arguments[0],y=arguments[1],x=arguments[2];this._boundaryDistanceTolerance=u.computeBoundaryDistanceTolerance(h,y),this._geom=[h,y,x],this._locFinder=[new Ua(this._geom[0],this._boundaryDistanceTolerance),new Ua(this._geom[1],this._boundaryDistanceTolerance),new Ua(this._geom[2],this._boundaryDistanceTolerance)]},Gl={TOLERANCE:{configurable:!0}};ga.prototype.reportResult=function(u,h,y){kn.out.println("Overlay result invalid - A:"+ue.toLocationSymbol(h[0])+" B:"+ue.toLocationSymbol(h[1])+" expected:"+(y?"i":"e")+" actual:"+ue.toLocationSymbol(h[2]))},ga.prototype.isValid=function(u){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(u)},ga.prototype.checkValid=function(){if(1===arguments.length){for(var u=arguments[0],h=0;h<this._testCoords.size();h++){var y=this._testCoords.get(h);if(!this.checkValid(u,y))return this._invalidLocation=y,!1}return!0}if(2===arguments.length){var x=arguments[0],T=arguments[1];return this._location[0]=this._locFinder[0].getLocation(T),this._location[1]=this._locFinder[1].getLocation(T),this._location[2]=this._locFinder[2].getLocation(T),!!ga.hasLocation(this._location,ue.BOUNDARY)||this.isValidResult(x,this._location)}},ga.prototype.addTestPts=function(u){var h=new hl(u);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},ga.prototype.isValidResult=function(u,h){var y=Yr.isResultOfOp(h[0],h[1],u),x=!(y^h[2]===ue.INTERIOR);return x||this.reportResult(u,h,y),x},ga.prototype.getInvalidLocation=function(){return this._invalidLocation},ga.prototype.interfaces_=function(){return[]},ga.prototype.getClass=function(){return ga},ga.hasLocation=function(u,h){for(var y=0;y<3;y++)if(u[y]===h)return!0;return!1},ga.computeBoundaryDistanceTolerance=function(u,h){return Math.min(ws.computeSizeBasedSnapTolerance(u),ws.computeSizeBasedSnapTolerance(h))},ga.isValid=function(u,h,y,x){return new ga(u,h,x).isValid(y)},Gl.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(ga,Gl);var gs=function u(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=u.extractFactory(h),this._inputGeoms=h};gs.prototype.extractElements=function(u,h){if(null===u)return null;for(var y=0;y<u.getNumGeometries();y++){var x=u.getGeometryN(y);this._skipEmpty&&x.isEmpty()||h.add(x)}},gs.prototype.combine=function(){for(var u=new An,h=this._inputGeoms.iterator();h.hasNext();){var y=h.next();this.extractElements(y,u)}return 0===u.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(u)},gs.prototype.interfaces_=function(){return[]},gs.prototype.getClass=function(){return gs},gs.combine=function(){return 1===arguments.length?new gs(arguments[0]).combine():2===arguments.length?new gs(gs.createList(arguments[0],arguments[1])).combine():3===arguments.length?new gs(gs.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},gs.extractFactory=function(u){return u.isEmpty()?null:u.iterator().next().getFactory()},gs.createList=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=new An;return y.add(u),y.add(h),y}if(3===arguments.length){var x=arguments[0],T=arguments[1],F=arguments[2],$=new An;return $.add(x),$.add(T),$.add(F),$}};var Ds=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new An)},ma={STRTREE_NODE_CAPACITY:{configurable:!0}};Ds.prototype.reduceToGeometries=function(u){for(var h=new An,y=u.iterator();y.hasNext();){var x=y.next(),T=null;kt(x,oi)?T=this.unionTree(x):x instanceof On&&(T=x),h.add(T)}return h},Ds.prototype.extractByEnvelope=function(u,h,y){for(var x=new An,T=0;T<h.getNumGeometries();T++){var F=h.getGeometryN(T);F.getEnvelopeInternal().intersects(u)?x.add(F):y.add(F)}return this._geomFactory.buildGeometry(x)},Ds.prototype.unionOptimized=function(u,h){var y=u.getEnvelopeInternal(),x=h.getEnvelopeInternal();if(!y.intersects(x))return gs.combine(u,h);if(u.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(u,h);var T=y.intersection(x);return this.unionUsingEnvelopeIntersection(u,h,T)},Ds.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var u=new Hc(Ds.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var y=h.next();u.insert(y.getEnvelopeInternal(),y)}this._inputPolys=null;var x=u.itemsTree();return this.unionTree(x)},Ds.prototype.binaryUnion=function(){if(1===arguments.length){var u=arguments[0];return this.binaryUnion(u,0,u.size())}if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2];if(x-y<=1){var T=Ds.getGeometry(h,y);return this.unionSafe(T,null)}if(x-y==2)return this.unionSafe(Ds.getGeometry(h,y),Ds.getGeometry(h,y+1));var F=Math.trunc((x+y)/2),$=this.binaryUnion(h,y,F),ee=this.binaryUnion(h,F,x);return this.unionSafe($,ee)}},Ds.prototype.repeatedUnion=function(u){for(var h=null,y=u.iterator();y.hasNext();){var x=y.next();h=null===h?x.copy():h.union(x)}return h},Ds.prototype.unionSafe=function(u,h){return null===u&&null===h?null:null===u?h.copy():null===h?u.copy():this.unionOptimized(u,h)},Ds.prototype.unionActual=function(u,h){return Ds.restrictToPolygons(u.union(h))},Ds.prototype.unionTree=function(u){var h=this.reduceToGeometries(u);return this.binaryUnion(h)},Ds.prototype.unionUsingEnvelopeIntersection=function(u,h,y){var x=new An,T=this.extractByEnvelope(y,u,x),F=this.extractByEnvelope(y,h,x),$=this.unionActual(T,F);return x.add($),gs.combine(x)},Ds.prototype.bufferUnion=function(){if(1===arguments.length){var u=arguments[0];return u.get(0).getFactory().buildGeometry(u).buffer(0)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().createGeometryCollection([h,y]).buffer(0)}},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds},Ds.restrictToPolygons=function(u){if(kt(u,ia))return u;var h=eo.getPolygons(u);return 1===h.size()?h.get(0):u.getFactory().createMultiPolygon(Br.toPolygonArray(h))},Ds.getGeometry=function(u,h){return h>=u.size()?null:u.get(h)},Ds.union=function(u){return new Ds(u).union()},ma.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Ds,ma);var Tc=function(){};Tc.prototype.interfaces_=function(){return[]},Tc.prototype.getClass=function(){return Tc},Tc.union=function(u,h){if(u.isEmpty()||h.isEmpty()){if(u.isEmpty()&&h.isEmpty())return Yr.createEmptyResult(Yr.UNION,u,h,u.getFactory());if(u.isEmpty())return h.copy();if(h.isEmpty())return u.copy()}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),js.overlayOp(u,h,Yr.UNION)},He.GeoJSONReader=pt,He.GeoJSONWriter=Bt,He.OverlayOp=Yr,He.UnionOp=Tc,He.BufferOp=fi,Object.defineProperty(He,"__esModule",{value:!0})}(It)}},xn=>{xn(xn.s=7521)}]);