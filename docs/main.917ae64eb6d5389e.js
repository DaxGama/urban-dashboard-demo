(self.webpackChunkstreet_viewer_app=self.webpackChunkstreet_viewer_app||[]).push([[179],{7521:(an,vt,je)=>{"use strict";function Ee(e){return"function"==typeof e}function Fe(e){const n=e(r=>{Error.call(r),r.stack=(new Error).stack});return n.prototype=Object.create(Error.prototype),n.prototype.constructor=n,n}const lt=Fe(e=>function(n){e(this),this.message=n?`${n.length} errors occurred during unsubscription:\n${n.map((r,o)=>`${o+1}) ${r.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=n});function p(e,t){if(e){const n=e.indexOf(t);0<=n&&e.splice(n,1)}}class ve{constructor(t){this.initialTeardown=t,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let t;if(!this.closed){this.closed=!0;const{_parentage:n}=this;if(n)if(this._parentage=null,Array.isArray(n))for(const c of n)c.remove(this);else n.remove(this);const{initialTeardown:r}=this;if(Ee(r))try{r()}catch(c){t=c instanceof lt?c.errors:[c]}const{_finalizers:o}=this;if(o){this._finalizers=null;for(const c of o)try{ft(c)}catch(d){t=t??[],d instanceof lt?t=[...t,...d.errors]:t.push(d)}}if(t)throw new lt(t)}}add(t){var n;if(t&&t!==this)if(this.closed)ft(t);else{if(t instanceof ve){if(t.closed||t._hasParent(this))return;t._addParent(this)}(this._finalizers=null!==(n=this._finalizers)&&void 0!==n?n:[]).push(t)}}_hasParent(t){const{_parentage:n}=this;return n===t||Array.isArray(n)&&n.includes(t)}_addParent(t){const{_parentage:n}=this;this._parentage=Array.isArray(n)?(n.push(t),n):n?[n,t]:t}_removeParent(t){const{_parentage:n}=this;n===t?this._parentage=null:Array.isArray(n)&&p(n,t)}remove(t){const{_finalizers:n}=this;n&&p(n,t),t instanceof ve&&t._removeParent(this)}}ve.EMPTY=(()=>{const e=new ve;return e.closed=!0,e})();const $e=ve.EMPTY;function ut(e){return e instanceof ve||e&&"closed"in e&&Ee(e.remove)&&Ee(e.add)&&Ee(e.unsubscribe)}function ft(e){Ee(e)?e():e.unsubscribe()}const Ct={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},Yt={setTimeout(e,t,...n){const{delegate:r}=Yt;return r?.setTimeout?r.setTimeout(e,t,...n):setTimeout(e,t,...n)},clearTimeout(e){const{delegate:t}=Yt;return(t?.clearTimeout||clearTimeout)(e)},delegate:void 0};function Ot(e){Yt.setTimeout(()=>{const{onUnhandledError:t}=Ct;if(!t)throw e;t(e)})}function xt(){}const Ut=Ie("C",void 0,void 0);function Ie(e,t,n){return{kind:e,value:t,error:n}}let le=null;function Y(e){if(Ct.useDeprecatedSynchronousErrorHandling){const t=!le;if(t&&(le={errorThrown:!1,error:null}),e(),t){const{errorThrown:n,error:r}=le;if(le=null,n)throw r}}else e()}class ke extends ve{constructor(t){super(),this.isStopped=!1,t?(this.destination=t,ut(t)&&t.add(this)):this.destination=ue}static create(t,n,r){return new J(t,n,r)}next(t){this.isStopped?qe(function he(e){return Ie("N",e,void 0)}(t),this):this._next(t)}error(t){this.isStopped?qe(function pn(e){return Ie("E",void 0,e)}(t),this):(this.isStopped=!0,this._error(t))}complete(){this.isStopped?qe(Ut,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(t){this.destination.next(t)}_error(t){try{this.destination.error(t)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const de=Function.prototype.bind;function se(e,t){return de.call(e,t)}class we{constructor(t){this.partialObserver=t}next(t){const{partialObserver:n}=this;if(n.next)try{n.next(t)}catch(r){pt(r)}}error(t){const{partialObserver:n}=this;if(n.error)try{n.error(t)}catch(r){pt(r)}else pt(t)}complete(){const{partialObserver:t}=this;if(t.complete)try{t.complete()}catch(n){pt(n)}}}class J extends ke{constructor(t,n,r){let o;if(super(),Ee(t)||!t)o={next:t??void 0,error:n??void 0,complete:r??void 0};else{let c;this&&Ct.useDeprecatedNextContext?(c=Object.create(t),c.unsubscribe=()=>this.unsubscribe(),o={next:t.next&&se(t.next,c),error:t.error&&se(t.error,c),complete:t.complete&&se(t.complete,c)}):o=t}this.destination=new we(o)}}function pt(e){Ct.useDeprecatedSynchronousErrorHandling?function ce(e){Ct.useDeprecatedSynchronousErrorHandling&&le&&(le.errorThrown=!0,le.error=e)}(e):Ot(e)}function qe(e,t){const{onStoppedNotification:n}=Ct;n&&Yt.setTimeout(()=>n(e,t))}const ue={closed:!0,next:xt,error:function Ve(e){throw e},complete:xt},Zt="function"==typeof Symbol&&Symbol.observable||"@@observable";function At(e){return e}function ct(e){return 0===e.length?At:1===e.length?e[0]:function(n){return e.reduce((r,o)=>o(r),n)}}let Me=(()=>{class e{constructor(n){n&&(this._subscribe=n)}lift(n){const r=new e;return r.source=this,r.operator=n,r}subscribe(n,r,o){const c=function Ae(e){return e&&e instanceof ke||function dt(e){return e&&Ee(e.next)&&Ee(e.error)&&Ee(e.complete)}(e)&&ut(e)}(n)?n:new J(n,r,o);return Y(()=>{const{operator:d,source:_}=this;c.add(d?d.call(c,_):_?this._subscribe(c):this._trySubscribe(c))}),c}_trySubscribe(n){try{return this._subscribe(n)}catch(r){n.error(r)}}forEach(n,r){return new(r=tt(r))((o,c)=>{const d=new J({next:_=>{try{n(_)}catch(E){c(E),d.unsubscribe()}},error:c,complete:o});this.subscribe(d)})}_subscribe(n){var r;return null===(r=this.source)||void 0===r?void 0:r.subscribe(n)}[Zt](){return this}pipe(...n){return ct(n)(this)}toPromise(n){return new(n=tt(n))((r,o)=>{let c;this.subscribe(d=>c=d,d=>o(d),()=>r(c))})}}return e.create=t=>new e(t),e})();function tt(e){var t;return null!==(t=e??Ct.Promise)&&void 0!==t?t:Promise}const Vt=Fe(e=>function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let Nt=(()=>{class e extends Me{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(n){const r=new fn(this,this);return r.operator=n,r}_throwIfClosed(){if(this.closed)throw new Vt}next(n){Y(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const r of this.currentObservers)r.next(n)}})}error(n){Y(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=n;const{observers:r}=this;for(;r.length;)r.shift().error(n)}})}complete(){Y(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:n}=this;for(;n.length;)n.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var n;return(null===(n=this.observers)||void 0===n?void 0:n.length)>0}_trySubscribe(n){return this._throwIfClosed(),super._trySubscribe(n)}_subscribe(n){return this._throwIfClosed(),this._checkFinalizedStatuses(n),this._innerSubscribe(n)}_innerSubscribe(n){const{hasError:r,isStopped:o,observers:c}=this;return r||o?$e:(this.currentObservers=null,c.push(n),new ve(()=>{this.currentObservers=null,p(c,n)}))}_checkFinalizedStatuses(n){const{hasError:r,thrownError:o,isStopped:c}=this;r?n.error(o):c&&n.complete()}asObservable(){const n=new Me;return n.source=this,n}}return e.create=(t,n)=>new fn(t,n),e})();class fn extends Nt{constructor(t,n){super(),this.destination=t,this.source=n}next(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.next)||void 0===r||r.call(n,t)}error(t){var n,r;null===(r=null===(n=this.destination)||void 0===n?void 0:n.error)||void 0===r||r.call(n,t)}complete(){var t,n;null===(n=null===(t=this.destination)||void 0===t?void 0:t.complete)||void 0===n||n.call(t)}_subscribe(t){var n,r;return null!==(r=null===(n=this.source)||void 0===n?void 0:n.subscribe(t))&&void 0!==r?r:$e}}function Lt(e){return Ee(e?.lift)}function Mn(e){return t=>{if(Lt(t))return t.lift(function(n){try{return e(n,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function Rn(e,t,n,r,o){return new Bn(e,t,n,r,o)}class Bn extends ke{constructor(t,n,r,o,c,d){super(t),this.onFinalize=c,this.shouldUnsubscribe=d,this._next=n?function(_){try{n(_)}catch(E){t.error(E)}}:super._next,this._error=o?function(_){try{o(_)}catch(E){t.error(E)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(_){t.error(_)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:n}=this;super.unsubscribe(),!n&&(null===(t=this.onFinalize)||void 0===t||t.call(this))}}}function vn(e,t){return Mn((n,r)=>{let o=0;n.subscribe(Rn(r,c=>{r.next(e.call(t,c,o++))}))})}function Gt(e){return this instanceof Gt?(this.v=e,this):new Gt(e)}function ur(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=n.apply(e,t||[]),c=[];return o={},d("next"),d("throw"),d("return"),o[Symbol.asyncIterator]=function(){return this},o;function d(N){r[N]&&(o[N]=function(z){return new Promise(function(Q,ee){c.push([N,z,Q,ee])>1||_(N,z)})})}function _(N,z){try{!function E(N){N.value instanceof Gt?Promise.resolve(N.value.v).then(C,A):R(c[0][2],N)}(r[N](z))}catch(Q){R(c[0][3],Q)}}function C(N){_("next",N)}function A(N){_("throw",N)}function R(N,z){N(z),c.shift(),c.length&&_(c[0][0],c[0][1])}}function En(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,t=e[Symbol.asyncIterator];return t?t.call(e):(e=function ze(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),n={},r("next"),r("throw"),r("return"),n[Symbol.asyncIterator]=function(){return this},n);function r(c){n[c]=e[c]&&function(d){return new Promise(function(_,E){!function o(c,d,_,E){Promise.resolve(E).then(function(C){c({value:C,done:_})},d)}(_,E,(d=e[c](d)).done,d.value)})}}}const wo=e=>e&&"number"==typeof e.length&&"function"!=typeof e;function ds(e){return Ee(e?.then)}function oi(e){return Ee(e[Zt])}function As(e){return Symbol.asyncIterator&&Ee(e?.[Symbol.asyncIterator])}function ts(e){return new TypeError(`You provided ${null!==e&&"object"==typeof e?"an invalid object":`'${e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const au=function gn(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function No(e){return Ee(e?.[au])}function _r(e){return ur(this,arguments,function*(){const n=e.getReader();try{for(;;){const{value:r,done:o}=yield Gt(n.read());if(o)return yield Gt(void 0);yield yield Gt(r)}}finally{n.releaseLock()}})}function Oa(e){return Ee(e?.getReader)}function Go(e){if(e instanceof Me)return e;if(null!=e){if(oi(e))return function Le(e){return new Me(t=>{const n=e[Zt]();if(Ee(n.subscribe))return n.subscribe(t);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(e);if(wo(e))return function W(e){return new Me(t=>{for(let n=0;n<e.length&&!t.closed;n++)t.next(e[n]);t.complete()})}(e);if(ds(e))return function ne(e){return new Me(t=>{e.then(n=>{t.closed||(t.next(n),t.complete())},n=>t.error(n)).then(null,Ot)})}(e);if(As(e))return He(e);if(No(e))return function Oe(e){return new Me(t=>{for(const n of e)if(t.next(n),t.closed)return;t.complete()})}(e);if(Oa(e))return function nt(e){return He(_r(e))}(e)}throw ts(e)}function He(e){return new Me(t=>{(function bt(e,t){var n,r,o,c;return function _t(e,t,n,r){return new(n||(n=Promise))(function(c,d){function _(A){try{C(r.next(A))}catch(R){d(R)}}function E(A){try{C(r.throw(A))}catch(R){d(R)}}function C(A){A.done?c(A.value):function o(c){return c instanceof n?c:new n(function(d){d(c)})}(A.value).then(_,E)}C((r=r.apply(e,t||[])).next())})}(this,void 0,void 0,function*(){try{for(n=En(e);!(r=yield n.next()).done;)if(t.next(r.value),t.closed)return}catch(d){o={error:d}}finally{try{r&&!r.done&&(c=n.return)&&(yield c.call(n))}finally{if(o)throw o.error}}t.complete()})})(e,t).catch(n=>t.error(n))})}function yt(e,t,n,r=0,o=!1){const c=t.schedule(function(){n(),o?e.add(this.schedule(null,r)):this.unsubscribe()},r);if(e.add(c),!o)return c}function st(e,t,n=1/0){return Ee(t)?st((r,o)=>vn((c,d)=>t(r,c,o,d))(Go(e(r,o))),n):("number"==typeof t&&(n=t),Mn((r,o)=>function at(e,t,n,r,o,c,d,_){const E=[];let C=0,A=0,R=!1;const N=()=>{R&&!E.length&&!C&&t.complete()},z=ee=>C<r?Q(ee):E.push(ee),Q=ee=>{c&&t.next(ee),C++;let Te=!1;Go(n(ee,A++)).subscribe(Rn(t,me=>{o?.(me),c?z(me):t.next(me)},()=>{Te=!0},void 0,()=>{if(Te)try{for(C--;E.length&&C<r;){const me=E.shift();d?yt(t,d,()=>Q(me)):Q(me)}N()}catch(me){t.error(me)}}))};return e.subscribe(Rn(t,z,()=>{R=!0,N()})),()=>{_?.()}}(r,o,e,n)))}function Xt(e=1/0){return st(At,e)}const yn=new Me(e=>e.complete());function Fn(e){return e[e.length-1]}function nr(e){return function $n(e){return e&&Ee(e.schedule)}(Fn(e))?e.pop():void 0}function Nn(e,t=0){return Mn((n,r)=>{n.subscribe(Rn(r,o=>yt(r,e,()=>r.next(o),t),()=>yt(r,e,()=>r.complete(),t),o=>yt(r,e,()=>r.error(o),t)))})}function dr(e,t=0){return Mn((n,r)=>{r.add(e.schedule(()=>n.subscribe(r),t))})}function Na(e,t){if(!e)throw new Error("Iterable cannot be null");return new Me(n=>{yt(n,t,()=>{const r=e[Symbol.asyncIterator]();yt(n,t,()=>{r.next().then(o=>{o.done?n.complete():n.next(o.value)})},0,!0)})})}function Di(e,t){return t?function ra(e,t){if(null!=e){if(oi(e))return function _i(e,t){return Go(e).pipe(dr(t),Nn(t))}(e,t);if(wo(e))return function fa(e,t){return new Me(n=>{let r=0;return t.schedule(function(){r===e.length?n.complete():(n.next(e[r++]),n.closed||this.schedule())})})}(e,t);if(ds(e))return function ps(e,t){return Go(e).pipe(dr(t),Nn(t))}(e,t);if(As(e))return Na(e,t);if(No(e))return function Rt(e,t){return new Me(n=>{let r;return yt(n,t,()=>{r=e[au](),yt(n,t,()=>{let o,c;try{({value:o,done:c}=r.next())}catch(d){return void n.error(d)}c?n.complete():n.next(o)},0,!0)}),()=>Ee(r?.return)&&r.return()})}(e,t);if(Oa(e))return function go(e,t){return Na(_r(e),t)}(e,t)}throw ts(e)}(e,t):Go(e)}function Vl(e,t,...n){if(!0===t)return void e();if(!1===t)return;const r=new J({next:()=>{r.unsubscribe(),e()}});return t(...n).subscribe(r)}function di(e){for(let t in e)if(e[t]===di)return t;throw Error("Could not find renamed property on target object.")}function qn(e){if("string"==typeof e)return e;if(Array.isArray(e))return"["+e.map(qn).join(", ")+"]";if(null==e)return""+e;if(e.overriddenName)return`${e.overriddenName}`;if(e.name)return`${e.name}`;const t=e.toString();if(null==t)return""+t;const n=t.indexOf("\n");return-1===n?t:t.substring(0,n)}function vr(e,t){return null==e||""===e?null===t?"":t:null==t||""===t?e:e+" "+t}const Cu=di({__forward_ref__:di});function pl(e){return e.__forward_ref__=pl,e.toString=function(){return qn(this())},e}function Qt(e){return gl(e)?e():e}function gl(e){return"function"==typeof e&&e.hasOwnProperty(Cu)&&e.__forward_ref__===pl}function Hs(e){return e&&!!e.\u0275providers}class xn extends Error{constructor(t,n){super(function Uh(e,t){return`NG0${Math.abs(e)}${t?": "+t.trim():""}`}(t,n)),this.code=t}}function gr(e){return"string"==typeof e?e:null==e?"":String(e)}function mn(e,t){throw new xn(-201,!1)}function Vr(e,t){null==e&&function li(e,t,n,r){throw new Error(`ASSERTION ERROR: ${e}`+(null==r?"":` [Expected=> ${n} ${r} ${t} <=Actual]`))}(t,e,null,"!=")}function kn(e){return{token:e.token,providedIn:e.providedIn||null,factory:e.factory,value:void 0}}function Ea(e){return{providers:e.providers||[],imports:e.imports||[]}}function Ca(e){return za(e,$o)||za(e,Eo)}function za(e,t){return e.hasOwnProperty(t)?e[t]:null}function ml(e){return e&&(e.hasOwnProperty(bo)||e.hasOwnProperty(Bc))?e[bo]:null}const $o=di({\u0275prov:di}),bo=di({\u0275inj:di}),Eo=di({ngInjectableDef:di}),Bc=di({ngInjectorDef:di});var wr=(()=>((wr=wr||{})[wr.Default=0]="Default",wr[wr.Host=1]="Host",wr[wr.Self=2]="Self",wr[wr.SkipSelf=4]="SkipSelf",wr[wr.Optional=8]="Optional",wr))();let da;function Sa(e){const t=da;return da=e,t}function Xs(e,t,n){const r=Ca(e);return r&&"root"==r.providedIn?void 0===r.value?r.value=r.factory():r.value:n&wr.Optional?null:void 0!==t?t:void mn(qn(e))}const Jr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),mo={},Wn="__NG_DI_FLAG__",Gl="ngTempTokenPath",ns=/\n/gm,cu="__source";let Tu;function Nu(e){const t=Tu;return Tu=e,t}function hh(e,t=wr.Default){if(void 0===Tu)throw new xn(-203,!1);return null===Tu?Xs(e,void 0,t):Tu.get(e,t&wr.Optional?null:void 0,t)}function Pn(e,t=wr.Default){return(function Sf(){return da}()||hh)(Qt(e),t)}function rr(e,t=wr.Default){return Pn(e,ku(t))}function ku(e){return typeof e>"u"||"number"==typeof e?e:0|(e.optional&&8)|(e.host&&1)|(e.self&&2)|(e.skipSelf&&4)}function Is(e){const t=[];for(let n=0;n<e.length;n++){const r=Qt(e[n]);if(Array.isArray(r)){if(0===r.length)throw new xn(900,!1);let o,c=wr.Default;for(let d=0;d<r.length;d++){const _=r[d],E=Gr(_);"number"==typeof E?-1===E?o=_.token:c|=E:o=_}t.push(Pn(o,c))}else t.push(Pn(r))}return t}function hu(e,t){return e[Wn]=t,e.prototype[Wn]=t,e}function Gr(e){return e[Wn]}function Xa(e){return{toString:e}.toString()}var Mo=(()=>((Mo=Mo||{})[Mo.OnPush=0]="OnPush",Mo[Mo.Default=1]="Default",Mo))(),oa=(()=>{return(e=oa||(oa={}))[e.Emulated=0]="Emulated",e[e.None=2]="None",e[e.ShadowDom=3]="ShadowDom",oa;var e})();const $r={},Hr=[],Fu=di({\u0275cmp:di}),Ia=di({\u0275dir:di}),Zs=di({\u0275pipe:di}),ys=di({\u0275mod:di}),zu=di({\u0275fac:di}),mc=di({__NG_ELEMENT_ID__:di});let yl=0;function _s(e){return Xa(()=>{const n=!0===e.standalone,r={},o={type:e.type,providersResolver:null,decls:e.decls,vars:e.vars,factory:null,template:e.template||null,consts:e.consts||null,ngContentSelectors:e.ngContentSelectors,hostBindings:e.hostBindings||null,hostVars:e.hostVars||0,hostAttrs:e.hostAttrs||null,contentQueries:e.contentQueries||null,declaredInputs:r,inputs:null,outputs:null,exportAs:e.exportAs||null,onPush:e.changeDetection===Mo.OnPush,directiveDefs:null,pipeDefs:null,standalone:n,dependencies:n&&e.dependencies||null,getStandaloneInjector:null,selectors:e.selectors||Hr,viewQuery:e.viewQuery||null,features:e.features||null,data:e.data||{},encapsulation:e.encapsulation||oa.Emulated,id:"c"+yl++,styles:e.styles||Hr,_:null,setInput:null,schemas:e.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},c=e.dependencies,d=e.features;return o.inputs=fu(e.inputs,r),o.outputs=fu(e.outputs),d&&d.forEach(_=>_(o)),o.directiveDefs=c?()=>("function"==typeof c?c():c).map(pa).filter(Ta):null,o.pipeDefs=c?()=>("function"==typeof c?c():c).map(hs).filter(Ta):null,o})}function pa(e){return xi(e)||mi(e)}function Ta(e){return null!==e}function Ls(e){return Xa(()=>({type:e.type,bootstrap:e.bootstrap||Hr,declarations:e.declarations||Hr,imports:e.imports||Hr,exports:e.exports||Hr,transitiveCompileScopes:null,schemas:e.schemas||null,id:e.id||null}))}function fu(e,t){if(null==e)return $r;const n={};for(const r in e)if(e.hasOwnProperty(r)){let o=e[r],c=o;Array.isArray(o)&&(c=o[1],o=o[0]),n[o]=r,t&&(t[o]=c)}return n}const vi=_s;function xi(e){return e[Fu]||null}function mi(e){return e[Ia]||null}function hs(e){return e[Zs]||null}function Za(e,t){const n=e[ys]||null;if(!n&&!0===t)throw new Error(`Type ${qn(e)} does not have '\u0275mod' property.`);return n}function vs(e){return Array.isArray(e)&&"object"==typeof e[1]}function vo(e){return Array.isArray(e)&&!0===e[1]}function Uc(e){return 0!=(4&e.flags)}function Ts(e){return e.componentOffset>-1}function fs(e){return 1==(1&e.flags)}function ss(e){return null!==e.template}function el(e){return 0!=(256&e[2])}function Gu(e,t){return e.hasOwnProperty(zu)?e[zu]:null}class Ks{constructor(t,n,r){this.previousValue=t,this.currentValue=n,this.firstChange=r}isFirstChange(){return this.firstChange}}function Cs(){return wl}function wl(e){return e.type.prototype.ngOnChanges&&(e.setInput=qh),ud}function ud(){const e=Zl(this),t=e?.current;if(t){const n=e.previous;if(n===$r)e.previous=t;else for(let r in t)n[r]=t[r];e.current=null,this.ngOnChanges(t)}}function qh(e,t,n,r){const o=this.declaredInputs[n],c=Zl(e)||function bl(e,t){return e[Ka]=t}(e,{previous:$r,current:null}),d=c.current||(c.current={}),_=c.previous,E=_[o];d[o]=new Ks(E&&E.currentValue,t,_===$r),e[r]=t}Cs.ngInherit=!0;const Ka="__ngSimpleChanges__";function Zl(e){return e[Ka]||null}function us(e){for(;Array.isArray(e);)e=e[0];return e}function Js(e,t){return us(t[e.index])}function zs(e,t){return e.data[t]}function Po(e,t){const n=t[e];return vs(n)?n:n[0]}function Bs(e){return 64==(64&e[2])}function u(e,t){return null==t?null:e[t]}function h(e){e[18]=0}function y(e,t){e[5]+=t;let n=e,r=e[3];for(;null!==r&&(1===t&&1===n[5]||-1===t&&0===n[5]);)r[5]+=t,n=r,r=r[3]}const x={lFrame:b(null),bindingsEnabled:!0};function et(){return x.bindingsEnabled}function gt(){return x.lFrame.lView}function nn(){return x.lFrame.tView}function Un(e){return x.lFrame.contextLView=e,e[8]}function Qn(e){return x.lFrame.contextLView=null,e}function Sr(){let e=Bo();for(;null!==e&&64===e.type;)e=e.parent;return e}function Bo(){return x.lFrame.currentTNode}function Ss(e,t){const n=x.lFrame;n.currentTNode=e,n.isParent=t}function Va(){return x.lFrame.isParent}function dh(){return x.lFrame.bindingIndex++}function Hp(e,t){const n=x.lFrame;n.bindingIndex=n.bindingRootIndex=e,cd(t)}function cd(e){x.lFrame.currentDirectiveIndex=e}function ep(){return x.lFrame.currentQueryIndex}function Hh(e){x.lFrame.currentQueryIndex=e}function Af(e){const t=e[1];return 2===t.type?t.declTNode:1===t.type?e[6]:null}function v(e,t,n){if(n&wr.SkipSelf){let o=t,c=e;for(;!(o=o.parent,null!==o||n&wr.Host||(o=Af(c),null===o||(c=c[15],10&o.type))););if(null===o)return!1;t=o,e=c}const r=x.lFrame=g();return r.currentTNode=t,r.lView=e,!0}function l(e){const t=g(),n=e[1];x.lFrame=t,t.currentTNode=n.firstChild,t.lView=e,t.tView=n,t.contextLView=e,t.bindingIndex=n.bindingStartIndex,t.inI18n=!1}function g(){const e=x.lFrame,t=null===e?null:e.child;return null===t?b(e):t}function b(e){const t={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:e,child:null,inI18n:!1};return null!==e&&(e.child=t),t}function I(){const e=x.lFrame;return x.lFrame=e.parent,e.currentTNode=null,e.lView=null,e}const M=I;function O(){const e=I();e.isParent=!0,e.tView=null,e.selectedIndex=-1,e.contextLView=null,e.elementDepthCount=0,e.currentDirectiveIndex=-1,e.currentNamespace=null,e.bindingRootIndex=-1,e.bindingIndex=-1,e.currentQueryIndex=0}function $(){return x.lFrame.selectedIndex}function q(e){x.lFrame.selectedIndex=e}function Ne(e,t){for(let n=t.directiveStart,r=t.directiveEnd;n<r;n++){const c=e.data[n].type.prototype,{ngAfterContentInit:d,ngAfterContentChecked:_,ngAfterViewInit:E,ngAfterViewChecked:C,ngOnDestroy:A}=c;d&&(e.contentHooks||(e.contentHooks=[])).push(-n,d),_&&((e.contentHooks||(e.contentHooks=[])).push(n,_),(e.contentCheckHooks||(e.contentCheckHooks=[])).push(n,_)),E&&(e.viewHooks||(e.viewHooks=[])).push(-n,E),C&&((e.viewHooks||(e.viewHooks=[])).push(n,C),(e.viewCheckHooks||(e.viewCheckHooks=[])).push(n,C)),null!=A&&(e.destroyHooks||(e.destroyHooks=[])).push(n,A)}}function Se(e,t,n){Ge(e,t,3,n)}function Ye(e,t,n,r){(3&e[2])===n&&Ge(e,t,n,r)}function Qe(e,t){let n=e[2];(3&n)===t&&(n&=2047,n+=1,e[2]=n)}function Ge(e,t,n,r){const c=r??-1,d=t.length-1;let _=0;for(let E=void 0!==r?65535&e[18]:0;E<d;E++)if("number"==typeof t[E+1]){if(_=t[E],null!=r&&_>=r)break}else t[E]<0&&(e[18]+=65536),(_<c||-1==c)&&(it(e,n,t,E),e[18]=(4294901760&e[18])+E+2),E++}function it(e,t,n,r){const o=n[r]<0,c=n[r+1],_=e[o?-n[r]:n[r]];if(o){if(e[2]>>11<e[18]>>16&&(3&e[2])===t){e[2]+=2048;try{c.call(_)}finally{}}}else try{c.call(_)}finally{}}class zt{constructor(t,n,r){this.factory=t,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=r}}function _n(e,t,n){let r=0;for(;r<n.length;){const o=n[r];if("number"==typeof o){if(0!==o)break;r++;const c=n[r++],d=n[r++],_=n[r++];e.setAttribute(t,d,_,c)}else{const c=o,d=n[++r];wn(c)?e.setProperty(t,c,d):e.setAttribute(t,c,d),r++}}return r}function Cn(e){return 3===e||4===e||6===e}function wn(e){return 64===e.charCodeAt(0)}function Vn(e,t){if(null!==t&&0!==t.length)if(null===e||0===e.length)e=t.slice();else{let n=-1;for(let r=0;r<t.length;r++){const o=t[r];"number"==typeof o?n=o:0===n||mr(e,n,o,null,-1===n||2===n?t[++r]:null)}}return e}function mr(e,t,n,r,o){let c=0,d=e.length;if(-1===t)d=-1;else for(;c<e.length;){const _=e[c++];if("number"==typeof _){if(_===t){d=-1;break}if(_>t){d=c-1;break}}}for(;c<e.length;){const _=e[c];if("number"==typeof _)break;if(_===n){if(null===r)return void(null!==o&&(e[c+1]=o));if(r===e[c+1])return void(e[c+2]=o)}c++,null!==r&&c++,null!==o&&c++}-1!==d&&(e.splice(d,0,t),c=d+1),e.splice(c++,0,n),null!==r&&e.splice(c++,0,r),null!==o&&e.splice(c++,0,o)}function ir(e){return-1!==e}function Xn(e){return 32767&e}function xr(e,t){let n=function bn(e){return e>>16}(e),r=t;for(;n>0;)r=r[15],n--;return r}let Fr=!0;function ao(e){const t=Fr;return Fr=e,t}let gu=0;const ya={};function Yo(e,t){const n=Us(e,t);if(-1!==n)return n;const r=t[1];r.firstCreatePass&&(e.injectorIndex=t.length,Ii(r.data,e),Ii(t,null),Ii(r.blueprint,null));const o=Ma(e,t),c=e.injectorIndex;if(ir(o)){const d=Xn(o),_=xr(o,t),E=_[1].data;for(let C=0;C<8;C++)t[c+C]=_[d+C]|E[d+C]}return t[c+8]=o,c}function Ii(e,t){e.push(0,0,0,0,0,0,0,0,t)}function Us(e,t){return-1===e.injectorIndex||e.parent&&e.parent.injectorIndex===e.injectorIndex||null===t[e.injectorIndex+8]?-1:e.injectorIndex}function Ma(e,t){if(e.parent&&-1!==e.parent.injectorIndex)return e.parent.injectorIndex;let n=0,r=null,o=t;for(;null!==o;){if(r=Nm(o),null===r)return-1;if(n++,o=o[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return-1}function So(e,t,n){!function Wo(e,t,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty(mc)&&(r=n[mc]),null==r&&(r=n[mc]=gu++);const o=255&r;t.data[e+(o>>5)]|=1<<o}(e,t,n)}function jc(e,t,n){if(n&wr.Optional||void 0!==e)return e;mn()}function rl(e,t,n,r){if(n&wr.Optional&&void 0===r&&(r=null),0==(n&(wr.Self|wr.Host))){const o=e[9],c=Sa(void 0);try{return o?o.get(t,r,n&wr.Optional):Xs(t,r,n&wr.Optional)}finally{Sa(c)}}return jc(r,0,n)}function Qa(e,t,n,r=wr.Default,o){if(null!==e){if(1024&t[2]){const d=function Om(e,t,n,r,o){let c=e,d=t;for(;null!==c&&null!==d&&1024&d[2]&&!(256&d[2]);){const _=ph(c,d,n,r|wr.Self,ya);if(_!==ya)return _;let E=c.parent;if(!E){const C=d[21];if(C){const A=C.get(n,ya,r);if(A!==ya)return A}E=Nm(d),d=d[15]}c=E}return o}(e,t,n,r,ya);if(d!==ya)return d}const c=ph(e,t,n,r,ya);if(c!==ya)return c}return rl(t,n,r,o)}function ph(e,t,n,r,o){const c=function $c(e){if("string"==typeof e)return e.charCodeAt(0)||0;const t=e.hasOwnProperty(mc)?e[mc]:void 0;return"number"==typeof t?t>=0?255&t:v0:t}(n);if("function"==typeof c){if(!v(t,e,r))return r&wr.Host?jc(o,0,r):rl(t,n,r,o);try{const d=c(r);if(null!=d||r&wr.Optional)return d;mn()}finally{M()}}else if("number"==typeof c){let d=null,_=Us(e,t),E=-1,C=r&wr.Host?t[16][6]:null;for((-1===_||r&wr.SkipSelf)&&(E=-1===_?Ma(e,t):t[_+8],-1!==E&&hd(r,!1)?(d=t[1],_=Xn(E),t=xr(E,t)):_=-1);-1!==_;){const A=t[1];if(il(c,_,A.data)){const R=Gc(_,t,n,d,r,C);if(R!==ya)return R}E=t[_+8],-1!==E&&hd(r,t[1].data[_+8]===C)&&il(c,_,t)?(d=A,_=Xn(E),t=xr(E,t)):_=-1}}return o}function Gc(e,t,n,r,o,c){const d=t[1],_=d.data[e+8],A=ua(_,d,n,null==r?Ts(_)&&Fr:r!=d&&0!=(3&_.type),o&wr.Host&&c===_);return null!==A?eu(t,d,A,_):ya}function ua(e,t,n,r,o){const c=e.providerIndexes,d=t.data,_=1048575&c,E=e.directiveStart,A=c>>20,N=o?_+A:e.directiveEnd;for(let z=r?_:_+A;z<N;z++){const Q=d[z];if(z<E&&n===Q||z>=E&&Q.type===n)return z}if(o){const z=d[E];if(z&&ss(z)&&z.type===n)return E}return null}function eu(e,t,n,r){let o=e[n];const c=t.data;if(function Pt(e){return e instanceof zt}(o)){const d=o;d.resolving&&function gs(e,t){const n=t?`. Dependency path: ${t.join(" > ")} > ${e}`:"";throw new xn(-200,`Circular dependency in DI detected for ${e}${n}`)}(function Kr(e){return"function"==typeof e?e.name||e.toString():"object"==typeof e&&null!=e&&"function"==typeof e.type?e.type.name||e.type.toString():gr(e)}(c[n]));const _=ao(d.canSeeViewProviders);d.resolving=!0;const E=d.injectImpl?Sa(d.injectImpl):null;v(e,r,wr.Default);try{o=e[n]=d.factory(void 0,c,e,r),t.firstCreatePass&&n>=r.directiveStart&&function xe(e,t,n){const{ngOnChanges:r,ngOnInit:o,ngDoCheck:c}=t.type.prototype;if(r){const d=wl(t);(n.preOrderHooks||(n.preOrderHooks=[])).push(e,d),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,d)}o&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-e,o),c&&((n.preOrderHooks||(n.preOrderHooks=[])).push(e,c),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(e,c))}(n,c[n],t)}finally{null!==E&&Sa(E),ao(_),d.resolving=!1,M()}}return o}function il(e,t,n){return!!(n[t+(e>>5)]&1<<e)}function hd(e,t){return!(e&wr.Self||e&wr.Host&&t)}class gh{constructor(t,n){this._tNode=t,this._lView=n}get(t,n,r){return Qa(this._tNode,this._lView,t,ku(r),n)}}function v0(){return new gh(Sr(),gt())}function Zp(e){return gl(e)?()=>{const t=Zp(Qt(e));return t&&t()}:Gu(e)}function Nm(e){const t=e[1],n=t.type;return 2===n?t.declTNode:1===n?e[6]:null}const Rf="__parameters__";function Of(e,t,n){return Xa(()=>{const r=function Wp(e){return function(...n){if(e){const r=e(...n);for(const o in r)this[o]=r[o]}}}(t);function o(...c){if(this instanceof o)return r.apply(this,c),this;const d=new o(...c);return _.annotation=d,_;function _(E,C,A){const R=E.hasOwnProperty(Rf)?E[Rf]:Object.defineProperty(E,Rf,{value:[]})[Rf];for(;R.length<=A;)R.push(null);return(R[A]=R[A]||[]).push(d),E}}return n&&(o.prototype=Object.create(n.prototype)),o.prototype.ngMetadataName=e,o.annotationCls=o,o})}class Xr{constructor(t,n){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=kn({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function Xh(e,t){e.forEach(n=>Array.isArray(n)?Xh(n,t):t(n))}function w0(e,t,n){t>=e.length?e.push(n):e.splice(t,0,n)}function Kp(e,t){return t>=e.length-1?e.pop():e.splice(t,1)[0]}const cr=hu(Of("Optional"),8),Wh=hu(Of("SkipSelf"),4);var ol=(()=>((ol=ol||{})[ol.Important=1]="Important",ol[ol.DashCase=2]="DashCase",ol))();const ec=new Map;let Wm=0;const up="__ngContext__";function mu(e,t){vs(t)?(e[up]=t[20],function ap(e){ec.set(e[20],e)}(t)):e[up]=t}function js(e,t){return undefined(e,t)}function vh(e){const t=e[3];return vo(t)?t[3]:t}function Qm(e){return ey(e[13])}function og(e){return ey(e[4])}function ey(e){for(;null!==e&&!vo(e);)e=e[4];return e}function nc(e,t,n,r,o){if(null!=r){let c,d=!1;vo(r)?c=r:vs(r)&&(d=!0,r=r[0]);const _=us(r);0===e&&null!==n?null==o?Xu(t,n,_):Hu(t,n,_,o||null,!0):1===e&&null!==n?Hu(t,n,_,o||null,!0):2===e?function cy(e,t,n){const r=cg(e,t);r&&function ay(e,t,n,r){e.removeChild(t,n,r)}(e,r,t,n)}(t,_,d):3===e&&t.destroyNode(_),null!=c&&function Ed(e,t,n,r,o){const c=n[7];c!==us(n)&&nc(t,e,r,c,o);for(let _=10;_<n.length;_++){const E=n[_];fp(E[1],E,e,t,r,c)}}(t,e,c,n,o)}}function ag(e,t,n){return e.createElement(t,n)}function N0(e,t){const n=e[9],r=n.indexOf(t),o=t[3];512&t[2]&&(t[2]&=-513,y(o,-1)),n.splice(r,1)}function ug(e,t){if(e.length<=10)return;const n=10+t,r=e[n];if(r){const o=r[17];null!==o&&o!==e&&N0(o,r),t>0&&(e[n-1][4]=r[4]);const c=Kp(e,10+t);!function ew(e,t){fp(e,t,t[11],2,null,null),t[0]=null,t[6]=null}(r[1],r);const d=c[19];null!==d&&d.detachView(c[1]),r[3]=null,r[4]=null,r[2]&=-65}return r}function k0(e,t){if(!(128&t[2])){const n=t[11];n.destroyNode&&fp(e,t,n,3,null,null),function iy(e){let t=e[13];if(!t)return oy(e[1],e);for(;t;){let n=null;if(vs(t))n=t[13];else{const r=t[10];r&&(n=r)}if(!n){for(;t&&!t[4]&&t!==e;)vs(t)&&oy(t[1],t),t=t[3];null===t&&(t=e),vs(t)&&oy(t[1],t),n=t&&t[4]}t=n}}(t)}}function oy(e,t){if(!(128&t[2])){t[2]&=-65,t[2]|=128,function z0(e,t){let n;if(null!=e&&null!=(n=e.destroyHooks))for(let r=0;r<n.length;r+=2){const o=t[n[r]];if(!(o instanceof zt)){const c=n[r+1];if(Array.isArray(c))for(let d=0;d<c.length;d+=2){const _=o[c[d]],E=c[d+1];try{E.call(_)}finally{}}else try{c.call(o)}finally{}}}}(e,t),function F0(e,t){const n=e.cleanup,r=t[7];let o=-1;if(null!==n)for(let c=0;c<n.length-1;c+=2)if("string"==typeof n[c]){const d=n[c+3];d>=0?r[o=d]():r[o=-d].unsubscribe(),c+=2}else{const d=r[o=n[c+1]];n[c].call(d)}if(null!==r){for(let c=o+1;c<r.length;c++)(0,r[c])();t[7]=null}}(e,t),1===t[1].type&&t[11].destroy();const n=t[17];if(null!==n&&vo(t[3])){n!==t[3]&&N0(n,t);const r=t[19];null!==r&&r.detachView(e)}!function Ym(e){ec.delete(e[20])}(t)}}function sy(e,t,n){return function lg(e,t,n){let r=t;for(;null!==r&&40&r.type;)r=(t=r).parent;if(null===r)return n[0];{const{componentOffset:o}=r;if(o>-1){const{encapsulation:c}=e.data[r.directiveStart+o];if(c===oa.None||c===oa.Emulated)return null}return Js(r,n)}}(e,t.parent,n)}function Hu(e,t,n,r,o){e.insertBefore(t,n,r,o)}function Xu(e,t,n){e.appendChild(t,n)}function B0(e,t,n,r,o){null!==r?Hu(e,t,n,r,o):Xu(e,t,n)}function cg(e,t){return e.parentNode(t)}let pp,uy=function hp(e,t,n){return 40&e.type?Js(e,n):null};function hg(e,t,n,r){const o=sy(e,r,t),c=t[11],_=function wd(e,t,n){return uy(e,t,n)}(r.parent||t[6],r,t);if(null!=o)if(Array.isArray(n))for(let E=0;E<n.length;E++)B0(c,o,n[E],_,!1);else B0(c,o,n,_,!1)}function fg(e,t){if(null!==t){const n=t.type;if(3&n)return Js(t,e);if(4&n)return ly(-1,e[t.index]);if(8&n){const r=t.child;if(null!==r)return fg(e,r);{const o=e[t.index];return vo(o)?ly(-1,o):us(o)}}if(32&n)return js(t,e)()||us(e[t.index]);{const r=U0(e,t);return null!==r?Array.isArray(r)?r[0]:fg(vh(e[16]),r):fg(e,t.next)}}return null}function U0(e,t){return null!==t?e[16][6].projection[t.projection]:null}function ly(e,t){const n=10+e+1;if(n<t.length){const r=t[n],o=r[1].firstChild;if(null!==o)return fg(r,o)}return t[7]}function hy(e,t,n,r,o,c,d){for(;null!=n;){const _=r[n.index],E=n.type;if(d&&0===t&&(_&&mu(us(_),r),n.flags|=2),32!=(32&n.flags))if(8&E)hy(e,t,n.child,r,o,c,!1),nc(t,e,o,_,c);else if(32&E){const C=js(n,r);let A;for(;A=C();)nc(t,e,o,A,c);nc(t,e,o,_,c)}else 16&E?V0(e,t,r,n,o,c):nc(t,e,o,_,c);n=d?n.projectionNext:n.next}}function fp(e,t,n,r,o,c){hy(n,r,e.firstChild,t,o,c,!1)}function V0(e,t,n,r,o,c){const d=n[16],E=d[6].projection[r.projection];if(Array.isArray(E))for(let C=0;C<E.length;C++)nc(t,e,o,E[C],c);else hy(e,t,E,d[3],o,c,!0)}function dp(e,t,n){""===n?e.removeAttribute(t,"class"):e.setAttribute(t,"class",n)}function dy(e,t,n){const{mergedAttrs:r,classes:o,styles:c}=n;null!==r&&_n(e,t,r),null!==o&&dp(e,t,o),null!==c&&function ta(e,t,n){e.setAttribute(t,"style",n)}(e,t,c)}const Eg=new Xr("ENVIRONMENT_INITIALIZER"),xy=new Xr("INJECTOR",-1),wy=new Xr("INJECTOR_DEF_TYPES");class by{get(t,n=mo){if(n===mo){const r=new Error(`NullInjectorError: No provider for ${qn(t)}!`);throw r.name="NullInjectorError",r}return n}}function mw(...e){return{\u0275providers:ov(0,e),\u0275fromNgModule:!0}}function ov(e,...t){const n=[],r=new Set;let o;return Xh(t,c=>{const d=c;Ey(d,n,[],r)&&(o||(o=[]),o.push(d))}),void 0!==o&&sv(o,n),n}function sv(e,t){for(let n=0;n<e.length;n++){const{providers:o}=e[n];Cy(o,c=>{t.push(c)})}}function Ey(e,t,n,r){if(!(e=Qt(e)))return!1;let o=null,c=ml(e);const d=!c&&xi(e);if(c||d){if(d&&!d.standalone)return!1;o=e}else{const E=e.ngModule;if(c=ml(E),!c)return!1;o=E}const _=r.has(o);if(d){if(_)return!1;if(r.add(o),d.dependencies){const E="function"==typeof d.dependencies?d.dependencies():d.dependencies;for(const C of E)Ey(C,t,n,r)}}else{if(!c)return!1;{if(null!=c.imports&&!_){let C;r.add(o);try{Xh(c.imports,A=>{Ey(A,t,n,r)&&(C||(C=[]),C.push(A))})}finally{}void 0!==C&&sv(C,t)}if(!_){const C=Gu(o)||(()=>new o);t.push({provide:o,useFactory:C,deps:Hr},{provide:wy,useValue:o,multi:!0},{provide:Eg,useValue:()=>Pn(o),multi:!0})}const E=c.providers;null==E||_||Cy(E,A=>{t.push(A)})}}return o!==e&&void 0!==e.providers}function Cy(e,t){for(let n of e)Hs(n)&&(n=n.\u0275providers),Array.isArray(n)?Cy(n,t):t(n)}const tu=di({provide:String,useValue:di});function rc(e){return null!==e&&"object"==typeof e&&tu in e}function ic(e){return"function"==typeof e}const Sy=new Xr("Set Injector scope."),nf={},vw={};let Iy;function rf(){return void 0===Iy&&(Iy=new by),Iy}class Zc{}class Ty extends Zc{constructor(t,n,r,o){super(),this.parent=n,this.source=r,this.scopes=o,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Ay(t,d=>this.processProvider(d)),this.records.set(xy,al(void 0,this)),o.has("environment")&&this.records.set(Zc,al(void 0,this));const c=this.records.get(Sy);null!=c&&"string"==typeof c.value&&this.scopes.add(c.value),this.injectorDefTypes=new Set(this.get(wy.multi,Hr,wr.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const t of this._ngOnDestroyHooks)t.ngOnDestroy();for(const t of this._onDestroyHooks)t()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(t){this._onDestroyHooks.push(t)}runInContext(t){this.assertNotDestroyed();const n=Nu(this),r=Sa(void 0);try{return t()}finally{Nu(n),Sa(r)}}get(t,n=mo,r=wr.Default){this.assertNotDestroyed(),r=ku(r);const o=Nu(this),c=Sa(void 0);try{if(!(r&wr.SkipSelf)){let _=this.records.get(t);if(void 0===_){const E=function xw(e){return"function"==typeof e||"object"==typeof e&&e instanceof Xr}(t)&&Ca(t);_=E&&this.injectableDefInScope(E)?al(Io(t),nf):null,this.records.set(t,_)}if(null!=_)return this.hydrate(t,_)}return(r&wr.Self?rf():this.parent).get(t,n=r&wr.Optional&&n===mo?null:n)}catch(d){if("NullInjectorError"===d.name){if((d[Gl]=d[Gl]||[]).unshift(qn(t)),o)throw d;return function ni(e,t,n,r){const o=e[Gl];throw t[cu]&&o.unshift(t[cu]),e.message=function Si(e,t,n,r=null){e=e&&"\n"===e.charAt(0)&&"\u0275"==e.charAt(1)?e.slice(2):e;let o=qn(t);if(Array.isArray(t))o=t.map(qn).join(" -> ");else if("object"==typeof t){let c=[];for(let d in t)if(t.hasOwnProperty(d)){let _=t[d];c.push(d+":"+("string"==typeof _?JSON.stringify(_):qn(_)))}o=`{${c.join(", ")}}`}return`${n}${r?"("+r+")":""}[${o}]: ${e.replace(ns,"\n  ")}`}("\n"+e.message,o,n,r),e.ngTokenPath=o,e[Gl]=null,e}(d,t,"R3InjectorError",this.source)}throw d}finally{Sa(c),Nu(o)}}resolveInjectorInitializers(){const t=Nu(this),n=Sa(void 0);try{const r=this.get(Eg.multi,Hr,wr.Self);for(const o of r)o()}finally{Nu(t),Sa(n)}}toString(){const t=[],n=this.records;for(const r of n.keys())t.push(qn(r));return`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new xn(205,!1)}processProvider(t){let n=ic(t=Qt(t))?t:Qt(t&&t.provide);const r=function av(e){return rc(e)?al(void 0,e.useValue):al(function My(e,t,n){let r;if(ic(e)){const o=Qt(e);return Gu(o)||Io(o)}if(rc(e))r=()=>Qt(e.useValue);else if(function vp(e){return!(!e||!e.useFactory)}(e))r=()=>e.useFactory(...Is(e.deps||[]));else if(function Cg(e){return!(!e||!e.useExisting)}(e))r=()=>Pn(Qt(e.useExisting));else{const o=Qt(e&&(e.useClass||e.provide));if(!function Dd(e){return!!e.deps}(e))return Gu(o)||Io(o);r=()=>new o(...Is(e.deps))}return r}(e),nf)}(t);if(ic(t)||!0!==t.multi)this.records.get(n);else{let o=this.records.get(n);o||(o=al(void 0,nf,!0),o.factory=()=>Is(o.multi),this.records.set(n,o)),n=t,o.multi.push(t)}this.records.set(n,r)}hydrate(t,n){return n.value===nf&&(n.value=vw,n.value=n.factory()),"object"==typeof n.value&&n.value&&function uv(e){return null!==e&&"object"==typeof e&&"function"==typeof e.ngOnDestroy}(n.value)&&this._ngOnDestroyHooks.add(n.value),n.value}injectableDefInScope(t){if(!t.providedIn)return!1;const n=Qt(t.providedIn);return"string"==typeof n?"any"===n||this.scopes.has(n):this.injectorDefTypes.has(n)}}function Io(e){const t=Ca(e),n=null!==t?t.factory:Gu(e);if(null!==n)return n;if(e instanceof Xr)throw new xn(204,!1);if(e instanceof Function)return function Dy(e){const t=e.length;if(t>0)throw function ip(e,t){const n=[];for(let r=0;r<e;r++)n.push(t);return n}(t,"?"),new xn(204,!1);const n=function dc(e){const t=e&&(e[$o]||e[Eo]);if(t){const n=function cs(e){if(e.hasOwnProperty("name"))return e.name;const t=(""+e).match(/^function\s*([^\s(]+)/);return null===t?"":t[1]}(e);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),t}return null}(e);return null!==n?()=>n.factory(e):()=>new e}(e);throw new xn(204,!1)}function al(e,t,n=!1){return{factory:e,value:t,multi:n?[]:void 0}}function Ay(e,t){for(const n of e)Array.isArray(n)?Ay(n,t):n&&Hs(n)?Ay(n.\u0275providers,t):t(n)}class ww{}class lv{}class Ew{resolveComponentFactory(t){throw function bw(e){const t=Error(`No component factory found for ${qn(e)}. Did you add it to @NgModule.entryComponents?`);return t.ngComponent=e,t}(t)}}let xp=(()=>{class e{}return e.NULL=new Ew,e})();function Sg(){return Ic(Sr(),gt())}function Ic(e,t){return new wh(Js(e,t))}let wh=(()=>{class e{constructor(n){this.nativeElement=n}}return e.__NG_ELEMENT_ID__=Sg,e})();function Cw(e){return e instanceof wh?e.nativeElement:e}class hv{}let Ry=(()=>{class e{}return e.\u0275prov=kn({token:e,providedIn:"root",factory:()=>null}),e})();class wp{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Al=new wp("15.0.4"),Vf={};function Md(e){return e.ngOriginalError}class Ad{constructor(){this._console=console}handleError(t){const n=this._findOriginalError(t);this._console.error("ERROR",t),n&&this._console.error("ORIGINAL ERROR",n)}_findOriginalError(t){let n=t&&Md(t);for(;n&&Md(n);)n=Md(n);return n||null}}function Oy(e){return e.ownerDocument.defaultView}function Wc(e){return e instanceof Function?e():e}function yv(e,t,n){let r=e.length;for(;;){const o=e.indexOf(t,n);if(-1===o)return o;if(0===o||e.charCodeAt(o-1)<=32){const c=t.length;if(o+c===r||e.charCodeAt(o+c)<=32)return o}n=o+1}}const Fy="ng-template";function _v(e,t,n){let r=0;for(;r<e.length;){let o=e[r++];if(n&&"class"===o){if(o=e[r],-1!==yv(o.toLowerCase(),t,0))return!0}else if(1===o){for(;r<e.length&&"string"==typeof(o=e[r++]);)if(o.toLowerCase()===t)return!0;return!1}}return!1}function Rd(e){return 4===e.type&&e.value!==Fy}function vv(e,t,n){return t===(4!==e.type||n?e.value:Fy)}function xv(e,t,n){let r=4;const o=e.attrs||[],c=function wv(e){for(let t=0;t<e.length;t++)if(Cn(e[t]))return t;return e.length}(o);let d=!1;for(let _=0;_<t.length;_++){const E=t[_];if("number"!=typeof E){if(!d)if(4&r){if(r=2|1&r,""!==E&&!vv(e,E,n)||""===E&&1===t.length){if(Pl(r))return!1;d=!0}}else{const C=8&r?E:t[++_];if(8&r&&null!==e.attrs){if(!_v(e.attrs,C,n)){if(Pl(r))return!1;d=!0}continue}const R=Ld(8&r?"class":E,o,Rd(e),n);if(-1===R){if(Pl(r))return!1;d=!0;continue}if(""!==C){let N;N=R>c?"":o[R+1].toLowerCase();const z=8&r?N:null;if(z&&-1!==yv(z,C,0)||2&r&&C!==N){if(Pl(r))return!1;d=!0}}}}else{if(!d&&!Pl(r)&&!Pl(E))return!1;if(d&&Pl(E))continue;d=!1,r=E|1&r}}return Pl(r)||d}function Pl(e){return 0==(1&e)}function Ld(e,t,n,r){if(null===t)return-1;let o=0;if(r||!n){let c=!1;for(;o<t.length;){const d=t[o];if(d===e)return o;if(3===d||6===d)c=!0;else{if(1===d||2===d){let _=t[++o];for(;"string"==typeof _;)_=t[++o];continue}if(4===d)break;if(0===d){o+=4;continue}}o+=c?1:2}return-1}return function Dg(e,t){let n=e.indexOf(4);if(n>-1)for(n++;n<e.length;){const r=e[n];if("number"==typeof r)return-1;if(r===t)return n;n++}return-1}(t,e)}function zy(e,t,n=!1){for(let r=0;r<t.length;r++)if(xv(e,t[r],n))return!0;return!1}function bv(e,t){return e?":not("+t.trim()+")":t}function Dw(e){let t=e[0],n=1,r=2,o="",c=!1;for(;n<e.length;){let d=e[n];if("string"==typeof d)if(2&r){const _=e[++n];o+="["+d+(_.length>0?'="'+_+'"':"")+"]"}else 8&r?o+="."+d:4&r&&(o+=" "+d);else""!==o&&!Pl(d)&&(t+=bv(c,o),o=""),r=d,c=c||!Pl(r);n++}return""!==o&&(t+=bv(c,o)),t}const si={};function Tc(e){Ag(nn(),gt(),$()+e,!1)}function Ag(e,t,n,r){if(!r)if(3==(3&t[2])){const c=e.preOrderCheckHooks;null!==c&&Se(t,c,n)}else{const c=e.preOrderHooks;null!==c&&Ye(t,c,0,n)}q(n)}function Rg(e,t=null,n=null,r){const o=Tv(e,t,n,r);return o.resolveInjectorInitializers(),o}function Tv(e,t=null,n=null,r,o=new Set){const c=[n||Hr,mw(e)];return r=r||("object"==typeof e?void 0:qn(e)),new Ty(c,t||rf(),r||null,o)}let Yc=(()=>{class e{static create(n,r){if(Array.isArray(n))return Rg({name:""},r,n,"");{const o=n.name??"";return Rg({name:o},n.parent,n.providers,o)}}}return e.THROW_IF_NOT_FOUND=mo,e.NULL=new by,e.\u0275prov=kn({token:e,providedIn:"any",factory:()=>Pn(xy)}),e.__NG_ELEMENT_ID__=-1,e})();function zr(e,t=wr.Default){const n=gt();return null===n?Pn(e,t):Qa(Sr(),n,Qt(e),t)}function uf(e,t){const n=e.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const o=n[r],c=n[r+1];if(-1!==c){const d=e.data[c];Hh(o),d.contentQueries(2,t[c],c)}}}function kg(e,t,n,r,o,c,d,_,E,C,A){const R=t.blueprint.slice();return R[0]=o,R[2]=76|r,(null!==A||e&&1024&e[2])&&(R[2]|=1024),h(R),R[3]=R[15]=e,R[8]=n,R[10]=d||e&&e[10],R[11]=_||e&&e[11],R[12]=E||e&&e[12]||null,R[9]=C||e&&e[9]||null,R[6]=c,R[20]=function _d(){return Wm++}(),R[21]=A,R[16]=2==t.type?e[16]:R,R}function Jc(e,t,n,r,o){let c=e.data[t];if(null===c)c=function Gf(e,t,n,r,o){const c=Bo(),d=Va(),E=e.data[t]=function zw(e,t,n,r,o,c){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:t?t.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:o,attrs:c,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:t,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,d?c:c&&c.parent,n,t,r,o);return null===e.firstChild&&(e.firstChild=E),null!==c&&(d?null==c.child&&null!==E.parent&&(c.child=E):null===c.next&&(c.next=E)),E}(e,t,n,r,o),function Qd(){return x.lFrame.inI18n}()&&(c.flags|=32);else if(64&c.type){c.type=n,c.value=r,c.attrs=o;const d=function xs(){const e=x.lFrame,t=e.currentTNode;return e.isParent?t:t.parent}();c.injectorIndex=null===d?-1:d.injectorIndex}return Ss(c,!0),c}function Sh(e,t,n,r){if(0===n)return-1;const o=t.length;for(let c=0;c<n;c++)t.push(r),e.blueprint.push(r),e.data.push(null);return o}function $f(e,t,n){l(t);try{const r=e.viewQuery;null!==r&&Dp(1,r,n);const o=e.template;null!==o&&Nv(e,t,o,1,n),e.firstCreatePass&&(e.firstCreatePass=!1),e.staticContentQueries&&uf(e,t),e.staticViewQueries&&Dp(2,e.viewQuery,n);const c=e.components;null!==c&&function lf(e,t){for(let n=0;n<t.length;n++)th(e,t[n])}(t,c)}catch(r){throw e.firstCreatePass&&(e.incompleteFirstPass=!0,e.firstCreatePass=!1),r}finally{t[2]&=-5,O()}}function qf(e,t,n,r){const o=t[2];if(128!=(128&o)){l(t);try{h(t),function ld(e){return x.lFrame.bindingIndex=e}(e.bindingStartIndex),null!==n&&Nv(e,t,n,2,r);const d=3==(3&o);if(d){const C=e.preOrderCheckHooks;null!==C&&Se(t,C,null)}else{const C=e.preOrderHooks;null!==C&&Ye(t,C,0,null),Qe(t,0)}if(function sc(e){for(let t=Qm(e);null!==t;t=og(t)){if(!t[2])continue;const n=t[9];for(let r=0;r<n.length;r++){const o=n[r],c=o[3];0==(512&o[2])&&y(c,1),o[2]|=512}}}(t),function Gv(e){for(let t=Qm(e);null!==t;t=og(t))for(let n=10;n<t.length;n++){const r=t[n],o=r[1];Bs(r)&&qf(o,r,o.template,r[8])}}(t),null!==e.contentQueries&&uf(e,t),d){const C=e.contentCheckHooks;null!==C&&Se(t,C)}else{const C=e.contentHooks;null!==C&&Ye(t,C,1),Qe(t,1)}!function Ov(e,t){const n=e.hostBindingOpCodes;if(null!==n)try{for(let r=0;r<n.length;r++){const o=n[r];if(o<0)q(~o);else{const c=o,d=n[++r],_=n[++r];Hp(d,c),_(2,t[c])}}}finally{q(-1)}}(e,t);const _=e.components;null!==_&&function kw(e,t){for(let n=0;n<t.length;n++)Qc(e,t[n])}(t,_);const E=e.viewQuery;if(null!==E&&Dp(2,E,r),d){const C=e.viewCheckHooks;null!==C&&Se(t,C)}else{const C=e.viewHooks;null!==C&&Ye(t,C,2),Qe(t,2)}!0===e.firstUpdatePass&&(e.firstUpdatePass=!1),t[2]&=-41,512&t[2]&&(t[2]&=-513,y(t[3],-1))}finally{O()}}}function Nv(e,t,n,r,o){const c=$(),d=2&r;try{q(-1),d&&t.length>22&&Ag(e,t,22,!1),n(r,o)}finally{q(c)}}function $y(e,t,n){if(Uc(t)){const o=t.directiveEnd;for(let c=t.directiveStart;c<o;c++){const d=e.data[c];d.contentQueries&&d.contentQueries(1,n[c],c)}}}function cf(e,t,n){!et()||(function Uw(e,t,n,r){const o=n.directiveStart,c=n.directiveEnd;Ts(n)&&function $w(e,t,n){const r=Js(t,e),o=kv(n),c=e[10],d=Hf(e,kg(e,o,null,n.onPush?32:16,r,t,c,c.createRenderer(r,n),null,null,null));e[t.index]=d}(t,n,e.data[o+n.componentOffset]),e.firstCreatePass||Yo(n,t),mu(r,t);const d=n.initialInputs;for(let _=o;_<c;_++){const E=e.data[_],C=eu(t,e,_,n);mu(C,t),null!==d&&qw(0,_-o,C,E,0,d),ss(E)&&(Po(n.index,t)[8]=eu(t,e,_,n))}}(e,t,n,Js(n,t)),64==(64&n.flags)&&Ug(e,t,n))}function zd(e,t,n=Js){const r=t.localNames;if(null!==r){let o=t.index+1;for(let c=0;c<r.length;c+=2){const d=r[c+1],_=-1===d?n(t,e):e[d];e[o++]=_}}}function kv(e){const t=e.tView;return null===t||t.incompleteFirstPass?e.tView=Fg(1,null,e.template,e.decls,e.vars,e.directiveDefs,e.pipeDefs,e.viewQuery,e.schemas,e.consts):t}function Fg(e,t,n,r,o,c,d,_,E,C){const A=22+r,R=A+o,N=function Fv(e,t){const n=[];for(let r=0;r<t;r++)n.push(r<e?null:si);return n}(A,R),z="function"==typeof C?C():C;return N[1]={type:e,blueprint:N,template:n,queries:null,viewQuery:_,declTNode:t,data:N.slice().fill(null,A),bindingStartIndex:A,expandoStartIndex:R,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof c?c():c,pipeRegistry:"function"==typeof d?d():d,firstChild:null,schemas:E,consts:z,incompleteFirstPass:!1}}function qy(e,t,n,r){const o=Qy(t);null===n?o.push(r):(o.push(n),e.firstCreatePass&&e_(e).push(r,o.length-1))}function Hy(e,t,n,r){for(let o in e)if(e.hasOwnProperty(o)){n=null===n?{}:n;const c=e[o];null===r?zv(n,t,o,c):r.hasOwnProperty(o)&&zv(n,t,r[o],c)}return n}function zv(e,t,n,r){e.hasOwnProperty(n)?e[n].push(t,r):e[n]=[t,r]}function Ip(e,t){const n=Po(t,e);16&n[2]||(n[2]|=32)}function Zy(e,t,n,r){let o=!1;if(et()){const c=null===r?null:{"":-1},d=function Vg(e,t){const n=e.directiveRegistry;let r=null,o=null;if(n)for(let c=0;c<n.length;c++){const d=n[c];if(zy(t,d.selectors,!1))if(r||(r=[]),ss(d))if(null!==d.findHostDirectiveDefs){const _=[];o=o||new Map,d.findHostDirectiveDefs(d,_,o),r.unshift(..._,d),Yy(e,t,_.length)}else r.unshift(d),Yy(e,t,0);else o=o||new Map,d.findHostDirectiveDefs?.(d,r,o),r.push(d)}return null===r?null:[r,o]}(e,n);let _,E;null===d?_=E=null:[_,E]=d,null!==_&&(o=!0,Bg(e,t,n,_,c,E)),c&&function Vw(e,t,n){if(t){const r=e.localNames=[];for(let o=0;o<t.length;o+=2){const c=n[t[o+1]];if(null==c)throw new xn(-301,!1);r.push(t[o],c)}}}(n,r,c)}return n.mergedAttrs=Vn(n.mergedAttrs,n.attrs),o}function Bg(e,t,n,r,o,c){for(let C=0;C<r.length;C++)So(Yo(n,t),e,r[C].type);!function Gw(e,t,n){e.flags|=1,e.directiveStart=t,e.directiveEnd=t+n,e.providerIndexes=t}(n,e.data.length,r.length);for(let C=0;C<r.length;C++){const A=r[C];A.providersResolver&&A.providersResolver(A)}let d=!1,_=!1,E=Sh(e,t,r.length,null);for(let C=0;C<r.length;C++){const A=r[C];n.mergedAttrs=Vn(n.mergedAttrs,A.hostAttrs),Ky(e,n,t,E,A),jw(E,A,o),null!==A.contentQueries&&(n.flags|=4),(null!==A.hostBindings||null!==A.hostAttrs||0!==A.hostVars)&&(n.flags|=64);const R=A.type.prototype;!d&&(R.ngOnChanges||R.ngOnInit||R.ngDoCheck)&&((e.preOrderHooks||(e.preOrderHooks=[])).push(n.index),d=!0),!_&&(R.ngOnChanges||R.ngDoCheck)&&((e.preOrderCheckHooks||(e.preOrderCheckHooks=[])).push(n.index),_=!0),E++}!function Bv(e,t,n){const o=t.directiveEnd,c=e.data,d=t.attrs,_=[];let E=null,C=null;for(let A=t.directiveStart;A<o;A++){const R=c[A],N=n?n.get(R):null,Q=N?N.outputs:null;E=Hy(R.inputs,A,E,N?N.inputs:null),C=Hy(R.outputs,A,C,Q);const ee=null===E||null===d||Rd(t)?null:Vv(E,A,d);_.push(ee)}null!==E&&(E.hasOwnProperty("class")&&(t.flags|=8),E.hasOwnProperty("style")&&(t.flags|=16)),t.initialInputs=_,t.inputs=E,t.outputs=C}(e,n,c)}function Ug(e,t,n){const r=n.directiveStart,o=n.directiveEnd,c=n.index,d=function Xp(){return x.lFrame.currentDirectiveIndex}();try{q(c);for(let _=r;_<o;_++){const E=e.data[_],C=t[_];cd(_),(null!==E.hostBindings||0!==E.hostVars||null!==E.hostAttrs)&&Uv(E,C)}}finally{q(-1),cd(d)}}function Uv(e,t){null!==e.hostBindings&&e.hostBindings(1,t)}function Yy(e,t,n){t.componentOffset=n,(e.components||(e.components=[])).push(t.index)}function jw(e,t,n){if(n){if(t.exportAs)for(let r=0;r<t.exportAs.length;r++)n[t.exportAs[r]]=e;ss(t)&&(n[""]=e)}}function Ky(e,t,n,r,o){e.data[r]=o;const c=o.factory||(o.factory=Gu(o.type)),d=new zt(c,ss(o),zr);e.blueprint[r]=d,n[r]=d,function Wy(e,t,n,r,o){const c=o.hostBindings;if(c){let d=e.hostBindingOpCodes;null===d&&(d=e.hostBindingOpCodes=[]);const _=~t.index;(function hf(e){let t=e.length;for(;t>0;){const n=e[--t];if("number"==typeof n&&n<0)return n}return 0})(d)!=_&&d.push(_),d.push(n,r,c)}}(e,t,r,Sh(e,n,o.hostVars,si),o)}function qw(e,t,n,r,o,c){const d=c[t];if(null!==d){const _=r.setInput;for(let E=0;E<d.length;){const C=d[E++],A=d[E++],R=d[E++];null!==_?r.setInput(n,R,C,A):n[A]=R}}}function Vv(e,t,n){let r=null,o=0;for(;o<n.length;){const c=n[o];if(0!==c)if(5!==c){if("number"==typeof c)break;if(e.hasOwnProperty(c)){null===r&&(r=[]);const d=e[c];for(let _=0;_<d.length;_+=2)if(d[_]===t){r.push(c,d[_+1],n[o+1]);break}}o+=2}else o+=2;else o+=4}return r}function jv(e,t,n,r){return[e,!0,!1,t,null,0,r,n,null,null]}function Qc(e,t){const n=Po(t,e);if(Bs(n)){const r=n[1];48&n[2]?qf(r,n,r.template,n[8]):n[5]>0&&eh(n)}}function eh(e){for(let r=Qm(e);null!==r;r=og(r))for(let o=10;o<r.length;o++){const c=r[o];if(Bs(c))if(512&c[2]){const d=c[1];qf(d,c,d.template,c[8])}else c[5]>0&&eh(c)}const n=e[1].components;if(null!==n)for(let r=0;r<n.length;r++){const o=Po(n[r],e);Bs(o)&&o[5]>0&&eh(o)}}function th(e,t){const n=Po(t,e),r=n[1];(function ff(e,t){for(let n=t.length;n<e.blueprint.length;n++)t.push(e.blueprint[n])})(r,n),$f(r,n,n[8])}function Hf(e,t){return e[13]?e[14][4]=t:e[13]=t,e[14]=t,t}function jg(e){for(;e;){e[2]|=32;const t=vh(e);if(el(e)&&!t)return e;e=t}return null}function Tp(e,t,n,r=!0){const o=t[10];o.begin&&o.begin();try{qf(e,t,e.template,n)}catch(d){throw r&&n_(t,d),d}finally{o.end&&o.end()}}function Dp(e,t,n){Hh(0),t(e,n)}function Qy(e){return e[7]||(e[7]=[])}function e_(e){return e.cleanup||(e.cleanup=[])}function n_(e,t){const n=e[9],r=n?n.get(Ad,null):null;r&&r.handleError(t)}function Gg(e,t,n,r,o){for(let c=0;c<n.length;){const d=n[c++],_=n[c++],E=t[d],C=e.data[d];null!==C.setInput?C.setInput(E,o,r,_):E[_]=o}}function nh(e,t,n){const r=function sa(e,t){return us(t[e])}(t,e);!function ty(e,t,n){e.setValue(t,n)}(e[11],r,n)}function Mp(e,t,n){let r=n?e.styles:null,o=n?e.classes:null,c=0;if(null!==t)for(let d=0;d<t.length;d++){const _=t[d];"number"==typeof _?c=_:1==c?o=vr(o,_):2==c&&(r=vr(r,_+": "+t[++d]+";"))}n?e.styles=r:e.stylesWithoutHost=r,n?e.classes=o:e.classesWithoutHost=o}function Ac(e,t,n,r,o=!1){for(;null!==n;){const c=t[n.index];if(null!==c&&r.push(us(c)),vo(c))for(let _=10;_<c.length;_++){const E=c[_],C=E[1].firstChild;null!==C&&Ac(E[1],E,C,r)}const d=n.type;if(8&d)Ac(e,t,n.child,r);else if(32&d){const _=js(n,t);let E;for(;E=_();)r.push(E)}else if(16&d){const _=U0(t,n);if(Array.isArray(_))r.push(..._);else{const E=vh(t[16]);Ac(E[1],E,_,r,!0)}}n=o?n.projectionNext:n.next}return r}class Bd{constructor(t,n){this._lView=t,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,n=t[1];return Ac(n,t,n.firstChild,[])}get context(){return this._lView[8]}set context(t){this._lView[8]=t}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(vo(t)){const n=t[8],r=n?n.indexOf(this):-1;r>-1&&(ug(t,r),Kp(n,r))}this._attachedToViewContainer=!1}k0(this._lView[1],this._lView)}onDestroy(t){qy(this._lView[1],this._lView,null,t)}markForCheck(){jg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){Tp(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new xn(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function ry(e,t){fp(e,t,t[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(t){if(this._attachedToViewContainer)throw new xn(902,!1);this._appRef=t}}class $g extends Bd{constructor(t){super(t),this._view=t}detectChanges(){const t=this._view;Tp(t[1],t,t[8],!1)}checkNoChanges(){}get context(){return null}}class $v extends xp{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const n=xi(t);return new ll(n,this.ngModule)}}function Xf(e){const t=[];for(let n in e)e.hasOwnProperty(n)&&t.push({propName:e[n],templateName:n});return t}class i_{constructor(t,n){this.injector=t,this.parentInjector=n}get(t,n,r){r=ku(r);const o=this.injector.get(t,Vf,r);return o!==Vf||n===Vf?o:this.parentInjector.get(t,n,r)}}class ll extends lv{constructor(t,n){super(),this.componentDef=t,this.ngModule=n,this.componentType=t.type,this.selector=function Mw(e){return e.map(Dw).join(",")}(t.selectors),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Xf(this.componentDef.inputs)}get outputs(){return Xf(this.componentDef.outputs)}create(t,n,r,o){let c=(o=o||this.ngModule)instanceof Zc?o:o?.injector;c&&null!==this.componentDef.getStandaloneInjector&&(c=this.componentDef.getStandaloneInjector(c)||c);const d=c?new i_(t,c):t,_=d.get(hv,null);if(null===_)throw new xn(407,!1);const E=d.get(Ry,null),C=_.createRenderer(null,this.componentDef),A=this.componentDef.selectors[0][0]||"div",R=r?function Fw(e,t,n){return e.selectRootElement(t,n===oa.ShadowDom)}(C,r,this.componentDef.encapsulation):ag(C,A,function r_(e){const t=e.toLowerCase();return"svg"===t?"svg":"math"===t?"math":null}(A)),N=this.componentDef.onPush?288:272,z=Fg(0,null,null,1,0,null,null,null,null,null),Q=kg(null,z,null,N,null,null,_,C,E,d,null);let ee,Te;l(Q);try{const me=this.componentDef;let ie,oe=null;me.findHostDirectiveDefs?(ie=[],oe=new Map,me.findHostDirectiveDefs(me,ie,oe),ie.push(me)):ie=[me];const Ke=function Pc(e,t){const n=e[1];return e[22]=t,Jc(n,22,2,"#host",null)}(Q,R),ot=function Zf(e,t,n,r,o,c,d,_){const E=o[1];!function Hv(e,t,n,r){for(const o of e)t.mergedAttrs=Vn(t.mergedAttrs,o.hostAttrs);null!==t.mergedAttrs&&(Mp(t,t.mergedAttrs,!0),null!==n&&dy(r,n,t))}(r,e,t,d);const C=c.createRenderer(t,n),A=kg(o,kv(n),null,n.onPush?32:16,o[e.index],e,c,C,_||null,null,null);return E.firstCreatePass&&Yy(E,e,r.length-1),Hf(o,A),o[e.index]=A}(Ke,R,me,ie,Q,_,C);Te=zs(z,22),R&&function Ap(e,t,n,r){if(r)_n(e,n,["ng-version",Al.full]);else{const{attrs:o,classes:c}=function Aw(e){const t=[],n=[];let r=1,o=2;for(;r<e.length;){let c=e[r];if("string"==typeof c)2===o?""!==c&&t.push(c,e[++r]):8===o&&n.push(c);else{if(!Pl(o))break;o=c}r++}return{attrs:t,classes:n}}(t.selectors[0]);o&&_n(e,n,o),c&&c.length>0&&dp(e,n,c.join(" "))}}(C,me,R,r),void 0!==n&&function qg(e,t,n){const r=e.projection=[];for(let o=0;o<t.length;o++){const c=n[o];r.push(null!=c?Array.from(c):null)}}(Te,this.ngContentSelectors,n),ee=function Xv(e,t,n,r,o,c){const d=Sr(),_=o[1],E=Js(d,o);Bg(_,o,d,n,null,r);for(let A=0;A<n.length;A++)mu(eu(o,_,d.directiveStart+A,d),o);Ug(_,o,d),E&&mu(E,o);const C=eu(o,_,d.directiveStart+d.componentOffset,d);if(e[8]=o[8]=C,null!==c)for(const A of c)A(C,t);return $y(_,d,e),C}(ot,me,ie,oe,Q,[Zv]),$f(z,Q,null)}finally{O()}return new o_(this.componentType,ee,Ic(Te,Q),Q,Te)}}class o_ extends ww{constructor(t,n,r,o,c){super(),this.location=r,this._rootLView=o,this._tNode=c,this.instance=n,this.hostView=this.changeDetectorRef=new $g(o),this.componentType=t}setInput(t,n){const r=this._tNode.inputs;let o;if(null!==r&&(o=r[t])){const c=this._rootLView;Gg(c[1],c,o,t,n),Ip(c,this._tNode.index)}}get injector(){return new gh(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}function Zv(){const e=Sr();Ne(gt()[1],e)}let P=null;function L(){if(!P){const e=Jr.Symbol;if(e&&e.iterator)P=e.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<t.length;++n){const r=t[n];"entries"!==r&&"size"!==r&&Map.prototype[r]===Map.prototype.entries&&(P=r)}}}return P}function V(e){return!!function X(e){return null!==e&&("function"==typeof e||"object"==typeof e)}(e)&&(Array.isArray(e)||!(e instanceof Map)&&L()in e)}function Xe(e,t,n){return!Object.is(e[t],n)&&(e[t]=n,!0)}function ii(e){return function El(e,t){return e[t]}(function If(){return x.lFrame.contextLView}(),22+e)}function Ti(e,t,n){const r=gt();return Xe(r,dh(),t)&&function Rl(e,t,n,r,o,c,d,_){const E=Js(t,n);let A,C=t.inputs;!_&&null!=C&&(A=C[r])?(Gg(e,n,A,r,o),Ts(t)&&Ip(n,t.index)):3&t.type&&(r=function Bw(e){return"class"===e?"className":"for"===e?"htmlFor":"formaction"===e?"formAction":"innerHtml"===e?"innerHTML":"readonly"===e?"readOnly":"tabindex"===e?"tabIndex":e}(r),o=null!=d?d(o,t.value||"",r):o,c.setProperty(E,r,o))}(nn(),function Z(){const e=x.lFrame;return zs(e.tView,e.selectedIndex)}(),r,e,t,r[11],n,!1),Ti}function Lo(e,t,n,r,o){const d=o?"class":"style";Gg(e,n,t.inputs[d],d,r)}function Ir(e,t,n,r){const o=gt(),c=nn(),d=22+e,_=o[11],E=o[d]=ag(_,t,function Ce(){return x.lFrame.currentNamespace}()),C=c.firstCreatePass?function Uo(e,t,n,r,o,c,d){const _=t.consts,C=Jc(t,e,2,o,u(_,c));return Zy(t,n,C,u(_,d)),null!==C.attrs&&Mp(C,C.attrs,!1),null!==C.mergedAttrs&&Mp(C,C.mergedAttrs,!0),null!==t.queries&&t.queries.elementStart(t,C),C}(d,c,o,0,t,n,r):c.data[d];return Ss(C,!0),dy(_,E,C),32!=(32&C.flags)&&hg(c,o,E,C),0===function G(){return x.lFrame.elementDepthCount}()&&mu(E,o),function K(){x.lFrame.elementDepthCount++}(),fs(C)&&(cf(c,o,C),$y(c,C,o)),null!==r&&zd(o,C),Ir}function Ar(){let e=Sr();Va()?function Yl(){x.lFrame.isParent=!1}():(e=e.parent,Ss(e,!1));const t=e;!function re(){x.lFrame.elementDepthCount--}();const n=nn();return n.firstCreatePass&&(Ne(n,e),Uc(e)&&n.queries.elementEnd(e)),null!=t.classesWithoutHost&&function Jt(e){return 0!=(8&e.flags)}(t)&&Lo(n,t,gt(),t.classesWithoutHost,!0),null!=t.stylesWithoutHost&&function Dt(e){return 0!=(16&e.flags)}(t)&&Lo(n,t,gt(),t.stylesWithoutHost,!1),Ar}function lo(e,t,n,r){return Ir(e,t,n,r),Ar(),lo}function Jo(e){return!!e&&"function"==typeof e.then}const xo=function la(e){return!!e&&"function"==typeof e.subscribe};function Pi(e,t,n,r){const o=gt(),c=nn(),d=Sr();return function Aa(e,t,n,r,o,c,d){const _=fs(r),C=e.firstCreatePass&&e_(e),A=t[8],R=Qy(t);let N=!0;if(3&r.type||d){const ee=Js(r,t),Te=d?d(ee):ee,me=R.length,ie=d?Ke=>d(us(Ke[r.index])):r.index;let oe=null;if(!d&&_&&(oe=function Ga(e,t,n,r){const o=e.cleanup;if(null!=o)for(let c=0;c<o.length-1;c+=2){const d=o[c];if(d===n&&o[c+1]===r){const _=t[7],E=o[c+2];return _.length>E?_[E]:null}"string"==typeof d&&(c+=2)}return null}(e,t,o,r.index)),null!==oe)(oe.__ngLastListenerFn__||oe).__ngNextListenerFn__=c,oe.__ngLastListenerFn__=c,N=!1;else{c=Pa(r,t,A,c,!1);const Ke=n.listen(Te,o,c);R.push(c,Ke),C&&C.push(o,ie,me,me+1)}}else c=Pa(r,t,A,c,!1);const z=r.outputs;let Q;if(N&&null!==z&&(Q=z[o])){const ee=Q.length;if(ee)for(let Te=0;Te<ee;Te+=2){const ot=t[Q[Te]][Q[Te+1]].subscribe(c),Et=R.length;R.push(c,ot),C&&C.push(o,r.index,Et,-(Et+1))}}}(c,o,o[11],d,e,t,r),Pi}function yu(e,t,n,r){try{return!1!==n(r)}catch(o){return n_(e,o),!1}}function Pa(e,t,n,r,o){return function c(d){if(d===Function)return r;jg(e.componentOffset>-1?Po(e.index,t):t);let E=yu(t,0,r,d),C=c.__ngNextListenerFn__;for(;C;)E=yu(t,0,C,d)&&E,C=C.__ngNextListenerFn__;return o&&!1===E&&(d.preventDefault(),d.returnValue=!1),E}}function vu(e,t=""){const n=gt(),r=nn(),o=e+22,c=r.firstCreatePass?Jc(r,o,1,t,null):r.data[o],d=n[o]=function sg(e,t){return e.createText(t)}(n[11],t);hg(r,n,d,c),Ss(c,!1)}function Yw(e){return t1("",e,""),Yw}function t1(e,t,n){const r=gt(),o=function It(e,t,n,r){return Xe(e,dh(),n)?t+gr(n)+r:si}(r,e,t,n);return o!==si&&nh(r,$(),o),t1}const em="en-US";let YS=em;class tm{}class bI{}class EI extends tm{constructor(t,n){super(),this._parent=n,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new $v(this);const r=Za(t);this._bootstrapComponents=Wc(r.bootstrap),this._r3Injector=Tv(t,n,[{provide:tm,useValue:this},{provide:xp,useValue:this.componentFactoryResolver}],qn(t),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(t)}get injector(){return this._r3Injector}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class rb extends bI{constructor(t){super(),this.moduleType=t}create(t){return new EI(this.moduleType,t)}}class mL extends tm{constructor(t,n,r){super(),this.componentFactoryResolver=new $v(this),this.instance=null;const o=new Ty([...t,{provide:tm,useValue:this},{provide:xp,useValue:this.componentFactoryResolver}],n||rf(),r,new Set(["environment"]));this.injector=o,o.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(t){this.injector.onDestroy(t)}}function s1(e,t,n=null){return new mL(e,t,n).injector}let yL=(()=>{class e{constructor(n){this._injector=n,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(n){if(!n.standalone)return null;if(!this.cachedInjectors.has(n.id)){const r=ov(0,n.type),o=r.length>0?s1([r],this._injector,`Standalone[${n.type.name}]`):null;this.cachedInjectors.set(n.id,o)}return this.cachedInjectors.get(n.id)}ngOnDestroy(){try{for(const n of this.cachedInjectors.values())null!==n&&n.destroy()}finally{this.cachedInjectors.clear()}}}return e.\u0275prov=kn({token:e,providedIn:"environment",factory:()=>new e(Pn(Zc))}),e})();function CI(e){e.getStandaloneInjector=t=>t.get(yL).getOrCreateStandaloneInjector(e)}function ob(e){return t=>{setTimeout(e,void 0,t)}}const Ol=class GL extends Nt{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,n,r){let o=t,c=n||(()=>null),d=r;if(t&&"object"==typeof t){const E=t;o=E.next?.bind(E),c=E.error?.bind(E),d=E.complete?.bind(E)}this.__isAsync&&(c=ob(c),o&&(o=ob(o)),d&&(d=ob(d)));const _=super.subscribe({next:o,error:c,complete:d});return t instanceof ve&&t.add(_),_}};function $L(){return this._results[L()]()}class sb{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=L(),r=sb.prototype;r[n]||(r[n]=$L)}get changes(){return this._changes||(this._changes=new Ol)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,n){return this._results.reduce(t,n)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,n){const r=this;r.dirty=!1;const o=function Sl(e){return e.flat(Number.POSITIVE_INFINITY)}(t);(this._changesDetected=!function Yp(e,t,n){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++){let o=e[r],c=t[r];if(n&&(o=n(o),c=n(c)),c!==o)return!1}return!0}(r._results,o,n))&&(r._results=o,r.length=o.length,r.last=o[this.length-1],r.first=o[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Wf=(()=>{class e{}return e.__NG_ELEMENT_ID__=XL,e})();const qL=Wf,HL=class extends qL{constructor(t,n,r){super(),this._declarationLView=t,this._declarationTContainer=n,this.elementRef=r}createEmbeddedView(t,n){const r=this._declarationTContainer.tViews,o=kg(this._declarationLView,r,t,16,null,r.declTNode,null,null,null,null,n||null);o[17]=this._declarationLView[this._declarationTContainer.index];const d=this._declarationLView[19];return null!==d&&(o[19]=d.createEmbeddedView(r)),$f(r,o,t),new Bd(o)}};function XL(){return a1(Sr(),gt())}function a1(e,t){return 4&e.type?new HL(t,e,Ic(e,t)):null}let Ah=(()=>{class e{}return e.__NG_ELEMENT_ID__=ZL,e})();function ZL(){return zI(Sr(),gt())}const WL=Ah,kI=class extends WL{constructor(t,n,r){super(),this._lContainer=t,this._hostTNode=n,this._hostLView=r}get element(){return Ic(this._hostTNode,this._hostLView)}get injector(){return new gh(this._hostTNode,this._hostLView)}get parentInjector(){const t=Ma(this._hostTNode,this._hostLView);if(ir(t)){const n=xr(t,this._hostLView),r=Xn(t);return new gh(n[1].data[r+8],n)}return new gh(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const n=FI(this._lContainer);return null!==n&&n[t]||null}get length(){return this._lContainer.length-10}createEmbeddedView(t,n,r){let o,c;"number"==typeof r?o=r:null!=r&&(o=r.index,c=r.injector);const d=t.createEmbeddedView(n||{},c);return this.insert(d,o),d}createComponent(t,n,r,o,c){const d=t&&!function Cl(e){return"function"==typeof e}(t);let _;if(d)_=n;else{const R=n||{};_=R.index,r=R.injector,o=R.projectableNodes,c=R.environmentInjector||R.ngModuleRef}const E=d?t:new ll(xi(t)),C=r||this.parentInjector;if(!c&&null==E.ngModule){const N=(d?C:this.parentInjector).get(Zc,null);N&&(c=N)}const A=E.create(C,o,void 0,c);return this.insert(A.hostView,_),A}insert(t,n){const r=t._lView,o=r[1];if(function xc(e){return vo(e[3])}(r)){const A=this.indexOf(t);if(-1!==A)this.detach(A);else{const R=r[3],N=new kI(R,R[6],R[3]);N.detach(N.indexOf(t))}}const c=this._adjustIndex(n),d=this._lContainer;!function Pu(e,t,n,r){const o=10+r,c=n.length;r>0&&(n[o-1][4]=t),r<c-10?(t[4]=n[o],w0(n,10+r,t)):(n.push(t),t[4]=null),t[3]=n;const d=t[17];null!==d&&n!==d&&function O0(e,t){const n=e[9];t[16]!==t[3][3][16]&&(e[2]=!0),null===n?e[9]=[t]:n.push(t)}(d,t);const _=t[19];null!==_&&_.insertView(e),t[2]|=64}(o,r,d,c);const _=ly(c,d),E=r[11],C=cg(E,d[7]);return null!==C&&function ny(e,t,n,r,o,c){r[0]=o,r[6]=t,fp(e,r,n,1,o,c)}(o,d[6],E,r,C,_),t.attachToViewContainerRef(),w0(ab(d),c,t),t}move(t,n){return this.insert(t,n)}indexOf(t){const n=FI(this._lContainer);return null!==n?n.indexOf(t):-1}remove(t){const n=this._adjustIndex(t,-1),r=ug(this._lContainer,n);r&&(Kp(ab(this._lContainer),n),k0(r[1],r))}detach(t){const n=this._adjustIndex(t,-1),r=ug(this._lContainer,n);return r&&null!=Kp(ab(this._lContainer),n)?new Bd(r):null}_adjustIndex(t,n=0){return t??this.length+n}};function FI(e){return e[8]}function ab(e){return e[8]||(e[8]=[])}function zI(e,t){let n;const r=t[e.index];if(vo(r))n=r;else{let o;if(8&e.type)o=us(r);else{const c=t[11];o=c.createComment("");const d=Js(e,t);Hu(c,cg(c,d),o,function tw(e,t){return e.nextSibling(t)}(c,d),!1)}t[e.index]=n=jv(r,t,o,e),Hf(t,n)}return new kI(n,e,t)}class ub{constructor(t){this.queryList=t,this.matches=null}clone(){return new ub(this.queryList)}setDirty(){this.queryList.setDirty()}}class lb{constructor(t=[]){this.queries=t}createEmbeddedView(t){const n=t.queries;if(null!==n){const r=null!==t.contentQueries?t.contentQueries[0]:n.length,o=[];for(let c=0;c<r;c++){const d=n.getByIndex(c);o.push(this.queries[d.indexInDeclarationView].clone())}return new lb(o)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let n=0;n<this.queries.length;n++)null!==$I(t,n).matches&&this.queries[n].setDirty()}}class BI{constructor(t,n,r=null){this.predicate=t,this.flags=n,this.read=r}}class cb{constructor(t=[]){this.queries=t}elementStart(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(t,n)}elementEnd(t){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(t)}embeddedTView(t){let n=null;for(let r=0;r<this.length;r++){const o=null!==n?n.length:0,c=this.getByIndex(r).embeddedTView(t,o);c&&(c.indexInDeclarationView=r,null!==n?n.push(c):n=[c])}return null!==n?new cb(n):null}template(t,n){for(let r=0;r<this.queries.length;r++)this.queries[r].template(t,n)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class hb{constructor(t,n=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(t,n){this.isApplyingToNode(n)&&this.matchTNode(t,n)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,n){this.elementStart(t,n)}embeddedTView(t,n){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,n),new hb(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let r=t.parent;for(;null!==r&&8&r.type&&r.index!==n;)r=r.parent;return n===(null!==r?r.index:-1)}return this._appliesToNextNode}matchTNode(t,n){const r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){const c=r[o];this.matchTNodeWithReadOption(t,n,YL(n,c)),this.matchTNodeWithReadOption(t,n,ua(n,t,c,!1,!1))}else r===Wf?4&n.type&&this.matchTNodeWithReadOption(t,n,-1):this.matchTNodeWithReadOption(t,n,ua(n,t,r,!1,!1))}matchTNodeWithReadOption(t,n,r){if(null!==r){const o=this.metadata.read;if(null!==o)if(o===wh||o===Ah||o===Wf&&4&n.type)this.addMatch(n.index,-2);else{const c=ua(n,t,o,!1,!1);null!==c&&this.addMatch(n.index,c)}else this.addMatch(n.index,r)}}addMatch(t,n){null===this.matches?this.matches=[t,n]:this.matches.push(t,n)}}function YL(e,t){const n=e.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===t)return n[r+1];return null}function JL(e,t,n,r){return-1===n?function KL(e,t){return 11&e.type?Ic(e,t):4&e.type?a1(e,t):null}(t,e):-2===n?function QL(e,t,n){return n===wh?Ic(t,e):n===Wf?a1(t,e):n===Ah?zI(t,e):void 0}(e,t,r):eu(e,e[1],n,t)}function UI(e,t,n,r){const o=t[19].queries[r];if(null===o.matches){const c=e.data,d=n.matches,_=[];for(let E=0;E<d.length;E+=2){const C=d[E];_.push(C<0?null:JL(t,c[C],d[E+1],n.metadata.read))}o.matches=_}return o.matches}function fb(e,t,n,r){const o=e.queries.getByIndex(n),c=o.matches;if(null!==c){const d=UI(e,t,o,n);for(let _=0;_<c.length;_+=2){const E=c[_];if(E>0)r.push(d[_/2]);else{const C=c[_+1],A=t[-E];for(let R=10;R<A.length;R++){const N=A[R];N[17]===N[3]&&fb(N[1],N,C,r)}if(null!==A[9]){const R=A[9];for(let N=0;N<R.length;N++){const z=R[N];fb(z[1],z,C,r)}}}}}return r}function nm(e){const t=gt(),n=nn(),r=ep();Hh(r+1);const o=$I(n,r);if(e.dirty&&function Zo(e){return 4==(4&e[2])}(t)===(2==(2&o.metadata.flags))){if(null===o.matches)e.reset([]);else{const c=o.crossesNgTemplate?fb(n,t,r,[]):UI(n,t,o,r);e.reset(c,Cw),e.notifyOnChanges()}return!0}return!1}function v_(e,t,n){const r=nn();r.firstCreatePass&&(function GI(e,t,n){null===e.queries&&(e.queries=new cb),e.queries.track(new hb(t,n))}(r,new BI(e,t,n),-1),2==(2&t)&&(r.staticViewQueries=!0)),function jI(e,t,n){const r=new sb(4==(4&n));qy(e,t,r,r.destroy),null===t[19]&&(t[19]=new lb),t[19].queries.push(new ub(r))}(r,gt(),t)}function rm(){return function eO(e,t){return e[19].queries[t].queryList}(gt(),ep())}function $I(e,t){return e.queries.getByIndex(t)}function l1(...e){}const w_=new Xr("Application Initializer");let c1=(()=>{class e{constructor(n){this.appInits=n,this.resolve=l1,this.reject=l1,this.initialized=!1,this.done=!1,this.donePromise=new Promise((r,o)=>{this.resolve=r,this.reject=o})}runInitializers(){if(this.initialized)return;const n=[],r=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let o=0;o<this.appInits.length;o++){const c=this.appInits[o]();if(Jo(c))n.push(c);else if(xo(c)){const d=new Promise((_,E)=>{c.subscribe({complete:_,error:E})});n.push(d)}}Promise.all(n).then(()=>{r()}).catch(o=>{this.reject(o)}),0===n.length&&r(),this.initialized=!0}}return e.\u0275fac=function(n){return new(n||e)(Pn(w_,8))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const b_=new Xr("AppId",{providedIn:"root",factory:function lT(){return`${yb()}${yb()}${yb()}`}});function yb(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const cT=new Xr("Platform Initializer"),hT=new Xr("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),fT=new Xr("appBootstrapListener");let bO=(()=>{class e{log(n){console.log(n)}warn(n){console.warn(n)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();const Yf=new Xr("LocaleId",{providedIn:"root",factory:()=>rr(Yf,wr.Optional|wr.SkipSelf)||function EO(){return typeof $localize<"u"&&$localize.locale||em}()});class SO{constructor(t,n){this.ngModuleFactory=t,this.componentFactories=n}}let dT=(()=>{class e{compileModuleSync(n){return new rb(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const r=this.compileModuleSync(n),c=Wc(Za(n).declarations).reduce((d,_)=>{const E=xi(_);return E&&d.push(new ll(E)),d},[]);return new SO(r,c)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const DO=(()=>Promise.resolve(0))();function _b(e){typeof Zone>"u"?DO.then(()=>{e&&e.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",e)}class ru{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:r=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Ol(!1),this.onMicrotaskEmpty=new Ol(!1),this.onStable=new Ol(!1),this.onError=new Ol(!1),typeof Zone>"u")throw new xn(908,!1);Zone.assertZonePatched();const o=this;o._nesting=0,o._outer=o._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(o._inner=o._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(o._inner=o._inner.fork(Zone.longStackTraceZoneSpec)),o.shouldCoalesceEventChangeDetection=!r&&n,o.shouldCoalesceRunChangeDetection=r,o.lastRequestAnimationFrameId=-1,o.nativeRequestAnimationFrame=function MO(){let e=Jr.requestAnimationFrame,t=Jr.cancelAnimationFrame;if(typeof Zone<"u"&&e&&t){const n=e[Zone.__symbol__("OriginalDelegate")];n&&(e=n);const r=t[Zone.__symbol__("OriginalDelegate")];r&&(t=r)}return{nativeRequestAnimationFrame:e,nativeCancelAnimationFrame:t}}().nativeRequestAnimationFrame,function RO(e){const t=()=>{!function PO(e){e.isCheckStableRunning||-1!==e.lastRequestAnimationFrameId||(e.lastRequestAnimationFrameId=e.nativeRequestAnimationFrame.call(Jr,()=>{e.fakeTopEventTask||(e.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{e.lastRequestAnimationFrameId=-1,xb(e),e.isCheckStableRunning=!0,vb(e),e.isCheckStableRunning=!1},void 0,()=>{},()=>{})),e.fakeTopEventTask.invoke()}),xb(e))}(e)};e._inner=e._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,o,c,d,_)=>{try{return mT(e),n.invokeTask(o,c,d,_)}finally{(e.shouldCoalesceEventChangeDetection&&"eventTask"===c.type||e.shouldCoalesceRunChangeDetection)&&t(),yT(e)}},onInvoke:(n,r,o,c,d,_,E)=>{try{return mT(e),n.invoke(o,c,d,_,E)}finally{e.shouldCoalesceRunChangeDetection&&t(),yT(e)}},onHasTask:(n,r,o,c)=>{n.hasTask(o,c),r===o&&("microTask"==c.change?(e._hasPendingMicrotasks=c.microTask,xb(e),vb(e)):"macroTask"==c.change&&(e.hasPendingMacrotasks=c.macroTask))},onHandleError:(n,r,o,c)=>(n.handleError(o,c),e.runOutsideAngular(()=>e.onError.emit(c)),!1)})}(o)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ru.isInAngularZone())throw new xn(909,!1)}static assertNotInAngularZone(){if(ru.isInAngularZone())throw new xn(909,!1)}run(t,n,r){return this._inner.run(t,n,r)}runTask(t,n,r,o){const c=this._inner,d=c.scheduleEventTask("NgZoneEvent: "+o,t,AO,l1,l1);try{return c.runTask(d,n,r)}finally{c.cancelTask(d)}}runGuarded(t,n,r){return this._inner.runGuarded(t,n,r)}runOutsideAngular(t){return this._outer.run(t)}}const AO={};function vb(e){if(0==e._nesting&&!e.hasPendingMicrotasks&&!e.isStable)try{e._nesting++,e.onMicrotaskEmpty.emit(null)}finally{if(e._nesting--,!e.hasPendingMicrotasks)try{e.runOutsideAngular(()=>e.onStable.emit(null))}finally{e.isStable=!0}}}function xb(e){e.hasPendingMicrotasks=!!(e._hasPendingMicrotasks||(e.shouldCoalesceEventChangeDetection||e.shouldCoalesceRunChangeDetection)&&-1!==e.lastRequestAnimationFrameId)}function mT(e){e._nesting++,e.isStable&&(e.isStable=!1,e.onUnstable.emit(null))}function yT(e){e._nesting--,vb(e)}class LO{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Ol,this.onMicrotaskEmpty=new Ol,this.onStable=new Ol,this.onError=new Ol}run(t,n,r){return t.apply(n,r)}runGuarded(t,n,r){return t.apply(n,r)}runOutsideAngular(t){return t()}runTask(t,n,r,o){return t.apply(n,r)}}const _T=new Xr(""),h1=new Xr("");let Eb,wb=(()=>{class e{constructor(n,r,o){this._ngZone=n,this.registry=r,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Eb||(function OO(e){Eb=e}(o),o.addToWindow(r)),this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ru.assertNotInAngularZone(),_b(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())_b(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(r=>!r.updateCb||!r.updateCb(n)||(clearTimeout(r.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,r,o){let c=-1;r&&r>0&&(c=setTimeout(()=>{this._callbacks=this._callbacks.filter(d=>d.timeoutId!==c),n(this._didWork,this.getPendingTasks())},r)),this._callbacks.push({doneCb:n,timeoutId:c,updateCb:o})}whenStable(n,r,o){if(o&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,r,o),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(n){this.registry.registerApplication(n,this)}unregisterApplication(n){this.registry.unregisterApplication(n)}findProviders(n,r,o){return[]}}return e.\u0275fac=function(n){return new(n||e)(Pn(ru),Pn(bb),Pn(h1))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})(),bb=(()=>{class e{constructor(){this._applications=new Map}registerApplication(n,r){this._applications.set(n,r)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,r=!0){return Eb?.findTestabilityInTree(this,n,r)??null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})(),Vd=null;const vT=new Xr("AllowMultipleToken"),Cb=new Xr("PlatformDestroyListeners");class xT{constructor(t,n){this.name=t,this.token=n}}function bT(e,t,n=[]){const r=`Platform: ${t}`,o=new Xr(r);return(c=[])=>{let d=Sb();if(!d||d.injector.get(vT,!1)){const _=[...n,...c,{provide:o,useValue:!0}];e?e(_):function FO(e){if(Vd&&!Vd.get(vT,!1))throw new xn(400,!1);Vd=e;const t=e.get(CT);(function wT(e){const t=e.get(cT,null);t&&t.forEach(n=>n())})(e)}(function ET(e=[],t){return Yc.create({name:t,providers:[{provide:Sy,useValue:"platform"},{provide:Cb,useValue:new Set([()=>Vd=null])},...e]})}(_,r))}return function BO(e){const t=Sb();if(!t)throw new xn(401,!1);return t}()}}function Sb(){return Vd?.get(CT)??null}let CT=(()=>{class e{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,r){const o=function IT(e,t){let n;return n="noop"===e?new LO:("zone.js"===e?void 0:e)||new ru(t),n}(r?.ngZone,function ST(e){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!e||!e.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!e||!e.ngZoneRunCoalescing)||!1}}(r)),c=[{provide:ru,useValue:o}];return o.run(()=>{const d=Yc.create({providers:c,parent:this.injector,name:n.moduleType.name}),_=n.create(d),E=_.injector.get(Ad,null);if(!E)throw new xn(402,!1);return o.runOutsideAngular(()=>{const C=o.onError.subscribe({next:A=>{E.handleError(A)}});_.onDestroy(()=>{d1(this._modules,_),C.unsubscribe()})}),function TT(e,t,n){try{const r=n();return Jo(r)?r.catch(o=>{throw t.runOutsideAngular(()=>e.handleError(o)),o}):r}catch(r){throw t.runOutsideAngular(()=>e.handleError(r)),r}}(E,o,()=>{const C=_.injector.get(c1);return C.runInitializers(),C.donePromise.then(()=>(function KS(e){Vr(e,"Expected localeId to be defined"),"string"==typeof e&&(YS=e.toLowerCase().replace(/_/g,"-"))}(_.injector.get(Yf,em)||em),this._moduleDoBootstrap(_),_))})})}bootstrapModule(n,r=[]){const o=DT({},r);return function NO(e,t,n){const r=new rb(n);return Promise.resolve(r)}(0,0,n).then(c=>this.bootstrapModuleFactory(c,o))}_moduleDoBootstrap(n){const r=n.injector.get(f1);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(o=>r.bootstrap(o));else{if(!n.instance.ngDoBootstrap)throw new xn(403,!1);n.instance.ngDoBootstrap(r)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new xn(404,!1);this._modules.slice().forEach(r=>r.destroy()),this._destroyListeners.forEach(r=>r());const n=this._injector.get(Cb,null);n&&(n.forEach(r=>r()),n.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return e.\u0275fac=function(n){return new(n||e)(Pn(Yc))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"platform"}),e})();function DT(e,t){return Array.isArray(t)?t.reduce(DT,e):{...e,...t}}let f1=(()=>{class e{constructor(n,r,o){this._zone=n,this._injector=r,this._exceptionHandler=o,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const c=new Me(_=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{_.next(this._stable),_.complete()})}),d=new Me(_=>{let E;this._zone.runOutsideAngular(()=>{E=this._zone.onStable.subscribe(()=>{ru.assertNotInAngularZone(),_b(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,_.next(!0))})})});const C=this._zone.onUnstable.subscribe(()=>{ru.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{_.next(!1)}))});return()=>{E.unsubscribe(),C.unsubscribe()}});this.isStable=function uu(...e){const t=nr(e),n=function ci(e,t){return"number"==typeof Fn(e)?e.pop():t}(e,1/0),r=e;return r.length?1===r.length?Go(r[0]):Xt(n)(Di(r,t)):yn}(c,d.pipe(function Yu(e={}){const{connector:t=(()=>new Nt),resetOnError:n=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=e;return c=>{let d,_,E,C=0,A=!1,R=!1;const N=()=>{_?.unsubscribe(),_=void 0},z=()=>{N(),d=E=void 0,A=R=!1},Q=()=>{const ee=d;z(),ee?.unsubscribe()};return Mn((ee,Te)=>{C++,!R&&!A&&N();const me=E=E??t();Te.add(()=>{C--,0===C&&!R&&!A&&(_=Vl(Q,o))}),me.subscribe(Te),!d&&C>0&&(d=new J({next:ie=>me.next(ie),error:ie=>{R=!0,N(),_=Vl(z,n,ie),me.error(ie)},complete:()=>{A=!0,N(),_=Vl(z,r),me.complete()}}),Go(ee).subscribe(d))})(c)}}()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(n,r){const o=n instanceof lv;if(!this._injector.get(c1).done)throw!o&&function Ws(e){const t=xi(e)||mi(e)||hs(e);return null!==t&&t.standalone}(n),new xn(405,false);let d;d=o?n:this._injector.get(xp).resolveComponentFactory(n),this.componentTypes.push(d.componentType);const _=function kO(e){return e.isBoundToModule}(d)?void 0:this._injector.get(tm),C=d.create(Yc.NULL,[],r||d.selector,_),A=C.location.nativeElement,R=C.injector.get(_T,null);return R?.registerApplication(A),C.onDestroy(()=>{this.detachView(C.hostView),d1(this.components,C),R?.unregisterApplication(A)}),this._loadComponent(C),C}tick(){if(this._runningTick)throw new xn(101,!1);try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const r=n;this._views.push(r),r.attachToAppRef(this)}detachView(n){const r=n;d1(this._views,r),r.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n);const r=this._injector.get(fT,[]);r.push(...this._bootstrapListeners),r.forEach(o=>o(n))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(n=>n()),this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(n){return this._destroyListeners.push(n),()=>d1(this._destroyListeners,n)}destroy(){if(this._destroyed)throw new xn(406,!1);const n=this._injector;n.destroy&&!n.destroyed&&n.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return e.\u0275fac=function(n){return new(n||e)(Pn(ru),Pn(Zc),Pn(Ad))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function d1(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}let Ib=(()=>{class e{}return e.__NG_ELEMENT_ID__=VO,e})();function VO(e){return function jO(e,t,n){if(Ts(e)&&!n){const r=Po(e.index,t);return new Bd(r,r)}return 47&e.type?new Bd(t[16],t):null}(Sr(),gt(),16==(16&e))}class LT{constructor(){}supports(t){return V(t)}create(t){return new ZO(t)}}const XO=(e,t)=>t;class ZO{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||XO}forEachItem(t){let n;for(n=this._itHead;null!==n;n=n._next)t(n)}forEachOperation(t){let n=this._itHead,r=this._removalsHead,o=0,c=null;for(;n||r;){const d=!r||n&&n.currentIndex<NT(r,o,c)?n:r,_=NT(d,o,c),E=d.currentIndex;if(d===r)o--,r=r._nextRemoved;else if(n=n._next,null==d.previousIndex)o++;else{c||(c=[]);const C=_-o,A=E-o;if(C!=A){for(let N=0;N<C;N++){const z=N<c.length?c[N]:c[N]=0,Q=z+N;A<=Q&&Q<C&&(c[N]=z+1)}c[d.previousIndex]=A-C}}_!==E&&t(d,_,E)}}forEachPreviousItem(t){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)t(n)}forEachAddedItem(t){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)t(n)}forEachMovedItem(t){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)t(n)}forEachRemovedItem(t){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)t(n)}forEachIdentityChange(t){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)t(n)}diff(t){if(null==t&&(t=[]),!V(t))throw new xn(900,!1);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let o,c,d,n=this._itHead,r=!1;if(Array.isArray(t)){this.length=t.length;for(let _=0;_<this.length;_++)c=t[_],d=this._trackByFn(_,c),null!==n&&Object.is(n.trackById,d)?(r&&(n=this._verifyReinsertion(n,c,d,_)),Object.is(n.item,c)||this._addIdentityChange(n,c)):(n=this._mismatch(n,c,d,_),r=!0),n=n._next}else o=0,function H(e,t){if(Array.isArray(e))for(let n=0;n<e.length;n++)t(e[n]);else{const n=e[L()]();let r;for(;!(r=n.next()).done;)t(r.value)}}(t,_=>{d=this._trackByFn(o,_),null!==n&&Object.is(n.trackById,d)?(r&&(n=this._verifyReinsertion(n,_,d,o)),Object.is(n.item,_)||this._addIdentityChange(n,_)):(n=this._mismatch(n,_,d,o),r=!0),n=n._next,o++}),this.length=o;return this._truncate(n),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,n,r,o){let c;return null===t?c=this._itTail:(c=t._prev,this._remove(t)),null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._reinsertAfter(t,c,o)):null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(r,o))?(Object.is(t.item,n)||this._addIdentityChange(t,n),this._moveAfter(t,c,o)):t=this._addAfter(new WO(n,r),c,o),t}_verifyReinsertion(t,n,r,o){let c=null===this._unlinkedRecords?null:this._unlinkedRecords.get(r,null);return null!==c?t=this._reinsertAfter(c,t._prev,o):t.currentIndex!=o&&(t.currentIndex=o,this._addToMoves(t,o)),t}_truncate(t){for(;null!==t;){const n=t._next;this._addToRemovals(this._unlink(t)),t=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,n,r){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const o=t._prevRemoved,c=t._nextRemoved;return null===o?this._removalsHead=c:o._nextRemoved=c,null===c?this._removalsTail=o:c._prevRemoved=o,this._insertAfter(t,n,r),this._addToMoves(t,r),t}_moveAfter(t,n,r){return this._unlink(t),this._insertAfter(t,n,r),this._addToMoves(t,r),t}_addAfter(t,n,r){return this._insertAfter(t,n,r),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,n,r){const o=null===n?this._itHead:n._next;return t._next=o,t._prev=n,null===o?this._itTail=t:o._prev=t,null===n?this._itHead=t:n._next=t,null===this._linkedRecords&&(this._linkedRecords=new OT),this._linkedRecords.put(t),t.currentIndex=r,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const n=t._prev,r=t._next;return null===n?this._itHead=r:n._next=r,null===r?this._itTail=n:r._prev=n,t}_addToMoves(t,n){return t.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new OT),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,n){return t.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class WO{constructor(t,n){this.item=t,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class YO{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,n){let r;for(r=this._head;null!==r;r=r._nextDup)if((null===n||n<=r.currentIndex)&&Object.is(r.trackById,t))return r;return null}remove(t){const n=t._prevDup,r=t._nextDup;return null===n?this._head=r:n._nextDup=r,null===r?this._tail=n:r._prevDup=n,null===this._head}}class OT{constructor(){this.map=new Map}put(t){const n=t.trackById;let r=this.map.get(n);r||(r=new YO,this.map.set(n,r)),r.add(t)}get(t,n){const o=this.map.get(t);return o?o.get(t,n):null}remove(t){const n=t.trackById;return this.map.get(n).remove(t)&&this.map.delete(n),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function NT(e,t,n){const r=e.previousIndex;if(null===r)return r;let o=0;return n&&r<n.length&&(o=n[r]),r+t+o}function FT(){return new m1([new LT])}let m1=(()=>{class e{constructor(n){this.factories=n}static create(n,r){if(null!=r){const o=r.factories.slice();n=n.concat(o)}return new e(n)}static extend(n){return{provide:e,useFactory:r=>e.create(n,r||FT()),deps:[[e,new Wh,new cr]]}}find(n){const r=this.factories.find(o=>o.supports(n));if(null!=r)return r;throw new xn(901,!1)}}return e.\u0275prov=kn({token:e,providedIn:"root",factory:FT}),e})();const tN=bT(null,"core",[]);let nN=(()=>{class e{constructor(n){}}return e.\u0275fac=function(n){return new(n||e)(Pn(f1))},e.\u0275mod=Ls({type:e}),e.\u0275inj=Ea({}),e})(),Rb=null;function jd(){return Rb}class oN{}const ac=new Xr("DocumentToken");let Lb=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return function sN(){return Pn(BT)}()},providedIn:"platform"}),e})();const aN=new Xr("Location Initialized");let BT=(()=>{class e extends Lb{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return jd().getBaseHref(this._doc)}onPopState(n){const r=jd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",n,!1),()=>r.removeEventListener("popstate",n)}onHashChange(n){const r=jd().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",n,!1),()=>r.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,r,o){UT()?this._history.pushState(n,r,o):this.location.hash=o}replaceState(n,r,o){UT()?this._history.replaceState(n,r,o):this.location.hash=o}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return e.\u0275fac=function(n){return new(n||e)(Pn(ac))},e.\u0275prov=kn({token:e,factory:function(){return function uN(){return new BT(Pn(ac))}()},providedIn:"platform"}),e})();function UT(){return!!window.history.pushState}function Ob(e,t){if(0==e.length)return t;if(0==t.length)return e;let n=0;return e.endsWith("/")&&n++,t.startsWith("/")&&n++,2==n?e+t.substring(1):1==n?e+t:e+"/"+t}function VT(e){const t=e.match(/#|\?|$/),n=t&&t.index||e.length;return e.slice(0,n-("/"===e[n-1]?1:0))+e.slice(n)}function Jf(e){return e&&"?"!==e[0]?"?"+e:e}let kp=(()=>{class e{historyGo(n){throw new Error("Not implemented")}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return rr(GT)},providedIn:"root"}),e})();const jT=new Xr("appBaseHref");let GT=(()=>{class e extends kp{constructor(n,r){super(),this._platformLocation=n,this._removeListenerFns=[],this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??rr(ac).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return Ob(this._baseHref,n)}path(n=!1){const r=this._platformLocation.pathname+Jf(this._platformLocation.search),o=this._platformLocation.hash;return o&&n?`${r}${o}`:r}pushState(n,r,o,c){const d=this.prepareExternalUrl(o+Jf(c));this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){const d=this.prepareExternalUrl(o+Jf(c));this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Pn(Lb),Pn(jT,8))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),lN=(()=>{class e extends kp{constructor(n,r){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=r&&(this._baseHref=r)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let r=this._platformLocation.hash;return null==r&&(r="#"),r.length>0?r.substring(1):r}prepareExternalUrl(n){const r=Ob(this._baseHref,n);return r.length>0?"#"+r:r}pushState(n,r,o,c){let d=this.prepareExternalUrl(o+Jf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.pushState(n,r,d)}replaceState(n,r,o,c){let d=this.prepareExternalUrl(o+Jf(c));0==d.length&&(d=this._platformLocation.pathname),this._platformLocation.replaceState(n,r,d)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(n=0){this._platformLocation.historyGo?.(n)}}return e.\u0275fac=function(n){return new(n||e)(Pn(Lb),Pn(jT,8))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})(),Nb=(()=>{class e{constructor(n){this._subject=new Ol,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=n;const r=this._locationStrategy.getBaseHref();this._basePath=function fN(e){if(new RegExp("^(https?:)?//").test(e)){const[,n]=e.split(/\/\/[^\/]+/);return n}return e}(VT($T(r))),this._locationStrategy.onPopState(o=>{this._subject.emit({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(n=!1){return this.normalize(this._locationStrategy.path(n))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(n,r=""){return this.path()==this.normalize(n+Jf(r))}normalize(n){return e.stripTrailingSlash(function hN(e,t){return e&&t.startsWith(e)?t.substring(e.length):t}(this._basePath,$T(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._locationStrategy.prepareExternalUrl(n)}go(n,r="",o=null){this._locationStrategy.pushState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Jf(r)),o)}replaceState(n,r="",o=null){this._locationStrategy.replaceState(o,"",n,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+Jf(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(n=0){this._locationStrategy.historyGo?.(n)}onUrlChange(n){return this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)})),()=>{const r=this._urlChangeListeners.indexOf(n);this._urlChangeListeners.splice(r,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(n="",r){this._urlChangeListeners.forEach(o=>o(n,r))}subscribe(n,r,o){return this._subject.subscribe({next:n,error:r,complete:o})}}return e.normalizeQueryParams=Jf,e.joinWithSlash=Ob,e.stripTrailingSlash=VT,e.\u0275fac=function(n){return new(n||e)(Pn(kp))},e.\u0275prov=kn({token:e,factory:function(){return function cN(){return new Nb(Pn(kp))}()},providedIn:"root"}),e})();function $T(e){return e.replace(/\/index.html$/,"")}class JN{constructor(t,n,r,o){this.$implicit=t,this.ngForOf=n,this.index=r,this.count=o}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let tD=(()=>{class e{constructor(n,r,o){this._viewContainer=n,this._template=r,this._differs=o,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const r=this._viewContainer;n.forEachOperation((o,c,d)=>{if(null==o.previousIndex)r.createEmbeddedView(this._template,new JN(o.item,this._ngForOf,-1,-1),null===d?void 0:d);else if(null==d)r.remove(null===c?void 0:c);else if(null!==c){const _=r.get(c);r.move(_,d),nD(_,o)}});for(let o=0,c=r.length;o<c;o++){const _=r.get(o).context;_.index=o,_.count=c,_.ngForOf=this._ngForOf}n.forEachIdentityChange(o=>{nD(r.get(o.currentIndex),o)})}static ngTemplateContextGuard(n,r){return!0}}return e.\u0275fac=function(n){return new(n||e)(zr(Ah),zr(Wf),zr(m1))},e.\u0275dir=vi({type:e,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),e})();function nD(e,t){e.context.$implicit=t.item}let Ak=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=Ls({type:e}),e.\u0275inj=Ea({}),e})();let Ok=(()=>{class e{}return e.\u0275prov=kn({token:e,providedIn:"root",factory:()=>new Nk(Pn(ac),window)}),e})();class Nk{constructor(t,n){this.document=t,this.window=n,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){if(!this.supportsScrolling())return;const n=function kk(e,t){const n=e.getElementById(t)||e.getElementsByName(t)[0];if(n)return n;if("function"==typeof e.createTreeWalker&&e.body&&(e.body.createShadowRoot||e.body.attachShadow)){const r=e.createTreeWalker(e.body,NodeFilter.SHOW_ELEMENT);let o=r.currentNode;for(;o;){const c=o.shadowRoot;if(c){const d=c.getElementById(t)||c.querySelector(`[name="${t}"]`);if(d)return d}o=r.nextNode()}}return null}(this.document,t);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=t)}}scrollToElement(t){const n=t.getBoundingClientRect(),r=n.left+this.window.pageXOffset,o=n.top+this.window.pageYOffset,c=this.offset();this.window.scrollTo(r-c[0],o-c[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=aD(this.window.history)||aD(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function aD(e){return Object.getOwnPropertyDescriptor(e,"scrollRestoration")}class cF extends oN{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class Kb extends cF{static makeCurrent(){!function iN(e){Rb||(Rb=e)}(new Kb)}onAndCancel(t,n,r){return t.addEventListener(n,r,!1),()=>{t.removeEventListener(n,r,!1)}}dispatchEvent(t,n){t.dispatchEvent(n)}remove(t){t.parentNode&&t.parentNode.removeChild(t)}createElement(t,n){return(n=n||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,n){return"window"===n?window:"document"===n?t:"body"===n?t.body:null}getBaseHref(t){const n=function hF(){return T_=T_||document.querySelector("base"),T_?T_.getAttribute("href"):null}();return null==n?null:function fF(e){T1=T1||document.createElement("a"),T1.setAttribute("href",e);const t=T1.pathname;return"/"===t.charAt(0)?t:`/${t}`}(n)}resetBaseElement(){T_=null}getUserAgent(){return window.navigator.userAgent}getCookie(t){return function WN(e,t){t=encodeURIComponent(t);for(const n of e.split(";")){const r=n.indexOf("="),[o,c]=-1==r?[n,""]:[n.slice(0,r),n.slice(r+1)];if(o.trim()===t)return decodeURIComponent(c)}return null}(document.cookie,t)}}let T1,T_=null;const dD=new Xr("TRANSITION_ID"),pF=[{provide:w_,useFactory:function dF(e,t,n){return()=>{n.get(c1).donePromise.then(()=>{const r=jd(),o=t.querySelectorAll(`style[ng-transition="${e}"]`);for(let c=0;c<o.length;c++)r.remove(o[c])})}},deps:[dD,ac,Yc],multi:!0}];let mF=(()=>{class e{build(){return new XMLHttpRequest}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();const D1=new Xr("EventManagerPlugins");let M1=(()=>{class e{constructor(n,r){this._zone=r,this._eventNameToPlugin=new Map,n.forEach(o=>o.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,r,o){return this._findPluginFor(r).addEventListener(n,r,o)}addGlobalEventListener(n,r,o){return this._findPluginFor(r).addGlobalEventListener(n,r,o)}getZone(){return this._zone}_findPluginFor(n){const r=this._eventNameToPlugin.get(n);if(r)return r;const o=this._plugins;for(let c=0;c<o.length;c++){const d=o[c];if(d.supports(n))return this._eventNameToPlugin.set(n,d),d}throw new Error(`No event manager plugin found for event ${n}`)}}return e.\u0275fac=function(n){return new(n||e)(Pn(D1),Pn(ru))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();class pD{constructor(t){this._doc=t}addGlobalEventListener(t,n,r){const o=jd().getGlobalEventTarget(this._doc,t);if(!o)throw new Error(`Unsupported event target ${o} for event ${n}`);return this.addEventListener(o,n,r)}}let gD=(()=>{class e{constructor(){this._stylesSet=new Set}addStyles(n){const r=new Set;n.forEach(o=>{this._stylesSet.has(o)||(this._stylesSet.add(o),r.add(o))}),this.onStylesAdded(r)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})(),D_=(()=>{class e extends gD{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,r,o){n.forEach(c=>{const d=this._doc.createElement("style");d.textContent=c,o.push(r.appendChild(d))})}addHost(n){const r=[];this._addStylesToHost(this._stylesSet,n,r),this._hostNodes.set(n,r)}removeHost(n){const r=this._hostNodes.get(n);r&&r.forEach(mD),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((r,o)=>{this._addStylesToHost(n,o,r)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(mD))}}return e.\u0275fac=function(n){return new(n||e)(Pn(ac))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();function mD(e){jd().remove(e)}const Jb={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Qb=/%COMP%/g;function eE(e,t){return t.flat(100).map(n=>n.replace(Qb,e))}function vD(e){return t=>{if("__ngUnwrap__"===t)return e;!1===e(t)&&(t.preventDefault(),t.returnValue=!1)}}let tE=(()=>{class e{constructor(n,r,o){this.eventManager=n,this.sharedStylesHost=r,this.appId=o,this.rendererByCompId=new Map,this.defaultRenderer=new nE(n)}createRenderer(n,r){if(!n||!r)return this.defaultRenderer;switch(r.encapsulation){case oa.Emulated:{let o=this.rendererByCompId.get(r.id);return o||(o=new bF(this.eventManager,this.sharedStylesHost,r,this.appId),this.rendererByCompId.set(r.id,o)),o.applyToHost(n),o}case 1:case oa.ShadowDom:return new EF(this.eventManager,this.sharedStylesHost,n,r);default:if(!this.rendererByCompId.has(r.id)){const o=eE(r.id,r.styles);this.sharedStylesHost.addStyles(o),this.rendererByCompId.set(r.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return e.\u0275fac=function(n){return new(n||e)(Pn(M1),Pn(D_),Pn(b_))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();class nE{constructor(t){this.eventManager=t,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(t,n){return n?document.createElementNS(Jb[n]||n,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,n){(wD(t)?t.content:t).appendChild(n)}insertBefore(t,n,r){t&&(wD(t)?t.content:t).insertBefore(n,r)}removeChild(t,n){t&&t.removeChild(n)}selectRootElement(t,n){let r="string"==typeof t?document.querySelector(t):t;if(!r)throw new Error(`The selector "${t}" did not match any elements`);return n||(r.textContent=""),r}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,n,r,o){if(o){n=o+":"+n;const c=Jb[o];c?t.setAttributeNS(c,n,r):t.setAttribute(n,r)}else t.setAttribute(n,r)}removeAttribute(t,n,r){if(r){const o=Jb[r];o?t.removeAttributeNS(o,n):t.removeAttribute(`${r}:${n}`)}else t.removeAttribute(n)}addClass(t,n){t.classList.add(n)}removeClass(t,n){t.classList.remove(n)}setStyle(t,n,r,o){o&(ol.DashCase|ol.Important)?t.style.setProperty(n,r,o&ol.Important?"important":""):t.style[n]=r}removeStyle(t,n,r){r&ol.DashCase?t.style.removeProperty(n):t.style[n]=""}setProperty(t,n,r){t[n]=r}setValue(t,n){t.nodeValue=n}listen(t,n,r){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,n,vD(r)):this.eventManager.addEventListener(t,n,vD(r))}}function wD(e){return"TEMPLATE"===e.tagName&&void 0!==e.content}class bF extends nE{constructor(t,n,r,o){super(t),this.component=r;const c=eE(o+"-"+r.id,r.styles);n.addStyles(c),this.contentAttr=function vF(e){return"_ngcontent-%COMP%".replace(Qb,e)}(o+"-"+r.id),this.hostAttr=function xF(e){return"_nghost-%COMP%".replace(Qb,e)}(o+"-"+r.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,n){const r=super.createElement(t,n);return super.setAttribute(r,this.contentAttr,""),r}}class EF extends nE{constructor(t,n,r,o){super(t),this.sharedStylesHost=n,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const c=eE(o.id,o.styles);for(let d=0;d<c.length;d++){const _=document.createElement("style");_.textContent=c[d],this.shadowRoot.appendChild(_)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,n){return super.appendChild(this.nodeOrShadowRoot(t),n)}insertBefore(t,n,r){return super.insertBefore(this.nodeOrShadowRoot(t),n,r)}removeChild(t,n){return super.removeChild(this.nodeOrShadowRoot(t),n)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let CF=(()=>{class e extends pD{constructor(n){super(n)}supports(n){return!0}addEventListener(n,r,o){return n.addEventListener(r,o,!1),()=>this.removeEventListener(n,r,o)}removeEventListener(n,r,o){return n.removeEventListener(r,o)}}return e.\u0275fac=function(n){return new(n||e)(Pn(ac))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();const bD=["alt","control","meta","shift"],SF={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},IF={alt:e=>e.altKey,control:e=>e.ctrlKey,meta:e=>e.metaKey,shift:e=>e.shiftKey};let TF=(()=>{class e extends pD{constructor(n){super(n)}supports(n){return null!=e.parseEventName(n)}addEventListener(n,r,o){const c=e.parseEventName(r),d=e.eventCallback(c.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>jd().onAndCancel(n,c.domEventName,d))}static parseEventName(n){const r=n.toLowerCase().split("."),o=r.shift();if(0===r.length||"keydown"!==o&&"keyup"!==o)return null;const c=e._normalizeKey(r.pop());let d="",_=r.indexOf("code");if(_>-1&&(r.splice(_,1),d="code."),bD.forEach(C=>{const A=r.indexOf(C);A>-1&&(r.splice(A,1),d+=C+".")}),d+=c,0!=r.length||0===c.length)return null;const E={};return E.domEventName=o,E.fullKey=d,E}static matchEventFullKeyCode(n,r){let o=SF[n.key]||n.key,c="";return r.indexOf("code.")>-1&&(o=n.code,c="code."),!(null==o||!o)&&(o=o.toLowerCase()," "===o?o="space":"."===o&&(o="dot"),bD.forEach(d=>{d!==o&&(0,IF[d])(n)&&(c+=d+".")}),c+=o,c===r)}static eventCallback(n,r,o){return c=>{e.matchEventFullKeyCode(c,n)&&o.runGuarded(()=>r(c))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return e.\u0275fac=function(n){return new(n||e)(Pn(ac))},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();const PF=bT(tN,"browser",[{provide:hT,useValue:"browser"},{provide:cT,useValue:function DF(){Kb.makeCurrent()},multi:!0},{provide:ac,useFactory:function AF(){return function rw(e){pp=e}(document),document},deps:[]}]),SD=new Xr(""),ID=[{provide:h1,useClass:class gF{addToWindow(t){Jr.getAngularTestability=(r,o=!0)=>{const c=t.findTestabilityInTree(r,o);if(null==c)throw new Error("Could not find testability for element.");return c},Jr.getAllAngularTestabilities=()=>t.getAllTestabilities(),Jr.getAllAngularRootElements=()=>t.getAllRootElements(),Jr.frameworkStabilizers||(Jr.frameworkStabilizers=[]),Jr.frameworkStabilizers.push(r=>{const o=Jr.getAllAngularTestabilities();let c=o.length,d=!1;const _=function(E){d=d||E,c--,0==c&&r(d)};o.forEach(function(E){E.whenStable(_)})})}findTestabilityInTree(t,n,r){return null==n?null:t.getTestability(n)??(r?jd().isShadowRoot(n)?this.findTestabilityInTree(t,n.host,!0):this.findTestabilityInTree(t,n.parentElement,!0):null)}},deps:[]},{provide:_T,useClass:wb,deps:[ru,bb,h1]},{provide:wb,useClass:wb,deps:[ru,bb,h1]}],TD=[{provide:Sy,useValue:"root"},{provide:Ad,useFactory:function MF(){return new Ad},deps:[]},{provide:D1,useClass:CF,multi:!0,deps:[ac,ru,hT]},{provide:D1,useClass:TF,multi:!0,deps:[ac]},{provide:tE,useClass:tE,deps:[M1,D_,b_]},{provide:hv,useExisting:tE},{provide:gD,useExisting:D_},{provide:D_,useClass:D_,deps:[ac]},{provide:M1,useClass:M1,deps:[D1,ru]},{provide:class Fk{},useClass:mF,deps:[]},[]];let RF=(()=>{class e{constructor(n){}static withServerTransition(n){return{ngModule:e,providers:[{provide:b_,useValue:n.appId},{provide:dD,useExisting:b_},pF]}}}return e.\u0275fac=function(n){return new(n||e)(Pn(SD,12))},e.\u0275mod=Ls({type:e}),e.\u0275inj=Ea({providers:[...TD,...ID],imports:[Ak,nN]}),e})(),DD=(()=>{class e{constructor(n){this._doc=n}getTitle(){return this._doc.title}setTitle(n){this._doc.title=n||""}}return e.\u0275fac=function(n){return new(n||e)(Pn(ac))},e.\u0275prov=kn({token:e,factory:function(n){let r=null;return r=n?new n:function OF(){return new DD(Pn(ac))}(),r},providedIn:"root"}),e})();function Yr(...e){return Di(e,nr(e))}typeof window<"u"&&window;class Oh extends Nt{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const n=super._subscribe(t);return!n.closed&&t.next(this._value),n}getValue(){const{hasError:t,thrownError:n,_value:r}=this;if(t)throw n;return this._throwIfClosed(),r}next(t){super.next(this._value=t)}}const A1=Fe(e=>function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:jF}=Array,{getPrototypeOf:GF,prototype:$F,keys:qF}=Object;const{isArray:ZF}=Array;function PD(...e){const t=nr(e),n=function or(e){return Ee(Fn(e))?e.pop():void 0}(e),{args:r,keys:o}=function HF(e){if(1===e.length){const t=e[0];if(jF(t))return{args:t,keys:null};if(function XF(e){return e&&"object"==typeof e&&GF(e)===$F}(t)){const n=qF(t);return{args:n.map(r=>t[r]),keys:n}}}return{args:e,keys:null}}(e);if(0===r.length)return Di([],t);const c=new Me(function JF(e,t,n=At){return r=>{RD(t,()=>{const{length:o}=e,c=new Array(o);let d=o,_=o;for(let E=0;E<o;E++)RD(t,()=>{const C=Di(e[E],t);let A=!1;C.subscribe(Rn(r,R=>{c[E]=R,A||(A=!0,_--),_||r.next(n(c.slice()))},()=>{--d||r.complete()}))},r)},r)}}(r,t,o?d=>function KF(e,t){return e.reduce((n,r,o)=>(n[r]=t[o],n),{})}(o,d):At));return n?c.pipe(function YF(e){return vn(t=>function WF(e,t){return ZF(t)?e(...t):e(t)}(e,t))}(n)):c}function RD(e,t,n){e?yt(n,e,t):t()}function oE(...e){return function QF(){return Xt(1)}()(Di(e,nr(e)))}function LD(e){return new Me(t=>{Go(e()).subscribe(t)})}function M_(e,t){const n=Ee(e)?e:()=>e,r=o=>o.error(n());return new Me(t?o=>t.schedule(r,0,o):r)}function sE(){return Mn((e,t)=>{let n=null;e._refCount++;const r=Rn(t,void 0,void 0,void 0,()=>{if(!e||e._refCount<=0||0<--e._refCount)return void(n=null);const o=e._connection,c=n;n=null,o&&(!c||o===c)&&o.unsubscribe(),t.unsubscribe()});e.subscribe(r),r.closed||(n=e.connect())})}class OD extends Me{constructor(t,n){super(),this.source=t,this.subjectFactory=n,this._subject=null,this._refCount=0,this._connection=null,Lt(t)&&(this.lift=t.lift)}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return(!t||t.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:t}=this;this._subject=this._connection=null,t?.unsubscribe()}connect(){let t=this._connection;if(!t){t=this._connection=new ve;const n=this.getSubject();t.add(this.source.subscribe(Rn(n,void 0,()=>{this._teardown(),n.complete()},r=>{this._teardown(),n.error(r)},()=>this._teardown()))),t.closed&&(this._connection=null,t=ve.EMPTY)}return t}refCount(){return sE()(this)}}function mf(e,t){return Mn((n,r)=>{let o=null,c=0,d=!1;const _=()=>d&&!o&&r.complete();n.subscribe(Rn(r,E=>{o?.unsubscribe();let C=0;const A=c++;Go(e(E,A)).subscribe(o=Rn(r,R=>r.next(t?t(E,R,A,C++):R),()=>{o=null,_()}))},()=>{d=!0,_()}))})}function A_(e){return e<=0?()=>yn:Mn((t,n)=>{let r=0;t.subscribe(Rn(n,o=>{++r<=e&&(n.next(o),e<=r&&n.complete())}))})}function $d(e,t){return Mn((n,r)=>{let o=0;n.subscribe(Rn(r,c=>e.call(t,c,o++)&&r.next(c)))})}function P1(e){return Mn((t,n)=>{let r=!1;t.subscribe(Rn(n,o=>{r=!0,n.next(o)},()=>{r||n.next(e),n.complete()}))})}function ND(e=t3){return Mn((t,n)=>{let r=!1;t.subscribe(Rn(n,o=>{r=!0,n.next(o)},()=>r?n.complete():n.error(e())))})}function t3(){return new A1}function qd(e,t){const n=arguments.length>=2;return r=>r.pipe(e?$d((o,c)=>e(o,c,r)):At,A_(1),n?P1(t):ND(()=>new A1))}function Fp(e,t){return Ee(t)?st(e,t,1):st(e,1)}function hl(e,t,n){const r=Ee(e)||t||n?{next:e,error:t,complete:n}:e;return r?Mn((o,c)=>{var d;null===(d=r.subscribe)||void 0===d||d.call(r);let _=!0;o.subscribe(Rn(c,E=>{var C;null===(C=r.next)||void 0===C||C.call(r,E),c.next(E)},()=>{var E;_=!1,null===(E=r.complete)||void 0===E||E.call(r),c.complete()},E=>{var C;_=!1,null===(C=r.error)||void 0===C||C.call(r,E),c.error(E)},()=>{var E,C;_&&(null===(E=r.unsubscribe)||void 0===E||E.call(r)),null===(C=r.finalize)||void 0===C||C.call(r)}))}):At}function Hd(e){return Mn((t,n)=>{let c,r=null,o=!1;r=t.subscribe(Rn(n,void 0,void 0,d=>{c=Go(e(d,Hd(e)(t))),r?(r.unsubscribe(),r=null,c.subscribe(n)):o=!0})),o&&(r.unsubscribe(),r=null,c.subscribe(n))})}function n3(e,t,n,r,o){return(c,d)=>{let _=n,E=t,C=0;c.subscribe(Rn(d,A=>{const R=C++;E=_?e(E,A,R):(_=!0,A),r&&d.next(E)},o&&(()=>{_&&d.next(E),d.complete()})))}}function kD(e,t){return Mn(n3(e,t,arguments.length>=2,!0))}function aE(e){return e<=0?()=>yn:Mn((t,n)=>{let r=[];t.subscribe(Rn(n,o=>{r.push(o),e<r.length&&r.shift()},()=>{for(const o of r)n.next(o);n.complete()},void 0,()=>{r=null}))})}function FD(e,t){const n=arguments.length>=2;return r=>r.pipe(e?$d((o,c)=>e(o,c,r)):At,aE(1),n?P1(t):ND(()=>new A1))}function uE(e){return Mn((t,n)=>{try{t.subscribe(n)}finally{n.add(e)}})}const Ri="primary",P_=Symbol("RouteTitle");class o3{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n[0]:n}return null}getAll(t){if(this.has(t)){const n=this.params[t];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function sm(e){return new o3(e)}function s3(e,t,n){const r=n.path.split("/");if(r.length>e.length||"full"===n.pathMatch&&(t.hasChildren()||r.length<e.length))return null;const o={};for(let c=0;c<r.length;c++){const d=r[c],_=e[c];if(d.startsWith(":"))o[d.substring(1)]=_;else if(d!==_.path)return null}return{consumed:e.slice(0,r.length),posParams:o}}function yf(e,t){const n=e?Object.keys(e):void 0,r=t?Object.keys(t):void 0;if(!n||!r||n.length!=r.length)return!1;let o;for(let c=0;c<n.length;c++)if(o=n[c],!zD(e[o],t[o]))return!1;return!0}function zD(e,t){if(Array.isArray(e)&&Array.isArray(t)){if(e.length!==t.length)return!1;const n=[...e].sort(),r=[...t].sort();return n.every((o,c)=>r[c]===o)}return e===t}function BD(e){return Array.prototype.concat.apply([],e)}function UD(e){return e.length>0?e[e.length-1]:null}function Zu(e,t){for(const n in e)e.hasOwnProperty(n)&&t(e[n],n)}function Xd(e){return xo(e)?e:Jo(e)?Di(Promise.resolve(e)):Yr(e)}const R1=!1,u3={exact:function GD(e,t,n){if(!Bp(e.segments,t.segments)||!L1(e.segments,t.segments,n)||e.numberOfChildren!==t.numberOfChildren)return!1;for(const r in t.children)if(!e.children[r]||!GD(e.children[r],t.children[r],n))return!1;return!0},subset:$D},VD={exact:function l3(e,t){return yf(e,t)},subset:function c3(e,t){return Object.keys(t).length<=Object.keys(e).length&&Object.keys(t).every(n=>zD(e[n],t[n]))},ignored:()=>!0};function jD(e,t,n){return u3[n.paths](e.root,t.root,n.matrixParams)&&VD[n.queryParams](e.queryParams,t.queryParams)&&!("exact"===n.fragment&&e.fragment!==t.fragment)}function $D(e,t,n){return qD(e,t,t.segments,n)}function qD(e,t,n,r){if(e.segments.length>n.length){const o=e.segments.slice(0,n.length);return!(!Bp(o,n)||t.hasChildren()||!L1(o,n,r))}if(e.segments.length===n.length){if(!Bp(e.segments,n)||!L1(e.segments,n,r))return!1;for(const o in t.children)if(!e.children[o]||!$D(e.children[o],t.children[o],r))return!1;return!0}{const o=n.slice(0,e.segments.length),c=n.slice(e.segments.length);return!!(Bp(e.segments,o)&&L1(e.segments,o,r)&&e.children[Ri])&&qD(e.children[Ri],t,c,r)}}function L1(e,t,n){return t.every((r,o)=>VD[n](e[o].parameters,r.parameters))}class zp{constructor(t=new ho([],{}),n={},r=null){this.root=t,this.queryParams=n,this.fragment=r}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sm(this.queryParams)),this._queryParamMap}toString(){return d3.serialize(this)}}class ho{constructor(t,n){this.segments=t,this.children=n,this.parent=null,Zu(n,(r,o)=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return O1(this)}}class R_{constructor(t,n){this.path=t,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=sm(this.parameters)),this._parameterMap}toString(){return ZD(this)}}function Bp(e,t){return e.length===t.length&&e.every((n,r)=>n.path===t[r].path)}let L_=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return new lE},providedIn:"root"}),e})();class lE{parse(t){const n=new b3(t);return new zp(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(t){const n=`/${O_(t.root,!0)}`,r=function m3(e){const t=Object.keys(e).map(n=>{const r=e[n];return Array.isArray(r)?r.map(o=>`${N1(n)}=${N1(o)}`).join("&"):`${N1(n)}=${N1(r)}`}).filter(n=>!!n);return t.length?`?${t.join("&")}`:""}(t.queryParams);return`${n}${r}${"string"==typeof t.fragment?`#${function p3(e){return encodeURI(e)}(t.fragment)}`:""}`}}const d3=new lE;function O1(e){return e.segments.map(t=>ZD(t)).join("/")}function O_(e,t){if(!e.hasChildren())return O1(e);if(t){const n=e.children[Ri]?O_(e.children[Ri],!1):"",r=[];return Zu(e.children,(o,c)=>{c!==Ri&&r.push(`${c}:${O_(o,!1)}`)}),r.length>0?`${n}(${r.join("//")})`:n}{const n=function f3(e,t){let n=[];return Zu(e.children,(r,o)=>{o===Ri&&(n=n.concat(t(r,o)))}),Zu(e.children,(r,o)=>{o!==Ri&&(n=n.concat(t(r,o)))}),n}(e,(r,o)=>o===Ri?[O_(e.children[Ri],!1)]:[`${o}:${O_(r,!1)}`]);return 1===Object.keys(e.children).length&&null!=e.children[Ri]?`${O1(e)}/${n[0]}`:`${O1(e)}/(${n.join("//")})`}}function HD(e){return encodeURIComponent(e).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function N1(e){return HD(e).replace(/%3B/gi,";")}function cE(e){return HD(e).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function k1(e){return decodeURIComponent(e)}function XD(e){return k1(e.replace(/\+/g,"%20"))}function ZD(e){return`${cE(e.path)}${function g3(e){return Object.keys(e).map(t=>`;${cE(t)}=${cE(e[t])}`).join("")}(e.parameters)}`}const y3=/^[^\/()?;=#]+/;function F1(e){const t=e.match(y3);return t?t[0]:""}const _3=/^[^=?&#]+/,x3=/^[^&#]+/;class b3{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new ho([],{}):new ho([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(t.length>0||Object.keys(n).length>0)&&(r[Ri]=new ho(t,n)),r}parseSegment(){const t=F1(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new xn(4009,R1);return this.capture(t),new R_(k1(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const n=F1(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const o=F1(this.remaining);o&&(r=o,this.capture(r))}t[k1(n)]=k1(r)}parseQueryParam(t){const n=function v3(e){const t=e.match(_3);return t?t[0]:""}(this.remaining);if(!n)return;this.capture(n);let r="";if(this.consumeOptional("=")){const d=function w3(e){const t=e.match(x3);return t?t[0]:""}(this.remaining);d&&(r=d,this.capture(r))}const o=XD(n),c=XD(r);if(t.hasOwnProperty(o)){let d=t[o];Array.isArray(d)||(d=[d],t[o]=d),d.push(c)}else t[o]=c}parseParens(t){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const r=F1(this.remaining),o=this.remaining[r.length];if("/"!==o&&")"!==o&&";"!==o)throw new xn(4010,R1);let c;r.indexOf(":")>-1?(c=r.slice(0,r.indexOf(":")),this.capture(c),this.capture(":")):t&&(c=Ri);const d=this.parseChildren();n[c]=1===Object.keys(d).length?d[Ri]:new ho([],d),this.consumeOptional("//")}return n}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new xn(4011,R1)}}function hE(e){return e.segments.length>0?new ho([],{[Ri]:e}):e}function z1(e){const t={};for(const r of Object.keys(e.children)){const c=z1(e.children[r]);(c.segments.length>0||c.hasChildren())&&(t[r]=c)}return function E3(e){if(1===e.numberOfChildren&&e.children[Ri]){const t=e.children[Ri];return new ho(e.segments.concat(t.segments),t.children)}return e}(new ho(e.segments,t))}function Up(e){return e instanceof zp}function I3(e,t,n,r,o){if(0===n.length)return am(t.root,t.root,t.root,r,o);const c=function KD(e){if("string"==typeof e[0]&&1===e.length&&"/"===e[0])return new YD(!0,0,e);let t=0,n=!1;const r=e.reduce((o,c,d)=>{if("object"==typeof c&&null!=c){if(c.outlets){const _={};return Zu(c.outlets,(E,C)=>{_[C]="string"==typeof E?E.split("/"):E}),[...o,{outlets:_}]}if(c.segmentPath)return[...o,c.segmentPath]}return"string"!=typeof c?[...o,c]:0===d?(c.split("/").forEach((_,E)=>{0==E&&"."===_||(0==E&&""===_?n=!0:".."===_?t++:""!=_&&o.push(_))}),o):[...o,c]},[]);return new YD(n,t,r)}(n);return c.toRoot()?am(t.root,t.root,new ho([],{}),r,o):function d(E){const C=function D3(e,t,n,r){if(e.isAbsolute)return new um(t.root,!0,0);if(-1===r)return new um(n,n===t.root,0);return function JD(e,t,n){let r=e,o=t,c=n;for(;c>o;){if(c-=o,r=r.parent,!r)throw new xn(4005,!1);o=r.segments.length}return new um(r,!1,o-c)}(n,r+(N_(e.commands[0])?0:1),e.numberOfDoubleDots)}(c,t,e.snapshot?._urlSegment,E),A=C.processChildren?F_(C.segmentGroup,C.index,c.commands):dE(C.segmentGroup,C.index,c.commands);return am(t.root,C.segmentGroup,A,r,o)}(e.snapshot?._lastPathIndex)}function N_(e){return"object"==typeof e&&null!=e&&!e.outlets&&!e.segmentPath}function k_(e){return"object"==typeof e&&null!=e&&e.outlets}function am(e,t,n,r,o){let d,c={};r&&Zu(r,(E,C)=>{c[C]=Array.isArray(E)?E.map(A=>`${A}`):`${E}`}),d=e===t?n:WD(e,t,n);const _=hE(z1(d));return new zp(_,c,o)}function WD(e,t,n){const r={};return Zu(e.children,(o,c)=>{r[c]=o===t?n:WD(o,t,n)}),new ho(e.segments,r)}class YD{constructor(t,n,r){if(this.isAbsolute=t,this.numberOfDoubleDots=n,this.commands=r,t&&r.length>0&&N_(r[0]))throw new xn(4003,!1);const o=r.find(k_);if(o&&o!==UD(r))throw new xn(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class um{constructor(t,n,r){this.segmentGroup=t,this.processChildren=n,this.index=r}}function dE(e,t,n){if(e||(e=new ho([],{})),0===e.segments.length&&e.hasChildren())return F_(e,t,n);const r=function A3(e,t,n){let r=0,o=t;const c={match:!1,pathIndex:0,commandIndex:0};for(;o<e.segments.length;){if(r>=n.length)return c;const d=e.segments[o],_=n[r];if(k_(_))break;const E=`${_}`,C=r<n.length-1?n[r+1]:null;if(o>0&&void 0===E)break;if(E&&C&&"object"==typeof C&&void 0===C.outlets){if(!eM(E,C,d))return c;r+=2}else{if(!eM(E,{},d))return c;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}(e,t,n),o=n.slice(r.commandIndex);if(r.match&&r.pathIndex<e.segments.length){const c=new ho(e.segments.slice(0,r.pathIndex),{});return c.children[Ri]=new ho(e.segments.slice(r.pathIndex),e.children),F_(c,0,o)}return r.match&&0===o.length?new ho(e.segments,{}):r.match&&!e.hasChildren()?pE(e,t,n):r.match?F_(e,0,o):pE(e,t,n)}function F_(e,t,n){if(0===n.length)return new ho(e.segments,{});{const r=function M3(e){return k_(e[0])?e[0].outlets:{[Ri]:e}}(n),o={};return Zu(r,(c,d)=>{"string"==typeof c&&(c=[c]),null!==c&&(o[d]=dE(e.children[d],t,c))}),Zu(e.children,(c,d)=>{void 0===r[d]&&(o[d]=c)}),new ho(e.segments,o)}}function pE(e,t,n){const r=e.segments.slice(0,t);let o=0;for(;o<n.length;){const c=n[o];if(k_(c)){const E=P3(c.outlets);return new ho(r,E)}if(0===o&&N_(n[0])){r.push(new R_(e.segments[t].path,QD(n[0]))),o++;continue}const d=k_(c)?c.outlets[Ri]:`${c}`,_=o<n.length-1?n[o+1]:null;d&&_&&N_(_)?(r.push(new R_(d,QD(_))),o+=2):(r.push(new R_(d,{})),o++)}return new ho(r,{})}function P3(e){const t={};return Zu(e,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(t[r]=pE(new ho([],{}),0,n))}),t}function QD(e){const t={};return Zu(e,(n,r)=>t[r]=`${n}`),t}function eM(e,t,n){return e==n.path&&yf(t,n.parameters)}class ed{constructor(t,n){this.id=t,this.url=n}}class gE extends ed{constructor(t,n,r="imperative",o=null){super(t,n),this.type=0,this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Vp extends ed{constructor(t,n,r){super(t,n),this.urlAfterRedirects=r,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class B1 extends ed{constructor(t,n,r,o){super(t,n),this.reason=r,this.code=o,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class tM extends ed{constructor(t,n,r,o){super(t,n),this.error=r,this.target=o,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class R3 extends ed{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class L3 extends ed{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class O3 extends ed{constructor(t,n,r,o,c){super(t,n),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=c,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class N3 extends ed{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class k3 extends ed{constructor(t,n,r,o){super(t,n),this.urlAfterRedirects=r,this.state=o,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class F3{constructor(t){this.route=t,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class z3{constructor(t){this.route=t,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class B3{constructor(t){this.snapshot=t,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class U3{constructor(t){this.snapshot=t,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class V3{constructor(t){this.snapshot=t,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class j3{constructor(t){this.snapshot=t,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class nM{constructor(t,n,r){this.routerEvent=t,this.position=n,this.anchor=r,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let $3=(()=>{class e{createUrlTree(n,r,o,c,d,_){return I3(n||r.root,o,c,d,_)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})(),q3=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(t){return $3.\u0275fac(t)},providedIn:"root"}),e})();class rM{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const n=this.pathFromRoot(t);return n.length>1?n[n.length-2]:null}children(t){const n=mE(t,this._root);return n?n.children.map(r=>r.value):[]}firstChild(t){const n=mE(t,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(t){const n=yE(t,this._root);return n.length<2?[]:n[n.length-2].children.map(o=>o.value).filter(o=>o!==t)}pathFromRoot(t){return yE(t,this._root).map(n=>n.value)}}function mE(e,t){if(e===t.value)return t;for(const n of t.children){const r=mE(e,n);if(r)return r}return null}function yE(e,t){if(e===t.value)return[t];for(const n of t.children){const r=yE(e,n);if(r.length)return r.unshift(t),r}return[]}class td{constructor(t,n){this.value=t,this.children=n}toString(){return`TreeNode(${this.value})`}}function lm(e){const t={};return e&&e.children.forEach(n=>t[n.value.outlet]=n),t}class iM extends rM{constructor(t,n){super(t),this.snapshot=n,_E(this,t)}toString(){return this.snapshot.toString()}}function oM(e,t){const n=function H3(e,t){const d=new U1([],{},{},"",{},Ri,t,null,e.root,-1,{});return new aM("",new td(d,[]))}(e,t),r=new Oh([new R_("",{})]),o=new Oh({}),c=new Oh({}),d=new Oh({}),_=new Oh(""),E=new cm(r,o,d,_,c,Ri,t,n.root);return E.snapshot=n.root,new iM(new td(E,[]),n)}class cm{constructor(t,n,r,o,c,d,_,E){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.title=this.data?.pipe(vn(C=>C[P_]))??Yr(void 0),this._futureSnapshot=E}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(vn(t=>sm(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(vn(t=>sm(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function sM(e,t="emptyOnly"){const n=e.pathFromRoot;let r=0;if("always"!==t)for(r=n.length-1;r>=1;){const o=n[r],c=n[r-1];if(o.routeConfig&&""===o.routeConfig.path)r--;else{if(c.component)break;r--}}return function X3(e){return e.reduce((t,n)=>({params:{...t.params,...n.params},data:{...t.data,...n.data},resolve:{...n.data,...t.resolve,...n.routeConfig?.data,...n._resolvedData}}),{params:{},data:{},resolve:{}})}(n.slice(r))}class U1{constructor(t,n,r,o,c,d,_,E,C,A,R){this.url=t,this.params=n,this.queryParams=r,this.fragment=o,this.data=c,this.outlet=d,this.component=_,this.routeConfig=E,this._urlSegment=C,this._lastPathIndex=A,this._resolve=R}get title(){return this.data?.[P_]}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=sm(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=sm(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(r=>r.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class aM extends rM{constructor(t,n){super(n),this.url=t,_E(this,n)}toString(){return uM(this._root)}}function _E(e,t){t.value._routerState=e,t.children.forEach(n=>_E(e,n))}function uM(e){const t=e.children.length>0?` { ${e.children.map(uM).join(", ")} } `:"";return`${e.value}${t}`}function vE(e){if(e.snapshot){const t=e.snapshot,n=e._futureSnapshot;e.snapshot=n,yf(t.queryParams,n.queryParams)||e.queryParams.next(n.queryParams),t.fragment!==n.fragment&&e.fragment.next(n.fragment),yf(t.params,n.params)||e.params.next(n.params),function a3(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(!yf(e[n],t[n]))return!1;return!0}(t.url,n.url)||e.url.next(n.url),yf(t.data,n.data)||e.data.next(n.data)}else e.snapshot=e._futureSnapshot,e.data.next(e._futureSnapshot.data)}function xE(e,t){const n=yf(e.params,t.params)&&function h3(e,t){return Bp(e,t)&&e.every((n,r)=>yf(n.parameters,t[r].parameters))}(e.url,t.url);return n&&!(!e.parent!=!t.parent)&&(!e.parent||xE(e.parent,t.parent))}function z_(e,t,n){if(n&&e.shouldReuseRoute(t.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=t.value;const o=function W3(e,t,n){return t.children.map(r=>{for(const o of n.children)if(e.shouldReuseRoute(r.value,o.value.snapshot))return z_(e,r,o);return z_(e,r)})}(e,t,n);return new td(r,o)}{if(e.shouldAttach(t.value)){const c=e.retrieve(t.value);if(null!==c){const d=c.route;return d.value._futureSnapshot=t.value,d.children=t.children.map(_=>z_(e,_)),d}}const r=function Y3(e){return new cm(new Oh(e.url),new Oh(e.params),new Oh(e.queryParams),new Oh(e.fragment),new Oh(e.data),e.outlet,e.component,e)}(t.value),o=t.children.map(c=>z_(e,c));return new td(r,o)}}const wE="ngNavigationCancelingError";function lM(e,t){const{redirectTo:n,navigationBehaviorOptions:r}=Up(t)?{redirectTo:t,navigationBehaviorOptions:void 0}:t,o=cM(!1,0,t);return o.url=n,o.navigationBehaviorOptions=r,o}function cM(e,t,n){const r=new Error("NavigationCancelingError: "+(e||""));return r[wE]=!0,r.cancellationCode=t,n&&(r.url=n),r}function hM(e){return fM(e)&&Up(e.url)}function fM(e){return e&&e[wE]}class K3{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new B_,this.attachRef=null}}let B_=(()=>{class e{constructor(){this.contexts=new Map}onChildOutletCreated(n,r){const o=this.getOrCreateContext(n);o.outlet=r,this.contexts.set(n,o)}onChildOutletDestroyed(n){const r=this.getContext(n);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){const n=this.contexts;return this.contexts=new Map,n}onOutletReAttached(n){this.contexts=n}getOrCreateContext(n){let r=this.getContext(n);return r||(r=new K3,this.contexts.set(n,r)),r}getContext(n){return this.contexts.get(n)||null}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const V1=!1;let bE=(()=>{class e{constructor(){this.activated=null,this._activatedRoute=null,this.name=Ri,this.activateEvents=new Ol,this.deactivateEvents=new Ol,this.attachEvents=new Ol,this.detachEvents=new Ol,this.parentContexts=rr(B_),this.location=rr(Ah),this.changeDetector=rr(Ib),this.environmentInjector=rr(Zc)}ngOnChanges(n){if(n.name){const{firstChange:r,previousValue:o}=n.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(n){return this.parentContexts.getContext(n)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const n=this.parentContexts.getContext(this.name);n?.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new xn(4012,V1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new xn(4012,V1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new xn(4012,V1);this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,r){this.activated=n,this._activatedRoute=r,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,r){if(this.isActivated)throw new xn(4013,V1);this._activatedRoute=n;const o=this.location,d=n.snapshot.component,_=this.parentContexts.getOrCreateContext(this.name).children,E=new J3(n,_,o.injector);if(r&&function Q3(e){return!!e.resolveComponentFactory}(r)){const C=r.resolveComponentFactory(d);this.activated=o.createComponent(C,o.length,E)}else this.activated=o.createComponent(d,{index:o.length,injector:E,environmentInjector:r??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275dir=vi({type:e,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Cs]}),e})();class J3{constructor(t,n,r){this.route=t,this.childContexts=n,this.parent=r}get(t,n){return t===cm?this.route:t===B_?this.childContexts:this.parent.get(t,n)}}let EE=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275cmp=_s({type:e,selectors:[["ng-component"]],standalone:!0,features:[CI],decls:1,vars:0,template:function(n,r){1&n&&lo(0,"router-outlet")},dependencies:[bE],encapsulation:2}),e})();function dM(e,t){return e.providers&&!e._injector&&(e._injector=s1(e.providers,t,`Route: ${e.path}`)),e._injector??t}function SE(e){const t=e.children&&e.children.map(SE),n=t?{...e,children:t}:{...e};return!n.component&&!n.loadComponent&&(t||n.loadChildren)&&n.outlet&&n.outlet!==Ri&&(n.component=EE),n}function sh(e){return e.outlet||Ri}function pM(e,t){const n=e.filter(r=>sh(r)===t);return n.push(...e.filter(r=>sh(r)!==t)),n}function U_(e){if(!e)return null;if(e.routeConfig?._injector)return e.routeConfig._injector;for(let t=e.parent;t;t=t.parent){const n=t.routeConfig;if(n?._loadedInjector)return n._loadedInjector;if(n?._injector)return n._injector}return null}class iz{constructor(t,n,r,o){this.routeReuseStrategy=t,this.futureState=n,this.currState=r,this.forwardEvent=o}activate(t){const n=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,r,t),vE(this.futureState.root),this.activateChildRoutes(n,r,t)}deactivateChildRoutes(t,n,r){const o=lm(n);t.children.forEach(c=>{const d=c.value.outlet;this.deactivateRoutes(c,o[d],r),delete o[d]}),Zu(o,(c,d)=>{this.deactivateRouteAndItsChildren(c,r)})}deactivateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(o===c)if(o.component){const d=r.getContext(o.outlet);d&&this.deactivateChildRoutes(t,n,d.children)}else this.deactivateChildRoutes(t,n,r);else c&&this.deactivateRouteAndItsChildren(n,r)}deactivateRouteAndItsChildren(t,n){t.value.component&&this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,n):this.deactivateRouteAndOutlet(t,n)}detachAndStoreRouteSubtree(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=lm(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);if(r&&r.outlet){const d=r.outlet.detach(),_=r.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:d,route:t,contexts:_})}}deactivateRouteAndOutlet(t,n){const r=n.getContext(t.value.outlet),o=r&&t.value.component?r.children:n,c=lm(t);for(const d of Object.keys(c))this.deactivateRouteAndItsChildren(c[d],o);r&&r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated(),r.attachRef=null,r.resolver=null,r.route=null)}activateChildRoutes(t,n,r){const o=lm(n);t.children.forEach(c=>{this.activateRoutes(c,o[c.value.outlet],r),this.forwardEvent(new j3(c.value.snapshot))}),t.children.length&&this.forwardEvent(new U3(t.value.snapshot))}activateRoutes(t,n,r){const o=t.value,c=n?n.value:null;if(vE(o),o===c)if(o.component){const d=r.getOrCreateContext(o.outlet);this.activateChildRoutes(t,n,d.children)}else this.activateChildRoutes(t,n,r);else if(o.component){const d=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){const _=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),d.children.onOutletReAttached(_.contexts),d.attachRef=_.componentRef,d.route=_.route.value,d.outlet&&d.outlet.attach(_.componentRef,_.route.value),vE(_.route.value),this.activateChildRoutes(t,null,d.children)}else{const _=U_(o.snapshot),E=_?.get(xp)??null;d.attachRef=null,d.route=o,d.resolver=E,d.injector=_,d.outlet&&d.outlet.activateWith(o,d.injector),this.activateChildRoutes(t,null,d.children)}}else this.activateChildRoutes(t,null,r)}}class gM{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class j1{constructor(t,n){this.component=t,this.route=n}}function oz(e,t,n){const r=e._root;return V_(r,t?t._root:null,n,[r.value])}function hm(e,t){const n=Symbol(),r=t.get(e,n);return r===n?"function"!=typeof e||function Su(e){return null!==Ca(e)}(e)?t.get(e):e:r}function V_(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=lm(t);return e.children.forEach(d=>{(function az(e,t,n,r,o={canDeactivateChecks:[],canActivateChecks:[]}){const c=e.value,d=t?t.value:null,_=n?n.getContext(e.value.outlet):null;if(d&&c.routeConfig===d.routeConfig){const E=function uz(e,t,n){if("function"==typeof n)return n(e,t);switch(n){case"pathParamsChange":return!Bp(e.url,t.url);case"pathParamsOrQueryParamsChange":return!Bp(e.url,t.url)||!yf(e.queryParams,t.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!xE(e,t)||!yf(e.queryParams,t.queryParams);default:return!xE(e,t)}}(d,c,c.routeConfig.runGuardsAndResolvers);E?o.canActivateChecks.push(new gM(r)):(c.data=d.data,c._resolvedData=d._resolvedData),V_(e,t,c.component?_?_.children:null:n,r,o),E&&_&&_.outlet&&_.outlet.isActivated&&o.canDeactivateChecks.push(new j1(_.outlet.component,d))}else d&&j_(t,_,o),o.canActivateChecks.push(new gM(r)),V_(e,null,c.component?_?_.children:null:n,r,o)})(d,c[d.value.outlet],n,r.concat([d.value]),o),delete c[d.value.outlet]}),Zu(c,(d,_)=>j_(d,n.getContext(_),o)),o}function j_(e,t,n){const r=lm(e),o=e.value;Zu(r,(c,d)=>{j_(c,o.component?t?t.children.getContext(d):null:t,n)}),n.canDeactivateChecks.push(new j1(o.component&&t&&t.outlet&&t.outlet.isActivated?t.outlet.component:null,o))}function G_(e){return"function"==typeof e}function IE(e){return e instanceof A1||"EmptyError"===e?.name}const G1=Symbol("INITIAL_VALUE");function fm(){return mf(e=>PD(e.map(t=>t.pipe(A_(1),function e3(...e){const t=nr(e);return Mn((n,r)=>{(t?oE(e,n,t):oE(e,n)).subscribe(r)})}(G1)))).pipe(vn(t=>{for(const n of t)if(!0!==n){if(n===G1)return G1;if(!1===n||n instanceof zp)return n}return!0}),$d(t=>t!==G1),A_(1)))}function mM(e){return function Pe(...e){return ct(e)}(hl(t=>{if(Up(t))throw lM(0,t)}),vn(t=>!0===t))}const TE={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function yM(e,t,n,r,o){const c=DE(e,t,n);return c.matched?function Sz(e,t,n,r){const o=t.canMatch;return o&&0!==o.length?Yr(o.map(d=>{const _=hm(d,e);return Xd(function pz(e){return e&&G_(e.canMatch)}(_)?_.canMatch(t,n):e.runInContext(()=>_(t,n)))})).pipe(fm(),mM()):Yr(!0)}(r=dM(t,r),t,n).pipe(vn(d=>!0===d?c:{...TE})):Yr(c)}function DE(e,t,n){if(""===t.path)return"full"===t.pathMatch&&(e.hasChildren()||n.length>0)?{...TE}:{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const o=(t.matcher||s3)(n,e,t);if(!o)return{...TE};const c={};Zu(o.posParams,(_,E)=>{c[E]=_.path});const d=o.consumed.length>0?{...c,...o.consumed[o.consumed.length-1].parameters}:c;return{matched:!0,consumedSegments:o.consumed,remainingSegments:n.slice(o.consumed.length),parameters:d,positionalParamSegments:o.posParams??{}}}function $1(e,t,n,r){if(n.length>0&&function Dz(e,t,n){return n.some(r=>q1(e,t,r)&&sh(r)!==Ri)}(e,n,r)){const c=new ho(t,function Tz(e,t,n,r){const o={};o[Ri]=r,r._sourceSegment=e,r._segmentIndexShift=t.length;for(const c of n)if(""===c.path&&sh(c)!==Ri){const d=new ho([],{});d._sourceSegment=e,d._segmentIndexShift=t.length,o[sh(c)]=d}return o}(e,t,r,new ho(n,e.children)));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:[]}}if(0===n.length&&function Mz(e,t,n){return n.some(r=>q1(e,t,r))}(e,n,r)){const c=new ho(e.segments,function Iz(e,t,n,r,o){const c={};for(const d of r)if(q1(e,n,d)&&!o[sh(d)]){const _=new ho([],{});_._sourceSegment=e,_._segmentIndexShift=t.length,c[sh(d)]=_}return{...o,...c}}(e,t,n,r,e.children));return c._sourceSegment=e,c._segmentIndexShift=t.length,{segmentGroup:c,slicedSegments:n}}const o=new ho(e.segments,e.children);return o._sourceSegment=e,o._segmentIndexShift=t.length,{segmentGroup:o,slicedSegments:n}}function q1(e,t,n){return(!(e.hasChildren()||t.length>0)||"full"!==n.pathMatch)&&""===n.path}function _M(e,t,n,r){return!!(sh(e)===r||r!==Ri&&q1(t,n,e))&&("**"===e.path||DE(t,e,n).matched)}function vM(e,t,n){return 0===t.length&&!e.children[n]}const H1=!1;class X1{constructor(t){this.segmentGroup=t||null}}class xM{constructor(t){this.urlTree=t}}function $_(e){return M_(new X1(e))}function wM(e){return M_(new xM(e))}class Lz{constructor(t,n,r,o,c){this.injector=t,this.configLoader=n,this.urlSerializer=r,this.urlTree=o,this.config=c,this.allowRedirects=!0}apply(){const t=$1(this.urlTree.root,[],[],this.config).segmentGroup,n=new ho(t.segments,t.children);return this.expandSegmentGroup(this.injector,this.config,n,Ri).pipe(vn(c=>this.createUrlTree(z1(c),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Hd(c=>{if(c instanceof xM)return this.allowRedirects=!1,this.match(c.urlTree);throw c instanceof X1?this.noMatchError(c):c}))}match(t){return this.expandSegmentGroup(this.injector,this.config,t.root,Ri).pipe(vn(o=>this.createUrlTree(z1(o),t.queryParams,t.fragment))).pipe(Hd(o=>{throw o instanceof X1?this.noMatchError(o):o}))}noMatchError(t){return new xn(4002,H1)}createUrlTree(t,n,r){const o=hE(t);return new zp(o,n,r)}expandSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.expandChildren(t,n,r).pipe(vn(c=>new ho([],c))):this.expandSegment(t,r,n,r.segments,o,!0)}expandChildren(t,n,r){const o=[];for(const c of Object.keys(r.children))"primary"===c?o.unshift(c):o.push(c);return Di(o).pipe(Fp(c=>{const d=r.children[c],_=pM(n,c);return this.expandSegmentGroup(t,_,d,c).pipe(vn(E=>({segment:E,outlet:c})))}),kD((c,d)=>(c[d.outlet]=d.segment,c),{}),FD())}expandSegment(t,n,r,o,c,d){return Di(r).pipe(Fp(_=>this.expandSegmentAgainstRoute(t,n,r,_,o,c,d).pipe(Hd(C=>{if(C instanceof X1)return Yr(null);throw C}))),qd(_=>!!_),Hd((_,E)=>{if(IE(_))return vM(n,o,c)?Yr(new ho([],{})):$_(n);throw _}))}expandSegmentAgainstRoute(t,n,r,o,c,d,_){return _M(o,n,c,d)?void 0===o.redirectTo?this.matchSegmentAgainstRoute(t,n,o,c,d):_&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d):$_(n):$_(n)}expandSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){return"**"===o.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,r,o,d):this.expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o){const c=this.applyRedirectCommands([],r.redirectTo,{});return r.redirectTo.startsWith("/")?wM(c):this.lineralizeSegments(r,c).pipe(st(d=>{const _=new ho(d,{});return this.expandSegment(t,_,n,d,o,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,n,r,o,c,d){const{matched:_,consumedSegments:E,remainingSegments:C,positionalParamSegments:A}=DE(n,o,c);if(!_)return $_(n);const R=this.applyRedirectCommands(E,o.redirectTo,A);return o.redirectTo.startsWith("/")?wM(R):this.lineralizeSegments(o,R).pipe(st(N=>this.expandSegment(t,n,r,N.concat(C),d,!1)))}matchSegmentAgainstRoute(t,n,r,o,c){return"**"===r.path?(t=dM(r,t),r.loadChildren?(r._loadedRoutes?Yr({routes:r._loadedRoutes,injector:r._loadedInjector}):this.configLoader.loadChildren(t,r)).pipe(vn(_=>(r._loadedRoutes=_.routes,r._loadedInjector=_.injector,new ho(o,{})))):Yr(new ho(o,{}))):yM(n,r,o,t).pipe(mf(({matched:d,consumedSegments:_,remainingSegments:E})=>d?this.getChildConfig(t=r._injector??t,r,o).pipe(st(A=>{const R=A.injector??t,N=A.routes,{segmentGroup:z,slicedSegments:Q}=$1(n,_,E,N),ee=new ho(z.segments,z.children);if(0===Q.length&&ee.hasChildren())return this.expandChildren(R,N,ee).pipe(vn(oe=>new ho(_,oe)));if(0===N.length&&0===Q.length)return Yr(new ho(_,{}));const Te=sh(r)===c;return this.expandSegment(R,ee,N,Q,Te?Ri:c,!0).pipe(vn(ie=>new ho(_.concat(ie.segments),ie.children)))})):$_(n)))}getChildConfig(t,n,r){return n.children?Yr({routes:n.children,injector:t}):n.loadChildren?void 0!==n._loadedRoutes?Yr({routes:n._loadedRoutes,injector:n._loadedInjector}):function Cz(e,t,n,r){const o=t.canLoad;return void 0===o||0===o.length?Yr(!0):Yr(o.map(d=>{const _=hm(d,e);return Xd(function cz(e){return e&&G_(e.canLoad)}(_)?_.canLoad(t,n):e.runInContext(()=>_(t,n)))})).pipe(fm(),mM())}(t,n,r).pipe(st(o=>o?this.configLoader.loadChildren(t,n).pipe(hl(c=>{n._loadedRoutes=c.routes,n._loadedInjector=c.injector})):function Pz(e){return M_(cM(H1,3))}())):Yr({routes:[],injector:t})}lineralizeSegments(t,n){let r=[],o=n.root;for(;;){if(r=r.concat(o.segments),0===o.numberOfChildren)return Yr(r);if(o.numberOfChildren>1||!o.children[Ri])return M_(new xn(4e3,H1));o=o.children[Ri]}}applyRedirectCommands(t,n,r){return this.applyRedirectCreateUrlTree(n,this.urlSerializer.parse(n),t,r)}applyRedirectCreateUrlTree(t,n,r,o){const c=this.createSegmentGroup(t,n.root,r,o);return new zp(c,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(t,n){const r={};return Zu(t,(o,c)=>{if("string"==typeof o&&o.startsWith(":")){const _=o.substring(1);r[c]=n[_]}else r[c]=o}),r}createSegmentGroup(t,n,r,o){const c=this.createSegments(t,n.segments,r,o);let d={};return Zu(n.children,(_,E)=>{d[E]=this.createSegmentGroup(t,_,r,o)}),new ho(c,d)}createSegments(t,n,r,o){return n.map(c=>c.path.startsWith(":")?this.findPosParam(t,c,o):this.findOrReturn(c,r))}findPosParam(t,n,r){const o=r[n.path.substring(1)];if(!o)throw new xn(4001,H1);return o}findOrReturn(t,n){let r=0;for(const o of n){if(o.path===t.path)return n.splice(r),o;r++}return t}}class Nz{}class zz{constructor(t,n,r,o,c,d,_){this.injector=t,this.rootComponentType=n,this.config=r,this.urlTree=o,this.url=c,this.paramsInheritanceStrategy=d,this.urlSerializer=_}recognize(){const t=$1(this.urlTree.root,[],[],this.config.filter(n=>void 0===n.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,t,Ri).pipe(vn(n=>{if(null===n)return null;const r=new U1([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Ri,this.rootComponentType,null,this.urlTree.root,-1,{}),o=new td(r,n),c=new aM(this.url,o);return this.inheritParamsAndData(c._root),c}))}inheritParamsAndData(t){const n=t.value,r=sM(n,this.paramsInheritanceStrategy);n.params=Object.freeze(r.params),n.data=Object.freeze(r.data),t.children.forEach(o=>this.inheritParamsAndData(o))}processSegmentGroup(t,n,r,o){return 0===r.segments.length&&r.hasChildren()?this.processChildren(t,n,r):this.processSegment(t,n,r,r.segments,o)}processChildren(t,n,r){return Di(Object.keys(r.children)).pipe(Fp(o=>{const c=r.children[o],d=pM(n,o);return this.processSegmentGroup(t,d,c,o)}),kD((o,c)=>o&&c?(o.push(...c),o):null),function r3(e,t=!1){return Mn((n,r)=>{let o=0;n.subscribe(Rn(r,c=>{const d=e(c,o++);(d||t)&&r.next(c),!d&&r.complete()}))})}(o=>null!==o),P1(null),FD(),vn(o=>{if(null===o)return null;const c=EM(o);return function Bz(e){e.sort((t,n)=>t.value.outlet===Ri?-1:n.value.outlet===Ri?1:t.value.outlet.localeCompare(n.value.outlet))}(c),c}))}processSegment(t,n,r,o,c){return Di(n).pipe(Fp(d=>this.processSegmentAgainstRoute(d._injector??t,d,r,o,c)),qd(d=>!!d),Hd(d=>{if(IE(d))return vM(r,o,c)?Yr([]):Yr(null);throw d}))}processSegmentAgainstRoute(t,n,r,o,c){if(n.redirectTo||!_M(n,r,o,c))return Yr(null);let d;if("**"===n.path){const _=o.length>0?UD(o).parameters:{},E=SM(r)+o.length;d=Yr({snapshot:new U1(o,_,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,IM(n),sh(n),n.component??n._loadedComponent??null,n,CM(r),E,TM(n)),consumedSegments:[],remainingSegments:[]})}else d=yM(r,n,o,t).pipe(vn(({matched:_,consumedSegments:E,remainingSegments:C,parameters:A})=>{if(!_)return null;const R=SM(r)+E.length;return{snapshot:new U1(E,A,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,IM(n),sh(n),n.component??n._loadedComponent??null,n,CM(r),R,TM(n)),consumedSegments:E,remainingSegments:C}}));return d.pipe(mf(_=>{if(null===_)return Yr(null);const{snapshot:E,consumedSegments:C,remainingSegments:A}=_;t=n._injector??t;const R=n._loadedInjector??t,N=function Uz(e){return e.children?e.children:e.loadChildren?e._loadedRoutes:[]}(n),{segmentGroup:z,slicedSegments:Q}=$1(r,C,A,N.filter(Te=>void 0===Te.redirectTo));if(0===Q.length&&z.hasChildren())return this.processChildren(R,N,z).pipe(vn(Te=>null===Te?null:[new td(E,Te)]));if(0===N.length&&0===Q.length)return Yr([new td(E,[])]);const ee=sh(n)===c;return this.processSegment(R,N,z,Q,ee?Ri:c).pipe(vn(Te=>null===Te?null:[new td(E,Te)]))}))}}function Vz(e){const t=e.value.routeConfig;return t&&""===t.path&&void 0===t.redirectTo}function EM(e){const t=[],n=new Set;for(const r of e){if(!Vz(r)){t.push(r);continue}const o=t.find(c=>r.value.routeConfig===c.value.routeConfig);void 0!==o?(o.children.push(...r.children),n.add(o)):t.push(r)}for(const r of n){const o=EM(r.children);t.push(new td(r.value,o))}return t.filter(r=>!n.has(r))}function CM(e){let t=e;for(;t._sourceSegment;)t=t._sourceSegment;return t}function SM(e){let t=e,n=t._segmentIndexShift??0;for(;t._sourceSegment;)t=t._sourceSegment,n+=t._segmentIndexShift??0;return n-1}function IM(e){return e.data||{}}function TM(e){return e.resolve||{}}function DM(e){return"string"==typeof e.title||null===e.title}function ME(e){return mf(t=>{const n=e(t);return n?Di(n).pipe(vn(()=>t)):Yr(t)})}const dm=new Xr("ROUTES");let AE=(()=>{class e{constructor(n,r){this.injector=n,this.compiler=r,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(n){if(this.componentLoaders.get(n))return this.componentLoaders.get(n);if(n._loadedComponent)return Yr(n._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(n);const r=Xd(n.loadComponent()).pipe(vn(AM),hl(c=>{this.onLoadEndListener&&this.onLoadEndListener(n),n._loadedComponent=c}),uE(()=>{this.componentLoaders.delete(n)})),o=new OD(r,()=>new Nt).pipe(sE());return this.componentLoaders.set(n,o),o}loadChildren(n,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Yr({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);const c=this.loadModuleFactoryOrRoutes(r.loadChildren).pipe(vn(_=>{this.onLoadEndListener&&this.onLoadEndListener(r);let E,C,A=!1;Array.isArray(_)?C=_:(E=_.create(n).injector,C=BD(E.get(dm,[],wr.Self|wr.Optional)));return{routes:C.map(SE),injector:E}}),uE(()=>{this.childrenLoaders.delete(r)})),d=new OD(c,()=>new Nt).pipe(sE());return this.childrenLoaders.set(r,d),d}loadModuleFactoryOrRoutes(n){return Xd(n()).pipe(vn(AM),st(o=>o instanceof bI||Array.isArray(o)?Yr(o):Di(this.compiler.compileModuleAsync(o))))}}return e.\u0275fac=function(n){return new(n||e)(Pn(Yc),Pn(dT))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function AM(e){return function Yz(e){return e&&"object"==typeof e&&"default"in e}(e)?e.default:e}let PE=(()=>{class e{constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Nt,this.configLoader=rr(AE),this.environmentInjector=rr(Zc),this.urlSerializer=rr(L_),this.rootContexts=rr(B_),this.navigationId=0,this.configLoader.onLoadEndListener=o=>this.events.next(new z3(o)),this.configLoader.onLoadStartListener=o=>this.events.next(new F3(o))}get hasRequestedNavigation(){return 0!==this.navigationId}complete(){this.transitions?.complete()}handleNavigationRequest(n){const r=++this.navigationId;this.transitions?.next({...this.transitions.value,...n,id:r})}setupNavigations(n){return this.transitions=new Oh({id:0,targetPageId:0,currentUrlTree:n.currentUrlTree,currentRawUrl:n.currentUrlTree,extractedUrl:n.urlHandlingStrategy.extract(n.currentUrlTree),urlAfterRedirects:n.urlHandlingStrategy.extract(n.currentUrlTree),rawUrl:n.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:n.routerState.snapshot,targetSnapshot:null,currentRouterState:n.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe($d(r=>0!==r.id),vn(r=>({...r,extractedUrl:n.urlHandlingStrategy.extract(r.rawUrl)})),mf(r=>{let o=!1,c=!1;return Yr(r).pipe(hl(d=>{this.currentNavigation={id:d.id,initialUrl:d.rawUrl,extractedUrl:d.extractedUrl,trigger:d.source,extras:d.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),mf(d=>{const _=n.browserUrlTree.toString(),E=!n.navigated||d.extractedUrl.toString()!==_||_!==n.currentUrlTree.toString();if(("reload"===n.onSameUrlNavigation||E)&&n.urlHandlingStrategy.shouldProcessUrl(d.rawUrl))return RM(d.source)&&(n.browserUrlTree=d.extractedUrl),Yr(d).pipe(mf(A=>{const R=this.transitions?.getValue();return this.events.next(new gE(A.id,this.urlSerializer.serialize(A.extractedUrl),A.source,A.restoredState)),R!==this.transitions?.getValue()?yn:Promise.resolve(A)}),function Oz(e,t,n,r){return mf(o=>function Rz(e,t,n,r,o){return new Lz(e,t,n,r,o).apply()}(e,t,n,o.extractedUrl,r).pipe(vn(c=>({...o,urlAfterRedirects:c}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,n.config),hl(A=>{this.currentNavigation={...this.currentNavigation,finalUrl:A.urlAfterRedirects},r.urlAfterRedirects=A.urlAfterRedirects}),function Gz(e,t,n,r,o){return st(c=>function Fz(e,t,n,r,o,c,d="emptyOnly"){return new zz(e,t,n,r,o,d,c).recognize().pipe(mf(_=>null===_?function kz(e){return new Me(t=>t.error(e))}(new Nz):Yr(_)))}(e,t,n,c.urlAfterRedirects,r.serialize(c.urlAfterRedirects),r,o).pipe(vn(d=>({...c,targetSnapshot:d}))))}(this.environmentInjector,n.rootComponentType,n.config,this.urlSerializer,n.paramsInheritanceStrategy),hl(A=>{if(r.targetSnapshot=A.targetSnapshot,"eager"===n.urlUpdateStrategy){if(!A.extras.skipLocationChange){const N=n.urlHandlingStrategy.merge(A.urlAfterRedirects,A.rawUrl);n.setBrowserUrl(N,A)}n.browserUrlTree=A.urlAfterRedirects}const R=new R3(A.id,this.urlSerializer.serialize(A.extractedUrl),this.urlSerializer.serialize(A.urlAfterRedirects),A.targetSnapshot);this.events.next(R)}));if(E&&n.rawUrlTree&&n.urlHandlingStrategy.shouldProcessUrl(n.rawUrlTree)){const{id:R,extractedUrl:N,source:z,restoredState:Q,extras:ee}=d,Te=new gE(R,this.urlSerializer.serialize(N),z,Q);this.events.next(Te);const me=oM(N,n.rootComponentType).snapshot;return Yr(r={...d,targetSnapshot:me,urlAfterRedirects:N,extras:{...ee,skipLocationChange:!1,replaceUrl:!1}})}return n.rawUrlTree=d.rawUrl,d.resolve(null),yn}),hl(d=>{const _=new L3(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(_)}),vn(d=>r={...d,guards:oz(d.targetSnapshot,d.currentSnapshot,this.rootContexts)}),function mz(e,t){return st(n=>{const{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:c,canDeactivateChecks:d}}=n;return 0===d.length&&0===c.length?Yr({...n,guardsResult:!0}):function yz(e,t,n,r){return Di(e).pipe(st(o=>function Ez(e,t,n,r,o){const c=t&&t.routeConfig?t.routeConfig.canDeactivate:null;return c&&0!==c.length?Yr(c.map(_=>{const E=U_(t)??o,C=hm(_,E);return Xd(function dz(e){return e&&G_(e.canDeactivate)}(C)?C.canDeactivate(e,t,n,r):E.runInContext(()=>C(e,t,n,r))).pipe(qd())})).pipe(fm()):Yr(!0)}(o.component,o.route,n,t,r)),qd(o=>!0!==o,!0))}(d,r,o,e).pipe(st(_=>_&&function lz(e){return"boolean"==typeof e}(_)?function _z(e,t,n,r){return Di(t).pipe(Fp(o=>oE(function xz(e,t){return null!==e&&t&&t(new B3(e)),Yr(!0)}(o.route.parent,r),function vz(e,t){return null!==e&&t&&t(new V3(e)),Yr(!0)}(o.route,r),function bz(e,t,n){const r=t[t.length-1],c=t.slice(0,t.length-1).reverse().map(d=>function sz(e){const t=e.routeConfig?e.routeConfig.canActivateChild:null;return t&&0!==t.length?{node:e,guards:t}:null}(d)).filter(d=>null!==d).map(d=>LD(()=>Yr(d.guards.map(E=>{const C=U_(d.node)??n,A=hm(E,C);return Xd(function fz(e){return e&&G_(e.canActivateChild)}(A)?A.canActivateChild(r,e):C.runInContext(()=>A(r,e))).pipe(qd())})).pipe(fm())));return Yr(c).pipe(fm())}(e,o.path,n),function wz(e,t,n){const r=t.routeConfig?t.routeConfig.canActivate:null;if(!r||0===r.length)return Yr(!0);const o=r.map(c=>LD(()=>{const d=U_(t)??n,_=hm(c,d);return Xd(function hz(e){return e&&G_(e.canActivate)}(_)?_.canActivate(t,e):d.runInContext(()=>_(t,e))).pipe(qd())}));return Yr(o).pipe(fm())}(e,o.route,n))),qd(o=>!0!==o,!0))}(r,c,e,t):Yr(_)),vn(_=>({...n,guardsResult:_})))})}(this.environmentInjector,d=>this.events.next(d)),hl(d=>{if(r.guardsResult=d.guardsResult,Up(d.guardsResult))throw lM(0,d.guardsResult);const _=new O3(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot,!!d.guardsResult);this.events.next(_)}),$d(d=>!!d.guardsResult||(n.restoreHistory(d),this.cancelNavigationTransition(d,"",3,n),!1)),ME(d=>{if(d.guards.canActivateChecks.length)return Yr(d).pipe(hl(_=>{const E=new N3(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}),mf(_=>{let E=!1;return Yr(_).pipe(function $z(e,t){return st(n=>{const{targetSnapshot:r,guards:{canActivateChecks:o}}=n;if(!o.length)return Yr(n);let c=0;return Di(o).pipe(Fp(d=>function qz(e,t,n,r){const o=e.routeConfig,c=e._resolve;return void 0!==o?.title&&!DM(o)&&(c[P_]=o.title),function Hz(e,t,n,r){const o=function Xz(e){return[...Object.keys(e),...Object.getOwnPropertySymbols(e)]}(e);if(0===o.length)return Yr({});const c={};return Di(o).pipe(st(d=>function Zz(e,t,n,r){const o=U_(t)??r,c=hm(e,o);return Xd(c.resolve?c.resolve(t,n):o.runInContext(()=>c(t,n)))}(e[d],t,n,r).pipe(qd(),hl(_=>{c[d]=_}))),aE(1),function i3(e){return vn(()=>e)}(c),Hd(d=>IE(d)?yn:M_(d)))}(c,e,t,r).pipe(vn(d=>(e._resolvedData=d,e.data=sM(e,n).resolve,o&&DM(o)&&(e.data[P_]=o.title),null)))}(d.route,r,e,t)),hl(()=>c++),aE(1),st(d=>c===o.length?Yr(n):yn))})}(n.paramsInheritanceStrategy,this.environmentInjector),hl({next:()=>E=!0,complete:()=>{E||(n.restoreHistory(_),this.cancelNavigationTransition(_,"",2,n))}}))}),hl(_=>{const E=new k3(_.id,this.urlSerializer.serialize(_.extractedUrl),this.urlSerializer.serialize(_.urlAfterRedirects),_.targetSnapshot);this.events.next(E)}))}),ME(d=>{const _=E=>{const C=[];E.routeConfig?.loadComponent&&!E.routeConfig._loadedComponent&&C.push(this.configLoader.loadComponent(E.routeConfig).pipe(hl(A=>{E.component=A}),vn(()=>{})));for(const A of E.children)C.push(..._(A));return C};return PD(_(d.targetSnapshot.root)).pipe(P1(),A_(1))}),ME(()=>n.afterPreactivation()),vn(d=>{const _=function Z3(e,t,n){const r=z_(e,t._root,n?n._root:void 0);return new iM(r,t)}(n.routeReuseStrategy,d.targetSnapshot,d.currentRouterState);return r={...d,targetRouterState:_}}),hl(d=>{n.currentUrlTree=d.urlAfterRedirects,n.rawUrlTree=n.urlHandlingStrategy.merge(d.urlAfterRedirects,d.rawUrl),n.routerState=d.targetRouterState,"deferred"===n.urlUpdateStrategy&&(d.extras.skipLocationChange||n.setBrowserUrl(n.rawUrlTree,d),n.browserUrlTree=d.urlAfterRedirects)}),((e,t,n)=>vn(r=>(new iz(t,r.targetRouterState,r.currentRouterState,n).activate(e),r)))(this.rootContexts,n.routeReuseStrategy,d=>this.events.next(d)),hl({next:d=>{o=!0,this.lastSuccessfulNavigation=this.currentNavigation,n.navigated=!0,this.events.next(new Vp(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(n.currentUrlTree))),n.titleStrategy?.updateTitle(d.targetRouterState.snapshot),d.resolve(!0)},complete:()=>{o=!0}}),uE(()=>{o||c||this.cancelNavigationTransition(r,"",1,n),this.currentNavigation?.id===r.id&&(this.currentNavigation=null)}),Hd(d=>{if(c=!0,fM(d)){hM(d)||(n.navigated=!0,n.restoreHistory(r,!0));const _=new B1(r.id,this.urlSerializer.serialize(r.extractedUrl),d.message,d.cancellationCode);if(this.events.next(_),hM(d)){const E=n.urlHandlingStrategy.merge(d.url,n.rawUrlTree),C={skipLocationChange:r.extras.skipLocationChange,replaceUrl:"eager"===n.urlUpdateStrategy||RM(r.source)};n.scheduleNavigation(E,"imperative",null,C,{resolve:r.resolve,reject:r.reject,promise:r.promise})}else r.resolve(!1)}else{n.restoreHistory(r,!0);const _=new tM(r.id,this.urlSerializer.serialize(r.extractedUrl),d,r.targetSnapshot??void 0);this.events.next(_);try{r.resolve(n.errorHandler(d))}catch(E){r.reject(E)}}return yn}))}))}cancelNavigationTransition(n,r,o,c){const d=new B1(n.id,this.urlSerializer.serialize(n.extractedUrl),r,o);this.events.next(d),n.resolve(!1)}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function RM(e){return"imperative"!==e}let LM=(()=>{class e{buildTitle(n){let r,o=n.root;for(;void 0!==o;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(c=>c.outlet===Ri);return r}getResolvedTitleForRoute(n){return n.data[P_]}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return rr(Kz)},providedIn:"root"}),e})(),Kz=(()=>{class e extends LM{constructor(n){super(),this.title=n}updateTitle(n){const r=this.buildTitle(n);void 0!==r&&this.title.setTitle(r)}}return e.\u0275fac=function(n){return new(n||e)(Pn(DD))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})(),Jz=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return rr(eB)},providedIn:"root"}),e})();class Qz{shouldDetach(t){return!1}store(t,n){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,n){return t.routeConfig===n.routeConfig}}let eB=(()=>{class e extends Qz{}return e.\u0275fac=function(){let t;return function(r){return(t||(t=function Lm(e){return Xa(()=>{const t=e.prototype.constructor,n=t[zu]||Zp(t),r=Object.prototype;let o=Object.getPrototypeOf(e.prototype).constructor;for(;o&&o!==r;){const c=o[zu]||Zp(o);if(c&&c!==n)return c;o=Object.getPrototypeOf(o)}return c=>new c})}(e)))(r||e)}}(),e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const Z1=new Xr("",{providedIn:"root",factory:()=>({})});let nB=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:function(){return rr(rB)},providedIn:"root"}),e})(),rB=(()=>{class e{shouldProcessUrl(n){return!0}extract(n){return n}merge(n,r){return n}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();function iB(e){throw e}function oB(e,t,n){return t.parse("/")}const sB={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},aB={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Nc=(()=>{class e{constructor(){this.disposed=!1,this.currentPageId=0,this.console=rr(bO),this.isNgZoneEnabled=!1,this.options=rr(Z1,{optional:!0})||{},this.errorHandler=this.options.errorHandler||iB,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||oB,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>Yr(void 0),this.urlHandlingStrategy=rr(nB),this.routeReuseStrategy=rr(Jz),this.urlCreationStrategy=rr(q3),this.titleStrategy=rr(LM),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=BD(rr(dm,{optional:!0})??[]),this.navigationTransitions=rr(PE),this.urlSerializer=rr(L_),this.location=rr(Nb),this.rootComponentType=null,this.isNgZoneEnabled=rr(ru)instanceof ru&&ru.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new zp,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=oM(this.currentUrlTree,this.rootComponentType),this.navigationTransitions.setupNavigations(this).subscribe(n=>{this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const r="popstate"===n.type?"popstate":"hashchange";"popstate"===r&&setTimeout(()=>{const o={replaceUrl:!0},c=n.state?.navigationId?n.state:null;if(n.state){const _={...n.state};delete _.navigationId,delete _.\u0275routerPageId,0!==Object.keys(_).length&&(o.state=_)}const d=this.parseUrl(n.url);this.scheduleNavigation(d,r,c,o)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(n){this.config=n.map(SE),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,r={}){const{relativeTo:o,queryParams:c,fragment:d,queryParamsHandling:_,preserveFragment:E}=r,C=E?this.currentUrlTree.fragment:d;let A=null;switch(_){case"merge":A={...this.currentUrlTree.queryParams,...c};break;case"preserve":A=this.currentUrlTree.queryParams;break;default:A=c||null}return null!==A&&(A=this.removeEmptyProps(A)),this.urlCreationStrategy.createUrlTree(o,this.routerState,this.currentUrlTree,n,A,C??null)}navigateByUrl(n,r={skipLocationChange:!1}){const o=Up(n)?n:this.parseUrl(n),c=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(c,"imperative",null,r)}navigate(n,r={skipLocationChange:!1}){return function uB(e){for(let t=0;t<e.length;t++){if(null==e[t])throw new xn(4008,!1)}}(n),this.navigateByUrl(this.createUrlTree(n,r),r)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let r;try{r=this.urlSerializer.parse(n)}catch(o){r=this.malformedUriErrorHandler(o,this.urlSerializer,n)}return r}isActive(n,r){let o;if(o=!0===r?{...sB}:!1===r?{...aB}:r,Up(n))return jD(this.currentUrlTree,n,o);const c=this.parseUrl(n);return jD(this.currentUrlTree,c,o)}removeEmptyProps(n){return Object.keys(n).reduce((r,o)=>{const c=n[o];return null!=c&&(r[o]=c),r},{})}scheduleNavigation(n,r,o,c,d){if(this.disposed)return Promise.resolve(!1);let _,E,C,A;return d?(_=d.resolve,E=d.reject,C=d.promise):C=new Promise((R,N)=>{_=R,E=N}),"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(o=this.location.getState()),A=o&&o.\u0275routerPageId?o.\u0275routerPageId:c.replaceUrl||c.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):A=0,this.navigationTransitions.handleNavigationRequest({targetPageId:A,source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:n,extras:c,resolve:_,reject:E,promise:C,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),C.catch(R=>Promise.reject(R))}setBrowserUrl(n,r){const o=this.urlSerializer.serialize(n),c={...r.extras.state,...this.generateNgRouterState(r.id,r.targetPageId)};this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl?this.location.replaceState(o,"",c):this.location.go(o,"",c)}restoreHistory(n,r=!1){if("computed"===this.canceledNavigationResolution){const o=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===o?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===o&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(o)}else"replace"===this.canceledNavigationResolution&&(r&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(n,r){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:r}:{navigationId:n}}}return e.\u0275fac=function(n){return new(n||e)},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();class NM{}let hB=(()=>{class e{constructor(n,r,o,c,d){this.router=n,this.injector=o,this.preloadingStrategy=c,this.loader=d}setUpPreloading(){this.subscription=this.router.events.pipe($d(n=>n instanceof Vp),Fp(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,r){const o=[];for(const c of r){c.providers&&!c._injector&&(c._injector=s1(c.providers,n,`Route: ${c.path}`));const d=c._injector??n,_=c._loadedInjector??d;c.loadChildren&&!c._loadedRoutes&&void 0===c.canLoad||c.loadComponent&&!c._loadedComponent?o.push(this.preloadConfig(d,c)):(c.children||c._loadedRoutes)&&o.push(this.processRoutes(_,c.children??c._loadedRoutes))}return Di(o).pipe(Xt())}preloadConfig(n,r){return this.preloadingStrategy.preload(r,()=>{let o;o=r.loadChildren&&void 0===r.canLoad?this.loader.loadChildren(n,r):Yr(null);const c=o.pipe(st(d=>null===d?Yr(void 0):(r._loadedRoutes=d.routes,r._loadedInjector=d.injector,this.processRoutes(d.injector??n,d.routes))));return r.loadComponent&&!r._loadedComponent?Di([c,this.loader.loadComponent(r)]).pipe(Xt()):c})}}return e.\u0275fac=function(n){return new(n||e)(Pn(Nc),Pn(dT),Pn(Zc),Pn(NM),Pn(AE))},e.\u0275prov=kn({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();const LE=new Xr("");let kM=(()=>{class e{constructor(n,r,o,c,d={}){this.urlSerializer=n,this.transitions=r,this.viewportScroller=o,this.zone=c,this.options=d,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},d.scrollPositionRestoration=d.scrollPositionRestoration||"disabled",d.anchorScrolling=d.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof gE?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof Vp&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.urlSerializer.parse(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(n=>{n instanceof nM&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,r){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new nM(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,r))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return e.\u0275fac=function(n){!function Lv(){throw new Error("invalid")}()},e.\u0275prov=kn({token:e,factory:e.\u0275fac}),e})();function gm(e,t){return{\u0275kind:e,\u0275providers:t}}function zM(){const e=rr(Yc);return t=>{const n=e.get(f1);if(t!==n.components[0])return;const r=e.get(Nc),o=e.get(BM);1===e.get(NE)&&r.initialNavigation(),e.get(UM,null,wr.Optional)?.setUpPreloading(),e.get(LE,null,wr.Optional)?.init(),r.resetRootComponentType(n.componentTypes[0]),o.closed||(o.next(),o.unsubscribe())}}const BM=new Xr("",{factory:()=>new Nt}),NE=new Xr("",{providedIn:"root",factory:()=>1});const UM=new Xr("");function mB(e){return gm(0,[{provide:UM,useExisting:hB},{provide:NM,useExisting:e}])}const VM=new Xr("ROUTER_FORROOT_GUARD"),yB=[Nb,{provide:L_,useClass:lE},Nc,B_,{provide:cm,useFactory:function FM(e){return e.routerState.root},deps:[Nc]},AE,[]];function _B(){return new xT("Router",Nc)}let jM=(()=>{class e{constructor(n){}static forRoot(n,r){return{ngModule:e,providers:[yB,[],{provide:dm,multi:!0,useValue:n},{provide:VM,useFactory:bB,deps:[[Nc,new cr,new Wh]]},{provide:Z1,useValue:r||{}},r?.useHash?{provide:kp,useClass:lN}:{provide:kp,useClass:GT},{provide:LE,useFactory:()=>{const e=rr(Ok),t=rr(ru),n=rr(Z1),r=rr(PE),o=rr(L_);return n.scrollOffset&&e.setOffset(n.scrollOffset),new kM(o,r,e,t,n)}},r?.preloadingStrategy?mB(r.preloadingStrategy).\u0275providers:[],{provide:xT,multi:!0,useFactory:_B},r?.initialNavigation?EB(r):[],[{provide:GM,useFactory:zM},{provide:fT,multi:!0,useExisting:GM}]]}}static forChild(n){return{ngModule:e,providers:[{provide:dm,multi:!0,useValue:n}]}}}return e.\u0275fac=function(n){return new(n||e)(Pn(VM,8))},e.\u0275mod=Ls({type:e}),e.\u0275inj=Ea({imports:[EE]}),e})();function bB(e){return"guarded"}function EB(e){return["disabled"===e.initialNavigation?gm(3,[{provide:w_,multi:!0,useFactory:()=>{const t=rr(Nc);return()=>{t.setUpLocationChangeListener()}}},{provide:NE,useValue:2}]).\u0275providers:[],"enabledBlocking"===e.initialNavigation?gm(2,[{provide:NE,useValue:0},{provide:w_,multi:!0,deps:[Yc],useFactory:t=>{const n=t.get(aN,Promise.resolve());return()=>n.then(()=>new Promise(o=>{const c=t.get(Nc),d=t.get(BM);(function r(o){t.get(Nc).events.pipe($d(d=>d instanceof Vp||d instanceof B1||d instanceof tM),vn(d=>d instanceof Vp||d instanceof B1&&(0===d.code||1===d.code)&&null),$d(d=>null!==d),A_(1)).subscribe(()=>{o()})})(()=>{o(!0)}),c.afterPreactivation=()=>(o(!0),d.closed?Yr(void 0):d),c.initialNavigation()}))}}]).\u0275providers:[]]}const GM=new Xr("");class mm{}mm.\u0275fac=function(t){return new(t||mm)},mm.\u0275mod=Ls({type:mm}),mm.\u0275inj=Ea({imports:[jM.forRoot([]),jM]});const kl={center:[-122.486052,37.830348],zoom:13.5,path:[[-122.483696,37.833818],[-122.483482,37.833174],[-122.483396,37.8327],[-122.483568,37.832056],[-122.48404,37.831141],[-122.48404,37.830497],[-122.483482,37.82992],[-122.483568,37.829548],[-122.48507,37.829446],[-122.4861,37.828802],[-122.486958,37.82931],[-122.487001,37.830802],[-122.487516,37.831683],[-122.488031,37.832158],[-122.488889,37.832971],[-122.489876,37.832632],[-122.490434,37.832937],[-122.49125,37.832429],[-122.491636,37.832564],[-122.492237,37.833378],[-122.493782,37.833683]],crossSectionDistance:50,midPointIndex:0};var Fl=6371008.8,$M={centimeters:100*Fl,centimetres:100*Fl,degrees:Fl/111325,feet:3.28084*Fl,inches:39.37*Fl,kilometers:Fl/1e3,kilometres:Fl/1e3,meters:Fl,metres:Fl,miles:Fl/1609.344,millimeters:1e3*Fl,millimetres:1e3*Fl,nauticalmiles:Fl/1852,radians:1,yards:1.0936*Fl};function Nh(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function kh(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!FE(e[0])||!FE(e[1]))throw new Error("coordinates must contain numbers");return Nh({type:"Point",coordinates:e},t,n)}function W1(e,t,n){void 0===n&&(n={});for(var r=0,o=e;r<o.length;r++){var c=o[r];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}return Nh({type:"Polygon",coordinates:e},t,n)}function ah(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return Nh({type:"LineString",coordinates:e},t,n)}function Fh(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function kE(e,t){void 0===t&&(t="kilometers");var n=$M[t];if(!n)throw new Error(t+" units is invalid");return e/n}function Y1(e){return e%(2*Math.PI)*180/Math.PI}function zh(e){return e%360*Math.PI/180}function FE(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function ym(e,t,n){if(null!==e)for(var r,o,c,d,_,E,C,N,A=0,R=0,z=e.type,Q="FeatureCollection"===z,ee="Feature"===z,Te=Q?e.features.length:1,me=0;me<Te;me++){_=(N=!!(C=Q?e.features[me].geometry:ee?e.geometry:e)&&"GeometryCollection"===C.type)?C.geometries.length:1;for(var ie=0;ie<_;ie++){var oe=0,Ke=0;if(null!==(d=N?C.geometries[ie]:C)){E=d.coordinates;var ot=d.type;switch(A=!n||"Polygon"!==ot&&"MultiPolygon"!==ot?0:1,ot){case null:break;case"Point":if(!1===t(E,R,me,oe,Ke))return!1;R++,oe++;break;case"LineString":case"MultiPoint":for(r=0;r<E.length;r++){if(!1===t(E[r],R,me,oe,Ke))return!1;R++,"MultiPoint"===ot&&oe++}"LineString"===ot&&oe++;break;case"Polygon":case"MultiLineString":for(r=0;r<E.length;r++){for(o=0;o<E[r].length-A;o++){if(!1===t(E[r][o],R,me,oe,Ke))return!1;R++}"MultiLineString"===ot&&oe++,"Polygon"===ot&&Ke++}"Polygon"===ot&&oe++;break;case"MultiPolygon":for(r=0;r<E.length;r++){for(Ke=0,o=0;o<E[r].length;o++){for(c=0;c<E[r][o].length-A;c++){if(!1===t(E[r][o][c],R,me,oe,Ke))return!1;R++}Ke++}oe++}break;case"GeometryCollection":for(r=0;r<d.geometries.length;r++)if(!1===ym(d.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function H_(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function Zd(e,t){!function WM(e,t){var n,r,o,c,d,_,E,C,A,R,N=0,z="FeatureCollection"===e.type,Q="Feature"===e.type,ee=z?e.features.length:1;for(n=0;n<ee;n++){for(C=z?e.features[n].properties:Q?e.properties:{},A=z?e.features[n].bbox:Q?e.bbox:void 0,R=z?e.features[n].id:Q?e.id:void 0,d=(E=!!(_=z?e.features[n].geometry:Q?e.geometry:e)&&"GeometryCollection"===_.type)?_.geometries.length:1,o=0;o<d;o++)if(null!==(c=E?_.geometries[o]:_))switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(c,N,C,A,R))return!1;break;case"GeometryCollection":for(r=0;r<c.geometries.length;r++)if(!1===t(c.geometries[r],N,C,A,R))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,N,C,A,R))return!1;N++}}(e,function(n,r,o,c,d){var E,_=null===n?null:n.type;switch(_){case null:case"Point":case"LineString":case"Polygon":return!1!==t(Nh(n,o,{bbox:c,id:d}),r,0)&&void 0}switch(_){case"MultiPoint":E="Point";break;case"MultiLineString":E="LineString";break;case"MultiPolygon":E="Polygon"}for(var C=0;C<n.coordinates.length;C++)if(!1===t(Nh({type:E,coordinates:n.coordinates[C]},o),r,C))return!1})}function zE(e){var t=[1/0,1/0,-1/0,-1/0];return ym(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}zE.default=zE;const YM=zE;function nd(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function _f(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function KM(e){return"Feature"===e.type?e.geometry:e}function BE(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}function t2(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=nd(e),o=KM(t),c=o.type,d=t.bbox,_=o.coordinates;if(d&&!1===function HB(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,d))return!1;"Polygon"===c&&(_=[_]);for(var E=!1,C=0;C<_.length&&!E;C++)if(n2(r,_[C][0],n.ignoreBoundary)){for(var A=!1,R=1;R<_[C].length&&!A;)n2(r,_[C][R],!n.ignoreBoundary)&&(A=!0),R++;A||(E=!0)}return E}function n2(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var o=0,c=t.length-1;o<t.length;c=o++){var d=t[o][0],_=t[o][1],E=t[c][0],C=t[c][1];if(e[1]*(d-E)+_*(E-e[0])+C*(e[0]-d)==0&&(d-e[0])*(E-e[0])<=0&&(_-e[1])*(C-e[1])<=0)return!n;_>e[1]!=C>e[1]&&e[0]<(E-d)*(e[1]-_)/(C-_)+d&&(r=!r)}return r}je(5943),je(1335);const rd=function XB(e,t,n){void 0===n&&(n={});var r=nd(e),o=nd(t),c=zh(o[1]-r[1]),d=zh(o[0]-r[0]),_=zh(r[1]),E=zh(o[1]),C=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(d/2),2)*Math.cos(_)*Math.cos(E);return function ZM(e,t){void 0===t&&(t="kilometers");var n=$M[t];if(!n)throw new Error(t+" units is invalid");return e*n}(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)};var i2=new ArrayBuffer(16);new Float64Array(i2),new Uint32Array(i2),je(3544),function(){function e(t){this.points=t.points||[],this.duration=t.duration||1e4,this.sharpness=t.sharpness||.85,this.centers=[],this.controls=[],this.stepLength=t.stepLength||60,this.length=this.points.length,this.delay=0;for(var n=0;n<this.length;n++)this.points[n].z=this.points[n].z||0;for(n=0;n<this.length-1;n++){var r=this.points[n],o=this.points[n+1];this.centers.push({x:(r.x+o.x)/2,y:(r.y+o.y)/2,z:(r.z+o.z)/2})}for(this.controls.push([this.points[0],this.points[0]]),n=0;n<this.centers.length-1;n++){var c=this.points[n+1].x-(this.centers[n].x+this.centers[n+1].x)/2,d=this.points[n+1].y-(this.centers[n].y+this.centers[n+1].y)/2,_=this.points[n+1].z-(this.centers[n].y+this.centers[n+1].z)/2;this.controls.push([{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n].z+_)},{x:(1-this.sharpness)*this.points[n+1].x+this.sharpness*(this.centers[n+1].x+c),y:(1-this.sharpness)*this.points[n+1].y+this.sharpness*(this.centers[n+1].y+d),z:(1-this.sharpness)*this.points[n+1].z+this.sharpness*(this.centers[n+1].z+_)}])}return this.controls.push([this.points[this.length-1],this.points[this.length-1]]),this.steps=this.cacheSteps(this.stepLength),this}e.prototype.cacheSteps=function(t){var n=[],r=this.pos(0);n.push(0);for(var o=0;o<this.duration;o+=10){var c=this.pos(o);Math.sqrt((c.x-r.x)*(c.x-r.x)+(c.y-r.y)*(c.y-r.y)+(c.z-r.z)*(c.z-r.z))>t&&(n.push(o),r=c)}return n},e.prototype.vector=function(t){var n=this.pos(t+10),r=this.pos(t-10);return{angle:180*Math.atan2(n.y-r.y,n.x-r.x)/3.14,speed:Math.sqrt((r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y)+(r.z-n.z)*(r.z-n.z))}},e.prototype.pos=function(t){var n=t-this.delay;n<0&&(n=0),n>this.duration&&(n=this.duration-1);var r=n/this.duration;if(r>=1)return this.points[this.length-1];var o=Math.floor((this.points.length-1)*r);return function l4(e,t,n,r,o){var c=function c4(e){var t=e*e;return[t*e,3*t*(1-e),3*e*(1-e)*(1-e),(1-e)*(1-e)*(1-e)]}(e);return{x:o.x*c[0]+r.x*c[1]+n.x*c[2]+t.x*c[3],y:o.y*c[0]+r.y*c[1]+n.y*c[2]+t.y*c[3],z:o.z*c[0]+r.z*c[1]+n.z*c[2]+t.z*c[3]}}((this.length-1)*r-o,this.points[o],this.controls[o][1],this.controls[o+1][0],this.points[o+1])}}();function qE(e,t,n,r){void 0===r&&(r={});var o=nd(e),c=zh(o[0]),d=zh(o[1]),_=zh(n),E=kE(t,r.units),C=Math.asin(Math.sin(d)*Math.cos(E)+Math.cos(d)*Math.sin(E)*Math.cos(_));return kh([Y1(c+Math.atan2(Math.sin(_)*Math.sin(E)*Math.cos(d),Math.cos(E)-Math.sin(d)*Math.sin(C))),Y1(C)],r.properties)}function HE(e,t,n){if(void 0===n&&(n={}),!0===n.final)return function y4(e,t){return(HE(t,e)+180)%360}(e,t);var r=nd(e),o=nd(t),c=zh(r[0]),d=zh(o[0]),_=zh(r[1]),E=zh(o[1]),C=Math.sin(d-c)*Math.cos(E),A=Math.cos(_)*Math.sin(E)-Math.sin(_)*Math.cos(E)*Math.cos(d-c);return Y1(Math.atan2(C,A))}je(5469);const XE=function x4(e){if(!e)throw new Error("geojson is required");var t=[];return Zd(e,function(n){!function w4(e,t){var n=[],r=e.geometry;if(null!==r){switch(r.type){case"Polygon":n=_f(r);break;case"LineString":n=[_f(r)]}n.forEach(function(o){var c=function b4(e,t){var n=[];return e.reduce(function(r,o){var c=ah([r,o],t);return c.bbox=function E4(e,t){var n=e[0],r=e[1],o=t[0],c=t[1];return[n<o?n:o,r<c?r:c,n>o?n:o,r>c?r:c]}(r,o),n.push(c),o}),n}(o,e.properties);c.forEach(function(d){d.id=t.length,t.push(d)})})}}(n,t)}),Fh(t)};var ZE=je(5406);function h2(e,t){var n=_f(e),r=_f(t);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var o=n[0][0],c=n[0][1],d=n[1][0],_=n[1][1],E=r[0][0],C=r[0][1],A=r[1][0],R=r[1][1],N=(R-C)*(d-o)-(A-E)*(_-c);if(0===N)return null;var ee=((A-E)*(c-C)-(R-C)*(o-E))/N,Te=((d-o)*(c-C)-(_-c)*(o-E))/N;return ee>=0&&ee<=1&&Te>=0&&Te<=1?kh([o+ee*(d-o),c+ee*(_-c)]):null}const f2=function C4(e,t){var n={},r=[];if("LineString"===e.type&&(e=Nh(e)),"LineString"===t.type&&(t=Nh(t)),"Feature"===e.type&&"Feature"===t.type&&null!==e.geometry&&null!==t.geometry&&"LineString"===e.geometry.type&&"LineString"===t.geometry.type&&2===e.geometry.coordinates.length&&2===t.geometry.coordinates.length){var o=h2(e,t);return o&&r.push(o),Fh(r)}var c=ZE();return c.load(XE(t)),H_(XE(e),function(d){H_(c.search(d),function(_){var E=h2(d,_);if(E){var C=_f(E).join(",");n[C]||(n[C]=!0,r.push(E))}})}),Fh(r)};function _2(e,t,n){void 0===n&&(n={});for(var o=KM(e).coordinates,c=0,d=0;d<o.length&&!(t>=c&&d===o.length-1);d++){if(c>=t){var _=t-c;if(_){var E=HE(o[d],o[d-1])-180;return qE(o[d],_,E,n)}return kh(o[d])}c+=rd(o[d],o[d+1],n)}return kh(o[o.length-1])}function v2(e,t){return void 0===t&&(t={}),function LB(e,t,n){var r=n,o=!1;return function RB(e,t){Zd(e,function(n,r,o){var c=0;if(n.geometry){var d=n.geometry.type;if("Point"!==d&&"MultiPoint"!==d){var _,E=0,C=0,A=0;if(!1===ym(n,function(R,N,z,Q,ee){if(void 0===_||r>E||Q>C||ee>A)return _=R,E=r,C=Q,A=ee,void(c=0);var Te=ah([_,R],n.properties);if(!1===t(Te,r,o,ee,c))return!1;c++,_=R}))return!1}}})}(e,function(c,d,_,E,C){r=!1===o&&void 0===n?c:t(r,c,d,_,E,C),o=!0}),r}(e,function(n,r){var o=r.geometry.coordinates;return n+rd(o[0],o[1],t)},0)}var C2=Math.PI/180,S2=180/Math.PI,W_=function(e,t){this.lon=e,this.lat=t,this.x=C2*e,this.y=C2*t};W_.prototype.view=function(){return String(this.lon).slice(0,4)+","+String(this.lat).slice(0,4)},W_.prototype.antipode=function(){return new W_(this.lon<0?180+this.lon:-1*(180-this.lon),-1*this.lat)};var I2=function(){this.coords=[],this.length=0};I2.prototype.move_to=function(e){this.length++,this.coords.push(e)};var KE=function(e){this.properties=e||{},this.geometries=[]};KE.prototype.json=function(){if(this.geometries.length<=0)return{geometry:{type:"LineString",coordinates:null},type:"Feature",properties:this.properties};if(1===this.geometries.length)return{geometry:{type:"LineString",coordinates:this.geometries[0].coords},type:"Feature",properties:this.properties};for(var e=[],t=0;t<this.geometries.length;t++)e.push(this.geometries[t].coords);return{geometry:{type:"MultiLineString",coordinates:e},type:"Feature",properties:this.properties}},KE.prototype.wkt=function(){for(var e="",t="LINESTRING(",n=function(c){t+=c[0]+" "+c[1]+","},r=0;r<this.geometries.length;r++){if(0===this.geometries[r].coords.length)return"LINESTRING(empty)";this.geometries[r].coords.forEach(n),e+=t.substring(0,t.length-1)+")"}return e};var JE=function(e,t,n){if(!e||void 0===e.x||void 0===e.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");if(!t||void 0===t.x||void 0===t.y)throw new Error("GreatCircle constructor expects two args: start and end objects with x and y properties");this.start=new W_(e.x,e.y),this.end=new W_(t.x,t.y),this.properties=n||{};var r=this.start.x-this.end.x,c=Math.pow(Math.sin((this.start.y-this.end.y)/2),2)+Math.cos(this.start.y)*Math.cos(this.end.y)*Math.pow(Math.sin(r/2),2);if(this.g=2*Math.asin(Math.sqrt(c)),this.g===Math.PI)throw new Error("it appears "+e.view()+" and "+t.view()+" are 'antipodal', e.g diametrically opposite, thus there is no single route but rather infinite");if(isNaN(this.g))throw new Error("could not calculate great circle between "+e+" and "+t)};function T2(e,t){var n=[],r=ZE();return Zd(t,function(o){if(n.forEach(function(_,E){_.id=E}),n.length){var c=r.search(o);if(c.features.length){var d=D2(o,c);n=n.filter(function(_){return _.id!==d.id}),r.remove(d),H_(QE(d,o),function(_){n.push(_),r.insert(_)})}}else(n=QE(e,o).features).forEach(function(_){_.bbox||(_.bbox=function g4(e){var t=e[0],n=e[1],r=e[2],o=e[3];if(rd(e.slice(0,2),[r,n])>=rd(e.slice(0,2),[t,o])){var _=(n+o)/2;return[t,_-(r-t)/2,r,_+(r-t)/2]}var E=(t+r)/2;return[E-(o-n)/2,n,E+(o-n)/2,o]}(YM(_)))}),r.load(Fh(n))}),Fh(n)}function QE(e,t){var n=[],r=_f(e)[0],o=_f(e)[e.geometry.coordinates.length-1];if(eC(r,nd(t))||eC(o,nd(t)))return Fh([e]);var c=ZE(),d=XE(e);c.load(d);var _=c.search(t);if(!_.features.length)return Fh([e]);var E=D2(t,_),A=function PB(e,t,n){var r=n;return H_(e,function(o,c){r=0===c&&void 0===n?o:t(r,o,c)}),r}(d,function(R,N,z){var Q=_f(N)[1],ee=nd(t);return z===E.id?(R.push(ee),n.push(ah(R)),eC(ee,Q)?[ee]:[ee,Q]):(R.push(Q),R)},[r]);return A.length>1&&n.push(ah(A)),Fh(n)}function D2(e,t){if(!t.features.length)throw new Error("lines must contain features");if(1===t.features.length)return t.features[0];var n,r=1/0;return H_(t,function(o){var d=function S4(e,t,n){void 0===n&&(n={});var r=kh([1/0,1/0],{dist:1/0}),o=0;return Zd(e,function(c){for(var d=_f(c),_=0;_<d.length-1;_++){var E=kh(d[_]);E.properties.dist=rd(t,E,n);var C=kh(d[_+1]);C.properties.dist=rd(t,C,n);var A=rd(E,C,n),R=Math.max(E.properties.dist,C.properties.dist),N=HE(E,C),z=qE(t,R,N+90,n),Q=qE(t,R,N-90,n),ee=f2(ah([z.geometry.coordinates,Q.geometry.coordinates]),ah([E.geometry.coordinates,C.geometry.coordinates])),Te=null;ee.features.length>0&&((Te=ee.features[0]).properties.dist=rd(t,Te,n),Te.properties.location=o+rd(E,Te,n)),E.properties.dist<r.properties.dist&&((r=E).properties.index=_,r.properties.location=o),C.properties.dist<r.properties.dist&&((r=C).properties.index=_+1,r.properties.location=o+A),Te&&Te.properties.dist<r.properties.dist&&((r=Te).properties.index=_),o+=A}}),r}(o,e).properties.dist;d<r&&(n=o,r=d)}),n}function eC(e,t){return e[0]===t[0]&&e[1]===t[1]}JE.prototype.interpolate=function(e){var t=Math.sin((1-e)*this.g)/Math.sin(this.g),n=Math.sin(e*this.g)/Math.sin(this.g),r=t*Math.cos(this.start.y)*Math.cos(this.start.x)+n*Math.cos(this.end.y)*Math.cos(this.end.x),o=t*Math.cos(this.start.y)*Math.sin(this.start.x)+n*Math.cos(this.end.y)*Math.sin(this.end.x),c=t*Math.sin(this.start.y)+n*Math.sin(this.end.y),d=S2*Math.atan2(c,Math.sqrt(Math.pow(r,2)+Math.pow(o,2)));return[S2*Math.atan2(o,r),d]},JE.prototype.Arc=function(e,t){var n=[];if(!e||e<=2)n.push([this.start.lon,this.start.lat]),n.push([this.end.lon,this.end.lat]);else for(var r=1/(e-1),o=0;o<e;++o){var d=this.interpolate(r*o);n.push(d)}for(var _=!1,E=0,C=t&&t.offset?t.offset:10,A=180-C,R=-180+C,N=360-C,z=1;z<n.length;++z){var Q=n[z-1][0],ee=n[z][0],Te=Math.abs(ee-Q);Te>N&&(ee>A&&Q<R||Q>A&&ee<R)?_=!0:Te>E&&(E=Te)}var me=[];if(_&&E<C){var ie=[];me.push(ie);for(var oe=0;oe<n.length;++oe){var Ke=parseFloat(n[oe][0]);if(oe>0&&Math.abs(Ke-n[oe-1][0])>N){var ot=parseFloat(n[oe-1][0]),Et=parseFloat(n[oe-1][1]),Tt=parseFloat(n[oe][0]),qt=parseFloat(n[oe][1]);if(ot>-180&&ot<R&&180===Tt&&oe+1<n.length&&n[oe-1][0]>-180&&n[oe-1][0]<R){ie.push([-180,n[oe][1]]),oe++,ie.push([n[oe][0],n[oe][1]]);continue}if(ot>A&&ot<180&&-180===Tt&&oe+1<n.length&&n[oe-1][0]>A&&n[oe-1][0]<180){ie.push([180,n[oe][1]]),oe++,ie.push([n[oe][0],n[oe][1]]);continue}if(ot<R&&Tt>A){var Je=ot;ot=Tt,Tt=Je;var Pr=Et;Et=qt,qt=Pr}if(ot>A&&Tt<R&&(Tt+=360),ot<=180&&Tt>=180&&ot<Tt){var Yn=(180-ot)/(Tt-ot),Qr=Yn*qt+(1-Yn)*Et;ie.push([n[oe-1][0]>A?180:-180,Qr]),(ie=[]).push([n[oe-1][0]>A?-180:180,Qr]),me.push(ie)}else me.push(ie=[]);ie.push([Ke,n[oe][1]])}else ie.push([n[oe][0],n[oe][1]])}}else{var ai=[];me.push(ai);for(var On=0;On<n.length;++On)ai.push([n[On][0],n[On][1]])}for(var Tr=new KE(this.properties),ar=0;ar<me.length;++ar){var Oo=new I2;Tr.geometries.push(Oo);for(var To=me[ar],fi=0;fi<To.length;++fi)Oo.move_to(To[fi])}return Tr};const J4=function K4(e,t){if(!e)throw new Error("line is required");if(!t)throw new Error("splitter is required");var n=BE(e),r=BE(t);if("LineString"!==n)throw new Error("line must be LineString");if("FeatureCollection"===r)throw new Error("splitter cannot be a FeatureCollection");if("GeometryCollection"===r)throw new Error("splitter cannot be a GeometryCollection");var o=function j4(e,t){void 0===t&&(t={});var n=t.precision,r=t.coordinates,o=t.mutate;if(n=null==n||isNaN(n)?6:n,r=null==r||isNaN(r)?3:r,!e)throw new Error("<geojson> is required");if("number"!=typeof n)throw new Error("<precision> must be a number");if("number"!=typeof r)throw new Error("<coordinates> must be a number");(!1===o||void 0===o)&&(e=JSON.parse(JSON.stringify(e)));var c=Math.pow(10,n);return ym(e,function(d){!function G4(e,t,n){e.length>n&&e.splice(n,e.length);for(var r=0;r<e.length;r++)e[r]=Math.round(e[r]*t)/t}(d,c,r)}),e}(t,{precision:7});switch(r){case"Point":return QE(e,o);case"MultiPoint":return T2(e,o);case"LineString":case"MultiLineString":case"Polygon":case"MultiPolygon":return T2(e,f2(e,o))}};je(6952);var Li=[],Oi=[],Ni=[],ki=[],Fi=[],zi=[],Bi=[],Ui=[],Vi=[],ji=[],Gi=[],$i=[],qi=[],Hi=[],Xi=[],Zi=[],Wi=[],Yi=[],Ki=[],Ji=[],Qi=[],eo=[],to=[],no=[];Bi[85]=ji[85]=-1,Ui[85]=Gi[85]=0,Vi[85]=$i[85]=1,Ki[85]=eo[85]=1,Ji[85]=to[85]=0,Qi[85]=no[85]=1,Li[85]=ki[85]=0,Oi[85]=Fi[85]=-1,Ni[85]=Xi[85]=0,Zi[85]=qi[85]=0,Wi[85]=Hi[85]=1,zi[85]=Yi[85]=1,eo[1]=eo[169]=0,to[1]=to[169]=-1,no[1]=no[169]=0,qi[1]=qi[169]=-1,Hi[1]=Hi[169]=0,Xi[1]=Xi[169]=0,ji[4]=ji[166]=0,Gi[4]=Gi[166]=-1,$i[4]=$i[166]=1,Zi[4]=Zi[166]=1,Wi[4]=Wi[166]=0,Yi[4]=Yi[166]=0,Bi[16]=Bi[154]=0,Ui[16]=Ui[154]=1,Vi[16]=Vi[154]=1,ki[16]=ki[154]=1,Fi[16]=Fi[154]=0,zi[16]=zi[154]=1,Ki[64]=Ki[106]=0,Ji[64]=Ji[106]=1,Qi[64]=Qi[106]=0,Li[64]=Li[106]=-1,Oi[64]=Oi[106]=0,Ni[64]=Ni[106]=1,Ki[2]=Ki[168]=0,Ji[2]=Ji[168]=-1,Qi[2]=Qi[168]=1,eo[2]=eo[168]=0,to[2]=to[168]=-1,no[2]=no[168]=0,qi[2]=qi[168]=-1,Hi[2]=Hi[168]=0,Xi[2]=Xi[168]=0,Zi[2]=Zi[168]=-1,Wi[2]=Wi[168]=0,Yi[2]=Yi[168]=1,Bi[8]=Bi[162]=0,Ui[8]=Ui[162]=-1,Vi[8]=Vi[162]=0,ji[8]=ji[162]=0,Gi[8]=Gi[162]=-1,$i[8]=$i[162]=1,qi[8]=qi[162]=1,Hi[8]=Hi[162]=0,Xi[8]=Xi[162]=1,Zi[8]=Zi[162]=1,Wi[8]=Wi[162]=0,Yi[8]=Yi[162]=0,Bi[32]=Bi[138]=0,Ui[32]=Ui[138]=1,Vi[32]=Vi[138]=1,ji[32]=ji[138]=0,Gi[32]=Gi[138]=1,$i[32]=$i[138]=0,Li[32]=Li[138]=1,Oi[32]=Oi[138]=0,Ni[32]=Ni[138]=0,ki[32]=ki[138]=1,Fi[32]=Fi[138]=0,zi[32]=zi[138]=1,eo[128]=eo[42]=0,to[128]=to[42]=1,no[128]=no[42]=1,Ki[128]=Ki[42]=0,Ji[128]=Ji[42]=1,Qi[128]=Qi[42]=0,Li[128]=Li[42]=-1,Oi[128]=Oi[42]=0,Ni[128]=Ni[42]=1,ki[128]=ki[42]=-1,Fi[128]=Fi[42]=0,zi[128]=zi[42]=0,ji[5]=ji[165]=-1,Gi[5]=Gi[165]=0,$i[5]=$i[165]=0,eo[5]=eo[165]=1,to[5]=to[165]=0,no[5]=no[165]=0,Zi[20]=Zi[150]=0,Wi[20]=Wi[150]=1,Yi[20]=Yi[150]=1,ki[20]=ki[150]=0,Fi[20]=Fi[150]=-1,zi[20]=zi[150]=1,Bi[80]=Bi[90]=-1,Ui[80]=Ui[90]=0,Vi[80]=Vi[90]=1,Ki[80]=Ki[90]=1,Ji[80]=Ji[90]=0,Qi[80]=Qi[90]=1,qi[65]=qi[105]=0,Hi[65]=Hi[105]=1,Xi[65]=Xi[105]=0,Li[65]=Li[105]=0,Oi[65]=Oi[105]=-1,Ni[65]=Ni[105]=0,Bi[160]=Bi[10]=-1,Ui[160]=Ui[10]=0,Vi[160]=Vi[10]=1,ji[160]=ji[10]=-1,Gi[160]=Gi[10]=0,$i[160]=$i[10]=0,eo[160]=eo[10]=1,to[160]=to[10]=0,no[160]=no[10]=0,Ki[160]=Ki[10]=1,Ji[160]=Ji[10]=0,Qi[160]=Qi[10]=1,Zi[130]=Zi[40]=0,Wi[130]=Wi[40]=1,Yi[130]=Yi[40]=1,qi[130]=qi[40]=0,Hi[130]=Hi[40]=1,Xi[130]=Xi[40]=0,Li[130]=Li[40]=0,Oi[130]=Oi[40]=-1,Ni[130]=Ni[40]=0,ki[130]=ki[40]=0,Fi[130]=Fi[40]=-1,zi[130]=zi[40]=1,ji[37]=ji[133]=0,Gi[37]=Gi[133]=1,$i[37]=$i[133]=1,eo[37]=eo[133]=0,to[37]=to[133]=1,no[37]=no[133]=0,Li[37]=Li[133]=-1,Oi[37]=Oi[133]=0,Ni[37]=Ni[133]=0,ki[37]=ki[133]=1,Fi[37]=Fi[133]=0,zi[37]=zi[133]=0,Zi[148]=Zi[22]=-1,Wi[148]=Wi[22]=0,Yi[148]=Yi[22]=0,eo[148]=eo[22]=0,to[148]=to[22]=-1,no[148]=no[22]=1,Ki[148]=Ki[22]=0,Ji[148]=Ji[22]=1,Qi[148]=Qi[22]=1,ki[148]=ki[22]=-1,Fi[148]=Fi[22]=0,zi[148]=zi[22]=1,Bi[82]=Bi[88]=0,Ui[82]=Ui[88]=-1,Vi[82]=Vi[88]=1,Zi[82]=Zi[88]=1,Wi[82]=Wi[88]=0,Yi[82]=Yi[88]=1,qi[82]=qi[88]=-1,Hi[82]=Hi[88]=0,Xi[82]=Xi[88]=1,Ki[82]=Ki[88]=0,Ji[82]=Ji[88]=-1,Qi[82]=Qi[88]=0,Bi[73]=Bi[97]=0,Ui[73]=Ui[97]=1,Vi[73]=Vi[97]=0,ji[73]=ji[97]=0,Gi[73]=Gi[97]=-1,$i[73]=$i[97]=0,qi[73]=qi[97]=1,Hi[73]=Hi[97]=0,Xi[73]=Xi[97]=0,Li[73]=Li[97]=1,Oi[73]=Oi[97]=0,Ni[73]=Ni[97]=1,Bi[145]=Bi[25]=0,Ui[145]=Ui[25]=-1,Vi[145]=Vi[25]=0,qi[145]=qi[25]=1,Hi[145]=Hi[25]=0,Xi[145]=Xi[25]=1,eo[145]=eo[25]=0,to[145]=to[25]=1,no[145]=no[25]=1,ki[145]=ki[25]=-1,Fi[145]=Fi[25]=0,zi[145]=zi[25]=0,ji[70]=ji[100]=0,Gi[70]=Gi[100]=1,$i[70]=$i[100]=0,Zi[70]=Zi[100]=-1,Wi[70]=Wi[100]=0,Yi[70]=Yi[100]=1,Ki[70]=Ki[100]=0,Ji[70]=Ji[100]=-1,Qi[70]=Qi[100]=1,Li[70]=Li[100]=1,Oi[70]=Oi[100]=0,Ni[70]=Ni[100]=0,ji[101]=ji[69]=0,Gi[101]=Gi[69]=1,$i[101]=$i[69]=0,Li[101]=Li[69]=1,Oi[101]=Oi[69]=0,Ni[101]=Ni[69]=0,eo[149]=eo[21]=0,to[149]=to[21]=1,no[149]=no[21]=1,ki[149]=ki[21]=-1,Fi[149]=Fi[21]=0,zi[149]=zi[21]=0,Zi[86]=Zi[84]=-1,Wi[86]=Wi[84]=0,Yi[86]=Yi[84]=1,Ki[86]=Ki[84]=0,Ji[86]=Ji[84]=-1,Qi[86]=Qi[84]=1,Bi[89]=Bi[81]=0,Ui[89]=Ui[81]=-1,Vi[89]=Vi[81]=0,qi[89]=qi[81]=1,Hi[89]=Hi[81]=0,Xi[89]=Xi[81]=1,Bi[96]=Bi[74]=0,Ui[96]=Ui[74]=1,Vi[96]=Vi[74]=0,ji[96]=ji[74]=-1,Gi[96]=Gi[74]=0,$i[96]=$i[74]=1,Ki[96]=Ki[74]=1,Ji[96]=Ji[74]=0,Qi[96]=Qi[74]=0,Li[96]=Li[74]=1,Oi[96]=Oi[74]=0,Ni[96]=Ni[74]=1,Bi[24]=Bi[146]=0,Ui[24]=Ui[146]=-1,Vi[24]=Vi[146]=1,Zi[24]=Zi[146]=1,Wi[24]=Wi[146]=0,Yi[24]=Yi[146]=1,qi[24]=qi[146]=0,Hi[24]=Hi[146]=1,Xi[24]=Xi[146]=1,ki[24]=ki[146]=0,Fi[24]=Fi[146]=-1,zi[24]=zi[146]=0,ji[6]=ji[164]=-1,Gi[6]=Gi[164]=0,$i[6]=$i[164]=1,Zi[6]=Zi[164]=-1,Wi[6]=Wi[164]=0,Yi[6]=Yi[164]=0,eo[6]=eo[164]=0,to[6]=to[164]=-1,no[6]=no[164]=1,Ki[6]=Ki[164]=1,Ji[6]=Ji[164]=0,Qi[6]=Qi[164]=0,qi[129]=qi[41]=0,Hi[129]=Hi[41]=1,Xi[129]=Xi[41]=1,eo[129]=eo[41]=0,to[129]=to[41]=1,no[129]=no[41]=0,Li[129]=Li[41]=-1,Oi[129]=Oi[41]=0,Ni[129]=Ni[41]=0,ki[129]=ki[41]=0,Fi[129]=Fi[41]=-1,zi[129]=zi[41]=0,Zi[66]=Zi[104]=0,Wi[66]=Wi[104]=1,Yi[66]=Yi[104]=0,qi[66]=qi[104]=-1,Hi[66]=Hi[104]=0,Xi[66]=Xi[104]=1,Ki[66]=Ki[104]=0,Ji[66]=Ji[104]=-1,Qi[66]=Qi[104]=0,Li[66]=Li[104]=0,Oi[66]=Oi[104]=-1,Ni[66]=Ni[104]=1,Bi[144]=Bi[26]=-1,Ui[144]=Ui[26]=0,Vi[144]=Vi[26]=0,eo[144]=eo[26]=1,to[144]=to[26]=0,no[144]=no[26]=1,Ki[144]=Ki[26]=0,Ji[144]=Ji[26]=1,Qi[144]=Qi[26]=1,ki[144]=ki[26]=-1,Fi[144]=Fi[26]=0,zi[144]=zi[26]=1,ji[36]=ji[134]=0,Gi[36]=Gi[134]=1,$i[36]=$i[134]=1,Zi[36]=Zi[134]=0,Wi[36]=Wi[134]=1,Yi[36]=Yi[134]=0,Li[36]=Li[134]=0,Oi[36]=Oi[134]=-1,Ni[36]=Ni[134]=1,ki[36]=ki[134]=1,Fi[36]=Fi[134]=0,zi[36]=zi[134]=0,Bi[9]=Bi[161]=-1,Ui[9]=Ui[161]=0,Vi[9]=Vi[161]=0,ji[9]=ji[161]=0,Gi[9]=Gi[161]=-1,$i[9]=$i[161]=0,qi[9]=qi[161]=1,Hi[9]=Hi[161]=0,Xi[9]=Xi[161]=0,eo[9]=eo[161]=1,to[9]=to[161]=0,no[9]=no[161]=1,Bi[136]=0,Ui[136]=1,Vi[136]=1,ji[136]=0,Gi[136]=1,$i[136]=0,Zi[136]=-1,Wi[136]=0,Yi[136]=1,qi[136]=-1,Hi[136]=0,Xi[136]=0,eo[136]=0,to[136]=-1,no[136]=0,Ki[136]=0,Ji[136]=-1,Qi[136]=1,Li[136]=1,Oi[136]=0,Ni[136]=0,ki[136]=1,Fi[136]=0,zi[136]=1,Bi[34]=0,Ui[34]=-1,Vi[34]=0,ji[34]=0,Gi[34]=-1,$i[34]=1,Zi[34]=1,Wi[34]=0,Yi[34]=0,qi[34]=1,Hi[34]=0,Xi[34]=1,eo[34]=0,to[34]=1,no[34]=1,Ki[34]=0,Ji[34]=1,Qi[34]=0,Li[34]=-1,Oi[34]=0,Ni[34]=1,ki[34]=-1,Fi[34]=0,zi[34]=0,Bi[35]=0,Ui[35]=1,Vi[35]=1,ji[35]=0,Gi[35]=-1,$i[35]=1,Zi[35]=1,Wi[35]=0,Yi[35]=0,qi[35]=-1,Hi[35]=0,Xi[35]=0,eo[35]=0,to[35]=-1,no[35]=0,Ki[35]=0,Ji[35]=1,Qi[35]=0,Li[35]=-1,Oi[35]=0,Ni[35]=1,ki[35]=1,Fi[35]=0,zi[35]=1,Bi[153]=0,Ui[153]=1,Vi[153]=1,qi[153]=-1,Hi[153]=0,Xi[153]=0,eo[153]=0,to[153]=-1,no[153]=0,ki[153]=1,Fi[153]=0,zi[153]=1,ji[102]=0,Gi[102]=-1,$i[102]=1,Zi[102]=1,Wi[102]=0,Yi[102]=0,Ki[102]=0,Ji[102]=1,Qi[102]=0,Li[102]=-1,Oi[102]=0,Ni[102]=1,Bi[155]=0,Ui[155]=-1,Vi[155]=0,qi[155]=1,Hi[155]=0,Xi[155]=1,eo[155]=0,to[155]=1,no[155]=1,ki[155]=-1,Fi[155]=0,zi[155]=0,ji[103]=0,Gi[103]=1,$i[103]=0,Zi[103]=-1,Wi[103]=0,Yi[103]=1,Ki[103]=0,Ji[103]=-1,Qi[103]=1,Li[103]=1,Oi[103]=0,Ni[103]=0,Bi[152]=0,Ui[152]=1,Vi[152]=1,Zi[152]=-1,Wi[152]=0,Yi[152]=1,qi[152]=-1,Hi[152]=0,Xi[152]=0,eo[152]=0,to[152]=-1,no[152]=0,Ki[152]=0,Ji[152]=-1,Qi[152]=1,ki[152]=1,Fi[152]=0,zi[152]=1,Bi[156]=0,Ui[156]=-1,Vi[156]=1,Zi[156]=1,Wi[156]=0,Yi[156]=1,qi[156]=-1,Hi[156]=0,Xi[156]=0,eo[156]=0,to[156]=-1,no[156]=0,Ki[156]=0,Ji[156]=1,Qi[156]=1,ki[156]=-1,Fi[156]=0,zi[156]=1,Bi[137]=0,Ui[137]=1,Vi[137]=1,ji[137]=0,Gi[137]=1,$i[137]=0,qi[137]=-1,Hi[137]=0,Xi[137]=0,eo[137]=0,to[137]=-1,no[137]=0,Li[137]=1,Oi[137]=0,Ni[137]=0,ki[137]=1,Fi[137]=0,zi[137]=1,Bi[139]=0,Ui[139]=1,Vi[139]=1,ji[139]=0,Gi[139]=-1,$i[139]=0,qi[139]=1,Hi[139]=0,Xi[139]=0,eo[139]=0,to[139]=1,no[139]=0,Li[139]=-1,Oi[139]=0,Ni[139]=0,ki[139]=1,Fi[139]=0,zi[139]=1,Bi[98]=0,Ui[98]=-1,Vi[98]=0,ji[98]=0,Gi[98]=-1,$i[98]=1,Zi[98]=1,Wi[98]=0,Yi[98]=0,qi[98]=1,Hi[98]=0,Xi[98]=1,Ki[98]=0,Ji[98]=1,Qi[98]=0,Li[98]=-1,Oi[98]=0,Ni[98]=1,Bi[99]=0,Ui[99]=1,Vi[99]=0,ji[99]=0,Gi[99]=-1,$i[99]=1,Zi[99]=1,Wi[99]=0,Yi[99]=0,qi[99]=-1,Hi[99]=0,Xi[99]=1,Ki[99]=0,Ji[99]=-1,Qi[99]=0,Li[99]=1,Oi[99]=0,Ni[99]=1,ji[38]=0,Gi[38]=-1,$i[38]=1,Zi[38]=1,Wi[38]=0,Yi[38]=0,eo[38]=0,to[38]=1,no[38]=1,Ki[38]=0,Ji[38]=1,Qi[38]=0,Li[38]=-1,Oi[38]=0,Ni[38]=1,ki[38]=-1,Fi[38]=0,zi[38]=0,ji[39]=0,Gi[39]=1,$i[39]=1,Zi[39]=-1,Wi[39]=0,Yi[39]=0,eo[39]=0,to[39]=-1,no[39]=1,Ki[39]=0,Ji[39]=1,Qi[39]=0,Li[39]=-1,Oi[39]=0,Ni[39]=1,ki[39]=1,Fi[39]=0,zi[39]=0;var nC=function(e){return[[e.bottomleft,0],[0,0],[0,e.leftbottom]]},rC=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0]]},iC=function(e){return[[e.topright,1],[1,1],[1,e.righttop]]},oC=function(e){return[[0,e.lefttop],[0,1],[e.topleft,1]]},sC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop]]},aC=function(e){return[[e.bottomright,0],[e.bottomleft,0],[1,e.righttop],[1,e.rightbottom]]},uC=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.topleft,1],[e.topright,1]]},lC=function(e){return[[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},tr=[],Kn=[],Er=[],yr=[],Br=[],kr=[],ro=[],fo=[];yr[1]=Br[1]=18,yr[169]=Br[169]=18,Er[4]=Kn[4]=12,Er[166]=Kn[166]=12,tr[16]=fo[16]=4,tr[154]=fo[154]=4,kr[64]=ro[64]=22,kr[106]=ro[106]=22,Er[2]=kr[2]=17,yr[2]=Br[2]=18,Er[168]=kr[168]=17,yr[168]=Br[168]=18,tr[8]=yr[8]=9,Kn[8]=Er[8]=12,tr[162]=yr[162]=9,Kn[162]=Er[162]=12,tr[32]=fo[32]=4,Kn[32]=ro[32]=1,tr[138]=fo[138]=4,Kn[138]=ro[138]=1,Br[128]=fo[128]=21,kr[128]=ro[128]=22,Br[42]=fo[42]=21,kr[42]=ro[42]=22,Kn[5]=Br[5]=14,Kn[165]=Br[165]=14,Er[20]=fo[20]=6,Er[150]=fo[150]=6,tr[80]=kr[80]=11,tr[90]=kr[90]=11,yr[65]=ro[65]=3,yr[105]=ro[105]=3,tr[160]=kr[160]=11,Kn[160]=Br[160]=14,tr[10]=kr[10]=11,Kn[10]=Br[10]=14,Er[130]=fo[130]=6,yr[130]=ro[130]=3,Er[40]=fo[40]=6,yr[40]=ro[40]=3,Kn[101]=ro[101]=1,Kn[69]=ro[69]=1,Br[149]=fo[149]=21,Br[21]=fo[21]=21,Er[86]=kr[86]=17,Er[84]=kr[84]=17,tr[89]=yr[89]=9,tr[81]=yr[81]=9,tr[96]=ro[96]=0,Kn[96]=kr[96]=15,tr[74]=ro[74]=0,Kn[74]=kr[74]=15,tr[24]=Er[24]=8,yr[24]=fo[24]=7,tr[146]=Er[146]=8,yr[146]=fo[146]=7,Kn[6]=kr[6]=15,Er[6]=Br[6]=16,Kn[164]=kr[164]=15,Er[164]=Br[164]=16,yr[129]=fo[129]=7,Br[129]=ro[129]=20,yr[41]=fo[41]=7,Br[41]=ro[41]=20,Er[66]=ro[66]=2,yr[66]=kr[66]=19,Er[104]=ro[104]=2,yr[104]=kr[104]=19,tr[144]=Br[144]=10,kr[144]=fo[144]=23,tr[26]=Br[26]=10,kr[26]=fo[26]=23,Kn[36]=fo[36]=5,Er[36]=ro[36]=2,Kn[134]=fo[134]=5,Er[134]=ro[134]=2,tr[9]=Br[9]=10,Kn[9]=yr[9]=13,tr[161]=Br[161]=10,Kn[161]=yr[161]=13,Kn[37]=fo[37]=5,Br[37]=ro[37]=20,Kn[133]=fo[133]=5,Br[133]=ro[133]=20,Er[148]=Br[148]=16,kr[148]=fo[148]=23,Er[22]=Br[22]=16,kr[22]=fo[22]=23,tr[82]=Er[82]=8,yr[82]=kr[82]=19,tr[88]=Er[88]=8,yr[88]=kr[88]=19,tr[73]=ro[73]=0,Kn[73]=yr[73]=13,tr[97]=ro[97]=0,Kn[97]=yr[97]=13,tr[145]=yr[145]=9,Br[145]=fo[145]=21,tr[25]=yr[25]=9,Br[25]=fo[25]=21,Kn[70]=ro[70]=1,Er[70]=kr[70]=17,Kn[100]=ro[100]=1,Er[100]=kr[100]=17,tr[34]=yr[34]=9,Kn[34]=Er[34]=12,Br[34]=fo[34]=21,kr[34]=ro[34]=22,tr[136]=fo[136]=4,Kn[136]=ro[136]=1,Er[136]=kr[136]=17,yr[136]=Br[136]=18,tr[35]=fo[35]=4,Kn[35]=Er[35]=12,yr[35]=Br[35]=18,kr[35]=ro[35]=22,tr[153]=fo[153]=4,yr[153]=Br[153]=18,Kn[102]=Er[102]=12,kr[102]=ro[102]=22,tr[155]=yr[155]=9,Br[155]=fo[155]=23,Kn[103]=ro[103]=1,Er[103]=kr[103]=17,tr[152]=fo[152]=4,Er[152]=kr[152]=17,yr[152]=Br[152]=18,tr[156]=Er[156]=8,yr[156]=Br[156]=18,kr[156]=fo[156]=23,tr[137]=fo[137]=4,Kn[137]=ro[137]=1,yr[137]=Br[137]=18,tr[139]=fo[139]=4,Kn[139]=yr[139]=13,Br[139]=ro[139]=20,tr[98]=yr[98]=9,Kn[98]=Er[98]=12,kr[98]=ro[98]=22,tr[99]=ro[99]=0,Kn[99]=Er[99]=12,yr[99]=kr[99]=19,Kn[38]=Er[38]=12,Br[38]=fo[38]=21,kr[38]=ro[38]=22,Kn[39]=fo[39]=5,Er[39]=Br[39]=16,kr[39]=ro[39]=22;var jn=[];function nx(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function hC(e,t){return e[0]*t[1]-t[0]*e[1]}function V2(e,t,n){var r=[],o=function TB(e,t){return Y1(kE(e,t))}(t,n),c=_f(e),d=[];return c.forEach(function(_,E){if(E!==c.length-1){var C=function a6(e,t,n){var r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1]));return[[e[0]+n*(t[1]-e[1])/r,e[1]+n*(e[0]-t[0])/r],[t[0]+n*(t[1]-e[1])/r,t[1]+n*(e[0]-t[0])/r]]}(_,c[E+1],o);if(r.push(C),E>0){var A=r[E-1],R=function o6(e,t){return!function i6(e,t){return 0===hC(nx(e),nx(t))}(e,t)&&function r6(e,t){var n=e[0],r=nx(e),o=t[0],c=nx(t),d=hC(r,c),_=function t6(e,t){return[e[0]-t[0],e[1]-t[1]]}(o,n),A=function e6(e,t){return[e[0]+t[0],e[1]+t[1]]}(n,function n6(e,t){return[e*t[0],e*t[1]]}(hC(_,c)/d,r));return A}(e,t)}(C,A);!1!==R&&(A[1]=R,C[0]=R),d.push(A[0]),E===c.length-2&&(d.push(C[0]),d.push(C[1]))}2===c.length&&(d.push(C[0]),d.push(C[1]))}}),ah(d,e.properties)}jn[1]=jn[169]=nC,jn[4]=jn[166]=rC,jn[16]=jn[154]=iC,jn[64]=jn[106]=oC,jn[168]=jn[2]=sC,jn[162]=jn[8]=aC,jn[138]=jn[32]=uC,jn[42]=jn[128]=lC,jn[5]=jn[165]=function(e){return[[0,0],[0,e.leftbottom],[1,e.rightbottom],[1,0]]},jn[20]=jn[150]=function(e){return[[1,0],[e.bottomright,0],[e.topright,1],[1,1]]},jn[80]=jn[90]=function(e){return[[1,1],[1,e.righttop],[0,e.lefttop],[0,1]]},jn[65]=jn[105]=function(e){return[[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},jn[160]=jn[10]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.leftbottom],[0,e.lefttop]]},jn[130]=jn[40]=function(e){return[[e.topleft,1],[e.topright,1],[e.bottomright,0],[e.bottomleft,0]]},jn[85]=function(){return[[0,0],[0,1],[1,1],[1,0]]},jn[101]=jn[69]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,1],[e.topleft,1]]},jn[149]=jn[21]=function(e){return[[e.topright,1],[1,1],[1,0],[0,0],[0,e.leftbottom]]},jn[86]=jn[84]=function(e){return[[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[1,1]]},jn[89]=jn[81]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,1]]},jn[96]=jn[74]=function(e){return[[1,e.righttop],[1,e.rightbottom],[0,e.lefttop],[0,1],[e.topleft,1]]},jn[24]=jn[146]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[e.topright,1]]},jn[6]=jn[164]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop]]},jn[129]=jn[41]=function(e){return[[e.topright,1],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1]]},jn[66]=jn[104]=function(e){return[[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},jn[144]=jn[26]=function(e){return[[1,1],[1,e.righttop],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},jn[36]=jn[134]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[e.topleft,1],[e.topright,1]]},jn[9]=jn[161]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom]]},jn[37]=jn[133]=function(e){return[[1,e.rightbottom],[1,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},jn[148]=jn[22]=function(e){return[[1,1],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},jn[82]=jn[88]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1]]},jn[73]=jn[97]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,1],[e.topleft,1]]},jn[145]=jn[25]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},jn[70]=jn[100]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},jn[34]=function(e){return[lC(e),aC(e)]},jn[35]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]},jn[136]=function(e){return[uC(e),sC(e)]},jn[153]=function(e){return[iC(e),nC(e)]},jn[102]=function(e){return[rC(e),oC(e)]},jn[155]=function(e){return[[1,1],[1,e.righttop],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topright,1]]},jn[103]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.lefttop],[0,1],[e.topleft,1]]},jn[152]=function(e){return[iC(e),sC(e)]},jn[156]=function(e){return[[1,1],[1,e.righttop],[e.bottomright,0],[e.bottomleft,0],[0,e.leftbottom],[0,e.lefttop],[e.topright,1]]},jn[137]=function(e){return[uC(e),nC(e)]},jn[139]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomleft,0],[0,0],[0,e.leftbottom],[e.topleft,1],[e.topright,1]]},jn[98]=function(e){return[aC(e),oC(e)]},jn[99]=function(e){return[[1,e.righttop],[1,e.rightbottom],[e.bottomright,0],[e.bottomleft,0],[0,e.lefttop],[0,1],[e.topleft,1]]},jn[38]=function(e){return[rC(e),lC(e)]},jn[39]=function(e){return[[1,e.rightbottom],[1,0],[e.bottomright,0],[0,e.leftbottom],[0,e.lefttop],[e.topleft,1],[e.topright,1]]};const j2=function s6(e,t,n){if(!function DB(e){return!!e&&e.constructor===Object}(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var o=BE(e),c=e.properties;switch(o){case"LineString":return V2(e,t,r);case"MultiLineString":var d=[];return Zd(e,function(_){d.push(V2(_,t,r).geometry.coordinates)}),function HM(e,t,n){return void 0===n&&(n={}),Nh({type:"MultiLineString",coordinates:e},t,n)}(d,c);default:throw new Error("geometry "+o+" is not supported")}};function fC(e,t,n){return function u6(e){return(e>0)-(e<0)||+e}((t[0]-e[0])*(n[1]-t[1])-(n[0]-t[0])*(t[1]-e[1]))}function G2(e,t){return t.geometry.coordinates[0].every(function(n){return t2(kh(n),e)})}const $2=function(){function e(t){this.id=e.buildId(t),this.coordinates=t,this.innerEdges=[],this.outerEdges=[],this.outerEdgesSorted=!1}return e.buildId=function(t){return t.join(",")},e.prototype.removeInnerEdge=function(t){this.innerEdges=this.innerEdges.filter(function(n){return n.from.id!==t.from.id})},e.prototype.removeOuterEdge=function(t){this.outerEdges=this.outerEdges.filter(function(n){return n.to.id!==t.to.id})},e.prototype.addOuterEdge=function(t){this.outerEdges.push(t),this.outerEdgesSorted=!1},e.prototype.sortOuterEdges=function(){var t=this;this.outerEdgesSorted||(this.outerEdges.sort(function(n,r){var o=n.to,c=r.to;if(o.coordinates[0]-t.coordinates[0]>=0&&c.coordinates[0]-t.coordinates[0]<0)return 1;if(o.coordinates[0]-t.coordinates[0]<0&&c.coordinates[0]-t.coordinates[0]>=0)return-1;if(o.coordinates[0]-t.coordinates[0]==0&&c.coordinates[0]-t.coordinates[0]==0)return o.coordinates[1]-t.coordinates[1]>=0||c.coordinates[1]-t.coordinates[1]>=0?o.coordinates[1]-c.coordinates[1]:c.coordinates[1]-o.coordinates[1];var d=fC(t.coordinates,o.coordinates,c.coordinates);return d<0?1:d>0?-1:Math.pow(o.coordinates[0]-t.coordinates[0],2)+Math.pow(o.coordinates[1]-t.coordinates[1],2)-(Math.pow(c.coordinates[0]-t.coordinates[0],2)+Math.pow(c.coordinates[1]-t.coordinates[1],2))}),this.outerEdgesSorted=!0)},e.prototype.getOuterEdges=function(){return this.sortOuterEdges(),this.outerEdges},e.prototype.getOuterEdge=function(t){return this.sortOuterEdges(),this.outerEdges[t]},e.prototype.addInnerEdge=function(t){this.innerEdges.push(t)},e}(),d6=function(){function e(t,n){this.from=t,this.to=n,this.next=void 0,this.label=void 0,this.symetric=void 0,this.ring=void 0,this.from.addOuterEdge(this),this.to.addInnerEdge(this)}return e.prototype.getSymetric=function(){return this.symetric||(this.symetric=new e(this.to,this.from),this.symetric.symetric=this),this.symetric},e.prototype.deleteEdge=function(){this.from.removeOuterEdge(this),this.to.removeInnerEdge(this)},e.prototype.isEqual=function(t){return this.from.id===t.from.id&&this.to.id===t.to.id},e.prototype.toString=function(){return"Edge { "+this.from.id+" -> "+this.to.id+" }"},e.prototype.toLineString=function(){return ah([this.from.coordinates,this.to.coordinates])},e.prototype.compareTo=function(t){return fC(t.from.coordinates,t.to.coordinates,this.to.coordinates)},e}(),g6=function(){function e(){this.edges=[],this.polygon=void 0,this.envelope=void 0}return e.prototype.push=function(t){this.edges.push(t),this.polygon=this.envelope=void 0},e.prototype.get=function(t){return this.edges[t]},Object.defineProperty(e.prototype,"length",{get:function(){return this.edges.length},enumerable:!0,configurable:!0}),e.prototype.forEach=function(t){this.edges.forEach(t)},e.prototype.map=function(t){return this.edges.map(t)},e.prototype.some=function(t){return this.edges.some(t)},e.prototype.isValid=function(){return!0},e.prototype.isHole=function(){var t=this,n=this.edges.reduce(function(d,_,E){return _.from.coordinates[1]>t.edges[d].from.coordinates[1]&&(d=E),d},0),r=(0===n?this.length:n)-1,o=(n+1)%this.length,c=fC(this.edges[r].from.coordinates,this.edges[n].from.coordinates,this.edges[o].from.coordinates);return 0===c?this.edges[r].from.coordinates[0]>this.edges[o].from.coordinates[0]:c>0},e.prototype.toMultiPoint=function(){return function XM(e,t,n){return void 0===n&&(n={}),Nh({type:"MultiPoint",coordinates:e},t,n)}(this.edges.map(function(t){return t.from.coordinates}))},e.prototype.toPolygon=function(){if(this.polygon)return this.polygon;var t=this.edges.map(function(n){return n.from.coordinates});return t.push(this.edges[0].from.coordinates),this.polygon=W1([t])},e.prototype.getEnvelope=function(){return this.envelope?this.envelope:this.envelope=function d4(e){return function f4(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),o=Number(e[2]),c=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var d=[n,r];return W1([[d,[o,r],[o,c],[n,c],d]],t.properties,{bbox:e,id:t.id})}(YM(e))}(this.toPolygon())},e.findEdgeRingContaining=function(t,n){var o,c,r=t.getEnvelope();return n.forEach(function(d){var _=d.getEnvelope();if(c&&(o=c.getEnvelope()),!function l6(e,t){var n=e.geometry.coordinates[0].map(function(d){return d[0]}),r=e.geometry.coordinates[0].map(function(d){return d[1]}),o=t.geometry.coordinates[0].map(function(d){return d[0]}),c=t.geometry.coordinates[0].map(function(d){return d[1]});return Math.max.apply(null,n)===Math.max.apply(null,o)&&Math.max.apply(null,r)===Math.max.apply(null,c)&&Math.min.apply(null,n)===Math.min.apply(null,o)&&Math.min.apply(null,r)===Math.min.apply(null,c)}(_,r)&&G2(_,r)){for(var E=t.map(function(Q){return Q.from.coordinates}),C=void 0,A=function(Q){d.some(function(ee){return function c6(e,t){return e[0]===t[0]&&e[1]===t[1]}(Q,ee.from.coordinates)})||(C=Q)},R=0,N=E;R<N.length;R++)A(N[R]);C&&d.inside(kh(C))&&(!c||G2(o,_))&&(c=d)}}),c},e.prototype.inside=function(t){return t2(t,this.toPolygon())},e}();function Q2(e){for(var t=e,n=[];t.parent;)n.unshift(t),t=t.parent;return n}!function(){function e(){this.edges=[],this.nodes={}}e.fromGeoJson=function(t){!function m6(e){if(!e)throw new Error("No geojson passed");if("FeatureCollection"!==e.type&&"GeometryCollection"!==e.type&&"MultiLineString"!==e.type&&"LineString"!==e.type&&"Feature"!==e.type)throw new Error("Invalid input type '"+e.type+"'. Geojson must be FeatureCollection, GeometryCollection, LineString, MultiLineString or Feature")}(t);var n=new e;return Zd(t,function(r){(function kB(e,t,n){if(!e)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!e||"Feature"!==e.type||!e.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!e.geometry||e.geometry.type!==t)throw new Error("Invalid input to "+n+": must be a "+t+", given "+e.geometry.type)})(r,"LineString","Graph::fromGeoJson"),function MB(e,t,n,r){var o=n;ym(e,function(c,d,_,E,C){o=0===d&&void 0===n?c:t(o,c,d,_,E,C)},r)}(r,function(o,c){if(o){var d=n.getNode(o),_=n.getNode(c);n.addEdge(d,_)}return c})}),n},e.prototype.getNode=function(t){var n=$2.buildId(t),r=this.nodes[n];return r||(r=this.nodes[n]=new $2(t)),r},e.prototype.addEdge=function(t,n){var r=new d6(t,n),o=r.getSymetric();this.edges.push(r),this.edges.push(o)},e.prototype.deleteDangles=function(){var t=this;Object.keys(this.nodes).map(function(n){return t.nodes[n]}).forEach(function(n){return t._removeIfDangle(n)})},e.prototype._removeIfDangle=function(t){var n=this;if(t.innerEdges.length<=1){var r=t.getOuterEdges().map(function(o){return o.to});this.removeNode(t),r.forEach(function(o){return n._removeIfDangle(o)})}},e.prototype.deleteCutEdges=function(){var t=this;this._computeNextCWEdges(),this._findLabeledEdgeRings(),this.edges.forEach(function(n){n.label===n.symetric.label&&(t.removeEdge(n.symetric),t.removeEdge(n))})},e.prototype._computeNextCWEdges=function(t){var n=this;typeof t>"u"?Object.keys(this.nodes).forEach(function(r){return n._computeNextCWEdges(n.nodes[r])}):t.getOuterEdges().forEach(function(r,o){t.getOuterEdge((0===o?t.getOuterEdges().length:o)-1).symetric.next=r})},e.prototype._computeNextCCWEdges=function(t,n){for(var o,c,r=t.getOuterEdges(),d=r.length-1;d>=0;--d){var _=r[d],E=_.symetric,C=void 0,A=void 0;_.label===n&&(C=_),E.label===n&&(A=E),C&&A&&(A&&(c=A),C&&(c&&(c.next=C,c=void 0),o||(o=C)))}c&&(c.next=o)},e.prototype._findLabeledEdgeRings=function(){var t=[],n=0;return this.edges.forEach(function(r){if(!(r.label>=0)){t.push(r);var o=r;do{o.label=n,o=o.next}while(!r.isEqual(o));n++}}),t},e.prototype.getEdgeRings=function(){var t=this;this._computeNextCWEdges(),this.edges.forEach(function(r){r.label=void 0}),this._findLabeledEdgeRings().forEach(function(r){t._findIntersectionNodes(r).forEach(function(o){t._computeNextCCWEdges(o,r.label)})});var n=[];return this.edges.forEach(function(r){r.ring||n.push(t._findEdgeRing(r))}),n},e.prototype._findIntersectionNodes=function(t){var n=[],r=t,o=function(){var c=0;r.from.getOuterEdges().forEach(function(d){d.label===t.label&&++c}),c>1&&n.push(r.from),r=r.next};do{o()}while(!t.isEqual(r));return n},e.prototype._findEdgeRing=function(t){var n=t,r=new g6;do{r.push(n),n.ring=r,n=n.next}while(!t.isEqual(n));return r},e.prototype.removeNode=function(t){var n=this;t.getOuterEdges().forEach(function(r){return n.removeEdge(r)}),t.innerEdges.forEach(function(r){return n.removeEdge(r)}),delete this.nodes[t.id]},e.prototype.removeEdge=function(t){this.edges=this.edges.filter(function(n){return!n.isEqual(t)}),t.deleteEdge()}}(),je(5013),je(7470),je(9475);var rx={search:function(e,t,n,r){e.cleanDirty();var o=(r=r||{}).heuristic||rx.heuristics.manhattan,c=r.closest||!1,d=function R6(){return new eA(function(e){return e.f})}(),_=t;for(t.h=o(t,n),d.push(t);d.size()>0;){var E=d.pop();if(E===n)return Q2(E);E.closed=!0;for(var C=e.neighbors(E),A=0,R=C.length;A<R;++A){var N=C[A];if(!N.closed&&!N.isWall()){var z=E.g+N.getCost(E),Q=N.visited;(!Q||z<N.g)&&(N.visited=!0,N.parent=E,N.h=N.h||o(N,n),N.g=z,N.f=N.g+N.h,e.markDirty(N),c&&(N.h<_.h||N.h===_.h&&N.g<_.g)&&(_=N),Q?d.rescoreElement(N):d.push(N))}}}return c?Q2(_):[]},heuristics:{manhattan:function(e,t){return Math.abs(t.x-e.x)+Math.abs(t.y-e.y)},diagonal:function(e,t){var r=Math.sqrt(2),o=Math.abs(t.x-e.x),c=Math.abs(t.y-e.y);return 1*(o+c)+(r-2)*Math.min(o,c)}},cleanNode:function(e){e.f=0,e.g=0,e.h=0,e.visited=!1,e.closed=!1,e.parent=null}};function vm(e,t){t=t||{},this.nodes=[],this.diagonal=!!t.diagonal,this.grid=[];for(var n=0;n<e.length;n++){this.grid[n]=[];for(var r=0,o=e[n];r<o.length;r++){var c=new ix(n,r,o[r]);this.grid[n][r]=c,this.nodes.push(c)}}this.init()}function ix(e,t,n){this.x=e,this.y=t,this.weight=n}function eA(e){this.content=[],this.scoreFunction=e}function pC(){this._=null}function ox(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function K_(e,t){var n=t,r=t.R,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function J_(e,t){var n=t,r=t.L,o=n.U;o?o.L===n?o.L=r:o.R=r:e._=r,r.U=o,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function tA(e){for(;e.L;)e=e.L;return e}vm.prototype.init=function(){this.dirtyNodes=[];for(var e=0;e<this.nodes.length;e++)rx.cleanNode(this.nodes[e])},vm.prototype.cleanDirty=function(){for(var e=0;e<this.dirtyNodes.length;e++)rx.cleanNode(this.dirtyNodes[e]);this.dirtyNodes=[]},vm.prototype.markDirty=function(e){this.dirtyNodes.push(e)},vm.prototype.neighbors=function(e){var t=[],n=e.x,r=e.y,o=this.grid;return o[n-1]&&o[n-1][r]&&t.push(o[n-1][r]),o[n+1]&&o[n+1][r]&&t.push(o[n+1][r]),o[n]&&o[n][r-1]&&t.push(o[n][r-1]),o[n]&&o[n][r+1]&&t.push(o[n][r+1]),this.diagonal&&(o[n-1]&&o[n-1][r-1]&&t.push(o[n-1][r-1]),o[n+1]&&o[n+1][r-1]&&t.push(o[n+1][r-1]),o[n-1]&&o[n-1][r+1]&&t.push(o[n-1][r+1]),o[n+1]&&o[n+1][r+1]&&t.push(o[n+1][r+1])),t},vm.prototype.toString=function(){for(var n,r,o,c,e=[],t=this.grid,d=0,_=t.length;d<_;d++){for(n=[],o=0,c=(r=t[d]).length;o<c;o++)n.push(r[o].weight);e.push(n.join(" "))}return e.join("\n")},ix.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},ix.prototype.getCost=function(e){return e&&e.x!==this.x&&e.y!==this.y?1.41421*this.weight:this.weight},ix.prototype.isWall=function(){return 0===this.weight},eA.prototype={push:function(e){this.content.push(e),this.sinkDown(this.content.length-1)},pop:function(){var e=this.content[0],t=this.content.pop();return this.content.length>0&&(this.content[0]=t,this.bubbleUp(0)),e},remove:function(e){var t=this.content.indexOf(e),n=this.content.pop();t!==this.content.length-1&&(this.content[t]=n,this.scoreFunction(n)<this.scoreFunction(e)?this.sinkDown(t):this.bubbleUp(t))},size:function(){return this.content.length},rescoreElement:function(e){this.sinkDown(this.content.indexOf(e))},sinkDown:function(e){for(var t=this.content[e];e>0;){var n=(e+1>>1)-1,r=this.content[n];if(!(this.scoreFunction(t)<this.scoreFunction(r)))break;this.content[n]=t,this.content[e]=r,e=n}},bubbleUp:function(e){for(var t=this.content.length,n=this.content[e],r=this.scoreFunction(n);;){var _,o=e+1<<1,c=o-1,d=null;if(c<t&&(_=this.scoreFunction(this.content[c]))<r&&(d=c),o<t&&this.scoreFunction(this.content[o])<(null===d?r:_)&&(d=o),null===d)break;this.content[e]=this.content[d],this.content[d]=n,e=d}}},pC.prototype={constructor:pC,insert:function(e,t){var n,r,o;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=tA(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(r=n.U).L?(o=r.R)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.R&&(K_(this,n),n=(e=n).U),n.C=!1,r.C=!0,J_(this,r)):(o=r.L)&&o.C?(n.C=o.C=!1,r.C=!0,e=r):(e===n.L&&(J_(this,n),n=(e=n).U),n.C=!1,r.C=!0,K_(this,r)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var n,c,d,t=e.U,r=e.L,o=e.R;if(c=r?o?tA(o):r:o,t?t.L===e?t.L=c:t.R=c:this._=c,r&&o?(d=c.C,c.C=e.C,c.L=r,r.U=c,c!==o?(t=c.U,c.U=e.U,t.L=e=c.R,c.R=o,o.U=c):(c.U=t,t=c,e=c.R)):(d=e.C,e=c),e&&(e.U=t),!d){if(e&&e.C)return void(e.C=!1);do{if(e===this._)break;if(e===t.L){if((n=t.R).C&&(n.C=!1,t.C=!0,K_(this,t),n=t.R),n.L&&n.L.C||n.R&&n.R.C){(!n.R||!n.R.C)&&(n.L.C=!1,n.C=!0,J_(this,n),n=t.R),n.C=t.C,t.C=n.R.C=!1,K_(this,t),e=this._;break}}else if((n=t.L).C&&(n.C=!1,t.C=!0,J_(this,t),n=t.L),n.L&&n.L.C||n.R&&n.R.C){(!n.L||!n.L.C)&&(n.R.C=!1,n.C=!0,K_(this,n),n=t.L),n.C=t.C,t.C=n.L.C=!1,J_(this,t),e=this._;break}n.C=!0,e=t,t=t.U}while(!e.C);e&&(e.C=!1)}}};const nA=pC;function Q_(e,t,n,r){var o=[null,null],c=fl.push(o)-1;return o.left=e,o.right=t,n&&sx(o,e,t,n),r&&sx(o,t,e,r),kc[e.index].halfedges.push(c),kc[t.index].halfedges.push(c),o}function e0(e,t,n){var r=[t,n];return r.left=e,r}function sx(e,t,n,r){e[0]||e[1]?e.left===n?e[1]=r:e[0]=r:(e[0]=r,e.left=t,e.right=n)}function O6(e,t,n,r,o){var ee,c=e[0],d=e[1],_=c[0],E=c[1],R=0,N=1,z=d[0]-_,Q=d[1]-E;if(ee=t-_,z||!(ee>0)){if(ee/=z,z<0){if(ee<R)return;ee<N&&(N=ee)}else if(z>0){if(ee>N)return;ee>R&&(R=ee)}if(ee=r-_,z||!(ee<0)){if(ee/=z,z<0){if(ee>N)return;ee>R&&(R=ee)}else if(z>0){if(ee<R)return;ee<N&&(N=ee)}if(ee=n-E,Q||!(ee>0)){if(ee/=Q,Q<0){if(ee<R)return;ee<N&&(N=ee)}else if(Q>0){if(ee>N)return;ee>R&&(R=ee)}if(ee=o-E,Q||!(ee<0)){if(ee/=Q,Q<0){if(ee>N)return;ee>R&&(R=ee)}else if(Q>0){if(ee<R)return;ee<N&&(N=ee)}return!(R>0)&&!(N<1)||(R>0&&(e[0]=[_+R*z,E+R*Q]),N<1&&(e[1]=[_+N*z,E+N*Q])),!0}}}}}function N6(e,t,n,r,o){var c=e[1];if(c)return!0;var ee,Te,d=e[0],_=e.left,E=e.right,C=_[0],A=_[1],R=E[0],N=E[1],z=(C+R)/2;if(N===A){if(z<t||z>=r)return;if(C>R){if(d){if(d[1]>=o)return}else d=[z,n];c=[z,o]}else{if(d){if(d[1]<n)return}else d=[z,o];c=[z,n]}}else if(Te=(A+N)/2-(ee=(C-R)/(N-A))*z,ee<-1||ee>1)if(C>R){if(d){if(d[1]>=o)return}else d=[(n-Te)/ee,n];c=[(o-Te)/ee,o]}else{if(d){if(d[1]<n)return}else d=[(o-Te)/ee,o];c=[(n-Te)/ee,n]}else if(A<N){if(d){if(d[0]>=r)return}else d=[t,ee*t+Te];c=[r,ee*r+Te]}else{if(d){if(d[0]<t)return}else d=[r,ee*r+Te];c=[t,ee*t+Te]}return e[0]=d,e[1]=c,!0}function z6(e,t){var n=e.site,r=t.left,o=t.right;return n===o&&(o=r,r=n),o?Math.atan2(o[1]-r[1],o[0]-r[0]):(n===r?(r=t[1],o=t[0]):(r=t[0],o=t[1]),Math.atan2(r[0]-o[0],o[1]-r[1]))}function rA(e,t){return t[+(t.left!==e.site)]}function B6(e,t){return t[+(t.left===e.site)]}var gC,iA=[];function j6(){ox(this),this.x=this.y=this.arc=this.site=this.cy=null}function xm(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,o=e.site,c=n.site;if(r!==c){var d=o[0],_=o[1],E=r[0]-d,C=r[1]-_,A=c[0]-d,R=c[1]-_,N=2*(E*R-C*A);if(!(N>=-X6)){var z=E*E+C*C,Q=A*A+R*R,ee=(R*z-C*Q)/N,Te=(E*Q-A*z)/N,me=iA.pop()||new j6;me.arc=e,me.site=o,me.x=ee+d,me.y=(me.cy=Te+_)+Math.sqrt(ee*ee+Te*Te),e.circle=me;for(var ie=null,oe=t0._;oe;)if(me.y<oe.y||me.y===oe.y&&me.x<=oe.x){if(!oe.L){ie=oe.P;break}oe=oe.L}else{if(!oe.R){ie=oe;break}oe=oe.R}t0.insert(ie,me),ie||(gC=me)}}}}function wm(e){var t=e.circle;t&&(t.P||(gC=t.N),t0.remove(t),iA.push(t),ox(t),e.circle=null)}var oA=[];function G6(){ox(this),this.edge=this.site=this.circle=null}function sA(e){var t=oA.pop()||new G6;return t.site=e,t}function mC(e){wm(e),bm.remove(e),oA.push(e),ox(e)}function $6(e){var t=e.circle,n=t.x,r=t.cy,o=[n,r],c=e.P,d=e.N,_=[e];mC(e);for(var E=c;E.circle&&Math.abs(n-E.circle.x)<ca&&Math.abs(r-E.circle.cy)<ca;)c=E.P,_.unshift(E),mC(E),E=c;_.unshift(E),wm(E);for(var C=d;C.circle&&Math.abs(n-C.circle.x)<ca&&Math.abs(r-C.circle.cy)<ca;)d=C.N,_.push(C),mC(C),C=d;_.push(C),wm(C);var R,A=_.length;for(R=1;R<A;++R)sx((C=_[R]).edge,(E=_[R-1]).site,C.site,o);(C=_[A-1]).edge=Q_((E=_[0]).site,C.site,null,o),xm(E),xm(C)}function q6(e){for(var r,o,c,d,t=e[0],n=e[1],_=bm._;_;)if((c=aA(_,n)-t)>ca)_=_.L;else{if(!((d=t-H6(_,n))>ca)){c>-ca?(r=_.P,o=_):d>-ca?(r=_,o=_.N):r=o=_;break}if(!_.R){r=_;break}_=_.R}!function F6(e){kc[e.index]={site:e,halfedges:[]}}(e);var E=sA(e);if(bm.insert(r,E),r||o){if(r===o)return wm(r),o=sA(r.site),bm.insert(E,o),E.edge=o.edge=Q_(r.site,E.site),xm(r),void xm(o);if(!o)return void(E.edge=Q_(r.site,E.site));wm(r),wm(o);var C=r.site,A=C[0],R=C[1],N=e[0]-A,z=e[1]-R,Q=o.site,ee=Q[0]-A,Te=Q[1]-R,me=2*(N*Te-z*ee),ie=N*N+z*z,oe=ee*ee+Te*Te,Ke=[(Te*ie-z*oe)/me+A,(N*oe-ee*ie)/me+R];sx(o.edge,C,Q,Ke),E.edge=Q_(C,e,null,Ke),o.edge=Q_(e,Q,null,Ke),xm(r),xm(o)}}function aA(e,t){var n=e.site,r=n[0],o=n[1],c=o-t;if(!c)return r;var d=e.P;if(!d)return-1/0;var _=(n=d.site)[0],E=n[1],C=E-t;if(!C)return _;var A=_-r,R=1/c-1/C,N=A/C;return R?(-N+Math.sqrt(N*N-2*R*(A*A/(-2*C)-E+C/2+o-c/2)))/R+r:(r+_)/2}function H6(e,t){var n=e.N;if(n)return aA(n,t);var r=e.site;return r[1]===t?r[0]:1/0}var bm,kc,t0,fl,ca=1e-6,X6=1e-12;function Z6(e,t,n){return(e[0]-n[0])*(t[1]-e[1])-(e[0]-t[0])*(n[1]-e[1])}function W6(e,t){return t[1]-e[1]||t[0]-e[0]}function uA(e,t){var r,o,c,n=e.sort(W6).pop();for(fl=[],kc=new Array(e.length),bm=new nA,t0=new nA;;)if(c=gC,n&&(!c||n[1]<c.y||n[1]===c.y&&n[0]<c.x))(n[0]!==r||n[1]!==o)&&(q6(n),r=n[0],o=n[1]),n=e.pop();else{if(!c)break;$6(c.arc)}if(function U6(){for(var n,r,o,c,e=0,t=kc.length;e<t;++e)if((n=kc[e])&&(c=(r=n.halfedges).length)){var d=new Array(c),_=new Array(c);for(o=0;o<c;++o)d[o]=o,_[o]=z6(n,fl[r[o]]);for(d.sort(function(E,C){return _[C]-_[E]}),o=0;o<c;++o)_[o]=r[d[o]];for(o=0;o<c;++o)r[o]=_[o]}}(),t){var d=+t[0][0],_=+t[0][1],E=+t[1][0],C=+t[1][1];(function k6(e,t,n,r){for(var c,o=fl.length;o--;)N6(c=fl[o],e,t,n,r)&&O6(c,e,t,n,r)&&(Math.abs(c[0][0]-c[1][0])>ca||Math.abs(c[0][1]-c[1][1])>ca)||delete fl[o]})(d,_,E,C),function V6(e,t,n,r){var c,d,_,E,C,A,R,N,z,Q,ee,Te,o=kc.length,me=!0;for(c=0;c<o;++c)if(d=kc[c]){for(_=d.site,E=(C=d.halfedges).length;E--;)fl[C[E]]||C.splice(E,1);for(E=0,A=C.length;E<A;)ee=(Q=B6(d,fl[C[E]]))[0],Te=Q[1],N=(R=rA(d,fl[C[++E%A]]))[0],z=R[1],(Math.abs(ee-N)>ca||Math.abs(Te-z)>ca)&&(C.splice(E,0,fl.push(e0(_,Q,Math.abs(ee-e)<ca&&r-Te>ca?[e,Math.abs(N-e)<ca?z:r]:Math.abs(Te-r)<ca&&n-ee>ca?[Math.abs(z-r)<ca?N:n,r]:Math.abs(ee-n)<ca&&Te-t>ca?[n,Math.abs(N-n)<ca?z:t]:Math.abs(Te-t)<ca&&ee-e>ca?[Math.abs(z-t)<ca?N:e,t]:null))-1),++A);A&&(me=!1)}if(me){var ie,oe,Ke,ot=1/0;for(c=0,me=null;c<o;++c)(d=kc[c])&&(Ke=(ie=(_=d.site)[0]-e)*ie+(oe=_[1]-t)*oe)<ot&&(ot=Ke,me=d);if(me){var Et=[e,t],Tt=[e,r],qt=[n,r],Je=[n,t];me.halfedges.push(fl.push(e0(_=me.site,Et,Tt))-1,fl.push(e0(_,Tt,qt))-1,fl.push(e0(_,qt,Je))-1,fl.push(e0(_,Je,Et))-1)}}for(c=0;c<o;++c)(d=kc[c])&&(d.halfedges.length||delete kc[c])}(d,_,E,C)}this.edges=fl,this.cells=kc,bm=t0=fl=kc=null}function Wd(){return new ax}function ax(){this.reset()}uA.prototype={constructor:uA,polygons:function(){var e=this.edges;return this.cells.map(function(t){var n=t.halfedges.map(function(r){return rA(t,e[r])});return n.data=t.site.data,n})},triangles:function(){var e=[],t=this.edges;return this.cells.forEach(function(n,r){if(_=(c=n.halfedges).length)for(var c,_,E,o=n.site,d=-1,C=t[c[_-1]],A=C.left===o?C.right:C.left;++d<_;)E=A,A=(C=t[c[d]]).left===o?C.right:C.left,E&&A&&r<E.index&&r<A.index&&Z6(o,E,A)<0&&e.push([o.data,E.data,A.data])}),e},links:function(){return this.edges.filter(function(e){return e.right}).map(function(e){return{source:e.left.data,target:e.right.data}})},find:function(e,t,n){for(var o,_,r=this,c=r._found||0,d=r.cells.length;!(_=r.cells[c]);)if(++c>=d)return null;var E=e-_.site[0],C=t-_.site[1],A=E*E+C*C;do{_=r.cells[o=c],c=null,_.halfedges.forEach(function(R){var N=r.edges[R],z=N.left;if(z!==_.site&&z||(z=N.right)){var Q=e-z[0],ee=t-z[1],Te=Q*Q+ee*ee;Te<A&&(A=Te,c=z.index)}})}while(null!==c);return r._found=o,null==n||A<=n*n?_.site:null}},je(9855),je(770),ax.prototype={constructor:ax,reset:function(){this.s=this.t=0},add:function(e){vA(ux,e,this.t),vA(this,ux.s,this.s),this.s?this.t+=ux.t:this.s=ux.t},valueOf:function(){return this.s}};var ux=new ax;function vA(e,t,n){var r=e.s=t+n,o=r-t;e.t=t-(r-o)+(n-o)}var xa=Math.PI,lc=xa/2,Em=2*xa,na=xa/180,n0=(Math,Math.atan),Cm=Math.atan2,Vo=Math.cos,po=(Math,Math,Math,Math,Math,Math.sin),id=(Math,Math.sqrt);Math;function Sm(e){return e>1?lc:e<-1?-lc:Math.asin(e)}function AC(e,t){return[e>xa?e-Em:e<-xa?e+Em:e,t]}function HA(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}Wd(),Wd(),Wd(),AC.invert=AC,function TU(e){1===e.length&&(e=function DU(e){return function(t,n){return HA(e(t),n)}}(e))}(HA),Math.sqrt(50),Math.sqrt(10),Math.sqrt(2);Wd();function WC(){}function _P(e){return function(t,n){var r=Vo(t),o=Vo(n),c=e(r*o);return[c*o*po(t),c*po(n)]}}function d0(e){return function(t,n){var r=id(t*t+n*n),o=e(r),c=po(o),d=Vo(o);return[Cm(t*c,r*d),Sm(r&&n*c/r)]}}function KC(e,t){return[e,t]}Wd(),Wd(),Wd(),Wd(),function gP(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}(4.5),WC.prototype={constructor:WC,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Vo(30*na),function mP(e){return function(t){var n=new WC;for(var r in e)n[r]=e[r];return n.stream=t,n}}({point:function(e,t){this.stream.point(e*na,t*na)}}),_P(function(e){return id(2/(1+e))}).invert=d0(function(e){return 2*Sm(e/2)}),_P(function(e){return(e=function lU(e){return e>1?0:e<-1?xa:Math.acos(e)}(e))&&e/po(e)}).invert=d0(function(e){return e}),KC.invert=KC,d0(n0),d0(Sm),d0(function(e){return 2*n0(e)});class Am{constructor(){this.StaticResponsePath=[83.54592383995985,83.66604339094793,85.7233517978466,89.32372374481614,91.04418973655731,92.98289938848714,95.3677139742127,97.20158198158269,99.9977251166281,101.0136902480268,101.53611449006354,103.17964870998074,105.47952193583274,105.81562278287697,107.77017433246105,112.37052259177301,115.34722151762193,116.9826096413085,116.89600000023825,117.2085122003029,118.61518398344755,121.02803947102316,122.94015461237213,125.25119403364941,126.3546550978425,129.35773341664057,135.73747352721838,137.45696217567652,135.66942265080777,135.43113444140684,135.57729992807512,135.85339509155406,135.9206543484332,135.64389576618433,135.44337844896464,134.1951851617246,132.3355643845925,135.272216603538,137.82543000606438,141.29258740846504,140.13645524071362,139.26357700003066,141.07335452286245,143.9437645784251,142.44702003201496,143.01461074849522,142.579383399436,144.38194988405223,144.56343091244509,144.78798498369304,145.26871171758813,145.7374102677896,146.20411818299294,146.59360224427564,147.26271135960164,148.61135364922671,149.58585972931263,152.08393340830807,153.97959210014034,155.66931507086738,156.0769607781915,154.80205073061438,154.64873119122956,156.06025272007264,154.6690303278766,156.47867482779586,158.39990128706444,158.45348540477866,157.3040081616003,157.56535920824928,160.57822213634017,163.65572062158452,165.05181936718904,165.49193466366157,163.714863807246,167.343791200007,166.89316043812914,165.46018610336588,165.9352888453371,166.2542405121372,166.16149095691517,164.09418268195657,163.6690203024068,168.1920862622679,166.0508464706585,166.31442741389696,167.55717758222744,169.45074358467068,170.6106054071749,170.09592535725278,168.44520424174974,171.63947931046286,171.03663678749396,175.00095710831857,176.0120696909829,175.34137627532579,174.70280337474378,174.53385024923773,174.98008566321278,177.31513516938426],this.StaticResponseCrossSection=[123.01793489999773,123.47380200902535,123.92966911585381,124.3855362172335,124.8414033136255,125.29727040671742,125.75313749617635,126.20900458098049,126.66487165977378,127.12073873644295,127.57660580845732,128.03247287604745,128.48833994056668,128.94420699899865,129.4000740551537,129.855941106729,130.31180815301104,130.7676751957365,131.22354223388356,131.67940926888468,132.13527629859118,132.5911433238707,133.04701034600566,133.4964034392993,133.93403829469185,134.3715524280052,134.80894583932346,135.24621853027654,135.6833704992858,136.12040174689557,136.55731227577343,136.9941020853823,137.4307711750232,137.86731954660456,138.30374719991136,138.74005413592954,139.1762403545709,139.61230585841946,140.04825064367617,140.48407471440495,140.9197780689731,141.3553607105502,141.7908226376504,142.2261638500151,142.6613843494089,143.09648413575033,143.53146320947153,143.96632157306902,144.40105922366533,144.8356761630683,145.27017239309347,145.70454791287963,146.13880272424504,146.57293682500918,147.03999141350045,147.54646466255076,148.0530586212511,148.5597732875848,149.06660866184808,149.5735647459971,150.08064153545618,150.5878390322516,151.09515723743368,151.60259614656422,152.11015576152428,152.61783608112214,153.12563710484108,153.63355883380595,154.14160126509125,154.6497643999189,155.15804823765976,155.6664527763918,156.17497801793255,156.6836239603749,157.19239060381625,157.70127794548992,158.21028598725943,158.71941473044038,159.22866417029928,159.73803431055705,160.24752514659926,160.75713668129384,161.2668689115459,161.77672183949835,162.28669546212393,162.77879638131,163.25664928526055,163.7346228836427,164.21271717562632,164.6909321626637,165.1692678393532,165.64772421097751,166.126301272637,166.6049990275229,167.083817471397,167.56275660697116,168.04181643217936,168.52099694739337,169.00029815034057,169.47972004234413]}getElevation(t){const n=ah(t),r=v2(n);let o=0,c=r/100;return Array(100).fill(void 0).map(()=>{const E=_2(n,o).geometry.coordinates;return o+=c,[E[1],E[0]]}),Promise.resolve([])}}Am.\u0275fac=function(t){return new(t||Am)},Am.\u0275prov=kn({token:Am,factory:Am.\u0275fac,providedIn:"root"});var w8=je(9898),AP=je.n(w8),Kd=(()=>{return(e=Kd||(Kd={})).addMidPoint=t=>{const r=_2(t,v2(t)/2),o=J4(t,r),c=o.features[0],d=o.features[0].geometry.coordinates.length-1;return o.features[1].geometry.coordinates.shift(),c.geometry.coordinates=c.geometry.coordinates.concat(o.features[1].geometry.coordinates),{lineString:c,index:d}},e.getPointFeature=(t,n)=>({geometry:{coordinates:t,type:"Point"},properties:n,type:"Feature"}),e.getCrossSectionCoordinates=(t,n,r)=>{const o=j2(n,-t,{units:"meters"}),c=j2(n,t,{units:"meters"});return[o.geometry.coordinates[r],c.geometry.coordinates[r]]},Kd;var e})();class Pm{constructor(){AP().accessToken="pk.eyJ1IjoiZGF4diIsImEiOiJjbGI0anR1dGgwb3lmM3ZwY2tiaThxaXViIn0.znSK1EzGg_qMEMZBEKGqdA"}renderMap(t,n,r,o,c){this.map=new(AP().Map)({style:"mapbox://styles/mapbox/streets-v12",container:t,center:n,zoom:r}),this.lineString=o,this.midPointIndex=c,this.draw()}fetchImages(t){return Promise.all(t.map(n=>new Promise((r,o)=>{this.map.loadImage(n.url,(c,d)=>{if(c)throw c;this.map.addImage(n.id,d),r()})})))}draw(){this.map.on("load",()=>{!this.lineString||!this.midPointIndex||(this.map.addSource("route",{type:"geojson",data:this.lineString}),this.map.addSource("points",{type:"geojson",data:{type:"FeatureCollection",features:[Kd.getPointFeature(this.lineString.geometry.coordinates[0],{icon:"marker-a"}),Kd.getPointFeature(this.lineString.geometry.coordinates[this.midPointIndex],{icon:"marker-road"}),Kd.getPointFeature(this.lineString.geometry.coordinates[this.lineString.geometry.coordinates.length-1],{icon:"marker-b"})]}}),this.map.addLayer({id:"route",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#333","line-width":4}}),this.fetchImages([{url:"./assets/map/marker-a.png",id:"marker-a"},{url:"./assets/map/marker-b.png",id:"marker-b"},{url:"./assets/map/marker-road.png",id:"marker-road"}]).then(()=>{this.map.addLayer({id:"points",type:"symbol",source:"points",layout:{"icon-image":"{icon}"}})}),this.map.on("click","points",t=>{const n=this.map.queryRenderedFeatures(t.point,{layers:["points"]});console.log(n[0])}))})}}Pm.\u0275fac=function(t){return new(t||Pm)},Pm.\u0275prov=kn({token:Pm,factory:Pm.\u0275fac,providedIn:"root"});const b8=["container"];class p0{constructor(t){this.mapbox=t}ngAfterViewInit(){this.mapbox.renderMap(this.container.nativeElement,kl.center,kl.zoom,kl.lineString,kl.midPointIndex)}}p0.\u0275fac=function(t){return new(t||p0)(zr(Pm))},p0.\u0275cmp=_s({type:p0,selectors:[["app-map-view"]],viewQuery:function(t,n){if(1&t&&v_(b8,5),2&t){let r;nm(r=rm())&&(n.container=r.first)}},decls:2,vars:0,consts:[[2,"width","400px","height","200px"],["container",""]],template:function(t,n){1&t&&lo(0,"div",0,1)},encapsulation:2});const E8=["canvas"];function C8(e,t){if(1&e&&(Ir(0,"option",30),vu(1),Ar()),2&e){const n=t.$implicit;Ti("value",n)("selected",100===n),Tc(1),t1("",n,"%")}}class g0{constructor(){this.contentWidth=0,this.scaleOptions=[];for(let t=.25;t<2;t+=.125)this.scaleOptions.push(100*t)}ngOnChanges(t){t.elevationProfile&&(this.elevationProfile=t.elevationProfile.currentValue,this.updateElevationProfile())}ngAfterViewInit(){this.updateElevationProfile()}updateElevationProfile(){this.canvas&&this.elevationProfile&&this.canvas.nativeElement.setElevationProfile(this.elevationProfile,kl.crossSectionDistance)}onSectionChange(){this.contentWidth=this.canvas.nativeElement.contentWidth}toggleElevationGrid(){this.canvas.nativeElement.elevationGrid=!this.canvas.nativeElement.elevationGrid}toggleOutline(){this.canvas.nativeElement.outline=!this.canvas.nativeElement.outline}toggleSeparator(){this.canvas.nativeElement.separator=!this.canvas.nativeElement.separator}toggleSurface(){this.canvas.nativeElement.hideSurface=!this.canvas.nativeElement.hideSurface}actionMirror(){this.canvas.nativeElement.mirror()}changeElevation(t){this.canvas.nativeElement.elevation=+t}changeScale(t){document.dispatchEvent(new CustomEvent("scalechange",{detail:+t}))}save(){localStorage.setItem("json",JSON.stringify(this.canvas.nativeElement.getJSON()))}load(){const t=localStorage.getItem("json");t&&this.canvas.nativeElement.loadJSON(JSON.parse(t))}}g0.\u0275fac=function(t){return new(t||g0)},g0.\u0275cmp=_s({type:g0,selectors:[["app-street-canvas"]],viewQuery:function(t,n){if(1&t&&v_(E8,5),2&t){let r;nm(r=rm())&&(n.canvas=r.first)}},inputs:{elevationProfile:"elevationProfile"},features:[Cs],decls:62,vars:2,consts:[[1,"controls"],["type","number","value","135",2,"width","80px",3,"change"],["elevationInput",""],[3,"change"],["scaleSelect",""],[3,"value","selected",4,"ngFor","ngForOf"],[3,"click"],[1,"controls__right"],["elevationGrid","","elevation","135","outline","","separator","",3,"sectionchange"],["canvas",""],["slot","canvas","width","3.2","elevation","0.6","type","sidewalk","color","concrete"],["slot","canvas","width","4.0","elevation","0.6","type","transitshelter","color","concrete"],["slot","canvas","width","5.4","elevation","0.8","slopeDirection","1","slopeHeight","0.5","title","Street A"],["slot","street","width","1.8","elevation","0.5","type","bike","direction","s","color","a"],["slot","street","width","3.6","elevation","0.8","type","bus","slopeDirection","1","slopeHeight","0.2","direction","sr","color","b","pattern","lines_45_black"],["slot","canvas","width","1.0","elevation","1.0","color","concrete","pattern","lines_45_black"],["slot","canvas","width","1.0","elevation","1.0","type","plantingstrip-flower","color","concrete"],["slot","canvas","width","0.5","elevation","1.0","type","tree","color","concrete"],["slot","canvas","width","1.0","elevation","1.0","color","concrete"],["slot","canvas","width","21","elevation","1.8","slopeDirection","1","slopeHeight","1","title","Street B"],["slot","street","width","2.6","elevation","1.0","type","drive","direction","sr","slopeDirection","1","slopeHeight","0.1"],["slot","street","width","2.6","elevation","1.0","type","drive","direction","s"],["slot","street","width","3.2","elevation","1.35","type","lightrail","direction","s","color","concrete","pattern","NETWORK-DENSITY-METRO2"],["slot","street","width","1","elevation","1.55","type","lamp","color","concrete"],["slot","street","width","3.2","elevation","1.45","type","streetcar","backward","","direction","s","color","concrete"],["slot","street","width","2.6","elevation","1.65","type","drive","backward","","direction","s","slopeDirection","1","slopeHeight","0.2"],["slot","street","width","2.6","elevation","1.65","type","drive","backward","","direction","sr","slopeDirection","-1","slopeHeight","0.0"],["slot","street","width","3.2","elevation","1.8","type","bus","backward","","direction","sr","slopeDirection","1","slopeHeight","0.15","color","b"],["slot","canvas","width","4.0","elevation","2.0","type","transitshelter","backward","","color","concrete"],["slot","canvas","width","1.4","elevation","2.0","type","sidewalk","color","concrete"],[3,"value","selected"]],template:function(t,n){if(1&t){const r=function wi(){return gt()}();Ir(0,"div",0)(1,"label"),vu(2,"Elevation:"),Ar(),Ir(3,"input",1,2),Pi("change",function(){Un(r);const c=ii(4);return Qn(n.changeElevation(c.value))}),Ar(),Ir(5,"label"),vu(6,"Scale:"),Ar(),Ir(7,"select",3,4),Pi("change",function(){Un(r);const c=ii(8);return Qn(n.changeScale(c.value))}),function Ko(e,t,n,r,o,c,d,_){const E=gt(),C=nn(),A=e+22,R=C.firstCreatePass?function Mr(e,t,n,r,o,c,d,_,E){const C=t.consts,A=Jc(t,e,4,d||null,u(C,_));Zy(t,n,A,u(C,E)),Ne(t,A);const R=A.tViews=Fg(2,A,r,o,c,t.directiveRegistry,t.pipeRegistry,null,t.schemas,C);return null!==t.queries&&(t.queries.template(t,A),R.queries=t.queries.embeddedTView(A)),A}(A,C,E,t,n,r,o,c,d):C.data[A];Ss(R,!1);const N=E[11].createComment("");hg(C,E,N,R),mu(N,E),Hf(E,E[A]=jv(N,E,N,R)),fs(R)&&cf(C,E,R),null!=d&&zd(E,R,_)}(9,C8,2,3,"option",5),Ar(),Ir(10,"label"),vu(11,"Toggle:"),Ar(),Ir(12,"button",6),Pi("click",function(){return n.toggleElevationGrid()}),vu(13,"Elevation Grid"),Ar(),Ir(14,"button",6),Pi("click",function(){return n.toggleOutline()}),vu(15,"Outline"),Ar(),Ir(16,"button",6),Pi("click",function(){return n.toggleSeparator()}),vu(17,"Separator"),Ar(),Ir(18,"button",6),Pi("click",function(){return n.toggleSurface()}),vu(19,"Surface"),Ar(),Ir(20,"label"),vu(21,"Tools:"),Ar(),Ir(22,"button",6),Pi("click",function(){return n.actionMirror()}),vu(23,"Mirror"),Ar(),Ir(24,"button"),vu(25,"Add Street"),Ar(),Ir(26,"button"),vu(27,"Add Segment"),Ar(),Ir(28,"label"),vu(29,"Storage:"),Ar(),Ir(30,"button",6),Pi("click",function(){return n.save()}),vu(31,"Save"),Ar(),Ir(32,"button",6),Pi("click",function(){return n.load()}),vu(33,"Load"),Ar(),Ir(34,"div",7),vu(35," Section Width "),Ir(36,"span"),vu(37),Ar(),vu(38," m "),Ar()(),Ir(39,"ud-canvas",8,9),Pi("sectionchange",function(){return n.onSectionChange()}),lo(41,"ud-segment",10)(42,"ud-segment",11),Ir(43,"ud-street",12),lo(44,"ud-segment",13)(45,"ud-segment",14),Ar(),lo(46,"ud-segment",15)(47,"ud-segment",16)(48,"ud-segment",17)(49,"ud-segment",16)(50,"ud-segment",18),Ir(51,"ud-street",19),lo(52,"ud-segment",20)(53,"ud-segment",21)(54,"ud-segment",22)(55,"ud-segment",23)(56,"ud-segment",24)(57,"ud-segment",25)(58,"ud-segment",26)(59,"ud-segment",27),Ar(),lo(60,"ud-segment",28)(61,"ud-segment",29),Ar()}2&t&&(Tc(9),Ti("ngForOf",n.scaleOptions),Tc(28),Yw(n.contentWidth))},dependencies:[tD],styles:[".controls[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;gap:10px;align-items:center;font-size:14px}.controls__right[_ngcontent-%COMP%]{margin-left:auto;color:gray}"]});const S8=["container"],I8=["canvas"];class m0{constructor(){this.style={strokeStyle:"black",lineWidth:2,yMargin:10}}onResize(){this.resize(),this.draw()}ngAfterViewInit(){this.canvasContext=this.canvas.nativeElement.getContext("2d"),this.resize(),this.draw()}ngOnChanges(t){t.ys&&this.updateYs(t.ys.currentValue)}resize(){this.width=this.container.nativeElement.offsetWidth,this.height=this.container.nativeElement.offsetHeight,this.canvas.nativeElement.width=this.width*devicePixelRatio,this.canvas.nativeElement.height=this.height*devicePixelRatio,this.canvas.nativeElement.style.width=this.width+"px",this.canvas.nativeElement.style.height=this.height+"px",this.canvasContext.scale(devicePixelRatio,devicePixelRatio)}updateYs(t){this.ys=t,this.ys&&(this.cubicSpline=new window.ud.CubicSpline(Array(this.ys.length).fill(void 0).map((n,r)=>r),this.ys)),this.draw()}draw(){if(!this.ys)return;const t=this.width-1,n=Array(this.width).fill(void 0).map((_,E)=>this.cubicSpline.at(window.ud.Utils.fitRange(t,this.ys.length,E))),r=Math.min(...n),o=Math.max(...n)-r;this.canvasContext.lineWidth=this.style.lineWidth,this.canvasContext.strokeStyle=this.style.strokeStyle,this.canvasContext.beginPath();const c=this.style.yMargin,d=this.height-1-2*this.style.yMargin;for(let _=0;_<t;_++){0===_&&this.canvasContext.moveTo(_,window.ud.Utils.fitRangeWithOffset(r,o,c,d,n[_]));const E=_+1;this.canvasContext.lineTo(E,window.ud.Utils.fitRangeWithOffset(r,o,c,d,n[E]))}this.canvasContext.stroke()}}m0.\u0275fac=function(t){return new(t||m0)},m0.\u0275cmp=_s({type:m0,selectors:[["app-line-chart"]],viewQuery:function(t,n){if(1&t&&(v_(S8,5),v_(I8,5)),2&t){let r;nm(r=rm())&&(n.container=r.first),nm(r=rm())&&(n.canvas=r.first)}},hostBindings:function(t,n){1&t&&Pi("resize",function(o){return n.onResize(o)},0,Oy)},inputs:{ys:"ys"},features:[Cs],decls:4,vars:0,consts:[[1,"container"],["container",""],[1,"canvas"],["canvas",""]],template:function(t,n){1&t&&(Ir(0,"div",0,1),lo(2,"canvas",2,3),Ar())},styles:[".container[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;background-color:#ccc}.canvas[_ngcontent-%COMP%]{position:absolute}"]});class y0{constructor(t){this.elevationProfileService=t}ngOnInit(){this.elevationProfileService.getElevation(kl.path).then(()=>{this.chartYs=this.elevationProfileService.StaticResponsePath}),this.elevationProfileService.getElevation(kl.crossSectionPath).then(()=>{this.streetElevationProfile=this.elevationProfileService.StaticResponseCrossSection})}}y0.\u0275fac=function(t){return new(t||y0)(zr(Am))},y0.\u0275cmp=_s({type:y0,selectors:[["app-root"]],decls:5,vars:2,consts:[[1,"top-panel"],[1,"street-elevation-chart",3,"ys"],[3,"elevationProfile"]],template:function(t,n){1&t&&(Ir(0,"div",0),lo(1,"app-map-view")(2,"app-line-chart",1),Ar(),lo(3,"app-street-canvas",2)(4,"router-outlet")),2&t&&(Tc(2),Ti("ys",n.chartYs),Tc(1),Ti("elevationProfile",n.streetElevationProfile))},dependencies:[bE,p0,g0,m0],styles:[".top-panel[_ngcontent-%COMP%]{margin-bottom:20px;display:flex;column-gap:20px}.street-elevation-chart[_ngcontent-%COMP%]{flex-grow:1}"]});const T8=()=>{const{lineString:e,index:t}=Kd.addMidPoint(ah(kl.path));kl.lineString=e,kl.midPointIndex=t,kl.midPoint=e.geometry.coordinates[t],kl.crossSectionPath=Kd.getCrossSectionCoordinates(kl.crossSectionDistance,kl.lineString,kl.midPointIndex)};class Rm{}Rm.\u0275fac=function(t){return new(t||Rm)},Rm.\u0275mod=Ls({type:Rm,bootstrap:[y0]}),Rm.\u0275inj=Ea({providers:[{provide:w_,useFactory:()=>T8,multi:!0}],imports:[RF,mm]}),PF().bootstrapModule(Rm).catch(e=>console.error(e))},1503:(an,vt,je)=>{"use strict";var Fe=je(3269);function lt(p){var ve=[1/0,1/0,-1/0,-1/0];return Fe.coordEach(p,function($e){ve[0]>$e[0]&&(ve[0]=$e[0]),ve[1]>$e[1]&&(ve[1]=$e[1]),ve[2]<$e[0]&&(ve[2]=$e[0]),ve[3]<$e[1]&&(ve[3]=$e[1])}),ve}lt.default=lt,vt.Z=lt},8275:(an,vt)=>{"use strict";function je(Ve,qe,ue){void 0===ue&&(ue={});var Zt={type:"Feature"};return(0===ue.id||ue.id)&&(Zt.id=ue.id),ue.bbox&&(Zt.bbox=ue.bbox),Zt.properties=qe||{},Zt.geometry=Ve,Zt}function Fe(Ve,qe,ue){if(void 0===ue&&(ue={}),!Ve)throw new Error("coordinates is required");if(!Array.isArray(Ve))throw new Error("coordinates must be an Array");if(Ve.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!se(Ve[0])||!se(Ve[1]))throw new Error("coordinates must contain numbers");return je({type:"Point",coordinates:Ve},qe,ue)}function p(Ve,qe,ue){void 0===ue&&(ue={});for(var Zt=0,At=Ve;Zt<At.length;Zt++){var Pe=At[Zt];if(Pe.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var ct=0;ct<Pe[Pe.length-1].length;ct++)if(Pe[Pe.length-1][ct]!==Pe[0][ct])throw new Error("First and last Position are not equivalent.")}return je({type:"Polygon",coordinates:Ve},qe,ue)}function $e(Ve,qe,ue){if(void 0===ue&&(ue={}),Ve.length<2)throw new Error("coordinates must be an array of two or more positions");return je({type:"LineString",coordinates:Ve},qe,ue)}function ft(Ve,qe){void 0===qe&&(qe={});var ue={type:"FeatureCollection"};return qe.id&&(ue.id=qe.id),qe.bbox&&(ue.bbox=qe.bbox),ue.features=Ve,ue}function Ct(Ve,qe,ue){return void 0===ue&&(ue={}),je({type:"MultiLineString",coordinates:Ve},qe,ue)}function Yt(Ve,qe,ue){return void 0===ue&&(ue={}),je({type:"MultiPoint",coordinates:Ve},qe,ue)}function Ot(Ve,qe,ue){return void 0===ue&&(ue={}),je({type:"MultiPolygon",coordinates:Ve},qe,ue)}function pn(Ve,qe){void 0===qe&&(qe="kilometers");var ue=vt.factors[qe];if(!ue)throw new Error(qe+" units is invalid");return Ve*ue}function he(Ve,qe){void 0===qe&&(qe="kilometers");var ue=vt.factors[qe];if(!ue)throw new Error(qe+" units is invalid");return Ve/ue}function Y(Ve){return Ve%(2*Math.PI)*180/Math.PI}function se(Ve){return!isNaN(Ve)&&null!==Ve&&!Array.isArray(Ve)}Object.defineProperty(vt,"__esModule",{value:!0}),vt.earthRadius=6371008.8,vt.factors={centimeters:100*vt.earthRadius,centimetres:100*vt.earthRadius,degrees:vt.earthRadius/111325,feet:3.28084*vt.earthRadius,inches:39.37*vt.earthRadius,kilometers:vt.earthRadius/1e3,kilometres:vt.earthRadius/1e3,meters:vt.earthRadius,metres:vt.earthRadius,miles:vt.earthRadius/1609.344,millimeters:1e3*vt.earthRadius,millimetres:1e3*vt.earthRadius,nauticalmiles:vt.earthRadius/1852,radians:1,yards:1.0936*vt.earthRadius},vt.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/vt.earthRadius,yards:1.0936133},vt.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},vt.feature=je,vt.geometry=function Ee(Ve,qe,ue){switch(void 0===ue&&(ue={}),Ve){case"Point":return Fe(qe).geometry;case"LineString":return $e(qe).geometry;case"Polygon":return p(qe).geometry;case"MultiPoint":return Yt(qe).geometry;case"MultiLineString":return Ct(qe).geometry;case"MultiPolygon":return Ot(qe).geometry;default:throw new Error(Ve+" is invalid")}},vt.point=Fe,vt.points=function lt(Ve,qe,ue){return void 0===ue&&(ue={}),ft(Ve.map(function(Zt){return Fe(Zt,qe)}),ue)},vt.polygon=p,vt.polygons=function ve(Ve,qe,ue){return void 0===ue&&(ue={}),ft(Ve.map(function(Zt){return p(Zt,qe)}),ue)},vt.lineString=$e,vt.lineStrings=function ut(Ve,qe,ue){return void 0===ue&&(ue={}),ft(Ve.map(function(Zt){return $e(Zt,qe)}),ue)},vt.featureCollection=ft,vt.multiLineString=Ct,vt.multiPoint=Yt,vt.multiPolygon=Ot,vt.geometryCollection=function xt(Ve,qe,ue){return void 0===ue&&(ue={}),je({type:"GeometryCollection",geometries:Ve},qe,ue)},vt.round=function Ut(Ve,qe){if(void 0===qe&&(qe=0),qe&&!(qe>=0))throw new Error("precision must be a positive number");var ue=Math.pow(10,qe||0);return Math.round(Ve*ue)/ue},vt.radiansToLength=pn,vt.lengthToRadians=he,vt.lengthToDegrees=function Ie(Ve,qe){return Y(he(Ve,qe))},vt.bearingToAzimuth=function le(Ve){var qe=Ve%360;return qe<0&&(qe+=360),qe},vt.radiansToDegrees=Y,vt.degreesToRadians=function ce(Ve){return Ve%360*Math.PI/180},vt.convertLength=function ke(Ve,qe,ue){if(void 0===qe&&(qe="kilometers"),void 0===ue&&(ue="kilometers"),!(Ve>=0))throw new Error("length must be a positive number");return pn(he(Ve,qe),ue)},vt.convertArea=function de(Ve,qe,ue){if(void 0===qe&&(qe="meters"),void 0===ue&&(ue="kilometers"),!(Ve>=0))throw new Error("area must be a positive number");var Zt=vt.areaFactors[qe];if(!Zt)throw new Error("invalid original units");var At=vt.areaFactors[ue];if(!At)throw new Error("invalid final units");return Ve/Zt*At},vt.isNumber=se,vt.isObject=function we(Ve){return!!Ve&&Ve.constructor===Object},vt.validateBBox=function J(Ve){if(!Ve)throw new Error("bbox is required");if(!Array.isArray(Ve))throw new Error("bbox must be an Array");if(4!==Ve.length&&6!==Ve.length)throw new Error("bbox must be an Array of 4 or 6 numbers");Ve.forEach(function(qe){if(!se(qe))throw new Error("bbox must only contain numbers")})},vt.validateId=function pt(Ve){if(!Ve)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof Ve))throw new Error("id must be a number or a string")}},3269:(an,vt,je)=>{"use strict";Object.defineProperty(vt,"__esModule",{value:!0});var Ee=je(8275);function Fe(ce,ke,de){if(null!==ce)for(var se,we,J,pt,Ve,qe,ue,Pe,Zt=0,At=0,ct=ce.type,Me="FeatureCollection"===ct,tt="Feature"===ct,dt=Me?ce.features.length:1,Ae=0;Ae<dt;Ae++){Ve=(Pe=!!(ue=Me?ce.features[Ae].geometry:tt?ce.geometry:ce)&&"GeometryCollection"===ue.type)?ue.geometries.length:1;for(var Vt=0;Vt<Ve;Vt++){var Nt=0,fn=0;if(null!==(pt=Pe?ue.geometries[Vt]:ue)){qe=pt.coordinates;var Lt=pt.type;switch(Zt=!de||"Polygon"!==Lt&&"MultiPolygon"!==Lt?0:1,Lt){case null:break;case"Point":if(!1===ke(qe,At,Ae,Nt,fn))return!1;At++,Nt++;break;case"LineString":case"MultiPoint":for(se=0;se<qe.length;se++){if(!1===ke(qe[se],At,Ae,Nt,fn))return!1;At++,"MultiPoint"===Lt&&Nt++}"LineString"===Lt&&Nt++;break;case"Polygon":case"MultiLineString":for(se=0;se<qe.length;se++){for(we=0;we<qe[se].length-Zt;we++){if(!1===ke(qe[se][we],At,Ae,Nt,fn))return!1;At++}"MultiLineString"===Lt&&Nt++,"Polygon"===Lt&&fn++}"Polygon"===Lt&&Nt++;break;case"MultiPolygon":for(se=0;se<qe.length;se++){for(fn=0,we=0;we<qe[se].length;we++){for(J=0;J<qe[se][we].length-Zt;J++){if(!1===ke(qe[se][we][J],At,Ae,Nt,fn))return!1;At++}fn++}Nt++}break;case"GeometryCollection":for(se=0;se<pt.geometries.length;se++)if(!1===Fe(pt.geometries[se],ke,de))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function p(ce,ke){var de;switch(ce.type){case"FeatureCollection":for(de=0;de<ce.features.length&&!1!==ke(ce.features[de].properties,de);de++);break;case"Feature":ke(ce.properties,0)}}function $e(ce,ke){if("Feature"===ce.type)ke(ce,0);else if("FeatureCollection"===ce.type)for(var de=0;de<ce.features.length&&!1!==ke(ce.features[de],de);de++);}function Ct(ce,ke){var de,se,we,J,pt,Ve,qe,ue,Zt,At,Pe=0,ct="FeatureCollection"===ce.type,Me="Feature"===ce.type,tt=ct?ce.features.length:1;for(de=0;de<tt;de++){for(ue=ct?ce.features[de].properties:Me?ce.properties:{},Zt=ct?ce.features[de].bbox:Me?ce.bbox:void 0,At=ct?ce.features[de].id:Me?ce.id:void 0,pt=(qe=!!(Ve=ct?ce.features[de].geometry:Me?ce.geometry:ce)&&"GeometryCollection"===Ve.type)?Ve.geometries.length:1,we=0;we<pt;we++)if(null!==(J=qe?Ve.geometries[we]:Ve))switch(J.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===ke(J,Pe,ue,Zt,At))return!1;break;case"GeometryCollection":for(se=0;se<J.geometries.length;se++)if(!1===ke(J.geometries[se],Pe,ue,Zt,At))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===ke(null,Pe,ue,Zt,At))return!1;Pe++}}function Ot(ce,ke){Ct(ce,function(de,se,we,J,pt){var qe,Ve=null===de?null:de.type;switch(Ve){case null:case"Point":case"LineString":case"Polygon":return!1!==ke(Ee.feature(de,we,{bbox:J,id:pt}),se,0)&&void 0}switch(Ve){case"MultiPoint":qe="Point";break;case"MultiLineString":qe="LineString";break;case"MultiPolygon":qe="Polygon"}for(var ue=0;ue<de.coordinates.length;ue++)if(!1===ke(Ee.feature({type:qe,coordinates:de.coordinates[ue]},we),se,ue))return!1})}function Ut(ce,ke){Ot(ce,function(de,se,we){var J=0;if(de.geometry){var pt=de.geometry.type;if("Point"!==pt&&"MultiPoint"!==pt){var Ve,qe=0,ue=0,Zt=0;if(!1===Fe(de,function(At,Pe,ct,Me,tt){if(void 0===Ve||se>qe||Me>ue||tt>Zt)return Ve=At,qe=se,ue=Me,Zt=tt,void(J=0);var dt=Ee.lineString([Ve,At],de.properties);if(!1===ke(dt,se,we,tt,J))return!1;J++,Ve=At}))return!1}}})}function he(ce,ke){if(!ce)throw new Error("geojson is required");Ot(ce,function(de,se,we){if(null!==de.geometry){var pt=de.geometry.coordinates;switch(de.geometry.type){case"LineString":if(!1===ke(de,se,we,0,0))return!1;break;case"Polygon":for(var Ve=0;Ve<pt.length;Ve++)if(!1===ke(Ee.lineString(pt[Ve],de.properties),se,we,Ve))return!1}}})}vt.coordAll=function ft(ce){var ke=[];return Fe(ce,function(de){ke.push(de)}),ke},vt.coordEach=Fe,vt.coordReduce=function lt(ce,ke,de,se){var we=de;return Fe(ce,function(J,pt,Ve,qe,ue){we=0===pt&&void 0===de?J:ke(we,J,pt,Ve,qe,ue)},se),we},vt.featureEach=$e,vt.featureReduce=function ut(ce,ke,de){var se=de;return $e(ce,function(we,J){se=0===J&&void 0===de?we:ke(se,we,J)}),se},vt.findPoint=function Y(ce,ke){if(!Ee.isObject(ke=ke||{}))throw new Error("options is invalid");var Ve,de=ke.featureIndex||0,se=ke.multiFeatureIndex||0,we=ke.geometryIndex||0,J=ke.coordIndex||0,pt=ke.properties;switch(ce.type){case"FeatureCollection":de<0&&(de=ce.features.length+de),pt=pt||ce.features[de].properties,Ve=ce.features[de].geometry;break;case"Feature":pt=pt||ce.properties,Ve=ce.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ve=ce;break;default:throw new Error("geojson is invalid")}if(null===Ve)return null;var qe=Ve.coordinates;switch(Ve.type){case"Point":return Ee.point(qe,pt,ke);case"MultiPoint":return se<0&&(se=qe.length+se),Ee.point(qe[se],pt,ke);case"LineString":return J<0&&(J=qe.length+J),Ee.point(qe[J],pt,ke);case"Polygon":return we<0&&(we=qe.length+we),J<0&&(J=qe[we].length+J),Ee.point(qe[we][J],pt,ke);case"MultiLineString":return se<0&&(se=qe.length+se),J<0&&(J=qe[se].length+J),Ee.point(qe[se][J],pt,ke);case"MultiPolygon":return se<0&&(se=qe.length+se),we<0&&(we=qe[se].length+we),J<0&&(J=qe[se][we].length-J),Ee.point(qe[se][we][J],pt,ke)}throw new Error("geojson is invalid")},vt.findSegment=function le(ce,ke){if(!Ee.isObject(ke=ke||{}))throw new Error("options is invalid");var Ve,de=ke.featureIndex||0,se=ke.multiFeatureIndex||0,we=ke.geometryIndex||0,J=ke.segmentIndex||0,pt=ke.properties;switch(ce.type){case"FeatureCollection":de<0&&(de=ce.features.length+de),pt=pt||ce.features[de].properties,Ve=ce.features[de].geometry;break;case"Feature":pt=pt||ce.properties,Ve=ce.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":Ve=ce;break;default:throw new Error("geojson is invalid")}if(null===Ve)return null;var qe=Ve.coordinates;switch(Ve.type){case"Point":case"MultiPoint":return null;case"LineString":return J<0&&(J=qe.length+J-1),Ee.lineString([qe[J],qe[J+1]],pt,ke);case"Polygon":return we<0&&(we=qe.length+we),J<0&&(J=qe[we].length+J-1),Ee.lineString([qe[we][J],qe[we][J+1]],pt,ke);case"MultiLineString":return se<0&&(se=qe.length+se),J<0&&(J=qe[se].length+J-1),Ee.lineString([qe[se][J],qe[se][J+1]],pt,ke);case"MultiPolygon":return se<0&&(se=qe.length+se),we<0&&(we=qe[se].length+we),J<0&&(J=qe[se][we].length-J-1),Ee.lineString([qe[se][we][J],qe[se][we][J+1]],pt,ke)}throw new Error("geojson is invalid")},vt.flattenEach=Ot,vt.flattenReduce=function xt(ce,ke,de){var se=de;return Ot(ce,function(we,J,pt){se=0===J&&0===pt&&void 0===de?we:ke(se,we,J,pt)}),se},vt.geomEach=Ct,vt.geomReduce=function Yt(ce,ke,de){var se=de;return Ct(ce,function(we,J,pt,Ve,qe){se=0===J&&void 0===de?we:ke(se,we,J,pt,Ve,qe)}),se},vt.lineEach=he,vt.lineReduce=function Ie(ce,ke,de){var se=de;return he(ce,function(we,J,pt,Ve){se=0===J&&void 0===de?we:ke(se,we,J,pt,Ve)}),se},vt.propEach=p,vt.propReduce=function ve(ce,ke,de){var se=de;return p(ce,function(we,J){se=0===J&&void 0===de?we:ke(se,we,J)}),se},vt.segmentEach=Ut,vt.segmentReduce=function pn(ce,ke,de){var se=de,we=!1;return Ut(ce,function(J,pt,Ve,qe,ue){se=!1===we&&void 0===de?J:ke(se,J,pt,Ve,qe,ue),we=!0}),se}},5834:(an,vt,je)=>{"use strict";var Ee=je(5203),Fe=je(5685),lt=Fe(Ee("String.prototype.indexOf"));an.exports=function(ve,$e){var ut=Ee(ve,!!$e);return"function"==typeof ut&&lt(ve,".prototype.")>-1?Fe(ut):ut}},5685:(an,vt,je)=>{"use strict";var Ee=je(4444),Fe=je(5203),lt=Fe("%Function.prototype.apply%"),p=Fe("%Function.prototype.call%"),ve=Fe("%Reflect.apply%",!0)||Ee.call(p,lt),$e=Fe("%Object.getOwnPropertyDescriptor%",!0),ut=Fe("%Object.defineProperty%",!0),ft=Fe("%Math.max%");if(ut)try{ut({},"a",{value:1})}catch{ut=null}an.exports=function(Ot){var xt=ve(Ee,p,arguments);if($e&&ut){var Ut=$e(xt,"length");Ut.configurable&&ut(xt,"length",{value:1+ft(0,Ot.length-(arguments.length-1))})}return xt};var Ct=function(){return ve(Ee,lt,arguments)};ut?ut(an.exports,"apply",{value:Ct}):an.exports.apply=Ct},1335:(an,vt,je)=>{"use strict";var Ee=je(3156),Fe=je(7253),lt=je(3870),p=je(7563).orient2d;function ve(de,se,we){se=Math.max(0,void 0===se?2:se),we=we||0;var J=function pn(de){for(var se=de[0],we=de[0],J=de[0],pt=de[0],Ve=0;Ve<de.length;Ve++){var qe=de[Ve];qe[0]<se[0]&&(se=qe),qe[0]>J[0]&&(J=qe),qe[1]<we[1]&&(we=qe),qe[1]>pt[1]&&(pt=qe)}var ue=[se,we,J,pt],Zt=ue.slice();for(Ve=0;Ve<de.length;Ve++)lt(de[Ve],ue)||Zt.push(de[Ve]);return function ke(de){de.sort(ce);for(var se=[],we=0;we<de.length;we++){for(;se.length>=2&&Ot(se[se.length-2],se[se.length-1],de[we])<=0;)se.pop();se.push(de[we])}for(var J=[],pt=de.length-1;pt>=0;pt--){for(;J.length>=2&&Ot(J[J.length-2],J[J.length-1],de[pt])<=0;)J.pop();J.push(de[pt])}return J.pop(),se.pop(),se.concat(J)}(Zt)}(de),pt=new Ee(16);pt.toBBox=function(fn){return{minX:fn[0],minY:fn[1],maxX:fn[0],maxY:fn[1]}},pt.compareMinX=function(fn,Lt){return fn[0]-Lt[0]},pt.compareMinY=function(fn,Lt){return fn[1]-Lt[1]},pt.load(de);for(var ue,Ve=[],qe=0;qe<J.length;qe++){var Zt=J[qe];pt.remove(Zt),ue=he(Zt,ue),Ve.push(ue)}var At=new Ee(16);for(qe=0;qe<Ve.length;qe++)At.insert(Ut(Ve[qe]));for(var Pe=se*se,ct=we*we;Ve.length;){var Me=Ve.shift(),tt=Me.p,dt=Me.next.p,Ae=Ie(tt,dt);if(!(Ae<ct)){var Vt=Ae/Pe;(Zt=$e(pt,Me.prev.p,tt,dt,Me.next.next.p,Vt,At))&&Math.min(Ie(Zt,tt),Ie(Zt,dt))<=Vt&&(Ve.push(Me),Ve.push(he(Zt,Me)),pt.remove(Zt),At.remove(Me),At.insert(Ut(Me)),At.insert(Ut(Me.next)))}}Me=ue;var Nt=[];do{Nt.push(Me.p),Me=Me.next}while(Me!==ue);return Nt.push(Me.p),Nt}function $e(de,se,we,J,pt,Ve,qe){for(var ue=new Fe([],ut),Zt=de.data;Zt;){for(var At=0;At<Zt.children.length;At++){var Pe=Zt.children[At],ct=Zt.leaf?le(Pe,we,J):ft(we,J,Pe);ct>Ve||ue.push({node:Pe,dist:ct})}for(;ue.length&&!ue.peek().node.children;){var Me=ue.pop(),tt=Me.node,dt=le(tt,se,we),Ae=le(tt,J,pt);if(Me.dist<dt&&Me.dist<Ae&&Yt(we,tt,qe)&&Yt(J,tt,qe))return tt}(Zt=ue.pop())&&(Zt=Zt.node)}return null}function ut(de,se){return de.dist-se.dist}function ft(de,se,we){if(Ct(de,we)||Ct(se,we))return 0;var J=Y(de[0],de[1],se[0],se[1],we.minX,we.minY,we.maxX,we.minY);if(0===J)return 0;var pt=Y(de[0],de[1],se[0],se[1],we.minX,we.minY,we.minX,we.maxY);if(0===pt)return 0;var Ve=Y(de[0],de[1],se[0],se[1],we.maxX,we.minY,we.maxX,we.maxY);if(0===Ve)return 0;var qe=Y(de[0],de[1],se[0],se[1],we.minX,we.maxY,we.maxX,we.maxY);return 0===qe?0:Math.min(J,pt,Ve,qe)}function Ct(de,se){return de[0]>=se.minX&&de[0]<=se.maxX&&de[1]>=se.minY&&de[1]<=se.maxY}function Yt(de,se,we){for(var J=Math.min(de[0],se[0]),pt=Math.min(de[1],se[1]),Ve=Math.max(de[0],se[0]),qe=Math.max(de[1],se[1]),ue=we.search({minX:J,minY:pt,maxX:Ve,maxY:qe}),Zt=0;Zt<ue.length;Zt++)if(xt(ue[Zt].p,ue[Zt].next.p,de,se))return!1;return!0}function Ot(de,se,we){return p(de[0],de[1],se[0],se[1],we[0],we[1])}function xt(de,se,we,J){return de!==J&&se!==we&&Ot(de,se,we)>0!=Ot(de,se,J)>0&&Ot(we,J,de)>0!=Ot(we,J,se)>0}function Ut(de){var se=de.p,we=de.next.p;return de.minX=Math.min(se[0],we[0]),de.minY=Math.min(se[1],we[1]),de.maxX=Math.max(se[0],we[0]),de.maxY=Math.max(se[1],we[1]),de}function he(de,se){var we={p:de,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return se?(we.next=se.next,we.prev=se,se.next.prev=we,se.next=we):(we.prev=we,we.next=we),we}function Ie(de,se){var we=de[0]-se[0],J=de[1]-se[1];return we*we+J*J}function le(de,se,we){var J=se[0],pt=se[1],Ve=we[0]-J,qe=we[1]-pt;if(0!==Ve||0!==qe){var ue=((de[0]-J)*Ve+(de[1]-pt)*qe)/(Ve*Ve+qe*qe);ue>1?(J=we[0],pt=we[1]):ue>0&&(J+=Ve*ue,pt+=qe*ue)}return(Ve=de[0]-J)*Ve+(qe=de[1]-pt)*qe}function Y(de,se,we,J,pt,Ve,qe,ue){var Mn,Rn,Bn,vn,Zt=we-de,At=J-se,Pe=qe-pt,ct=ue-Ve,Me=de-pt,tt=se-Ve,dt=Zt*Zt+At*At,Ae=Zt*Pe+At*ct,Vt=Pe*Pe+ct*ct,Nt=Zt*Me+At*tt,fn=Pe*Me+ct*tt,Lt=dt*Vt-Ae*Ae,Sn=Lt,hn=Lt;0===Lt?(Rn=0,Sn=1,vn=fn,hn=Vt):(vn=dt*fn-Ae*Nt,(Rn=Ae*fn-Vt*Nt)<0?(Rn=0,vn=fn,hn=Vt):Rn>Sn&&(Rn=Sn,vn=fn+Ae,hn=Vt)),vn<0?(vn=0,-Nt<0?Rn=0:-Nt>dt?Rn=Sn:(Rn=-Nt,Sn=dt)):vn>hn&&(vn=hn,-Nt+Ae<0?Rn=0:-Nt+Ae>dt?Rn=Sn:(Rn=-Nt+Ae,Sn=dt));var hr=(1-(Bn=0===vn?0:vn/hn))*pt+Bn*qe-((1-(Mn=0===Rn?0:Rn/Sn))*de+Mn*we),_t=(1-Bn)*Ve+Bn*ue-((1-Mn)*se+Mn*J);return hr*hr+_t*_t}function ce(de,se){return de[0]===se[0]?de[1]-se[1]:de[0]-se[0]}Fe.default&&(Fe=Fe.default),an.exports=ve,an.exports.default=ve},3156:function(an){an.exports=function(){"use strict";function vt(he,Ie,le,Y,ce){!function ke(de,se,we,J,pt){for(;J>we;){if(J-we>600){var Ve=J-we+1,qe=se-we+1,ue=Math.log(Ve),Zt=.5*Math.exp(2*ue/3),At=.5*Math.sqrt(ue*Zt*(Ve-Zt)/Ve)*(qe-Ve/2<0?-1:1);ke(de,se,Math.max(we,Math.floor(se-qe*Zt/Ve+At)),Math.min(J,Math.floor(se+(Ve-qe)*Zt/Ve+At)),pt)}var Me=de[se],tt=we,dt=J;for(je(de,we,se),pt(de[J],Me)>0&&je(de,we,J);tt<dt;){for(je(de,tt,dt),tt++,dt--;pt(de[tt],Me)<0;)tt++;for(;pt(de[dt],Me)>0;)dt--}0===pt(de[we],Me)?je(de,we,dt):je(de,++dt,J),dt<=se&&(we=dt+1),se<=dt&&(J=dt-1)}}(he,Ie,le||0,Y||he.length-1,ce||Ee)}function je(he,Ie,le){var Y=he[Ie];he[Ie]=he[le],he[le]=Y}function Ee(he,Ie){return he<Ie?-1:he>Ie?1:0}var Fe=function(he){void 0===he&&(he=9),this._maxEntries=Math.max(4,he),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function lt(he,Ie,le){if(!le)return Ie.indexOf(he);for(var Y=0;Y<Ie.length;Y++)if(le(he,Ie[Y]))return Y;return-1}function p(he,Ie){ve(he,0,he.children.length,Ie,he)}function ve(he,Ie,le,Y,ce){ce||(ce=Ut(null)),ce.minX=1/0,ce.minY=1/0,ce.maxX=-1/0,ce.maxY=-1/0;for(var ke=Ie;ke<le;ke++){var de=he.children[ke];$e(ce,he.leaf?Y(de):de)}return ce}function $e(he,Ie){return he.minX=Math.min(he.minX,Ie.minX),he.minY=Math.min(he.minY,Ie.minY),he.maxX=Math.max(he.maxX,Ie.maxX),he.maxY=Math.max(he.maxY,Ie.maxY),he}function ut(he,Ie){return he.minX-Ie.minX}function ft(he,Ie){return he.minY-Ie.minY}function Ct(he){return(he.maxX-he.minX)*(he.maxY-he.minY)}function Yt(he){return he.maxX-he.minX+(he.maxY-he.minY)}function Ot(he,Ie){return he.minX<=Ie.minX&&he.minY<=Ie.minY&&Ie.maxX<=he.maxX&&Ie.maxY<=he.maxY}function xt(he,Ie){return Ie.minX<=he.maxX&&Ie.minY<=he.maxY&&Ie.maxX>=he.minX&&Ie.maxY>=he.minY}function Ut(he){return{children:he,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pn(he,Ie,le,Y,ce){for(var ke=[Ie,le];ke.length;)if(!((le=ke.pop())-(Ie=ke.pop())<=Y)){var de=Ie+Math.ceil((le-Ie)/Y/2)*Y;vt(he,de,Ie,le,ce),ke.push(Ie,de,de,le)}}return Fe.prototype.all=function(){return this._all(this.data,[])},Fe.prototype.search=function(he){var Ie=this.data,le=[];if(!xt(he,Ie))return le;for(var Y=this.toBBox,ce=[];Ie;){for(var ke=0;ke<Ie.children.length;ke++){var de=Ie.children[ke],se=Ie.leaf?Y(de):de;xt(he,se)&&(Ie.leaf?le.push(de):Ot(he,se)?this._all(de,le):ce.push(de))}Ie=ce.pop()}return le},Fe.prototype.collides=function(he){var Ie=this.data;if(!xt(he,Ie))return!1;for(var le=[];Ie;){for(var Y=0;Y<Ie.children.length;Y++){var ce=Ie.children[Y],ke=Ie.leaf?this.toBBox(ce):ce;if(xt(he,ke)){if(Ie.leaf||Ot(he,ke))return!0;le.push(ce)}}Ie=le.pop()}return!1},Fe.prototype.load=function(he){if(!he||!he.length)return this;if(he.length<this._minEntries){for(var Ie=0;Ie<he.length;Ie++)this.insert(he[Ie]);return this}var le=this._build(he.slice(),0,he.length-1,0);if(this.data.children.length)if(this.data.height===le.height)this._splitRoot(this.data,le);else{if(this.data.height<le.height){var Y=this.data;this.data=le,le=Y}this._insert(le,this.data.height-le.height-1,!0)}else this.data=le;return this},Fe.prototype.insert=function(he){return he&&this._insert(he,this.data.height-1),this},Fe.prototype.clear=function(){return this.data=Ut([]),this},Fe.prototype.remove=function(he,Ie){if(!he)return this;for(var le,Y,ce,ke=this.data,de=this.toBBox(he),se=[],we=[];ke||se.length;){if(ke||(ke=se.pop(),Y=se[se.length-1],le=we.pop(),ce=!0),ke.leaf){var J=lt(he,ke.children,Ie);if(-1!==J)return ke.children.splice(J,1),se.push(ke),this._condense(se),this}ce||ke.leaf||!Ot(ke,de)?Y?(le++,ke=Y.children[le],ce=!1):ke=null:(se.push(ke),we.push(le),le=0,Y=ke,ke=ke.children[0])}return this},Fe.prototype.toBBox=function(he){return he},Fe.prototype.compareMinX=function(he,Ie){return he.minX-Ie.minX},Fe.prototype.compareMinY=function(he,Ie){return he.minY-Ie.minY},Fe.prototype.toJSON=function(){return this.data},Fe.prototype.fromJSON=function(he){return this.data=he,this},Fe.prototype._all=function(he,Ie){for(var le=[];he;)he.leaf?Ie.push.apply(Ie,he.children):le.push.apply(le,he.children),he=le.pop();return Ie},Fe.prototype._build=function(he,Ie,le,Y){var ce,ke=le-Ie+1,de=this._maxEntries;if(ke<=de)return p(ce=Ut(he.slice(Ie,le+1)),this.toBBox),ce;Y||(Y=Math.ceil(Math.log(ke)/Math.log(de)),de=Math.ceil(ke/Math.pow(de,Y-1))),(ce=Ut([])).leaf=!1,ce.height=Y;var se=Math.ceil(ke/de),we=se*Math.ceil(Math.sqrt(de));pn(he,Ie,le,we,this.compareMinX);for(var J=Ie;J<=le;J+=we){var pt=Math.min(J+we-1,le);pn(he,J,pt,se,this.compareMinY);for(var Ve=J;Ve<=pt;Ve+=se){var qe=Math.min(Ve+se-1,pt);ce.children.push(this._build(he,Ve,qe,Y-1))}}return p(ce,this.toBBox),ce},Fe.prototype._chooseSubtree=function(he,Ie,le,Y){for(;Y.push(Ie),!Ie.leaf&&Y.length-1!==le;){for(var ce=1/0,ke=1/0,de=void 0,se=0;se<Ie.children.length;se++){var we=Ie.children[se],J=Ct(we),pt=(Ve=he,qe=we,(Math.max(qe.maxX,Ve.maxX)-Math.min(qe.minX,Ve.minX))*(Math.max(qe.maxY,Ve.maxY)-Math.min(qe.minY,Ve.minY))-J);pt<ke?(ke=pt,ce=J<ce?J:ce,de=we):pt===ke&&J<ce&&(ce=J,de=we)}Ie=de||Ie.children[0]}var Ve,qe;return Ie},Fe.prototype._insert=function(he,Ie,le){var Y=le?he:this.toBBox(he),ce=[],ke=this._chooseSubtree(Y,this.data,Ie,ce);for(ke.children.push(he),$e(ke,Y);Ie>=0&&ce[Ie].children.length>this._maxEntries;)this._split(ce,Ie),Ie--;this._adjustParentBBoxes(Y,ce,Ie)},Fe.prototype._split=function(he,Ie){var le=he[Ie],Y=le.children.length,ce=this._minEntries;this._chooseSplitAxis(le,ce,Y);var ke=this._chooseSplitIndex(le,ce,Y),de=Ut(le.children.splice(ke,le.children.length-ke));de.height=le.height,de.leaf=le.leaf,p(le,this.toBBox),p(de,this.toBBox),Ie?he[Ie-1].children.push(de):this._splitRoot(le,de)},Fe.prototype._splitRoot=function(he,Ie){this.data=Ut([he,Ie]),this.data.height=he.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},Fe.prototype._chooseSplitIndex=function(he,Ie,le){for(var Y,ce,ke,de,se,we,J,pt=1/0,Ve=1/0,qe=Ie;qe<=le-Ie;qe++){var ue=ve(he,0,qe,this.toBBox),Zt=ve(he,qe,le,this.toBBox),At=(ce=ue,ke=Zt,void 0,void 0,void 0,void 0,de=Math.max(ce.minX,ke.minX),se=Math.max(ce.minY,ke.minY),we=Math.min(ce.maxX,ke.maxX),J=Math.min(ce.maxY,ke.maxY),Math.max(0,we-de)*Math.max(0,J-se)),Pe=Ct(ue)+Ct(Zt);At<pt?(pt=At,Y=qe,Ve=Pe<Ve?Pe:Ve):At===pt&&Pe<Ve&&(Ve=Pe,Y=qe)}return Y||le-Ie},Fe.prototype._chooseSplitAxis=function(he,Ie,le){var Y=he.leaf?this.compareMinX:ut,ce=he.leaf?this.compareMinY:ft;this._allDistMargin(he,Ie,le,Y)<this._allDistMargin(he,Ie,le,ce)&&he.children.sort(Y)},Fe.prototype._allDistMargin=function(he,Ie,le,Y){he.children.sort(Y);for(var ce=this.toBBox,ke=ve(he,0,Ie,ce),de=ve(he,le-Ie,le,ce),se=Yt(ke)+Yt(de),we=Ie;we<le-Ie;we++){var J=he.children[we];$e(ke,he.leaf?ce(J):J),se+=Yt(ke)}for(var pt=le-Ie-1;pt>=Ie;pt--){var Ve=he.children[pt];$e(de,he.leaf?ce(Ve):Ve),se+=Yt(de)}return se},Fe.prototype._adjustParentBBoxes=function(he,Ie,le){for(var Y=le;Y>=0;Y--)$e(Ie[Y],he)},Fe.prototype._condense=function(he){for(var Ie=he.length-1,le=void 0;Ie>=0;Ie--)0===he[Ie].children.length?Ie>0?(le=he[Ie-1].children).splice(le.indexOf(he[Ie]),1):this.clear():p(he[Ie],this.toBBox)},Fe}()},6952:(an,vt,je)=>{var Ee=je(1356),Fe=je(3407),lt=je(2e3),p=je(2342),ve=je(9235),$e=je(2374),ut=Date.prototype.getTime;function Ct(xt){return null==xt}function Yt(xt){return!(!xt||"object"!=typeof xt||"number"!=typeof xt.length||"function"!=typeof xt.copy||"function"!=typeof xt.slice||xt.length>0&&"number"!=typeof xt[0])}an.exports=function ft(xt,Ut,pn){var he=pn||{};return!!(he.strict?lt(xt,Ut):xt===Ut)||(!xt||!Ut||"object"!=typeof xt&&"object"!=typeof Ut?he.strict?lt(xt,Ut):xt==Ut:function Ot(xt,Ut,pn){var he,Ie;if(typeof xt!=typeof Ut||Ct(xt)||Ct(Ut)||xt.prototype!==Ut.prototype||Fe(xt)!==Fe(Ut))return!1;var le=p(xt),Y=p(Ut);if(le!==Y)return!1;if(le||Y)return xt.source===Ut.source&&ve(xt)===ve(Ut);if($e(xt)&&$e(Ut))return ut.call(xt)===ut.call(Ut);var ce=Yt(xt),ke=Yt(Ut);if(ce!==ke)return!1;if(ce||ke){if(xt.length!==Ut.length)return!1;for(he=0;he<xt.length;he++)if(xt[he]!==Ut[he])return!1;return!0}if(typeof xt!=typeof Ut)return!1;try{var de=Ee(xt),se=Ee(Ut)}catch{return!1}if(de.length!==se.length)return!1;for(de.sort(),se.sort(),he=de.length-1;he>=0;he--)if(de[he]!=se[he])return!1;for(he=de.length-1;he>=0;he--)if(!ft(xt[Ie=de[he]],Ut[Ie],pn))return!1;return!0}(xt,Ut,he))}},2358:(an,vt,je)=>{"use strict";var Ee=je(1356),Fe="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),lt=Object.prototype.toString,p=Array.prototype.concat,ve=Object.defineProperty,ut=je(7027)(),ft=ve&&ut,Ct=function(Ot,xt,Ut,pn){xt in Ot&&(!function(Ot){return"function"==typeof Ot&&"[object Function]"===lt.call(Ot)}(pn)||!pn())||(ft?ve(Ot,xt,{configurable:!0,enumerable:!1,value:Ut,writable:!0}):Ot[xt]=Ut)},Yt=function(Ot,xt){var Ut=arguments.length>2?arguments[2]:{},pn=Ee(xt);Fe&&(pn=p.call(pn,Object.getOwnPropertySymbols(xt)));for(var he=0;he<pn.length;he+=1)Ct(Ot,pn[he],xt[pn[he]],Ut[pn[he]])};Yt.supportsDescriptors=!!ft,an.exports=Yt},1817:an=>{function vt(je,Ee,Fe,lt){this.dataset=[],this.epsilon=1,this.minPts=2,this.distance=this._euclideanDistance,this.clusters=[],this.noise=[],this._visited=[],this._assigned=[],this._datasetLength=0,this._init(je,Ee,Fe,lt)}vt.prototype.run=function(je,Ee,Fe,lt){this._init(je,Ee,Fe,lt);for(var p=0;p<this._datasetLength;p++)if(1!==this._visited[p]){this._visited[p]=1;var ve=this._regionQuery(p);if(ve.length<this.minPts)this.noise.push(p);else{var $e=this.clusters.length;this.clusters.push([]),this._addToCluster(p,$e),this._expandCluster($e,ve)}}return this.clusters},vt.prototype._init=function(je,Ee,Fe,lt){if(je){if(!(je instanceof Array))throw Error("Dataset must be of type array, "+typeof je+" given");this.dataset=je,this.clusters=[],this.noise=[],this._datasetLength=je.length,this._visited=new Array(this._datasetLength),this._assigned=new Array(this._datasetLength)}Ee&&(this.epsilon=Ee),Fe&&(this.minPts=Fe),lt&&(this.distance=lt)},vt.prototype._expandCluster=function(je,Ee){for(var Fe=0;Fe<Ee.length;Fe++){var lt=Ee[Fe];if(1!==this._visited[lt]){this._visited[lt]=1;var p=this._regionQuery(lt);p.length>=this.minPts&&(Ee=this._mergeArrays(Ee,p))}1!==this._assigned[lt]&&this._addToCluster(lt,je)}},vt.prototype._addToCluster=function(je,Ee){this.clusters[Ee].push(je),this._assigned[je]=1},vt.prototype._regionQuery=function(je){for(var Ee=[],Fe=0;Fe<this._datasetLength;Fe++)this.distance(this.dataset[je],this.dataset[Fe])<this.epsilon&&Ee.push(Fe);return Ee},vt.prototype._mergeArrays=function(je,Ee){for(var Fe=Ee.length,lt=0;lt<Fe;lt++){var p=Ee[lt];je.indexOf(p)<0&&je.push(p)}return je},vt.prototype._euclideanDistance=function(je,Ee){for(var Fe=0,lt=Math.min(je.length,Ee.length);lt--;)Fe+=(je[lt]-Ee[lt])*(je[lt]-Ee[lt]);return Math.sqrt(Fe)},an.exports&&(an.exports=vt)},4273:an=>{function vt(je,Ee,Fe){this.k=3,this.dataset=[],this.assignments=[],this.centroids=[],this.init(je,Ee,Fe)}vt.prototype.init=function(je,Ee,Fe){this.assignments=[],this.centroids=[],typeof je<"u"&&(this.dataset=je),typeof Ee<"u"&&(this.k=Ee),typeof Fe<"u"&&(this.distance=Fe)},vt.prototype.run=function(je,Ee){this.init(je,Ee);for(var Fe=this.dataset.length,lt=0;lt<this.k;lt++)this.centroids[lt]=this.randomCentroid();for(var p=!0;p;){p=this.assign();for(var ve=0;ve<this.k;ve++){for(var $e=new Array(Yt),ut=0,ft=0;ft<Yt;ft++)$e[ft]=0;for(var Ct=0;Ct<Fe;Ct++){var Yt=this.dataset[Ct].length;if(ve===this.assignments[Ct]){for(ft=0;ft<Yt;ft++)$e[ft]+=this.dataset[Ct][ft];ut++}}if(ut>0){for(ft=0;ft<Yt;ft++)$e[ft]/=ut;this.centroids[ve]=$e}else this.centroids[ve]=this.randomCentroid(),p=!0}}return this.getClusters()},vt.prototype.randomCentroid=function(){var Ee,Fe,je=this.dataset.length-1;do{Fe=Math.round(Math.random()*je),Ee=this.dataset[Fe]}while(this.centroids.indexOf(Ee)>=0);return Ee},vt.prototype.assign=function(){for(var Fe,je=!1,Ee=this.dataset.length,lt=0;lt<Ee;lt++)(Fe=this.argmin(this.dataset[lt],this.centroids,this.distance))!=this.assignments[lt]&&(this.assignments[lt]=Fe,je=!0);return je},vt.prototype.getClusters=function(){for(var Ee,je=new Array(this.k),Fe=0;Fe<this.assignments.length;Fe++)typeof je[Ee=this.assignments[Fe]]>"u"&&(je[Ee]=[]),je[Ee].push(Fe);return je},vt.prototype.argmin=function(je,Ee,Fe){for(var $e,lt=Number.MAX_VALUE,p=0,ve=Ee.length,ut=0;ut<ve;ut++)($e=Fe(je,Ee[ut]))<lt&&(lt=$e,p=ut);return p},vt.prototype.distance=function(je,Ee){for(var Fe=0,lt=Math.min(je.length,Ee.length);lt--;){var p=je[lt]-Ee[lt];Fe+=p*p}return Math.sqrt(Fe)},an.exports&&(an.exports=vt)},8680:(an,vt,je)=>{if(an.exports)var Ee=je(8759);function Fe(lt,p,ve,$e){this.epsilon=1,this.minPts=1,this.distance=this._euclideanDistance,this._reachability=[],this._processed=[],this._coreDistance=0,this._orderedList=[],this._init(lt,p,ve,$e)}Fe.prototype.run=function(lt,p,ve,$e){this._init(lt,p,ve,$e);for(var ut=0,ft=this.dataset.length;ut<ft;ut++)if(1!==this._processed[ut]){this._processed[ut]=1,this.clusters.push([ut]);var Ct=this.clusters.length-1;this._orderedList.push(ut);var Yt=new Ee(null,null,"asc"),Ot=this._regionQuery(ut);void 0!==this._distanceToCore(ut)&&(this._updateQueue(ut,Ot,Yt),this._expandCluster(Ct,Yt))}return this.clusters},Fe.prototype.getReachabilityPlot=function(){for(var lt=[],p=0,ve=this._orderedList.length;p<ve;p++){var $e=this._orderedList[p];lt.push([$e,this._reachability[$e]])}return lt},Fe.prototype._init=function(lt,p,ve,$e){if(lt){if(!(lt instanceof Array))throw Error("Dataset must be of type array, "+typeof lt+" given");this.dataset=lt,this.clusters=[],this._reachability=new Array(this.dataset.length),this._processed=new Array(this.dataset.length),this._coreDistance=0,this._orderedList=[]}p&&(this.epsilon=p),ve&&(this.minPts=ve),$e&&(this.distance=$e)},Fe.prototype._updateQueue=function(lt,p,ve){var $e=this;this._coreDistance=this._distanceToCore(lt),p.forEach(function(ut){if(void 0===$e._processed[ut]){var ft=$e.distance($e.dataset[lt],$e.dataset[ut]),Ct=Math.max($e._coreDistance,ft);void 0===$e._reachability[ut]?($e._reachability[ut]=Ct,ve.insert(ut,Ct)):Ct<$e._reachability[ut]&&($e._reachability[ut]=Ct,ve.remove(ut),ve.insert(ut,Ct))}})},Fe.prototype._expandCluster=function(lt,p){for(var ve=p.getElements(),$e=0,ut=ve.length;$e<ut;$e++){var ft=ve[$e];if(void 0===this._processed[ft]){var Ct=this._regionQuery(ft);this._processed[ft]=1,this.clusters[lt].push(ft),this._orderedList.push(ft),void 0!==this._distanceToCore(ft)&&(this._updateQueue(ft,Ct,p),this._expandCluster(lt,p))}}},Fe.prototype._distanceToCore=function(lt){for(var p=this.epsilon,ve=0;ve<p;ve++)if(this._regionQuery(lt,ve).length>=this.minPts)return ve},Fe.prototype._regionQuery=function(lt,p){p=p||this.epsilon;for(var ve=[],$e=0,ut=this.dataset.length;$e<ut;$e++)this.distance(this.dataset[lt],this.dataset[$e])<p&&ve.push($e);return ve},Fe.prototype._euclideanDistance=function(lt,p){for(var ve=0,$e=Math.min(lt.length,p.length);$e--;)ve+=(lt[$e]-p[$e])*(lt[$e]-p[$e]);return Math.sqrt(ve)},an.exports&&(an.exports=Fe)},8759:an=>{function vt(je,Ee,Fe){this._queue=[],this._priorities=[],this._sorting="desc",this._init(je,Ee,Fe)}vt.prototype.insert=function(je,Ee){for(var Fe=this._queue.length,lt=Fe;lt--;){var p=this._priorities[lt];"desc"===this._sorting?Ee>p&&(Fe=lt):Ee<p&&(Fe=lt)}this._insertAt(je,Ee,Fe)},vt.prototype.remove=function(je){for(var Ee=this._queue.length;Ee--;)if(je===this._queue[Ee]){this._queue.splice(Ee,1),this._priorities.splice(Ee,1);break}},vt.prototype.forEach=function(je){this._queue.forEach(je)},vt.prototype.getElements=function(){return this._queue},vt.prototype.getElementPriority=function(je){return this._priorities[je]},vt.prototype.getPriorities=function(){return this._priorities},vt.prototype.getElementsWithPriorities=function(){for(var je=[],Ee=0,Fe=this._queue.length;Ee<Fe;Ee++)je.push([this._queue[Ee],this._priorities[Ee]]);return je},vt.prototype._init=function(je,Ee,Fe){if(je&&Ee){if(this._queue=[],this._priorities=[],je.length!==Ee.length)throw new Error("Arrays must have the same length");for(var lt=0;lt<je.length;lt++)this.insert(je[lt],Ee[lt])}Fe&&(this._sorting=Fe)},vt.prototype._insertAt=function(je,Ee,Fe){this._queue.length===Fe?(this._queue.push(je),this._priorities.push(Ee)):(this._queue.splice(Fe,0,je),this._priorities.splice(Fe,0,Ee))},an.exports&&(an.exports=vt)},7470:(an,vt,je)=>{an.exports&&(an.exports={DBSCAN:je(1817),KMEANS:je(4273),OPTICS:je(8680),PriorityQueue:je(8759)})},5469:an=>{"use strict";function vt(Pe,ct,Me){Me=Me||2;var Nt,fn,Lt,Mn,Rn,Bn,vn,tt=ct&&ct.length,dt=tt?ct[0]*Me:Pe.length,Ae=je(Pe,0,dt,Me,!0),Vt=[];if(!Ae||Ae.next===Ae.prev)return Vt;if(tt&&(Ae=function ut(Pe,ct,Me,tt){var Ae,Vt,Lt,dt=[];for(Ae=0,Vt=ct.length;Ae<Vt;Ae++)(Lt=je(Pe,ct[Ae]*tt,Ae<Vt-1?ct[Ae+1]*tt:Pe.length,tt,!1))===Lt.next&&(Lt.steiner=!0),dt.push(he(Lt));for(dt.sort(ft),Ae=0;Ae<dt.length;Ae++)Me=Ct(dt[Ae],Me);return Me}(Pe,ct,Ae,Me)),Pe.length>80*Me){Nt=Lt=Pe[0],fn=Mn=Pe[1];for(var Sn=Me;Sn<dt;Sn+=Me)(Rn=Pe[Sn])<Nt&&(Nt=Rn),(Bn=Pe[Sn+1])<fn&&(fn=Bn),Rn>Lt&&(Lt=Rn),Bn>Mn&&(Mn=Bn);vn=0!==(vn=Math.max(Lt-Nt,Mn-fn))?32767/vn:0}return Fe(Ae,Vt,Me,Nt,fn,vn,0),Vt}function je(Pe,ct,Me,tt,dt){var Ae,Vt;if(dt===At(Pe,ct,Me,tt)>0)for(Ae=ct;Ae<Me;Ae+=tt)Vt=qe(Ae,Pe[Ae],Pe[Ae+1],Vt);else for(Ae=Me-tt;Ae>=ct;Ae-=tt)Vt=qe(Ae,Pe[Ae],Pe[Ae+1],Vt);return Vt&&ce(Vt,Vt.next)&&(ue(Vt),Vt=Vt.next),Vt}function Ee(Pe,ct){if(!Pe)return Pe;ct||(ct=Pe);var tt,Me=Pe;do{if(tt=!1,Me.steiner||!ce(Me,Me.next)&&0!==Y(Me.prev,Me,Me.next))Me=Me.next;else{if(ue(Me),(Me=ct=Me.prev)===Me.next)break;tt=!0}}while(tt||Me!==ct);return ct}function Fe(Pe,ct,Me,tt,dt,Ae,Vt){if(Pe){!Vt&&Ae&&function xt(Pe,ct,Me,tt){var dt=Pe;do{0===dt.z&&(dt.z=pn(dt.x,dt.y,ct,Me,tt)),dt.prevZ=dt.prev,dt.nextZ=dt.next,dt=dt.next}while(dt!==Pe);dt.prevZ.nextZ=null,dt.prevZ=null,function Ut(Pe){var ct,Me,tt,dt,Ae,Vt,Nt,fn,Lt=1;do{for(Me=Pe,Pe=null,Ae=null,Vt=0;Me;){for(Vt++,tt=Me,Nt=0,ct=0;ct<Lt&&(Nt++,tt=tt.nextZ);ct++);for(fn=Lt;Nt>0||fn>0&&tt;)0!==Nt&&(0===fn||!tt||Me.z<=tt.z)?(dt=Me,Me=Me.nextZ,Nt--):(dt=tt,tt=tt.nextZ,fn--),Ae?Ae.nextZ=dt:Pe=dt,dt.prevZ=Ae,Ae=dt;Me=tt}Ae.nextZ=null,Lt*=2}while(Vt>1)}(dt)}(Pe,tt,dt,Ae);for(var fn,Lt,Nt=Pe;Pe.prev!==Pe.next;)if(fn=Pe.prev,Lt=Pe.next,Ae?p(Pe,tt,dt,Ae):lt(Pe))ct.push(fn.i/Me|0),ct.push(Pe.i/Me|0),ct.push(Lt.i/Me|0),ue(Pe),Pe=Lt.next,Nt=Lt.next;else if((Pe=Lt)===Nt){Vt?1===Vt?Fe(Pe=ve(Ee(Pe),ct,Me),ct,Me,tt,dt,Ae,2):2===Vt&&$e(Pe,ct,Me,tt,dt,Ae):Fe(Ee(Pe),ct,Me,tt,dt,Ae,1);break}}}function lt(Pe){var ct=Pe.prev,Me=Pe,tt=Pe.next;if(Y(ct,Me,tt)>=0)return!1;for(var dt=ct.x,Ae=Me.x,Vt=tt.x,Nt=ct.y,fn=Me.y,Lt=tt.y,Mn=dt<Ae?dt<Vt?dt:Vt:Ae<Vt?Ae:Vt,Rn=Nt<fn?Nt<Lt?Nt:Lt:fn<Lt?fn:Lt,Bn=dt>Ae?dt>Vt?dt:Vt:Ae>Vt?Ae:Vt,vn=Nt>fn?Nt>Lt?Nt:Lt:fn>Lt?fn:Lt,Sn=tt.next;Sn!==ct;){if(Sn.x>=Mn&&Sn.x<=Bn&&Sn.y>=Rn&&Sn.y<=vn&&Ie(dt,Nt,Ae,fn,Vt,Lt,Sn.x,Sn.y)&&Y(Sn.prev,Sn,Sn.next)>=0)return!1;Sn=Sn.next}return!0}function p(Pe,ct,Me,tt){var dt=Pe.prev,Ae=Pe,Vt=Pe.next;if(Y(dt,Ae,Vt)>=0)return!1;for(var Nt=dt.x,fn=Ae.x,Lt=Vt.x,Mn=dt.y,Rn=Ae.y,Bn=Vt.y,vn=Nt<fn?Nt<Lt?Nt:Lt:fn<Lt?fn:Lt,Sn=Mn<Rn?Mn<Bn?Mn:Bn:Rn<Bn?Rn:Bn,hn=Nt>fn?Nt>Lt?Nt:Lt:fn>Lt?fn:Lt,Jn=Mn>Rn?Mn>Bn?Mn:Bn:Rn>Bn?Rn:Bn,ti=pn(vn,Sn,ct,Me,tt),io=pn(hn,Jn,ct,Me,tt),Zn=Pe.prevZ,hr=Pe.nextZ;Zn&&Zn.z>=ti&&hr&&hr.z<=io;){if(Zn.x>=vn&&Zn.x<=hn&&Zn.y>=Sn&&Zn.y<=Jn&&Zn!==dt&&Zn!==Vt&&Ie(Nt,Mn,fn,Rn,Lt,Bn,Zn.x,Zn.y)&&Y(Zn.prev,Zn,Zn.next)>=0||(Zn=Zn.prevZ,hr.x>=vn&&hr.x<=hn&&hr.y>=Sn&&hr.y<=Jn&&hr!==dt&&hr!==Vt&&Ie(Nt,Mn,fn,Rn,Lt,Bn,hr.x,hr.y)&&Y(hr.prev,hr,hr.next)>=0))return!1;hr=hr.nextZ}for(;Zn&&Zn.z>=ti;){if(Zn.x>=vn&&Zn.x<=hn&&Zn.y>=Sn&&Zn.y<=Jn&&Zn!==dt&&Zn!==Vt&&Ie(Nt,Mn,fn,Rn,Lt,Bn,Zn.x,Zn.y)&&Y(Zn.prev,Zn,Zn.next)>=0)return!1;Zn=Zn.prevZ}for(;hr&&hr.z<=io;){if(hr.x>=vn&&hr.x<=hn&&hr.y>=Sn&&hr.y<=Jn&&hr!==dt&&hr!==Vt&&Ie(Nt,Mn,fn,Rn,Lt,Bn,hr.x,hr.y)&&Y(hr.prev,hr,hr.next)>=0)return!1;hr=hr.nextZ}return!0}function ve(Pe,ct,Me){var tt=Pe;do{var dt=tt.prev,Ae=tt.next.next;!ce(dt,Ae)&&ke(dt,tt,tt.next,Ae)&&J(dt,Ae)&&J(Ae,dt)&&(ct.push(dt.i/Me|0),ct.push(tt.i/Me|0),ct.push(Ae.i/Me|0),ue(tt),ue(tt.next),tt=Pe=Ae),tt=tt.next}while(tt!==Pe);return Ee(tt)}function $e(Pe,ct,Me,tt,dt,Ae){var Vt=Pe;do{for(var Nt=Vt.next.next;Nt!==Vt.prev;){if(Vt.i!==Nt.i&&le(Vt,Nt)){var fn=Ve(Vt,Nt);return Vt=Ee(Vt,Vt.next),fn=Ee(fn,fn.next),Fe(Vt,ct,Me,tt,dt,Ae,0),void Fe(fn,ct,Me,tt,dt,Ae,0)}Nt=Nt.next}Vt=Vt.next}while(Vt!==Pe)}function ft(Pe,ct){return Pe.x-ct.x}function Ct(Pe,ct){var Me=function Yt(Pe,ct){var Vt,Me=ct,tt=Pe.x,dt=Pe.y,Ae=-1/0;do{if(dt<=Me.y&&dt>=Me.next.y&&Me.next.y!==Me.y){var Nt=Me.x+(dt-Me.y)*(Me.next.x-Me.x)/(Me.next.y-Me.y);if(Nt<=tt&&Nt>Ae&&(Ae=Nt,Vt=Me.x<Me.next.x?Me:Me.next,Nt===tt))return Vt}Me=Me.next}while(Me!==ct);if(!Vt)return null;var Bn,fn=Vt,Lt=Vt.x,Mn=Vt.y,Rn=1/0;Me=Vt;do{tt>=Me.x&&Me.x>=Lt&&tt!==Me.x&&Ie(dt<Mn?tt:Ae,dt,Lt,Mn,dt<Mn?Ae:tt,dt,Me.x,Me.y)&&(Bn=Math.abs(dt-Me.y)/(tt-Me.x),J(Me,Pe)&&(Bn<Rn||Bn===Rn&&(Me.x>Vt.x||Me.x===Vt.x&&Ot(Vt,Me)))&&(Vt=Me,Rn=Bn)),Me=Me.next}while(Me!==fn);return Vt}(Pe,ct);if(!Me)return ct;var tt=Ve(Me,Pe);return Ee(tt,tt.next),Ee(Me,Me.next)}function Ot(Pe,ct){return Y(Pe.prev,Pe,ct.prev)<0&&Y(ct.next,Pe,Pe.next)<0}function pn(Pe,ct,Me,tt,dt){return(Pe=1431655765&((Pe=858993459&((Pe=252645135&((Pe=16711935&((Pe=(Pe-Me)*dt|0)|Pe<<8))|Pe<<4))|Pe<<2))|Pe<<1))|(ct=1431655765&((ct=858993459&((ct=252645135&((ct=16711935&((ct=(ct-tt)*dt|0)|ct<<8))|ct<<4))|ct<<2))|ct<<1))<<1}function he(Pe){var ct=Pe,Me=Pe;do{(ct.x<Me.x||ct.x===Me.x&&ct.y<Me.y)&&(Me=ct),ct=ct.next}while(ct!==Pe);return Me}function Ie(Pe,ct,Me,tt,dt,Ae,Vt,Nt){return(dt-Vt)*(ct-Nt)>=(Pe-Vt)*(Ae-Nt)&&(Pe-Vt)*(tt-Nt)>=(Me-Vt)*(ct-Nt)&&(Me-Vt)*(Ae-Nt)>=(dt-Vt)*(tt-Nt)}function le(Pe,ct){return Pe.next.i!==ct.i&&Pe.prev.i!==ct.i&&!function we(Pe,ct){var Me=Pe;do{if(Me.i!==Pe.i&&Me.next.i!==Pe.i&&Me.i!==ct.i&&Me.next.i!==ct.i&&ke(Me,Me.next,Pe,ct))return!0;Me=Me.next}while(Me!==Pe);return!1}(Pe,ct)&&(J(Pe,ct)&&J(ct,Pe)&&function pt(Pe,ct){var Me=Pe,tt=!1,dt=(Pe.x+ct.x)/2,Ae=(Pe.y+ct.y)/2;do{Me.y>Ae!=Me.next.y>Ae&&Me.next.y!==Me.y&&dt<(Me.next.x-Me.x)*(Ae-Me.y)/(Me.next.y-Me.y)+Me.x&&(tt=!tt),Me=Me.next}while(Me!==Pe);return tt}(Pe,ct)&&(Y(Pe.prev,Pe,ct.prev)||Y(Pe,ct.prev,ct))||ce(Pe,ct)&&Y(Pe.prev,Pe,Pe.next)>0&&Y(ct.prev,ct,ct.next)>0)}function Y(Pe,ct,Me){return(ct.y-Pe.y)*(Me.x-ct.x)-(ct.x-Pe.x)*(Me.y-ct.y)}function ce(Pe,ct){return Pe.x===ct.x&&Pe.y===ct.y}function ke(Pe,ct,Me,tt){var dt=se(Y(Pe,ct,Me)),Ae=se(Y(Pe,ct,tt)),Vt=se(Y(Me,tt,Pe)),Nt=se(Y(Me,tt,ct));return!!(dt!==Ae&&Vt!==Nt||0===dt&&de(Pe,Me,ct)||0===Ae&&de(Pe,tt,ct)||0===Vt&&de(Me,Pe,tt)||0===Nt&&de(Me,ct,tt))}function de(Pe,ct,Me){return ct.x<=Math.max(Pe.x,Me.x)&&ct.x>=Math.min(Pe.x,Me.x)&&ct.y<=Math.max(Pe.y,Me.y)&&ct.y>=Math.min(Pe.y,Me.y)}function se(Pe){return Pe>0?1:Pe<0?-1:0}function J(Pe,ct){return Y(Pe.prev,Pe,Pe.next)<0?Y(Pe,ct,Pe.next)>=0&&Y(Pe,Pe.prev,ct)>=0:Y(Pe,ct,Pe.prev)<0||Y(Pe,Pe.next,ct)<0}function Ve(Pe,ct){var Me=new Zt(Pe.i,Pe.x,Pe.y),tt=new Zt(ct.i,ct.x,ct.y),dt=Pe.next,Ae=ct.prev;return Pe.next=ct,ct.prev=Pe,Me.next=dt,dt.prev=Me,tt.next=Me,Me.prev=tt,Ae.next=tt,tt.prev=Ae,tt}function qe(Pe,ct,Me,tt){var dt=new Zt(Pe,ct,Me);return tt?(dt.next=tt.next,dt.prev=tt,tt.next.prev=dt,tt.next=dt):(dt.prev=dt,dt.next=dt),dt}function ue(Pe){Pe.next.prev=Pe.prev,Pe.prev.next=Pe.next,Pe.prevZ&&(Pe.prevZ.nextZ=Pe.nextZ),Pe.nextZ&&(Pe.nextZ.prevZ=Pe.prevZ)}function Zt(Pe,ct,Me){this.i=Pe,this.x=ct,this.y=Me,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function At(Pe,ct,Me,tt){for(var dt=0,Ae=ct,Vt=Me-tt;Ae<Me;Ae+=tt)dt+=(Pe[Vt]-Pe[Ae])*(Pe[Ae+1]+Pe[Vt+1]),Vt=Ae;return dt}an.exports=vt,an.exports.default=vt,vt.deviation=function(Pe,ct,Me,tt){var dt=ct&&ct.length,Vt=Math.abs(At(Pe,0,dt?ct[0]*Me:Pe.length,Me));if(dt)for(var Nt=0,fn=ct.length;Nt<fn;Nt++)Vt-=Math.abs(At(Pe,ct[Nt]*Me,Nt<fn-1?ct[Nt+1]*Me:Pe.length,Me));var Rn=0;for(Nt=0;Nt<tt.length;Nt+=3){var Bn=tt[Nt]*Me,vn=tt[Nt+1]*Me,Sn=tt[Nt+2]*Me;Rn+=Math.abs((Pe[Bn]-Pe[Sn])*(Pe[vn+1]-Pe[Bn+1])-(Pe[Bn]-Pe[vn])*(Pe[Sn+1]-Pe[Bn+1]))}return 0===Vt&&0===Rn?0:Math.abs((Rn-Vt)/Vt)},vt.flatten=function(Pe){for(var ct=Pe[0][0].length,Me={vertices:[],holes:[],dimensions:ct},tt=0,dt=0;dt<Pe.length;dt++){for(var Ae=0;Ae<Pe[dt].length;Ae++)for(var Vt=0;Vt<ct;Vt++)Me.vertices.push(Pe[dt][Ae][Vt]);dt>0&&Me.holes.push(tt+=Pe[dt-1].length)}return Me}},3457:an=>{"use strict";var vt="Function.prototype.bind called on incompatible ",je=Array.prototype.slice,Ee=Object.prototype.toString,Fe="[object Function]";an.exports=function(p){var ve=this;if("function"!=typeof ve||Ee.call(ve)!==Fe)throw new TypeError(vt+ve);for(var ut,$e=je.call(arguments,1),ft=function(){if(this instanceof ut){var Ut=ve.apply(this,$e.concat(je.call(arguments)));return Object(Ut)===Ut?Ut:this}return ve.apply(p,$e.concat(je.call(arguments)))},Ct=Math.max(0,ve.length-$e.length),Yt=[],Ot=0;Ot<Ct;Ot++)Yt.push("$"+Ot);if(ut=Function("binder","return function ("+Yt.join(",")+"){ return binder.apply(this,arguments); }")(ft),ve.prototype){var xt=function(){};xt.prototype=ve.prototype,ut.prototype=new xt,xt.prototype=null}return ut}},4444:(an,vt,je)=>{"use strict";var Ee=je(3457);an.exports=Function.prototype.bind||Ee},9582:an=>{"use strict";var vt=function(){return"string"==typeof function(){}.name},je=Object.getOwnPropertyDescriptor;if(je)try{je([],"length")}catch{je=null}vt.functionsHaveConfigurableNames=function(){if(!vt()||!je)return!1;var lt=je(function(){},"name");return!!lt&&!!lt.configurable};var Ee=Function.prototype.bind;vt.boundFunctionsHaveNames=function(){return vt()&&"function"==typeof Ee&&""!==function(){}.bind().name},an.exports=vt},5013:(an,vt,je)=>{var Ee=je(6952),Fe=function($e){this.precision=$e&&$e.precision?$e.precision:17,this.direction=!(!$e||!$e.direction)&&$e.direction,this.pseudoNode=!(!$e||!$e.pseudoNode)&&$e.pseudoNode,this.objectComparator=$e&&$e.objectComparator?$e.objectComparator:ve};function lt($e){return $e.coordinates.map(function(ut){return{type:$e.type.replace("Multi",""),coordinates:ut}})}function p($e,ut){return $e.hasOwnProperty("coordinates")?$e.coordinates.length===ut.coordinates.length:$e.length===ut.length}function ve($e,ut){return Ee($e,ut,{strict:!0})}Fe.prototype.compare=function($e,ut){if($e.type!==ut.type||!p($e,ut))return!1;switch($e.type){case"Point":return this.compareCoord($e.coordinates,ut.coordinates);case"LineString":return this.compareLine($e.coordinates,ut.coordinates,0,!1);case"Polygon":return this.comparePolygon($e,ut);case"Feature":return this.compareFeature($e,ut);default:if(0===$e.type.indexOf("Multi")){var ft=this,Ct=lt($e),Yt=lt(ut);return Ct.every(function(Ot){return this.some(function(xt){return ft.compare(Ot,xt)})},Yt)}}return!1},Fe.prototype.compareCoord=function($e,ut){if($e.length!==ut.length)return!1;for(var ft=0;ft<$e.length;ft++)if($e[ft].toFixed(this.precision)!==ut[ft].toFixed(this.precision))return!1;return!0},Fe.prototype.compareLine=function($e,ut,ft,Ct){if(!p($e,ut))return!1;var Yt=this.pseudoNode?$e:this.removePseudo($e),Ot=this.pseudoNode?ut:this.removePseudo(ut);if(!Ct||this.compareCoord(Yt[0],Ot[0])||(Ot=this.fixStartIndex(Ot,Yt))){var xt=this.compareCoord(Yt[ft],Ot[ft]);return this.direction||xt?this.comparePath(Yt,Ot):!!this.compareCoord(Yt[ft],Ot[Ot.length-(1+ft)])&&this.comparePath(Yt.slice().reverse(),Ot)}},Fe.prototype.fixStartIndex=function($e,ut){for(var ft,Ct=-1,Yt=0;Yt<$e.length;Yt++)if(this.compareCoord($e[Yt],ut[0])){Ct=Yt;break}return Ct>=0&&(ft=[].concat($e.slice(Ct,$e.length),$e.slice(1,Ct+1))),ft},Fe.prototype.comparePath=function($e,ut){var ft=this;return $e.every(function(Ct,Yt){return ft.compareCoord(Ct,this[Yt])},ut)},Fe.prototype.comparePolygon=function($e,ut){if(this.compareLine($e.coordinates[0],ut.coordinates[0],1,!0)){var ft=$e.coordinates.slice(1,$e.coordinates.length),Ct=ut.coordinates.slice(1,ut.coordinates.length),Yt=this;return ft.every(function(Ot){return this.some(function(xt){return Yt.compareLine(Ot,xt,1,!0)})},Ct)}return!1},Fe.prototype.compareFeature=function($e,ut){return!($e.id!==ut.id||!this.objectComparator($e.properties,ut.properties)||!this.compareBBox($e,ut))&&this.compare($e.geometry,ut.geometry)},Fe.prototype.compareBBox=function($e,ut){return!!(!$e.bbox&&!ut.bbox||$e.bbox&&ut.bbox&&this.compareCoord($e.bbox,ut.bbox))},Fe.prototype.removePseudo=function($e){return $e},an.exports=Fe},5406:(an,vt,je)=>{var Ee=je(7192),Fe=je(8275),lt=je(3269),p=je(1503).Z,ve=lt.featureEach,ft=Fe.featureCollection;function Ct(Yt){var Ot=new Ee(Yt);return Ot.insert=function(xt){if("Feature"!==xt.type)throw new Error("invalid feature");return xt.bbox=xt.bbox?xt.bbox:p(xt),Ee.prototype.insert.call(this,xt)},Ot.load=function(xt){var Ut=[];return Array.isArray(xt)?xt.forEach(function(pn){if("Feature"!==pn.type)throw new Error("invalid features");pn.bbox=pn.bbox?pn.bbox:p(pn),Ut.push(pn)}):ve(xt,function(pn){if("Feature"!==pn.type)throw new Error("invalid features");pn.bbox=pn.bbox?pn.bbox:p(pn),Ut.push(pn)}),Ee.prototype.load.call(this,Ut)},Ot.remove=function(xt,Ut){if("Feature"!==xt.type)throw new Error("invalid feature");return xt.bbox=xt.bbox?xt.bbox:p(xt),Ee.prototype.remove.call(this,xt,Ut)},Ot.clear=function(){return Ee.prototype.clear.call(this)},Ot.search=function(xt){var Ut=Ee.prototype.search.call(this,this.toBBox(xt));return ft(Ut)},Ot.collides=function(xt){return Ee.prototype.collides.call(this,this.toBBox(xt))},Ot.all=function(){var xt=Ee.prototype.all.call(this);return ft(xt)},Ot.toJSON=function(){return Ee.prototype.toJSON.call(this)},Ot.fromJSON=function(xt){return Ee.prototype.fromJSON.call(this,xt)},Ot.toBBox=function(xt){var Ut;if(xt.bbox)Ut=xt.bbox;else if(Array.isArray(xt)&&4===xt.length)Ut=xt;else if(Array.isArray(xt)&&6===xt.length)Ut=[xt[0],xt[1],xt[3],xt[4]];else if("Feature"===xt.type)Ut=p(xt);else{if("FeatureCollection"!==xt.type)throw new Error("invalid geojson");Ut=p(xt)}return{minX:Ut[0],minY:Ut[1],maxX:Ut[2],maxY:Ut[3]}},Ot}an.exports=Ct,an.exports.default=Ct},7192:function(an){an.exports=function(){"use strict";function vt(he,Ie,le,Y,ce){!function ke(de,se,we,J,pt){for(;J>we;){if(J-we>600){var Ve=J-we+1,qe=se-we+1,ue=Math.log(Ve),Zt=.5*Math.exp(2*ue/3),At=.5*Math.sqrt(ue*Zt*(Ve-Zt)/Ve)*(qe-Ve/2<0?-1:1);ke(de,se,Math.max(we,Math.floor(se-qe*Zt/Ve+At)),Math.min(J,Math.floor(se+(Ve-qe)*Zt/Ve+At)),pt)}var Me=de[se],tt=we,dt=J;for(je(de,we,se),pt(de[J],Me)>0&&je(de,we,J);tt<dt;){for(je(de,tt,dt),tt++,dt--;pt(de[tt],Me)<0;)tt++;for(;pt(de[dt],Me)>0;)dt--}0===pt(de[we],Me)?je(de,we,dt):je(de,++dt,J),dt<=se&&(we=dt+1),se<=dt&&(J=dt-1)}}(he,Ie,le||0,Y||he.length-1,ce||Ee)}function je(he,Ie,le){var Y=he[Ie];he[Ie]=he[le],he[le]=Y}function Ee(he,Ie){return he<Ie?-1:he>Ie?1:0}var Fe=function(he){void 0===he&&(he=9),this._maxEntries=Math.max(4,he),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function lt(he,Ie,le){if(!le)return Ie.indexOf(he);for(var Y=0;Y<Ie.length;Y++)if(le(he,Ie[Y]))return Y;return-1}function p(he,Ie){ve(he,0,he.children.length,Ie,he)}function ve(he,Ie,le,Y,ce){ce||(ce=Ut(null)),ce.minX=1/0,ce.minY=1/0,ce.maxX=-1/0,ce.maxY=-1/0;for(var ke=Ie;ke<le;ke++){var de=he.children[ke];$e(ce,he.leaf?Y(de):de)}return ce}function $e(he,Ie){return he.minX=Math.min(he.minX,Ie.minX),he.minY=Math.min(he.minY,Ie.minY),he.maxX=Math.max(he.maxX,Ie.maxX),he.maxY=Math.max(he.maxY,Ie.maxY),he}function ut(he,Ie){return he.minX-Ie.minX}function ft(he,Ie){return he.minY-Ie.minY}function Ct(he){return(he.maxX-he.minX)*(he.maxY-he.minY)}function Yt(he){return he.maxX-he.minX+(he.maxY-he.minY)}function Ot(he,Ie){return he.minX<=Ie.minX&&he.minY<=Ie.minY&&Ie.maxX<=he.maxX&&Ie.maxY<=he.maxY}function xt(he,Ie){return Ie.minX<=he.maxX&&Ie.minY<=he.maxY&&Ie.maxX>=he.minX&&Ie.maxY>=he.minY}function Ut(he){return{children:he,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function pn(he,Ie,le,Y,ce){for(var ke=[Ie,le];ke.length;)if(!((le=ke.pop())-(Ie=ke.pop())<=Y)){var de=Ie+Math.ceil((le-Ie)/Y/2)*Y;vt(he,de,Ie,le,ce),ke.push(Ie,de,de,le)}}return Fe.prototype.all=function(){return this._all(this.data,[])},Fe.prototype.search=function(he){var Ie=this.data,le=[];if(!xt(he,Ie))return le;for(var Y=this.toBBox,ce=[];Ie;){for(var ke=0;ke<Ie.children.length;ke++){var de=Ie.children[ke],se=Ie.leaf?Y(de):de;xt(he,se)&&(Ie.leaf?le.push(de):Ot(he,se)?this._all(de,le):ce.push(de))}Ie=ce.pop()}return le},Fe.prototype.collides=function(he){var Ie=this.data;if(!xt(he,Ie))return!1;for(var le=[];Ie;){for(var Y=0;Y<Ie.children.length;Y++){var ce=Ie.children[Y],ke=Ie.leaf?this.toBBox(ce):ce;if(xt(he,ke)){if(Ie.leaf||Ot(he,ke))return!0;le.push(ce)}}Ie=le.pop()}return!1},Fe.prototype.load=function(he){if(!he||!he.length)return this;if(he.length<this._minEntries){for(var Ie=0;Ie<he.length;Ie++)this.insert(he[Ie]);return this}var le=this._build(he.slice(),0,he.length-1,0);if(this.data.children.length)if(this.data.height===le.height)this._splitRoot(this.data,le);else{if(this.data.height<le.height){var Y=this.data;this.data=le,le=Y}this._insert(le,this.data.height-le.height-1,!0)}else this.data=le;return this},Fe.prototype.insert=function(he){return he&&this._insert(he,this.data.height-1),this},Fe.prototype.clear=function(){return this.data=Ut([]),this},Fe.prototype.remove=function(he,Ie){if(!he)return this;for(var le,Y,ce,ke=this.data,de=this.toBBox(he),se=[],we=[];ke||se.length;){if(ke||(ke=se.pop(),Y=se[se.length-1],le=we.pop(),ce=!0),ke.leaf){var J=lt(he,ke.children,Ie);if(-1!==J)return ke.children.splice(J,1),se.push(ke),this._condense(se),this}ce||ke.leaf||!Ot(ke,de)?Y?(le++,ke=Y.children[le],ce=!1):ke=null:(se.push(ke),we.push(le),le=0,Y=ke,ke=ke.children[0])}return this},Fe.prototype.toBBox=function(he){return he},Fe.prototype.compareMinX=function(he,Ie){return he.minX-Ie.minX},Fe.prototype.compareMinY=function(he,Ie){return he.minY-Ie.minY},Fe.prototype.toJSON=function(){return this.data},Fe.prototype.fromJSON=function(he){return this.data=he,this},Fe.prototype._all=function(he,Ie){for(var le=[];he;)he.leaf?Ie.push.apply(Ie,he.children):le.push.apply(le,he.children),he=le.pop();return Ie},Fe.prototype._build=function(he,Ie,le,Y){var ce,ke=le-Ie+1,de=this._maxEntries;if(ke<=de)return p(ce=Ut(he.slice(Ie,le+1)),this.toBBox),ce;Y||(Y=Math.ceil(Math.log(ke)/Math.log(de)),de=Math.ceil(ke/Math.pow(de,Y-1))),(ce=Ut([])).leaf=!1,ce.height=Y;var se=Math.ceil(ke/de),we=se*Math.ceil(Math.sqrt(de));pn(he,Ie,le,we,this.compareMinX);for(var J=Ie;J<=le;J+=we){var pt=Math.min(J+we-1,le);pn(he,J,pt,se,this.compareMinY);for(var Ve=J;Ve<=pt;Ve+=se){var qe=Math.min(Ve+se-1,pt);ce.children.push(this._build(he,Ve,qe,Y-1))}}return p(ce,this.toBBox),ce},Fe.prototype._chooseSubtree=function(he,Ie,le,Y){for(;Y.push(Ie),!Ie.leaf&&Y.length-1!==le;){for(var ce=1/0,ke=1/0,de=void 0,se=0;se<Ie.children.length;se++){var we=Ie.children[se],J=Ct(we),pt=(Ve=he,qe=we,(Math.max(qe.maxX,Ve.maxX)-Math.min(qe.minX,Ve.minX))*(Math.max(qe.maxY,Ve.maxY)-Math.min(qe.minY,Ve.minY))-J);pt<ke?(ke=pt,ce=J<ce?J:ce,de=we):pt===ke&&J<ce&&(ce=J,de=we)}Ie=de||Ie.children[0]}var Ve,qe;return Ie},Fe.prototype._insert=function(he,Ie,le){var Y=le?he:this.toBBox(he),ce=[],ke=this._chooseSubtree(Y,this.data,Ie,ce);for(ke.children.push(he),$e(ke,Y);Ie>=0&&ce[Ie].children.length>this._maxEntries;)this._split(ce,Ie),Ie--;this._adjustParentBBoxes(Y,ce,Ie)},Fe.prototype._split=function(he,Ie){var le=he[Ie],Y=le.children.length,ce=this._minEntries;this._chooseSplitAxis(le,ce,Y);var ke=this._chooseSplitIndex(le,ce,Y),de=Ut(le.children.splice(ke,le.children.length-ke));de.height=le.height,de.leaf=le.leaf,p(le,this.toBBox),p(de,this.toBBox),Ie?he[Ie-1].children.push(de):this._splitRoot(le,de)},Fe.prototype._splitRoot=function(he,Ie){this.data=Ut([he,Ie]),this.data.height=he.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},Fe.prototype._chooseSplitIndex=function(he,Ie,le){for(var Y,ce,ke,de,se,we,J,pt=1/0,Ve=1/0,qe=Ie;qe<=le-Ie;qe++){var ue=ve(he,0,qe,this.toBBox),Zt=ve(he,qe,le,this.toBBox),At=(ce=ue,ke=Zt,void 0,void 0,void 0,void 0,de=Math.max(ce.minX,ke.minX),se=Math.max(ce.minY,ke.minY),we=Math.min(ce.maxX,ke.maxX),J=Math.min(ce.maxY,ke.maxY),Math.max(0,we-de)*Math.max(0,J-se)),Pe=Ct(ue)+Ct(Zt);At<pt?(pt=At,Y=qe,Ve=Pe<Ve?Pe:Ve):At===pt&&Pe<Ve&&(Ve=Pe,Y=qe)}return Y||le-Ie},Fe.prototype._chooseSplitAxis=function(he,Ie,le){var Y=he.leaf?this.compareMinX:ut,ce=he.leaf?this.compareMinY:ft;this._allDistMargin(he,Ie,le,Y)<this._allDistMargin(he,Ie,le,ce)&&he.children.sort(Y)},Fe.prototype._allDistMargin=function(he,Ie,le,Y){he.children.sort(Y);for(var ce=this.toBBox,ke=ve(he,0,Ie,ce),de=ve(he,le-Ie,le,ce),se=Yt(ke)+Yt(de),we=Ie;we<le-Ie;we++){var J=he.children[we];$e(ke,he.leaf?ce(J):J),se+=Yt(ke)}for(var pt=le-Ie-1;pt>=Ie;pt--){var Ve=he.children[pt];$e(de,he.leaf?ce(Ve):Ve),se+=Yt(de)}return se},Fe.prototype._adjustParentBBoxes=function(he,Ie,le){for(var Y=le;Y>=0;Y--)$e(Ie[Y],he)},Fe.prototype._condense=function(he){for(var Ie=he.length-1,le=void 0;Ie>=0;Ie--)0===he[Ie].children.length?Ie>0?(le=he[Ie-1].children).splice(le.indexOf(he[Ie]),1):this.clear():p(he[Ie],this.toBBox)},Fe}()},5203:(an,vt,je)=>{"use strict";var Ee,Fe=SyntaxError,lt=Function,p=TypeError,ve=function(qe){try{return lt('"use strict"; return ('+qe+").constructor;")()}catch{}},$e=Object.getOwnPropertyDescriptor;if($e)try{$e({},"")}catch{$e=null}var ut=function(){throw new p},ft=$e?function(){try{return ut}catch{try{return $e(arguments,"callee").get}catch{return ut}}}():ut,Ct=je(2969)(),Yt=Object.getPrototypeOf||function(qe){return qe.__proto__},Ot={},xt=typeof Uint8Array>"u"?Ee:Yt(Uint8Array),Ut={"%AggregateError%":typeof AggregateError>"u"?Ee:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?Ee:ArrayBuffer,"%ArrayIteratorPrototype%":Ct?Yt([][Symbol.iterator]()):Ee,"%AsyncFromSyncIteratorPrototype%":Ee,"%AsyncFunction%":Ot,"%AsyncGenerator%":Ot,"%AsyncGeneratorFunction%":Ot,"%AsyncIteratorPrototype%":Ot,"%Atomics%":typeof Atomics>"u"?Ee:Atomics,"%BigInt%":typeof BigInt>"u"?Ee:BigInt,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?Ee:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array>"u"?Ee:Float32Array,"%Float64Array%":typeof Float64Array>"u"?Ee:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?Ee:FinalizationRegistry,"%Function%":lt,"%GeneratorFunction%":Ot,"%Int8Array%":typeof Int8Array>"u"?Ee:Int8Array,"%Int16Array%":typeof Int16Array>"u"?Ee:Int16Array,"%Int32Array%":typeof Int32Array>"u"?Ee:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":Ct?Yt(Yt([][Symbol.iterator]())):Ee,"%JSON%":"object"==typeof JSON?JSON:Ee,"%Map%":typeof Map>"u"?Ee:Map,"%MapIteratorPrototype%":typeof Map>"u"||!Ct?Ee:Yt((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?Ee:Promise,"%Proxy%":typeof Proxy>"u"?Ee:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect>"u"?Ee:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?Ee:Set,"%SetIteratorPrototype%":typeof Set>"u"||!Ct?Ee:Yt((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?Ee:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":Ct?Yt(""[Symbol.iterator]()):Ee,"%Symbol%":Ct?Symbol:Ee,"%SyntaxError%":Fe,"%ThrowTypeError%":ft,"%TypedArray%":xt,"%TypeError%":p,"%Uint8Array%":typeof Uint8Array>"u"?Ee:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?Ee:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?Ee:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?Ee:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap>"u"?Ee:WeakMap,"%WeakRef%":typeof WeakRef>"u"?Ee:WeakRef,"%WeakSet%":typeof WeakSet>"u"?Ee:WeakSet},pn=function qe(ue){var Zt;if("%AsyncFunction%"===ue)Zt=ve("async function () {}");else if("%GeneratorFunction%"===ue)Zt=ve("function* () {}");else if("%AsyncGeneratorFunction%"===ue)Zt=ve("async function* () {}");else if("%AsyncGenerator%"===ue){var At=qe("%AsyncGeneratorFunction%");At&&(Zt=At.prototype)}else if("%AsyncIteratorPrototype%"===ue){var Pe=qe("%AsyncGenerator%");Pe&&(Zt=Yt(Pe.prototype))}return Ut[ue]=Zt,Zt},he={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ie=je(4444),le=je(3164),Y=Ie.call(Function.call,Array.prototype.concat),ce=Ie.call(Function.apply,Array.prototype.splice),ke=Ie.call(Function.call,String.prototype.replace),de=Ie.call(Function.call,String.prototype.slice),se=Ie.call(Function.call,RegExp.prototype.exec),we=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,J=/\\(\\)?/g,pt=function(ue){var Zt=de(ue,0,1),At=de(ue,-1);if("%"===Zt&&"%"!==At)throw new Fe("invalid intrinsic syntax, expected closing `%`");if("%"===At&&"%"!==Zt)throw new Fe("invalid intrinsic syntax, expected opening `%`");var Pe=[];return ke(ue,we,function(ct,Me,tt,dt){Pe[Pe.length]=tt?ke(dt,J,"$1"):Me||ct}),Pe},Ve=function(ue,Zt){var Pe,At=ue;if(le(he,At)&&(At="%"+(Pe=he[At])[0]+"%"),le(Ut,At)){var ct=Ut[At];if(ct===Ot&&(ct=pn(At)),typeof ct>"u"&&!Zt)throw new p("intrinsic "+ue+" exists, but is not available. Please file an issue!");return{alias:Pe,name:At,value:ct}}throw new Fe("intrinsic "+ue+" does not exist!")};an.exports=function(ue,Zt){if("string"!=typeof ue||0===ue.length)throw new p("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof Zt)throw new p('"allowMissing" argument must be a boolean');if(null===se(/^%?[^%]*%?$/,ue))throw new Fe("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var At=pt(ue),Pe=At.length>0?At[0]:"",ct=Ve("%"+Pe+"%",Zt),Me=ct.name,tt=ct.value,dt=!1,Ae=ct.alias;Ae&&(Pe=Ae[0],ce(At,Y([0,1],Ae)));for(var Vt=1,Nt=!0;Vt<At.length;Vt+=1){var fn=At[Vt],Lt=de(fn,0,1),Mn=de(fn,-1);if(('"'===Lt||"'"===Lt||"`"===Lt||'"'===Mn||"'"===Mn||"`"===Mn)&&Lt!==Mn)throw new Fe("property names with quotes must have matching quotes");if(("constructor"===fn||!Nt)&&(dt=!0),le(Ut,Me="%"+(Pe+="."+fn)+"%"))tt=Ut[Me];else if(null!=tt){if(!(fn in tt)){if(!Zt)throw new p("base intrinsic for "+ue+" exists, but the property is not available.");return}if($e&&Vt+1>=At.length){var Rn=$e(tt,fn);tt=(Nt=!!Rn)&&"get"in Rn&&!("originalValue"in Rn.get)?Rn.get:tt[fn]}else Nt=le(tt,fn),tt=tt[fn];Nt&&!dt&&(Ut[Me]=tt)}}return tt}},7027:(an,vt,je)=>{"use strict";var Fe=je(5203)("%Object.defineProperty%",!0),lt=function(){if(Fe)try{return Fe({},"a",{value:1}),!0}catch{return!1}return!1};lt.hasArrayLengthDefineBug=function(){if(!lt())return null;try{return 1!==Fe([],"length",{value:1}).length}catch{return!0}},an.exports=lt},2969:(an,vt,je)=>{"use strict";var Ee=typeof Symbol<"u"&&Symbol,Fe=je(1983);an.exports=function(){return"function"==typeof Ee&&"function"==typeof Symbol&&"symbol"==typeof Ee("foo")&&"symbol"==typeof Symbol("bar")&&Fe()}},1983:an=>{"use strict";an.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var je={},Ee=Symbol("test"),Fe=Object(Ee);if("string"==typeof Ee||"[object Symbol]"!==Object.prototype.toString.call(Ee)||"[object Symbol]"!==Object.prototype.toString.call(Fe))return!1;for(Ee in je[Ee]=42,je)return!1;if("function"==typeof Object.keys&&0!==Object.keys(je).length||"function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(je).length)return!1;var p=Object.getOwnPropertySymbols(je);if(1!==p.length||p[0]!==Ee||!Object.prototype.propertyIsEnumerable.call(je,Ee))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var ve=Object.getOwnPropertyDescriptor(je,Ee);if(42!==ve.value||!0!==ve.enumerable)return!1}return!0}},6259:(an,vt,je)=>{"use strict";var Ee=je(1983);an.exports=function(){return Ee()&&!!Symbol.toStringTag}},3164:(an,vt,je)=>{"use strict";var Ee=je(4444);an.exports=Ee.call(Function.call,Object.prototype.hasOwnProperty)},3407:(an,vt,je)=>{"use strict";var Ee=je(6259)(),lt=je(5834)("Object.prototype.toString"),p=function(ft){return!(Ee&&ft&&"object"==typeof ft&&Symbol.toStringTag in ft)&&"[object Arguments]"===lt(ft)},ve=function(ft){return!!p(ft)||null!==ft&&"object"==typeof ft&&"number"==typeof ft.length&&ft.length>=0&&"[object Array]"!==lt(ft)&&"[object Function]"===lt(ft.callee)},$e=function(){return p(arguments)}();p.isLegacyArguments=ve,an.exports=$e?p:ve},2374:(an,vt,je)=>{"use strict";var Ee=Date.prototype.getDay,lt=Object.prototype.toString,ve=je(6259)();an.exports=function(ut){return"object"==typeof ut&&null!==ut&&(ve?function(ut){try{return Ee.call(ut),!0}catch{return!1}}(ut):"[object Date]"===lt.call(ut))}},2342:(an,vt,je)=>{"use strict";var lt,p,ve,$e,Ee=je(5834),Fe=je(6259)();if(Fe){lt=Ee("Object.prototype.hasOwnProperty"),p=Ee("RegExp.prototype.exec"),ve={};var ut=function(){throw ve};$e={toString:ut,valueOf:ut},"symbol"==typeof Symbol.toPrimitive&&($e[Symbol.toPrimitive]=ut)}var ft=Ee("Object.prototype.toString"),Ct=Object.getOwnPropertyDescriptor;an.exports=Fe?function(xt){if(!xt||"object"!=typeof xt)return!1;var Ut=Ct(xt,"lastIndex");if(!Ut||!lt(Ut,"value"))return!1;try{p(xt,$e)}catch(he){return he===ve}}:function(xt){return!(!xt||"object"!=typeof xt&&"function"!=typeof xt)&&"[object RegExp]"===ft(xt)}},9898:function(an){an.exports=function(){"use strict";var vt,je,Ee;function Fe(p,ve){if(vt)if(je){var $e="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+vt+")(sharedChunk); ("+je+")(sharedChunk); self.onerror = null;",ut={};vt(ut),Ee=ve(ut),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Ee.workerUrl=window.URL.createObjectURL(new Blob([$e],{type:"text/javascript"})))}else je=ve;else vt=ve}return Fe(0,function(p){var ve=typeof self<"u"?self:{},$e="2.11.1";let ut;const ft={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ut){const s=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ut=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):s}catch{ut=s}}return ut},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ct={supported:!1,testSupport:function(s){!xt&&Ot&&(Ut?pn(s):Yt=s)}};let Yt,Ot,xt=!1,Ut=!1;function pn(s){const i=s.createTexture();s.bindTexture(s.TEXTURE_2D,i);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Ot),s.isContextLost())return;Ct.supported=!0}catch{}s.deleteTexture(i),xt=!0}ve.document&&(Ot=ve.document.createElement("img"),Ot.onload=function(){Yt&&pn(Yt),Yt=null,Ut=!0},Ot.onerror=function(){xt=!0,Yt=null},Ot.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const he="01";var Ie=le;function le(s,i,a,f){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=a,this.p2y=f}le.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(void 0===i&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,f=0;f<8;f++){var m=this.sampleCurveX(a)-s;if(Math.abs(m)<i)return a;var w=this.sampleCurveDerivativeX(a);if(Math.abs(w)<1e-6)break;a-=m/w}var S=0,D=1;for(a=s,f=0;f<20&&(m=this.sampleCurveX(a),!(Math.abs(m-s)<i));f++)s>m?S=a:D=a,a=.5*(D-S)+S;return a},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Y=ce;function ce(s,i){this.x=s,this.y=i}ce.prototype={clone:function(){return new ce(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,a=s.y-this.y;return i*i+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),a=Math.sin(s),f=a*this.x+i*this.y;return this.x=i*this.x-a*this.y,this.y=f,this},_rotateAround:function(s,i){var a=Math.cos(s),f=Math.sin(s),m=i.y+f*(this.x-i.x)+a*(this.y-i.y);return this.x=i.x+a*(this.x-i.x)-f*(this.y-i.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ce.convert=function(s){return s instanceof ce?s:Array.isArray(s)?new ce(s[0],s[1]):s};const ke=Math.PI/180,de=180/Math.PI;function se(s){return s*ke}function we(s){return s*de}const J=[[0,0],[1,0],[1,1],[0,1]];function pt(s){if(s<=0)return 0;if(s>=1)return 1;const i=s*s,a=i*s;return 4*(s<.5?a:3*(s-i)+a-.75)}function Ve(s,i,a,f){const m=new Ie(s,i,a,f);return function(w){return m.solve(w)}}const qe=Ve(.25,.1,.25,1);function ue(s,i,a){return Math.min(a,Math.max(i,s))}function Zt(s,i,a){return(a=ue((a-s)/(i-s),0,1))*a*(3-2*a)}function At(s,i,a){const f=a-i,m=((s-i)%f+f)%f+i;return m===i?a:m}function Pe(s,i,a){if(!s.length)return a(null,[]);let f=s.length;const m=new Array(s.length);let w=null;s.forEach((S,D)=>{i(S,(P,L)=>{P&&(w=P),m[D]=L,0==--f&&a(w,m)})})}function ct(s){const i=[];for(const a in s)i.push(s[a]);return i}function Me(s,...i){for(const a of i)for(const f in a)s[f]=a[f];return s}let tt=1;function dt(){return tt++}function Ae(){return function s(i){return i?(i^Math.random()*(16>>i/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()}function Vt(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))}function Nt(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)}function fn(s,i){s.forEach(a=>{i[a]&&(i[a]=i[a].bind(i))})}function Lt(s,i){return-1!==s.indexOf(i,s.length-i.length)}function Mn(s,i,a){const f={};for(const m in s)f[m]=i.call(a||this,s[m],m,s);return f}function Rn(s,i,a){const f={};for(const m in s)i.call(a||this,s[m],m,s)&&(f[m]=s[m]);return f}function Bn(s){return Array.isArray(s)?s.map(Bn):"object"==typeof s&&s?Mn(s,Bn):s}const vn={};function Sn(s){vn[s]||(typeof console<"u"&&console.warn(s),vn[s]=!0)}function hn(s,i,a){return(a.y-s.y)*(i.x-s.x)>(i.y-s.y)*(a.x-s.x)}function Jn(s){let i=0;for(let a,f,m=0,w=s.length,S=w-1;m<w;S=m++)a=s[m],f=s[S],i+=(f.x-a.x)*(a.y+f.y);return i}function ti(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function io(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,f,m,w)=>{const S=m||w;return i[f]=!S||S.toLowerCase(),""}),i["max-age"]){const a=parseInt(i["max-age"],10);isNaN(a)?delete i["max-age"]:i["max-age"]=a}return i}let Zn=null;function hr(s){if(null==Zn){const i=s.navigator?s.navigator.userAgent:null;Zn=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return Zn}function _t(s){try{const i=ve[s];return i.setItem("_mapbox_test_",1),i.removeItem("_mapbox_test_"),!0}catch{return!1}}function ye(s,i){return[s[4*i],s[4*i+1],s[4*i+2],s[4*i+3]]}const fe="mapbox-tiles";let ae,ze,ht=500,Bt=50;function on(){try{return ve.caches}catch{}}function sn(){on()&&!ae&&(ae=ve.caches.open(fe))}function Gt(s){const i=s.indexOf("?");if(i<0)return s;const f=function(m){const w=m.indexOf("?");return w>0?m.slice(w+1).split("&"):[]}(s).filter(m=>{const w=m.split("=");return"language"===w[0]||"worldview"===w[0]});return f.length?`${s.slice(0,i)}?${f.join("&")}`:s.slice(0,i)}let ur=1/0;const lr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(lr);class En extends Error{constructor(i,a,f){401===a&&As(f)&&(i+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(i),this.status=a,this.url=f}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Cr=ti()?()=>self.worker&&self.worker.referrer:()=>("blob:"===ve.location.protocol?ve.parent:ve).location.href,Ei=function(s,i){if(!(/^file:/.test(a=s.url)||/^file:/.test(Cr())&&!/^\w+:/.test(a))){if(ve.fetch&&ve.Request&&ve.AbortController&&ve.Request.prototype.hasOwnProperty("signal"))return function(f,m){const w=new ve.AbortController,S=new ve.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:Cr(),signal:w.signal});let D=!1,P=!1;const L=(F=S.url).indexOf("sku=")>0&&As(F);var F;"json"===f.type&&S.headers.set("Accept","application/json");const V=(H,X,te)=>{if(P)return;if(H&&"SecurityError"!==H.message&&Sn(H),X&&te)return j(X);const _e=Date.now();ve.fetch(S).then(Ue=>{if(Ue.ok){const Xe=L?Ue.clone():null;return j(Ue,Xe,_e)}return m(new En(Ue.statusText,Ue.status,f.url))}).catch(Ue=>{20!==Ue.code&&m(new Error(Ue.message))})},j=(H,X,te)=>{("arrayBuffer"===f.type?H.arrayBuffer():"json"===f.type?H.json():H.text()).then(_e=>{P||(X&&te&&function(Ue,Xe,Be){if(sn(),!ae)return;const Ze={status:Xe.status,statusText:Xe.statusText,headers:new ve.Headers};Xe.headers.forEach((Mt,It)=>Ze.headers.set(It,Mt));const rt=io(Xe.headers.get("Cache-Control")||"");if(rt["no-store"])return;rt["max-age"]&&Ze.headers.set("Expires",new Date(Be+1e3*rt["max-age"]).toUTCString());const We=Ze.headers.get("Expires");We&&(new Date(We).getTime()-Be<42e4||function(Mt,It){if(void 0===ze)try{new Response(new ReadableStream),ze=!0}catch{ze=!1}ze?It(Mt.body):Mt.blob().then(It)}(Xe,Mt=>{const It=new ve.Response(Mt,Ze);sn(),ae&&ae.then(Ht=>Ht.put(Gt(Ue.url),It)).catch(Ht=>Sn(Ht.message))}))}(S,X,te),D=!0,m(null,_e,H.headers.get("Cache-Control"),H.headers.get("Expires")))}).catch(_e=>{P||m(new Error(_e.message))})};return L?function(H,X){if(sn(),!ae)return X(null);const te=Gt(H.url);ae.then(_e=>{_e.match(te).then(Ue=>{const Xe=function(Be){if(!Be)return!1;const Ze=new Date(Be.headers.get("Expires")||0),rt=io(Be.headers.get("Cache-Control")||"");return Ze>Date.now()&&!rt["no-cache"]}(Ue);_e.delete(te),Xe&&_e.put(te,Ue.clone()),X(null,Ue,Xe)}).catch(X)}).catch(X)}(S,V):V(null,null),{cancel:()=>{P=!0,D||w.abort()}}}(s,i);if(ti()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,i,void 0,!0)}var a;return function(f,m){const w=new ve.XMLHttpRequest;w.open(f.method||"GET",f.url,!0),"arrayBuffer"===f.type&&(w.responseType="arraybuffer");for(const S in f.headers)w.setRequestHeader(S,f.headers[S]);return"json"===f.type&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials="include"===f.credentials,w.onerror=()=>{m(new Error(w.statusText))},w.onload=()=>{if((w.status>=200&&w.status<300||0===w.status)&&null!==w.response){let S=w.response;if("json"===f.type)try{S=JSON.parse(w.response)}catch(D){return m(D)}m(null,S,w.getResponseHeader("Cache-Control"),w.getResponseHeader("Expires"))}else m(new En(w.statusText,w.status,f.url))},w.send(f.body),{cancel:()=>w.abort()}}(s,i)},qr=function(s,i){return Ei(Me(s,{type:"arrayBuffer"}),i)};function ui(s){const i=ve.document.createElement("a");return i.href=s,i.protocol===ve.document.location.protocol&&i.host===ve.document.location.host}const Do="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let jo,es;jo=[],es=0;const wo=function(s,i){if(Ct.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),es>=ft.MAX_PARALLEL_IMAGE_REQUESTS){const w={requestParameters:s,callback:i,cancelled:!1,cancel(){this.cancelled=!0}};return jo.push(w),w}es++;let a=!1;const f=()=>{if(!a)for(a=!0,es--;jo.length&&es<ft.MAX_PARALLEL_IMAGE_REQUESTS;){const w=jo.shift(),{requestParameters:S,callback:D,cancelled:P}=w;P||(w.cancel=wo(S,D).cancel)}},m=qr(s,(w,S,D,P)=>{f(),w?i(w):S&&(ve.createImageBitmap?function(L,F){const V=new ve.Blob([new Uint8Array(L)],{type:"image/png"});ve.createImageBitmap(V).then(j=>{F(null,j)}).catch(j=>{F(new Error(`Could not load image because of ${j.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(S,(L,F)=>i(L,F,D,P)):function(L,F){const V=new ve.Image,j=ve.URL;V.onload=()=>{F(null,V),j.revokeObjectURL(V.src),V.onload=null,ve.requestAnimationFrame(()=>{V.src=Do})},V.onerror=()=>F(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const H=new ve.Blob([new Uint8Array(L)],{type:"image/png"});V.src=L.byteLength?j.createObjectURL(H):Do}(S,(L,F)=>i(L,F,D,P)))});return{cancel:()=>{m.cancel(),f()}}},ds="NO_ACCESS_TOKEN";function oi(s){return 0===s.indexOf("mapbox:")}function As(s){return ft.API_URL_REGEX.test(s)}function ts(s){return ft.API_STYLE_REGEX.test(s)&&!gn(s)}function gn(s){return ft.API_SPRITE_REGEX.test(s)}const au=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function No(s){const i=s.match(au);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function _r(s){const i=s.params.length?`?${s.params.join("&")}`:"";return`${s.protocol}://${s.authority}${s.path}${i}`}function Oa(s){if(!s)return null;const i=s.split(".");if(!i||3!==i.length)return null;try{return JSON.parse(decodeURIComponent(ve.atob(i[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Go{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const a=Oa(ft.ACCESS_TOKEN);let f="";return f=a&&a.u?ve.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(m,w)=>String.fromCharCode(Number("0x"+w)))):ft.ACCESS_TOKEN||"",i?`mapbox.eventData.${i}:${f}`:`mapbox.eventData:${f}`}fetchEventData(){const i=_t("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{const m=ve.localStorage.getItem(a);m&&(this.eventData=JSON.parse(m));const w=ve.localStorage.getItem(f);w&&(this.anonId=w)}catch{Sn("Unable to read from LocalStorage")}}saveEventData(){const i=_t("localStorage"),a=this.getStorageKey(),f=this.getStorageKey("uuid");if(i)try{ve.localStorage.setItem(f,this.anonId),Object.keys(this.eventData).length>=1&&ve.localStorage.setItem(a,JSON.stringify(this.eventData))}catch{Sn("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,a,f,m){if(!ft.EVENTS_URL)return;const w=No(ft.EVENTS_URL);w.params.push(`access_token=${m||ft.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(i).toISOString()},D=a?Me(S,a):S,P={url:_r(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([D])};var F;this.pendingRequest=(F=L=>{this.pendingRequest=null,f(L),this.saveEventData(),this.processRequests(m)},Ei(Me(P,{method:"POST"}),F))}queueRequest(i,a){this.queue.push(i),this.processRequests(a)}}const Le=new class extends Go{constructor(s){super("appUserTurnstile"),this._customAccessToken=s}postTurnstileEvent(s,i){ft.EVENTS_URL&&ft.ACCESS_TOKEN&&Array.isArray(s)&&s.some(a=>oi(a)||As(a))&&this.queueRequest(Date.now(),i)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Oa(ft.ACCESS_TOKEN),a=i?i.u:ft.ACCESS_TOKEN;let f=a!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=Ae(),f=!0);const m=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),S=new Date(m),D=(m-this.eventData.lastSuccess)/864e5;f=f||D>=1||D<-1||w.getDate()!==S.getDate()}else f=!0;f?this.postEvent(m,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$e,skuId:he,"enabled.telemetry":!1,userId:this.anonId},w=>{w||(this.eventData.lastSuccess=m,this.eventData.tokenU=a)},s):this.processRequests()}},W=Le.postTurnstileEvent.bind(Le),ne=new class extends Go{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(s,i,a,f){this.skuToken=i,this.errorCb=f,ft.EVENTS_URL&&(a||ft.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(ds)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=Ae()),this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:$e,skuId:he,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s))}},Oe=ne.postMapLoadEvent.bind(ne),He=new class extends Go{constructor(){super("gljs.performance")}postPerformanceEvent(s,i){ft.EVENTS_URL&&(s||ft.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},s)}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:a}=this.queue.shift(),f=function(m){const w=ve.performance.getEntriesByType("resource"),S=ve.performance.getEntriesByType("mark"),D=function(j){const H={};if(j)for(const X in j)if("other"!==X)for(const te of j[X]){const _e=`${X}RequestCount`,Ue=`${X}ResolveRangeMin`,Xe=`${X}ResolveRangeMax`;H[Ue]=Math.min(H[Ue]||1/0,te.startTime),H[Xe]=Math.max(H[Xe]||-1/0,te.responseEnd),void 0===H[_e]&&(H[_e]=0),++H[_e]}return H}(function(j,H){const X={};if(j)for(const te of j){const _e=H(te);void 0===X[_e]&&(X[_e]=[]),X[_e].push(te)}return X}(w,yn)),P=ve.devicePixelRatio,L=ve.navigator.connection||ve.navigator.mozConnection||ve.navigator.webkitConnection,F={counters:[],metadata:[],attributes:[]},V=(j,H,X)=>{null!=X&&j.push({name:H,value:X.toString()})};for(const j in D)V(F.counters,j,D[j]);if(m.interactionRange[0]!==1/0&&m.interactionRange[1]!==-1/0&&(V(F.counters,"interactionRangeMin",m.interactionRange[0]),V(F.counters,"interactionRangeMax",m.interactionRange[1])),S)for(const j of Object.keys(st)){const H=st[j],X=S.find(te=>te.name===H);X&&V(F.counters,H,X.startTime)}return V(F.counters,"visibilityHidden",m.visibilityHidden),V(F.attributes,"style",function(j){if(j)for(const H of j){const X=H.name.split("?")[0];if(ts(X)){const te=X.split("/").slice(-2);if(2===te.length)return`mapbox://styles/${te[0]}/${te[1]}`}}}(w)),V(F.attributes,"terrainEnabled",m.terrainEnabled?"true":"false"),V(F.attributes,"fogEnabled",m.fogEnabled?"true":"false"),V(F.attributes,"projection",m.projection.name),V(F.attributes,"zoom",m.zoom),V(F.metadata,"devicePixelRatio",P),V(F.metadata,"connectionEffectiveType",L?L.effectiveType:void 0),V(F.metadata,"navigatorUserAgent",ve.navigator.userAgent),V(F.metadata,"screenWidth",ve.screen.width),V(F.metadata,"screenHeight",ve.screen.height),V(F.metadata,"windowWidth",ve.innerWidth),V(F.metadata,"windowHeight",ve.innerHeight),V(F.metadata,"mapWidth",m.width/P),V(F.metadata,"mapHeight",m.height/P),V(F.metadata,"webglRenderer",m.renderer),V(F.metadata,"webglVendor",m.vendor),V(F.metadata,"sdkVersion",$e),V(F.metadata,"sdkIdentifier","mapbox-gl-js"),F}(a);for(const m of f.metadata);for(const m of f.counters);for(const m of f.attributes);this.postEvent(i,f,()=>{},s)}},nt=He.postPerformanceEvent.bind(He),bt=new class extends Go{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(s,i,a,f){if(!ft.API_URL||!ft.SESSION_PATH)return;const m=No(ft.API_URL+ft.SESSION_PATH);m.params.push(`sku=${i||""}`),m.params.push(`access_token=${f||ft.ACCESS_TOKEN||""}`);const w={url:_r(m),headers:{"Content-Type":"text/plain"}};var D;this.pendingRequest=(D=S=>{this.pendingRequest=null,a(S),this.saveEventData(),this.processRequests(f)},Ei(Me(w,{method:"GET"}),D))}getSessionAPI(s,i,a,f){this.skuToken=i,this.errorCb=f,ft.SESSION_PATH&&ft.API_URL&&(a||ft.ACCESS_TOKEN?this.queueRequest({id:s,timestamp:Date.now()},a):this.errorCb(new Error(ds)))}processRequests(s){if(this.pendingRequest||0===this.queue.length)return;const{id:i,timestamp:a}=this.queue.shift();i&&this.success[i]||this.getSession(a,this.skuToken,f=>{f?this.errorCb(f):i&&(this.success[i]=!0)},s)}},yt=bt.getSessionAPI.bind(bt),at=new Set,st={create:"create",load:"load",fullLoad:"fullLoad"},Xt={mark(s){ve.performance.mark(s)},measure(s,i,a){ve.performance.measure(s,i,a)}};function yn(s){const i=s.name.split("?")[0];return i.includes("mapbox-gl.js")?"javascript":i.includes("mapbox-gl.css")?"css":ft.API_FONTS_REGEX.test(i)?"fontRange":gn(i)?"sprite":ts(i)?"style":ft.API_TILEJSON_REGEX.test(i)?"tilejson":"other"}const tn=ve.performance;function zn(s){const i=s?s.url.toString():void 0;return tn.getEntriesByName(i)}let $n,Fn,or,nr;const ci={now:()=>void 0!==or?or:ve.performance.now(),setNow(s){or=s},restoreNow(){or=void 0},frame(s){const i=ve.requestAnimationFrame(s);return{cancel:()=>ve.cancelAnimationFrame(i)}},getImageData(s,i=0){const{width:a,height:f}=s;nr||(nr=ve.document.createElement("canvas"));const m=nr.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return(a>nr.width||f>nr.height)&&(nr.width=a,nr.height=f),m.clearRect(-i,-i,a+2*i,f+2*i),m.drawImage(s,0,0,a,f),m.getImageData(-i,-i,a+2*i,f+2*i)},resolveURL:s=>($n||($n=ve.document.createElement("a")),$n.href=s,$n.href),get devicePixelRatio(){return ve.devicePixelRatio},get prefersReducedMotion(){return!!ve.matchMedia&&(null==Fn&&(Fn=ve.matchMedia("(prefers-reduced-motion: reduce)")),Fn.matches)}};function Nn(s,i,a){a[s]&&-1!==a[s].indexOf(i)||(a[s]=a[s]||[],a[s].push(i))}function dr(s,i,a){if(a&&a[s]){const f=a[s].indexOf(i);-1!==f&&a[s].splice(f,1)}}class _i{constructor(i,a={}){Me(this,a),this.type=i}}class ps extends _i{constructor(i,a={}){super("error",Me({error:i},a))}}class fa{on(i,a){return this._listeners=this._listeners||{},Nn(i,a,this._listeners),this}off(i,a){return dr(i,a,this._listeners),dr(i,a,this._oneTimeListeners),this}once(i,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Nn(i,a,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,a){"string"==typeof i&&(i=new _i(i,a||{}));const f=i.type;if(this.listens(f)){i.target=this;const m=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const D of m)D.call(this,i);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const D of w)dr(f,D,this._oneTimeListeners),D.call(this,i);const S=this._eventedParent;S&&(Me(i,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),S.fire(i))}else i instanceof ps&&console.error(i.error);return this}listens(i){return!!(this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i))}setEventedParent(i,a){return this._eventedParent=i,this._eventedParentData=a,this}}var Rt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Na(s,...i){for(const a of i)for(const f in a)s[f]=a[f];return s}function go(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function ra(s){if(Array.isArray(s))return s.map(ra);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const a in s)i[a]=ra(s[a]);return i}return go(s)}class Di extends Error{constructor(i,a){super(a),this.message=a,this.key=i}}var uu=Di;class Yu{constructor(i,a=[]){this.parent=i,this.bindings={};for(const[f,m]of a)this.bindings[f]=m}concat(i){return new Yu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}var Vl=Yu;const di={kind:"null"},un={kind:"number"},qn={kind:"string"},vr={kind:"boolean"},Cu={kind:"color"},pl={kind:"object"},Qt={kind:"value"},gl={kind:"collator"},Hs={kind:"formatted"},hc={kind:"resolvedImage"};function pr(s,i){return{kind:"array",itemType:s,N:i}}function xn(s){if("array"===s.kind){const i=xn(s.itemType);return"number"==typeof s.N?`array<${i}, ${s.N}>`:"value"===s.itemType.kind?"array":`array<${i}>`}return s.kind}const Uh=[di,un,qn,vr,Cu,Hs,pl,pr(Qt),hc];function gr(s,i){if("error"===i.kind)return null;if("array"===s.kind){if("array"===i.kind&&(0===i.N&&"value"===i.itemType.kind||!gr(s.itemType,i.itemType))&&("number"!=typeof s.N||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if("value"===s.kind)for(const a of Uh)if(!gr(a,i))return null}return`Expected ${xn(s)} but found ${xn(i)} instead.`}function Kr(s,i){return i.some(a=>a.kind===s.kind)}function gs(s,i){return i.some(a=>"null"===a?null===s:"array"===a?Array.isArray(s):"object"===a?s&&!Array.isArray(s)&&"object"==typeof s:a===typeof s)}var Vh,ch={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function mn(s){return(s=Math.round(s))<0?0:s>255?255:s}function Ps(s){return mn("%"===s[s.length-1]?parseFloat(s)/100*255:parseInt(s))}function ka(s){return(i="%"===s[s.length-1]?parseFloat(s)/100:parseFloat(s))<0?0:i>1?1:i;var i}function ba(s,i,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?s+(i-s)*a*6:2*a<1?i:3*a<2?s+(i-s)*(2/3-a)*6:s}try{Vh={}.parseCSSColor=function(s){var i,a=s.replace(/ /g,"").toLowerCase();if(a in ch)return ch[a].slice();if("#"===a[0])return 4===a.length?(i=parseInt(a.substr(1),16))>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null:7===a.length&&(i=parseInt(a.substr(1),16))>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null;var f=a.indexOf("("),m=a.indexOf(")");if(-1!==f&&m+1===a.length){var w=a.substr(0,f),S=a.substr(f+1,m-(f+1)).split(","),D=1;switch(w){case"rgba":if(4!==S.length)return null;D=ka(S.pop());case"rgb":return 3!==S.length?null:[Ps(S[0]),Ps(S[1]),Ps(S[2]),D];case"hsla":if(4!==S.length)return null;D=ka(S.pop());case"hsl":if(3!==S.length)return null;var P=(parseFloat(S[0])%360+360)%360/360,L=ka(S[1]),F=ka(S[2]),V=F<=.5?F*(L+1):F+L-F*L,j=2*F-V;return[mn(255*ba(j,V,P+1/3)),mn(255*ba(j,V,P)),mn(255*ba(j,V,P-1/3)),D];default:return null}}return null}}catch{}class ia{constructor(i,a,f,m=1){this.r=i,this.g=a,this.b=f,this.a=m}static parse(i){if(!i)return;if(i instanceof ia)return i;if("string"!=typeof i)return;const a=Vh(i);return a?new ia(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[i,a,f,m]=this.toArray();return`rgba(${Math.round(i)},${Math.round(a)},${Math.round(f)},${m})`}toArray(){const{r:i,g:a,b:f,a:m}=this;return 0===m?[0,0,0,0]:[255*i/m,255*a/m,255*f/m,m]}toArray01(){const{r:i,g:a,b:f,a:m}=this;return 0===m?[0,0,0,0]:[i/m,a/m,f/m,m]}toArray01PremultipliedAlpha(){const{r:i,g:a,b:f,a:m}=this;return[i,a,f,m]}}ia.black=new ia(0,0,0,1),ia.white=new ia(1,1,1,1),ia.transparent=new ia(0,0,0,0),ia.red=new ia(1,0,0,1),ia.blue=new ia(0,0,1,1);var Ur=ia;class oo{constructor(i,a,f){this.sensitivity=i?a?"variant":"case":a?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,a){return this.collator.compare(i,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gi{constructor(i,a,f,m,w){this.text=i.normalize?i.normalize():i,this.image=a,this.scale=f,this.fontStack=m,this.textColor=w}}class hi{constructor(i){this.sections=i}static fromString(i){return new hi([new gi(i,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(i=>0!==i.text.length||i.image&&0!==i.image.name.length)}static factory(i){return i instanceof hi?i:hi.fromString(i)}toString(){return 0===this.sections.length?"":this.sections.map(i=>i.text).join("")}serialize(){const i=["format"];for(const a of this.sections){if(a.image){i.push(["image",a.image.name]);continue}i.push(a.text);const f={};a.fontStack&&(f["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(f["font-scale"]=a.scale),a.textColor&&(f["text-color"]=["rgba"].concat(a.textColor.toArray())),i.push(f)}return i}}class lu{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new lu({name:i,available:!1}):null}serialize(){return["image",this.name]}}function ad(s,i,a,f){return"number"==typeof s&&s>=0&&s<=255&&"number"==typeof i&&i>=0&&i<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===f||"number"==typeof f&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,a,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof f?[s,i,a,f]:[s,i,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Rs(s){if(null===s||"string"==typeof s||"boolean"==typeof s||"number"==typeof s||s instanceof Ur||s instanceof oo||s instanceof hi||s instanceof lu)return!0;if(Array.isArray(s)){for(const i of s)if(!Rs(i))return!1;return!0}if("object"==typeof s){for(const i in s)if(!Rs(s[i]))return!1;return!0}return!1}function ms(s){if(null===s)return di;if("string"==typeof s)return qn;if("boolean"==typeof s)return vr;if("number"==typeof s)return un;if(s instanceof Ur)return Cu;if(s instanceof oo)return gl;if(s instanceof hi)return Hs;if(s instanceof lu)return hc;if(Array.isArray(s)){const i=s.length;let a;for(const f of s){const m=ms(f);if(a){if(a===m)continue;a=Qt;break}a=m}return pr(a||Qt,i)}return pl}function Fa(s){const i=typeof s;return null===s?"":"string"===i||"number"===i||"boolean"===i?String(s):s instanceof Ur||s instanceof hi||s instanceof lu?s.toString():JSON.stringify(s)}class Vr{constructor(i,a){this.type=i,this.value=a}static parse(i,a){if(2!==i.length)return a.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Rs(i[1]))return a.error("invalid value");const f=i[1];let m=ms(f);const w=a.expectedType;return"array"!==m.kind||0!==m.N||!w||"array"!==w.kind||"number"==typeof w.N&&0!==w.N||(m=w),new Vr(m,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Ur?["rgba"].concat(this.value.toArray()):this.value instanceof hi?this.value.serialize():this.value}}var li=Vr,Ci=class{constructor(s){this.name="ExpressionEvaluationError",this.message=s}toJSON(){return this.message}};const jh={string:qn,number:un,boolean:vr,object:pl};class fc{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");let f,m=1;const w=i[0];if("array"===w){let D,P;if(i.length>2){const L=i[1];if("string"!=typeof L||!(L in jh)||"object"===L)return a.error('The item type argument of "array" must be one of string, number, boolean',1);D=jh[L],m++}else D=Qt;if(i.length>3){if(null!==i[2]&&("number"!=typeof i[2]||i[2]<0||i[2]!==Math.floor(i[2])))return a.error('The length argument to "array" must be a positive integer literal',2);P=i[2],m++}f=pr(D,P)}else f=jh[w];const S=[];for(;m<i.length;m++){const D=a.parse(i[m],m,Qt);if(!D)return null;S.push(D)}return new fc(f,S)}evaluate(i){for(let a=0;a<this.args.length;a++){const f=this.args[a].evaluate(i);if(!gr(this.type,ms(f)))return f;if(a===this.args.length-1)throw new Ci(`Expected value to be of type ${xn(this.type)}, but found ${xn(ms(f))} instead.`)}return null}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=this.type,a=[i.kind];if("array"===i.kind){const f=i.itemType;if("string"===f.kind||"number"===f.kind||"boolean"===f.kind){a.push(f.kind);const m=i.N;("number"==typeof m||this.args.length>1)&&a.push(m)}}return a.concat(this.args.map(f=>f.serialize()))}}var kn=fc;class ws{constructor(i){this.type=Hs,this.sections=i}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&"object"==typeof f)return a.error("First argument must be an image or text section.");const m=[];let w=!1;for(let S=1;S<=i.length-1;++S){const D=i[S];if(w&&"object"==typeof D&&!Array.isArray(D)){w=!1;let P=null;if(D["font-scale"]&&(P=a.parse(D["font-scale"],1,un),!P))return null;let L=null;if(D["text-font"]&&(L=a.parse(D["text-font"],1,pr(qn)),!L))return null;let F=null;if(D["text-color"]&&(F=a.parse(D["text-color"],1,Cu),!F))return null;const V=m[m.length-1];V.scale=P,V.font=L,V.textColor=F}else{const P=a.parse(i[S],1,Qt);if(!P)return null;const L=P.type.kind;if("string"!==L&&"value"!==L&&"null"!==L&&"resolvedImage"!==L)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,m.push({content:P,scale:null,font:null,textColor:null})}}return new ws(m)}evaluate(i){return new hi(this.sections.map(a=>{const f=a.content.evaluate(i);return ms(f)===hc?new gi("",f,null,null,null):new gi(Fa(f),null,a.scale?a.scale.evaluate(i):null,a.font?a.font.evaluate(i).join(","):null,a.textColor?a.textColor.evaluate(i):null)}))}eachChild(i){for(const a of this.sections)i(a.content),a.scale&&i(a.scale),a.font&&i(a.font),a.textColor&&i(a.textColor)}outputDefined(){return!1}serialize(){const i=["format"];for(const a of this.sections){i.push(a.content.serialize());const f={};a.scale&&(f["font-scale"]=a.scale.serialize()),a.font&&(f["text-font"]=a.font.serialize()),a.textColor&&(f["text-color"]=a.textColor.serialize()),i.push(f)}return i}}class Ea{constructor(i){this.type=hc,this.input=i}static parse(i,a){if(2!==i.length)return a.error("Expected two arguments.");const f=a.parse(i[1],1,qn);return f?new Ea(f):a.error("No image name provided.")}evaluate(i){const a=this.input.evaluate(i),f=lu.fromString(a);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(a)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ca={"to-boolean":vr,"to-color":Cu,"to-number":un,"to-string":qn};class Su{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expected at least one argument.");const f=i[0];if(("to-boolean"===f||"to-string"===f)&&2!==i.length)return a.error("Expected one argument.");const m=Ca[f],w=[];for(let S=1;S<i.length;S++){const D=a.parse(i[S],S,Qt);if(!D)return null;w.push(D)}return new Su(m,w)}evaluate(i){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(i));if("color"===this.type.kind){let a,f;for(const m of this.args){if(a=m.evaluate(i),f=null,a instanceof Ur)return a;if("string"==typeof a){const w=i.parseColor(a);if(w)return w}else if(Array.isArray(a)&&(f=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:ad(a[0],a[1],a[2],a[3]),!f))return new Ur(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new Ci(f||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const f of this.args){if(a=f.evaluate(i),null===a)return 0;const m=Number(a);if(!isNaN(m))return m}throw new Ci(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?hi.fromString(Fa(this.args[0].evaluate(i))):"resolvedImage"===this.type.kind?lu.fromString(Fa(this.args[0].evaluate(i))):Fa(this.args[0].evaluate(i))}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){if("formatted"===this.type.kind)return new ws([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ea(this.args[0]).serialize();const i=[`to-${this.type.kind}`];return this.eachChild(a=>{i.push(a.serialize())}),i}}var za=Su;const dc=["Unknown","Point","LineString","Polygon"];var cs=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?dc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const s=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:f}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-s[0])+this.featureDistanceData.bearing[1]*(f*i-s[1])}return 0}parseColor(s){let i=this._parseColorCache[s];return i||(i=this._parseColorCache[s]=Ur.parse(s)),i}};class ml{constructor(i,a,f,m){this.name=i,this.type=a,this._evaluate=f,this.args=m}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(i=>i.serialize()))}static parse(i,a){const f=i[0],m=ml.definitions[f];if(!m)return a.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(m)?m[0]:m.type,S=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,D=S.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let P=null;for(const[L,F]of D){P=new rr(a.registry,a.path,null,a.scope);const V=[];let j=!1;for(let H=1;H<i.length;H++){const X=i[H],te=Array.isArray(L)?L[H-1]:L.type,_e=P.parse(X,1+V.length,te);if(!_e){j=!0;break}V.push(_e)}if(!j)if(Array.isArray(L)&&L.length!==V.length)P.error(`Expected ${L.length} arguments, but found ${V.length} instead.`);else{for(let H=0;H<V.length;H++){const X=Array.isArray(L)?L[H]:L.type,te=V[H];P.concat(H+1).checkSubtype(X,te.type)}if(0===P.errors.length)return new ml(f,w,F,V)}}if(1===D.length)a.errors.push(...P.errors);else{const L=(D.length?D:S).map(([V])=>{return j=V,Array.isArray(j)?`(${j.map(xn).join(", ")})`:`(${xn(j.type)}...)`;var j}).join(" | "),F=[];for(let V=1;V<i.length;V++){const j=a.parse(i[V],1+F.length);if(!j)return null;F.push(xn(j.type))}a.error(`Expected arguments of type ${L}, but found (${F.join(", ")}) instead.`)}return null}static register(i,a){ml.definitions=a;for(const f in a)i[f]=ml}}var $o=ml;class bo{constructor(i,a,f){this.type=gl,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=a}static parse(i,a){if(2!==i.length)return a.error("Expected one argument.");const f=i[1];if("object"!=typeof f||Array.isArray(f))return a.error("Collator options argument must be an object.");const m=a.parse(void 0!==f["case-sensitive"]&&f["case-sensitive"],1,vr);if(!m)return null;const w=a.parse(void 0!==f["diacritic-sensitive"]&&f["diacritic-sensitive"],1,vr);if(!w)return null;let S=null;return f.locale&&(S=a.parse(f.locale,1,qn),!S)?null:new bo(m,w,S)}evaluate(i){return new oo(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}serialize(){const i={};return i["case-sensitive"]=this.caseSensitive.serialize(),i["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(i.locale=this.locale.serialize()),["collator",i]}}const Eo=8192;function Bc(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function wr(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function da(s,i){const a=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,m=Math.pow(2,i.z);return[Math.round(a*m*Eo),Math.round(f*m*Eo)]}function Sf(s,i,a){const f=s[0]-i[0],m=s[1]-i[1],w=s[0]-a[0],S=s[1]-a[1];return f*S-w*m==0&&f*w<=0&&m*S<=0}function Sa(s,i){let a=!1;for(let S=0,D=i.length;S<D;S++){const P=i[S];for(let L=0,F=P.length;L<F-1;L++){if(Sf(s,P[L],P[L+1]))return!1;(m=P[L])[1]>(f=s)[1]!=(w=P[L+1])[1]>f[1]&&f[0]<(w[0]-m[0])*(f[1]-m[1])/(w[1]-m[1])+m[0]&&(a=!a)}}var f,m,w;return a}function Xs(s,i){for(let a=0;a<i.length;a++)if(Sa(s,i[a]))return!0;return!1}function Ku(s,i,a,f){const m=f[0]-a[0],w=f[1]-a[1],S=(s[0]-a[0])*w-m*(s[1]-a[1]),D=(i[0]-a[0])*w-m*(i[1]-a[1]);return S>0&&D<0||S<0&&D>0}function Jr(s,i,a){for(const L of a)for(let F=0;F<L.length-1;++F)if((D=[(S=L[F+1])[0]-(w=L[F])[0],S[1]-w[1]])[0]*(P=[(m=i)[0]-(f=s)[0],m[1]-f[1]])[1]-D[1]*P[0]!=0&&Ku(f,m,w,S)&&Ku(w,S,f,m))return!0;var f,m,w,S,D,P;return!1}function jl(s,i){for(let a=0;a<s.length;++a)if(!Sa(s[a],i))return!1;for(let a=0;a<s.length-1;++a)if(Jr(s[a],s[a+1],i))return!1;return!0}function Iu(s,i){for(let a=0;a<i.length;a++)if(jl(s,i[a]))return!0;return!1}function Ju(s,i,a){const f=[];for(let m=0;m<s.length;m++){const w=[];for(let S=0;S<s[m].length;S++){const D=da(s[m][S],a);Bc(i,D),w.push(D)}f.push(w)}return f}function mo(s,i,a){const f=[];for(let m=0;m<s.length;m++){const w=Ju(s[m],i,a);f.push(w)}return f}function Wn(s,i,a,f){if(s[0]<a[0]||s[0]>a[2]){const m=.5*f;let w=s[0]-a[0]>m?-f:a[0]-s[0]>m?f:0;0===w&&(w=s[0]-a[2]>m?-f:a[2]-s[0]>m?f:0),s[0]+=w}Bc(i,s)}function Gl(s,i,a,f){const m=Math.pow(2,f.z)*Eo,w=[f.x*Eo,f.y*Eo],S=[];if(!s)return S;for(const D of s)for(const P of D){const L=[P.x+w[0],P.y+w[1]];Wn(L,i,a,m),S.push(L)}return S}function pc(s,i,a,f){const m=Math.pow(2,f.z)*Eo,w=[f.x*Eo,f.y*Eo],S=[];if(!s)return S;for(const P of s){const L=[];for(const F of P){const V=[F.x+w[0],F.y+w[1]];Bc(i,V),L.push(V)}S.push(L)}if(i[2]-i[0]<=m/2){(D=i)[0]=D[1]=1/0,D[2]=D[3]=-1/0;for(const P of S)for(const L of P)Wn(L,i,a,m)}var D;return S}class ns{constructor(i,a){this.type=vr,this.geojson=i,this.geometries=a}static parse(i,a){if(2!==i.length)return a.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Rs(i[1])){const f=i[1];if("FeatureCollection"===f.type)for(let m=0;m<f.features.length;++m){const w=f.features[m].geometry.type;if("Polygon"===w||"MultiPolygon"===w)return new ns(f,f.features[m].geometry)}else if("Feature"===f.type){const m=f.geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new ns(f,f.geometry)}else if("Polygon"===f.type||"MultiPolygon"===f.type)return new ns(f,f)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(null!=i.geometry()&&null!=i.canonicalID()){if("Point"===i.geometryType())return function(a,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=a.canonicalID();if(!S)return!1;if("Polygon"===f.type){const D=Ju(f.coordinates,w,S),P=Gl(a.geometry(),m,w,S);if(!wr(m,w))return!1;for(const L of P)if(!Sa(L,D))return!1}if("MultiPolygon"===f.type){const D=mo(f.coordinates,w,S),P=Gl(a.geometry(),m,w,S);if(!wr(m,w))return!1;for(const L of P)if(!Xs(L,D))return!1}return!0}(i,this.geometries);if("LineString"===i.geometryType())return function(a,f){const m=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],S=a.canonicalID();if(!S)return!1;if("Polygon"===f.type){const D=Ju(f.coordinates,w,S),P=pc(a.geometry(),m,w,S);if(!wr(m,w))return!1;for(const L of P)if(!jl(L,D))return!1}if("MultiPolygon"===f.type){const D=mo(f.coordinates,w,S),P=pc(a.geometry(),m,w,S);if(!wr(m,w))return!1;for(const L of P)if(!Iu(L,D))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var jr=ns;function cu(s){if(s instanceof $o&&("get"===s.name&&1===s.args.length||"feature-state"===s.name||"has"===s.name&&1===s.args.length||"properties"===s.name||"geometry-type"===s.name||"id"===s.name||/^filter-/.test(s.name))||s instanceof jr)return!1;let i=!0;return s.eachChild(a=>{i&&!cu(a)&&(i=!1)}),i}function Tu(s){if(s instanceof $o&&"feature-state"===s.name)return!1;let i=!0;return s.eachChild(a=>{i&&!Tu(a)&&(i=!1)}),i}function Nu(s,i){if(s instanceof $o&&i.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(f=>{a&&!Nu(f,i)&&(a=!1)}),a}class hh{constructor(i,a){this.type=a.type,this.name=i,this.boundExpression=a}static parse(i,a){if(2!==i.length||"string"!=typeof i[1])return a.error("'var' expression requires exactly one string literal argument.");const f=i[1];return a.scope.has(f)?new hh(f,a.scope.get(f)):a.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Pn=hh;class Ha{constructor(i,a=[],f,m=new Vl,w=[]){this.registry=i,this.path=a,this.key=a.map(S=>`[${S}]`).join(""),this.scope=m,this.errors=w,this.expectedType=f}parse(i,a,f,m,w={}){return a?this.concat(a,f,m)._parse(i,w):this._parse(i,w)}_parse(i,a){function f(m,w,S){return"assert"===S?new kn(w,[m]):"coerce"===S?new za(w,[m]):m}if(null!==i&&"string"!=typeof i&&"boolean"!=typeof i&&"number"!=typeof i||(i=["literal",i]),Array.isArray(i)){if(0===i.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const m=i[0];if("string"!=typeof m)return this.error(`Expression name must be a string, but found ${typeof m} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[m];if(w){let S=w.parse(i,this);if(!S)return null;if(this.expectedType){const D=this.expectedType,P=S.type;if("string"!==D.kind&&"number"!==D.kind&&"boolean"!==D.kind&&"object"!==D.kind&&"array"!==D.kind||"value"!==P.kind)if("color"!==D.kind&&"formatted"!==D.kind&&"resolvedImage"!==D.kind||"value"!==P.kind&&"string"!==P.kind){if(this.checkSubtype(D,P))return null}else S=f(S,D,a.typeAnnotation||"coerce");else S=f(S,D,a.typeAnnotation||"assert")}if(!(S instanceof li)&&"resolvedImage"!==S.type.kind&&ku(S)){const D=new cs;try{S=new li(S.type,S.evaluate(D))}catch(P){return this.error(P.message),null}}return S}return this.error(`Unknown expression "${m}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===i?"'undefined' value invalid. Use null instead.":"object"==typeof i?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,a,f){const m="number"==typeof i?this.path.concat(i):this.path,w=f?this.scope.concat(f):this.scope;return new Ha(this.registry,m,a||null,w,this.errors)}error(i,...a){const f=`${this.key}${a.map(m=>`[${m}]`).join("")}`;this.errors.push(new uu(f,i))}checkSubtype(i,a){const f=gr(i,a);return f&&this.error(f),f}}var rr=Ha;function ku(s){if(s instanceof Pn)return ku(s.boundExpression);if(s instanceof $o&&"error"===s.name||s instanceof bo||s instanceof jr)return!1;const i=s instanceof za||s instanceof kn;let a=!0;return s.eachChild(f=>{a=i?a&&ku(f):a&&f instanceof li}),!!a&&cu(s)&&Nu(s,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Is(s,i){const a=s.length-1;let f,m,w=0,S=a,D=0;for(;w<=S;)if(D=Math.floor((w+S)/2),f=s[D],m=s[D+1],f<=i){if(D===a||i<m)return D;w=D+1}else{if(!(f>i))throw new Ci("Input is not a number.");S=D-1}return 0}class hu{constructor(i,a,f){this.type=i,this.input=a,this.labels=[],this.outputs=[];for(const[m,w]of f)this.labels.push(m),this.outputs.push(w)}static parse(i,a){if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");const f=a.parse(i[1],1,un);if(!f)return null;const m=[];let w=null;a.expectedType&&"value"!==a.expectedType.kind&&(w=a.expectedType);for(let S=1;S<i.length;S+=2){const D=1===S?-1/0:i[S],P=i[S+1],L=S,F=S+1;if("number"!=typeof D)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=D)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const V=a.parse(P,F,w);if(!V)return null;w=w||V.type,m.push([D,V])}return new hu(w,f,m)}evaluate(i){const a=this.labels,f=this.outputs;if(1===a.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return f[0].evaluate(i);const w=a.length;return m>=a[w-1]?f[w-1].evaluate(i):f[Is(a,m)].evaluate(i)}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){const i=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&i.push(this.labels[a]),i.push(this.outputs[a].serialize());return i}}var Gr=hu;function ni(s,i,a){return s*(1-a)+i*a}var Si=Object.freeze({__proto__:null,number:ni,color:function(s,i,a){return new Ur(ni(s.r,i.r,a),ni(s.g,i.g,a),ni(s.b,i.b,a),ni(s.a,i.a,a))},array:function(s,i,a){return s.map((f,m)=>ni(f,i[m],a))}});const gc=4/29,Gh=6/29,oa=3*Gh*Gh,$r=Math.PI/180,Hr=180/Math.PI;function Fu(s){return s>.008856451679035631?Math.pow(s,1/3):s/oa+gc}function Ia(s){return s>Gh?s*s*s:oa*(s-gc)}function Zs(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function ys(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function zu(s){const i=ys(s.r),a=ys(s.g),f=ys(s.b),m=Fu((.4124564*i+.3575761*a+.1804375*f)/.95047),w=Fu((.2126729*i+.7151522*a+.072175*f)/1);return{l:116*w-16,a:500*(m-w),b:200*(w-Fu((.0193339*i+.119192*a+.9503041*f)/1.08883)),alpha:s.a}}function mc(s){let i=(s.l+16)/116,a=isNaN(s.a)?i:i+s.a/500,f=isNaN(s.b)?i:i-s.b/200;return i=1*Ia(i),a=.95047*Ia(a),f=1.08883*Ia(f),new Ur(Zs(3.2404542*a-1.5371385*i-.4985314*f),Zs(-.969266*a+1.8760108*i+.041556*f),Zs(.0556434*a-.2040259*i+1.0572252*f),s.alpha)}function yl(s,i,a){const f=i-s;return s+a*(f>180||f<-180?f-360*Math.round(f/360):f)}const _s={forward:zu,reverse:mc,interpolate:function(s,i,a){return{l:ni(s.l,i.l,a),a:ni(s.a,i.a,a),b:ni(s.b,i.b,a),alpha:ni(s.alpha,i.alpha,a)}}},Du={forward:function(s){const{l:i,a,b:f}=zu(s),m=Math.atan2(f,a)*Hr;return{h:m<0?m+360:m,c:Math.sqrt(a*a+f*f),l:i,alpha:s.a}},reverse:function(s){const i=s.h*$r,a=s.c;return mc({l:s.l,a:Math.cos(i)*a,b:Math.sin(i)*a,alpha:s.alpha})},interpolate:function(s,i,a){return{h:yl(s.h,i.h,a),c:ni(s.c,i.c,a),l:ni(s.l,i.l,a),alpha:ni(s.alpha,i.alpha,a)}}};var pa=Object.freeze({__proto__:null,lab:_s,hcl:Du});class Ta{constructor(i,a,f,m,w){this.type=i,this.operator=a,this.interpolation=f,this.input=m,this.labels=[],this.outputs=[];for(const[S,D]of w)this.labels.push(S),this.outputs.push(D)}static interpolationFactor(i,a,f,m){let w=0;if("exponential"===i.name)w=Ls(a,i.base,f,m);else if("linear"===i.name)w=Ls(a,1,f,m);else if("cubic-bezier"===i.name){const S=i.controlPoints;w=new Ie(S[0],S[1],S[2],S[3]).solve(Ls(a,1,f,m))}return w}static parse(i,a){let[f,m,w,...S]=i;if(!Array.isArray(m)||0===m.length)return a.error("Expected an interpolation type expression.",1);if("linear"===m[0])m={name:"linear"};else if("exponential"===m[0]){const L=m[1];if("number"!=typeof L)return a.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:L}}else{if("cubic-bezier"!==m[0])return a.error(`Unknown interpolation type ${String(m[0])}`,1,0);{const L=m.slice(1);if(4!==L.length||L.some(F=>"number"!=typeof F||F<0||F>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(w=a.parse(w,2,un),!w)return null;const D=[];let P=null;"interpolate-hcl"===f||"interpolate-lab"===f?P=Cu:a.expectedType&&"value"!==a.expectedType.kind&&(P=a.expectedType);for(let L=0;L<S.length;L+=2){const F=S[L],V=S[L+1],j=L+3,H=L+4;if("number"!=typeof F)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',j);if(D.length&&D[D.length-1][0]>=F)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',j);const X=a.parse(V,H,P);if(!X)return null;P=P||X.type,D.push([F,X])}return"number"===P.kind||"color"===P.kind||"array"===P.kind&&"number"===P.itemType.kind&&"number"==typeof P.N?new Ta(P,f,m,w,D):a.error(`Type ${xn(P)} is not interpolatable.`)}evaluate(i){const a=this.labels,f=this.outputs;if(1===a.length)return f[0].evaluate(i);const m=this.input.evaluate(i);if(m<=a[0])return f[0].evaluate(i);const w=a.length;if(m>=a[w-1])return f[w-1].evaluate(i);const S=Is(a,m),D=Ta.interpolationFactor(this.interpolation,m,a[S],a[S+1]),P=f[S].evaluate(i),L=f[S+1].evaluate(i);return"interpolate"===this.operator?Si[this.type.kind.toLowerCase()](P,L,D):"interpolate-hcl"===this.operator?Du.reverse(Du.interpolate(Du.forward(P),Du.forward(L),D)):_s.reverse(_s.interpolate(_s.forward(P),_s.forward(L),D))}eachChild(i){i(this.input);for(const a of this.outputs)i(a)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}serialize(){let i;i="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,i,this.input.serialize()];for(let f=0;f<this.labels.length;f++)a.push(this.labels[f],this.outputs[f].serialize());return a}}function Ls(s,i,a,f){const m=f-a,w=s-a;return 0===m?0:1===i?w/m:(Math.pow(i,w)-1)/(Math.pow(i,m)-1)}var ga=Ta;class fu{constructor(i,a){this.type=i,this.args=a}static parse(i,a){if(i.length<2)return a.error("Expectected at least one argument.");let f=null;const m=a.expectedType;m&&"value"!==m.kind&&(f=m);const w=[];for(const D of i.slice(1)){const P=a.parse(D,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!P)return null;f=f||P.type,w.push(P)}const S=m&&w.some(D=>gr(m,D.type));return new fu(S?Qt:f,w)}evaluate(i){let a,f=null,m=0;for(const w of this.args){if(m++,f=w.evaluate(i),f&&f instanceof lu&&!f.available&&(a||(a=f),f=null,m===this.args.length))return a;if(null!==f)break}return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}serialize(){const i=["coalesce"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var vi=fu;class ma{constructor(i,a){this.type=a.type,this.bindings=[].concat(i),this.result=a}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const a of this.bindings)i(a[1]);i(this.result)}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let w=1;w<i.length-1;w+=2){const S=i[w];if("string"!=typeof S)return a.error(`Expected string, but found ${typeof S} instead.`,w);if(/[^a-zA-Z0-9_]/.test(S))return a.error("Variable names must contain only alphanumeric characters or '_'.",w);const D=a.parse(i[w+1],w+1);if(!D)return null;f.push([S,D])}const m=a.parse(i[i.length-1],i.length-1,a.expectedType,f);return m?new ma(f,m):null}outputDefined(){return this.result.outputDefined()}serialize(){const i=["let"];for(const[a,f]of this.bindings)i.push(a,f.serialize());return i.push(this.result.serialize()),i}}var xi=ma;class mi{constructor(i,a,f){this.type=i,this.index=a,this.input=f}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,un),m=a.parse(i[2],2,pr(a.expectedType||Qt));return f&&m?new mi(m.type.itemType,f,m):null}evaluate(i){const a=this.index.evaluate(i),f=this.input.evaluate(i);if(a<0)throw new Ci(`Array index out of bounds: ${a} < 0.`);if(a>=f.length)throw new Ci(`Array index out of bounds: ${a} > ${f.length-1}.`);if(a!==Math.floor(a))throw new Ci(`Array index must be an integer, but found ${a} instead.`);return f[a]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var hs=mi;class Ws{constructor(i,a){this.type=vr,this.needle=i,this.haystack=a}static parse(i,a){if(3!==i.length)return a.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,Qt),m=a.parse(i[2],2,Qt);return f&&m?Kr(f.type,[vr,qn,un,di,Qt])?new Ws(f,m):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(f.type)} instead`):null}evaluate(i){const a=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(null==f)return!1;if(!gs(a,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${xn(ms(a))} instead.`);if(!gs(f,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${xn(ms(f))} instead.`);return f.indexOf(a)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Za=Ws;class Co{constructor(i,a,f){this.type=un,this.needle=i,this.haystack=a,this.fromIndex=f}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,Qt),m=a.parse(i[2],2,Qt);if(!f||!m)return null;if(!Kr(f.type,[vr,qn,un,di,Qt]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${xn(f.type)} instead`);if(4===i.length){const w=a.parse(i[3],3,un);return w?new Co(f,m,w):null}return new Co(f,m)}evaluate(i){const a=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!gs(a,["boolean","string","number","null"]))throw new Ci(`Expected first argument to be of type boolean, string, number or null, but found ${xn(ms(a))} instead.`);if(!gs(f,["string","array"]))throw new Ci(`Expected second argument to be of type array or string, but found ${xn(ms(f))} instead.`);if(this.fromIndex){const m=this.fromIndex.evaluate(i);return f.indexOf(a,m)}return f.indexOf(a)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const i=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),i]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Hn=Co;class Nr{constructor(i,a,f,m,w,S){this.inputType=i,this.type=a,this.input=f,this.cases=m,this.outputs=w,this.otherwise=S}static parse(i,a){if(i.length<5)return a.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return a.error("Expected an even number of arguments.");let f,m;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);const w={},S=[];for(let L=2;L<i.length-1;L+=2){let F=i[L];const V=i[L+1];Array.isArray(F)||(F=[F]);const j=a.concat(L);if(0===F.length)return j.error("Expected at least one branch label.");for(const X of F){if("number"!=typeof X&&"string"!=typeof X)return j.error("Branch labels must be numbers or strings.");if("number"==typeof X&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return j.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof X&&Math.floor(X)!==X)return j.error("Numeric branch labels must be integer values.");if(f){if(j.checkSubtype(f,ms(X)))return null}else f=ms(X);if(void 0!==w[String(X)])return j.error("Branch labels must be unique.");w[String(X)]=S.length}const H=a.parse(V,L,m);if(!H)return null;m=m||H.type,S.push(H)}const D=a.parse(i[1],1,Qt);if(!D)return null;const P=a.parse(i[i.length-1],i.length-1,m);return P?"value"!==D.type.kind&&a.concat(1).checkSubtype(f,D.type)?null:new Nr(f,m,D,w,S,P):null}evaluate(i){const a=this.input.evaluate(i);return(ms(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),f=[],m={};for(const S of a){const D=m[this.cases[S]];void 0===D?(m[this.cases[S]]=f.length,f.push([this.cases[S],[S]])):f[D][1].push(S)}const w=S=>"number"===this.inputType.kind?Number(S):S;for(const[S,D]of f)i.push(1===D.length?w(D[0]):D.map(w)),i.push(this.outputs[S].serialize());return i.push(this.otherwise.serialize()),i}}var ko=Nr;class Wa{constructor(i,a,f){this.type=i,this.branches=a,this.otherwise=f}static parse(i,a){if(i.length<4)return a.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return a.error("Expected an odd number of arguments.");let f;a.expectedType&&"value"!==a.expectedType.kind&&(f=a.expectedType);const m=[];for(let S=1;S<i.length-1;S+=2){const D=a.parse(i[S],S,vr);if(!D)return null;const P=a.parse(i[S+1],S+1,f);if(!P)return null;m.push([D,P]),f=f||P.type}const w=a.parse(i[i.length-1],i.length-1,f);return w?new Wa(f,m,w):null}evaluate(i){for(const[a,f]of this.branches)if(a.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[a,f]of this.branches)i(a),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const i=["case"];return this.eachChild(a=>{i.push(a.serialize())}),i}}var $l=Wa;class rs{constructor(i,a,f,m){this.type=i,this.input=a,this.beginIndex=f,this.endIndex=m}static parse(i,a){if(i.length<=2||i.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=a.parse(i[1],1,Qt),m=a.parse(i[2],2,un);if(!f||!m)return null;if(!Kr(f.type,[pr(Qt),qn,Qt]))return a.error(`Expected first argument to be of type array or string, but found ${xn(f.type)} instead`);if(4===i.length){const w=a.parse(i[3],3,un);return w?new rs(f.type,f,m,w):null}return new rs(f.type,f,m)}evaluate(i){const a=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!gs(a,["string","array"]))throw new Ci(`Expected first argument to be of type array or string, but found ${xn(ms(a))} instead.`);if(this.endIndex){const m=this.endIndex.evaluate(i);return a.slice(f,m)}return a.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const i=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),i]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Ys=rs;function ri(s,i){return"=="===s||"!="===s?"boolean"===i.kind||"string"===i.kind||"number"===i.kind||"null"===i.kind||"value"===i.kind:"string"===i.kind||"number"===i.kind||"value"===i.kind}function Bu(s,i,a,f){return 0===f.compare(i,a)}function qo(s,i,a){const f="=="!==s&&"!="!==s;return class PP{constructor(w,S,D){this.type=vr,this.lhs=w,this.rhs=S,this.collator=D,this.hasUntypedArgument="value"===w.type.kind||"value"===S.type.kind}static parse(w,S){if(3!==w.length&&4!==w.length)return S.error("Expected two or three arguments.");const D=w[0];let P=S.parse(w[1],1,Qt);if(!P)return null;if(!ri(D,P.type))return S.concat(1).error(`"${D}" comparisons are not supported for type '${xn(P.type)}'.`);let L=S.parse(w[2],2,Qt);if(!L)return null;if(!ri(D,L.type))return S.concat(2).error(`"${D}" comparisons are not supported for type '${xn(L.type)}'.`);if(P.type.kind!==L.type.kind&&"value"!==P.type.kind&&"value"!==L.type.kind)return S.error(`Cannot compare types '${xn(P.type)}' and '${xn(L.type)}'.`);f&&("value"===P.type.kind&&"value"!==L.type.kind?P=new kn(L.type,[P]):"value"!==P.type.kind&&"value"===L.type.kind&&(L=new kn(P.type,[L])));let F=null;if(4===w.length){if("string"!==P.type.kind&&"string"!==L.type.kind&&"value"!==P.type.kind&&"value"!==L.type.kind)return S.error("Cannot use collator to compare non-string types.");if(F=S.parse(w[3],3,gl),!F)return null}return new PP(P,L,F)}evaluate(w){const S=this.lhs.evaluate(w),D=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const P=ms(S),L=ms(D);if(P.kind!==L.kind||"string"!==P.kind&&"number"!==P.kind)throw new Ci(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${P.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const P=ms(S),L=ms(D);if("string"!==P.kind||"string"!==L.kind)return i(w,S,D)}return this.collator?a(w,S,D,this.collator.evaluate(w)):i(w,S,D)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}serialize(){const w=[s];return this.eachChild(S=>{w.push(S.serialize())}),w}}}const Rr=qo("==",function(s,i,a){return i===a},Bu),Qu=qo("!=",function(s,i,a){return i!==a},function(s,i,a,f){return!Bu(0,i,a,f)}),ql=qo("<",function(s,i,a){return i<a},function(s,i,a,f){return f.compare(i,a)<0}),_l=qo(">",function(s,i,a){return i>a},function(s,i,a,f){return f.compare(i,a)>0}),Ba=qo("<=",function(s,i,a){return i<=a},function(s,i,a,f){return f.compare(i,a)<=0}),Fo=qo(">=",function(s,i,a){return i>=a},function(s,i,a,f){return f.compare(i,a)>=0});class Ho{constructor(i,a,f,m,w,S){this.type=qn,this.number=i,this.locale=a,this.currency=f,this.unit=m,this.minFractionDigits=w,this.maxFractionDigits=S}static parse(i,a){if(3!==i.length)return a.error("Expected two arguments.");const f=a.parse(i[1],1,un);if(!f)return null;const m=i[2];if("object"!=typeof m||Array.isArray(m))return a.error("NumberFormat options argument must be an object.");let w=null;if(m.locale&&(w=a.parse(m.locale,1,qn),!w))return null;let S=null;if(m.currency&&(S=a.parse(m.currency,1,qn),!S))return null;let D=null;if(m.unit&&(D=a.parse(m.unit,1,qn),!D))return null;let P=null;if(m["min-fraction-digits"]&&(P=a.parse(m["min-fraction-digits"],1,un),!P))return null;let L=null;return m["max-fraction-digits"]&&(L=a.parse(m["max-fraction-digits"],1,un),!L)?null:new Ho(f,w,S,D,P,L)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(i):void 0,unit:this.unit?this.unit.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.unit&&i(this.unit),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const i={};return this.locale&&(i.locale=this.locale.serialize()),this.currency&&(i.currency=this.currency.serialize()),this.unit&&(i.unit=this.unit.serialize()),this.minFractionDigits&&(i["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(i["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),i]}}class Os{constructor(i){this.type=un,this.input=i}static parse(i,a){if(2!==i.length)return a.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=a.parse(i[1],1);return f?"array"!==f.type.kind&&"string"!==f.type.kind&&"value"!==f.type.kind?a.error(`Expected argument of type string or array, but found ${xn(f.type)} instead.`):new Os(f):null}evaluate(i){const a=this.input.evaluate(i);if("string"==typeof a||Array.isArray(a))return a.length;throw new Ci(`Expected value to be of type string or array, but found ${xn(ms(a))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}serialize(){const i=["length"];return this.eachChild(a=>{i.push(a.serialize())}),i}}const Ao={"==":Rr,"!=":Qu,">":_l,"<":ql,">=":Fo,"<=":Ba,array:kn,at:hs,boolean:kn,case:$l,coalesce:vi,collator:bo,format:ws,image:Ea,in:Za,"index-of":Hn,interpolate:ga,"interpolate-hcl":ga,"interpolate-lab":ga,length:Os,let:xi,literal:li,match:ko,number:kn,"number-format":Ho,object:kn,slice:Ys,step:Gr,string:kn,"to-boolean":za,"to-color":za,"to-number":za,"to-string":za,var:Pn,within:jr};function yc(s,[i,a,f,m]){i=i.evaluate(s),a=a.evaluate(s),f=f.evaluate(s);const w=m?m.evaluate(s):1,S=ad(i,a,f,w);if(S)throw new Ci(S);return new Ur(i/255*w,a/255*w,f/255*w,w)}function Uu(s,i){return s in i}function Mi(s,i){const a=i[s];return void 0===a?null:a}function is(s){return{type:s}}$o.register(Ao,{error:[{kind:"error"},[qn],(s,[i])=>{throw new Ci(i.evaluate(s))}],typeof:[qn,[Qt],(s,[i])=>xn(ms(i.evaluate(s)))],"to-rgba":[pr(un,4),[Cu],(s,[i])=>i.evaluate(s).toArray()],rgb:[Cu,[un,un,un],yc],rgba:[Cu,[un,un,un,un],yc],has:{type:vr,overloads:[[[qn],(s,[i])=>Uu(i.evaluate(s),s.properties())],[[qn,pl],(s,[i,a])=>Uu(i.evaluate(s),a.evaluate(s))]]},get:{type:Qt,overloads:[[[qn],(s,[i])=>Mi(i.evaluate(s),s.properties())],[[qn,pl],(s,[i,a])=>Mi(i.evaluate(s),a.evaluate(s))]]},"feature-state":[Qt,[qn],(s,[i])=>Mi(i.evaluate(s),s.featureState||{})],properties:[pl,[],s=>s.properties()],"geometry-type":[qn,[],s=>s.geometryType()],id:[Qt,[],s=>s.id()],zoom:[un,[],s=>s.globals.zoom],pitch:[un,[],s=>s.globals.pitch||0],"distance-from-center":[un,[],s=>s.distanceFromCenter()],"heatmap-density":[un,[],s=>s.globals.heatmapDensity||0],"line-progress":[un,[],s=>s.globals.lineProgress||0],"sky-radial-progress":[un,[],s=>s.globals.skyRadialProgress||0],accumulated:[Qt,[],s=>void 0===s.globals.accumulated?null:s.globals.accumulated],"+":[un,is(un),(s,i)=>{let a=0;for(const f of i)a+=f.evaluate(s);return a}],"*":[un,is(un),(s,i)=>{let a=1;for(const f of i)a*=f.evaluate(s);return a}],"-":{type:un,overloads:[[[un,un],(s,[i,a])=>i.evaluate(s)-a.evaluate(s)],[[un],(s,[i])=>-i.evaluate(s)]]},"/":[un,[un,un],(s,[i,a])=>i.evaluate(s)/a.evaluate(s)],"%":[un,[un,un],(s,[i,a])=>i.evaluate(s)%a.evaluate(s)],ln2:[un,[],()=>Math.LN2],pi:[un,[],()=>Math.PI],e:[un,[],()=>Math.E],"^":[un,[un,un],(s,[i,a])=>Math.pow(i.evaluate(s),a.evaluate(s))],sqrt:[un,[un],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[un,[un],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[un,[un],(s,[i])=>Math.log(i.evaluate(s))],log2:[un,[un],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[un,[un],(s,[i])=>Math.sin(i.evaluate(s))],cos:[un,[un],(s,[i])=>Math.cos(i.evaluate(s))],tan:[un,[un],(s,[i])=>Math.tan(i.evaluate(s))],asin:[un,[un],(s,[i])=>Math.asin(i.evaluate(s))],acos:[un,[un],(s,[i])=>Math.acos(i.evaluate(s))],atan:[un,[un],(s,[i])=>Math.atan(i.evaluate(s))],min:[un,is(un),(s,i)=>Math.min(...i.map(a=>a.evaluate(s)))],max:[un,is(un),(s,i)=>Math.max(...i.map(a=>a.evaluate(s)))],abs:[un,[un],(s,[i])=>Math.abs(i.evaluate(s))],round:[un,[un],(s,[i])=>{const a=i.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[un,[un],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[un,[un],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[vr,[qn,Qt],(s,[i,a])=>s.properties()[i.value]===a.value],"filter-id-==":[vr,[Qt],(s,[i])=>s.id()===i.value],"filter-type-==":[vr,[qn],(s,[i])=>s.geometryType()===i.value],"filter-<":[vr,[qn,Qt],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f<m}],"filter-id-<":[vr,[Qt],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a<f}],"filter->":[vr,[qn,Qt],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f>m}],"filter-id->":[vr,[Qt],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a>f}],"filter-<=":[vr,[qn,Qt],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f<=m}],"filter-id-<=":[vr,[Qt],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a<=f}],"filter->=":[vr,[qn,Qt],(s,[i,a])=>{const f=s.properties()[i.value],m=a.value;return typeof f==typeof m&&f>=m}],"filter-id->=":[vr,[Qt],(s,[i])=>{const a=s.id(),f=i.value;return typeof a==typeof f&&a>=f}],"filter-has":[vr,[Qt],(s,[i])=>i.value in s.properties()],"filter-has-id":[vr,[],s=>null!==s.id()&&void 0!==s.id()],"filter-type-in":[vr,[pr(qn)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[vr,[pr(Qt)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[vr,[qn,pr(Qt)],(s,[i,a])=>a.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[vr,[qn,pr(Qt)],(s,[i,a])=>function(f,m,w,S){for(;w<=S;){const D=w+S>>1;if(m[D]===f)return!0;m[D]>f?S=D-1:w=D+1}return!1}(s.properties()[i.value],a.value,0,a.value.length-1)],all:{type:vr,overloads:[[[vr,vr],(s,[i,a])=>i.evaluate(s)&&a.evaluate(s)],[is(vr),(s,i)=>{for(const a of i)if(!a.evaluate(s))return!1;return!0}]]},any:{type:vr,overloads:[[[vr,vr],(s,[i,a])=>i.evaluate(s)||a.evaluate(s)],[is(vr),(s,i)=>{for(const a of i)if(a.evaluate(s))return!0;return!1}]]},"!":[vr,[vr],(s,[i])=>!i.evaluate(s)],"is-supported-script":[vr,[qn],(s,[i])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(i.evaluate(s))}],upcase:[qn,[qn],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[qn,[qn],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[qn,is(Qt),(s,i)=>i.map(a=>Fa(a.evaluate(s))).join("")],"resolved-locale":[qn,[gl],(s,[i])=>i.evaluate(s).resolvedLocale()]});var Xo=Ao;function Ua(s){return{result:"success",value:s}}function os(s){return{result:"error",value:s}}function Vu(s){return"data-driven"===s["property-type"]||"cross-faded-data-driven"===s["property-type"]}function du(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function so(s){return!!s.expression&&s.expression.interpolated}function Lr(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":null===s?"null":typeof s}function vs(s){return"object"==typeof s&&null!==s&&!Array.isArray(s)}function vo(s){return s}function Uc(s,i){const a="color"===i.type,f=s.stops&&"object"==typeof s.stops[0][0],m=f||!(f||void 0!==s.property),w=s.type||(so(i)?"exponential":"interval");if(a&&((s=Na({},s)).stops&&(s.stops=s.stops.map(L=>[L[0],Ur.parse(L[1])])),s.default=Ur.parse(s.default?s.default:i.default)),s.colorSpace&&"rgb"!==s.colorSpace&&!pa[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let S,D,P;if("exponential"===w)S=el;else if("interval"===w)S=ss;else if("categorical"===w){S=fs,D=Object.create(null);for(const L of s.stops)D[L[0]]=L[1];P=typeof s.stops[0][0]}else{if("identity"!==w)throw new Error(`Unknown function type "${w}"`);S=Hl}if(f){const L={},F=[];for(let H=0;H<s.stops.length;H++){const X=s.stops[H],te=X[0].zoom;void 0===L[te]&&(L[te]={zoom:te,type:s.type,property:s.property,default:s.default,stops:[]},F.push(te)),L[te].stops.push([X[0].value,X[1]])}const V=[];for(const H of F)V.push([L[H].zoom,Uc(L[H],i)]);const j={name:"linear"};return{kind:"composite",interpolationType:j,interpolationFactor:ga.interpolationFactor.bind(void 0,j),zoomStops:V.map(H=>H[0]),evaluate:({zoom:H},X)=>el({stops:V,base:s.base},i,H).evaluate(H,X)}}if(m){const L="exponential"===w?{name:"exponential",base:void 0!==s.base?s.base:1}:null;return{kind:"camera",interpolationType:L,interpolationFactor:ga.interpolationFactor.bind(void 0,L),zoomStops:s.stops.map(F=>F[0]),evaluate:({zoom:F})=>S(s,i,F,D,P)}}return{kind:"source",evaluate(L,F){const V=F&&F.properties?F.properties[s.property]:void 0;return void 0===V?Ts(s.default,i.default):S(s,i,V,D,P)}}}function Ts(s,i,a){return void 0!==s?s:void 0!==i?i:void 0!==a?a:void 0}function fs(s,i,a,f,m){return Ts(typeof a===m?f[a]:void 0,s.default,i.default)}function ss(s,i,a){if("number"!==Lr(a))return Ts(s.default,i.default);const f=s.stops.length;if(1===f||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[f-1][0])return s.stops[f-1][1];const m=Is(s.stops.map(w=>w[0]),a);return s.stops[m][1]}function el(s,i,a){const f=void 0!==s.base?s.base:1;if("number"!==Lr(a))return Ts(s.default,i.default);const m=s.stops.length;if(1===m||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[m-1][0])return s.stops[m-1][1];const w=Is(s.stops.map(F=>F[0]),a),S=function(F,V,j,H){const X=H-j,te=F-j;return 0===X?0:1===V?te/X:(Math.pow(V,te)-1)/(Math.pow(V,X)-1)}(a,f,s.stops[w][0],s.stops[w+1][0]),D=s.stops[w][1],P=s.stops[w+1][1];let L=Si[i.type]||vo;if(s.colorSpace&&"rgb"!==s.colorSpace){const F=pa[s.colorSpace];L=(V,j)=>F.reverse(F.interpolate(F.forward(V),F.forward(j),S))}return"function"==typeof D.evaluate?{evaluate(...F){const V=D.evaluate.apply(void 0,F),j=P.evaluate.apply(void 0,F);if(void 0!==V&&void 0!==j)return L(V,j,S)}}:L(D,P,S)}function Hl(s,i,a){return"color"===i.type?a=Ur.parse(a):"formatted"===i.type?a=hi.fromString(a.toString()):"resolvedImage"===i.type?a=lu.fromString(a.toString()):Lr(a)===i.type||"enum"===i.type&&i.values[a]||(a=void 0),Ts(a,s.default,i.default)}class Da{constructor(i,a){var f;this.expression=i,this._warningHistory={},this._evaluator=new cs,this._defaultValue=a?"color"===(f=a).type&&(vs(f.default)||Array.isArray(f.default))?new Ur(0,0,0,0):"color"===f.type?Ur.parse(f.default)||null:void 0===f.default?null:f.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(i,a,f,m,w,S,D,P){return this._evaluator.globals=i,this._evaluator.feature=a,this._evaluator.featureState=f,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=P||null,this.expression.evaluate(this._evaluator)}evaluate(i,a,f,m,w,S,D,P){this._evaluator.globals=i,this._evaluator.feature=a||null,this._evaluator.featureState=f||null,this._evaluator.canonical=m||null,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=S||null,this._evaluator.featureTileCoord=D||null,this._evaluator.featureDistanceData=P||null;try{const L=this.expression.evaluate(this._evaluator);if(null==L||"number"==typeof L&&L!=L)return this._defaultValue;if(this._enumValues&&!(L in this._enumValues))throw new Ci(`Expected value to be one of ${Object.keys(this._enumValues).map(F=>JSON.stringify(F)).join(", ")}, but found ${JSON.stringify(L)} instead.`);return L}catch(L){return this._warningHistory[L.message]||(this._warningHistory[L.message]=!0,typeof console<"u"&&console.warn(L.message)),this._defaultValue}}}function ju(s){return Array.isArray(s)&&s.length>0&&"string"==typeof s[0]&&s[0]in Xo}function bs(s,i){const a=new rr(Xo,[],i?function(m){const w={color:Cu,string:qn,number:un,enum:qn,boolean:vr,formatted:Hs,resolvedImage:hc};return"array"===m.type?pr(w[m.value]||Qt,m.length):w[m.type]}(i):void 0),f=a.parse(s,void 0,void 0,void 0,i&&"string"===i.type?{typeAnnotation:"coerce"}:void 0);return f?Ua(new Da(f,i)):os(a.errors)}class pu{constructor(i,a){this.kind=i,this._styleExpression=a,this.isStateDependent="constant"!==i&&!Tu(a.expression)}evaluateWithoutErrorHandling(i,a,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,a,f,m,w,S)}evaluate(i,a,f,m,w,S){return this._styleExpression.evaluate(i,a,f,m,w,S)}}class zo{constructor(i,a,f,m){this.kind=i,this.zoomStops=f,this._styleExpression=a,this.isStateDependent="camera"!==i&&!Tu(a.expression),this.interpolationType=m}evaluateWithoutErrorHandling(i,a,f,m,w,S){return this._styleExpression.evaluateWithoutErrorHandling(i,a,f,m,w,S)}evaluate(i,a,f,m,w,S){return this._styleExpression.evaluate(i,a,f,m,w,S)}interpolationFactor(i,a,f){return this.interpolationType?ga.interpolationFactor(this.interpolationType,i,a,f):0}}function fh(s,i){if("error"===(s=bs(s,i)).result)return s;const a=s.value.expression,f=cu(a);if(!f&&!Vu(i))return os([new uu("","data expressions not supported")]);const m=Nu(a,["zoom","pitch","distance-from-center"]);if(!m&&!du(i))return os([new uu("","zoom expressions not supported")]);const w=Ds(a);return w||m?w instanceof uu?os([w]):w instanceof ga&&!so(i)?os([new uu("",'"interpolate" expressions cannot be used with this property')]):Ua(w?new zo(f?"camera":"composite",s.value,w.labels,w instanceof ga?w.interpolation:void 0):new pu(f?"constant":"source",s.value)):os([new uu("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class vl{constructor(i,a){this._parameters=i,this._specification=a,Na(this,Uc(this._parameters,this._specification))}static deserialize(i){return new vl(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Ds(s){let i=null;if(s instanceof xi)i=Ds(s.result);else if(s instanceof vi){for(const a of s.args)if(i=Ds(a),i)break}else(s instanceof Gr||s instanceof ga)&&s.input instanceof $o&&"zoom"===s.input.name&&(i=s);return i instanceof uu||s.eachChild(a=>{const f=Ds(a);f instanceof uu?i=f:!i&&f?i=new uu("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new uu("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}class Tn{constructor(i,a,f,m){this.message=(i?`${i}: `:"")+f,m&&(this.identifier=m),null!=a&&a.__line__&&(this.line=a.__line__)}}function Ya(s){const i=s.key,a=s.value,f=s.valueSpec||{},m=s.objectElementValidators||{},w=s.style,S=s.styleSpec;let D=[];const P=Lr(a);if("object"!==P)return[new Tn(i,a,`object expected, ${P} found`)];for(const L in a){const F=L.split(".")[0],V=f[F]||f["*"];let j;m[F]?j=m[F]:f[F]?j=Bs:m["*"]?j=m["*"]:f["*"]&&(j=Bs),j?D=D.concat(j({key:(i&&`${i}.`)+L,value:a[L],valueSpec:V,style:w,styleSpec:S,object:a,objectKey:L},a)):D.push(new Tn(i,a[L],`unknown property "${L}"`))}for(const L in f)m[L]||f[L].required&&void 0===f[L].default&&void 0===a[L]&&D.push(new Tn(i,a,`missing required property "${L}"`));return D}function Xl(s){const i=s.value,a=s.valueSpec,f=s.style,m=s.styleSpec,w=s.key,S=s.arrayElementValidator||Bs;if("array"!==Lr(i))return[new Tn(w,i,`array expected, ${Lr(i)} found`)];if(a.length&&i.length!==a.length)return[new Tn(w,i,`array length ${a.length} expected, length ${i.length} found`)];if(a["min-length"]&&i.length<a["min-length"])return[new Tn(w,i,`array length at least ${a["min-length"]} expected, length ${i.length} found`)];let D={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};m.$version<7&&(D.function=a.function),"object"===Lr(a.value)&&(D=a.value);let P=[];for(let L=0;L<i.length;L++)P=P.concat(S({array:i,arrayIndex:L,value:i[L],valueSpec:D,style:f,styleSpec:m,key:`${w}[${L}]`}));return P}function xl(s){const i=s.key,a=s.value,f=s.valueSpec;let m=Lr(a);if("number"===m&&a!=a&&(m="NaN"),"number"!==m)return[new Tn(i,a,`number expected, ${m} found`)];if("minimum"in f){let w=f.minimum;if("array"===Lr(f.minimum)&&(w=f.minimum[s.arrayIndex]),a<w)return[new Tn(i,a,`${a} is less than the minimum value ${w}`)]}if("maximum"in f){let w=f.maximum;if("array"===Lr(f.maximum)&&(w=f.maximum[s.arrayIndex]),a>w)return[new Tn(i,a,`${a} is greater than the maximum value ${w}`)]}return[]}function Es(s){const i=s.valueSpec,a=go(s.value.type);let f,m,w,S={};const D="categorical"!==a&&void 0===s.value.property,P=!D,L="array"===Lr(s.value.stops)&&"array"===Lr(s.value.stops[0])&&"object"===Lr(s.value.stops[0][0]),F=Ya({key:s.key,value:s.value,valueSpec:s.styleSpec.function,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(H){if("identity"===a)return[new Tn(H.key,H.value,'identity function may not have a "stops" property')];let X=[];const te=H.value;return X=X.concat(Xl({key:H.key,value:te,valueSpec:H.valueSpec,style:H.style,styleSpec:H.styleSpec,arrayElementValidator:V})),"array"===Lr(te)&&0===te.length&&X.push(new Tn(H.key,te,"array must have at least one stop")),X},default:function(H){return Bs({key:H.key,value:H.value,valueSpec:i,style:H.style,styleSpec:H.styleSpec})}}});return"identity"===a&&D&&F.push(new Tn(s.key,s.value,'missing required property "property"')),"identity"===a||s.value.stops||F.push(new Tn(s.key,s.value,'missing required property "stops"')),"exponential"===a&&s.valueSpec.expression&&!so(s.valueSpec)&&F.push(new Tn(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(P&&!Vu(s.valueSpec)?F.push(new Tn(s.key,s.value,"property functions not supported")):D&&!du(s.valueSpec)&&F.push(new Tn(s.key,s.value,"zoom functions not supported"))),"categorical"!==a&&!L||void 0!==s.value.property||F.push(new Tn(s.key,s.value,'"property" property is required')),F;function V(H){let X=[];const te=H.value,_e=H.key;if("array"!==Lr(te))return[new Tn(_e,te,`array expected, ${Lr(te)} found`)];if(2!==te.length)return[new Tn(_e,te,`array length 2 expected, length ${te.length} found`)];if(L){if("object"!==Lr(te[0]))return[new Tn(_e,te,`object expected, ${Lr(te[0])} found`)];if(void 0===te[0].zoom)return[new Tn(_e,te,"object stop key must have zoom")];if(void 0===te[0].value)return[new Tn(_e,te,"object stop key must have value")];const Ue=go(te[0].zoom);if("number"!=typeof Ue)return[new Tn(_e,te[0].zoom,"stop zoom values must be numbers")];if(w&&w>Ue)return[new Tn(_e,te[0].zoom,"stop zoom values must appear in ascending order")];Ue!==w&&(w=Ue,m=void 0,S={}),X=X.concat(Ya({key:`${_e}[0]`,value:te[0],valueSpec:{zoom:{}},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{zoom:xl,value:j}}))}else X=X.concat(j({key:`${_e}[0]`,value:te[0],valueSpec:{},style:H.style,styleSpec:H.styleSpec},te));return ju(ra(te[1]))?X.concat([new Tn(`${_e}[1]`,te[1],"expressions are not allowed in function stops.")]):X.concat(Bs({key:`${_e}[1]`,value:te[1],valueSpec:i,style:H.style,styleSpec:H.styleSpec}))}function j(H,X){const te=Lr(H.value),_e=go(H.value),Ue=null!==H.value?H.value:X;if(f){if(te!==f)return[new Tn(H.key,Ue,`${te} stop domain type must match previous stop domain type ${f}`)]}else f=te;if("number"!==te&&"string"!==te&&"boolean"!==te&&"number"!=typeof _e&&"string"!=typeof _e&&"boolean"!=typeof _e)return[new Tn(H.key,Ue,"stop domain value must be a number, string, or boolean")];if("number"!==te&&"categorical"!==a){let Xe=`number expected, ${te} found`;return Vu(i)&&void 0===a&&(Xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Tn(H.key,Ue,Xe)]}return"categorical"!==a||"number"!==te||"number"==typeof _e&&isFinite(_e)&&Math.floor(_e)===_e?"categorical"!==a&&"number"===te&&"number"==typeof _e&&"number"==typeof m&&void 0!==m&&_e<m?[new Tn(H.key,Ue,"stop domain values must appear in ascending order")]:(m=_e,"categorical"===a&&_e in S?[new Tn(H.key,Ue,"stop domain values must be unique")]:(S[_e]=!0,[])):[new Tn(H.key,Ue,`integer expected, found ${String(_e)}`)]}}function as(s){const i=("property"===s.expressionContext?fh:bs)(ra(s.value),s.valueSpec);if("error"===i.result)return i.value.map(f=>new Tn(`${s.key}${f.key}`,s.value,f.message));const a=i.value.expression||i.value._styleExpression.expression;if("property"===s.expressionContext&&"text-font"===s.propertyKey&&!a.outputDefined())return[new Tn(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===s.expressionContext&&"layout"===s.propertyType&&!Tu(a))return[new Tn(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===s.expressionContext)return _c(a,s);if(s.expressionContext&&0===s.expressionContext.indexOf("cluster")){if(!Nu(a,["zoom","feature-state"]))return[new Tn(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===s.expressionContext&&!cu(a))return[new Tn(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function _c(s,i){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const m of i.valueSpec.expression.parameters)a.delete(m);if(0===a.size)return[];const f=[];return s instanceof $o&&a.has(s.name)?[new Tn(i.key,i.value,`["${s.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(s.eachChild(m=>{f.push(..._c(m,i))}),f)}function Ns(s){const i=s.key,a=s.value,f=s.valueSpec,m=[];return Array.isArray(f.values)?-1===f.values.indexOf(go(a))&&m.push(new Tn(i,a,`expected one of [${f.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(f.values).indexOf(go(a))&&m.push(new Tn(i,a,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(a)} found`)),m}function $h(s){if(!0===s||!1===s)return!0;if(!Array.isArray(s)||0===s.length)return!1;switch(s[0]){case"has":return s.length>=2&&"$id"!==s[1]&&"$type"!==s[1];case"in":return s.length>=3&&("string"!=typeof s[1]||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==s.length||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!$h(i)&&"boolean"!=typeof i)return!1;return!0;default:return!0}}function Vc(s,i="fill"){if(null==s)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$h(s)||(s=qh(s));const a=s;let f=!0;try{f=function(L){if(!Ks(L))return L;let F=ra(L);return Gu(F),F=ks(F),F}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const m=Rt[`filter_${i}`],w=bs(f,m);let S=null;if("error"===w.result)throw new Error(w.value.map(L=>`${L.key}: ${L.message}`).join(", "));S=(L,F,V)=>w.value.evaluate(L,F,{},V);let D=null,P=null;if(f!==a){const L=bs(a,m);if("error"===L.result)throw new Error(L.value.map(F=>`${F.key}: ${F.message}`).join(", "));D=(F,V,j,H,X)=>L.value.evaluate(F,V,{},j,void 0,void 0,H,X),P=!cu(L.value.expression)}return{filter:S,dynamicFilter:D||void 0,needGeometry:ud(f),needFeature:!!P}}function ks(s){if(!Array.isArray(s))return s;const i=function(a){if(Cs.has(a[0]))for(let f=1;f<a.length;f++)if(Ks(a[f]))return!0;return a}(s);return!0===i?i:i.map(a=>ks(a))}function Gu(s){let i=!1;const a=[];if("case"===s[0]){for(let f=1;f<s.length-1;f+=2)i=i||Ks(s[f]),a.push(s[f+1]);a.push(s[s.length-1])}else if("match"===s[0]){i=i||Ks(s[1]);for(let f=2;f<s.length-1;f+=2)a.push(s[f+1]);a.push(s[s.length-1])}else if("step"===s[0]){i=i||Ks(s[1]);for(let f=1;f<s.length-1;f+=2)a.push(s[f+1])}i&&(s.length=0,s.push("any",...a));for(let f=1;f<s.length;f++)Gu(s[f])}function Ks(s){if(!Array.isArray(s))return!1;if("pitch"===(i=s[0])||"distance-from-center"===i)return!0;var i;for(let a=1;a<s.length;a++)if(Ks(s[a]))return!0;return!1}const Cs=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wl(s,i){return s<i?-1:s>i?1:0}function ud(s){if(!Array.isArray(s))return!1;if("within"===s[0])return!0;for(let i=1;i<s.length;i++)if(ud(s[i]))return!0;return!1}function qh(s){if(!s)return!0;const i=s[0];return s.length<=1?"any"!==i:"=="===i?Ka(s[1],s[2],"=="):"!="===i?Wl(Ka(s[1],s[2],"==")):"<"===i||">"===i||"<="===i||">="===i?Ka(s[1],s[2],i):"any"===i?(a=s.slice(1),["any"].concat(a.map(qh))):"all"===i?["all"].concat(s.slice(1).map(qh)):"none"===i?["all"].concat(s.slice(1).map(qh).map(Wl)):"in"===i?Zl(s[1],s.slice(2)):"!in"===i?Wl(Zl(s[1],s.slice(2))):"has"===i?bl(s[1]):"!has"===i?Wl(bl(s[1])):"within"!==i||s;var a}function Ka(s,i,a){switch(s){case"$type":return[`filter-type-${a}`,i];case"$id":return[`filter-id-${a}`,i];default:return[`filter-${a}`,s,i]}}function Zl(s,i){if(0===i.length)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(a=>typeof a!=typeof i[0])?["filter-in-large",s,["literal",i.sort(wl)]]:["filter-in-small",s,["literal",i]]}}function bl(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Wl(s){return["!",s]}function tl(s){return $h(ra(s.value))?as(Na({},s,{expressionContext:"filter",valueSpec:s.styleSpec[`filter_${s.layerType||"fill"}`]})):Fs(s)}function Fs(s){const i=s.value,a=s.key;if("array"!==Lr(i))return[new Tn(a,i,`array expected, ${Lr(i)} found`)];const f=s.styleSpec;let m,w=[];if(i.length<1)return[new Tn(a,i,"filter array must have at least 1 element")];switch(w=w.concat(Ns({key:`${a}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),go(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&"$type"===go(i[1])&&w.push(new Tn(a,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":3!==i.length&&w.push(new Tn(a,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(m=Lr(i[1]),"string"!==m&&w.push(new Tn(`${a}[1]`,i[1],`string expected, ${m} found`)));for(let S=2;S<i.length;S++)m=Lr(i[S]),"$type"===go(i[1])?w=w.concat(Ns({key:`${a}[${S}]`,value:i[S],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):"string"!==m&&"number"!==m&&"boolean"!==m&&w.push(new Tn(`${a}[${S}]`,i[S],`string, number, or boolean expected, ${m} found`));break;case"any":case"all":case"none":for(let S=1;S<i.length;S++)w=w.concat(Fs({key:`${a}[${S}]`,value:i[S],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":m=Lr(i[1]),2!==i.length?w.push(new Tn(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"string"!==m&&w.push(new Tn(`${a}[1]`,i[1],`string expected, ${m} found`));break;case"within":m=Lr(i[1]),2!==i.length?w.push(new Tn(a,i,`filter array for "${i[0]}" operator must have 2 elements`)):"object"!==m&&w.push(new Tn(`${a}[1]`,i[1],`object expected, ${m} found`))}return w}function vc(s,i){const a=s.key,f=s.style,m=s.styleSpec,w=s.value,S=s.objectKey,D=m[`${i}_${s.layerType}`];if(!D)return[];const P=S.match(/^(.*)-transition$/);if("paint"===i&&P&&D[P[1]]&&D[P[1]].transition)return Bs({key:a,value:w,valueSpec:m.transition,style:f,styleSpec:m});const L=s.valueSpec||D[S];if(!L)return[new Tn(a,w,`unknown property "${S}"`)];let F;if("string"===Lr(w)&&Vu(L)&&!L.tokens&&(F=/^{([^}]+)}$/.exec(w)))return[new Tn(a,w,`"${S}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const V=[];return"symbol"===s.layerType&&("text-field"===S&&f&&!f.glyphs&&V.push(new Tn(a,w,'use of "text-field" requires a style "glyphs" property')),"text-font"===S&&vs(ra(w))&&"identity"===go(w.type)&&V.push(new Tn(a,w,'"text-font" does not support identity functions'))),V.concat(Bs({key:s.key,value:w,valueSpec:L,style:f,styleSpec:m,expressionContext:"property",propertyType:i,propertyKey:S}))}function nl(s){return vc(s,"paint")}function us(s){return vc(s,"layout")}function br(s){let i=[];const a=s.value,f=s.key,m=s.style,w=s.styleSpec;a.type||a.ref||i.push(new Tn(f,a,'either "type" or "ref" is required'));let S=go(a.type);const D=go(a.ref);if(a.id){const P=go(a.id);for(let L=0;L<s.arrayIndex;L++){const F=m.layers[L];go(F.id)===P&&i.push(new Tn(f,a.id,`duplicate layer id "${a.id}", previously used at line ${F.id.__line__}`))}}if("ref"in a){let P;["type","source","source-layer","filter","layout"].forEach(L=>{L in a&&i.push(new Tn(f,a[L],`"${L}" is prohibited for ref layers`))}),m.layers.forEach(L=>{go(L.id)===D&&(P=L)}),P?P.ref?i.push(new Tn(f,a.ref,"ref cannot reference another ref layer")):S=go(P.type):"string"==typeof D&&i.push(new Tn(f,a.ref,`ref layer "${D}" not found`))}else if("background"!==S&&"sky"!==S)if(a.source){const P=m.sources&&m.sources[a.source],L=P&&go(P.type);P?"vector"===L&&"raster"===S?i.push(new Tn(f,a.source,`layer "${a.id}" requires a raster source`)):"raster"===L&&"raster"!==S?i.push(new Tn(f,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==L||a["source-layer"]?"raster-dem"===L&&"hillshade"!==S?i.push(new Tn(f,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==S||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===L&&P.lineMetrics||i.push(new Tn(f,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Tn(f,a,`layer "${a.id}" must specify a "source-layer"`)):i.push(new Tn(f,a.source,`source "${a.source}" not found`))}else i.push(new Tn(f,a,'missing required property "source"'));return i=i.concat(Ya({key:f,value:a,valueSpec:w.layer,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Bs({key:`${f}.type`,value:a.type,valueSpec:w.layer.type,style:s.style,styleSpec:s.styleSpec,object:a,objectKey:"type"}),filter:P=>tl(Na({layerType:S},P)),layout:P=>Ya({layer:a,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":L=>us(Na({layerType:S},L))}}),paint:P=>Ya({layer:a,key:P.key,value:P.value,valueSpec:{},style:P.style,styleSpec:P.styleSpec,objectElementValidators:{"*":L=>nl(Na({layerType:S},L))}})}})),i}function sa(s){const i=s.value,a=s.key,f=Lr(i);return"string"!==f?[new Tn(a,i,`string expected, ${f} found`)]:[]}const Js={promoteId:function({key:s,value:i}){if("string"===Lr(i))return sa({key:s,value:i});{const a=[];for(const f in i)a.push(...sa({key:`${s}.${f}`,value:i[f]}));return a}}};function $u(s){const i=s.value,a=s.key,f=s.styleSpec,m=s.style;if(!i.type)return[new Tn(a,i,'"type" is required')];const w=go(i.type);let S;switch(w){case"vector":case"raster":case"raster-dem":return S=Ya({key:a,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Js}),S;case"geojson":if(S=Ya({key:a,value:i,valueSpec:f.source_geojson,style:m,styleSpec:f,objectElementValidators:Js}),i.cluster)for(const D in i.clusterProperties){const[P,L]=i.clusterProperties[D],F="string"==typeof P?[P,["accumulated"],["get",D]]:P;S.push(...as({key:`${a}.${D}.map`,value:L,expressionContext:"cluster-map"})),S.push(...as({key:`${a}.${D}.reduce`,value:F,expressionContext:"cluster-reduce"}))}return S;case"video":return Ya({key:a,value:i,valueSpec:f.source_video,style:m,styleSpec:f});case"image":return Ya({key:a,value:i,valueSpec:f.source_image,style:m,styleSpec:f});case"canvas":return[new Tn(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ns({key:`${a}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:f})}}function zs(s){const i=s.value,a=s.styleSpec,f=a.light,m=s.style;let w=[];const S=Lr(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new Tn("light",i,`object expected, ${S} found`)]),w;for(const D in i){const P=D.match(/^(.*)-transition$/);w=w.concat(P&&f[P[1]]&&f[P[1]].transition?Bs({key:D,value:i[D],valueSpec:a.transition,style:m,styleSpec:a}):f[D]?Bs({key:D,value:i[D],valueSpec:f[D],style:m,styleSpec:a}):[new Tn(D,i[D],`unknown property "${D}"`)])}return w}function El(s){const i=s.value,a=s.key,f=s.style,m=s.styleSpec,w=m.terrain;let S=[];const D=Lr(i);if(void 0===i)return S;if("object"!==D)return S=S.concat([new Tn("terrain",i,`object expected, ${D} found`)]),S;for(const P in i){const L=P.match(/^(.*)-transition$/);S=S.concat(L&&w[L[1]]&&w[L[1]].transition?Bs({key:P,value:i[P],valueSpec:m.transition,style:f,styleSpec:m}):w[P]?Bs({key:P,value:i[P],valueSpec:w[P],style:f,styleSpec:m}):[new Tn(P,i[P],`unknown property "${P}"`)])}if(i.source){const P=f.sources&&f.sources[i.source],L=P&&go(P.type);P?"raster-dem"!==L&&S.push(new Tn(a,i.source,`terrain cannot be used with a source of type ${String(L)}, it only be used with a "raster-dem" source type`)):S.push(new Tn(a,i.source,`source "${i.source}" not found`))}else S.push(new Tn(a,i,'terrain is missing required property "source"'));return S}function Po(s){const i=s.value,a=s.style,f=s.styleSpec,m=f.fog;let w=[];const S=Lr(i);if(void 0===i)return w;if("object"!==S)return w=w.concat([new Tn("fog",i,`object expected, ${S} found`)]),w;for(const D in i){const P=D.match(/^(.*)-transition$/);w=w.concat(P&&m[P[1]]&&m[P[1]].transition?Bs({key:D,value:i[D],valueSpec:f.transition,style:a,styleSpec:f}):m[D]?Bs({key:D,value:i[D],valueSpec:m[D],style:a,styleSpec:f}):[new Tn(D,i[D],`unknown property "${D}"`)])}return w}const Zo={"*":()=>[],array:Xl,boolean:function(s){const i=s.value,a=s.key,f=Lr(i);return"boolean"!==f?[new Tn(a,i,`boolean expected, ${f} found`)]:[]},number:xl,color:function(s){const i=s.key,a=s.value,f=Lr(a);return"string"!==f?[new Tn(i,a,`color expected, ${f} found`)]:null===Vh(a)?[new Tn(i,a,`color expected, "${a}" found`)]:[]},enum:Ns,filter:tl,function:Es,layer:br,object:Ya,source:$u,light:zs,terrain:El,fog:Po,string:sa,formatted:function(s){return 0===sa(s).length?[]:as(s)},resolvedImage:function(s){return 0===sa(s).length?[]:as(s)},projection:function(s){const i=s.value,a=s.styleSpec,f=a.projection,m=s.style;let w=[];const S=Lr(i);if("object"===S)for(const D in i)w=w.concat(Bs({key:D,value:i[D],valueSpec:f[D],style:m,styleSpec:a}));else"string"!==S&&(w=w.concat([new Tn("projection",i,`object or string expected, ${S} found`)]));return w}};function Bs(s){const i=s.value,a=s.valueSpec,f=s.styleSpec;return a.expression&&vs(go(i))?Es(s):a.expression&&ju(ra(i))?as(s):a.type&&Zo[a.type]?Zo[a.type](s):Ya(Na({},s,{valueSpec:a.type?f[a.type]:a}))}function xc(s){const i=s.value,a=s.key,f=sa(s);return f.length||(-1===i.indexOf("{fontstack}")&&f.push(new Tn(a,i,'"glyphs" url must include a "{fontstack}" token')),-1===i.indexOf("{range}")&&f.push(new Tn(a,i,'"glyphs" url must include a "{range}" token'))),f}function u(s,i=Rt){return x(Bs({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,objectElementValidators:{glyphs:xc,"*":()=>[]}}))}const h=s=>x(nl(s)),y=s=>x(us(s));function x(s){return s.slice().sort((i,a)=>i.line&&a.line?i.line-a.line:0)}function T(s,i){let a=!1;if(i&&i.length)for(const f of i)s.fire(new ps(new Error(f.message))),a=!0;return a}var k=G;function G(s,i,a){var f=this.cells=[];if(s instanceof ArrayBuffer){this.arrayBuffer=s;var m=new Int32Array(this.arrayBuffer);s=m[0],this.d=(i=m[1])+2*(a=m[2]);for(var w=0;w<this.d*this.d;w++){var S=m[3+w],D=m[3+w+1];f.push(S===D?null:m.subarray(S,D))}var P=m[3+f.length+1];this.keys=m.subarray(m[3+f.length],P),this.bboxes=m.subarray(P),this.insert=this._insertReadonly}else{this.d=i+2*a;for(var L=0;L<this.d*this.d;L++)f.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=s,this.padding=a,this.scale=i/s,this.uid=0;var F=a/i*s;this.min=-F,this.max=s+F}G.prototype.insert=function(s,i,a,f,m){this._forEachCell(i,a,f,m,this._insertCell,this.uid++),this.keys.push(s),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(m)},G.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},G.prototype._insertCell=function(s,i,a,f,m,w){this.cells[m].push(w)},G.prototype.query=function(s,i,a,f,m){var w=this.min,S=this.max;if(s<=w&&i<=w&&S<=a&&S<=f&&!m)return Array.prototype.slice.call(this.keys);var D=[];return this._forEachCell(s,i,a,f,this._queryCell,D,{},m),D},G.prototype._queryCell=function(s,i,a,f,m,w,S,D){var P=this.cells[m];if(null!==P)for(var L=this.keys,F=this.bboxes,V=0;V<P.length;V++){var j=P[V];if(void 0===S[j]){var H=4*j;(D?D(F[H+0],F[H+1],F[H+2],F[H+3]):s<=F[H+2]&&i<=F[H+3]&&a>=F[H+0]&&f>=F[H+1])?(S[j]=!0,w.push(L[j])):S[j]=!1}}},G.prototype._forEachCell=function(s,i,a,f,m,w,S,D){for(var P=this._convertToCellCoord(s),L=this._convertToCellCoord(i),F=this._convertToCellCoord(a),V=this._convertToCellCoord(f),j=P;j<=F;j++)for(var H=L;H<=V;H++){var X=this.d*H+j;if((!D||D(this._convertFromCellCoord(j),this._convertFromCellCoord(H),this._convertFromCellCoord(j+1),this._convertFromCellCoord(H+1)))&&m.call(this,s,i,a,f,X,w,S,D))return}},G.prototype._convertFromCellCoord=function(s){return(s-this.padding)/this.scale},G.prototype._convertToCellCoord=function(s){return Math.max(0,Math.min(this.d-1,Math.floor(s*this.scale)+this.padding))},G.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var s=this.cells,i=3+this.cells.length+1+1,a=0,f=0;f<this.cells.length;f++)a+=this.cells[f].length;var m=new Int32Array(i+a+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var w=i,S=0;S<s.length;S++){var D=s[S];m[3+S]=w,m.set(D,w),w+=D.length}return m[3+s.length]=w,m.set(this.keys,w),m[3+s.length+1]=w+=this.keys.length,m.set(this.bboxes,w),w+=this.bboxes.length,m.buffer};const K={};function re(s,i,a={}){Object.defineProperty(s,"_classRegistryKey",{value:i,writeable:!1}),K[i]={klass:s,omit:a.omit||[]}}re(Object,"Object"),k.serialize=function(s,i){const a=s.toArrayBuffer();return i&&i.push(a),{buffer:a}},k.deserialize=function(s){return new k(s.buffer)},Object.defineProperty(k,"name",{value:"Grid"}),re(k,"Grid"),re(Ur,"Color"),re(Error,"Error"),re(En,"AJAXError"),re(lu,"ResolvedImage"),re(vl,"StylePropertyFunction"),re(Da,"StyleExpression",{omit:["_evaluator"]}),re(zo,"ZoomDependentExpression"),re(pu,"ZoomConstantExpression"),re($o,"CompoundExpression",{omit:["_evaluate"]});for(const s in Xo)K[Xo[s]._classRegistryKey]||re(Xo[s],`Expression${s}`);function et(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&"ArrayBuffer"===s.constructor.name)}function Ft(s){return ve.ImageBitmap&&s instanceof ve.ImageBitmap}function $t(s,i){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(et(s)||Ft(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return i&&i.push(a.buffer),a}if(s instanceof ve.ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const f of s)a.push($t(f,i));return a}if("object"==typeof s){const a=s.constructor,f=a._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${f}`);const m=a.serialize?a.serialize(s,i):{};if(!a.serialize){for(const w in s)s.hasOwnProperty(w)&&(K[f].omit.indexOf(w)>=0||(m[w]=$t(s[w],i)));s instanceof Error&&(m.message=s.message)}if(m.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==f&&(m.$name=f),m}throw new Error("can't serialize object of type "+typeof s)}function gt(s){if(null==s||"boolean"==typeof s||"number"==typeof s||"string"==typeof s||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||et(s)||Ft(s)||ArrayBuffer.isView(s)||s instanceof ve.ImageData)return s;if(Array.isArray(s))return s.map(gt);if("object"==typeof s){const i=s.$name||"Object",{klass:a}=K[i];if(!a)throw new Error(`can't deserialize unregistered class ${i}`);if(a.deserialize)return a.deserialize(s);const f=Object.create(a.prototype);for(const m of Object.keys(s))"$name"!==m&&(f[m]=gt(s[m]));return f}throw new Error("can't deserialize object of type "+typeof s)}class nn{constructor(){this.first=!0}update(i,a){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=a),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const Un=s=>s>=1536&&s<=1791,Qn=s=>s>=1872&&s<=1919,Sr=s=>s>=2208&&s<=2303,Bo=s=>s>=11904&&s<=12031,xs=s=>s>=12032&&s<=12255,Ss=s=>s>=12272&&s<=12287,Va=s=>s>=12288&&s<=12351,Yl=s=>s>=12352&&s<=12447,If=s=>s>=12448&&s<=12543,Jd=s=>s>=12544&&s<=12591,Tf=s=>s>=12704&&s<=12735,Ja=s=>s>=12736&&s<=12783,Kl=s=>s>=12784&&s<=12799,ld=s=>s>=12800&&s<=13055,dh=s=>s>=13056&&s<=13311,Jl=s=>s>=13312&&s<=19903,Qd=s=>s>=19968&&s<=40959,Df=s=>s>=40960&&s<=42127,Hp=s=>s>=42128&&s<=42191,Xp=s=>s>=44032&&s<=55215,cd=s=>s>=63744&&s<=64255,Mf=s=>s>=64336&&s<=65023,ep=s=>s>=65040&&s<=65055,Hh=s=>s>=65072&&s<=65103,Af=s=>s>=65104&&s<=65135,v=s=>s>=65136&&s<=65279,l=s=>s>=65280&&s<=65519;function g(s){for(const i of s)if(M(i.charCodeAt(0)))return!0;return!1}function b(s){for(const i of s)if(!I(i.charCodeAt(0)))return!1;return!0}function I(s){return!(Un(s)||Qn(s)||Sr(s)||Mf(s)||v(s))}function M(s){return!(746!==s&&747!==s&&(s<4352||!(Tf(s)||Jd(s)||Hh(s)&&!(s>=65097&&s<=65103)||cd(s)||dh(s)||Bo(s)||Ja(s)||!(!Va(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||12336===s)||Jl(s)||Qd(s)||ld(s)||(i=s,i>=12592&&i<=12687)||(i=>i>=43360&&i<=43391)(s)||(i=>i>=55216&&i<=55295)(s)||(i=>i>=4352&&i<=4607)(s)||Xp(s)||Yl(s)||Ss(s)||(i=>i>=12688&&i<=12703)(s)||xs(s)||Kl(s)||If(s)&&12540!==s||!(!l(s)||65288===s||65289===s||65293===s||s>=65306&&s<=65310||65339===s||65341===s||65343===s||s>=65371&&s<=65503||65507===s||s>=65512&&s<=65519)||!(!Af(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(i=>i>=5120&&i<=5759)(s)||(i=>i>=6320&&i<=6399)(s)||ep(s)||(i=>i>=19904&&i<=19967)(s)||Df(s)||Hp(s))));var i}function O(s){return!(M(s)||(i=s,(a=i)>=128&&a<=255&&(167===i||169===i||174===i||177===i||188===i||189===i||190===i||215===i||247===i)||(a=>a>=8192&&a<=8303)(i)&&(8214===i||8224===i||8225===i||8240===i||8241===i||8251===i||8252===i||8258===i||8263===i||8264===i||8265===i||8273===i)||(a=>a>=8448&&a<=8527)(i)||(a=>a>=8528&&a<=8591)(i)||(a=>a>=8960&&a<=9215)(i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||9003===i||i>=9085&&i<=9114||i>=9150&&i<=9165||9167===i||i>=9169&&i<=9179||i>=9186&&i<=9215)||(a=>a>=9216&&a<=9279)(i)&&9251!==i||(a=>a>=9280&&a<=9311)(i)||(a=>a>=9312&&a<=9471)(i)||(a=>a>=9632&&a<=9727)(i)||(a=>a>=9728&&a<=9983)(i)&&!(i>=9754&&i<=9759)||(a=>a>=11008&&a<=11263)(i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||Va(i)||If(i)||(a=>a>=57344&&a<=63743)(i)||Hh(i)||Af(i)||l(i)||8734===i||8756===i||8757===i||i>=9984&&i<=10087||i>=10102&&i<=10131||65532===i||65533===i));var i,a}function B(s){return s>=1424&&s<=2303||Mf(s)||v(s)}function U(s,i){return!(!i&&B(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(a=s,a>=6016&&a<=6143));var a}function $(s){for(const i of s)if(B(i.charCodeAt(0)))return!0;return!1}const q="deferred",Z="loading",ge="loaded";let De=null,be="unavailable",Re=null;const Ce=function(s){s&&"string"==typeof s&&s.indexOf("NetworkError")>-1&&(be="error"),De&&De(s)};function xe(){Ne.fire(new _i("pluginStateChange",{pluginStatus:be,pluginURL:Re}))}const Ne=new fa,Se=function(){return be},Ye=function(){if(be!==q||!Re)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");be=Z,xe(),Re&&qr({url:Re},s=>{s?Ce(s):(be=ge,xe())})},Qe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>be===ge||null!=Qe.applyArabicShaping,isLoading:()=>be===Z,setState(s){be=s.pluginStatus,Re=s.pluginURL},isParsed:()=>null!=Qe.applyArabicShaping&&null!=Qe.processBidirectionalText&&null!=Qe.processStyledBidirectionalText,getPluginURL:()=>Re};class Ge{constructor(i,a){this.zoom=i,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new nn,this.transition={},this.pitch=0)}isSupportedScript(i){return function(a,f){for(const m of a)if(!U(m.charCodeAt(0),f))return!1;return!0}(i,Qe.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,a=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*a}}}class it{constructor(i,a){this.property=i,this.value=a,this.expression=function(f,m){if(vs(f))return new vl(f,m);if(ju(f)){const w=fh(f,m);if("error"===w.result)throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));return w.value}{let w=f;return"string"==typeof f&&"color"===m.type&&(w=Ur.parse(f)),{kind:"constant",evaluate:()=>w}}}(void 0===a?i.specification.default:a,i.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(i,a,f){return this.property.possiblyEvaluate(this,i,a,f)}}class St{constructor(i){this.property=i,this.value=new it(i,void 0)}transitioned(i,a){return new Pt(this.property,this.value,a,Me({},i.transition,this.transition),i.now)}untransitioned(){return new Pt(this.property,this.value,null,{},0)}}class zt{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Bn(this._values[i].value.value)}setValue(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new St(this._values[i].property)),this._values[i].value=new it(this._values[i].property,null===a?void 0:Bn(a))}getTransition(i){return Bn(this._values[i].transition)}setTransition(i,a){this._values.hasOwnProperty(i)||(this._values[i]=new St(this._values[i].property)),this._values[i].transition=Bn(a)||void 0}serialize(){const i={};for(const a of Object.keys(this._values)){const f=this.getValue(a);void 0!==f&&(i[a]=f);const m=this.getTransition(a);void 0!==m&&(i[`${a}-transition`]=m)}return i}transitioned(i,a){const f=new dn(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].transitioned(i,a._values[m]);return f}untransitioned(){const i=new dn(this._properties);for(const a of Object.keys(this._values))i._values[a]=this._values[a].untransitioned();return i}}class Pt{constructor(i,a,f,m,w){const S=m.delay||0,D=m.duration||0;w=w||0,this.property=i,this.value=a,this.begin=w+S,this.end=this.begin+D,i.specification.transition&&(m.delay||m.duration)&&(this.prior=f)}possiblyEvaluate(i,a,f){const m=i.now||0,w=this.value.possiblyEvaluate(i,a,f),S=this.prior;if(S){if(m>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(m<this.begin)return S.possiblyEvaluate(i,a,f);{const D=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(S.possiblyEvaluate(i,a,f),w,pt(D))}}return w}}class dn{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,a,f){const m=new Jt(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,a,f);return m}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class wt{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}getValue(i){return Bn(this._values[i].value)}setValue(i,a){this._values[i]=new it(this._values[i].property,null===a?void 0:Bn(a))}serialize(){const i={};for(const a of Object.keys(this._values)){const f=this.getValue(a);void 0!==f&&(i[a]=f)}return i}possiblyEvaluate(i,a,f){const m=new Jt(this._properties);for(const w of Object.keys(this._values))m._values[w]=this._values[w].possiblyEvaluate(i,a,f);return m}}class en{constructor(i,a,f){this.property=i,this.value=a,this.parameters=f}isConstant(){return"constant"===this.value.kind}constantOr(i){return"constant"===this.value.kind?this.value.value:i}evaluate(i,a,f,m){return this.property.evaluate(this.value,this.parameters,i,a,f,m)}}class Jt{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class Dt{constructor(i){this.specification=i}possiblyEvaluate(i,a){return i.expression.evaluate(a)}interpolate(i,a,f){const m=Si[this.specification.type];return m?m(i,a,f):i}}class mt{constructor(i,a){this.specification=i,this.overrides=a}possiblyEvaluate(i,a,f,m){return new en(this,"constant"===i.expression.kind||"camera"===i.expression.kind?{kind:"constant",value:i.expression.evaluate(a,null,{},f,m)}:i.expression,a)}interpolate(i,a,f){if("constant"!==i.value.kind||"constant"!==a.value.kind)return i;if(void 0===i.value.value||void 0===a.value.value)return new en(this,{kind:"constant",value:void 0},i.parameters);const m=Si[this.specification.type];return m?new en(this,{kind:"constant",value:m(i.value.value,a.value.value,f)},i.parameters):i}evaluate(i,a,f,m,w,S){return"constant"===i.kind?i.value:i.evaluate(a,f,m,w,S)}}class An extends mt{possiblyEvaluate(i,a,f,m){if(void 0===i.value)return new en(this,{kind:"constant",value:void 0},a);if("constant"===i.expression.kind){const w=i.expression.evaluate(a,null,{},f,m),S="resolvedImage"===i.property.specification.type&&"string"!=typeof w?w.name:w,D=this._calculate(S,S,S,a);return new en(this,{kind:"constant",value:D},a)}if("camera"===i.expression.kind){const w=this._calculate(i.expression.evaluate({zoom:a.zoom-1}),i.expression.evaluate({zoom:a.zoom}),i.expression.evaluate({zoom:a.zoom+1}),a);return new en(this,{kind:"constant",value:w},a)}return new en(this,i.expression,a)}evaluate(i,a,f,m,w,S){if("source"===i.kind){const D=i.evaluate(a,f,m,w,S);return this._calculate(D,D,D,a)}return"composite"===i.kind?this._calculate(i.evaluate({zoom:Math.floor(a.zoom)-1},f,m),i.evaluate({zoom:Math.floor(a.zoom)},f,m),i.evaluate({zoom:Math.floor(a.zoom)+1},f,m),a):i.value}_calculate(i,a,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:a,other:f}:{from:f,to:a,other:i}}interpolate(i){return i}}class _n{constructor(i){this.specification=i}possiblyEvaluate(i,a,f,m){if(void 0!==i.value){if("constant"===i.expression.kind){const w=i.expression.evaluate(a,null,{},f,m);return this._calculate(w,w,w,a)}return this._calculate(i.expression.evaluate(new Ge(Math.floor(a.zoom-1),a)),i.expression.evaluate(new Ge(Math.floor(a.zoom),a)),i.expression.evaluate(new Ge(Math.floor(a.zoom+1),a)),a)}}_calculate(i,a,f,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:i,to:a}:{from:f,to:a}}interpolate(i){return i}}class Cn{constructor(i){this.specification=i}possiblyEvaluate(i,a,f,m){return!!i.expression.evaluate(a,null,{},f,m)}interpolate(){return!1}}class wn{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Ge(0,{});for(const f in i){const m=i[f];m.specification.overridable&&this.overridableProperties.push(f);const w=this.defaultPropertyValues[f]=new it(m,void 0),S=this.defaultTransitionablePropertyValues[f]=new St(m);this.defaultTransitioningPropertyValues[f]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[f]=w.possiblyEvaluate(a)}}}function Vn(s,i){return 256*(s=ue(Math.floor(s),0,255))+ue(Math.floor(i),0,255)}re(mt,"DataDrivenProperty"),re(Dt,"DataConstantProperty"),re(An,"CrossFadedDataDrivenProperty"),re(_n,"CrossFadedProperty"),re(Cn,"ColorRampProperty");const mr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ir{constructor(i,a){this._structArray=i,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,a){return i._trim(),a&&(i.isTransferred=!0,a.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const a=Object.create(this.prototype);return a.arrayBuffer=i.arrayBuffer,a.length=i.length,a.capacity=i.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function bn(s,i=1){let a=0,f=0;return{members:s.map(m=>{const w=mr[m.type].BYTES_PER_ELEMENT,S=a=xr(a,Math.max(i,w)),D=m.components||1;return f=Math.max(f,w),a+=w*D,{name:m.name,type:m.type,components:D,offset:S}}),size:xr(a,Math.max(f,i)),alignment:i}}function xr(s,i){return Math.ceil(s/i)*i}class Fr extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.int16[m+0]=a,this.int16[m+1]=f,i}}Fr.prototype.bytesPerElement=4,re(Fr,"StructArrayLayout2i4");class ao extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.int16[w+0]=a,this.int16[w+1]=f,this.int16[w+2]=m,i}}ao.prototype.bytesPerElement=6,re(ao,"StructArrayLayout3i6");class Ro extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=4*i;return this.int16[S+0]=a,this.int16[S+1]=f,this.int16[S+2]=m,this.int16[S+3]=w,i}}Ro.prototype.bytesPerElement=8,re(Ro,"StructArrayLayout4i8");class uo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,f,m,w,S,D)}emplace(i,a,f,m,w,S,D,P){const L=6*i,F=12*i,V=3*i;return this.int16[L+0]=a,this.int16[L+1]=f,this.uint8[F+4]=m,this.uint8[F+5]=w,this.uint8[F+6]=S,this.uint8[F+7]=D,this.float32[V+2]=P,i}}uo.prototype.bytesPerElement=12,re(uo,"StructArrayLayout2i4ub1f12");class aa extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=4*i;return this.float32[S+0]=a,this.float32[S+1]=f,this.float32[S+2]=m,this.float32[S+3]=w,i}}aa.prototype.bytesPerElement=16,re(aa,"StructArrayLayout4f16");class gu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P,L,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,a,f,m,w,S,D,P,L,F)}emplace(i,a,f,m,w,S,D,P,L,F,V){const j=10*i;return this.uint16[j+0]=a,this.uint16[j+1]=f,this.uint16[j+2]=m,this.uint16[j+3]=w,this.uint16[j+4]=S,this.uint16[j+5]=D,this.uint16[j+6]=P,this.uint16[j+7]=L,this.uint16[j+8]=F,this.uint16[j+9]=V,i}}gu.prototype.bytesPerElement=20,re(gu,"StructArrayLayout10ui20");class ya extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P){const L=this.length;return this.resize(L+1),this.emplace(L,i,a,f,m,w,S,D,P)}emplace(i,a,f,m,w,S,D,P,L){const F=8*i;return this.uint16[F+0]=a,this.uint16[F+1]=f,this.uint16[F+2]=m,this.uint16[F+3]=w,this.uint16[F+4]=S,this.uint16[F+5]=D,this.uint16[F+6]=P,this.uint16[F+7]=L,i}}ya.prototype.bytesPerElement=16,re(ya,"StructArrayLayout8ui16");class Wo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S){const D=this.length;return this.resize(D+1),this.emplace(D,i,a,f,m,w,S)}emplace(i,a,f,m,w,S,D){const P=6*i;return this.int16[P+0]=a,this.int16[P+1]=f,this.int16[P+2]=m,this.int16[P+3]=w,this.int16[P+4]=S,this.int16[P+5]=D,i}}Wo.prototype.bytesPerElement=12,re(Wo,"StructArrayLayout6i12");class Yo extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P,L,F,V,j){const H=this.length;return this.resize(H+1),this.emplace(H,i,a,f,m,w,S,D,P,L,F,V,j)}emplace(i,a,f,m,w,S,D,P,L,F,V,j,H){const X=12*i;return this.int16[X+0]=a,this.int16[X+1]=f,this.int16[X+2]=m,this.int16[X+3]=w,this.uint16[X+4]=S,this.uint16[X+5]=D,this.uint16[X+6]=P,this.uint16[X+7]=L,this.int16[X+8]=F,this.int16[X+9]=V,this.int16[X+10]=j,this.int16[X+11]=H,i}}Yo.prototype.bytesPerElement=24,re(Yo,"StructArrayLayout4i4ui4i24");class Ii extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S){const D=this.length;return this.resize(D+1),this.emplace(D,i,a,f,m,w,S)}emplace(i,a,f,m,w,S,D){const P=10*i,L=5*i;return this.int16[P+0]=a,this.int16[P+1]=f,this.int16[P+2]=m,this.float32[L+2]=w,this.float32[L+3]=S,this.float32[L+4]=D,i}}Ii.prototype.bytesPerElement=20,re(Ii,"StructArrayLayout3i3f20");class Us extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint32[1*i+0]=a,i}}Us.prototype.bytesPerElement=4,re(Us,"StructArrayLayout1ul4");class Ma extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P,L,F,V,j,H){const X=this.length;return this.resize(X+1),this.emplace(X,i,a,f,m,w,S,D,P,L,F,V,j,H)}emplace(i,a,f,m,w,S,D,P,L,F,V,j,H,X){const te=20*i,_e=10*i;return this.int16[te+0]=a,this.int16[te+1]=f,this.int16[te+2]=m,this.int16[te+3]=w,this.int16[te+4]=S,this.float32[_e+3]=D,this.float32[_e+4]=P,this.float32[_e+5]=L,this.float32[_e+6]=F,this.int16[te+14]=V,this.uint32[_e+8]=j,this.uint16[te+18]=H,this.uint16[te+19]=X,i}}Ma.prototype.bytesPerElement=40,re(Ma,"StructArrayLayout5i4f1i1ul2ui40");class So extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D){const P=this.length;return this.resize(P+1),this.emplace(P,i,a,f,m,w,S,D)}emplace(i,a,f,m,w,S,D,P){const L=8*i;return this.int16[L+0]=a,this.int16[L+1]=f,this.int16[L+2]=m,this.int16[L+4]=w,this.int16[L+5]=S,this.int16[L+6]=D,this.int16[L+7]=P,i}}So.prototype.bytesPerElement=16,re(So,"StructArrayLayout3i2i2i16");class Mu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,f,m,w)}emplace(i,a,f,m,w,S){const D=4*i,P=8*i;return this.float32[D+0]=a,this.float32[D+1]=f,this.float32[D+2]=m,this.int16[P+6]=w,this.int16[P+7]=S,i}}Mu.prototype.bytesPerElement=16,re(Mu,"StructArrayLayout2f1f2i16");class jc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=12*i,D=3*i;return this.uint8[S+0]=a,this.uint8[S+1]=f,this.float32[D+1]=m,this.float32[D+2]=w,i}}jc.prototype.bytesPerElement=12,re(jc,"StructArrayLayout2ub2f12");class rl extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.float32[w+0]=a,this.float32[w+1]=f,this.float32[w+2]=m,i}}rl.prototype.bytesPerElement=12,re(rl,"StructArrayLayout3f12");class Qa extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f){const m=this.length;return this.resize(m+1),this.emplace(m,i,a,f)}emplace(i,a,f,m){const w=3*i;return this.uint16[w+0]=a,this.uint16[w+1]=f,this.uint16[w+2]=m,i}}Qa.prototype.bytesPerElement=6,re(Qa,"StructArrayLayout3ui6");class ph extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt){const We=this.length;return this.resize(We+1),this.emplace(We,i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt)}emplace(i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt,We){const Mt=30*i,It=15*i,Ht=60*i;return this.int16[Mt+0]=a,this.int16[Mt+1]=f,this.int16[Mt+2]=m,this.float32[It+2]=w,this.float32[It+3]=S,this.uint16[Mt+8]=D,this.uint16[Mt+9]=P,this.uint32[It+5]=L,this.uint32[It+6]=F,this.uint32[It+7]=V,this.uint16[Mt+16]=j,this.uint16[Mt+17]=H,this.uint16[Mt+18]=X,this.float32[It+10]=te,this.float32[It+11]=_e,this.uint8[Ht+48]=Ue,this.uint8[Ht+49]=Xe,this.uint8[Ht+50]=Be,this.uint32[It+13]=Ze,this.int16[Mt+28]=rt,this.uint8[Ht+58]=We,i}}ph.prototype.bytesPerElement=60,re(ph,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gc extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt,We,Mt,It,Ht,ln,kt,Wt,Kt,rn){const cn=this.length;return this.resize(cn+1),this.emplace(cn,i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt,We,Mt,It,Ht,ln,kt,Wt,Kt,rn)}emplace(i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e,Ue,Xe,Be,Ze,rt,We,Mt,It,Ht,ln,kt,Wt,Kt,rn,cn){const jt=38*i,In=19*i;return this.int16[jt+0]=a,this.int16[jt+1]=f,this.int16[jt+2]=m,this.float32[In+2]=w,this.float32[In+3]=S,this.int16[jt+8]=D,this.int16[jt+9]=P,this.int16[jt+10]=L,this.int16[jt+11]=F,this.int16[jt+12]=V,this.int16[jt+13]=j,this.uint16[jt+14]=H,this.uint16[jt+15]=X,this.uint16[jt+16]=te,this.uint16[jt+17]=_e,this.uint16[jt+18]=Ue,this.uint16[jt+19]=Xe,this.uint16[jt+20]=Be,this.uint16[jt+21]=Ze,this.uint16[jt+22]=rt,this.uint16[jt+23]=We,this.uint16[jt+24]=Mt,this.uint16[jt+25]=It,this.uint16[jt+26]=Ht,this.uint16[jt+27]=ln,this.uint16[jt+28]=kt,this.uint32[In+15]=Wt,this.float32[In+16]=Kt,this.float32[In+17]=rn,this.float32[In+18]=cn,i}}Gc.prototype.bytesPerElement=76,re(Gc,"StructArrayLayout3i2f6i15ui1ul3f76");class ua extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.float32[1*i+0]=a,i}}ua.prototype.bytesPerElement=4,re(ua,"StructArrayLayout1f4");class eu extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a,f,m,w){const S=this.length;return this.resize(S+1),this.emplace(S,i,a,f,m,w)}emplace(i,a,f,m,w,S){const D=5*i;return this.float32[D+0]=a,this.float32[D+1]=f,this.float32[D+2]=m,this.float32[D+3]=w,this.float32[D+4]=S,i}}eu.prototype.bytesPerElement=20,re(eu,"StructArrayLayout5f20");class $c extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a,f,m){const w=this.length;return this.resize(w+1),this.emplace(w,i,a,f,m)}emplace(i,a,f,m,w){const S=6*i;return this.uint32[3*i+0]=a,this.uint16[S+2]=f,this.uint16[S+3]=m,this.uint16[S+4]=w,i}}$c.prototype.bytesPerElement=12,re($c,"StructArrayLayout1ul3ui12");class il extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.uint16[m+0]=a,this.uint16[m+1]=f,i}}il.prototype.bytesPerElement=4,re(il,"StructArrayLayout2ui4");class hd extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const a=this.length;return this.resize(a+1),this.emplace(a,i)}emplace(i,a){return this.uint16[1*i+0]=a,i}}hd.prototype.bytesPerElement=2,re(hd,"StructArrayLayout1ui2");class gh extends Xn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,a){const f=this.length;return this.resize(f+1),this.emplace(f,i,a)}emplace(i,a,f){const m=2*i;return this.float32[m+0]=a,this.float32[m+1]=f,i}}gh.prototype.bytesPerElement=8,re(gh,"StructArrayLayout2f8");class v0 extends ir{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}v0.prototype.size=12;class Lm extends Wo{get(i){return new v0(this,i)}}re(Lm,"FillExtrusionExtArray");class Zp extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zp.prototype.size=40;class Om extends Ma{get(i){return new Zp(this,i)}}re(Om,"CollisionBoxArray");class Nm extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(i){this._structArray.uint8[this._pos1+49]=i}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(i){this._structArray.uint8[this._pos1+50]=i}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(i){this._structArray.uint32[this._pos4+13]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(i){this._structArray.uint8[this._pos1+58]=i}}Nm.prototype.size=60;class tp extends ph{get(i){return new Nm(this,i)}}re(tp,"PlacedSymbolArray");class Pf extends ir{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(i){this._structArray.uint32[this._pos4+15]=i}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Pf.prototype.size=76;class Rf extends Gc{get(i){return new Pf(this,i)}}re(Rf,"SymbolInstanceArray");class Lf extends ua{getoffsetX(i){return this.float32[1*i+0]}}re(Lf,"GlyphOffsetArray");class km extends ao{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}re(km,"SymbolLineVertexArray");class Wp extends ir{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Wp.prototype.size=12;class Of extends $c{get(i){return new Wp(this,i)}}re(Of,"FeatureIndexArray");class kx extends ir{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}kx.prototype.size=4;class x0 extends il{get(i){return new kx(this,i)}}re(x0,"FillExtrusionCentroidArray");class Xr extends ir{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Xr.prototype.size=12;class Fx extends Wo{get(i){return new Xr(this,i)}}re(Fx,"CircleGlobeExtArray");const QC=bn([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),eS=bn([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var np={exports:{}},Ux=function(s,i){var a,f,m,w,S,D,P,L;for(f=s.length-(a=3&s.length),m=i,S=3432918353,D=461845907,L=0;L<f;)P=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,m=27492+(65535&(w=5*(65535&(m=(m^=P=(65535&(P=(P=(65535&P)*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*D+(((P>>>16)*D&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(P=0,a){case 3:P^=(255&s.charCodeAt(L+2))<<16;case 2:P^=(255&s.charCodeAt(L+1))<<8;case 1:m^=P=(65535&(P=(P=(65535&(P^=255&s.charCodeAt(L)))*S+(((P>>>16)*S&65535)<<16)&4294967295)<<15|P>>>17))*D+(((P>>>16)*D&65535)<<16)&4294967295}return m^=s.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0},rp=function(s,i){for(var a,f=s.length,m=i^f,w=0;f>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(w)|(255&s.charCodeAt(++w))<<8|(255&s.charCodeAt(++w))<<16|(255&s.charCodeAt(++w))<<24))+((1540483477*(a>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:m^=(255&s.charCodeAt(w+2))<<16;case 2:m^=(255&s.charCodeAt(w+1))<<8;case 1:m=1540483477*(65535&(m^=255&s.charCodeAt(w)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0};np.exports=Ux,np.exports.murmur3=Ux,np.exports.murmur2=rp;class Fm{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,a,f,m){this.ids.push(Vx(i)),this.positions.push(a,f,m)}getPositions(i){const a=Vx(i);let f=0,m=this.ids.length-1;for(;f<m;){const S=f+m>>1;this.ids[S]>=a?m=S:f=S+1}const w=[];for(;this.ids[f]===a;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(i,a){const f=new Float64Array(i.ids),m=new Uint32Array(i.positions);return _a(f,m,0,f.length-1),a&&a.push(f.buffer,m.buffer),{ids:f,positions:m}}static deserialize(i){const a=new Fm;return a.ids=i.ids,a.positions=i.positions,a.indexed=!0,a}}function Vx(s){const i=+s;return!isNaN(i)&&Number.MIN_SAFE_INTEGER<=i&&i<=Number.MAX_SAFE_INTEGER?i:np.exports(String(s))}function _a(s,i,a,f){for(;a<f;){const m=s[a+f>>1];let w=a-1,S=f+1;for(;;){do{w++}while(s[w]<m);do{S--}while(s[S]>m);if(w>=S)break;fd(s,w,S),fd(i,3*w,3*S),fd(i,3*w+1,3*S+1),fd(i,3*w+2,3*S+2)}S-a<f-S?(_a(s,i,a,S),a=S+1):(_a(s,i,S+1,f),f=S)}}function fd(s,i,a){const f=s[i];s[i]=s[a],s[a]=f}re(Fm,"FeaturePositionMap");class Cl{constructor(i){this.gl=i.gl,this.initialized=!1}fetchUniformLocation(i,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(i,a),this.initialized=!0),!!this.location}}class Yp extends Cl{constructor(i){super(i),this.current=0}set(i,a,f){this.fetchUniformLocation(i,a)&&this.current!==f&&(this.current=f,this.gl.uniform1f(this.location,f))}}class Sl extends Cl{constructor(i){super(i),this.current=[0,0,0,0]}set(i,a,f){this.fetchUniformLocation(i,a)&&(f[0]===this.current[0]&&f[1]===this.current[1]&&f[2]===this.current[2]&&f[3]===this.current[3]||(this.current=f,this.gl.uniform4f(this.location,f[0],f[1],f[2],f[3])))}}class Xh extends Cl{constructor(i){super(i),this.current=Ur.transparent}set(i,a,f){this.fetchUniformLocation(i,a)&&(f.r===this.current.r&&f.g===this.current.g&&f.b===this.current.b&&f.a===this.current.a||(this.current=f,this.gl.uniform4f(this.location,f.r,f.g,f.b,f.a)))}}const w0=new Float32Array(16),Kp=new Float32Array(9),ip=new Float32Array(4);function zm(s){return[Vn(255*s.r,255*s.g),Vn(255*s.b,255*s.a)]}class Jp{constructor(i,a,f){this.value=i,this.uniformNames=a.map(m=>`u_${m}`),this.type=f}setUniform(i,a,f,m,w){a.set(i,w,m.constantOr(this.value))}getBinding(i,a){return"color"===this.type?new Xh(i):new Yp(i)}}class dd{constructor(i,a){this.uniformNames=a.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=i.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=i.tl.concat(i.br)}setUniform(i,a,f,m,w){const S="u_pattern_to"===w||"u_dash_to"===w?this.patternTo:"u_pattern_from"===w||"u_dash_from"===w?this.patternFrom:"u_pixel_ratio_to"===w?this.pixelRatioTo:"u_pixel_ratio_from"===w?this.pixelRatioFrom:null;S&&a.set(i,w,S)}getBinding(i,a){return"u_pattern_from"===a||"u_pattern_to"===a||"u_dash_from"===a||"u_dash_to"===a?new Sl(i):new Yp(i)}}class Zh{constructor(i,a,f,m){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=a.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===f?2:1,offset:0})),this.paintVertexArray=new m}populatePaintArray(i,a,f,m,w,S){const D=this.paintVertexArray.length,P=this.expression.evaluate(new Ge(0),a,{},w,m,S);this.paintVertexArray.resize(i),this._setPaintValue(D,i,P)}updatePaintArray(i,a,f,m,w){const S=this.expression.evaluate({zoom:0},f,m,void 0,w);this._setPaintValue(i,a,S)}_setPaintValue(i,a,f){if("color"===this.type){const m=zm(f);for(let w=i;w<a;w++)this.paintVertexArray.emplace(w,m[0],m[1])}else{for(let m=i;m<a;m++)this.paintVertexArray.emplace(m,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Qs{constructor(i,a,f,m,w,S){this.expression=i,this.uniformNames=a.map(D=>`u_${D}_t`),this.type=f,this.useIntegerZoom=m,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=a.map(D=>({name:`a_${D}`,type:"Float32",components:"color"===f?4:2,offset:0})),this.paintVertexArray=new S}populatePaintArray(i,a,f,m,w,S){const D=this.expression.evaluate(new Ge(this.zoom),a,{},w,m,S),P=this.expression.evaluate(new Ge(this.zoom+1),a,{},w,m,S),L=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(L,i,D,P)}updatePaintArray(i,a,f,m,w){const S=this.expression.evaluate({zoom:this.zoom},f,m,void 0,w),D=this.expression.evaluate({zoom:this.zoom+1},f,m,void 0,w);this._setPaintValue(i,a,S,D)}_setPaintValue(i,a,f,m){if("color"===this.type){const w=zm(f),S=zm(m);for(let D=i;D<a;D++)this.paintVertexArray.emplace(D,w[0],w[1],S[0],S[1])}else{for(let w=i;w<a;w++)this.paintVertexArray.emplace(w,f,m);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(m))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,a,f,m,w){const S=this.useIntegerZoom?Math.floor(f.zoom):f.zoom,D=ue(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);a.set(i,w,D)}getBinding(i,a){return new Yp(i)}}class qc{constructor(i,a,f,m,w,S,D){this.expression=i,this.type=f,this.useIntegerZoom=m,this.zoom=w,this.layerId=D,this.paintVertexAttributes=("array"===f?eS:QC).members;for(let P=0;P<a.length;++P);this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(i,a,f){const m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(m,i,a.patterns&&a.patterns[this.layerId],f)}updatePaintArray(i,a,f,m,w,S){this._setPaintValues(i,a,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(i,a,f,m){if(!m||!f)return;const{min:w,mid:S,max:D}=f,P=m[w],L=m[S],F=m[D];if(P&&L&&F)for(let V=i;V<a;V++)this._setPaintValue(this.zoomInPaintVertexArray,V,L,P),this._setPaintValue(this.zoomOutPaintVertexArray,V,L,F)}_setPaintValue(i,a,f,m){i.emplace(a,f.tl[0],f.tl[1],f.br[0],f.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],f.pixelRatio,m.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Il{constructor(i,a,f=(()=>!0)){this.binders={},this._buffers=[];const m=[];for(const w in i.paint._values){if(!f(w))continue;const S=i.paint.get(w);if(!(S instanceof en&&Vu(S.property.specification)))continue;const D=jx(w,i.type),P=S.value,L=S.property.specification.type,F=S.property.useIntegerZoom,V=S.property.specification["property-type"],j="cross-faded"===V||"cross-faded-data-driven"===V,H="line-dasharray"===String(w)&&"constant"!==i.layout.get("line-cap").value.kind;if("constant"!==P.kind||H)if("source"===P.kind||H||j){const X=E0(w,L,"source");this.binders[w]=j?new qc(P,D,L,F,a,X,i.id):new Zh(P,D,L,X),m.push(`/a_${w}`)}else{const X=E0(w,L,"composite");this.binders[w]=new Qs(P,D,L,F,a,X),m.push(`/z_${w}`)}else this.binders[w]=j?new dd(P.value,D):new Jp(P.value,D,L),m.push(`/u_${w}`)}this.cacheKey=m.sort().join("")}getMaxValue(i){const a=this.binders[i];return a instanceof Zh||a instanceof Qs?a.maxValue:0}populatePaintArrays(i,a,f,m,w,S){for(const D in this.binders){const P=this.binders[D];(P instanceof Zh||P instanceof Qs||P instanceof qc)&&P.populatePaintArray(i,a,f,m,w,S)}}setConstantPatternPositions(i,a){for(const f in this.binders){const m=this.binders[f];m instanceof dd&&m.setConstantPatternPositions(i,a)}}updatePaintArrays(i,a,f,m,w,S){let D=!1;for(const P in i){const L=a.getPositions(P);for(const F of L){const V=f.feature(F.index);for(const j in this.binders){const H=this.binders[j];if((H instanceof Zh||H instanceof Qs||H instanceof qc)&&!0===H.expression.isStateDependent){const X=m.paint.get(j);H.expression=X.value,H.updatePaintArray(F.start,F.end,V,i[P],w,S),D=!0}}}}return D}defines(){const i=[];for(const a in this.binders){const f=this.binders[a];(f instanceof Jp||f instanceof dd)&&i.push(...f.uniformNames.map(m=>`#define HAS_UNIFORM_${m}`))}return i}getBinderAttributes(){const i=[];for(const a in this.binders){const f=this.binders[a];if(f instanceof Zh||f instanceof Qs||f instanceof qc)for(let m=0;m<f.paintVertexAttributes.length;m++)i.push(f.paintVertexAttributes[m].name)}return i}getBinderUniforms(){const i=[];for(const a in this.binders){const f=this.binders[a];if(f instanceof Jp||f instanceof dd||f instanceof Qs)for(const m of f.uniformNames)i.push(m)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i){const a=[];for(const f in this.binders){const m=this.binders[f];if(m instanceof Jp||m instanceof dd||m instanceof Qs)for(const w of m.uniformNames)a.push({name:w,property:f,binding:m.getBinding(i,w)})}return a}setUniforms(i,a,f,m,w){for(const{name:S,property:D,binding:P}of f)this.binders[D].setUniform(i,P,w,m.get(D),S)}updatePaintBuffers(i){this._buffers=[];for(const a in this.binders){const f=this.binders[a];if(i&&f instanceof qc){const m=2===i.fromScale?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(f instanceof Zh||f instanceof Qs)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const a in this.binders){const f=this.binders[a];(f instanceof Zh||f instanceof Qs||f instanceof qc)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const a=this.binders[i];(a instanceof Zh||a instanceof Qs||a instanceof qc)&&a.destroy()}}}class pd{constructor(i,a,f=(()=>!0)){this.programConfigurations={};for(const m of i)this.programConfigurations[m.id]=new Il(m,a,f);this.needsUpload=!1,this._featureMap=new Fm,this._bufferOffset=0}populatePaintArrays(i,a,f,m,w,S,D){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(i,a,m,w,S,D);void 0!==a.id&&this._featureMap.add(a.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,a,f,m,w){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(i,this._featureMap,a,S,m,w)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}const b0={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function jx(s,i){return b0[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}const Gx={"line-pattern":{source:gu,composite:gu},"fill-pattern":{source:gu,composite:gu},"fill-extrusion-pattern":{source:gu,composite:gu},"line-dasharray":{source:ya,composite:ya}},$x={color:{source:gh,composite:aa},number:{source:ua,composite:gh}};function E0(s,i,a){const f=Gx[s];return f&&f[a]||$x[i][a]}re(Jp,"ConstantBinder"),re(dd,"CrossFadedConstantBinder"),re(Zh,"SourceExpressionBinder"),re(qc,"CrossFadedCompositeBinder"),re(Qs,"CompositeExpressionBinder"),re(Il,"ProgramConfiguration",{omit:["_buffers"]}),re(pd,"ProgramConfigurationSet");const Qp="-transition";class wc extends fa{constructor(i,a){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==i.type&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,"background"!==i.type&&"sky"!==i.type&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),a.layout&&(this._unevaluatedLayout=new wt(a.layout)),a.paint)){this._transitionablePaint=new zt(a.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Jt(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return"visibility"===i?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,a,f={}){null!=a&&this._validate(y,`layers.${this.id}.layout.${i}`,i,a,f)||("visibility"!==i?this._unevaluatedLayout.setValue(i,a):this.visibility=a)}getPaintProperty(i){return Lt(i,Qp)?this._transitionablePaint.getTransition(i.slice(0,-Qp.length)):this._transitionablePaint.getValue(i)}setPaintProperty(i,a,f={}){if(null!=a&&this._validate(h,`layers.${this.id}.paint.${i}`,i,a,f))return!1;if(Lt(i,Qp))return this._transitionablePaint.setTransition(i.slice(0,-Qp.length),a||void 0),!1;{const m=this._transitionablePaint._values[i],w="cross-faded-data-driven"===m.property.specification["property-type"],S=m.value.isDataDriven(),D=m.value;this._transitionablePaint.setValue(i,a),this._handleSpecialPaintPropertyUpdate(i);const P=this._transitionablePaint._values[i].value;return P.isDataDriven()||S||w||this._handleOverridablePaintPropertyUpdate(i,D,P)}}_handleSpecialPaintPropertyUpdate(i){}getProgramIds(){return null}getProgramConfiguration(i){return null}_handleOverridablePaintPropertyUpdate(i,a,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||"none"===this.visibility}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,a){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,a)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Rn(i,(a,f)=>!(void 0===a||"layout"===f&&!Object.keys(a).length||"paint"===f&&!Object.keys(a).length))}_validate(i,a,f,m,w={}){return(!w||!1!==w.validate)&&T(this,i.call(u,{key:a,layerType:this.type,objectKey:f,value:m,styleSpec:Rt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const a=this.paint.get(i);if(a instanceof en&&Vu(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Vc(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Bm=bn([{name:"a_pos",components:2,type:"Int16"}],4),eg=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Vs{constructor(i=[]){this.segments=i}prepareSegment(i,a,f,m){let w=this.segments[this.segments.length-1];return i>Vs.MAX_VERTEX_ARRAY_LENGTH&&Sn(`Max vertices per segment is ${Vs.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!w||w.vertexLength+i>Vs.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==m)&&(w={vertexOffset:a.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},void 0!==m&&(w.sortKey=m),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const i of this.segments)for(const a in i.vaos)i.vaos[a].destroy()}static simpleSegment(i,a,f,m){return new Vs([{vertexOffset:i,primitiveOffset:a,vertexLength:f,primitiveLength:m,vaos:{},sortKey:0}])}}Vs.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,re(Vs,"SegmentVector");var cr=8192;class mh{constructor(i,a){i&&(a?this.setSouthWest(i).setNorthEast(a):4===i.length?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1]))}setNorthEast(i){return this._ne=i instanceof Ai?new Ai(i.lng,i.lat):Ai.convert(i),this}setSouthWest(i){return this._sw=i instanceof Ai?new Ai(i.lng,i.lat):Ai.convert(i),this}extend(i){const a=this._sw,f=this._ne;let m,w;if(i instanceof Ai)m=i,w=i;else{if(!(i instanceof mh))return Array.isArray(i)?4===i.length||i.every(Array.isArray)?this.extend(mh.convert(i)):this.extend(Ai.convert(i)):"object"==typeof i&&null!==i&&i.hasOwnProperty("lat")&&i.hasOwnProperty("lon")?this.extend(Ai.convert(i)):this;if(m=i._sw,w=i._ne,!m||!w)return this}return a||f?(a.lng=Math.min(m.lng,a.lng),a.lat=Math.min(m.lat,a.lat),f.lng=Math.max(w.lng,f.lng),f.lat=Math.max(w.lat,f.lat)):(this._sw=new Ai(m.lng,m.lat),this._ne=new Ai(w.lng,w.lat)),this}getCenter(){return new Ai((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Ai(this.getWest(),this.getNorth())}getSouthEast(){return new Ai(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:a,lat:f}=Ai.convert(i);let m=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return!i||i instanceof mh?i:new mh(i)}}const Wh=6371008.8;class Ai{constructor(i,a){if(isNaN(i)||isNaN(a))throw new Error(`Invalid LngLat object: (${i}, ${a})`);if(this.lng=+i,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ai(At(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const a=Math.PI/180,f=this.lat*a,m=i.lat*a,w=Math.sin(f)*Math.sin(m)+Math.cos(f)*Math.cos(m)*Math.cos((i.lng-this.lng)*a);return Wh*Math.acos(Math.min(w,1))}toBounds(i=0){const a=360*i/40075017,f=a/Math.cos(Math.PI/180*this.lat);return new mh(new Ai(this.lng-f,this.lat-a),new Ai(this.lng+f,this.lat+a))}static convert(i){if(i instanceof Ai)return i;if(Array.isArray(i)&&(2===i.length||3===i.length))return new Ai(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&"object"==typeof i&&null!==i)return new Ai(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Um=2*Math.PI*Wh;function Nf(s){return Um*Math.cos(s*Math.PI/180)}function Tl(s){return(180+s)/360}function bc(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Ql(s,i){return s/Nf(i)}function Dl(s){return 360*s-180}function ea(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function gd(s,i){return s*Nf(ea(i))}const Hc=85.051129;function qx(s){return 1/Math.cos(s*Math.PI/180)}class kf{constructor(i,a,f=0){this.x=+i,this.y=+a,this.z=+f}static fromLngLat(i,a=0){const f=Ai.convert(i);return new kf(Tl(f.lng),bc(f.lat),Ql(a,f.lat))}toLngLat(){return new Ai(Dl(this.x),ea(this.y))}toAltitude(){return gd(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Um*qx(ea(this.y))}}function Vm(s,i,a,f,m,w,S,D,P){const L=(i+f)/2,F=(a+m)/2,V=new Y(L,F);D(V),function(j,H,X,te,_e,Ue){const Xe=X-_e,Be=te-Ue;return Math.abs((te-H)*Xe-(X-j)*Be)/Math.hypot(Xe,Be)}(V.x,V.y,w.x,w.y,S.x,S.y)>=P?(Vm(s,i,a,L,F,w,V,D,P),Vm(s,L,F,f,m,V,S,D,P)):s.push(S)}function Hx(s,i,a){let f=s[0],m=f.x,w=f.y;i(f);const S=[f];for(let D=1;D<s.length;D++){const P=s[D],{x:L,y:F}=P;i(P),Vm(S,m,w,L,F,f,P,i,a),m=L,w=F,f=P}return S}function jm(s,i,a,f){if(f(i,a)){const m=i.add(a)._mult(.5);jm(s,i,m,f),jm(s,m,a,f)}else s.push(a)}function Xx(s,i){let a=s[0];const f=[a];for(let m=1;m<s.length;m++){const w=s[m];jm(f,a,w,i),a=w}return f}const Gm=Math.pow(2,14)-1,op=-Gm-1;function C0(s,i){const a=Math.round(s.x*i),f=Math.round(s.y*i);return s.x=ue(a,op,Gm),s.y=ue(f,op,Gm),(a<s.x||a>s.x+1||f<s.y||f>s.y+1)&&Sn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function yh(s,i,a){const f=s.loadGeometry(),m=s.extent,w=cr/m;if(i&&a&&a.projection.isReprojectedInTileSpace){const S=1<<i.z,{scale:D,x:P,y:L,projection:F}=a,V=j=>{const H=Dl((i.x+j.x/m)/S),X=ea((i.y+j.y/m)/S),te=F.project(H,X);j.x=(te.x*D-P)*m,j.y=(te.y*D-L)*m};for(let j=0;j<f.length;j++)if(1!==s.type)f[j]=Hx(f[j],V,1);else{const H=[];for(const X of f[j])X.x<0||X.x>=m||X.y<0||X.y>=m||(V(X),H.push(X));f[j]=H}}for(const S of f)for(const D of S)C0(D,w);return f}function Yh(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?yh(s):[]}}function $m(s,i,a,f,m){s.emplaceBack(2*i+(f+1)/2,2*a+(m+1)/2)}function sp(s,i,a){s.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class S0{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.projection=i.projection,this.layoutVertexArray=new Fr,this.indexArray=new Qa,this.segments=new Vs,this.programConfigurations=new pd(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,f,m){const w=this.layers[0],S=[];let D=null;"circle"===w.type&&(D=w.layout.get("circle-sort-key"));for(const{feature:L,id:F,index:V,sourceLayerIndex:j}of i){const H=this.layers[0]._featureFilter.needGeometry,X=Yh(L,H);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),X,f))continue;const te=D?D.evaluate(X,{},f):void 0,_e={id:F,properties:L.properties,type:L.type,sourceLayerIndex:j,index:V,geometry:H?X.geometry:yh(L,f,m),patterns:{},sortKey:te};S.push(_e)}D&&S.sort((L,F)=>L.sortKey-F.sortKey);let P=null;"globe"===m.projection.name&&(this.globeExtVertexArray=new Fx,P=m.projection);for(const L of S){const{geometry:F,index:V,sourceLayerIndex:j}=L,H=i[V].feature;this.addFeature(L,F,V,a.availableImages,f,P),a.featureIndex.insert(H,F,V,j,this.index)}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Bm.members),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,eg.members))),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(i,a,f,m,w,S){for(const D of a)for(const P of D){const L=P.x,F=P.y;if(L<0||L>=cr||F<0||F>=cr)continue;if(S){const H=S.projectTilePoint(L,F,w),X=S.upVector(w,L,F),te=this.globeExtVertexArray;sp(te,H,X),sp(te,H,X),sp(te,H,X),sp(te,H,X)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=V.vertexLength;$m(this.layoutVertexArray,L,F,-1,-1),$m(this.layoutVertexArray,L,F,1,-1),$m(this.layoutVertexArray,L,F,1,1),$m(this.layoutVertexArray,L,F,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+2,j+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},m,w)}}function I0(s,i){for(let a=0;a<s.length;a++)if(md(i,s[a]))return!0;for(let a=0;a<i.length;a++)if(md(s,i[a]))return!0;return!!T0(s,i)}function Zx(s,i,a){return!!md(s,i)||!!D0(i,s,a)}function tg(s,i){if(1===s.length)return Yx(i,s[0]);for(let a=0;a<i.length;a++){const f=i[a];for(let m=0;m<f.length;m++)if(md(s,f[m]))return!0}for(let a=0;a<s.length;a++)if(Yx(i,s[a]))return!0;for(let a=0;a<i.length;a++)if(T0(s,i[a]))return!0;return!1}function tS(s,i,a){if(s.length>1){if(T0(s,i))return!0;for(let f=0;f<i.length;f++)if(D0(i[f],s,a))return!0}for(let f=0;f<s.length;f++)if(D0(s[f],i,a))return!0;return!1}function T0(s,i){if(0===s.length||0===i.length)return!1;for(let a=0;a<s.length-1;a++){const f=s[a],m=s[a+1];for(let w=0;w<i.length-1;w++)if(qm(f,m,i[w],i[w+1]))return!0}return!1}function qm(s,i,a,f){return hn(s,a,f)!==hn(i,a,f)&&hn(s,i,a)!==hn(s,i,f)}function D0(s,i,a){const f=a*a;if(1===i.length)return s.distSqr(i[0])<f;for(let m=1;m<i.length;m++)if(Wx(s,i[m-1],i[m])<f)return!0;return!1}function Wx(s,i,a){const f=i.distSqr(a);if(0===f)return s.distSqr(i);const m=((s.x-i.x)*(a.x-i.x)+(s.y-i.y)*(a.y-i.y))/f;return s.distSqr(m<0?i:m>1?a:a.sub(i)._mult(m)._add(i))}function Yx(s,i){let a,f,m,w=!1;for(let S=0;S<s.length;S++){a=s[S];for(let D=0,P=a.length-1;D<a.length;P=D++)f=a[D],m=a[P],f.y>i.y!=m.y>i.y&&i.x<(m.x-f.x)*(i.y-f.y)/(m.y-f.y)+f.x&&(w=!w)}return w}function md(s,i){let a=!1;for(let f=0,m=s.length-1;f<s.length;m=f++){const w=s[f],S=s[m];w.y>i.y!=S.y>i.y&&i.x<(S.x-w.x)*(i.y-w.y)/(S.y-w.y)+w.x&&(a=!a)}return a}function Kx(s,i,a,f,m){for(const S of s)if(i<=S.x&&a<=S.y&&f>=S.x&&m>=S.y)return!0;const w=[new Y(i,a),new Y(i,m),new Y(f,m),new Y(f,a)];if(s.length>2)for(const S of w)if(md(s,S))return!0;for(let S=0;S<s.length-1;S++)if(Jx(s[S],s[S+1],w))return!0;return!1}function Jx(s,i,a){const f=a[0],m=a[2];if(s.x<f.x&&i.x<f.x||s.x>m.x&&i.x>m.x||s.y<f.y&&i.y<f.y||s.y>m.y&&i.y>m.y)return!1;const w=hn(s,i,a[0]);return w!==hn(s,i,a[1])||w!==hn(s,i,a[2])||w!==hn(s,i,a[3])}function Ff(s,i,a){const f=i.paint.get(s).value;return"constant"===f.kind?f.value:a.programConfigurations.get(i.id).getMaxValue(s)}function yd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Hm(s,i,a,f,m){if(!i[0]&&!i[1])return s;const w=Y.convert(i)._mult(m);"viewport"===a&&w._rotate(-f);const S=[];for(let D=0;D<s.length;D++)S.push(s[D].sub(w));return S}function Xm(s,i,a,f){const m=Y.convert(s)._mult(f);return"viewport"===i&&m._rotate(-a),m}re(S0,"CircleBucket",{omit:["layers"]});const M0=new wn({"circle-sort-key":new mt(Rt.layout_circle["circle-sort-key"])});var ol={paint:new wn({"circle-radius":new mt(Rt.paint_circle["circle-radius"]),"circle-color":new mt(Rt.paint_circle["circle-color"]),"circle-blur":new mt(Rt.paint_circle["circle-blur"]),"circle-opacity":new mt(Rt.paint_circle["circle-opacity"]),"circle-translate":new Dt(Rt.paint_circle["circle-translate"]),"circle-translate-anchor":new Dt(Rt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dt(Rt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dt(Rt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new mt(Rt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new mt(Rt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new mt(Rt.paint_circle["circle-stroke-opacity"])}),layout:M0},ng=1e-6,sl=typeof Float32Array<"u"?Float32Array:Array;function A0(){var s=new sl(9);return sl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function Zm(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3],D=i[4],P=i[5],L=i[6],F=i[7],V=i[8],j=a[0],H=a[1],X=a[2],te=a[3],_e=a[4],Ue=a[5],Xe=a[6],Be=a[7],Ze=a[8];return s[0]=j*f+H*S+X*L,s[1]=j*m+H*D+X*F,s[2]=j*w+H*P+X*V,s[3]=te*f+_e*S+Ue*L,s[4]=te*m+_e*D+Ue*F,s[5]=te*w+_e*P+Ue*V,s[6]=Xe*f+Be*S+Ze*L,s[7]=Xe*m+Be*D+Ze*F,s[8]=Xe*w+Be*P+Ze*V,s}function ec(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Wm(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=i[4],D=i[5],P=i[6],L=i[7],F=i[8],V=i[9],j=i[10],H=i[11],X=i[12],te=i[13],_e=i[14],Ue=i[15],Xe=a*D-f*S,Be=a*P-m*S,Ze=a*L-w*S,rt=f*P-m*D,We=f*L-w*D,Mt=m*L-w*P,It=F*te-V*X,Ht=F*_e-j*X,ln=F*Ue-H*X,kt=V*_e-j*te,Wt=V*Ue-H*te,Kt=j*Ue-H*_e,rn=Xe*Kt-Be*Wt+Ze*kt+rt*ln-We*Ht+Mt*It;return rn?(s[0]=(D*Kt-P*Wt+L*kt)*(rn=1/rn),s[1]=(m*Wt-f*Kt-w*kt)*rn,s[2]=(te*Mt-_e*We+Ue*rt)*rn,s[3]=(j*We-V*Mt-H*rt)*rn,s[4]=(P*ln-S*Kt-L*Ht)*rn,s[5]=(a*Kt-m*ln+w*Ht)*rn,s[6]=(_e*Ze-X*Mt-Ue*Be)*rn,s[7]=(F*Mt-j*Ze+H*Be)*rn,s[8]=(S*Wt-D*ln+L*It)*rn,s[9]=(f*ln-a*Wt-w*It)*rn,s[10]=(X*We-te*Ze+Ue*Xe)*rn,s[11]=(V*Ze-F*We-H*Xe)*rn,s[12]=(D*Ht-S*kt-P*It)*rn,s[13]=(a*kt-f*Ht+m*It)*rn,s[14]=(te*Be-X*rt-_e*Xe)*rn,s[15]=(F*rt-V*Be+j*Xe)*rn,s):null}function _d(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3],D=i[4],P=i[5],L=i[6],F=i[7],V=i[8],j=i[9],H=i[10],X=i[11],te=i[12],_e=i[13],Ue=i[14],Xe=i[15],Be=a[0],Ze=a[1],rt=a[2],We=a[3];return s[0]=Be*f+Ze*D+rt*V+We*te,s[1]=Be*m+Ze*P+rt*j+We*_e,s[2]=Be*w+Ze*L+rt*H+We*Ue,s[3]=Be*S+Ze*F+rt*X+We*Xe,s[4]=(Be=a[4])*f+(Ze=a[5])*D+(rt=a[6])*V+(We=a[7])*te,s[5]=Be*m+Ze*P+rt*j+We*_e,s[6]=Be*w+Ze*L+rt*H+We*Ue,s[7]=Be*S+Ze*F+rt*X+We*Xe,s[8]=(Be=a[8])*f+(Ze=a[9])*D+(rt=a[10])*V+(We=a[11])*te,s[9]=Be*m+Ze*P+rt*j+We*_e,s[10]=Be*w+Ze*L+rt*H+We*Ue,s[11]=Be*S+Ze*F+rt*X+We*Xe,s[12]=(Be=a[12])*f+(Ze=a[13])*D+(rt=a[14])*V+(We=a[15])*te,s[13]=Be*m+Ze*P+rt*j+We*_e,s[14]=Be*w+Ze*L+rt*H+We*Ue,s[15]=Be*S+Ze*F+rt*X+We*Xe,s}function ap(s,i,a){var f,m,w,S,D,P,L,F,V,j,H,X,te=a[0],_e=a[1],Ue=a[2];return i===s?(s[12]=i[0]*te+i[4]*_e+i[8]*Ue+i[12],s[13]=i[1]*te+i[5]*_e+i[9]*Ue+i[13],s[14]=i[2]*te+i[6]*_e+i[10]*Ue+i[14],s[15]=i[3]*te+i[7]*_e+i[11]*Ue+i[15]):(m=i[1],w=i[2],S=i[3],D=i[4],P=i[5],L=i[6],F=i[7],V=i[8],j=i[9],H=i[10],X=i[11],s[0]=f=i[0],s[1]=m,s[2]=w,s[3]=S,s[4]=D,s[5]=P,s[6]=L,s[7]=F,s[8]=V,s[9]=j,s[10]=H,s[11]=X,s[12]=f*te+D*_e+V*Ue+i[12],s[13]=m*te+P*_e+j*Ue+i[13],s[14]=w*te+L*_e+H*Ue+i[14],s[15]=S*te+F*_e+X*Ue+i[15]),s}function Kh(s,i,a){var f=a[0],m=a[1],w=a[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*m,s[5]=i[5]*m,s[6]=i[6]*m,s[7]=i[7]*m,s[8]=i[8]*w,s[9]=i[9]*w,s[10]=i[10]*w,s[11]=i[11]*w,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s}function Ym(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[4],S=i[5],D=i[6],P=i[7],L=i[8],F=i[9],V=i[10],j=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=w*m+L*f,s[5]=S*m+F*f,s[6]=D*m+V*f,s[7]=P*m+j*f,s[8]=L*m-w*f,s[9]=F*m-S*f,s[10]=V*m-D*f,s[11]=j*m-P*f,s}function rg(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[0],S=i[1],D=i[2],P=i[3],L=i[8],F=i[9],V=i[10],j=i[11];return i!==s&&(s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m-L*f,s[1]=S*m-F*f,s[2]=D*m-V*f,s[3]=P*m-j*f,s[8]=w*f+L*m,s[9]=S*f+F*m,s[10]=D*f+V*m,s[11]=P*f+j*m,s}function qu(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ig(s,i,a){var f,m,w,S=a[0],D=a[1],P=a[2],L=Math.hypot(S,D,P);return L<ng?null:(S*=L=1/L,D*=L,P*=L,f=Math.sin(i),m=Math.cos(i),s[0]=S*S*(w=1-m)+m,s[1]=D*S*w+P*f,s[2]=P*S*w-D*f,s[3]=0,s[4]=S*D*w-P*f,s[5]=D*D*w+m,s[6]=P*D*w+S*f,s[7]=0,s[8]=S*P*w+D*f,s[9]=D*P*w-S*f,s[10]=P*P*w+m,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var P0=_d;function up(){var s=new sl(3);return sl!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function mu(s){var i=new sl(3);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i}function _h(s){return Math.hypot(s[0],s[1],s[2])}function zf(s,i,a){var f=new sl(3);return f[0]=s,f[1]=i,f[2]=a,f}function Xc(s,i,a){return s[0]=i[0]+a[0],s[1]=i[1]+a[1],s[2]=i[2]+a[2],s}function Km(s,i,a){return s[0]=i[0]-a[0],s[1]=i[1]-a[1],s[2]=i[2]-a[2],s}function Jm(s,i,a){return s[0]=i[0]*a[0],s[1]=i[1]*a[1],s[2]=i[2]*a[2],s}function lp(s,i,a){return s[0]=Math.min(i[0],a[0]),s[1]=Math.min(i[1],a[1]),s[2]=Math.min(i[2],a[2]),s}function vd(s,i,a){return s[0]=Math.max(i[0],a[0]),s[1]=Math.max(i[1],a[1]),s[2]=Math.max(i[2],a[2]),s}function Ml(s,i,a){return s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s}function xd(s,i,a,f){return s[0]=i[0]+a[0]*f,s[1]=i[1]+a[1]*f,s[2]=i[2]+a[2]*f,s}function Au(s,i){var a=i[0],f=i[1],m=i[2],w=a*a+f*f+m*m;return w>0&&(w=1/Math.sqrt(w)),s[0]=i[0]*w,s[1]=i[1]*w,s[2]=i[2]*w,s}function tc(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]}function cp(s,i,a){var f=i[0],m=i[1],w=i[2],S=a[0],D=a[1],P=a[2];return s[0]=m*P-w*D,s[1]=w*S-f*P,s[2]=f*D-m*S,s}function js(s,i,a){var f=i[0],m=i[1],w=i[2],S=a[3]*f+a[7]*m+a[11]*w+a[15];return s[0]=(a[0]*f+a[4]*m+a[8]*w+a[12])/(S=S||1),s[1]=(a[1]*f+a[5]*m+a[9]*w+a[13])/S,s[2]=(a[2]*f+a[6]*m+a[10]*w+a[14])/S,s}function R0(s,i,a){var f=a[0],m=a[1],w=a[2],S=i[0],D=i[1],P=i[2],L=m*P-w*D,F=w*S-f*P,V=f*D-m*S,j=m*V-w*F,H=w*L-f*V,X=f*F-m*L,te=2*a[3];return F*=te,V*=te,H*=2,X*=2,s[0]=S+(L*=te)+(j*=2),s[1]=D+F+H,s[2]=P+V+X,s}var vh,Ec=Km,Qx=Jm,Qm=_h;function og(s,i,a){return s[0]=i[0]*a,s[1]=i[1]*a,s[2]=i[2]*a,s[3]=i[3]*a,s}function ey(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=a*a+f*f+m*m+w*w;return S>0&&(S=1/Math.sqrt(S)),s[0]=a*S,s[1]=f*S,s[2]=m*S,s[3]=w*S,s}function nc(s,i,a){var f=i[0],m=i[1],w=i[2],S=i[3];return s[0]=a[0]*f+a[4]*m+a[8]*w+a[12]*S,s[1]=a[1]*f+a[5]*m+a[9]*w+a[13]*S,s[2]=a[2]*f+a[6]*m+a[10]*w+a[14]*S,s[3]=a[3]*f+a[7]*m+a[11]*w+a[15]*S,s}function sg(){var s=new sl(4);return sl!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function ty(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function L0(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],D=Math.sin(a),P=Math.cos(a);return s[0]=f*P+S*D,s[1]=m*P+w*D,s[2]=w*P-m*D,s[3]=S*P-f*D,s}function ag(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],D=Math.sin(a),P=Math.cos(a);return s[0]=f*P-w*D,s[1]=m*P+S*D,s[2]=w*P+f*D,s[3]=S*P-m*D,s}up(),vh=new sl(4),sl!=Float32Array&&(vh[0]=0,vh[1]=0,vh[2]=0,vh[3]=0);var ew=ey;up(),zf(1,0,0),zf(0,1,0),sg(),sg(),A0();class ny{constructor(i,a){this.pos=i,this.dir=a}intersectsPlane(i,a,f){const m=tc(a,this.dir);if(Math.abs(m)<1e-6)return!1;const w=((i[0]-this.pos[0])*a[0]+(i[1]-this.pos[1])*a[1]+(i[2]-this.pos[2])*a[2])/m;return f[0]=this.pos[0]+this.dir[0]*w,f[1]=this.pos[1]+this.dir[1]*w,f[2]=this.pos[2]+this.dir[2]*w,!0}closestPointOnSphere(i,a,f){if(te=(H=this.pos)[0],_e=H[1],Ue=H[2],Xe=(X=i)[0],Be=X[1],Ze=X[2],Math.abs(te-Xe)<=ng*Math.max(1,Math.abs(te),Math.abs(Xe))&&Math.abs(_e-Be)<=ng*Math.max(1,Math.abs(_e),Math.abs(Be))&&Math.abs(Ue-Ze)<=ng*Math.max(1,Math.abs(Ue),Math.abs(Ze))||0===a)return f[0]=f[1]=f[2]=0,!1;var H,X,te,_e,Ue,Xe,Be,Ze;const[m,w,S]=this.dir,D=this.pos[0]-i[0],P=this.pos[1]-i[1],L=this.pos[2]-i[2],F=m*m+w*w+S*S,V=2*(D*m+P*w+L*S),j=V*V-4*F*(D*D+P*P+L*L-a*a);if(j<0){const H=Math.max(-V/2,0),X=D+m*H,te=P+w*H,_e=L+S*H,Ue=Math.hypot(X,te,_e);return f[0]=X*a/Ue,f[1]=te*a/Ue,f[2]=_e*a/Ue,!1}{const H=(-V-Math.sqrt(j))/(2*F);if(H<0){const X=Math.hypot(D,P,L);return f[0]=D*a/X,f[1]=P*a/X,f[2]=L*a/X,!1}return f[0]=D+m*H,f[1]=P+w*H,f[2]=L+S*H,!0}}}class ry{constructor(i,a,f,m,w){this.TL=i,this.TR=a,this.BR=f,this.BL=m,this.horizon=w}static fromInvProjectionMatrix(i,a,f){const m=[-1,1,1],w=[1,1,1],S=[1,-1,1],D=[-1,-1,1],P=js(m,m,i),L=js(w,w,i),F=js(S,S,i),V=js(D,D,i);return new ry(P,L,F,V,a/f)}}class iy{constructor(i,a){this.points=i,this.planes=a}static fromInvProjectionMatrix(i,a,f,m){const w=Math.pow(2,f),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const L=nc([],P,i),F=1/L[3]/a*w;return(V=L)[0]=(j=L)[0]*(H=[F,F,m?1/L[3]:F,F])[0],V[1]=j[1]*H[1],V[2]=j[2]*H[2],V[3]=j[3]*H[3],V;var V,j,H}),D=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const L=Au([],cp([],Ec([],S[P[0]],S[P[1]]),Ec([],S[P[2]],S[P[1]]))),F=-tc(L,S[P[1]]);return L.concat(F)});return new iy(S,D)}}class Pu{static fromPoints(i){const a=[1/0,1/0,1/0],f=[-1/0,-1/0,-1/0];for(const m of i)lp(a,a,m),vd(f,f,m);return new Pu(a,f)}static applyTransform(i,a){const f=i.getCorners();for(let m=0;m<f.length;++m)js(f[m],f[m],a);return Pu.fromPoints(f)}constructor(i,a){this.min=i,this.max=a,this.center=Ml([],Xc([],this.min,this.max),.5)}quadrant(i){const a=[i%2==0,i<2],f=mu(this.min),m=mu(this.max);for(let w=0;w<a.length;w++)f[w]=a[w]?this.min[w]:this.center[w],m[w]=a[w]?this.center[w]:this.max[w];return m[2]=this.max[2],new Pu(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}distanceZ(i){return Math.max(Math.min(this.max[2],i[2]),this.min[2])-i[2]}getCorners(){const i=this.min,a=this.max;return[[i[0],i[1],i[2]],[a[0],i[1],i[2]],[a[0],a[1],i[2]],[i[0],a[1],i[2]],[i[0],i[1],a[2]],[a[0],i[1],a[2]],[a[0],a[1],a[2]],[i[0],a[1],a[2]]]}intersects(i){const a=this.getCorners();let f=!0;for(let m=0;m<i.planes.length;m++){const w=i.planes[m];let S=0;for(let D=0;D<a.length;D++)S+=tc(w,a[D])+w[3]>=0;if(0===S)return 0;S!==a.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let w=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let D=0;D<i.points.length;D++){const P=i.points[D][m]-this.min[m];w=Math.min(w,P),S=Math.max(S,P)}if(S<0||w>this.max[m]-this.min[m])return 0}return 1}}function O0(s,i,a,f,m,w,S,D,P){if(w&&s.queryGeometry.isAboveHorizon)return!1;w&&(P*=s.pixelToTileUnitsFactor);const L=s.tileID.canonical,F=a.projection.upVectorScale(L,a.center.lat,a.worldSize).metersToTile;for(const V of i)for(const j of V){const H=j.add(D),X=m&&a.elevation?a.elevation.exaggeration()*m.getElevationAt(H.x,H.y,!0):0,te=a.projection.projectTilePoint(H.x,H.y,L);if(X>0){const Be=a.projection.upVector(L,H.x,H.y);te.x+=Be[0]*F*X,te.y+=Be[1]*F*X,te.z+=Be[2]*F*X}const _e=w?H:N0(te.x,te.y,te.z,f),Ue=w?s.tilespaceRays.map(Be=>oy(Be,X)):s.queryGeometry.screenGeometry,Xe=nc([],[te.x,te.y,te.z,1],f);if(!S&&w?P*=Xe[3]/a.cameraToCenterDistance:S&&!w&&(P*=a.cameraToCenterDistance/Xe[3]),w){const Be=ea((j.y/cr+L.y)/(1<<L.z));P/=a.projection.pixelsPerMeter(Be,1)/Ql(1,Be)}if(Zx(Ue,_e,P))return!0}return!1}function N0(s,i,a,f){const m=nc([],[s,i,a,1],f);return new Y(m[0]/m[3],m[1]/m[3])}const ug=zf(0,0,0),k0=zf(0,0,1);function oy(s,i){const a=up();return ug[2]=i,s.intersectsPlane(ug,k0,a),new Y(a[0],a[1])}class F0 extends S0{}function z0(s,{width:i,height:a},f,m){if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==i*a*f)throw new RangeError("mismatched image size")}else m=new Uint8Array(i*a*f);return s.width=i,s.height=a,s.data=m,s}function sy(s,i,a){const{width:f,height:m}=i;f===s.width&&m===s.height||(lg(s,i,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,f),height:Math.min(s.height,m)},a),s.width=f,s.height=m,s.data=i.data)}function lg(s,i,a,f,m,w){if(0===m.width||0===m.height)return i;if(m.width>s.width||m.height>s.height||a.x>s.width-m.width||a.y>s.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>i.width||m.height>i.height||f.x>i.width-m.width||f.y>i.height-m.height)throw new RangeError("out of range destination coordinates for image copy");const S=s.data,D=i.data;for(let P=0;P<m.height;P++){const L=((a.y+P)*s.width+a.x)*w,F=((f.y+P)*i.width+f.x)*w;for(let V=0;V<m.width*w;V++)D[F+V]=S[L+V]}return i}re(F0,"HeatmapBucket",{omit:["layers"]});class Hu{constructor(i,a){z0(this,i,1,a)}resize(i){sy(this,new Hu(i),1)}clone(){return new Hu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,f,m,w){lg(i,a,f,m,w,1)}}class Xu{constructor(i,a){z0(this,i,4,a)}resize(i){sy(this,new Xu(i),4)}replace(i,a){a?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,a,f,m,w){lg(i,a,f,m,w,4)}}re(Hu,"AlphaImage"),re(Xu,"RGBAImage");var B0={paint:new wn({"heatmap-radius":new mt(Rt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new mt(Rt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dt(Rt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cn(Rt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dt(Rt.paint_heatmap["heatmap-opacity"])})};function ay(s){const i={},a=s.resolution||256,f=s.clips?s.clips.length:1,m=s.image||new Xu({width:a,height:f}),w=(S,D,P)=>{i[s.evaluationKey]=P;const L=s.expression.evaluate(i);m.data[S+D+0]=Math.floor(255*L.r/L.a),m.data[S+D+1]=Math.floor(255*L.g/L.a),m.data[S+D+2]=Math.floor(255*L.b/L.a),m.data[S+D+3]=Math.floor(255*L.a)};if(s.clips)for(let S=0,D=0;S<f;++S,D+=4*a)for(let P=0,L=0;P<a;P++,L+=4){const F=P/(a-1),{start:V,end:j}=s.clips[S];w(D,L,V*(1-F)+j*F)}else for(let S=0,D=0;S<a;S++,D+=4)w(0,D,S/(a-1));return m}var nS={paint:new wn({"hillshade-illumination-direction":new Dt(Rt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dt(Rt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dt(Rt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dt(Rt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dt(Rt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dt(Rt.paint_hillshade["hillshade-accent-color"])})};const cg=bn([{name:"a_pos",components:2,type:"Int16"}],4),{members:tw}=cg;var wd={exports:{}};function hp(s,i,a){a=a||2;var f,m,w,S,D,P,L,F=i&&i.length,V=F?i[0]*a:s.length,j=uy(s,0,V,a,!0),H=[];if(!j||j.next===j.prev)return H;if(F&&(j=function(te,_e,Ue,Xe){var Be,Ze,rt,We=[];for(Be=0,Ze=_e.length;Be<Ze;Be++)(rt=uy(te,_e[Be]*Xe,Be<Ze-1?_e[Be+1]*Xe:te.length,Xe,!1))===rt.next&&(rt.steiner=!0),We.push(V0(rt));for(We.sort(cy),Be=0;Be<We.length;Be++)Ue=hy(We[Be],Ue);return Ue}(s,i,j,a)),s.length>80*a){f=w=s[0],m=S=s[1];for(var X=a;X<V;X+=a)(D=s[X])<f&&(f=D),(P=s[X+1])<m&&(m=P),D>w&&(w=D),P>S&&(S=P);L=0!==(L=Math.max(w-f,S-m))?32767/L:0}return bd(j,H,a,f,m,L,0),H}function uy(s,i,a,f,m){var w,S;if(m===pp(s,i,a,f)>0)for(w=i;w<a;w+=f)S=G0(w,s[w],s[w+1],S);else for(w=a-f;w>=i;w-=f)S=G0(w,s[w],s[w+1],S);return S&&dp(S,S.next)&&(dg(S),S=S.next),S}function xh(s,i){if(!s)return s;i||(i=s);var a,f=s;do{if(a=!1,f.steiner||!dp(f,f.next)&&0!==ta(f.prev,f,f.next))f=f.next;else{if(dg(f),(f=i=f.prev)===f.next)break;a=!0}}while(a||f!==i);return i}function bd(s,i,a,f,m,w,S){if(s){!S&&w&&function(F,V,j,H){var X=F;do{0===X.z&&(X.z=fy(X.x,X.y,V,j,H)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next}while(X!==F);X.prevZ.nextZ=null,X.prevZ=null,function(te){var _e,Ue,Xe,Be,Ze,rt,We,Mt,It=1;do{for(Ue=te,te=null,Ze=null,rt=0;Ue;){for(rt++,Xe=Ue,We=0,_e=0;_e<It&&(We++,Xe=Xe.nextZ);_e++);for(Mt=It;We>0||Mt>0&&Xe;)0!==We&&(0===Mt||!Xe||Ue.z<=Xe.z)?(Be=Ue,Ue=Ue.nextZ,We--):(Be=Xe,Xe=Xe.nextZ,Mt--),Ze?Ze.nextZ=Be:te=Be,Be.prevZ=Ze,Ze=Be;Ue=Xe}Ze.nextZ=null,It*=2}while(rt>1)}(X)}(s,f,m,w);for(var D,P,L=s;s.prev!==s.next;)if(D=s.prev,P=s.next,w?fg(s,f,m,w):hg(s))i.push(D.i/a|0),i.push(s.i/a|0),i.push(P.i/a|0),dg(s),s=P.next,L=P.next;else if((s=P)===L){S?1===S?bd(s=U0(xh(s),i,a),i,a,f,m,w,2):2===S&&ly(s,i,a,f,m,w):bd(xh(s),i,a,f,m,w,1);break}}}function hg(s){var i=s.prev,a=s,f=s.next;if(ta(i,a,f)>=0)return!1;for(var m=i.x,w=a.x,S=f.x,D=i.y,P=a.y,L=f.y,F=m<w?m<S?m:S:w<S?w:S,V=D<P?D<L?D:L:P<L?P:L,j=m>w?m>S?m:S:w>S?w:S,H=D>P?D>L?D:L:P>L?P:L,X=f.next;X!==i;){if(X.x>=F&&X.x<=j&&X.y>=V&&X.y<=H&&Ed(m,D,w,P,S,L,X.x,X.y)&&ta(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function fg(s,i,a,f){var m=s.prev,w=s,S=s.next;if(ta(m,w,S)>=0)return!1;for(var D=m.x,P=w.x,L=S.x,F=m.y,V=w.y,j=S.y,H=D<P?D<L?D:L:P<L?P:L,X=F<V?F<j?F:j:V<j?V:j,te=D>P?D>L?D:L:P>L?P:L,_e=F>V?F>j?F:j:V>j?V:j,Ue=fy(H,X,i,a,f),Xe=fy(te,_e,i,a,f),Be=s.prevZ,Ze=s.nextZ;Be&&Be.z>=Ue&&Ze&&Ze.z<=Xe;){if(Be.x>=H&&Be.x<=te&&Be.y>=X&&Be.y<=_e&&Be!==m&&Be!==S&&Ed(D,F,P,V,L,j,Be.x,Be.y)&&ta(Be.prev,Be,Be.next)>=0||(Be=Be.prevZ,Ze.x>=H&&Ze.x<=te&&Ze.y>=X&&Ze.y<=_e&&Ze!==m&&Ze!==S&&Ed(D,F,P,V,L,j,Ze.x,Ze.y)&&ta(Ze.prev,Ze,Ze.next)>=0))return!1;Ze=Ze.nextZ}for(;Be&&Be.z>=Ue;){if(Be.x>=H&&Be.x<=te&&Be.y>=X&&Be.y<=_e&&Be!==m&&Be!==S&&Ed(D,F,P,V,L,j,Be.x,Be.y)&&ta(Be.prev,Be,Be.next)>=0)return!1;Be=Be.prevZ}for(;Ze&&Ze.z<=Xe;){if(Ze.x>=H&&Ze.x<=te&&Ze.y>=X&&Ze.y<=_e&&Ze!==m&&Ze!==S&&Ed(D,F,P,V,L,j,Ze.x,Ze.y)&&ta(Ze.prev,Ze,Ze.next)>=0)return!1;Ze=Ze.nextZ}return!0}function U0(s,i,a){var f=s;do{var m=f.prev,w=f.next.next;!dp(m,w)&&dy(m,f,f.next,w)&&Cc(m,w)&&Cc(w,m)&&(i.push(m.i/a|0),i.push(f.i/a|0),i.push(w.i/a|0),dg(f),dg(f.next),f=s=w),f=f.next}while(f!==s);return xh(f)}function ly(s,i,a,f,m,w){var S=s;do{for(var D=S.next.next;D!==S.prev;){if(S.i!==D.i&&nw(S,D)){var P=j0(S,D);return S=xh(S,S.next),P=xh(P,P.next),bd(S,i,a,f,m,w,0),void bd(P,i,a,f,m,w,0)}D=D.next}S=S.next}while(S!==s)}function cy(s,i){return s.x-i.x}function hy(s,i){var a=function(m,w){var S,D=w,P=m.x,L=m.y,F=-1/0;do{if(L<=D.y&&L>=D.next.y&&D.next.y!==D.y){var V=D.x+(L-D.y)*(D.next.x-D.x)/(D.next.y-D.y);if(V<=P&&V>F&&(F=V,S=D.x<D.next.x?D:D.next,V===P))return S}D=D.next}while(D!==w);if(!S)return null;var j,H=S,X=S.x,te=S.y,_e=1/0;D=S;do{P>=D.x&&D.x>=X&&P!==D.x&&Ed(L<te?P:F,L,X,te,L<te?F:P,L,D.x,D.y)&&(j=Math.abs(L-D.y)/(P-D.x),Cc(D,m)&&(j<_e||j===_e&&(D.x>S.x||D.x===S.x&&fp(S,D)))&&(S=D,_e=j)),D=D.next}while(D!==H);return S}(s,i);if(!a)return i;var f=j0(a,s);return xh(f,f.next),xh(a,a.next)}function fp(s,i){return ta(s.prev,s,i.prev)<0&&ta(i.next,s,s.next)<0}function fy(s,i,a,f,m){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*m|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*m|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function V0(s){var i=s,a=s;do{(i.x<a.x||i.x===a.x&&i.y<a.y)&&(a=i),i=i.next}while(i!==s);return a}function Ed(s,i,a,f,m,w,S,D){return(m-S)*(i-D)>=(s-S)*(w-D)&&(s-S)*(f-D)>=(a-S)*(i-D)&&(a-S)*(w-D)>=(m-S)*(f-D)}function nw(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(a,f){var m=a;do{if(m.i!==a.i&&m.next.i!==a.i&&m.i!==f.i&&m.next.i!==f.i&&dy(m,m.next,a,f))return!0;m=m.next}while(m!==a);return!1}(s,i)&&(Cc(s,i)&&Cc(i,s)&&function(a,f){var m=a,w=!1,S=(a.x+f.x)/2,D=(a.y+f.y)/2;do{m.y>D!=m.next.y>D&&m.next.y!==m.y&&S<(m.next.x-m.x)*(D-m.y)/(m.next.y-m.y)+m.x&&(w=!w),m=m.next}while(m!==a);return w}(s,i)&&(ta(s.prev,s,i.prev)||ta(s,i.prev,i))||dp(s,i)&&ta(s.prev,s,s.next)>0&&ta(i.prev,i,i.next)>0)}function ta(s,i,a){return(i.y-s.y)*(a.x-i.x)-(i.x-s.x)*(a.y-i.y)}function dp(s,i){return s.x===i.x&&s.y===i.y}function dy(s,i,a,f){var m=Cd(ta(s,i,a)),w=Cd(ta(s,i,f)),S=Cd(ta(a,f,s)),D=Cd(ta(a,f,i));return m!==w&&S!==D||!(0!==m||!Bf(s,a,i))||!(0!==w||!Bf(s,f,i))||!(0!==S||!Bf(a,s,f))||!(0!==D||!Bf(a,i,f))}function Bf(s,i,a){return i.x<=Math.max(s.x,a.x)&&i.x>=Math.min(s.x,a.x)&&i.y<=Math.max(s.y,a.y)&&i.y>=Math.min(s.y,a.y)}function Cd(s){return s>0?1:s<0?-1:0}function Cc(s,i){return ta(s.prev,s,s.next)<0?ta(s,i,s.next)>=0&&ta(s,s.prev,i)>=0:ta(s,i,s.prev)<0||ta(s,s.next,i)<0}function j0(s,i){var a=new py(s.i,s.x,s.y),f=new py(i.i,i.x,i.y),m=s.next,w=i.prev;return s.next=i,i.prev=s,a.next=m,m.prev=a,f.next=a,a.prev=f,w.next=f,f.prev=w,f}function G0(s,i,a,f){var m=new py(s,i,a);return f?(m.next=f.next,m.prev=f,f.next.prev=m,f.next=m):(m.prev=m,m.next=m),m}function dg(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function py(s,i,a){this.i=s,this.x=i,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function pp(s,i,a,f){for(var m=0,w=i,S=a-f;w<a;w+=f)m+=(s[S]-s[w])*(s[w+1]+s[S+1]),S=w;return m}function rw(s,i,a,f,m){gy(s,i,a||0,f||s.length-1,m||my)}function gy(s,i,a,f,m){for(;f>a;){if(f-a>600){var w=f-a+1,S=i-a+1,D=Math.log(w),P=.5*Math.exp(2*D/3),L=.5*Math.sqrt(D*P*(w-P)/w)*(S-w/2<0?-1:1);gy(s,i,Math.max(a,Math.floor(i-S*P/w+L)),Math.min(f,Math.floor(i+(w-S)*P/w+L)),m)}var F=s[i],V=a,j=f;for(Jh(s,a,i),m(s[f],F)>0&&Jh(s,a,f);V<j;){for(Jh(s,V,j),V++,j--;m(s[V],F)<0;)V++;for(;m(s[j],F)>0;)j--}0===m(s[a],F)?Jh(s,a,j):Jh(s,++j,f),j<=i&&(a=j+1),i<=j&&(f=j-1)}}function Jh(s,i,a){var f=s[i];s[i]=s[a],s[a]=f}function my(s,i){return s<i?-1:s>i?1:0}function pg(s,i){const a=s.length;if(a<=1)return[s];const f=[];let m,w;for(let S=0;S<a;S++){const D=Jn(s[S]);0!==D&&(s[S].area=Math.abs(D),void 0===w&&(w=D<0),w===D<0?(m&&f.push(m),m=[s[S]]):m.push(s[S]))}if(m&&f.push(m),i>1)for(let S=0;S<f.length;S++)f[S].length<=i||(rw(f[S],i,1,f[S].length-1,$0),f[S]=f[S].slice(0,i));return f}function $0(s,i){return i.area-s.area}function gg(s,i,a){const f=a.patternDependencies;let m=!1;for(const w of i){const S=w.paint.get(`${s}-pattern`);S.isConstant()||(m=!0);const D=S.constantOr(null);D&&(m=!0,f[D.to]=!0,f[D.from]=!0)}return m}function mg(s,i,a,f,m){const w=m.patternDependencies;for(const S of i){const D=S.paint.get(`${s}-pattern`).value;if("constant"!==D.kind){let P=D.evaluate({zoom:f-1},a,{},m.availableImages),L=D.evaluate({zoom:f},a,{},m.availableImages),F=D.evaluate({zoom:f+1},a,{},m.availableImages);P=P&&P.name?P.name:P,L=L&&L.name?L.name:L,F=F&&F.name?F.name:F,w[P]=!0,w[L]=!0,w[F]=!0,a.patterns[S.id]={min:P,mid:L,max:F}}}return a}wd.exports=hp,wd.exports.default=hp,hp.deviation=function(s,i,a,f){var m=i&&i.length,w=Math.abs(pp(s,0,m?i[0]*a:s.length,a));if(m)for(var S=0,D=i.length;S<D;S++)w-=Math.abs(pp(s,i[S]*a,S<D-1?i[S+1]*a:s.length,a));var P=0;for(S=0;S<f.length;S+=3){var L=f[S]*a,F=f[S+1]*a,V=f[S+2]*a;P+=Math.abs((s[L]-s[V])*(s[F+1]-s[L+1])-(s[L]-s[F])*(s[V+1]-s[L+1]))}return 0===w&&0===P?0:Math.abs((P-w)/w)},hp.flatten=function(s){for(var i=s[0][0].length,a={vertices:[],holes:[],dimensions:i},f=0,m=0;m<s.length;m++){for(var w=0;w<s[m].length;w++)for(var S=0;S<i;S++)a.vertices.push(s[m][w][S]);m>0&&a.holes.push(f+=s[m-1].length)}return a};class yg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fr,this.indexArray=new Qa,this.indexArray2=new il,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new Vs,this.segments2=new Vs,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=i.projection}populate(i,a,f,m){this.hasPattern=gg("fill",this.layers,a);const w=this.layers[0].layout.get("fill-sort-key"),S=[];for(const{feature:D,id:P,index:L,sourceLayerIndex:F}of i){const V=this.layers[0]._featureFilter.needGeometry,j=Yh(D,V);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),j,f))continue;const H=w?w.evaluate(j,{},f,a.availableImages):void 0,X={id:P,properties:D.properties,type:D.type,sourceLayerIndex:F,index:L,geometry:V?j.geometry:yh(D,f,m),patterns:{},sortKey:H};S.push(X)}w&&S.sort((D,P)=>D.sortKey-P.sortKey);for(const D of S){const{geometry:P,index:L,sourceLayerIndex:F}=D;if(this.hasPattern){const V=mg("fill",this.layers,D,this.zoom,a);this.patternFeatures.push(V)}else this.addFeature(D,P,L,f,{},a.availableImages);a.featureIndex.insert(i[L].feature,P,L,F,this.index)}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}addFeatures(i,a,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,tw),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,a,f,m,w,S=[]){for(const D of pg(a,500)){let P=0;for(const X of D)P+=X.length;const L=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray),F=L.vertexLength,V=[],j=[];for(const X of D){if(0===X.length)continue;X!==D[0]&&j.push(V.length/2);const te=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),_e=te.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(_e+X.length-1,_e),V.push(X[0].x),V.push(X[0].y);for(let Ue=1;Ue<X.length;Ue++)this.layoutVertexArray.emplaceBack(X[Ue].x,X[Ue].y),this.indexArray2.emplaceBack(_e+Ue-1,_e+Ue),V.push(X[Ue].x),V.push(X[Ue].y);te.vertexLength+=X.length,te.primitiveLength+=X.length}const H=wd.exports(V,j);for(let X=0;X<H.length;X+=3)this.indexArray.emplaceBack(F+H[X],F+H[X+1],F+H[X+2]);L.vertexLength+=P,L.primitiveLength+=H.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}}re(yg,"FillBucket",{omit:["layers","patternFeatures"]});const iw=new wn({"fill-sort-key":new mt(Rt.layout_fill["fill-sort-key"])});var ow={paint:new wn({"fill-antialias":new Dt(Rt.paint_fill["fill-antialias"]),"fill-opacity":new mt(Rt.paint_fill["fill-opacity"]),"fill-color":new mt(Rt.paint_fill["fill-color"]),"fill-outline-color":new mt(Rt.paint_fill["fill-outline-color"]),"fill-translate":new Dt(Rt.paint_fill["fill-translate"]),"fill-translate-anchor":new Dt(Rt.paint_fill["fill-translate-anchor"]),"fill-pattern":new An(Rt.paint_fill["fill-pattern"])}),layout:iw};const sw=bn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),aw=bn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Qh=bn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:gp}=sw;var _g={},rS=Y,uw=mp;function mp(s,i,a,f,m){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=m,s.readFields(iS,this,i)}function iS(s,i,a){1==s?i.id=a.readVarint():2==s?function(f,m){for(var w=f.readVarint()+f.pos;f.pos<w;){var S=m._keys[f.readVarint()],D=m._values[f.readVarint()];m.properties[S]=D}}(a,i):3==s?i.type=a.readVarint():4==s&&(i._geometry=a.pos)}function oS(s){for(var i,a,f=0,m=0,w=s.length,S=w-1;m<w;S=m++)f+=((a=s[S]).x-(i=s[m]).x)*(i.y+a.y);return f}mp.types=["Unknown","Point","LineString","Polygon"],mp.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,a=s.readVarint()+s.pos,f=1,m=0,w=0,S=0,D=[];s.pos<a;){if(m<=0){var P=s.readVarint();f=7&P,m=P>>3}if(m--,1===f||2===f)w+=s.readSVarint(),S+=s.readSVarint(),1===f&&(i&&D.push(i),i=[]),i.push(new rS(w,S));else{if(7!==f)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&D.push(i),D},mp.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,a=1,f=0,m=0,w=0,S=1/0,D=-1/0,P=1/0,L=-1/0;s.pos<i;){if(f<=0){var F=s.readVarint();a=7&F,f=F>>3}if(f--,1===a||2===a)(m+=s.readSVarint())<S&&(S=m),m>D&&(D=m),(w+=s.readSVarint())<P&&(P=w),w>L&&(L=w);else if(7!==a)throw new Error("unknown command "+a)}return[S,P,D,L]},mp.prototype.toGeoJSON=function(s,i,a){var f,m,w=this.extent*Math.pow(2,a),S=this.extent*s,D=this.extent*i,P=this.loadGeometry(),L=mp.types[this.type];function F(H){for(var X=0;X<H.length;X++){var te=H[X];H[X]=[360*(te.x+S)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+D)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(f=0;f<P.length;f++)V[f]=P[f][0];F(P=V);break;case 2:for(f=0;f<P.length;f++)F(P[f]);break;case 3:for(P=function(H){var X=H.length;if(X<=1)return[H];for(var te,_e,Ue=[],Xe=0;Xe<X;Xe++){var Be=oS(H[Xe]);0!==Be&&(void 0===_e&&(_e=Be<0),_e===Be<0?(te&&Ue.push(te),te=[H[Xe]]):te.push(H[Xe]))}return te&&Ue.push(te),Ue}(P),f=0;f<P.length;f++)for(m=0;m<P[f].length;m++)F(P[f][m])}1===P.length?P=P[0]:L="Multi"+L;var j={type:"Feature",geometry:{type:L,coordinates:P},properties:this.properties};return"id"in this&&(j.id=this.id),j};var q0=uw,H0=X0;function X0(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(lw,this,i),this.length=this._features.length}function lw(s,i,a){15===s?i.version=a.readVarint():1===s?i.name=a.readString():5===s?i.extent=a.readVarint():2===s?i._features.push(a.pos):3===s?i._keys.push(a.readString()):4===s&&i._values.push(function(f){for(var m=null,w=f.readVarint()+f.pos;f.pos<w;){var S=f.readVarint()>>3;m=1===S?f.readString():2===S?f.readFloat():3===S?f.readDouble():4===S?f.readVarint64():5===S?f.readVarint():6===S?f.readSVarint():7===S?f.readBoolean():null}return m}(a))}X0.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new q0(this._pbf,i,this.extent,this._keys,this._values)};var cw=H0;function yy(s,i,a){if(3===s){var f=new cw(a,a.readVarint()+a.pos);f.length&&(i[f.name]=f)}}var Sc=_g.VectorTile=function(s,i){this.layers=s.readFields(yy,{},i)},ef=_g.VectorTileFeature=uw;function yp(s,i,a,f){const m=[],w=0===f?(S,D,P,L,F,V)=>{S.push(new Y(V,P+(V-D)/(L-D)*(F-P)))}:(S,D,P,L,F,V)=>{S.push(new Y(D+(V-P)/(F-P)*(L-D),V))};for(const S of s){const D=[];for(const P of S){if(P.length<=2)continue;const L=[];for(let j=0;j<P.length-1;j++){const H=P[j].x,X=P[j].y,te=P[j+1].x,_e=P[j+1].y,Ue=0===f?H:X,Xe=0===f?te:_e;Ue<i?Xe>i&&w(L,H,X,te,_e,i):Ue>a?Xe<a&&w(L,H,X,te,_e,a):L.push(P[j]),Xe<i&&Ue>=i&&w(L,H,X,te,_e,i),Xe>a&&Ue<=a&&w(L,H,X,te,_e,a)}let F=P[P.length-1];const V=0===f?F.x:F.y;V>=i&&V<=a&&L.push(F),L.length&&(F=L[L.length-1],L[0].x===F.x&&L[0].y===F.y||L.push(L[0]),D.push(L))}D.length&&m.push(D)}return m}_g.VectorTileLayer=H0;const Z0=ef.types,W0=Math.pow(2,13);function vg(s,i,a,f,m,w,S,D){s.emplaceBack((i<<1)+S,(a<<1)+w,(Math.floor(f*W0)<<1)+m,Math.round(D))}function xg(s,i,a){s.emplaceBack(i.x,i.y,i.z,16384*a[0],16384*a[1],16384*a[2])}class hw{constructor(){this.acc=new Y(0,0),this.polyCount=[]}startRing(i){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Y(i.x,i.y),this.max=new Y(i.x,i.y))}append(i,a){this.currentPolyCount.edges++,this.acc._add(i);const f=this.min,m=this.max;i.x<f.x?f.x=i.x:i.x>m.x&&(m.x=i.x),i.y<f.y?f.y=i.y:i.y>m.y&&(m.y=i.y),((0===i.x||i.x===cr)&&i.x===a.x)!=((0===i.y||i.y===cr)&&i.y===a.y)&&this.processBorderOverlap(i,a),a.x<0!=i.x<0&&this.addBorderIntersection(0,ni(a.y,i.y,(0-a.x)/(i.x-a.x))),a.x>cr!=i.x>cr&&this.addBorderIntersection(1,ni(a.y,i.y,(cr-a.x)/(i.x-a.x))),a.y<0!=i.y<0&&this.addBorderIntersection(2,ni(a.x,i.x,(0-a.y)/(i.y-a.y))),a.y>cr!=i.y>cr&&this.addBorderIntersection(3,ni(a.x,i.x,(cr-a.y)/(i.y-a.y)))}addBorderIntersection(i,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const f=this.borders[i];a<f[0]&&(f[0]=a),a>f[1]&&(f[1]=a)}processBorderOverlap(i,a){if(i.x===a.x){if(i.y===a.y)return;const f=0===i.x?0:1;this.addBorderIntersection(f,a.y),this.addBorderIntersection(f,i.y)}else{const f=0===i.y?2:3;this.addBorderIntersection(f,a.x),this.addBorderIntersection(f,i.x)}}centroid(){const i=this.polyCount.reduce((a,f)=>a+f.edges,0);return 0!==i?this.acc.div(i)._round():new Y(0,0)}span(){return new Y(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((i,a)=>i+ +(a[0]!==Number.MAX_VALUE),0)}}class Uf{constructor(i){this.zoom=i.zoom,this.canonical=i.canonical,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=i.projection,this.layoutVertexArray=new Ro,this.centroidVertexArray=new x0,this.indexArray=new Qa,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new Vs,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=i.enableTerrain}populate(i,a,f,m){this.features=[],this.hasPattern=gg("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(w){const S=Math.exp(Math.PI*(1-w.y/(1<<w.z)*2));return 80150034*S/(S*S+1)/cr/(1<<w.z)}(f),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:w,id:S,index:D,sourceLayerIndex:P}of i){const L=this.layers[0]._featureFilter.needGeometry,F=Yh(w,L);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),F,f))continue;const V={id:S,sourceLayerIndex:P,index:D,geometry:L?F.geometry:yh(w,f,m),properties:w.properties,type:w.type,patterns:{}},j=this.layoutVertexArray.length;this.hasPattern?this.features.push(mg("fill-extrusion",this.layers,V,this.zoom,a)):this.addFeature(V,V.geometry,D,f,{},a.availableImages,m),a.featureIndex.insert(w,V.geometry,D,P,this.index,j)}this.sortBorders()}addFeatures(i,a,f,m,w){for(const S of this.features){const{geometry:D}=S;this.addFeature(S,D,S.index,a,f,m,w)}this.sortBorders()}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,gp),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=i.createVertexBuffer(this.layoutVertexExtArray,Qh.members,!0))),this.programConfigurations.upload(i),this.uploaded=!0}uploadCentroid(i){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,aw.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,a,f,m,w,S,D){const P=[new Y(0,0),new Y(cr,cr)],L=D.projection,F="globe"===L.name,V=this.enableTerrain&&!F?new hw:null,j="Polygon"===Z0[i.type];F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Lm);const H=pg(a,500);for(let Ue=H.length-1;Ue>=0;Ue--){const Xe=H[Ue];(0===Xe.length||(X=Xe[0]).every(Be=>Be.x<=0)||X.every(Be=>Be.x>=cr)||X.every(Be=>Be.y<=0)||X.every(Be=>Be.y>=cr))&&H.splice(Ue,1)}var X;let te;if(F)te=Q0(H,P,m);else{te=[];for(const Ue of H)te.push({polygon:Ue,bounds:P})}const _e=j?this.edgeRadius:0;for(const{polygon:Ue,bounds:Xe}of te){let Be=0,Ze=0;for(const We of Ue)j&&!We[0].equals(We[We.length-1])&&We.push(We[0]),Ze+=j?We.length-1:We.length;const rt=this.segments.prepareSegment((j?5:4)*Ze,this.layoutVertexArray,this.indexArray);if(j){const We=[],Mt=[];Be=rt.vertexLength;for(const Ht of Ue){let ln,kt;Ht.length&&Ht!==Ue[0]&&Mt.push(We.length/2),ln=Ht[1].sub(Ht[0])._perp()._unit();for(let Wt=1;Wt<Ht.length;Wt++){const Kt=Ht[Wt],rn=Ht[Wt===Ht.length-1?1:Wt+1];let{x:cn,y:jt}=Kt;if(_e){kt=rn.sub(Kt)._perp()._unit();const In=ln.add(kt)._unit(),sr=_e*Math.min(4,1/(ln.x*In.x+ln.y*In.y));cn+=sr*In.x,jt+=sr*In.y,ln=kt}vg(this.layoutVertexArray,cn,jt,0,0,1,1,0),rt.vertexLength++,We.push(Kt.x,Kt.y),F&&xg(this.layoutVertexExtArray,L.projectTilePoint(cn,jt,m),L.upVector(m,cn,jt))}}const It=wd.exports(We,Mt);for(let Ht=0;Ht<It.length;Ht+=3)this.indexArray.emplaceBack(Be+It[Ht],Be+It[Ht+2],Be+It[Ht+1]),rt.primitiveLength++}for(const We of Ue){V&&We.length&&V.startRing(We[0]);let Mt,It,Ht,ln=We.length>4&&Y0(We[We.length-2],We[0],We[1]),kt=_e?sS(We[We.length-2],We[0],We[1],_e):0;It=We[1].sub(We[0])._perp()._unit();let Wt=!0;for(let Kt=1,rn=0;Kt<We.length;Kt++){let cn=We[Kt-1],jt=We[Kt];const In=We[Kt===We.length-1?1:Kt+1];if(V&&j&&V.currentPolyCount.top++,_y(jt,cn,Xe)){_e&&(It=In.sub(jt)._perp()._unit(),Wt=!Wt);continue}V&&V.append(jt,cn);const sr=jt.sub(cn)._perp(),Ln=sr.x/(Math.abs(sr.x)+Math.abs(sr.y)),Gn=sr.y>0?1:0,Dn=cn.dist(jt);if(rn+Dn>32768&&(rn=0),_e){Ht=In.sub(jt)._perp()._unit();let yi=fw(cn,jt,In,wg(It,Ht),_e);isNaN(yi)&&(yi=0);const Mr=jt.sub(cn)._unit();cn=cn.add(Mr.mult(kt))._round(),jt=jt.add(Mr.mult(-yi))._round(),kt=yi,It=Ht}const fr=rt.vertexLength,Dr=We.length>4&&Y0(cn,jt,In);let Or=K0(rn,ln,Wt);if(vg(this.layoutVertexArray,cn.x,cn.y,Ln,Gn,0,0,Or),vg(this.layoutVertexArray,cn.x,cn.y,Ln,Gn,0,1,Or),rn+=Dn,Or=K0(rn,Dr,!Wt),ln=Dr,vg(this.layoutVertexArray,jt.x,jt.y,Ln,Gn,0,0,Or),vg(this.layoutVertexArray,jt.x,jt.y,Ln,Gn,0,1,Or),rt.vertexLength+=4,this.indexArray.emplaceBack(fr+0,fr+1,fr+2),this.indexArray.emplaceBack(fr+1,fr+3,fr+2),rt.primitiveLength+=2,_e){const yi=Be+(1===Kt?We.length-2:Kt-2),Mr=1===Kt?Be:yi+1;if(this.indexArray.emplaceBack(fr+1,yi,fr+3),this.indexArray.emplaceBack(yi,Mr,fr+3),rt.primitiveLength+=2,void 0===Mt&&(Mt=fr),!_y(In,We[Kt],Xe)){const Ko=Kt===We.length-1?Mt:rt.vertexLength;this.indexArray.emplaceBack(fr+2,fr+3,Ko),this.indexArray.emplaceBack(fr+3,Ko+1,Ko),this.indexArray.emplaceBack(fr+3,Mr,Ko+1),rt.primitiveLength+=3}Wt=!Wt}if(F){const yi=this.layoutVertexExtArray,Mr=L.projectTilePoint(cn.x,cn.y,m),Ko=L.projectTilePoint(jt.x,jt.y,m),Zr=L.upVector(m,cn.x,cn.y),ii=L.upVector(m,jt.x,jt.y);xg(yi,Mr,Zr),xg(yi,Mr,Zr),xg(yi,Ko,ii),xg(yi,Ko,ii)}}j&&(Be+=We.length-1)}}if(V&&V.polyCount.length>0){if(V.borders){V.vertexArrayOffset=this.centroidVertexArray.length;const Ue=V.borders,Xe=this.featuresOnBorder.push(V)-1;for(let Be=0;Be<4;Be++)Ue[Be][0]!==Number.MAX_VALUE&&this.borders[Be].push(Xe)}this.encodeCentroid(V.borders?void 0:V.centroid(),V)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}sortBorders(){for(let i=0;i<4;i++)this.borders[i].sort((a,f)=>this.featuresOnBorder[a].borders[i][0]-this.featuresOnBorder[f].borders[i][0])}encodeCentroid(i,a,f=!0){let m,w;if(i)if(0!==i.y){const D=a.span()._mult(this.tileToMeter);m=(Math.max(i.x,1)<<3)+Math.min(7,Math.round(D.x/10)),w=(Math.max(i.y,1)<<3)+Math.min(7,Math.round(D.y/10))}else m=Math.ceil(7*(i.x+450)),w=0;else m=0,w=+f;let S=f?this.centroidVertexArray.length:a.vertexArrayOffset;for(const D of a.polyCount){f&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*D.edges+D.top);for(let P=0;P<D.top;P++)this.centroidVertexArray.emplace(S++,m,w);for(let P=0;P<2*D.edges;P++)this.centroidVertexArray.emplace(S++,0,w),this.centroidVertexArray.emplace(S++,m,w)}}}function wg(s,i){const a=s.add(i)._unit();return s.x*a.x+s.y*a.y}function sS(s,i,a,f){const m=i.sub(s)._perp()._unit(),w=a.sub(i)._perp()._unit();return fw(s,i,a,wg(m,w),f)}function fw(s,i,a,f,m){const w=Math.sqrt(1-f*f);return Math.min(s.dist(i)/3,i.dist(a)/3,m*w/f)}function _y(s,i,a){return s.x<a[0].x&&i.x<a[0].x||s.x>a[1].x&&i.x>a[1].x||s.y<a[0].y&&i.y<a[0].y||s.y>a[1].y&&i.y>a[1].y}function Y0(s,i,a){if(s.x<0||s.x>=cr||i.x<0||i.x>=cr||a.x<0||a.x>=cr)return!1;const f=a.sub(i),m=f.perp(),w=s.sub(i);return(f.x*w.x+f.y*w.y)/Math.sqrt((f.x*f.x+f.y*f.y)*(w.x*w.x+w.y*w.y))>-.866&&m.x*w.x+m.y*w.y<0}function K0(s,i,a){const f=i?2|s:-3&s;return a?1|f:-2&f}function J0(){const s=Math.PI/32,i=Math.tan(s),a=Wh;return a*Math.sqrt(1+2*i*i)-a}function Q0(s,i,a){const f=1<<a.z,m=Dl(a.x/f),w=Dl((a.x+1)/f),S=ea(a.y/f),D=ea((a.y+1)/f);return function(P,L,F,V,j=0,H){const X=[];if(!P.length||!F||!V)return X;const te=(We,Mt)=>{for(const It of We)X.push({polygon:It,bounds:Mt})},_e=Math.ceil(Math.log2(F)),Ue=Math.ceil(Math.log2(V)),Xe=_e-Ue,Be=[];for(let We=0;We<Math.abs(Xe);We++)Be.push(Xe>0?0:1);for(let We=0;We<Math.min(_e,Ue);We++)Be.push(0),Be.push(1);let Ze=P;if(Ze=yp(Ze,L[0].y-j,L[1].y+j,1),Ze=yp(Ze,L[0].x-j,L[1].x+j,0),!Ze.length)return X;const rt=[];for(Be.length?rt.push({polygons:Ze,bounds:L,depth:0}):te(Ze,L);rt.length;){const We=rt.pop(),Mt=We.depth,It=Be[Mt],Ht=We.bounds[0],ln=We.bounds[1],kt=0===It?Ht.x:Ht.y,Wt=0===It?ln.x:ln.y,Kt=H?H(It,kt,Wt):.5*(kt+Wt),rn=yp(We.polygons,kt-j,Kt+j,It),cn=yp(We.polygons,Kt-j,Wt+j,It);if(rn.length){const jt=[Ht,new Y(0===It?Kt:ln.x,1===It?Kt:ln.y)];Be.length>Mt+1?rt.push({polygons:rn,bounds:jt,depth:Mt+1}):te(rn,jt)}if(cn.length){const jt=[new Y(0===It?Kt:Ht.x,1===It?Kt:Ht.y),ln];Be.length>Mt+1?rt.push({polygons:cn,bounds:jt,depth:Mt+1}):te(cn,jt)}}return X}(s,i,Math.ceil((w-m)/11.25),Math.ceil((S-D)/11.25),1,(P,L,F)=>{if(0===P)return.5*(L+F);{const V=ea((a.y+L/cr)/f);return(bc(.5*(ea((a.y+F/cr)/f)+V))*f-a.y)*cr}})}re(Uf,"FillExtrusionBucket",{omit:["layers","features"]}),re(hw,"PartMetadata");const ev=new wn({"fill-extrusion-edge-radius":new Dt(Rt["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var bg={paint:new wn({"fill-extrusion-opacity":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new mt(Rt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new An(Rt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new mt(Rt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new mt(Rt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Dt(Rt["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:ev};function tv(s,i,a){var f=2*Math.PI*6378137/256/Math.pow(2,a);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Sd{constructor(i,a,f){this.z=i,this.x=a,this.y=f,this.key=_p(0,i,i,a,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,a){const f=(S=this.y,D=this.z,P=tv(256*(w=this.x),256*(S=Math.pow(2,D)-S-1),D),L=tv(256*(w+1),256*(S+1),D),P[0]+","+P[1]+","+L[0]+","+L[1]),m=function(w,S,D){let P,L="";for(let F=w;F>0;F--)P=1<<F-1,L+=(S&P?1:0)+(D&P?2:0);return L}(this.z,this.x,this.y);var w,S,D,P,L;return i[(this.x+this.y)%i.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",m).replace("{bbox-epsg-3857}",f)}toString(){return`${this.z}/${this.x}/${this.y}`}}class nv{constructor(i,a){this.wrap=i,this.canonical=a,this.key=_p(i,a.z,a.z,a.x,a.y)}}class yo{constructor(i,a,f,m,w){this.overscaledZ=i,this.wrap=a,this.canonical=new Sd(f,+m,+w),this.key=0===a&&i===f?this.canonical.key:_p(a,i,f,m,w)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){const a=this.canonical.z-i;return i>this.canonical.z?new yo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new yo(i,this.wrap,i,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(i,a=!0){if(this.overscaledZ===i&&a)return this.key;if(i>this.canonical.z)return _p(this.wrap*+a,i,this.canonical.z,this.canonical.x,this.canonical.y);{const f=this.canonical.z-i;return _p(this.wrap*+a,i,i,this.canonical.x>>f,this.canonical.y>>f)}}isChildOf(i){if(i.wrap!==this.wrap)return!1;const a=this.canonical.z-i.canonical.z;return 0===i.overscaledZ||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>a&&i.canonical.y===this.canonical.y>>a}children(i){if(this.overscaledZ>=i)return[new yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,f=2*this.canonical.x,m=2*this.canonical.y;return[new yo(a,this.wrap,a,f,m),new yo(a,this.wrap,a,f+1,m),new yo(a,this.wrap,a,f,m+1),new yo(a,this.wrap,a,f+1,m+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new yo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new nv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function _p(s,i,a,f,m){const w=1<<Math.min(a,22);let S=w*(m%w)+f%w;return s&&a<22&&(S+=w*w*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*S+a)+(i-a)}re(Sd,"CanonicalTileID"),re(yo,"OverscaledTileID",{omit:["projMatrix"]});class Id extends Y{constructor(i,a,f){super(i,a),this.z=f}}function Td(s,i){return s.x*i.x+s.y*i.y}function vy(s,i){if(1===s.length){let a=0;const f=i[a++];let m;for(;!m||f.equals(m);)if(m=i[a++],!m)return 1/0;for(;a<i.length;a++){const w=i[a],S=s[0],D=m.sub(f),P=w.sub(f),L=S.sub(f),F=Td(D,D),V=Td(D,P),j=Td(P,P),H=Td(L,D),X=Td(L,P),te=F*j-V*V,_e=(j*H-V*X)/te,Ue=(F*X-V*H)/te,Xe=f.z*(1-_e-Ue)+m.z*_e+w.z*Ue;if(isFinite(Xe))return Xe}return 1/0}{let a=1/0;for(const f of i)a=Math.min(a,f.z);return a}}function rv(s,i,a,f,m,w,S,D){const P=S*m.getElevationAt(s,i,!0,!0),L=0!==w[0],F=L?0===w[1]?S*(w[0]/7-450):S*function(V,j,H){const X=Math.floor(j[0]/8),te=Math.floor(j[1]/8),_e=10*(j[0]-8*X),Ue=10*(j[1]-8*te),Xe=V.getElevationAt(X,te,!0,!0),Be=V.getMeterToDEM(H),Ze=Math.floor(.5*(_e*Be-1)),rt=Math.floor(.5*(Ue*Be-1)),We=V.tileCoordToPixel(X,te),Mt=2*Ze+1,It=2*rt+1,Ht=(sr=Mt,Ln=It,[(cn=V).getElevationAtPixel(jt=We.x-Ze,In=We.y-rt,!0),cn.getElevationAtPixel(jt+Ln,In,!0),cn.getElevationAtPixel(jt,In+Ln,!0),cn.getElevationAtPixel(jt+sr,In+Ln,!0)]),ln=Math.abs(Ht[0]-Ht[1]),kt=Math.abs(Ht[2]-Ht[3]),Wt=Math.abs(Ht[0]-Ht[2])+Math.abs(Ht[1]-Ht[3]),Kt=Math.min(.25,.5*Be*(ln+kt)/Mt),rn=Math.min(.25,.5*Be*Wt/It);var cn,jt,In,sr,Ln;return Xe+Math.max(Kt*_e,rn*Ue)}(m,w,D):P;return{base:P+(0===a)?-1:a,top:L?Math.max(F+f,P+a+2):P+f}}const dw=bn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:pw}=dw,gw=bn([{name:"a_packed",components:4,type:"Float32"}]),{members:iv}=gw,aS=ef.types,uS=Math.cos(Math.PI/180*37.5);class tf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(a=>a.id),this.index=i.index,this.projection=i.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new uo,this.layoutVertexArray2=new aa,this.indexArray=new Qa,this.programConfigurations=new pd(i.layers,i.zoom),this.segments=new Vs,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(i,a,f,m){this.hasPattern=gg("line",this.layers,a);const w=this.layers[0].layout.get("line-sort-key"),S=[];for(const{feature:F,id:V,index:j,sourceLayerIndex:H}of i){const X=this.layers[0]._featureFilter.needGeometry,te=Yh(F,X);if(!this.layers[0]._featureFilter.filter(new Ge(this.zoom),te,f))continue;const _e=w?w.evaluate(te,{},f):void 0,Ue={id:V,properties:F.properties,type:F.type,sourceLayerIndex:H,index:j,geometry:X?te.geometry:yh(F,f,m),patterns:{},sortKey:_e};S.push(Ue)}w&&S.sort((F,V)=>F.sortKey-V.sortKey);const{lineAtlas:D,featureIndex:P}=a,L=this.addConstantDashes(D);for(const F of S){const{geometry:V,index:j,sourceLayerIndex:H}=F;if(L&&this.addFeatureDashes(F,D),this.hasPattern){const X=mg("line",this.layers,F,this.zoom,a);this.patternFeatures.push(X)}else this.addFeature(F,V,j,f,D.positions,a.availableImages);P.insert(i[j].feature,V,j,H,this.index)}}addConstantDashes(i){let a=!1;for(const f of this.layers){const m=f.paint.get("line-dasharray").value,w=f.layout.get("line-cap").value;if("constant"!==m.kind||"constant"!==w.kind)a=!0;else{const S=w.value,D=m.value;if(!D)continue;i.addDash(D.from,S),i.addDash(D.to,S),D.other&&i.addDash(D.other,S)}}return a}addFeatureDashes(i,a){const f=this.zoom;for(const m of this.layers){const w=m.paint.get("line-dasharray").value,S=m.layout.get("line-cap").value;if("constant"===w.kind&&"constant"===S.kind)continue;let D,P,L,F,V,j;if("constant"===w.kind){const _e=w.value;if(!_e)continue;D=_e.other||_e.to,P=_e.to,L=_e.from}else D=w.evaluate({zoom:f-1},i),P=w.evaluate({zoom:f},i),L=w.evaluate({zoom:f+1},i);"constant"===S.kind?F=V=j=S.value:(F=S.evaluate({zoom:f-1},i),V=S.evaluate({zoom:f},i),j=S.evaluate({zoom:f+1},i)),a.addDash(D,F),a.addDash(P,V),a.addDash(L,j);const H=a.getKey(D,F),X=a.getKey(P,V),te=a.getKey(L,j);i.patterns[m.id]={min:H,mid:X,max:te}}}update(i,a,f,m){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,a,this.stateDependentLayers,f,m)}addFeatures(i,a,f,m,w){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,f,m)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,iv)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,pw),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&i.properties.hasOwnProperty("mapbox_clip_start")&&i.properties.hasOwnProperty("mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,a,f,m,w,S){const D=this.layers[0].layout,P=D.get("line-join").evaluate(i,{}),L=D.get("line-cap").evaluate(i,{}),F=D.get("line-miter-limit"),V=D.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const j of a)this.addLine(j,i,P,L,F,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,w,S,m)}addLine(i,a,f,m,w,S){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ue=0;Ue<i.length-1;Ue++)this.totalDistance+=i[Ue].dist(i[Ue+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const D="Polygon"===aS[a.type];let P=i.length;for(;P>=2&&i[P-1].equals(i[P-2]);)P--;let L=0;for(;L<P-1&&i[L].equals(i[L+1]);)L++;if(P<(D?3:2))return;"bevel"===f&&(w=1.05);const F=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let j,H,X,te,_e;this.e1=this.e2=-1,D&&(j=i[P-2],_e=i[L].sub(j)._unit()._perp());for(let Ue=L;Ue<P;Ue++){if(X=Ue===P-1?D?i[L+1]:void 0:i[Ue+1],X&&i[Ue].equals(X))continue;_e&&(te=_e),j&&(H=j),j=i[Ue],_e=X?X.sub(j)._unit()._perp():te,te=te||_e;let Xe=te.add(_e);0===Xe.x&&0===Xe.y||Xe._unit();const Be=te.x*_e.x+te.y*_e.y,Ze=Xe.x*_e.x+Xe.y*_e.y,rt=0!==Ze?1/Ze:1/0,We=2*Math.sqrt(2-2*Ze),Mt=Ze<uS&&H&&X,It=te.x*_e.y-te.y*_e.x>0;if(Mt&&Ue>L){const kt=j.dist(H);if(kt>2*F){const Wt=j.sub(j.sub(H)._mult(F/kt)._round());this.updateDistance(H,Wt),this.addCurrentVertex(Wt,te,0,0,V),H=Wt}}const Ht=H&&X;let ln=Ht?f:D?"butt":m;if(Ht&&"round"===ln&&(rt<S?ln="miter":rt<=2&&(ln="fakeround")),"miter"===ln&&rt>w&&(ln="bevel"),"bevel"===ln&&(rt>2&&(ln="flipbevel"),rt<w&&(ln="miter")),H&&this.updateDistance(H,j),"miter"===ln)Xe._mult(rt),this.addCurrentVertex(j,Xe,0,0,V);else if("flipbevel"===ln){if(rt>100)Xe=_e.mult(-1);else{const kt=rt*te.add(_e).mag()/te.sub(_e).mag();Xe._perp()._mult(kt*(It?-1:1))}this.addCurrentVertex(j,Xe,0,0,V),this.addCurrentVertex(j,Xe.mult(-1),0,0,V)}else if("bevel"===ln||"fakeround"===ln){const kt=-Math.sqrt(rt*rt-1),Wt=It?kt:0,Kt=It?0:kt;if(H&&this.addCurrentVertex(j,te,Wt,Kt,V),"fakeround"===ln){const rn=Math.round(180*We/Math.PI/20);for(let cn=1;cn<rn;cn++){let jt=cn/rn;if(.5!==jt){const sr=jt-.5;jt+=jt*sr*(jt-1)*((1.0904+Be*(Be*(3.55645-1.43519*Be)-3.2452))*sr*sr+(.848013+Be*(.215638*Be-1.06021)))}const In=_e.sub(te)._mult(jt)._add(te)._unit()._mult(It?-1:1);this.addHalfVertex(j,In.x,In.y,!1,It,0,V)}}X&&this.addCurrentVertex(j,_e,-Wt,-Kt,V)}else if("butt"===ln)this.addCurrentVertex(j,Xe,0,0,V);else if("square"===ln){const kt=H?1:-1;H||this.addCurrentVertex(j,Xe,kt,kt,V),this.addCurrentVertex(j,Xe,0,0,V),H&&this.addCurrentVertex(j,Xe,kt,kt,V)}else"round"===ln&&(H&&(this.addCurrentVertex(j,te,0,0,V),this.addCurrentVertex(j,te,1,1,V,!0)),X&&(this.addCurrentVertex(j,_e,-1,-1,V,!0),this.addCurrentVertex(j,_e,0,0,V)));if(Mt&&Ue<P-1){const kt=j.dist(X);if(kt>2*F){const Wt=j.add(X.sub(j)._mult(F/kt)._round());this.updateDistance(j,Wt),this.addCurrentVertex(Wt,_e,0,0,V),j=Wt}}}}addCurrentVertex(i,a,f,m,w,S=!1){const D=a.y*m-a.x,P=-a.y-a.x*m;this.addHalfVertex(i,a.x+a.y*f,a.y-a.x*f,S,!1,f,w),this.addHalfVertex(i,D,P,S,!0,-m,w)}addHalfVertex({x:i,y:a},f,m,w,S,D,P){this.layoutVertexArray.emplaceBack((i<<1)+(w?1:0),(a<<1)+(S?1:0),Math.round(63*f)+128,Math.round(63*m)+128,1+(0===D?0:D<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const L=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),P.primitiveLength++),S?this.e2=L:this.e1=L}updateScaledDistance(){if(this.lineClips){const i=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=i*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(i,a){this.distance+=i.dist(a),this.updateScaledDistance()}}re(tf,"LineBucket",{omit:["layers","patternFeatures"]});const Eg=new wn({"line-cap":new mt(Rt.layout_line["line-cap"]),"line-join":new mt(Rt.layout_line["line-join"]),"line-miter-limit":new Dt(Rt.layout_line["line-miter-limit"]),"line-round-limit":new Dt(Rt.layout_line["line-round-limit"]),"line-sort-key":new mt(Rt.layout_line["line-sort-key"])});var xy={paint:new wn({"line-opacity":new mt(Rt.paint_line["line-opacity"]),"line-color":new mt(Rt.paint_line["line-color"]),"line-translate":new Dt(Rt.paint_line["line-translate"]),"line-translate-anchor":new Dt(Rt.paint_line["line-translate-anchor"]),"line-width":new mt(Rt.paint_line["line-width"]),"line-gap-width":new mt(Rt.paint_line["line-gap-width"]),"line-offset":new mt(Rt.paint_line["line-offset"]),"line-blur":new mt(Rt.paint_line["line-blur"]),"line-dasharray":new An(Rt.paint_line["line-dasharray"]),"line-pattern":new An(Rt.paint_line["line-pattern"]),"line-gradient":new Cn(Rt.paint_line["line-gradient"]),"line-trim-offset":new Dt(Rt.paint_line["line-trim-offset"])}),layout:Eg};const wy=new class extends mt{possiblyEvaluate(s,i){return i=new Ge(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,zoomHistory:i.zoomHistory,transition:i.transition}),super.possiblyEvaluate(s,i)}evaluate(s,i,a,f){return i=Me({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(s,i,a,f)}}(xy.paint.properties["line-width"].specification);function by(s,i){return i>0?i+2*s:s}wy.useIntegerZoom=!0;const lS=bn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),mw=bn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ov=bn([{name:"a_projected_pos",components:4,type:"Float32"}],4);bn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const sv=bn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Ey=bn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const yw=bn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Cy=bn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);bn([{name:"triangle",components:3,type:"Uint16"}]),bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),bn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),bn([{type:"Float32",name:"offsetX"}]),bn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const rc=128;function Cg(s,i){const{expression:a}=i;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new Ge(s+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:f,interpolationType:m}=a;let w=0;for(;w<f.length&&f[w]<=s;)w++;w=Math.max(0,w-1);let S=w;for(;S<f.length&&f[S]<s+1;)S++;S=Math.min(f.length-1,S);const D=f[w],P=f[S];return"composite"===a.kind?{kind:"composite",minZoom:D,maxZoom:P,interpolationType:m}:{kind:"camera",minZoom:D,maxZoom:P,minSize:a.evaluate(new Ge(D)),maxSize:a.evaluate(new Ge(P)),interpolationType:m}}}function vp(s,{uSize:i,uSizeT:a},{lowerSize:f,upperSize:m}){return"source"===s.kind?f/rc:"composite"===s.kind?ni(f/rc,m/rc,a):i}function ic(s,i){let a=0,f=0;if("constant"===s.kind)f=s.layoutSize;else if("source"!==s.kind){const{interpolationType:m,minZoom:w,maxZoom:S}=s,D=m?ue(ga.interpolationFactor(m,i,w,S),0,1):0;"camera"===s.kind?f=ni(s.minSize,s.maxSize,D):a=D}return{uSizeT:a,uSize:f}}var _w=Object.freeze({__proto__:null,getSizeData:Cg,evaluateSizeForFeature:vp,evaluateSizeForZoom:ic,SIZE_PACK_FACTOR:rc});function Sy(s,i,a){return s.sections.forEach(f=>{f.text=function(m,w,S){const D=w.layout.get("text-transform").evaluate(S,{});return"uppercase"===D?m=m.toLocaleUpperCase():"lowercase"===D&&(m=m.toLocaleLowerCase()),Qe.applyArabicShaping&&(m=Qe.applyArabicShaping(m)),m}(f.text,i,a)}),s}const nf={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function vw(s){return"\ufe36"===s||"\ufe48"===s||"\ufe38"===s||"\ufe44"===s||"\ufe42"===s||"\ufe3e"===s||"\ufe3c"===s||"\ufe3a"===s||"\ufe18"===s||"\ufe40"===s||"\ufe10"===s||"\ufe13"===s||"\ufe14"===s||"\uff40"===s||"\uffe3"===s||"\ufe11"===s||"\ufe12"===s}function Iy(s){return"\ufe35"===s||"\ufe47"===s||"\ufe37"===s||"\ufe43"===s||"\ufe41"===s||"\ufe3d"===s||"\ufe3b"===s||"\ufe39"===s||"\ufe17"===s||"\ufe3f"===s}var rf=Io,Zc=function(s,i,a,f,m){var w,S,D=8*m-f-1,P=(1<<D)-1,L=P>>1,F=-7,V=a?m-1:0,j=a?-1:1,H=s[i+V];for(V+=j,w=H&(1<<-F)-1,H>>=-F,F+=D;F>0;w=256*w+s[i+V],V+=j,F-=8);for(S=w&(1<<-F)-1,w>>=-F,F+=f;F>0;S=256*S+s[i+V],V+=j,F-=8);if(0===w)w=1-L;else{if(w===P)return S?NaN:1/0*(H?-1:1);S+=Math.pow(2,f),w-=L}return(H?-1:1)*S*Math.pow(2,w-f)},Ty=function(s,i,a,f,m,w){var S,D,P,L=8*w-m-1,F=(1<<L)-1,V=F>>1,j=23===m?Math.pow(2,-24)-Math.pow(2,-77):0,H=f?0:w-1,X=f?1:-1,te=i<0||0===i&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(D=isNaN(i)?1:0,S=F):(S=Math.floor(Math.log(i)/Math.LN2),i*(P=Math.pow(2,-S))<1&&(S--,P*=2),(i+=S+V>=1?j/P:j*Math.pow(2,1-V))*P>=2&&(S++,P/=2),S+V>=F?(D=0,S=F):S+V>=1?(D=(i*P-1)*Math.pow(2,m),S+=V):(D=i*Math.pow(2,V-1)*Math.pow(2,m),S=0));m>=8;s[a+H]=255&D,H+=X,D/=256,m-=8);for(S=S<<m|D,L+=m;L>0;s[a+H]=255&S,H+=X,S/=256,L-=8);s[a+H-X]|=128*te};function Io(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Io.Varint=0,Io.Fixed64=1,Io.Bytes=2,Io.Fixed32=5;var Dy=4294967296,av=1/Dy,My=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function al(s){return s.type===Io.Bytes?s.readVarint()+s.pos:s.pos+1}function uv(s,i,a){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));a.realloc(f);for(var m=a.pos-1;m>=s;m--)a.buf[m+f]=a.buf[m]}function xw(s,i){for(var a=0;a<s.length;a++)i.writeVarint(s[a])}function Ay(s,i){for(var a=0;a<s.length;a++)i.writeSVarint(s[a])}function ww(s,i){for(var a=0;a<s.length;a++)i.writeFloat(s[a])}function lv(s,i){for(var a=0;a<s.length;a++)i.writeDouble(s[a])}function bw(s,i){for(var a=0;a<s.length;a++)i.writeBoolean(s[a])}function cv(s,i){for(var a=0;a<s.length;a++)i.writeFixed32(s[a])}function cS(s,i){for(var a=0;a<s.length;a++)i.writeSFixed32(s[a])}function Ew(s,i){for(var a=0;a<s.length;a++)i.writeFixed64(s[a])}function xp(s,i){for(var a=0;a<s.length;a++)i.writeSFixed64(s[a])}function Sg(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function Ic(s,i,a){s[a]=i,s[a+1]=i>>>8,s[a+2]=i>>>16,s[a+3]=i>>>24}function wh(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}function Cw(s,i,a){i.glyphs=[],1===s&&a.readMessage(hv,i)}function hv(s,i,a){if(3===s){const{id:f,bitmap:m,width:w,height:S,left:D,top:P,advance:L}=a.readMessage(Ig,{});i.glyphs.push({id:f,bitmap:new Hu({width:w+6,height:S+6},m),metrics:{width:w,height:S,left:D,top:P,advance:L}})}else 4===s?i.ascender=a.readSVarint():5===s&&(i.descender=a.readSVarint())}function Ig(s,i,a){1===s?i.id=a.readVarint():2===s?i.bitmap=a.readBytes():3===s?i.width=a.readVarint():4===s?i.height=a.readVarint():5===s?i.left=a.readSVarint():6===s?i.top=a.readSVarint():7===s&&(i.advance=a.readVarint())}function Py(s){let i=0,a=0;for(const S of s)i+=S.w*S.h,a=Math.max(a,S.w);s.sort((S,D)=>D.h-S.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),a),h:1/0}];let m=0,w=0;for(const S of s)for(let D=f.length-1;D>=0;D--){const P=f[D];if(!(S.w>P.w||S.h>P.h)){if(S.x=P.x,S.y=P.y,w=Math.max(w,S.y+S.h),m=Math.max(m,S.x+S.w),S.w===P.w&&S.h===P.h){const L=f.pop();D<f.length&&(f[D]=L)}else S.h===P.h?(P.x+=S.w,P.w-=S.w):S.w===P.w?(P.y+=S.h,P.h-=S.h):(f.push({x:P.x+S.w,y:P.y,w:P.w-S.w,h:S.h}),P.y+=S.h,P.h-=S.h);break}}return{w:m,h:w,fill:i/(m*w)||0}}Io.prototype={destroy:function(){this.buf=null},readFields:function(s,i,a){for(a=a||this.length;this.pos<a;){var f=this.readVarint(),m=f>>3,w=this.pos;this.type=7&f,s(m,i,this),this.pos===w&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Sg(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=wh(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Sg(this.buf,this.pos)+Sg(this.buf,this.pos+4)*Dy;return this.pos+=8,s},readSFixed64:function(){var s=Sg(this.buf,this.pos)+wh(this.buf,this.pos+4)*Dy;return this.pos+=8,s},readFloat:function(){var s=Zc(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=Zc(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,a,f=this.buf;return i=127&(a=f[this.pos++]),a<128?i:(i|=(127&(a=f[this.pos++]))<<7,a<128?i:(i|=(127&(a=f[this.pos++]))<<14,a<128?i:(i|=(127&(a=f[this.pos++]))<<21,a<128?i:function(m,w,S){var D,P,L=S.buf;if(D=(112&(P=L[S.pos++]))>>4,P<128||(D|=(127&(P=L[S.pos++]))<<3,P<128)||(D|=(127&(P=L[S.pos++]))<<10,P<128)||(D|=(127&(P=L[S.pos++]))<<17,P<128)||(D|=(127&(P=L[S.pos++]))<<24,P<128)||(D|=(1&(P=L[S.pos++]))<<31,P<128))return function Dd(s,i,a){return a?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}(m,D,w);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(a=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&My?My.decode(this.buf.subarray(i,s)):function(a,f,m){for(var w="",S=f;S<m;){var D,P,L,F=a[S],V=null,j=F>239?4:F>223?3:F>191?2:1;if(S+j>m)break;1===j?F<128&&(V=F):2===j?128==(192&(D=a[S+1]))&&(V=(31&F)<<6|63&D)<=127&&(V=null):3===j?(P=a[S+2],128==(192&(D=a[S+1]))&&128==(192&P)&&((V=(15&F)<<12|(63&D)<<6|63&P)<=2047||V>=55296&&V<=57343)&&(V=null)):4===j&&(P=a[S+2],L=a[S+3],128==(192&(D=a[S+1]))&&128==(192&P)&&128==(192&L)&&((V=(15&F)<<18|(63&D)<<12|(63&P)<<6|63&L)<=65535||V>=1114112)&&(V=null)),null===V?(V=65533,j=1):V>65535&&(V-=65536,w+=String.fromCharCode(V>>>10&1023|55296),V=56320|1023&V),w+=String.fromCharCode(V),S+=j}return w}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Io.Bytes)return s.push(this.readVarint(i));var a=al(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Io.Bytes)return s.push(this.readSVarint());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Io.Bytes)return s.push(this.readBoolean());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Io.Bytes)return s.push(this.readFloat());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Io.Bytes)return s.push(this.readDouble());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Io.Bytes)return s.push(this.readFixed32());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Io.Bytes)return s.push(this.readSFixed32());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Io.Bytes)return s.push(this.readFixed64());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Io.Bytes)return s.push(this.readSFixed64());var i=al(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Io.Varint)for(;this.buf[this.pos++]>127;);else if(i===Io.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Io.Fixed32)this.pos+=4;else{if(i!==Io.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var a=new Uint8Array(i);a.set(this.buf),this.buf=a,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Ic(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Ic(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Ic(this.buf,-1&s,this.pos),Ic(this.buf,Math.floor(s*av),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Ic(this.buf,-1&s,this.pos),Ic(this.buf,Math.floor(s*av),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,a){var f,m,w,D;if(i>=0?(f=i%4294967296|0,m=i/4294967296|0):(m=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,m=m+1|0)),i>=0x10000000000000000||i<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),w=f,(D=a).buf[D.pos++]=127&w|128,w>>>=7,D.buf[D.pos++]=127&w|128,w>>>=7,D.buf[D.pos++]=127&w|128,w>>>=7,D.buf[D.pos++]=127&w|128,D.buf[D.pos]=127&(w>>>=7),function(w,S){var D=(7&w)<<4;S.buf[S.pos++]|=D|((w>>>=3)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w|((w>>>=7)?128:0),w&&(S.buf[S.pos++]=127&w)))))}(m,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(Boolean(s))},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,m,w){for(var S,D,P=0;P<m.length;P++){if((S=m.charCodeAt(P))>55295&&S<57344){if(!D){S>56319||P+1===m.length?(f[w++]=239,f[w++]=191,f[w++]=189):D=S;continue}if(S<56320){f[w++]=239,f[w++]=191,f[w++]=189,D=S;continue}S=D-55296<<10|S-56320|65536,D=null}else D&&(f[w++]=239,f[w++]=191,f[w++]=189,D=null);S<128?f[w++]=S:(S<2048?f[w++]=S>>6|192:(S<65536?f[w++]=S>>12|224:(f[w++]=S>>18|240,f[w++]=S>>12&63|128),f[w++]=S>>6&63|128),f[w++]=63&S|128)}return w}(this.buf,s,this.pos);var a=this.pos-i;a>=128&&uv(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),Ty(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),Ty(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var a=0;a<i;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,i){this.pos++;var a=this.pos;s(i,this);var f=this.pos-a;f>=128&&uv(a,f,this),this.pos=a-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,a){this.writeTag(s,Io.Bytes),this.writeRawMessage(i,a)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,xw,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,Ay,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,bw,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,ww,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,lv,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,cv,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,cS,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,Ew,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,xp,i)},writeBytesField:function(s,i){this.writeTag(s,Io.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Io.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Io.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Io.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Io.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Io.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Io.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Io.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Io.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Io.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,Boolean(i))}};class Ry{constructor(i,{pixelRatio:a,version:f,stretchX:m,stretchY:w,content:S}){this.paddedRect=i,this.pixelRatio=a,this.stretchX=m,this.stretchY=w,this.content=S,this.version=f}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class wp{constructor(i,a){const f={},m={};this.haveRenderCallbacks=[];const w=[];this.addImages(i,f,w),this.addImages(a,m,w);const{w:S,h:D}=Py(w),P=new Xu({width:S||1,height:D||1});for(const L in i){const F=i[L],V=f[L].paddedRect;Xu.copy(F.data,P,{x:0,y:0},{x:V.x+1,y:V.y+1},F.data)}for(const L in a){const F=a[L],V=m[L].paddedRect,j=V.x+1,H=V.y+1,X=F.data.width,te=F.data.height;Xu.copy(F.data,P,{x:0,y:0},{x:j,y:H},F.data),Xu.copy(F.data,P,{x:0,y:te-1},{x:j,y:H-1},{width:X,height:1}),Xu.copy(F.data,P,{x:0,y:0},{x:j,y:H+te},{width:X,height:1}),Xu.copy(F.data,P,{x:X-1,y:0},{x:j-1,y:H},{width:1,height:te}),Xu.copy(F.data,P,{x:0,y:0},{x:j+X,y:H},{width:1,height:te})}this.image=P,this.iconPositions=f,this.patternPositions=m}addImages(i,a,f){for(const m in i){const w=i[m],S={x:0,y:0,w:w.data.width+2,h:w.data.height+2};f.push(S),a[m]=new Ry(S,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(m)}}patchUpdatedImages(i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>i.hasImage(f)),i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),a),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),a)}patchUpdatedImage(i,a,f){if(!i||!a||i.version===a.version)return;i.version=a.version;const[m,w]=i.tl;f.update(a.data,void 0,{x:m,y:w})}}re(Ry,"ImagePosition"),re(wp,"ImageAtlas");const Al={horizontal:1,vertical:2,horizontalOnly:3};class Vf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,a){const f=new Vf;return f.scale=i||1,f.fontStack=a,f}static forImage(i){const a=new Vf;return a.imageName=i,a}}class sf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,a){const f=new sf;for(let m=0;m<i.sections.length;m++){const w=i.sections[m];w.image?f.addImageSection(w):f.addTextSection(w,a)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSections(){return this.sections}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(i){this.text=function(a,f){let m="";for(let w=0;w<a.length;w++){const S=a.charCodeAt(w+1)||null,D=a.charCodeAt(w-1)||null;m+=!f&&(S&&O(S)&&!nf[a[w+1]]||D&&O(D)&&!nf[a[w-1]])||!nf[a[w]]?a[w]:nf[a[w]]}return m}(this.text,i)}trim(){let i=0;for(let f=0;f<this.text.length&&Md[this.text.charCodeAt(f)];f++)i++;let a=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Md[this.text.charCodeAt(f)];f--)a--;this.text=this.text.substring(i,a),this.sectionIndex=this.sectionIndex.slice(i,a)}substring(i,a){const f=new sf;return f.text=this.text.substring(i,a),f.sectionIndex=this.sectionIndex.slice(i,a),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,a)=>Math.max(i,this.sections[a].scale),0)}addTextSection(i,a){this.text+=i.text,this.sections.push(Vf.forText(i.scale,i.fontStack||a));const f=this.sections.length-1;for(let m=0;m<i.text.length;++m)this.sectionIndex.push(f)}addImageSection(i){const a=i.image?i.image.name:"";if(0===a.length)return void Sn("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(Vf.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Sn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ly(s,i,a,f,m,w,S,D,P,L,F,V,j,H,X){const te=sf.fromFeature(s,m);V===Al.vertical&&te.verticalizePunctuation(j);let _e=[];const Ue=function(We,Mt,It,Ht,ln,kt){if(!We)return[];const Wt=[],Kt=function(In,sr,Ln,Gn,Dn,fr){let Dr=0;for(let Or=0;Or<In.length();Or++){const yi=In.getSection(Or);Dr+=fv(In.getCharCode(Or),yi,Gn,Dn,sr,fr)}return Dr/Math.max(1,Math.ceil(Dr/Ln))}(We,Mt,It,Ht,ln,kt),rn=We.text.indexOf("\u200b")>=0;let cn=0;for(let In=0;In<We.length();In++){const sr=We.getSection(In),Ln=We.getCharCode(In);if(Md[Ln]||(cn+=fv(Ln,sr,Ht,ln,Mt,kt)),In<We.length()-1){const Gn=!((jt=Ln)<11904||!(Tf(jt)||Jd(jt)||Hh(jt)||cd(jt)||dh(jt)||Bo(jt)||Ja(jt)||Va(jt)||Jl(jt)||Qd(jt)||ld(jt)||l(jt)||Yl(jt)||Ss(jt)||xs(jt)||Kl(jt)||If(jt)||ep(jt)||Hp(jt)||Df(jt)));(Ad[Ln]||Gn||sr.imageName)&&Wt.push(pv(In+1,cn,Kt,Wt,Sw(Ln,We.getCharCode(In+1),Gn&&rn),!1))}}var jt;return Oy(pv(We.length(),cn,Kt,Wt,0,!0))}(te,L,w,i,f,H),{processBidirectionalText:Xe,processStyledBidirectionalText:Be}=Qe;if(Xe&&1===te.sections.length){const We=Xe(te.toString(),Ue);for(const Mt of We){const It=new sf;It.text=Mt,It.sections=te.sections;for(let Ht=0;Ht<Mt.length;Ht++)It.sectionIndex.push(0);_e.push(It)}}else if(Be){const We=Be(te.text,te.sectionIndex,Ue);for(const Mt of We){const It=new sf;It.text=Mt[0],It.sectionIndex=Mt[1],It.sections=te.sections,_e.push(It)}}else _e=function(We,Mt){const It=[],Ht=We.text;let ln=0;for(const kt of Mt)It.push(We.substring(ln,kt)),ln=kt;return ln<Ht.length&&It.push(We.substring(ln,Ht.length)),It}(te,Ue);const Ze=[],rt={positionedLines:Ze,text:te.toString(),top:F[1],bottom:F[1],left:F[0],right:F[0],writingMode:V,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(We,Mt,It,Ht,ln,kt,Wt,Kt,rn,cn,jt,In){let sr=0,Ln=0,Gn=0;const Dn="right"===Kt?1:"left"===Kt?0:.5;let fr=!1;for(const Zr of ln){const ii=Zr.getSections();for(const Ti of ii){if(Ti.imageName)continue;const Lo=Mt[Ti.fontStack];if(Lo&&(fr=void 0!==Lo.ascender&&void 0!==Lo.descender,!fr))break}if(!fr)break}let Dr=0;for(const Zr of ln){Zr.trim();const ii=Zr.getMaxScale(),Ti=24*(ii-1),Lo={positionedGlyphs:[],lineOffset:0};We.positionedLines[Dr]=Lo;const Uo=Lo.positionedGlyphs;let Ir=0;if(!Zr.length()){Ln+=kt,++Dr;continue}let Ar=0,lo=0;for(let co=0;co<Zr.length();co++){const Gs=Zr.getSection(co),$s=Zr.getSectionIndex(co),wi=Zr.getCharCode(co);let Jo=Gs.scale,la=null,xo=null,Pi=null,nu=24,Ga=0;const Aa=!(rn===Al.horizontal||!jt&&!M(wi)||jt&&(Md[wi]||(Or=wi,Un(Or)||Qn(Or)||Sr(Or)||Mf(Or)||v(Or))));if(Gs.imageName){const yu=Ht[Gs.imageName];if(!yu)continue;Pi=Gs.imageName,We.iconsInText=We.iconsInText||!0,xo=yu.paddedRect;const Pa=yu.displaySize;Jo=24*Jo/In,la={width:Pa[0],height:Pa[1],left:1,top:-3,advance:Aa?Pa[1]:Pa[0],localGlyph:!1},Ga=fr?-la.height*Jo:24*ii-17-Pa[1]*Jo,nu=la.advance;const Ih=(Aa?Pa[0]:Pa[1])*Jo-24*ii;Ih>0&&Ih>Ir&&(Ir=Ih)}else{const yu=It[Gs.fontStack];if(!yu)continue;yu[wi]&&(xo=yu[wi]);const Pa=Mt[Gs.fontStack];if(!Pa)continue;const Ih=Pa.glyphs[wi];if(!Ih)continue;if(la=Ih.metrics,nu=8203!==wi?24:0,fr){const Ud=void 0!==Pa.ascender?Math.abs(Pa.ascender):0,Pp=void 0!==Pa.descender?Math.abs(Pa.descender):0,Rp=(Ud+Pp)*Jo;Ar<Rp&&(Ar=Rp,lo=(Ud-Pp)/2*Jo),Ga=-Ud*Jo}else Ga=24*(ii-Jo)-17}Aa?(We.verticalizable=!0,Uo.push({glyph:wi,imageName:Pi,x:sr,y:Ln+Ga,vertical:Aa,scale:Jo,localGlyph:la.localGlyph,fontStack:Gs.fontStack,sectionIndex:$s,metrics:la,rect:xo}),sr+=nu*Jo+cn):(Uo.push({glyph:wi,imageName:Pi,x:sr,y:Ln+Ga,vertical:Aa,scale:Jo,localGlyph:la.localGlyph,fontStack:Gs.fontStack,sectionIndex:$s,metrics:la,rect:xo}),sr+=la.advance*Jo+cn)}0!==Uo.length&&(Gn=Math.max(sr-cn,Gn),fr?gv(Uo,Dn,Ir,lo,kt*ii/2):gv(Uo,Dn,Ir,0,kt/2)),sr=0;const ja=kt*ii+Ir;Lo.lineOffset=Math.max(Ir,Ti),Ln+=ja,++Dr}var Or;const yi=Ln,{horizontalAlign:Mr,verticalAlign:Ko}=Ny(Wt);(function(Zr,ii,Ti,Lo,Uo,Ir){const Ar=(ii-Ti)*Uo,lo=-Ir*Lo;for(const ja of Zr)for(const co of ja.positionedGlyphs)co.x+=Ar,co.y+=lo})(We.positionedLines,Dn,Mr,Ko,Gn,yi),We.top+=-Ko*yi,We.bottom=We.top+yi,We.left+=-Mr*Gn,We.right=We.left+Gn,We.hasBaseline=fr}(rt,i,a,f,_e,S,D,P,V,L,j,X),!function(We){for(const Mt of We)if(0!==Mt.positionedGlyphs.length)return!1;return!0}(Ze)&&rt}const Md={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ad={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function fv(s,i,a,f,m,w){if(i.imageName){const S=f[i.imageName];return S?S.displaySize[0]*i.scale*24/w+m:0}{const S=a[i.fontStack],D=S&&S.glyphs[s];return D?D.metrics.advance*i.scale+m:0}}function dv(s,i,a,f){const m=Math.pow(s-i,2);return f?s<i?m/2:2*m:m+Math.abs(a)*a}function Sw(s,i,a){let f=0;return 10===s&&(f-=1e4),a&&(f+=150),40!==s&&65288!==s||(f+=50),41!==i&&65289!==i||(f+=50),f}function pv(s,i,a,f,m,w){let S=null,D=dv(i,a,m,w);for(const P of f){const L=dv(i-P.x,a,m,w)+P.badness;L<=D&&(S=P,D=L)}return{index:s,x:i,priorBreak:S,badness:D}}function Oy(s){return s?Oy(s.priorBreak).concat(s.index):[]}function Ny(s){let i=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:i,verticalAlign:a}}function gv(s,i,a,f,m){if(!(i||a||f||m))return;const w=s.length-1,S=s[w],D=(S.x+S.metrics.advance*S.scale)*i;for(let P=0;P<=w;P++)s[P].x-=D,s[P].y+=a+f+m}function Pd(s,i,a){const{horizontalAlign:f,verticalAlign:m}=Ny(a),w=i[0]-s.displaySize[0]*f,S=i[1]-s.displaySize[1]*m;return{image:s,top:S,bottom:S+s.displaySize[1],left:w,right:w+s.displaySize[0]}}function Wc(s,i,a,f,m,w){const S=s.image;let D;if(S.content){const _e=S.content,Ue=S.pixelRatio||1;D=[_e[0]/Ue,_e[1]/Ue,S.displaySize[0]-_e[2]/Ue,S.displaySize[1]-_e[3]/Ue]}const P=i.left*w,L=i.right*w;let F,V,j,H;"width"===a||"both"===a?(H=m[0]+P-f[3],V=m[0]+L+f[1]):(H=m[0]+(P+L-S.displaySize[0])/2,V=H+S.displaySize[0]);const X=i.top*w,te=i.bottom*w;return"height"===a||"both"===a?(F=m[1]+X-f[0],j=m[1]+te+f[2]):(F=m[1]+(X+te-S.displaySize[1])/2,j=F+S.displaySize[1]),{image:S,top:F,right:V,bottom:j,left:H,collisionPadding:D}}class bh extends Y{constructor(i,a,f,m,w){super(i,a),this.angle=m,this.z=f,void 0!==w&&(this.segment=w)}clone(){return new bh(this.x,this.y,this.z,this.angle,this.segment)}}function mv(s,i,a,f,m){if(void 0===i.segment)return!0;let w=i,S=i.segment+1,D=0;for(;D>-a/2;){if(S--,S<0)return!1;D-=s[S].dist(w),w=s[S]}D+=s[S].dist(s[S+1]),S++;const P=[];let L=0;for(;D<a/2;){const F=s[S],V=s[S+1];if(!V)return!1;let j=s[S-1].angleTo(F)-F.angleTo(V);for(j=Math.abs((j+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:D,angleDelta:j}),L+=j;D-P[0].distance>f;)L-=P.shift().angleDelta;if(L>m)return!1;S++,D+=F.dist(V)}return!0}function Iw(s){let i=0;for(let a=0;a<s.length-1;a++)i+=s[a].dist(s[a+1]);return i}function Tw(s,i,a){return s?.6*i*a:0}function ky(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function hS(s,i,a,f,m,w){const S=Tw(a,m,w),D=ky(a,f)*w;let P=0;const L=Iw(s)/2;for(let F=0;F<s.length-1;F++){const V=s[F],j=s[F+1],H=V.dist(j);if(P+H>L){const X=(L-P)/H,te=ni(V.x,j.x,X),_e=ni(V.y,j.y,X),Ue=new bh(te,_e,0,j.angleTo(V),F);return!S||mv(s,Ue,D,S,i)?Ue:void 0}P+=H}}function yv(s,i,a,f,m,w,S,D,P){const L=Tw(f,w,S),F=ky(f,m),V=F*S,j=0===s[0].x||s[0].x===P||0===s[0].y||s[0].y===P;return i-V<i/4&&(i=V+i/4),Fy(s,j?i/2*D%i:(F/2+2*w)*S*D%i,i,L,a,V,j,!1,P)}function Fy(s,i,a,f,m,w,S,D,P){const L=w/2,F=Iw(s);let V=0,j=i-a,H=[];for(let X=0;X<s.length-1;X++){const te=s[X],_e=s[X+1],Ue=te.dist(_e),Xe=_e.angleTo(te);for(;j+a<V+Ue;){j+=a;const Be=(j-V)/Ue,Ze=ni(te.x,_e.x,Be),rt=ni(te.y,_e.y,Be);if(Ze>=0&&Ze<P&&rt>=0&&rt<P&&j-L>=0&&j+L<=F){const We=new bh(Ze,rt,0,Xe,X);We._round(),f&&!mv(s,We,w,f,m)||H.push(We)}}V+=Ue}return D||H.length||S||(H=Fy(s,V/2,a,f,m,w,S,!0,P)),H}function _v(s,i,a,f,m){const w=[];for(let S=0;S<s.length;S++){const D=s[S];let P;for(let L=0;L<D.length-1;L++){let F=D[L],V=D[L+1];F.x<i&&V.x<i||(F.x<i?F=new Y(i,F.y+(i-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x<i&&(V=new Y(i,F.y+(i-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y<a&&V.y<a||(F.y<a?F=new Y(F.x+(a-F.y)/(V.y-F.y)*(V.x-F.x),a)._round():V.y<a&&(V=new Y(F.x+(a-F.y)/(V.y-F.y)*(V.x-F.x),a)._round()),F.x>=f&&V.x>=f||(F.x>=f?F=new Y(f,F.y+(f-F.x)/(V.x-F.x)*(V.y-F.y))._round():V.x>=f&&(V=new Y(f,F.y+(f-F.x)/(V.x-F.x)*(V.y-F.y))._round()),F.y>=m&&V.y>=m||(F.y>=m?F=new Y(F.x+(m-F.y)/(V.y-F.y)*(V.x-F.x),m)._round():V.y>=m&&(V=new Y(F.x+(m-F.y)/(V.y-F.y)*(V.x-F.x),m)._round()),P&&F.equals(P[P.length-1])||(P=[F],w.push(P)),P.push(V)))))}}return w}re(bh,"Anchor");const Rd=1e20;function vv(s,i,a,f,m,w,S,D,P){for(let L=i;L<i+f;L++)xv(s,a*w+L,w,m,S,D,P);for(let L=a;L<a+m;L++)xv(s,L*w+i,1,f,S,D,P)}function xv(s,i,a,f,m,w,S){w[0]=0,S[0]=-Rd,S[1]=Rd,m[0]=s[i];for(let D=1,P=0,L=0;D<f;D++){m[D]=s[i+D*a];const F=D*D;do{const V=w[P];L=(m[D]-m[V]+F-V*V)/(D-V)/2}while(L<=S[P]&&--P>-1);P++,w[P]=D,S[P]=L,S[P+1]=Rd}for(let D=0,P=0;D<f;D++){for(;S[P+1]<D;)P++;const L=w[P],F=D-L;s[i+D*a]=m[L]+F*F}}const Pl={none:0,ideographs:1,all:2};class Ld{constructor(i,a,f){this.requestManager=i,this.localGlyphMode=a,this.localFontFamily=f,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(i){this.url=i}getGlyphs(i,a){const f=[];for(const m in i)for(const w of i[m])f.push({stack:m,id:w});Pe(f,({stack:m,id:w},S)=>{let D=this.entries[m];D||(D=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let P=D.glyphs[w];if(void 0!==P)return void S(null,{stack:m,id:w,glyph:P});if(P=this._tinySDF(D,m,w),P)return D.glyphs[w]=P,void S(null,{stack:m,id:w,glyph:P});const L=Math.floor(w/256);if(256*L>65535)return void S(new Error("glyphs > 65535 not supported"));if(D.ranges[L])return void S(null,{stack:m,id:w,glyph:P});let F=D.requests[L];F||(F=D.requests[L]=[],Ld.loadGlyphRange(m,L,this.url,this.requestManager,(V,j)=>{if(j){D.ascender=j.ascender,D.descender=j.descender;for(const H in j.glyphs)this._doesCharSupportLocalGlyph(+H)||(D.glyphs[+H]=j.glyphs[+H]);D.ranges[L]=!0}for(const H of F)H(V,j);delete D.requests[L]})),F.push((V,j)=>{V?S(V):j&&S(null,{stack:m,id:w,glyph:j.glyphs[w]||null})})},(m,w)=>{if(m)a(m);else if(w){const S={};for(const{stack:D,id:P,glyph:L}of w)void 0===S[D]&&(S[D]={}),void 0===S[D].glyphs&&(S[D].glyphs={}),S[D].glyphs[P]=L&&{id:L.id,bitmap:L.bitmap.clone(),metrics:L.metrics},S[D].ascender=this.entries[D].ascender,S[D].descender=this.entries[D].descender;a(null,S)}})}_doesCharSupportLocalGlyph(i){return this.localGlyphMode!==Pl.none&&(this.localGlyphMode===Pl.all?!!this.localFontFamily:!!this.localFontFamily&&(Qd(i)||Xp(i)||Yl(i)||If(i)||Va(i)))}_tinySDF(i,a,f){const m=this.localFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let w=i.tinySDF;if(!w){let te="400";/bold/i.test(a)?te="900":/medium/i.test(a)?te="500":/light/i.test(a)&&(te="200"),w=i.tinySDF=new Ld.TinySDF({fontFamily:m,fontWeight:te,fontSize:48,buffer:6,radius:16}),w.fontWeight=te}if(this.localGlyphs[w.fontWeight][f])return this.localGlyphs[w.fontWeight][f];const S=String.fromCharCode(f),{data:D,width:P,height:L,glyphWidth:F,glyphHeight:V,glyphLeft:j,glyphTop:H,glyphAdvance:X}=w.draw(S);return this.localGlyphs[w.fontWeight][f]={id:f,bitmap:new Hu({width:P,height:L},D),metrics:{width:F/2,height:V/2,left:j/2,top:H/2-27,advance:X/2,localGlyph:!0}}}}function zy(s,i,a,f){const m=[],w=s.image,S=w.pixelRatio,D=w.paddedRect.w-2,P=w.paddedRect.h-2,L=s.right-s.left,F=s.bottom-s.top,V=w.stretchX||[[0,D]],j=w.stretchY||[[0,P]],H=(kt,Wt)=>kt+Wt[1]-Wt[0],X=V.reduce(H,0),te=j.reduce(H,0),_e=D-X,Ue=P-te;let Xe=0,Be=X,Ze=0,rt=te,We=0,Mt=_e,It=0,Ht=Ue;if(w.content&&f){const kt=w.content;Xe=Tg(V,0,kt[0]),Ze=Tg(j,0,kt[1]),Be=Tg(V,kt[0],kt[2]),rt=Tg(j,kt[1],kt[3]),We=kt[0]-Xe,It=kt[1]-Ze,Mt=kt[2]-kt[0]-Be,Ht=kt[3]-kt[1]-rt}const ln=(kt,Wt,Kt,rn)=>{const cn=Dg(kt.stretch-Xe,Be,L,s.left),jt=Mg(kt.fixed-We,Mt,kt.stretch,X),In=Dg(Wt.stretch-Ze,rt,F,s.top),sr=Mg(Wt.fixed-It,Ht,Wt.stretch,te),Ln=Dg(Kt.stretch-Xe,Be,L,s.left),Gn=Mg(Kt.fixed-We,Mt,Kt.stretch,X),Dn=Dg(rn.stretch-Ze,rt,F,s.top),fr=Mg(rn.fixed-It,Ht,rn.stretch,te),Dr=new Y(cn,In),Or=new Y(Ln,In),yi=new Y(Ln,Dn),Mr=new Y(cn,Dn),Ko=new Y(jt/S,sr/S),Zr=new Y(Gn/S,fr/S),ii=i*Math.PI/180;if(ii){const Uo=Math.sin(ii),Ir=Math.cos(ii),Ar=[Ir,-Uo,Uo,Ir];Dr._matMult(Ar),Or._matMult(Ar),Mr._matMult(Ar),yi._matMult(Ar)}const Ti=kt.stretch+kt.fixed,Lo=Wt.stretch+Wt.fixed;return{tl:Dr,tr:Or,bl:Mr,br:yi,tex:{x:w.paddedRect.x+1+Ti,y:w.paddedRect.y+1+Lo,w:Kt.stretch+Kt.fixed-Ti,h:rn.stretch+rn.fixed-Lo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ko,pixelOffsetBR:Zr,minFontScaleX:Mt/S/L,minFontScaleY:Ht/S/F,isSDF:a}};if(f&&(w.stretchX||w.stretchY)){const kt=wv(V,_e,X),Wt=wv(j,Ue,te);for(let Kt=0;Kt<kt.length-1;Kt++){const rn=kt[Kt],cn=kt[Kt+1];for(let jt=0;jt<Wt.length-1;jt++)m.push(ln(rn,Wt[jt],cn,Wt[jt+1]))}}else m.push(ln({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:D+1},{fixed:0,stretch:P+1}));return m}function Tg(s,i,a){let f=0;for(const m of s)f+=Math.max(i,Math.min(a,m[1]))-Math.max(i,Math.min(a,m[0]));return f}function wv(s,i,a){const f=[{fixed:-1,stretch:0}];for(const[m,w]of s){const S=f[f.length-1];f.push({fixed:m-S.stretch,stretch:S.stretch}),f.push({fixed:m-S.stretch,stretch:S.stretch+(w-m)})}return f.push({fixed:i+1,stretch:a}),f}function Dg(s,i,a,f){return s/i*a+f}function Mg(s,i,a,f){return s-i*a/f}function bv(s,i,a,f){const m=i+s.positionedLines[f].lineOffset;return 0===f?a+m/2:a+(m+(i+s.positionedLines[f-1].lineOffset))/2}Ld.loadGlyphRange=function(s,i,a,f,m){const w=256*i,S=w+255,D=f.transformRequest(f.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${w}-${S}`),lr.Glyphs);qr(D,(P,L)=>{if(P)m(P);else if(L){const F={},V=new rf(L).readFields(Cw,{});for(const j of V.glyphs)F[j.id]=j;m(null,{glyphs:F,ascender:V.ascender,descender:V.descender})}})},Ld.TinySDF=class{constructor({fontSize:s=24,buffer:i=3,radius:a=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:w="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=a;const D=this.size=s+4*i,P=this._createCanvas(D),L=this.ctx=P.getContext("2d",{willReadFrequently:!0});L.font=`${S} ${w} ${s}px ${m}`,L.textBaseline="alphabetic",L.textAlign="left",L.fillStyle="black",this.gridOuter=new Float64Array(D*D),this.gridInner=new Float64Array(D*D),this.f=new Float64Array(D),this.z=new Float64Array(D+1),this.v=new Uint16Array(D)}_createCanvas(s){const i=document.createElement("canvas");return i.width=i.height=s,i}draw(s){const{width:i,actualBoundingBoxAscent:a,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:w}=this.ctx.measureText(s),S=Math.ceil(a),D=Math.min(this.size-this.buffer,Math.ceil(w-m)),P=Math.min(this.size-this.buffer,S+Math.ceil(f)),L=D+2*this.buffer,F=P+2*this.buffer,V=Math.max(L*F,0),j=new Uint8ClampedArray(V),H={data:j,width:L,height:F,glyphWidth:D,glyphHeight:P,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(0===D||0===P)return H;const{ctx:X,buffer:te,gridInner:_e,gridOuter:Ue}=this;X.clearRect(te,te,D,P),X.fillText(s,te,te+S);const Xe=X.getImageData(te,te,D,P);Ue.fill(Rd,0,V),_e.fill(0,0,V);for(let Be=0;Be<P;Be++)for(let Ze=0;Ze<D;Ze++){const rt=Xe.data[4*(Be*D+Ze)+3]/255;if(0===rt)continue;const We=(Be+te)*L+Ze+te;if(1===rt)Ue[We]=0,_e[We]=Rd;else{const Mt=.5-rt;Ue[We]=Mt>0?Mt*Mt:0,_e[We]=Mt<0?Mt*Mt:0}}vv(Ue,0,0,L,F,L,this.f,this.v,this.z),vv(_e,te,te,D,P,L,this.f,this.v,this.z);for(let Be=0;Be<V;Be++){const Ze=Math.sqrt(Ue[Be])-Math.sqrt(_e[Be]);j[Be]=Math.round(255-255*(Ze/this.radius+this.cutoff))}return H}};class Dw{constructor(i=[],a=Mw){if(this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:a,compare:f}=this,m=a[i];for(;i>0;){const w=i-1>>1,S=a[w];if(f(m,S)>=0)break;a[i]=S,i=w}a[i]=m}_down(i){const{data:a,compare:f}=this,m=this.length>>1,w=a[i];for(;i<m;){let S=1+(i<<1),D=a[S];const P=S+1;if(P<this.length&&f(a[P],D)<0&&(S=P,D=a[P]),f(D,w)>=0)break;a[i]=D,i=S}a[i]=w}}function Mw(s,i){return s<i?-1:s>i?1:0}function Aw(s,i=1,a=!1){let f=1/0,m=1/0,w=-1/0,S=-1/0;const D=s[0];for(let H=0;H<D.length;H++){const X=D[H];(!H||X.x<f)&&(f=X.x),(!H||X.y<m)&&(m=X.y),(!H||X.x>w)&&(w=X.x),(!H||X.y>S)&&(S=X.y)}const P=Math.min(w-f,S-m);let L=P/2;const F=new Dw([],si);if(0===P)return new Y(f,m);for(let H=f;H<w;H+=P)for(let X=m;X<S;X+=P)F.push(new Tc(H+L,X+L,L,s));let V=function(H){let X=0,te=0,_e=0;const Ue=H[0];for(let Xe=0,Be=Ue.length,Ze=Be-1;Xe<Be;Ze=Xe++){const rt=Ue[Xe],We=Ue[Ze],Mt=rt.x*We.y-We.x*rt.y;te+=(rt.x+We.x)*Mt,_e+=(rt.y+We.y)*Mt,X+=3*Mt}return new Tc(te/X,_e/X,0,H)}(s),j=F.length;for(;F.length;){const H=F.pop();(H.d>V.d||!V.d)&&(V=H,a&&console.log("found best %d after %d probes",Math.round(1e4*H.d)/1e4,j)),H.max-V.d<=i||(L=H.h/2,F.push(new Tc(H.p.x-L,H.p.y-L,L,s)),F.push(new Tc(H.p.x+L,H.p.y-L,L,s)),F.push(new Tc(H.p.x-L,H.p.y+L,L,s)),F.push(new Tc(H.p.x+L,H.p.y+L,L,s)),j+=4)}return a&&(console.log(`num probes: ${j}`),console.log(`best distance: ${V.d}`)),V.p}function si(s,i){return i.max-s.max}function Tc(s,i,a,f){this.p=new Y(s,i),this.h=a,this.d=function(m,w){let S=!1,D=1/0;for(let P=0;P<w.length;P++){const L=w[P];for(let F=0,V=L.length,j=V-1;F<V;j=F++){const H=L[F],X=L[j];H.y>m.y!=X.y>m.y&&m.x<(X.x-H.x)*(m.y-H.y)/(X.y-H.y)+H.x&&(S=!S),D=Math.min(D,Wx(m,H,X))}}return(S?1:-1)*Math.sqrt(D)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}const Ag=Number.POSITIVE_INFINITY,Ev=Math.sqrt(2);function Cv(s,i){return i[1]!==Ag?function(a,f,m){let w=0,S=0;switch(f=Math.abs(f),m=Math.abs(m),a){case"top-right":case"top-left":case"top":S=m-7;break;case"bottom-right":case"bottom-left":case"bottom":S=7-m}switch(a){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,S]}(s,i[0],i[1]):function(a,f){let m=0,w=0;f<0&&(f=0);const S=f/Ev;switch(a){case"top-right":case"top-left":w=S-7;break;case"bottom-right":case"bottom-left":w=7-S;break;case"bottom":w=7-f;break;case"top":w=f-7}switch(a){case"top-right":case"bottom-right":m=-S;break;case"top-left":case"bottom-left":m=S;break;case"left":m=f;break;case"right":m=-f}return[m,w]}(s,i[0])}function Pw(s,i,a,f,m,w,S,D,P,L){s.createArrays(),s.tilePixelRatio=cr/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const F=s.layers[0].layout,V=s.layers[0]._unevaluatedLayout._values,j={};if("composite"===s.textSizeData.kind){const{minZoom:te,maxZoom:_e}=s.textSizeData;j.compositeTextSizes=[V["text-size"].possiblyEvaluate(new Ge(te),D),V["text-size"].possiblyEvaluate(new Ge(_e),D)]}if("composite"===s.iconSizeData.kind){const{minZoom:te,maxZoom:_e}=s.iconSizeData;j.compositeIconSizes=[V["icon-size"].possiblyEvaluate(new Ge(te),D),V["icon-size"].possiblyEvaluate(new Ge(_e),D)]}j.layoutTextSize=V["text-size"].possiblyEvaluate(new Ge(P+1),D),j.layoutIconSize=V["icon-size"].possiblyEvaluate(new Ge(P+1),D),j.textMaxSize=V["text-size"].possiblyEvaluate(new Ge(18),D);const H="map"===F.get("text-rotation-alignment")&&"point"!==F.get("symbol-placement"),X=F.get("text-size");for(const te of s.features){const _e=F.get("text-font").evaluate(te,{},D).join(","),Ue=X.evaluate(te,{},D),Xe=j.layoutTextSize.evaluate(te,{},D),Be=(j.layoutIconSize.evaluate(te,{},D),{horizontal:{},vertical:void 0}),Ze=te.text;let rt,We=[0,0];if(Ze){const Ht=Ze.toString(),ln=24*F.get("text-letter-spacing").evaluate(te,{},D),kt=24*F.get("text-line-height").evaluate(te,{},D),Wt=b(Ht)?ln:0,Kt=F.get("text-anchor").evaluate(te,{},D),rn=F.get("text-variable-anchor");if(!rn){const Ln=F.get("text-radial-offset").evaluate(te,{},D);We=Ln?Cv(Kt,[24*Ln,Ag]):F.get("text-offset").evaluate(te,{},D).map(Gn=>24*Gn)}let cn=H?"center":F.get("text-justify").evaluate(te,{},D);const jt="point"===F.get("symbol-placement"),In=jt?24*F.get("text-max-width").evaluate(te,{},D):1/0,sr=Ln=>{s.allowVerticalPlacement&&g(Ht)&&(Be.vertical=Ly(Ze,i,a,m,_e,In,kt,Kt,Ln,Wt,We,Al.vertical,!0,Xe,Ue))};if(!H&&rn){const Ln="auto"===cn?rn.map(Dn=>Pg(Dn)):[cn];let Gn=!1;for(let Dn=0;Dn<Ln.length;Dn++){const fr=Ln[Dn];if(!Be.horizontal[fr])if(Gn)Be.horizontal[fr]=Be.horizontal[0];else{const Dr=Ly(Ze,i,a,m,_e,In,kt,"center",fr,Wt,We,Al.horizontal,!1,Xe,Ue);Dr&&(Be.horizontal[fr]=Dr,Gn=1===Dr.positionedLines.length)}}sr("left")}else{if("auto"===cn&&(cn=Pg(Kt)),jt||F.get("text-writing-mode").indexOf("horizontal")>=0||!g(Ht)){const Ln=Ly(Ze,i,a,m,_e,In,kt,Kt,cn,Wt,We,Al.horizontal,!1,Xe,Ue);Ln&&(Be.horizontal[cn]=Ln)}sr(jt?"left":cn)}}let Mt=!1;if(te.icon&&te.icon.name){const Ht=f[te.icon.name];Ht&&(rt=Pd(m[te.icon.name],F.get("icon-offset").evaluate(te,{},D),F.get("icon-anchor").evaluate(te,{},D)),Mt=Ht.sdf,void 0===s.sdfIcons?s.sdfIcons=Ht.sdf:s.sdfIcons!==Ht.sdf&&Sn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ht.pixelRatio!==s.pixelRatio||0!==F.get("icon-rotate").constantOr(1))&&(s.iconsNeedLinear=!0))}const It=Iv(Be.horizontal)||Be.vertical;s.iconsInText||(s.iconsInText=!!It&&It.iconsInText),(It||rt)&&Rw(s,te,Be,rt,f,j,Xe,0,We,Mt,S,D,L)}w&&s.generateCollisionDebugBuffers(P,s.collisionBoxArray)}function Pg(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Rw(s,i,a,f,m,w,S,D,P,L,F,V,j){let H=w.textMaxSize.evaluate(i,{},V);void 0===H&&(H=S);const X=s.layers[0].layout,te=X.get("icon-offset").evaluate(i,{},V),_e=Iv(a.horizontal)||a.vertical,Ue="globe"===j.name,Xe=S/24,Be=s.tilePixelRatio*H/24,Ze=(Wt=s.overscaling,s.zoom>18&&Wt>2&&(Wt>>=1),Math.max(cr/(512*Wt),1)*X.get("symbol-spacing")),rt=X.get("text-padding")*s.tilePixelRatio,We=X.get("icon-padding")*s.tilePixelRatio,Mt=se(X.get("text-max-angle")),It="map"===X.get("text-rotation-alignment")&&"point"!==X.get("symbol-placement"),Ht="map"===X.get("icon-rotation-alignment")&&"point"!==X.get("symbol-placement"),ln=X.get("symbol-placement"),kt=Ze/2;var Wt;const Kt=X.get("icon-text-fit");let rn;f&&"none"!==Kt&&(s.allowVerticalPlacement&&a.vertical&&(rn=Wc(f,a.vertical,Kt,X.get("icon-text-fit-padding"),te,Xe)),_e&&(f=Wc(f,_e,Kt,X.get("icon-text-fit-padding"),te,Xe)));const cn=(jt,In,sr)=>{if(In.x<0||In.x>=cr||In.y<0||In.y>=cr)return;let Ln=null;if(Ue){const{x:Gn,y:Dn,z:fr}=j.projectTilePoint(In.x,In.y,sr);Ln={anchor:new bh(Gn,Dn,fr,0,void 0),up:j.upVector(sr,In.x,In.y)}}!function(Gn,Dn,fr,Dr,Or,yi,Mr,Ko,Zr,ii,Ti,Lo,Uo,Ir,Ar,lo,ja,co,Gs,$s,wi,Jo,la,xo,Pi){const nu=Gn.addToLineVertexArray(Dn,Dr);let Ga,Aa,yu,Pa,Ih,Ud,Pp,Rp=0,u_=0,Xg=0,l_=0,Zg=-1,Wg=-1;const Rc={};let c_=np.exports("");const df=fr?fr.anchor:Dn;let Yg=0,Kg=0;if(void 0===Zr._unevaluatedLayout.getValue("text-radial-offset")?[Yg,Kg]=Zr.layout.get("text-offset").evaluate(wi,{},Pi).map(cl=>24*cl):(Yg=24*Zr.layout.get("text-radial-offset").evaluate(wi,{},Pi),Kg=Ag),Gn.allowVerticalPlacement&&Or.vertical){const cl=Or.vertical;if(Ar)Ud=Rg(cl),Ko&&(Pp=Rg(Ko));else{const Ru=Zr.layout.get("text-rotate").evaluate(wi,{},Pi)+90;yu=By(ii,df,Dn,Ti,Lo,Uo,cl,Ir,Ru,lo),Ko&&(Pa=By(ii,df,Dn,Ti,Lo,Uo,Ko,co,Ru))}}if(yi){const cl=Zr.layout.get("icon-rotate").evaluate(wi,{},Pi),Ru="none"!==Zr.layout.get("icon-text-fit"),Oc=zy(yi,cl,la,Ru),Lp=Ko?zy(Ko,cl,la,Ru):void 0;Aa=By(ii,df,Dn,Ti,Lo,Uo,yi,co,cl),Rp=4*Oc.length;const Qv=Gn.iconSizeData;let Th=null;"source"===Qv.kind?(Th=[rc*Zr.layout.get("icon-size").evaluate(wi,{},Pi)],Th[0]>Eh&&Sn(`${Gn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Qv.kind&&(Th=[rc*Jo.compositeIconSizes[0].evaluate(wi,{},Pi),rc*Jo.compositeIconSizes[1].evaluate(wi,{},Pi)],(Th[0]>Eh||Th[1]>Eh)&&Sn(`${Gn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Gn.addSymbols(Gn.icon,Oc,Th,$s,Gs,wi,!1,fr,Dn,nu.lineStartIndex,nu.lineLength,-1,xo,Pi),Zg=Gn.icon.placedSymbolArray.length-1,Lp&&(u_=4*Lp.length,Gn.addSymbols(Gn.icon,Lp,Th,$s,Gs,wi,Al.vertical,fr,Dn,nu.lineStartIndex,nu.lineLength,-1,xo,Pi),Wg=Gn.icon.placedSymbolArray.length-1)}for(const cl in Or.horizontal){const Ru=Or.horizontal[cl];Ga||(c_=np.exports(Ru.text),Ar?Ih=Rg(Ru):Ga=By(ii,df,Dn,Ti,Lo,Uo,Ru,Ir,Zr.layout.get("text-rotate").evaluate(wi,{},Pi),lo));const Oc=1===Ru.positionedLines.length;if(Xg+=Sv(Gn,fr,Dn,Ru,Mr,Zr,Ar,wi,lo,nu,Or.vertical?Al.horizontal:Al.horizontalOnly,Oc?Object.keys(Or.horizontal):[cl],Rc,Zg,Jo,xo,Pi),Oc)break}Or.vertical&&(l_+=Sv(Gn,fr,Dn,Or.vertical,Mr,Zr,Ar,wi,lo,nu,Al.vertical,["vertical"],Rc,Wg,Jo,xo,Pi));let Lc=-1;const rh=(cl,Ru)=>cl?Math.max(cl,Ru):Ru;Lc=rh(Ih,Lc),Lc=rh(Ud,Lc),Lc=rh(Pp,Lc);const Zw=Lc>-1?1:0;Gn.glyphOffsetArray.length>=hf.MAX_GLYPHS&&Sn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==wi.sortKey&&Gn.addToSortKeyRanges(Gn.symbolInstances.length,wi.sortKey),Gn.symbolInstances.emplaceBack(df.x,df.y,df.z,Dn.x,Dn.y,Rc.right>=0?Rc.right:-1,Rc.center>=0?Rc.center:-1,Rc.left>=0?Rc.left:-1,Rc.vertical>=0?Rc.vertical:-1,Zg,Wg,c_,void 0!==Ga?Ga:Gn.collisionBoxArray.length,void 0!==Ga?Ga+1:Gn.collisionBoxArray.length,void 0!==yu?yu:Gn.collisionBoxArray.length,void 0!==yu?yu+1:Gn.collisionBoxArray.length,void 0!==Aa?Aa:Gn.collisionBoxArray.length,void 0!==Aa?Aa+1:Gn.collisionBoxArray.length,Pa||Gn.collisionBoxArray.length,Pa?Pa+1:Gn.collisionBoxArray.length,Ti,Xg,l_,Rp,u_,Zw,0,Yg,Kg,Lc)}(s,In,Ln,jt,a,f,m,rn,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,rt,It,P,0,We,Ht,te,i,w,L,F,V)};if("line"===ln)for(const jt of _v(i.geometry,0,0,cr,cr)){const In=yv(jt,Ze,Mt,a.vertical||_e,f,24,Be,s.overscaling,cr);for(const sr of In){const Ln=_e;Ln&&Tv(s,Ln.text,kt,sr)||cn(jt,sr,V)}}else if("line-center"===ln){for(const jt of i.geometry)if(jt.length>1){const In=hS(jt,Mt,a.vertical||_e,f,24,Be);In&&cn(jt,In,V)}}else if("Polygon"===i.type)for(const jt of pg(i.geometry,0)){const In=Aw(jt,16);cn(jt[0],new bh(In.x,In.y,0,0,void 0),V)}else if("LineString"===i.type)for(const jt of i.geometry)cn(jt,new bh(jt[0].x,jt[0].y,0,0,void 0),V);else if("Point"===i.type)for(const jt of i.geometry)for(const In of jt)cn([In],new bh(In.x,In.y,0,0,void 0),V)}const Eh=32640;function Sv(s,i,a,f,m,w,S,D,P,L,F,V,j,H,X,te,_e){const Ue=function(Ze,rt,We,Mt,It,Ht,ln,kt){const Wt=[];if(0===rt.positionedLines.length)return Wt;const Kt=Mt.layout.get("text-rotate").evaluate(Ht,{})*Math.PI/180,rn=function(Ln){const Gn=Ln[0],Dn=Ln[1],fr=Gn*Dn;return fr>0?[Gn,-Dn]:fr<0?[-Gn,Dn]:0===Gn?[Dn,Gn]:[Dn,-Gn]}(We);let cn=Math.abs(rt.top-rt.bottom);for(const Ln of rt.positionedLines)cn-=Ln.lineOffset;const jt=rt.positionedLines.length,In=cn/jt;let sr=rt.top-We[1];for(let Ln=0;Ln<jt;++Ln){const Gn=rt.positionedLines[Ln];sr=bv(rt,In,sr,Ln);for(const Dn of Gn.positionedGlyphs){if(!Dn.rect)continue;const fr=Dn.rect||{};let Dr=4,Or=!0,yi=1,Mr=0;if(Dn.imageName){const xo=ln[Dn.imageName];if(!xo)continue;if(xo.sdf){Sn("SDF images are not supported in formatted text and will be ignored.");continue}Or=!1,yi=xo.pixelRatio,Dr=1/yi}const Ko=(It||kt)&&Dn.vertical,Zr=Dn.metrics.advance*Dn.scale/2,ii=Dn.metrics,Ti=Dn.rect;if(null===Ti)continue;kt&&rt.verticalizable&&(Mr=Dn.imageName?Zr-Dn.metrics.width*Dn.scale/2:0);const Lo=It?[Dn.x+Zr,Dn.y]:[0,0];let Uo=[0,0],Ir=[0,0],Ar=!1;It||(Ko?(Ir=[Dn.x+Zr+rn[0],Dn.y+rn[1]-Mr],Ar=!0):Uo=[Dn.x+Zr+We[0],Dn.y+We[1]-Mr]);const lo=Ti.w*Dn.scale/(yi*(Dn.localGlyph?2:1)),ja=Ti.h*Dn.scale/(yi*(Dn.localGlyph?2:1));let co,Gs,$s,wi;if(Ko){const xo=Dn.y-sr,Pi=new Y(-Zr,Zr-xo),nu=-Math.PI/2,Ga=new Y(...Ir);co=new Y(-Zr+Uo[0],Uo[1]),co._rotateAround(nu,Pi)._add(Ga),co.x+=-xo+Zr,co.y-=(ii.left-Dr)*Dn.scale;const Aa=Dn.imageName?ii.advance*Dn.scale:24*Dn.scale,yu=String.fromCharCode(Dn.glyph);vw(yu)?co.x+=(1-Dr)*Dn.scale:Iy(yu)?co.x+=Aa-ii.height*Dn.scale+(-Dr-1)*Dn.scale:co.x+=Dn.imageName||ii.width+2*Dr===Ti.w&&ii.height+2*Dr===Ti.h?(Aa-ja)/2:(Aa-(ii.height+2*Dr)*Dn.scale)/2,Gs=new Y(co.x,co.y-lo),$s=new Y(co.x+ja,co.y),wi=new Y(co.x+ja,co.y-lo)}else{const xo=(ii.left-Dr)*Dn.scale-Zr+Uo[0],Pi=(-ii.top-Dr)*Dn.scale+Uo[1],nu=xo+lo,Ga=Pi+ja;co=new Y(xo,Pi),Gs=new Y(nu,Pi),$s=new Y(xo,Ga),wi=new Y(nu,Ga)}if(Kt){let xo;xo=It?new Y(0,0):Ar?new Y(rn[0],rn[1]):new Y(We[0],We[1]),co._rotateAround(Kt,xo),Gs._rotateAround(Kt,xo),$s._rotateAround(Kt,xo),wi._rotateAround(Kt,xo)}const Jo=new Y(0,0),la=new Y(0,0);Wt.push({tl:co,tr:Gs,bl:$s,br:wi,tex:fr,writingMode:rt.writingMode,glyphOffset:Lo,sectionIndex:Dn.sectionIndex,isSDF:Or,pixelOffsetTL:Jo,pixelOffsetBR:la,minFontScaleX:0,minFontScaleY:0})}}return Wt}(0,f,P,w,S,D,m,s.allowVerticalPlacement),Xe=s.textSizeData;let Be=null;"source"===Xe.kind?(Be=[rc*w.layout.get("text-size").evaluate(D,{},_e)],Be[0]>Eh&&Sn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Xe.kind&&(Be=[rc*X.compositeTextSizes[0].evaluate(D,{},_e),rc*X.compositeTextSizes[1].evaluate(D,{},_e)],(Be[0]>Eh||Be[1]>Eh)&&Sn(`${s.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),s.addSymbols(s.text,Ue,Be,P,S,D,F,i,a,L.lineStartIndex,L.lineLength,H,te,_e);for(const Ze of V)j[Ze]=s.text.placedSymbolArray.length-1;return 4*Ue.length}function Iv(s){for(const i in s)return s[i];return null}function By(s,i,a,f,m,w,S,D,P,L){let F=S.top,V=S.bottom,j=S.left,H=S.right;const X=S.collisionPadding;if(X&&(j-=X[0],F-=X[1],H+=X[2],V+=X[3]),P){const te=new Y(j,F),_e=new Y(H,F),Ue=new Y(j,V),Xe=new Y(H,V),Be=se(P);let Ze=new Y(0,0);L&&(Ze=new Y(L[0],L[1])),te._rotateAround(Be,Ze),_e._rotateAround(Be,Ze),Ue._rotateAround(Be,Ze),Xe._rotateAround(Be,Ze),j=Math.min(te.x,_e.x,Ue.x,Xe.x),H=Math.max(te.x,_e.x,Ue.x,Xe.x),F=Math.min(te.y,_e.y,Ue.y,Xe.y),V=Math.max(te.y,_e.y,Ue.y,Xe.y)}return s.emplaceBack(i.x,i.y,i.z,a.x,a.y,j,F,H,V,D,f,m,w),s.length-1}function Rg(s){s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const i=s.bottom-s.top;return i>0?Math.max(10,i):null}function Tv(s,i,a,f){const m=s.compareText;if(i in m){const w=m[i];for(let S=w.length-1;S>=0;S--)if(f.dist(w[S])<a)return!0}else m[i]=[];return m[i].push(f),!1}const Yc=bn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dv}=Yc,Lg=bn([{name:"a_pos_3",components:3,type:"Int16"}]);var jf=bn([{name:"a_pos",type:"Int16",components:2}]);const Ch=cr/Math.PI/2,Mv=2*Ql(1,0)*Ch*Math.PI,Ep=[64,32,16],Dc=-Ch,oc=Ch,fS=[new Pu([Dc,Dc,Dc],[oc,oc,oc]),new Pu([Dc,Dc,Dc],[0,0,oc]),new Pu([0,Dc,Dc],[oc,0,oc]),new Pu([Dc,0,Dc],[0,oc,oc]),new Pu([0,0,Dc],[oc,oc,oc])];function Av(s,i,a,f=!0){const m=Ml([],s._camera.position,s.worldSize),w=[i,a,1,1];nc(w,w,s.pixelMatrixInverse),og(w,w,1/w[3]);const S=Au([],Ec([],w,m)),D=s.globeMatrix,P=[D[12],D[13],D[14]],L=Ec([],P,m),F=_h(L),V=Au([],L),j=s.worldSize/(2*Math.PI),H=tc(V,S),X=Math.asin(j/F);if(X<Math.acos(H)){if(!f)return null;const ln=[],kt=[];Ml(ln,S,F/H),Au(kt,Ec(kt,ln,L)),Au(S,Xc(S,L,Ml(S,kt,Math.tan(X)*F)))}const te=[];new ny(m,S).closestPointOnSphere(P,j,te);const _e=Au([],ye(D,0)),Ue=Au([],ye(D,1)),Xe=Au([],ye(D,2)),Be=tc(_e,te),Ze=tc(Ue,te),rt=tc(Xe,te),We=we(Math.asin(-Ze/j));let Mt=we(Math.atan2(Be,rt));Mt=s.center.lng+function(ln,kt){const Wt=(kt-ln+180)%360-180;return Wt<-180?Wt+360:Wt}(s.center.lng,Mt);const It=Tl(Mt),Ht=ue(bc(We),0,1);return new kf(It,Ht)}class Od{constructor(i,a,f){this.a=Ec([],i,f),this.b=Ec([],a,f),this.center=f;const m=Au([],this.a),w=Au([],this.b);this.angle=Math.acos(tc(m,w))}}function Uy(s,i){if(0===s.angle)return null;let a;return a=0===s.a[i]?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[i]/s.a[i]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:function(f,m,w,S){const D=Math.sin(w);return f*(Math.sin((1-S)*w)/D)+m*(Math.sin(S*w)/D)}(s.a[i],s.b[i],s.angle,ue(a,0,1))+s.center[i]}function Mc(s){if(s.z<=1)return fS[s.z+2*s.y+s.x];const i=jy(Og(s));return Pu.fromPoints(i)}function Kc(s,i,a){return Ml(s,s,1-a),xd(s,s,i,a)}function Pv(s,i){const a=af(i.zoom);if(0===a)return Mc(s);const f=Og(s),m=jy(f),w=Tl(f.getWest())*i.worldSize,S=Tl(f.getEast())*i.worldSize,D=bc(f.getNorth())*i.worldSize,P=bc(f.getSouth())*i.worldSize,L=[w,D,0],F=[S,D,0],V=[w,P,0],j=[S,P,0],H=Wm([],i.globeMatrix);return js(L,L,H),js(F,F,H),js(V,V,H),js(j,j,H),m[0]=Kc(m[0],V,a),m[1]=Kc(m[1],j,a),m[2]=Kc(m[2],F,a),m[3]=Kc(m[3],L,a),Pu.fromPoints(m)}function Vy(s,i,a){for(const f of s)js(f,f,i),Ml(f,f,a)}function Og({x:s,y:i,z:a}){const f=1/(1<<a),m=new Ai(Dl(s*f),ea((i+1)*f)),w=new Ai(Dl((s+1)*f),ea(i*f));return new mh(m,w)}function jy(s){const i=se(s.getNorth()),a=se(s.getSouth()),f=Math.cos(i),m=Math.cos(a),w=Math.sin(i),S=Math.sin(a),D=s.getWest(),P=s.getEast();return[Nd(m,S,D),Nd(m,S,P),Nd(f,w,P),Nd(f,w,D)]}function Nd(s,i,a,f=Ch){return a=se(a),[s*Math.sin(a)*f,-i*f,s*Math.cos(a)*f]}function Cp(s,i,a){return Nd(Math.cos(se(s)),Math.sin(se(s)),i,a)}function kd(s,i,a,f){const m=1<<a.z,w=(s/cr+a.x)/m;return Cp(ea((i/cr+a.y)/m),Dl(w),f)}function Ng({min:s,max:i}){return 16383/Math.max(i[0]-s[0],i[1]-s[1],i[2]-s[2])}const Gy=new Float64Array(16);function Fd(s){const i=Ng(s),a=qu(Gy,[i,i,i]);return ap(a,a,((f=[])[0]=-(m=s.min)[0],f[1]=-m[1],f[2]=-m[2],f));var f,m}function Sp(s){const i=(f=s.min,(a=Gy)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=f[0],a[13]=f[1],a[14]=f[2],a[15]=1,a);var a,f;const m=1/Ng(s);return Kh(i,i,[m,m,m])}function Ow(s,i,a,f,m){const w=function(P){const L=cr/(2*Math.PI);return P/(2*Math.PI)/L}(a),S=[s,i,-a/(2*Math.PI)],D=ec(new Float64Array(16));return ap(D,D,S),Kh(D,D,[w,w,w]),Ym(D,D,se(-m)),rg(D,D,se(-f)),D}function af(s){return Zt(5,6,s)}function Rv(s,i){const a=Cp(i.lat,i.lng);return S=(m=Km([],function(X){const te=Cp(X._center.lat,X._center.lng);let _e=cp([],zf(0,1,0),te);const Ue=ig([],-X.angle,te);_e=js(_e,_e,Ue),ig(Ue,-X._pitch,_e);const Xe=Au([],te);return Ml(Xe,Xe,X.cameraToCenterDistance/X.pixelsPerMeter*Mv),js(Xe,Xe,Ue),Xc([],te,Xe)}(s),a))[0],D=m[1],P=m[2],L=(w=a)[0],F=w[1],V=w[2],H=(j=Math.sqrt(S*S+D*D+P*P)*Math.sqrt(L*L+F*F+V*V))&&tc(m,w)/j,Math.acos(Math.min(Math.max(H,-1),1));var m,w,S,D,P,L,F,V,j,H}const Nw=se(85),zr=Math.cos(Nw),Lv=Math.sin(Nw);function Ov(s,i){const a=s.fovAboveCenter,f=s.elevation?s.elevation.getMinElevationBelowMSL()*i:0,m=(s._camera.position[2]*s.worldSize-f)/Math.cos(s._pitch),w=Math.sin(a)*m/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01)),S=Math.sin(s._pitch)*w+m;return Math.min(1.01*S,m*(1/s._horizonShift))}function uf(s,i){if(!i.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:i};const a=Math.pow(2,-s.z),f=s.x*a,m=(s.x+1)*a,w=s.y*a,S=(s.y+1)*a,D=Dl(f),P=Dl(m),L=ea(w),F=ea(S),V=i.project(D,L),j=i.project(P,L),H=i.project(P,F),X=i.project(D,F);let te=Math.min(V.x,j.x,H.x,X.x),_e=Math.min(V.y,j.y,H.y,X.y),Ue=Math.max(V.x,j.x,H.x,X.x),Xe=Math.max(V.y,j.y,H.y,X.y);const Be=a/16;function Ze(We,Mt,It,Ht,ln,kt){const Wt=(It+ln)/2,Kt=(Ht+kt)/2,rn=i.project(Dl(Wt),ea(Kt)),cn=Math.max(0,te-rn.x,_e-rn.y,rn.x-Ue,rn.y-Xe);te=Math.min(te,rn.x),Ue=Math.max(Ue,rn.x),_e=Math.min(_e,rn.y),Xe=Math.max(Xe,rn.y),cn>Be&&(Ze(We,rn,It,Ht,Wt,Kt),Ze(rn,Mt,Wt,Kt,ln,kt))}Ze(V,j,f,w,m,w),Ze(j,H,m,w,m,S),Ze(H,X,m,S,f,S),Ze(X,V,f,S,f,w),te-=Be,_e-=Be,Ue+=Be,Xe+=Be;const rt=1/Math.max(Ue-te,Xe-_e);return{scale:rt,x:te*rt,y:_e*rt,x2:Ue*rt,y2:Xe*rt,projection:i}}const kw=ec(new Float32Array(16));class lf{constructor(i){this.spec=i,this.name=i.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(i,a){return{x:0,y:0,z:0}}unproject(i,a){return new Ai(0,0)}projectTilePoint(i,a,f){return{x:i,y:a,z:0}}locationPoint(i,a,f=!0){return i._coordinatePoint(i.locationCoordinate(a),f)}pixelsPerMeter(i,a){return Ql(1,i)*a}pixelSpaceConversion(i,a,f){return 1}farthestPixelDistance(i){return Ov(i,i.pixelsPerMeter)}pointCoordinate(i,a,f,m){const w=i.horizonLineFromTop(!1),S=new Y(a,Math.max(w,f));return i.rayIntersectionCoordinate(i.pointRayIntersection(S,m))}pointCoordinate3D(i,a,f){const m=new Y(a,f);if(i.elevation)return i.elevation.pointCoordinate(m);{const w=this.pointCoordinate(i,m.x,m.y,0);return[w.x,w.y,w.z]}}isPointAboveHorizon(i,a){if(i.elevation)return!this.pointCoordinate3D(i,a.x,a.y);const f=i.horizonLineFromTop();return a.y<f}createInversionMatrix(i,a){return kw}createTileMatrix(i,a,f){let m,w,S;const D=f.canonical,P=ec(new Float64Array(16));if(this.isReprojectedInTileSpace){const L=uf(D,this);m=1,w=L.x+f.wrap*L.scale,S=L.y,Kh(P,P,[m/L.scale,m/L.scale,i.pixelsPerMeter/a])}else m=a/i.zoomScale(D.z),w=(D.x+Math.pow(2,D.z)*f.wrap)*m,S=D.y*m;return ap(P,P,[w,S,0]),Kh(P,P,[m/cr,m/cr,1]),P}upVector(i,a,f){return[0,0,1]}upVectorScale(i,a,f){return{metersToTile:1}}}class kg extends lf{constructor(i){super(i),this.range=[4,7],this.center=i.center||[-96,37.5];const[a,f]=this.parallels=i.parallels||[29.5,45.5],m=Math.sin(se(a));this.n=(m+Math.sin(se(f)))/2,this.c=1+m*(2*this.n-m),this.r0=Math.sqrt(this.c)/this.n}project(i,a){const{n:f,c:m,r0:w}=this,S=se(i-this.center[0]),D=se(a),P=Math.sqrt(m-2*f*Math.sin(D))/f;return{x:P*Math.sin(S*f),y:P*Math.cos(S*f)-w,z:0}}unproject(i,a){const{n:f,c:m,r0:w}=this,S=w+a;let D=Math.atan2(i,Math.abs(S))*Math.sign(S);S*f<0&&(D-=Math.PI*Math.sign(i)*Math.sign(S));const P=se(this.center[0])*f;D=At(D,-Math.PI-P,Math.PI-P);const L=ue(we(D/f)+this.center[0],-180,180),F=Math.asin(ue((m-(i*i+S*S)*f*f)/(2*f),-1,1)),V=ue(we(F),-85.051129,Hc);return new Ai(L,V)}}const Jc=1.340264,Gf=-.081106,Sh=893e-6,$f=.003796,qf=Math.sqrt(3)/2;class Nv extends lf{project(i,a){a=a/180*Math.PI,i=i/180*Math.PI;const f=Math.asin(qf*Math.sin(a)),m=f*f,w=m*m*m;return{x:.5*(i*Math.cos(f)/(qf*(Jc+3*Gf*m+w*(7*Sh+9*$f*m)))/Math.PI+.5),y:1-.5*(f*(Jc+Gf*m+w*(Sh+$f*m))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let f=a=(2*(1-a)-1)*Math.PI,m=f*f,w=m*m*m;for(let F,V,j,H=0;H<12&&(V=f*(Jc+Gf*m+w*(Sh+$f*m))-a,j=Jc+3*Gf*m+w*(7*Sh+9*$f*m),F=V/j,f=ue(f-F,-Math.PI/3,Math.PI/3),m=f*f,w=m*m*m,!(Math.abs(F)<1e-12));++H);const S=qf*i*(Jc+3*Gf*m+w*(7*Sh+9*$f*m))/Math.cos(f),D=Math.asin(Math.sin(f)/qf),P=ue(180*S/Math.PI,-180,180),L=ue(180*D/Math.PI,-85.051129,Hc);return new Ai(P,L)}}class $y extends lf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){return{x:.5+i/360,y:.5-a/360,z:0}}unproject(i,a){const f=360*(i-.5),m=ue(360*(.5-a),-85.051129,Hc);return new Ai(f,m)}}const cf=Math.PI/2;function zd(s){return Math.tan((cf+s)/2)}class kv extends lf{constructor(i){super(i),this.center=i.center||[0,30];const[a,f]=this.parallels=i.parallels||[30,30];let m=se(a),w=se(f);this.southernCenter=m+w<0,this.southernCenter&&(m=-m,w=-w);const S=Math.cos(m),D=zd(m);this.n=m===w?Math.sin(m):Math.log(S/Math.cos(w))/Math.log(zd(w)/D),this.f=S*Math.pow(zd(m),this.n)/this.n}project(i,a){a=se(a),this.southernCenter&&(a=-a),i=se(i-this.center[0]);const f=1e-6,{n:m,f:w}=this;w>0?a<-cf+f&&(a=-cf+f):a>cf-f&&(a=cf-f);const S=w/Math.pow(zd(a),m);let D=S*Math.sin(m*i),P=w-S*Math.cos(m*i);return D=.5*(D/Math.PI+.5),P=.5*(P/Math.PI+.5),{x:D,y:this.southernCenter?P:1-P,z:0}}unproject(i,a){i=(2*i-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:f,f:m}=this,w=m-a,S=Math.sign(w),D=Math.sign(f)*Math.sqrt(i*i+w*w);let P=Math.atan2(i,Math.abs(w))*S;w*f<0&&(P-=Math.PI*Math.sign(i)*S);const L=ue(we(P/f)+this.center[0],-180,180),F=ue(we(2*Math.atan(Math.pow(m/D,1/f))-cf),-85.051129,Hc);return new Ai(L,this.southernCenter?-F:F)}}class Fg extends lf{constructor(i){super(i),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(i,a){return{x:Tl(i),y:bc(a),z:0}}unproject(i,a){const f=Dl(i),m=ea(a);return new Ai(f,m)}}const Fv=se(Hc);class Fw extends lf{project(i,a){const f=(a=se(a))*a,m=f*f;return{x:.5*((i=se(i))*(.8707-.131979*f+m*(m*(.003971*f-.001529*m)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+f*(.015085+m*(.028874*f-.044475-.005916*m)))/Math.PI+1),z:0}}unproject(i,a){i=(2*i-.5)*Math.PI;let f=a=(2*(1-a)-1)*Math.PI,m=25,w=0,S=f*f;do{S=f*f;const L=S*S;w=(f*(1.007226+S*(.015085+L*(.028874*S-.044475-.005916*L)))-a)/(1.007226+S*(.045255+L*(.259866*S-.311325-.005916*11*L))),f=ue(f-w,-Fv,Fv)}while(Math.abs(w)>1e-6&&--m>0);S=f*f;const D=ue(we(i/(.8707+S*(S*(S*S*S*(.003971-.001529*S)-.013791)-.131979))),-180,180),P=we(f);return new Ai(D,P)}}const qy=se(Hc);class zw extends lf{project(i,a){a=se(a),i=se(i);const f=Math.cos(a),m=2/Math.PI,w=Math.acos(f*Math.cos(i/2)),S=Math.sin(w)/w,D=.5*(i*m+2*f*Math.sin(i/2)/S)||0,P=.5*(a+Math.sin(a)/S)||0;return{x:.5*(D/Math.PI+.5),y:1-.5*(P/Math.PI+1),z:0}}unproject(i,a){let f=i=(2*i-.5)*Math.PI,m=a=(2*(1-a)-1)*Math.PI,w=25;const S=1e-6;let D=0,P=0;do{const L=Math.cos(m),F=Math.sin(m),V=2*F*L,j=F*F,H=L*L,X=Math.cos(f/2),te=Math.sin(f/2),_e=2*X*te,Ue=te*te,Xe=1-H*X*X,Be=Xe?1/Xe:0,Ze=Xe?Math.acos(L*X)*Math.sqrt(1/Xe):0,rt=.5*(2*Ze*L*te+2*f/Math.PI)-i,We=.5*(Ze*F+m)-a,Mt=.5*Be*(H*Ue+Ze*L*X*j)+1/Math.PI,It=Be*(_e*V/4-Ze*F*te),Ht=.125*Be*(V*te-Ze*F*H*_e),ln=.5*Be*(j*X+Ze*Ue*L)+.5,kt=It*Ht-ln*Mt;D=(We*It-rt*ln)/kt,P=(rt*Ht-We*Mt)/kt,f=ue(f-D,-Math.PI,Math.PI),m=ue(m-P,-qy,qy)}while((Math.abs(D)>S||Math.abs(P)>S)&&--w>0);return new Ai(we(f),we(m))}}class Hy extends lf{constructor(i){super(i),this.center=i.center||[0,0],this.parallels=i.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(se(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(i,a){const{scale:f,cosPhi:m}=this;return{x:se(i)*m*f+.5,y:-Math.sin(se(a))/m*f+.5,z:0}}unproject(i,a){const{scale:f,cosPhi:m}=this,w=-(a-.5)/f,S=ue(we((i-.5)/f)/m,-180,180),D=Math.asin(ue(w*m,-1,1)),P=ue(we(D),-85.051129,Hc);return new Ai(S,P)}}class zv extends Fg{constructor(i){super(i),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(i,a,f){const m=kd(i,a,f);return js(m,m,Fd(Mc(f))),{x:m[0],y:m[1],z:m[2]}}locationPoint(i,a){const f=Cp(a.lat,a.lng),m=Au([],f),w=i.elevation?i.elevation.getAtPointOrZero(i.locationCoordinate(a),i._centerAltitude):i._centerAltitude;xd(f,f,m,Ql(1,0)*cr*w);const S=ec(new Float64Array(16));return _d(S,i.pixelMatrix,i.globeMatrix),js(f,f,S),new Y(f[0],f[1])}pixelsPerMeter(i,a){return Ql(1,0)*a}pixelSpaceConversion(i,a,f){const m=Ql(1,i)*a,w=ni(Ql(1,45)*a,m,f);return this.pixelsPerMeter(i,a)/w}createTileMatrix(i,a,f){const m=Sp(Mc(f.canonical));return _d(new Float64Array(16),i.globeMatrix,m)}createInversionMatrix(i,a){const{center:f}=i,m=Fd(Mc(a));return rg(m,m,se(f.lng)),Ym(m,m,se(f.lat)),Kh(m,m,[i._pixelsPerMercatorPixel,i._pixelsPerMercatorPixel,1]),Float32Array.from(m)}pointCoordinate(i,a,f,m){return Av(i,a,f,!0)||new kf(0,0)}pointCoordinate3D(i,a,f){const m=this.pointCoordinate(i,a,f,0);return[m.x,m.y,m.z]}isPointAboveHorizon(i,a){return!Av(i,a.x,a.y,!1)}farthestPixelDistance(i){const a=function(m,w){const S=m.cameraToCenterDistance,D=m._centerAltitude*w,P=m._camera,L=m._camera.forward(),F=Xc([],Ml([],L,-S),[0,0,D]),V=m.worldSize/(2*Math.PI),j=[0,0,-V],H=m.width/m.height,X=Math.tan(m.fovAboveCenter),te=Ml([],P.up(),X),_e=Ml([],P.right(),X*H),Ue=Au([],Xc([],Xc([],L,te),_e)),Xe=[];let Be;if(new ny(F,Ue).closestPointOnSphere(j,V,Xe)){const Ze=Xc([],Xe,j),rt=Ec([],Ze,F);Be=Math.cos(m.fovAboveCenter)*_h(rt)}else{const Ze=Ec([],F,j),rt=Ec([],j,F);Au(rt,rt);const We=_h(Ze)-V;Be=Math.sqrt(We*(We+2*V));const Mt=Math.acos(Be/(V+We))-Math.acos(tc(L,rt));Be*=Math.cos(Mt)}return 1.01*Be}(i,this.pixelsPerMeter(i.center.lat,i.worldSize)),f=af(i.zoom);if(f>0){const m=Ov(i,Ql(1,i.center.lat)*i.worldSize),w=i.worldSize/(2*Math.PI),S=Math.max(i.width,i.height)/i.worldSize*Math.PI;return ni(a,m+w*(1-Math.cos(S)),Math.pow(f,10))}return a}upVector(i,a,f){return kd(a,f,i,1)}upVectorScale(i){return{metersToTile:Mv*Ng(Mc(i))}}}function Bv(s){const i=s.parallels,a=!!i&&Math.abs(i[0]+i[1])<.01;switch(s.name){case"mercator":return new Fg(s);case"equirectangular":return new $y(s);case"naturalEarth":return new Fw(s);case"equalEarth":return new Nv(s);case"winkelTripel":return new zw(s);case"albers":return a?new Hy(s):new kg(s);case"lambertConformalConic":return a?new Hy(s):new kv(s);case"globe":return new zv(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Bw=ef.types,Rl=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ip(s,i,a,f,m,w,S,D,P,L,F,V,j){const H=D?Math.min(Eh,Math.round(D[0])):0,X=D?Math.min(Eh,Math.round(D[1])):0;s.emplaceBack(i,a,Math.round(32*f),Math.round(32*m),w,S,(H<<1)+(P?1:0),X,16*L,16*F,256*V,256*j)}function zg(s,i,a,f,m,w,S){s.emplaceBack(i,a,f,m,w,S)}function Xy(s,i,a,f,m){s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m),s.emplaceBack(i,a,f,m)}function Zy(s){for(const i of s.sections)if($(i.text))return!0;return!1}class Bg{constructor(i){this.layoutVertexArray=new Yo,this.indexArray=new Qa,this.programConfigurations=i,this.segments=new Vs,this.dynamicLayoutVertexArray=new aa,this.opacityVertexArray=new Us,this.placedSymbolArray=new tp,this.globeExtVertexArray=new Ii}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(i,a,f,m){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,lS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,ov.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,Rl,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=i.createVertexBuffer(this.globeExtVertexArray,mw.members,!0)),this.opacityVertexBuffer.itemSize=1),(f||m)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}re(Bg,"SymbolBuffers");class Wy{constructor(i,a,f){this.layoutVertexArray=new i,this.layoutAttributes=a,this.indexArray=new f,this.segments=new Vs,this.collisionVertexArray=new jc,this.collisionVertexArrayExt=new rl}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,sv.members,!0),this.collisionVertexBufferExt=i.createVertexBuffer(this.collisionVertexArrayExt,Ey.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}re(Wy,"CollisionBuffers");class hf{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(S=>S.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ec([]),this.placementViewportMatrix=ec([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Cg(this.zoom,a["text-size"]),this.iconSizeData=Cg(this.zoom,a["icon-size"]);const f=this.layers[0].layout,m=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=f.get("text-allow-overlap")||f.get("icon-allow-overlap")||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==w&&void 0!==m.constantOr(1),this.sortFeaturesByY=("viewport-y"===w||"auto"===w&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=f.get("text-writing-mode").map(S=>Al[S]),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.sourceID=i.sourceID,this.projection=i.projection}createArrays(){this.text=new Bg(new pd(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Bg(new pd(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new Lf,this.lineVertexArray=new km,this.symbolInstances=new Rf}calculateGlyphDependencies(i,a,f,m,w){for(let S=0;S<i.length;S++)if(a[i.charCodeAt(S)]=!0,m&&w){const D=nf[i.charAt(S)];D&&(a[D.charCodeAt(0)]=!0)}}populate(i,a,f,m){const w=this.layers[0],S=w.layout,D="globe"===this.projection.name,P=S.get("text-font"),L=S.get("text-field"),F=S.get("icon-image"),V=("constant"!==L.value.kind||L.value.value instanceof hi&&!L.value.value.isEmpty()||L.value.value.toString().length>0)&&("constant"!==P.value.kind||P.value.value.length>0),j="constant"!==F.value.kind||!!F.value.value||Object.keys(F.parameters).length>0,H=S.get("symbol-sort-key");if(this.features=[],!V&&!j)return;const X=a.iconDependencies,te=a.glyphDependencies,_e=a.availableImages,Ue=new Ge(this.zoom);for(const{feature:Xe,id:Be,index:Ze,sourceLayerIndex:rt}of i){const We=w._featureFilter.needGeometry,Mt=Yh(Xe,We);if(!w._featureFilter.filter(Ue,Mt,f))continue;if(We||(Mt.geometry=yh(Xe,f,m)),D&&1!==Xe.type&&f.z<=5){const kt=Mt.geometry,Wt=.98078528056,Kt=(rn,cn)=>tc(kd(rn.x,rn.y,f,1),kd(cn.x,cn.y,f,1))<Wt;for(let rn=0;rn<kt.length;rn++)kt[rn]=Xx(kt[rn],Kt)}let It,Ht;if(V){const kt=w.getValueAndResolveTokens("text-field",Mt,f,_e),Wt=hi.factory(kt);Zy(Wt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Se()||this.hasRTLText&&Qe.isParsed())&&(It=Sy(Wt,w,Mt))}if(j){const kt=w.getValueAndResolveTokens("icon-image",Mt,f,_e);Ht=kt instanceof lu?kt:lu.fromString(kt)}if(!It&&!Ht)continue;const ln=this.sortFeaturesByKey?H.evaluate(Mt,{},f):void 0;if(this.features.push({id:Be,text:It,icon:Ht,index:Ze,sourceLayerIndex:rt,geometry:Mt.geometry,properties:Xe.properties,type:Bw[Xe.type],sortKey:ln}),Ht&&(X[Ht.name]=!0),It){const kt=P.evaluate(Mt,{},f).join(","),Wt="map"===S.get("text-rotation-alignment")&&"point"!==S.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Al.vertical)>=0;for(const Kt of It.sections)if(Kt.image)X[Kt.image.name]=!0;else{const rn=g(It.toString()),cn=Kt.fontStack||kt,jt=te[cn]=te[cn]||{};this.calculateGlyphDependencies(Kt.text,jt,Wt,this.allowVerticalPlacement,rn)}}}"line"===S.get("symbol-placement")&&(this.features=function(Xe){const Be={},Ze={},rt=[];let We=0;function Mt(kt){rt.push(Xe[kt]),We++}function It(kt,Wt,Kt){const rn=Ze[kt];return delete Ze[kt],Ze[Wt]=rn,rt[rn].geometry[0].pop(),rt[rn].geometry[0]=rt[rn].geometry[0].concat(Kt[0]),rn}function Ht(kt,Wt,Kt){const rn=Be[Wt];return delete Be[Wt],Be[kt]=rn,rt[rn].geometry[0].shift(),rt[rn].geometry[0]=Kt[0].concat(rt[rn].geometry[0]),rn}function ln(kt,Wt,Kt){const rn=Kt?Wt[0][Wt[0].length-1]:Wt[0][0];return`${kt}:${rn.x}:${rn.y}`}for(let kt=0;kt<Xe.length;kt++){const Wt=Xe[kt],Kt=Wt.geometry,rn=Wt.text?Wt.text.toString():null;if(!rn){Mt(kt);continue}const cn=ln(rn,Kt),jt=ln(rn,Kt,!0);if(cn in Ze&&jt in Be&&Ze[cn]!==Be[jt]){const In=Ht(cn,jt,Kt),sr=It(cn,jt,rt[In].geometry);delete Be[cn],delete Ze[jt],Ze[ln(rn,rt[sr].geometry,!0)]=sr,rt[In].geometry=null}else cn in Ze?It(cn,jt,Kt):jt in Be?Ht(cn,jt,Kt):(Mt(kt),Be[cn]=We-1,Ze[jt]=We-1)}return rt.filter(kt=>kt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Xe,Be)=>Xe.sortKey-Be.sortKey)}update(i,a,f,m){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,a,this.layers,f,m),this.icon.programConfigurations.updatePaintArrays(i,a,this.layers,f,m))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Bv(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,a){const f=this.lineVertexArray.length,m=i.segment;if(void 0!==m){let w=i.dist(a[m+1]),S=i.dist(a[m]);const D={};for(let P=m+1;P<a.length;P++)D[P]={x:a[P].x,y:a[P].y,tileUnitDistanceFromAnchor:w},P<a.length-1&&(w+=a[P+1].dist(a[P]));for(let P=m||0;P>=0;P--)D[P]={x:a[P].x,y:a[P].y,tileUnitDistanceFromAnchor:S},P>0&&(S+=a[P-1].dist(a[P]));for(let P=0;P<a.length;P++){const L=D[P];this.lineVertexArray.emplaceBack(L.x,L.y,L.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,a,f,m,w,S,D,P,L,F,V,j,H,X){const te=i.indexArray,_e=i.layoutVertexArray,Ue=i.globeExtVertexArray,Xe=i.segments.prepareSegment(4*a.length,_e,te,this.canOverlap?S.sortKey:void 0),Be=this.glyphOffsetArray.length,Ze=Xe.vertexLength,rt=this.allowVerticalPlacement&&D===Al.vertical?Math.PI/2:0,We=S.text&&S.text.sections;for(let It=0;It<a.length;It++){const{tl:Ht,tr:ln,bl:kt,br:Wt,tex:Kt,pixelOffsetTL:rn,pixelOffsetBR:cn,minFontScaleX:jt,minFontScaleY:In,glyphOffset:sr,isSDF:Ln,sectionIndex:Gn}=a[It],Dn=Xe.vertexLength,fr=sr[1];if(Ip(_e,L.x,L.y,Ht.x,fr+Ht.y,Kt.x,Kt.y,f,Ln,rn.x,rn.y,jt,In),Ip(_e,L.x,L.y,ln.x,fr+ln.y,Kt.x+Kt.w,Kt.y,f,Ln,cn.x,rn.y,jt,In),Ip(_e,L.x,L.y,kt.x,fr+kt.y,Kt.x,Kt.y+Kt.h,f,Ln,rn.x,cn.y,jt,In),Ip(_e,L.x,L.y,Wt.x,fr+Wt.y,Kt.x+Kt.w,Kt.y+Kt.h,f,Ln,cn.x,cn.y,jt,In),P){const Dr=P.anchor,Or=P.up;zg(Ue,Dr.x,Dr.y,Dr.z,Or[0],Or[1],Or[2]),zg(Ue,Dr.x,Dr.y,Dr.z,Or[0],Or[1],Or[2]),zg(Ue,Dr.x,Dr.y,Dr.z,Or[0],Or[1],Or[2]),zg(Ue,Dr.x,Dr.y,Dr.z,Or[0],Or[1],Or[2]),Xy(i.dynamicLayoutVertexArray,Dr.x,Dr.y,Dr.z,rt)}else Xy(i.dynamicLayoutVertexArray,L.x,L.y,L.z,rt);te.emplaceBack(Dn,Dn+1,Dn+2),te.emplaceBack(Dn+1,Dn+2,Dn+3),Xe.vertexLength+=4,Xe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(sr[0]),It!==a.length-1&&Gn===a[It+1].sectionIndex||i.programConfigurations.populatePaintArrays(_e.length,S,S.index,{},H,X,We&&We[Gn])}const Mt=P?P.anchor:L;i.placedSymbolArray.emplaceBack(Mt.x,Mt.y,Mt.z,L.x,L.y,Be,this.glyphOffsetArray.length-Be,Ze,F,V,L.segment,f?f[0]:0,f?f[1]:0,m[0],m[1],D,0,!1,0,j,0)}_commitLayoutVertex(i,a,f,m,w,S,D){i.emplaceBack(a,f,m,w,S,Math.round(D.x),Math.round(D.y))}_addCollisionDebugVertices(i,a,f,m,w,S,D){const P=f.segments.prepareSegment(4,f.layoutVertexArray,f.indexArray),L=P.vertexLength,F=D.tileAnchorX,V=D.tileAnchorY;for(let H=0;H<4;H++)f.collisionVertexArray.emplaceBack(0,0,0,0);f.collisionVertexArrayExt.emplaceBack(a,-i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(a,i.padding,-i.padding),f.collisionVertexArrayExt.emplaceBack(a,i.padding,i.padding),f.collisionVertexArrayExt.emplaceBack(a,-i.padding,i.padding),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,F,V,new Y(i.x1,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,F,V,new Y(i.x2,i.y1)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,F,V,new Y(i.x2,i.y2)),this._commitLayoutVertex(f.layoutVertexArray,m,w,S,F,V,new Y(i.x1,i.y2)),P.vertexLength+=4;const j=f.indexArray;j.emplaceBack(L,L+1),j.emplaceBack(L+1,L+2),j.emplaceBack(L+2,L+3),j.emplaceBack(L+3,L),P.primitiveLength+=4}_addTextDebugCollisionBoxes(i,a,f,m,w,S){for(let D=m;D<w;D++){const P=f.get(D),L=this.getSymbolInstanceTextSize(i,S,a,D);this._addCollisionDebugVertices(P,L,this.textCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}_addIconDebugCollisionBoxes(i,a,f,m,w,S){for(let D=m;D<w;D++){const P=f.get(D),L=this.getSymbolInstanceIconSize(i,a,S.placedIconSymbolIndex);this._addCollisionDebugVertices(P,L,this.iconCollisionBox,P.projectedAnchorX,P.projectedAnchorY,P.projectedAnchorZ,S)}}generateCollisionDebugBuffers(i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Wy(So,yw.members,il),this.iconCollisionBox=new Wy(So,yw.members,il);const f=ic(this.iconSizeData,i),m=ic(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._addTextDebugCollisionBoxes(m,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(m,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(f,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(i,a,f,m){const w=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:m),S=vp(this.textSizeData,i,w)/24;return this.tilePixelRatio*S}getSymbolInstanceIconSize(i,a,f){const m=this.icon.placedSymbolArray.get(f),w=vp(this.iconSizeData,i,m);return this.tilePixelRatio*w}_commitDebugCollisionVertexUpdate(i,a,f){i.emplaceBack(a,-f,-f),i.emplaceBack(a,f,-f),i.emplaceBack(a,f,f),i.emplaceBack(a,-f,f)}_updateTextDebugCollisionBoxes(i,a,f,m,w,S){for(let D=m;D<w;D++){const P=f.get(D),L=this.getSymbolInstanceTextSize(i,S,a,D);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,L,P.padding)}}_updateIconDebugCollisionBoxes(i,a,f,m,w,S){for(let D=m;D<w;D++){const P=f.get(D),L=this.getSymbolInstanceIconSize(i,a,S);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,L,P.padding)}}updateCollisionDebugBuffers(i,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=ic(this.iconSizeData,i),m=ic(this.textSizeData,i);for(let w=0;w<this.symbolInstances.length;w++){const S=this.symbolInstances.get(w);this._updateTextDebugCollisionBoxes(m,i,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._updateTextDebugCollisionBoxes(m,i,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._updateIconDebugCollisionBoxes(f,i,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(f,i,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(i,a,f,m,w,S,D,P,L){const F={};for(let V=a;V<f;V++){const j=i.get(V);F.textBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},F.textFeatureIndex=j.featureIndex;break}for(let V=m;V<w;V++){const j=i.get(V);F.verticalTextBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},F.verticalTextFeatureIndex=j.featureIndex;break}for(let V=S;V<D;V++){const j=i.get(V);F.iconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},F.iconFeatureIndex=j.featureIndex;break}for(let V=P;V<L;V++){const j=i.get(V);F.verticalIconBox={x1:j.x1,y1:j.y1,x2:j.x2,y2:j.y2,padding:j.padding,projectedAnchorX:j.projectedAnchorX,projectedAnchorY:j.projectedAnchorY,projectedAnchorZ:j.projectedAnchorZ,tileAnchorX:j.tileAnchorX,tileAnchorY:j.tileAnchorY},F.verticalIconFeatureIndex=j.featureIndex;break}return F}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const f=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,a){const f=i.placedSymbolArray.get(a),m=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<m;w+=4)i.indexArray.emplaceBack(w,w+1,w+2),i.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(i),f=Math.cos(i),m=[],w=[],S=[];for(let D=0;D<this.symbolInstances.length;++D){S.push(D);const P=this.symbolInstances.get(D);m.push(0|Math.round(a*P.tileAnchorX+f*P.tileAnchorY)),w.push(P.featureIndex)}return S.sort((D,P)=>m[D]-m[P]||w[P]-w[D]),S}addToSortKeyRanges(i,a){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===a?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const f=this.symbolInstances.get(a);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((m,w,S)=>{m>=0&&S.indexOf(m)===w&&this.addIndicesForPlacedSymbol(this.text,m)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}re(hf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),hf.MAX_GLYPHS=65535,hf.addDynamicAttributes=Xy;const Uw=new wn({"symbol-placement":new Dt(Rt.layout_symbol["symbol-placement"]),"symbol-spacing":new Dt(Rt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dt(Rt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new mt(Rt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dt(Rt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dt(Rt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dt(Rt.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dt(Rt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dt(Rt.layout_symbol["icon-rotation-alignment"]),"icon-size":new mt(Rt.layout_symbol["icon-size"]),"icon-text-fit":new Dt(Rt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dt(Rt.layout_symbol["icon-text-fit-padding"]),"icon-image":new mt(Rt.layout_symbol["icon-image"]),"icon-rotate":new mt(Rt.layout_symbol["icon-rotate"]),"icon-padding":new Dt(Rt.layout_symbol["icon-padding"]),"icon-keep-upright":new Dt(Rt.layout_symbol["icon-keep-upright"]),"icon-offset":new mt(Rt.layout_symbol["icon-offset"]),"icon-anchor":new mt(Rt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dt(Rt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dt(Rt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dt(Rt.layout_symbol["text-rotation-alignment"]),"text-field":new mt(Rt.layout_symbol["text-field"]),"text-font":new mt(Rt.layout_symbol["text-font"]),"text-size":new mt(Rt.layout_symbol["text-size"]),"text-max-width":new mt(Rt.layout_symbol["text-max-width"]),"text-line-height":new mt(Rt.layout_symbol["text-line-height"]),"text-letter-spacing":new mt(Rt.layout_symbol["text-letter-spacing"]),"text-justify":new mt(Rt.layout_symbol["text-justify"]),"text-radial-offset":new mt(Rt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dt(Rt.layout_symbol["text-variable-anchor"]),"text-anchor":new mt(Rt.layout_symbol["text-anchor"]),"text-max-angle":new Dt(Rt.layout_symbol["text-max-angle"]),"text-writing-mode":new Dt(Rt.layout_symbol["text-writing-mode"]),"text-rotate":new mt(Rt.layout_symbol["text-rotate"]),"text-padding":new Dt(Rt.layout_symbol["text-padding"]),"text-keep-upright":new Dt(Rt.layout_symbol["text-keep-upright"]),"text-transform":new mt(Rt.layout_symbol["text-transform"]),"text-offset":new mt(Rt.layout_symbol["text-offset"]),"text-allow-overlap":new Dt(Rt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dt(Rt.layout_symbol["text-ignore-placement"]),"text-optional":new Dt(Rt.layout_symbol["text-optional"])});var Ug={paint:new wn({"icon-opacity":new mt(Rt.paint_symbol["icon-opacity"]),"icon-color":new mt(Rt.paint_symbol["icon-color"]),"icon-halo-color":new mt(Rt.paint_symbol["icon-halo-color"]),"icon-halo-width":new mt(Rt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new mt(Rt.paint_symbol["icon-halo-blur"]),"icon-translate":new Dt(Rt.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dt(Rt.paint_symbol["icon-translate-anchor"]),"text-opacity":new mt(Rt.paint_symbol["text-opacity"]),"text-color":new mt(Rt.paint_symbol["text-color"],{runtimeType:Cu,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new mt(Rt.paint_symbol["text-halo-color"]),"text-halo-width":new mt(Rt.paint_symbol["text-halo-width"]),"text-halo-blur":new mt(Rt.paint_symbol["text-halo-blur"]),"text-translate":new Dt(Rt.paint_symbol["text-translate"]),"text-translate-anchor":new Dt(Rt.paint_symbol["text-translate-anchor"])}),layout:Uw};class Uv{constructor(i){this.type=i.property.overrides?i.property.overrides.runtimeType:di,this.defaultValue=i}evaluate(i){if(i.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(i.formattedSection))return a.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}re(Uv,"FormatSectionOverride",{omit:["defaultValue"]});class Vg extends wc{constructor(i){super(i,Ug)}recalculate(i,a){super.recalculate(i,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const f=this.layout.get("text-writing-mode");if(f){const m=[];for(const w of f)m.indexOf(w)<0&&m.push(w);this.layout._values["text-writing-mode"]=m}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(i,a,f,m){const w=this.layout.get(i).evaluate(a,{},f,m),S=this._unevaluatedLayout._values[i];return S.isDataDriven()||ju(S.value)||!w?w:(D=a.properties,w.replace(/{([^{}]+)}/g,(L,F)=>F in D?String(D[F]):""));var D}createBucket(i){return new hf(i)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const i of Ug.paint.overridableProperties){if(!Vg.hasPaintOverride(this.layout,i))continue;const a=this.paint.get(i),f=new Uv(a),m=new Da(f,a.property.specification);let w=null;w="constant"===a.value.kind||"source"===a.value.kind?new pu("source",m):new zo("composite",m,a.value.zoomStops,a.value._interpolationType),this.paint._values[i]=new en(a.property,w,a.parameters)}}_handleOverridablePaintPropertyUpdate(i,a,f){return!(!this.layout||a.isDataDriven()||f.isDataDriven())&&Vg.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,a){const f=i.get("text-field"),m=Ug.paint.properties[a];let w=!1;const S=D=>{for(const P of D)if(m.overrides&&m.overrides.hasOverride(P))return void(w=!0)};if("constant"===f.value.kind&&f.value.value instanceof hi)S(f.value.value.sections);else if("source"===f.value.kind){const D=L=>{w||(L instanceof li&&ms(L.value)===Hs?S(L.value.sections):L instanceof ws?S(L.sections):L.eachChild(D))},P=f.value;P._styleExpression&&D(P._styleExpression.expression)}return w}getProgramConfiguration(i){return new Il(this,i)}}var Yy={paint:new wn({"background-color":new Dt(Rt.paint_background["background-color"]),"background-pattern":new _n(Rt.paint_background["background-pattern"]),"background-opacity":new Dt(Rt.paint_background["background-opacity"])})},Vw={paint:new wn({"raster-opacity":new Dt(Rt.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dt(Rt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dt(Rt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dt(Rt.paint_raster["raster-brightness-max"]),"raster-saturation":new Dt(Rt.paint_raster["raster-saturation"]),"raster-contrast":new Dt(Rt.paint_raster["raster-contrast"]),"raster-resampling":new Dt(Rt.paint_raster["raster-resampling"]),"raster-fade-duration":new Dt(Rt.paint_raster["raster-fade-duration"])})};class jw extends wc{constructor(i){super(i,{}),this.implementation=i}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(i){this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)}onRemove(i){this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)}}var Gw={paint:new wn({"sky-type":new Dt(Rt.paint_sky["sky-type"]),"sky-atmosphere-sun":new Dt(Rt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Dt(Rt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Dt(Rt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Dt(Rt.paint_sky["sky-gradient-radius"]),"sky-gradient":new Cn(Rt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Dt(Rt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Dt(Rt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Dt(Rt.paint_sky["sky-opacity"])})};function Ky(s,i,a){const f=[0,0,1],m=ty([]);return ag(m,m,a?-se(s)+Math.PI:se(s)),L0(m,m,-se(i)),R0(f,f,m),Au(f,f)}const $w={circle:class extends wc{constructor(s){super(s,ol)}createBucket(s){return new S0(s)}queryRadius(s){const i=s;return Ff("circle-radius",this,i)+Ff("circle-stroke-width",this,i)+yd(this.paint.get("circle-translate"))}queryIntersectsFeature(s,i,a,f,m,w,S,D){const P=Xm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),L=this.paint.get("circle-radius").evaluate(i,a)+this.paint.get("circle-stroke-width").evaluate(i,a);return O0(s,f,w,S,D,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),P,L)}getProgramIds(){return["circle"]}getProgramConfiguration(s){return new Il(this,s)}},heatmap:class extends wc{createBucket(s){return new F0(s)}constructor(s){super(s,B0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"heatmap-color"===s&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ay({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(s){return Ff("heatmap-radius",this,s)}queryIntersectsFeature(s,i,a,f,m,w,S,D){const P=this.paint.get("heatmap-radius").evaluate(i,a);return O0(s,f,w,S,D,!0,!0,new Y(0,0),P)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(s){return new Il(this,s)}},hillshade:class extends wc{constructor(s){super(s,nS)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends wc{constructor(s){super(s,ow)}getProgramIds(){const s=this.paint.get("fill-pattern"),i=s&&s.constantOr(1),a=[i?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(i&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(s){return new Il(this,s)}recalculate(s,i){super.recalculate(s,i);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new yg(s)}queryRadius(){return yd(this.paint.get("fill-translate"))}queryIntersectsFeature(s,i,a,f,m,w){return!s.queryGeometry.isAboveHorizon&&tg(Hm(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),f)}isTileClipped(){return!0}},"fill-extrusion":class extends wc{constructor(s){super(s,bg)}createBucket(s){return new Uf(s)}queryRadius(){return yd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(s){return new Il(this,s)}queryIntersectsFeature(s,i,a,f,m,w,S,D,P){const L=Xm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),F=this.paint.get("fill-extrusion-height").evaluate(i,a),V=this.paint.get("fill-extrusion-base").evaluate(i,a),j=[0,0],H=D&&w.elevation,X=w.elevation?w.elevation.exaggeration():1,te=s.tile.getBucket(this);if(H&&te instanceof Uf){const Ze=te.centroidVertexArray,rt=P+1;if(rt<Ze.length){const We=Ze.get(rt);j[0]=We.a_centroid_pos0,j[1]=We.a_centroid_pos1}}if(0===j[0]&&1===j[1])return!1;"globe"===w.projection.name&&(f=Q0([f],[new Y(0,0),new Y(cr,cr)],s.tileID.canonical).map(Ze=>Ze.polygon).flat());const _e=H?D:null,[Ue,Xe]=(rt=f,We=V,Mt=F,It=L,Ht=S,ln=_e,kt=j,Wt=X,Kt=w.center.lat,"globe"===(Ze=w).projection.name?function(cn,jt,In,sr,Ln,Gn,Dn,fr,Dr,Or,yi){const Mr=[],Ko=[],Zr=cn.projection.upVectorScale(yi,cn.center.lat,cn.worldSize).metersToTile,ii=[0,0,0,1],Ti=[0,0,0,1],Lo=(Ir,Ar,lo,ja)=>{Ir[0]=Ar,Ir[1]=lo,Ir[2]=ja,Ir[3]=1},Uo=J0();In>0&&(In+=Uo),sr+=Uo;for(const Ir of jt){const Ar=[],lo=[];for(const ja of Ir){const co=ja.x+Ln.x,Gs=ja.y+Ln.y,$s=cn.projection.projectTilePoint(co,Gs,yi),wi=cn.projection.upVector(yi,ja.x,ja.y);let Jo=In,la=sr;if(Dn){const xo=rv(co,Gs,In,sr,Dn,fr,Dr,Or);Jo+=xo.base,la+=xo.top}0!==In?Lo(ii,$s.x+wi[0]*Zr*Jo,$s.y+wi[1]*Zr*Jo,$s.z+wi[2]*Zr*Jo):Lo(ii,$s.x,$s.y,$s.z),Lo(Ti,$s.x+wi[0]*Zr*la,$s.y+wi[1]*Zr*la,$s.z+wi[2]*Zr*la),js(ii,ii,Gn),js(Ti,Ti,Gn),Ar.push(new Id(ii[0],ii[1],ii[2])),lo.push(new Id(Ti[0],Ti[1],Ti[2]))}Mr.push(Ar),Ko.push(lo)}return[Mr,Ko]}(Ze,rt,We,Mt,It,Ht,ln,kt,Wt,Kt,s.tileID.canonical):ln?function(cn,jt,In,sr,Ln,Gn,Dn,fr,Dr){const Or=[],yi=[],Mr=[0,0,0,1];for(const Ko of cn){const Zr=[],ii=[];for(const Ti of Ko){const Lo=Ti.x+sr.x,Uo=Ti.y+sr.y,Ir=rv(Lo,Uo,jt,In,Gn,Dn,fr,Dr);Mr[0]=Lo,Mr[1]=Uo,Mr[2]=Ir.base,Mr[3]=1,nc(Mr,Mr,Ln),Mr[3]=Math.max(Mr[3],1e-5);const Ar=new Id(Mr[0]/Mr[3],Mr[1]/Mr[3],Mr[2]/Mr[3]);Mr[0]=Lo,Mr[1]=Uo,Mr[2]=Ir.top,Mr[3]=1,nc(Mr,Mr,Ln),Mr[3]=Math.max(Mr[3],1e-5);const lo=new Id(Mr[0]/Mr[3],Mr[1]/Mr[3],Mr[2]/Mr[3]);Zr.push(Ar),ii.push(lo)}Or.push(Zr),yi.push(ii)}return[Or,yi]}(rt,We,Mt,It,Ht,ln,kt,Wt,Kt):function(cn,jt,In,sr,Ln){const Gn=[],Dn=[],fr=Ln[8]*jt,Dr=Ln[9]*jt,Or=Ln[10]*jt,yi=Ln[11]*jt,Mr=Ln[8]*In,Ko=Ln[9]*In,Zr=Ln[10]*In,ii=Ln[11]*In;for(const Ti of cn){const Lo=[],Uo=[];for(const Ir of Ti){const Ar=Ir.x+sr.x,lo=Ir.y+sr.y,ja=Ln[0]*Ar+Ln[4]*lo+Ln[12],co=Ln[1]*Ar+Ln[5]*lo+Ln[13],Gs=Ln[2]*Ar+Ln[6]*lo+Ln[14],$s=Ln[3]*Ar+Ln[7]*lo+Ln[15],wi=ja+fr,Jo=co+Dr,la=Gs+Or,xo=Math.max($s+yi,1e-5),Pi=ja+Mr,nu=co+Ko,Ga=Gs+Zr,Aa=Math.max($s+ii,1e-5);Lo.push(new Id(wi/xo,Jo/xo,la/xo)),Uo.push(new Id(Pi/Aa,nu/Aa,Ga/Aa))}Gn.push(Lo),Dn.push(Uo)}return[Gn,Dn]}(rt,We,Mt,It,Ht)),Be=s.queryGeometry;var Ze,rt,We,Mt,It,Ht,ln,kt,Wt,Kt;return function(Ze,rt,We){let Mt=1/0;tg(We,rt)&&(Mt=vy(We,rt[0]));for(let It=0;It<rt.length;It++){const Ht=rt[It],ln=Ze[It];for(let kt=0;kt<Ht.length-1;kt++){const Wt=Ht[kt],Kt=[Wt,Ht[kt+1],ln[kt+1],ln[kt],Wt];I0(We,Kt)&&(Mt=Math.min(Mt,vy(We,Kt)))}}return Mt!==1/0&&Mt}(Ue,Xe,Be.isPointQuery()?Be.screenBounds:Be.screenGeometry)}},line:class extends wc{constructor(s){super(s,xy),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(s){if("line-gradient"===s){const i=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=i._styleExpression&&i._styleExpression.expression instanceof Gr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,i){super.recalculate(s,i),this.paint._values["line-floorwidth"]=wy.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new tf(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(s){return new Il(this,s)}queryRadius(s){const i=s,a=by(Ff("line-width",this,i),Ff("line-gap-width",this,i)),f=Ff("line-offset",this,i);return a/2+Math.abs(f)+yd(this.paint.get("line-translate"))}queryIntersectsFeature(s,i,a,f,m,w){if(s.queryGeometry.isAboveHorizon)return!1;const S=Hm(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,s.pixelToTileUnitsFactor),D=s.pixelToTileUnitsFactor/2*by(this.paint.get("line-width").evaluate(i,a),this.paint.get("line-gap-width").evaluate(i,a)),P=this.paint.get("line-offset").evaluate(i,a);return P&&(f=function(L,F){const V=[],j=new Y(0,0);for(let H=0;H<L.length;H++){const X=L[H],te=[];for(let _e=0;_e<X.length;_e++){const Ue=X[_e-1],Xe=X[_e],Be=X[_e+1],Ze=0===_e?j:Xe.sub(Ue)._unit()._perp(),rt=_e===X.length-1?j:Be.sub(Xe)._unit()._perp(),We=Ze._add(rt)._unit();We._mult(1/(We.x*rt.x+We.y*rt.y)),te.push(We._mult(F)._add(Xe))}V.push(te)}return V}(f,P*s.pixelToTileUnitsFactor)),function(L,F,V){for(let j=0;j<F.length;j++){const H=F[j];if(L.length>=3)for(let X=0;X<H.length;X++)if(md(L,H[X]))return!0;if(tS(L,H,V))return!0}return!1}(S,f,D)}isTileClipped(){return!0}},symbol:Vg,background:class extends wc{constructor(s){super(s,Yy)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends wc{constructor(s){super(s,Vw)}getProgramIds(){return["raster"]}},sky:class extends wc{constructor(s){super(s,Gw),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){"sky-gradient"===s?this._updateColorRamp():"sky-atmosphere-sun"!==s&&"sky-atmosphere-halo-color"!==s&&"sky-atmosphere-color"!==s&&"sky-atmosphere-sun-intensity"!==s||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ay({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const i=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==i.azimuthal||this._lightPosition.polar!==i.polar}return!1}getCenter(s,i){if("atmosphere"===this.paint.get("sky-type")){const f=this.paint.get("sky-atmosphere-sun"),m=!f,w=s.style.light,S=w.properties.get("position");return m&&"viewport"===w.properties.get("anchor")&&Sn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),m?Ky(S.azimuthal,90-S.polar,i):Ky(f[0],90-f[1],i)}const a=this.paint.get("sky-gradient-center");return Ky(a[0],90-a[1],i)}is3D(){return!1}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return"atmosphere"===s?["skyboxCapture","skybox"]:"gradient"===s?["skyboxGradient"]:null}}};class ul{constructor(i,a,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(a,m)}update(i,a,f){const{width:m,height:w}=i,{context:S}=this,{gl:D}=S,{HTMLImageElement:P,HTMLCanvasElement:L,HTMLVideoElement:F,ImageData:V,ImageBitmap:j}=ve;if(D.bindTexture(D.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!a||!1!==a.premultiply)),f||this.size&&this.size[0]===m&&this.size[1]===w){const{x:H,y:X}=f||{x:0,y:0};i instanceof P||i instanceof L||i instanceof F||i instanceof V||j&&i instanceof j?D.texSubImage2D(D.TEXTURE_2D,0,H,X,D.RGBA,D.UNSIGNED_BYTE,i):D.texSubImage2D(D.TEXTURE_2D,0,H,X,m,w,D.RGBA,D.UNSIGNED_BYTE,i.data)}else this.size=[m,w],i instanceof P||i instanceof L||i instanceof F||i instanceof V||j&&i instanceof j?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,i):D.texImage2D(D.TEXTURE_2D,0,this.format,m,w,0,this.format,D.UNSIGNED_BYTE,i.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&D.generateMipmap(D.TEXTURE_2D)}bind(i,a){const{context:f}=this,{gl:m}=f;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?i===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_NEAREST:i),this.filter=i),a!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}class Jy{constructor(i){this._callback=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class qw{constructor(){this.tasks={},this.taskQueue=[],fn(["process"],this),this.invoker=new Jy(this.process),this.nextId=0}add(i,a){const f=this.nextId++,m=function({type:w,isSymbolTile:S,zoom:D}){return D=D||0,"message"===w?0:"maybePrepare"!==w||S?"parseTile"!==w||S?"parseTile"===w&&S?300-D:"maybePrepare"===w&&S?400-D:500:200-D:100-D}(a);if(0===m){ti();try{i()}finally{}return{cancel:()=>{}}}return this.tasks[f]={fn:i,metadata:a,priority:m,id:f},this.taskQueue.push(f),this.invoker.trigger(),{cancel:()=>{delete this.tasks[f]}}}process(){ti();try{if(this.taskQueue=this.taskQueue.filter(f=>!!this.tasks[f]),!this.taskQueue.length)return;const i=this.pick();if(null===i)return;const a=this.tasks[i];if(delete this.tasks[i],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let i=null,a=1/0;for(let m=0;m<this.taskQueue.length;m++){const w=this.tasks[this.taskQueue[m]];w.priority<a&&(a=w.priority,i=m)}if(null===i)return null;const f=this.taskQueue[i];return this.taskQueue.splice(i,1),f}remove(){this.invoker.remove()}}class Vv{constructor(i){this._stringToNumber={},this._numberToString=[];for(let a=0;a<i.length;a++){const f=i[a];this._stringToNumber[f]=a,this._numberToString[a]=f}}encode(i){return this._stringToNumber[i]}decode(i){return this._numberToString[i]}}const jv=["tile","layer","source","sourceLayer","state"];class Gv{constructor(i,a,f,m,w){this.type="Feature",this._vectorTileFeature=i,this._z=a,this._x=f,this._y=m,this.properties=i.properties,this.id=w}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(i.id=this.id);for(const a of jv)void 0!==this[a]&&(i[a]=this[a]);return i}}const eh=new Uint16Array(8184);for(let s=0;s<2046;s++){let i=s+2,a=0,f=0,m=0,w=0,S=0,D=0;for(1&i?m=w=S=32:a=f=D=32;(i>>=1)>1;){const L=a+m>>1,F=f+w>>1;1&i?(m=a,w=f,a=S,f=D):(a=m,f=w,m=S,w=D),S=L,D=F}const P=4*s;eh[P+0]=a,eh[P+1]=f,eh[P+2]=m,eh[P+3]=w}const th=new Uint16Array(2178),ff=new Uint8Array(1089),Hf=new Uint16Array(1089);function jg(s){return 0===s?-.03125:32===s?.03125:0}var Tp=bn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Hw={type:2,extent:cr,loadGeometry:()=>[[new Y(0,0),new Y(8193,0),new Y(8193,8193),new Y(0,8193),new Y(0,0)]]};class Dp{constructor(i,a,f,m,w){this.tileID=i,this.uid=dt(),this.uses=0,this.tileSize=a,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,this.expiredRequestCount=0,this.state="loading",m&&m.transform&&(this.projection=m.transform.projection)}registerFadeDuration(i){const a=i+this.timeAdded;a<ci.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=uf(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,a,f){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,w){const S={};if(!w)return S;for(const D of m){const P=D.layerIds.map(L=>w.getLayer(L)).filter(Boolean);if(0!==P.length){D.layers=P,D.stateDependentLayerIds&&(D.stateDependentLayers=D.stateDependentLayerIds.map(L=>P.filter(F=>F.id===L)[0]));for(const L of P)S[L.id]=D}}return S}(i.buckets,a.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const w=this.buckets[m];if(w instanceof hf){if(this.hasSymbolBuckets=!0,!f)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const w=this.buckets[m];if(w instanceof hf&&w.hasRTLText){this.hasRTLText=!0,Qe.isLoading()||Qe.isLoaded()||"deferred"!==Se()||Ye();break}}this.queryPadding=0;for(const m in this.buckets){const w=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(m).queryRadius(w))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas)}else this.collisionBoxArray=new Om}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const a=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ul(i,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ul(i,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new ul(i,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,a,f,m,w,S,D,P){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:m,pixelPosMatrix:D,transform:S,params:w,tileTransform:this.tileTransform},i,a,f):{}}querySourceFeatures(i,a){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),w=a?a.sourceLayer:"",S=m._geojsonTileLayer||m[w];if(!S)return;const D=Vc(a&&a.filter),{z:P,x:L,y:F}=this.tileID.canonical,V={z:P,x:L,y:F};for(let j=0;j<S.length;j++){const H=S.feature(j);if(D.needGeometry){const _e=Yh(H,!0);if(!D.filter(new Ge(this.tileID.overscaledZ),_e,this.tileID.canonical))continue}else if(!D.filter(new Ge(this.tileID.overscaledZ),H))continue;const X=f.getId(H,w),te=new Gv(H,P,L,F,X);te.tile=V,i.push(te)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const a=this.expirationTime;if(i.cacheControl){const f=io(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{const w=this.expirationTime-a;w?this.expirationTime=f+Math.max(w,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(i,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(i).length||!a)return;const f=this.latestFeatureIndex.loadVTLayers(),m=a.style.listImages();for(const w in this.buckets){if(!a.style.hasLayer(w))continue;const S=this.buckets[w],D=S.layers[0].sourceLayer||"_geojsonTileLayer",P=f[D],L=i[D];if(!P||!L||0===Object.keys(L).length)continue;if(S.update(L,P,m,this.imageAtlas&&this.imageAtlas.patternPositions||{}),S instanceof tf||S instanceof yg){const V=a.style._getSourceCache(S.layers[0].source);a._terrain&&a._terrain.enabled&&V&&S.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(V.id,this.tileID)}const F=a&&a.style&&a.style.getLayer(w);F&&(this.queryPadding=Math.max(this.queryPadding,F.queryRadius(S)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ci.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=ci.now()+i}setTexture(i,a){const f=a.context,m=f.gl;this.texture=this.texture||a.getTileTexture(i.width),this.texture?this.texture.update(i,{useMipmap:!0}):(this.texture=new ul(f,i,m.RGBA,{useMipmap:!0}),this.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE),f.extTextureFilterAnisotropic&&m.texParameterf(m.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax))}setDependencies(i,a){const f={};for(const m of a)f[m]=!0;this.dependencies[i]=f}hasDependency(i,a){for(const f of i){const m=this.dependencies[f];if(m)for(const w of a)if(m[w])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const f=yh(Hw,this.tileID.canonical,this.tileTransform)[0],m=new Fr,w=new hd;for(let S=0;S<f.length;S++){const{x:D,y:P}=f[S];m.emplaceBack(D,P),w.emplaceBack(S)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(m,jf.members),this._tileDebugSegments=Vs.simpleSegment(0,0,m.length,w.length)}_makeTileBoundsBuffers(i,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const f=yh(Hw,this.tileID.canonical,this.tileTransform)[0];let m,w;if(this.isRaster){const S=function(D,P){const L=uf(D,P),F=Math.pow(2,D.z);for(let _e=0;_e<33;_e++)for(let Ue=0;Ue<33;Ue++){const Xe=Dl((D.x+(Ue+jg(Ue))/32)/F),Be=ea((D.y+(_e+jg(_e))/32)/F),Ze=P.project(Xe,Be),rt=33*_e+Ue;th[2*rt+0]=Math.round((Ze.x*L.scale-L.x)*cr),th[2*rt+1]=Math.round((Ze.y*L.scale-L.y)*cr)}ff.fill(0),Hf.fill(0);for(let _e=2045;_e>=0;_e--){const Ue=4*_e,Xe=eh[Ue+0],Be=eh[Ue+1],Ze=eh[Ue+2],rt=eh[Ue+3],We=Xe+Ze>>1,Mt=Be+rt>>1,It=We+Mt-Be,Ht=Mt+Xe-We,ln=33*Be+Xe,kt=33*rt+Ze,Wt=33*Mt+We,Kt=Math.hypot((th[2*ln+0]+th[2*kt+0])/2-th[2*Wt+0],(th[2*ln+1]+th[2*kt+1])/2-th[2*Wt+1])>=16;if(ff[Wt]=ff[Wt]||(Kt?1:0),_e<1022){const rn=33*(Be+Ht>>1)+(Xe+It>>1),cn=33*(rt+Ht>>1)+(Ze+It>>1);ff[Wt]=ff[Wt]||ff[rn]||ff[cn]}}const V=new Ro,j=new Qa;let H=0;function X(_e,Ue){const Xe=33*Ue+_e;return 0===Hf[Xe]&&(V.emplaceBack(th[2*Xe+0],th[2*Xe+1],_e*cr/32,Ue*cr/32),Hf[Xe]=++H),Hf[Xe]-1}function te(_e,Ue,Xe,Be,Ze,rt){const We=_e+Xe>>1,Mt=Ue+Be>>1;if(Math.abs(_e-Ze)+Math.abs(Ue-rt)>1&&ff[33*Mt+We])te(Ze,rt,_e,Ue,We,Mt),te(Xe,Be,Ze,rt,We,Mt);else{const It=X(_e,Ue),Ht=X(Xe,Be),ln=X(Ze,rt);j.emplaceBack(It,Ht,ln)}}return te(0,0,32,32,32,0),te(32,32,0,0,0,32),{vertices:V,indices:j}}(this.tileID.canonical,a);m=S.vertices,w=S.indices}else{m=new Ro,w=new Qa;for(const{x:D,y:P}of f)m.emplaceBack(D,P,0,0);const S=wd.exports(m.int16,void 0,4);for(let D=0;D<S.length;D+=3)w.emplaceBack(S[D],S[D+1],S[D+2])}this._tileBoundsBuffer=i.createVertexBuffer(m,Tp.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=Vs.simpleSegment(0,0,m.length,w.length)}_makeGlobeTileDebugBuffers(i,a){const f=a.projection;if(!f||"globe"!==f.name||a.freezeTileCoverage)return;const m=this.tileID.canonical,w=Fd(Pv(m,a)),S=af(a.zoom);let D;S>0&&(D=Wm(new Float64Array(16),a.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,m,a,w,D,S),this._makeGlobeTileDebugTextBuffer(i,m,a,w,D,S)}_globePoint(i,a,f,m,w,S,D){let P=kd(i,a,f);if(S){const L=1<<f.z,F=Tl(m.center.lng),V=bc(m.center.lat),j=(f.x+.5)/L-F;let H=0;j>.5?H=-1:j<-.5&&(H=1);let X=(i/cr+f.x)/L+H,te=(a/cr+f.y)/L;X=(X-F)*m._pixelsPerMercatorPixel+F,te=(te-V)*m._pixelsPerMercatorPixel+V;const _e=[X*m.worldSize,te*m.worldSize,0];js(_e,_e,S),P=Kc(P,_e,D)}return js(P,P,w)}_makeGlobeTileDebugBorderBuffer(i,a,f,m,w,S){const D=new Fr,P=new hd,L=new ao,F=(j,H,X,te,_e)=>{const Ue=(X-j)/(_e-1),Xe=(te-H)/(_e-1),Be=D.length;for(let Ze=0;Ze<_e;Ze++){const rt=j+Ze*Ue,We=H+Ze*Xe;D.emplaceBack(rt,We);const Mt=this._globePoint(rt,We,a,f,m,w,S);L.emplaceBack(Mt[0],Mt[1],Mt[2]),P.emplaceBack(Be+Ze)}},V=cr;F(0,0,V,0,16),F(V,0,V,V,16),F(V,V,0,V,16),F(0,V,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(P),this._tileDebugBuffer=i.createVertexBuffer(D,jf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(L,Lg.members),this._tileDebugSegments=Vs.simpleSegment(0,0,D.length,P.length)}_makeGlobeTileDebugTextBuffer(i,a,f,m,w,S){const D=new Fr,P=new Qa,L=new ao,F=25;P.reserve(32),D.reserve(F),L.reserve(F);const V=(j,H)=>F*j+H;for(let j=0;j<F;j++){const H=2048*j;for(let X=0;X<F;X++){const te=2048*X;D.emplaceBack(te,H);const _e=this._globePoint(te,H,a,f,m,w,S);L.emplaceBack(_e[0],_e[1],_e[2])}}for(let j=0;j<4;j++)for(let H=0;H<4;H++){const X=V(j,H),te=V(j,H+1),_e=V(j+1,H),Ue=V(j+1,H+1);P.emplaceBack(X,te,_e),P.emplaceBack(_e,te,Ue)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(P),this._tileDebugTextBuffer=i.createVertexBuffer(D,jf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(L,Lg.members),this._tileDebugTextSegments=Vs.simpleSegment(0,0,F,32)}}class dS{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,a,f){const m=String(a);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},Me(this.stateChanges[i][m],f),null===this.deletedStates[i]){this.deletedStates[i]={};for(const w in this.state[i])w!==m&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&null===this.deletedStates[i][m]){this.deletedStates[i][m]={};for(const w in this.state[i][m])f[w]||(this.deletedStates[i][m][w]=null)}else for(const w in f)this.deletedStates[i]&&this.deletedStates[i][m]&&null===this.deletedStates[i][m][w]&&delete this.deletedStates[i][m][w]}removeFeatureState(i,a,f){if(null===this.deletedStates[i])return;const m=String(a);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&void 0!==a)null!==this.deletedStates[i][m]&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(void 0!==a)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,a){const f=String(a),m=Me({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(null===this.deletedStates[i])return{};if(this.deletedStates[i]){const w=this.deletedStates[i][a];if(null===w)return{};for(const S in w)delete m[S]}return m}initializeTileState(i,a){i.setFeatureState(this.state,a)}coalesceChanges(i,a){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const w={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),Me(this.state[m][S],this.stateChanges[m][S]),w[S]=this.state[m][S];f[m]=w}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const w={};if(null===this.deletedStates[m])for(const S in this.state[m])w[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(null===this.deletedStates[m][S])this.state[m][S]={};else for(const D of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][D];w[S]=this.state[m][S]}f[m]=f[m]||{},Me(f[m],w)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(f).length)for(const m in i)i[m].setFeatureState(f,a)}}class Qy{constructor(i){this.size=i,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(i,a){const f=this.toIdx(i,a);return{min:this.minimums[f],max:this.maximums[f]}}isLeaf(i,a){return this.leaves[this.toIdx(i,a)]}toIdx(i,a){return a*this.size+i}}function e_(s,i,a,f){let m=0,w=Number.MAX_VALUE;for(let S=0;S<3;S++)if(Math.abs(f[S])<1e-15){if(a[S]<s[S]||a[S]>i[S])return null}else{const D=1/f[S];let P=(s[S]-a[S])*D,L=(i[S]-a[S])*D;if(P>L){const F=P;P=L,L=F}if(P>m&&(m=P),L<w&&(w=L),m>w)return null}return m}function t_(s,i,a,f,m,w,S,D,P,L,F){const V=f-s,j=m-i,H=w-a,X=S-s,te=D-i,_e=P-a,Ue=F[1]*_e-F[2]*te,Xe=F[2]*X-F[0]*_e,Be=F[0]*te-F[1]*X,Ze=V*Ue+j*Xe+H*Be;if(Math.abs(Ze)<1e-15)return null;const rt=1/Ze,We=L[0]-s,Mt=L[1]-i,It=L[2]-a,Ht=(We*Ue+Mt*Xe+It*Be)*rt;if(Ht<0||Ht>1)return null;const ln=Mt*H-It*j,kt=It*V-We*H,Wt=We*j-Mt*V,Kt=(F[0]*ln+F[1]*kt+F[2]*Wt)*rt;return Kt<0||Ht+Kt>1?null:(X*ln+te*kt+_e*Wt)*rt}function n_(s,i,a){return(s-i)/(a-i)}function Gg(s,i,a,f,m,w,S,D,P){const L=1<<a,F=w-f,V=S-m,j=(s+1)/L*F+f,H=(i+0)/L*V+m,X=(i+1)/L*V+m;D[0]=(s+0)/L*F+f,D[1]=H,P[0]=j,P[1]=X}class nh{constructor(i){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=i,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(w){const S=Math.ceil(Math.log2(w.dim/8)),D=[];let P=Math.ceil(Math.pow(2,S));const L=1/P,F=(H,X,te,_e,Ue)=>{const Xe=_e?1:0,Be=(H+1)*te-Xe,Ze=X*te,rt=(X+1)*te-Xe;Ue[0]=H*te,Ue[1]=Ze,Ue[2]=Be,Ue[3]=rt};let V=new Qy(P);const j=[];for(let H=0;H<P*P;H++){F(H%P,Math.floor(H/P),L,!1,j);const X=Ac(j[0],j[1],w),te=Ac(j[2],j[1],w),_e=Ac(j[2],j[3],w),Ue=Ac(j[0],j[3],w);V.minimums.push(Math.min(X,te,_e,Ue)),V.maximums.push(Math.max(X,te,_e,Ue)),V.leaves.push(1)}for(D.push(V),P/=2;P>=1;P/=2){const H=D[D.length-1];V=new Qy(P);for(let X=0;X<P*P;X++){F(X%P,Math.floor(X/P),2,!0,j);const te=H.getElevation(j[0],j[1]),_e=H.getElevation(j[2],j[1]),Ue=H.getElevation(j[2],j[3]),Xe=H.getElevation(j[0],j[3]),Be=H.isLeaf(j[0],j[1]),Ze=H.isLeaf(j[2],j[1]),rt=H.isLeaf(j[2],j[3]),We=H.isLeaf(j[0],j[3]),Mt=Math.min(te.min,_e.min,Ue.min,Xe.min),It=Math.max(te.max,_e.max,Ue.max,Xe.max),Ht=Be&&Ze&&rt&&We;V.maximums.push(It),V.minimums.push(Mt),V.leaves.push(It-Mt<=5&&Ht?1:0)}D.push(V)}return D}(this.dem),f=a.length-1,m=a[f];this._addNode(m.minimums[0],m.maximums[0],m.leaves[0]),this._construct(a,0,0,f,0)}raycastRoot(i,a,f,m,w,S,D=1){return e_([i,a,-100],[f,m,this.maximums[0]*D],w,S)}raycast(i,a,f,m,w,S,D=1){if(!this.nodeCount)return null;const P=this.raycastRoot(i,a,f,m,w,S,D);if(null==P)return null;const L=[],F=[],V=[],j=[],H=[{idx:0,t:P,nodex:0,nodey:0,depth:0}];for(;H.length>0;){const{idx:X,t:te,nodex:_e,nodey:Ue,depth:Xe}=H.pop();if(this.leaves[X]){Gg(_e,Ue,Xe,i,a,f,m,V,j);const Ze=1<<Xe,rt=(_e+0)/Ze,We=(_e+1)/Ze,Mt=(Ue+0)/Ze,It=(Ue+1)/Ze,Ht=Ac(rt,Mt,this.dem)*D,ln=Ac(We,Mt,this.dem)*D,kt=Ac(We,It,this.dem)*D,Wt=Ac(rt,It,this.dem)*D,Kt=t_(V[0],V[1],Ht,j[0],V[1],ln,j[0],j[1],kt,w,S),rn=t_(j[0],j[1],kt,V[0],j[1],Wt,V[0],V[1],Ht,w,S),cn=Math.min(null!==Kt?Kt:Number.MAX_VALUE,null!==rn?rn:Number.MAX_VALUE);if(cn!==Number.MAX_VALUE)return cn;{const jt=xd([],w,S,te);if(Mp(Ht,ln,Wt,kt,n_(jt[0],V[0],j[0]),n_(jt[1],V[1],j[1]))>=jt[2])return te}continue}let Be=0;for(let Ze=0;Ze<this._siblingOffset.length;Ze++){Gg((_e<<1)+this._siblingOffset[Ze][0],(Ue<<1)+this._siblingOffset[Ze][1],Xe+1,i,a,f,m,V,j),V[2]=-100,j[2]=this.maximums[this.childOffsets[X]+Ze]*D;const rt=e_(V,j,w,S);if(null!=rt){const We=rt;L[Ze]=We;let Mt=!1;for(let It=0;It<Be&&!Mt;It++)We>=L[F[It]]&&(F.splice(It,0,Ze),Mt=!0);Mt||(F[Be]=Ze),Be++}}for(let Ze=0;Ze<Be;Ze++){const rt=F[Ze];H.push({idx:this.childOffsets[X]+rt,t:L[rt],nodex:(_e<<1)+this._siblingOffset[rt][0],nodey:(Ue<<1)+this._siblingOffset[rt][1],depth:Xe+1})}}return null}_addNode(i,a,f){return this.minimums.push(i),this.maximums.push(a),this.leaves.push(f),this.childOffsets.push(0),this.nodeCount++}_construct(i,a,f,m,w){if(1===i[m].isLeaf(a,f))return;this.childOffsets[w]||(this.childOffsets[w]=this.nodeCount);const S=m-1,D=i[S];let P=0,L=0;for(let F=0;F<this._siblingOffset.length;F++){const V=2*a+this._siblingOffset[F][0],j=2*f+this._siblingOffset[F][1],H=D.getElevation(V,j),X=D.isLeaf(V,j),te=this._addNode(H.min,H.max,X);X&&(P|=1<<F),L||(L=te)}for(let F=0;F<this._siblingOffset.length;F++)P&1<<F||this._construct(i,2*a+this._siblingOffset[F][0],2*f+this._siblingOffset[F][1],S,L+F)}}function Mp(s,i,a,f,m,w){return ni(ni(s,a,w),ni(i,f,w),m)}function Ac(s,i,a){const f=a.dim,m=ue(s*f-.5,0,f-1),w=ue(i*f-.5,0,f-1),S=Math.floor(m),D=Math.floor(w),P=Math.min(S+1,f-1),L=Math.min(D+1,f-1);return Mp(a.get(S,D),a.get(P,D),a.get(S,L),a.get(P,L),m-S,w-D)}const Bd={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class $g{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(i,a,f,m=!1,w=!1){if(this.uid=i,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(f&&"mapbox"!==f&&"terrarium"!==f)return Sn(`"${f}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const S=this.dim=a.height-2,D=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=f||"mapbox",this.borderReady=m,!m){for(let P=0;P<S;P++)D[this._idx(-1,P)]=D[this._idx(0,P)],D[this._idx(S,P)]=D[this._idx(S-1,P)],D[this._idx(P,-1)]=D[this._idx(P,0)],D[this._idx(P,S)]=D[this._idx(P,S-1)];D[this._idx(-1,-1)]=D[this._idx(0,0)],D[this._idx(S,-1)]=D[this._idx(S-1,0)],D[this._idx(-1,S)]=D[this._idx(0,S-1)],D[this._idx(S,S)]=D[this._idx(S-1,S-1)],w&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new nh(this)}get(i,a,f=!1){f&&(i=ue(i,-1,this.dim),a=ue(a,-1,this.dim));const m=4*this._idx(i,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[m],this.pixels[m+1],this.pixels[m+2])}static getUnpackVector(i){return Bd[i]}get unpackVector(){return Bd[this.encoding]}_idx(i,a){if(i<-1||i>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(i+1)}_unpackMapbox(i,a,f){return(256*i*256+256*a+f)/10-1e4}_unpackTerrarium(i,a,f){return 256*i+a+f/256-32768}static pack(i,a){const f=[0,0,0,0],m=$g.getUnpackVector(a);let w=Math.floor((i+m[3])/m[2]);return f[2]=w%256,w=Math.floor(w/256),f[1]=w%256,w=Math.floor(w/256),f[0]=w,f}getPixels(){return new Xu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(i,a,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let m=a*this.dim,w=a*this.dim+this.dim,S=f*this.dim,D=f*this.dim+this.dim;switch(a){case-1:m=w-1;break;case 1:w=m+1}switch(f){case-1:S=D-1;break;case 1:D=S+1}const P=-a*this.dim,L=-f*this.dim;for(let F=S;F<D;F++)for(let V=m;V<w;V++){const j=4*this._idx(V,F),H=4*this._idx(V+P,F+L);this.pixels[j+0]=i.pixels[H+0],this.pixels[j+1]=i.pixels[H+1],this.pixels[j+2]=i.pixels[H+2],this.pixels[j+3]=i.pixels[H+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}re($g,"DEMData"),re(nh,"DemMinMaxQuadTree",{omit:["dem"]});class $v{constructor(i,a){this.max=i,this.onRemove=a,this.reset()}reset(){for(const i in this.data)for(const a of this.data[i])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(i,a,f){const m=i.wrapped().key;void 0===this.data[m]&&(this.data[m]=[]);const w={value:a,timeout:void 0};if(void 0!==f&&(w.timeout=setTimeout(()=>{this.remove(i,w)},f)),this.data[m].push(w),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const a=this.data[i].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[i].length&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),a.value}getByKey(i){const a=this.data[i];return a?a[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,a){if(!this.has(i))return this;const f=i.wrapped().key,m=void 0===a?0:this.data[f].indexOf(a),w=this.data[f][m];return this.data[f].splice(m,1),w.timeout&&clearTimeout(w.timeout),0===this.data[f].length&&delete this.data[f],this.onRemove(w.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(i){const a=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||a.push(m);for(const f of a)this.remove(f.value.tileID,f)}}class Xf{constructor(i,a,f){this.func=i,this.mask=a,this.range=f}}Xf.ReadOnly=!1,Xf.ReadWrite=!0,Xf.disabled=new Xf(519,Xf.ReadOnly,[0,1]);class i_{constructor(i,a,f,m,w,S){this.test=i,this.ref=a,this.mask=f,this.fail=m,this.depthFail=w,this.pass=S}}i_.disabled=new i_({func:519,mask:0},0,0,7680,7680,7680);class ll{constructor(i,a,f){this.blendFunction=i,this.blendColor=a,this.mask=f}}ll.Replace=[1,0],ll.disabled=new ll(ll.Replace,Ur.transparent,[!1,!1,!1,!1]),ll.unblended=new ll(ll.Replace,Ur.transparent,[!0,!0,!0,!0]),ll.alphaBlended=new ll([1,771],Ur.transparent,[!0,!0,!0,!0]);class Pc{constructor(i,a,f){this.enable=i,this.mode=a,this.frontFace=f}}Pc.disabled=new Pc(!1,1029,2305),Pc.backCCW=new Pc(!0,1029,2305),Pc.backCW=new Pc(!0,1029,2304),Pc.frontCW=new Pc(!0,1028,2304),Pc.frontCCW=new Pc(!0,1028,2305);class Zf extends fa{constructor(i,a,f){super(),this.id=i,this._onlySymbols=f,a.on("data",m=>{"source"===m.dataType&&"metadata"===m.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===m.dataType&&"content"===m.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new $v(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new dS,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(i){this.map=i,this._minTileCacheSize=void 0===this._minTileCacheSize&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const a=this._tiles[i];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,a){return i.isSymbolTile=this._onlySymbols,this._source.loadTile(i,a)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i,()=>{})}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const a in this._tiles){const f=this._tiles[a];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return ct(this._tiles).map(i=>i.tileID).sort(Hv).map(i=>i.key)}getRenderableIds(i){const a=[];for(const f in this._tiles)this._isIdRenderable(+f,i)&&a.push(this._tiles[f]);return i?a.sort((f,m)=>{const w=f.tileID,S=m.tileID,D=new Y(w.canonical.x,w.canonical.y)._rotate(this.transform.angle),P=new Y(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return w.overscaledZ-S.overscaledZ||P.y-D.y||P.x-D.x}).map(f=>f.tileID.key):a.map(f=>f.tileID).sort(Hv).map(f=>f.key)}hasRenderableParent(i){const a=this.findLoadedParent(i,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(i,a){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(a||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)"errored"!==this._tiles[i].state&&this._reloadTile(+i,"reloading")}}_reloadTile(i,a){const f=this._tiles[i];f&&("loading"!==f.state&&(f.state=a),this._loadTile(f,this._tileLoaded.bind(this,f,i,a)))}_tileLoaded(i,a,f,m){if(m)if(i.state="errored",404!==m.status)this._source.fire(new ps(m,{tile:i}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform);else i.timeAdded=ci.now(),"expired"===f&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(a,i),"raster-dem"===this._source.type&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new _i("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const a=this.getRenderableIds();for(let m=0;m<a.length;m++){const w=a[m];if(i.neighboringTiles&&i.neighboringTiles[w]){const S=this.getTileByID(w);f(i,S),f(S,i)}}function f(m,w){if(!m.dem||m.dem.borderReady)return;m.needsHillshadePrepare=!0,m.needsDEMTextureUpload=!0;let S=w.tileID.canonical.x-m.tileID.canonical.x;const D=w.tileID.canonical.y-m.tileID.canonical.y,P=Math.pow(2,m.tileID.canonical.z),L=w.tileID.key;0===S&&0===D||Math.abs(D)>1||(Math.abs(S)>1&&(1===Math.abs(S+P)?S+=P:1===Math.abs(S-P)&&(S-=P)),w.dem&&m.dem&&(m.dem.backfillBorder(w.dem,S,D),m.neighboringTiles&&m.neighboringTiles[L]&&(m.neighboringTiles[L].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,a,f,m){for(const w in this._tiles){let S=this._tiles[w];if(m[w]||!S.hasData()||S.tileID.overscaledZ<=a||S.tileID.overscaledZ>f)continue;let D=S.tileID;for(;S&&S.tileID.overscaledZ>a+1;){const L=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[L.key],S&&S.hasData()&&(D=L)}let P=D;for(;P.overscaledZ>a;)if(P=P.scaledTo(P.overscaledZ-1),i[P.key]){m[D.key]=D;break}}}findLoadedParent(i,a){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=a?f:null}for(let f=i.overscaledZ-1;f>=a;f--){const m=i.scaledTo(f),w=this._getLoadedTile(m);if(w)return w}}_getLoadedTile(i){const a=this._tiles[i.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,a){a=a||this._source.tileSize;const f=Math.ceil(i.width/a)+1,m=Math.ceil(i.height/a)+1,w=Math.floor(f*m*5),S="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,w):w,D="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(D)}handleWrapJump(i){const a=Math.round((i-(void 0===this._prevLng?i:this._prevLng))/360);if(this._prevLng=i,a){const f={};for(const m in this._tiles){const w=this._tiles[m];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+a),f[w.tileID.key]=w}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(+m,this._tiles[m])}}update(i,a,f){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;let m;this.updateCacheSize(i,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new yo(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y)):(m=i.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(m=m.filter(D=>this._source.hasTile(D)))):m=[];const w=this._updateRetainedTiles(m);if(Xv(this._source.type)&&0!==m.length){const D={},P={},L=Object.keys(w);for(const V of L){const j=w[V],H=this._tiles[V];if(!H||H.fadeEndTime&&H.fadeEndTime<=ci.now())continue;const X=this.findLoadedParent(j,Math.max(j.overscaledZ-Zf.maxOverzooming,this._source.minzoom));X&&(this._addTile(X.tileID),D[X.tileID.key]=X.tileID),P[V]=j}const F=m[m.length-1].overscaledZ;for(const V in this._tiles){const j=this._tiles[V];if(w[V]||!j.hasData())continue;let H=j.tileID;for(;H.overscaledZ>F;){H=H.scaledTo(H.overscaledZ-1);const X=this._tiles[H.key];if(X&&X.hasData()&&P[H.key]){w[V]=j.tileID;break}}}for(const V in D)w[V]||(this._coveredTiles[V]=!0,w[V]=D[V])}for(const D in w)this._tiles[D].clearFadeHold();const S=function(D,P){const L=[];for(const F in D)F in P||L.push(F);return L}(this._tiles,w);for(const D of S){const P=this._tiles[D];P.hasSymbolBuckets&&!P.holdingForFade()?P.setHoldDuration(this.map._fadeDuration):P.hasSymbolBuckets&&!P.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const a={};if(0===i.length)return a;const f={},m=i.reduce((L,F)=>Math.min(L,F.overscaledZ),1/0),w=i[0].overscaledZ,S=Math.max(w-Zf.maxOverzooming,this._source.minzoom),D=Math.max(w+Zf.maxUnderzooming,this._source.minzoom),P={};for(const L of i){const F=this._addTile(L);a[L.key]=L,F.hasData()||m<this._source.maxzoom&&(P[L.key]=L)}this._retainLoadedChildren(P,m,D,a);for(const L of i){let F=this._tiles[L.key];if(F.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const j=L.children(this._source.maxzoom)[0],H=this.getTile(j);if(H&&H.hasData()){a[j.key]=j;continue}}else{const j=L.children(this._source.maxzoom);if(a[j[0].key]&&a[j[1].key]&&a[j[2].key]&&a[j[3].key])continue}let V=F.wasRequested();for(let j=L.overscaledZ-1;j>=S;--j){const H=L.scaledTo(j);if(f[H.key]||(f[H.key]=!0,F=this.getTile(H),!F&&V&&(F=this._addTile(H)),F&&(a[H.key]=H,V=F.wasRequested(),F.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const a=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}a.push(m.key);const w=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(w),f)break;m=w}for(const w of a)this._loadedParentTiles[w]=f}}_addTile(i){let a=this._tiles[i.key];if(a)return a;a=this._cache.getAndRemove(i),a&&(this._setTileReloadTimer(i.key,a),a.tileID=i,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,a)));const f=Boolean(a);if(!f){const m=this.map?this.map.painter:null;a=new Dp(i,this._source.tileSize*i.overscaleFactor(),this.transform.tileZoom,m,this._isRaster),this._loadTile(a,this._tileLoaded.bind(this,a,i.key,a.state))}return a?(a.uses++,this._tiles[i.key]=a,f||this._source.fire(new _i("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(i,a){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=a.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const a=this._tiles[i];a&&(a.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,a,f){const m=[],w=this.transform;if(!w)return m;const S="globe"===w.projection.name,D=Tl(w.center.lng);for(const P in this._tiles){const L=this._tiles[P];if(f&&L.clearQueryDebugViz(),L.holdingForFade())continue;let F;if(S){const V=L.tileID.canonical;if(0===V.z){const j=[Math.abs(ue(D,...Ap(V,-1))-D),Math.abs(ue(D,...Ap(V,1))-D)];F=[0,2*j.indexOf(Math.min(...j))-1]}else{const j=[Math.abs(ue(D,...Ap(V,-1))-D),Math.abs(ue(D,...Ap(V,0))-D),Math.abs(ue(D,...Ap(V,1))-D)];F=[j.indexOf(Math.min(...j))-1]}}else F=[0];for(const V of F){const j=i.containsTile(L,w,a,V);j&&m.push(j)}}return m}getVisibleCoordinates(i){const a=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of a)f.projMatrix=this.transform.calculateProjMatrix(f.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Xv(this._source.type))for(const i in this._tiles){const a=this._tiles[i];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=ci.now())return!0}return!1}setFeatureState(i,a,f){this._state.updateState(i=i||"_geojsonTileLayer",a,f)}removeFeatureState(i,a,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",a,f)}getFeatureState(i,a){return this._state.getState(i=i||"_geojsonTileLayer",a)}setDependencies(i,a,f){const m=this._tiles[i];m&&m.setDependencies(a,f)}reloadTilesForDependencies(i,a){for(const f in this._tiles)this._tiles[f].hasDependency(i,a)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(i,a))}_preloadTiles(i,a){const f=new Map,m=Array.isArray(i)?i:[i],w=this.map.painter.terrain,S=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const D of m){const P=D.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const L of P)f.set(L.key,L);this.usedForTerrain&&D.updateElevation(!1)}Pe(Array.from(f.values()),(D,P)=>{const L=new Dp(D,this._source.tileSize*D.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(L,F=>{"raster-dem"===this._source.type&&L.dem&&this._backfillDEM(L),P(F,L)})},a)}}function Hv(s,i){const a=Math.abs(2*s.wrap)-+(s.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return s.overscaledZ-i.overscaledZ||f-a||i.canonical.y-s.canonical.y||i.canonical.x-s.canonical.x}function Xv(s){return"raster"===s||"image"===s||"video"===s||"custom"===s}function Ap(s,i){const a=1<<s.z;return[s.x/a+i,(s.x+1)/a+i]}Zf.maxOverzooming=10,Zf.maxUnderzooming=3;class qg{constructor(i,a,f){this._demTile=i,this._dem=this._demTile.dem,this._scale=a,this._offset=f}static create(i,a,f){const m=f||i.findDEMTileFor(a);if(!m||!m.dem)return;const w=m.dem,S=m.tileID,D=1<<a.canonical.z-S.canonical.z;return new qg(m,m.tileSize/cr/D,[(a.canonical.x/D-S.canonical.x)*w.dim,(a.canonical.y/D-S.canonical.y)*w.dim])}tileCoordToPixel(i,a){const f=a*this._scale+this._offset[1],m=Math.floor(i*this._scale+this._offset[0]),w=Math.floor(f);return new Y(m,w)}getElevationAt(i,a,f,m){const w=i*this._scale+this._offset[0],S=a*this._scale+this._offset[1],D=Math.floor(w),P=Math.floor(S),L=this._dem;return m=!!m,f?ni(ni(L.get(D,P,m),L.get(D,P+1,m),S-P),ni(L.get(D+1,P,m),L.get(D+1,P+1,m),S-P),w-D):L.get(D,P,m)}getElevationAtPixel(i,a,f){return this._dem.get(i,a,!!f)}getMeterToDEM(i){return(1<<this._demTile.tileID.canonical.z)*Ql(1,i)*this._dem.stride}}class Zv{constructor(i,a){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new k(cr,16,0),this.featureIndexArray=new Of,this.promoteId=a}insert(i,a,f,m,w,S=0){const D=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,m,w,S);const P=this.grid;for(let L=0;L<a.length;L++){const F=a[L],V=[1/0,1/0,-1/0,-1/0];for(let j=0;j<F.length;j++){const H=F[j];V[0]=Math.min(V[0],H.x),V[1]=Math.min(V[1],H.y),V[2]=Math.max(V[2],H.x),V[3]=Math.max(V[3],H.y)}V[0]<cr&&V[1]<cr&&V[2]>=0&&V[3]>=0&&P.insert(D,V[0],V[1],V[2],V[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Sc(new rf(this.rawTileData)).layers,this.sourceLayerCoder=new Vv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const i in this.vtLayers)this.vtFeatures[i]=[]}return this.vtLayers}query(i,a,f,m){this.loadVTLayers();const w=i.params||{},S=Vc(w.filter),D=i.tileResult,P=i.transform,L=D.bufferedTilespaceBounds,F=this.grid.query(L.min.x,L.min.y,L.max.x,L.max.y,(X,te,_e,Ue)=>Kx(D.bufferedTilespaceGeometry,X,te,_e,Ue));F.sort(Wv);let V=null;P.elevation&&F.length>0&&(V=qg.create(P.elevation,this.tileID));const j={};let H;for(let X=0;X<F.length;X++){const te=F[X];if(te===H)continue;H=te;const _e=this.featureIndexArray.get(te);let Ue=null;this.loadMatchingFeature(j,_e,S,w.layers,w.availableImages,a,f,m,(Xe,Be,Ze,rt=0)=>(Ue||(Ue=yh(Xe,this.tileID.canonical,i.tileTransform)),Be.queryIntersectsFeature(D,Xe,Ze,Ue,this.z,i.transform,i.pixelPosMatrix,V,rt)))}return j}loadMatchingFeature(i,a,f,m,w,S,D,P,L){const{featureIndex:F,bucketIndex:V,sourceLayerIndex:j,layoutVertexArrayOffset:H}=a,X=this.bucketLayerIDs[V];if(m&&!function(Xe,Be){for(let Ze=0;Ze<Xe.length;Ze++)if(Be.indexOf(Xe[Ze])>=0)return!0;return!1}(m,X))return;const te=this.sourceLayerCoder.decode(j),_e=this.vtLayers[te].feature(F);if(f.needGeometry){const Xe=Yh(_e,!0);if(!f.filter(new Ge(this.tileID.overscaledZ),Xe,this.tileID.canonical))return}else if(!f.filter(new Ge(this.tileID.overscaledZ),_e))return;const Ue=this.getId(_e,te);for(let Xe=0;Xe<X.length;Xe++){const Be=X[Xe];if(m&&m.indexOf(Be)<0)continue;const Ze=S[Be];if(!Ze)continue;let rt={};void 0!==Ue&&P&&(rt=P.getState(Ze.sourceLayer||"_geojsonTileLayer",Ue));const We=Me({},D[Be]);We.paint=s_(We.paint,Ze.paint,_e,rt,w),We.layout=s_(We.layout,Ze.layout,_e,rt,w);const Mt=!L||L(_e,Ze,rt,H);if(!Mt)continue;const It=new Gv(_e,this.z,this.x,this.y,Ue);It.layer=We;let Ht=i[Be];void 0===Ht&&(Ht=i[Be]=[]),Ht.push({featureIndex:F,feature:It,intersectionZ:Mt})}}lookupSymbolFeatures(i,a,f,m,w,S,D,P){const L={};this.loadVTLayers();const F=Vc(w);for(const V of i)this.loadMatchingFeature(L,{bucketIndex:f,sourceLayerIndex:m,featureIndex:V,layoutVertexArrayOffset:0},F,S,D,P,a);return L}loadFeature(i){const{featureIndex:a,sourceLayerIndex:f}=i;this.loadVTLayers();const m=this.sourceLayerCoder.decode(f),w=this.vtFeatures[m];if(w[a])return w[a];const S=this.vtLayers[m].feature(a);return w[a]=S,S}hasLayer(i){for(const a of this.bucketLayerIDs)for(const f of a)if(i===f)return!0;return!1}getId(i,a){let f=i.id;if(this.promoteId){const m="string"==typeof this.promoteId?this.promoteId:this.promoteId[a];null!=m&&(f=i.properties[m]),"boolean"==typeof f&&(f=Number(f))}return f}}function s_(s,i,a,f,m){return Mn(s,(w,S)=>{const D=i instanceof Jt?i.get(S):null;return D&&D.evaluate?D.evaluate(a,f,m):D})}function Wv(s,i){return i-s}re(Zv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Yv{constructor(i,a){this.width=i,this.height=a,this.nextRow=0,this.image=new Hu({width:i,height:a}),this.positions={},this.uploaded=!1}getDash(i,a){const f=this.getKey(i,a);return this.positions[f]}trim(){const i=this.width,a=this.height=Vt(this.nextRow);this.image.resize({width:i,height:a})}getKey(i,a){return i.join(",")+a}getDashRanges(i,a,f){const m=[];let w=i.length%2==1?-i[i.length-1]*f:0,S=i[0]*f,D=!0;m.push({left:w,right:S,isDash:D,zeroLength:0===i[0]});let P=i[0];for(let L=1;L<i.length;L++){D=!D;const F=i[L];w=P*f,P+=F,S=P*f,m.push({left:w,right:S,isDash:D,zeroLength:0===F})}return m}addRoundDash(i,a,f){const m=a/2;for(let w=-f;w<=f;w++){const S=this.width*(this.nextRow+f+w);let D=0,P=i[D];for(let L=0;L<this.width;L++){L/P.right>1&&(P=i[++D]);const F=Math.abs(L-P.left),V=Math.abs(L-P.right),j=Math.min(F,V);let H;const X=w/f*(m+1);if(P.isDash){const te=m-Math.abs(X);H=Math.sqrt(j*j+te*te)}else H=m-Math.sqrt(j*j+X*X);this.image.data[S+L]=Math.max(0,Math.min(255,H+128))}}}addRegularDash(i,a){for(let P=i.length-1;P>=0;--P){const L=i[P],F=i[P+1];L.zeroLength?i.splice(P,1):F&&F.isDash===L.isDash&&(F.left=L.left,i.splice(P,1))}const f=i[0],m=i[i.length-1];f.isDash===m.isDash&&(f.left=m.left-this.width,m.right=f.right+this.width);const w=this.width*this.nextRow;let S=0,D=i[S];for(let P=0;P<this.width;P++){P/D.right>1&&(D=i[++S]);const L=Math.abs(P-D.left),F=Math.abs(P-D.right),V=Math.min(L,F);this.image.data[w+P]=Math.max(0,Math.min(255,(D.isDash?V:-V)+a+128))}}addDash(i,a){const f=this.getKey(i,a);if(this.positions[f])return this.positions[f];const m="round"===a,w=m?7:0,S=2*w+1;if(this.nextRow+S>this.height)return Sn("LineAtlas out of space"),null;0===i.length&&i.push(1);let D=0;for(let F=0;F<i.length;F++)i[F]<0&&(Sn("Negative value is found in line dasharray, replacing values with 0"),i[F]=0),D+=i[F];if(0!==D){const F=this.width/D,V=this.getDashRanges(i,this.width,F);m?this.addRoundDash(V,F,w):this.addRegularDash(V,"square"===a?.5*F:0)}const P=this.nextRow+w;this.nextRow+=S;const L={tl:[P,w],br:[D,0]};return this.positions[f]=L,L}}re(Yv,"LineAtlas");class Hg{constructor(i){const a={},f=[];for(const D in i){const P=i[D],L=a[D]={};for(const F in P.glyphs){const V=P.glyphs[+F];if(!V||0===V.bitmap.width||0===V.bitmap.height)continue;const j=V.metrics.localGlyph?2:1,H={x:0,y:0,w:V.bitmap.width+2*j,h:V.bitmap.height+2*j};f.push(H),L[F]=H}}const{w:m,h:w}=Py(f),S=new Hu({width:m||1,height:w||1});for(const D in i){const P=i[D];for(const L in P.glyphs){const F=P.glyphs[+L];if(!F||0===F.bitmap.width||0===F.bitmap.height)continue;const V=a[D][L],j=F.metrics.localGlyph?2:1;Hu.copy(F.bitmap,S,{x:0,y:0},{x:V.x+j,y:V.y+j},F.bitmap)}}this.image=S,this.positions=a}}re(Hg,"GlyphAtlas");class Xw{constructor(i){this.tileID=new yo(i.tileID.overscaledZ,i.tileID.wrap,i.tileID.canonical.z,i.tileID.canonical.x,i.tileID.canonical.y),this.tileZoom=i.tileZoom,this.uid=i.uid,this.zoom=i.zoom,this.canonical=i.tileID.canonical,this.pixelRatio=i.pixelRatio,this.tileSize=i.tileSize,this.source=i.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=i.showCollisionBoxes,this.collectResourceTiming=!!i.collectResourceTiming,this.returnDependencies=!!i.returnDependencies,this.promoteId=i.promoteId,this.enableTerrain=!!i.enableTerrain,this.isSymbolTile=i.isSymbolTile,this.tileTransform=uf(i.tileID.canonical,i.projection),this.projection=i.projection}parse(i,a,f,m,w){this.status="parsing",this.data=i,this.collisionBoxArray=new Om;const S=new Vv(Object.keys(i.layers).sort()),D=new Zv(this.tileID,this.promoteId);D.bucketLayerIDs=[];const P={},L=new Yv(256,256),F={featureIndex:D,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:L,availableImages:f},V=a.familiesBySource[this.source];for(const rt in V){const We=i.layers[rt];if(!We)continue;let Mt=!1,It=!1;for(const kt of V[rt])"symbol"===kt[0].type?Mt=!0:It=!0;if(!0===this.isSymbolTile&&!Mt||!1===this.isSymbolTile&&!It)continue;1===We.version&&Sn(`Vector tile source "${this.source}" layer "${rt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ht=S.encode(rt),ln=[];for(let kt=0;kt<We.length;kt++){const Wt=We.feature(kt),Kt=D.getId(Wt,rt);ln.push({feature:Wt,id:Kt,index:kt,sourceLayerIndex:Ht})}for(const kt of V[rt]){const Wt=kt[0];void 0!==this.isSymbolTile&&"symbol"===Wt.type!==this.isSymbolTile||Wt.minzoom&&this.zoom<Math.floor(Wt.minzoom)||Wt.maxzoom&&this.zoom>=Wt.maxzoom||"none"!==Wt.visibility&&(a_(kt,this.zoom,f),(P[Wt.id]=Wt.createBucket({index:D.bucketLayerIDs.length,layers:kt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ht,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:f})).populate(ln,F,this.tileID.canonical,this.tileTransform),D.bucketLayerIDs.push(kt.map(Kt=>Kt.id)))}}let j,H,X,te;L.trim();const _e={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Ue=Mn(F.glyphDependencies,rt=>Object.keys(rt).map(Number));Object.keys(Ue).length?m.send("getGlyphs",{uid:this.uid,stacks:Ue},(rt,We)=>{j||(j=rt,H=We,Ze.call(this))},void 0,!1,_e):H={};const Xe=Object.keys(F.iconDependencies);Xe.length?m.send("getImages",{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"},(rt,We)=>{j||(j=rt,X=We,Ze.call(this))},void 0,!1,_e):X={};const Be=Object.keys(F.patternDependencies);function Ze(){if(j)return w(j);if(H&&X&&te){const rt=new Hg(H),We=new wp(X,te);for(const Mt in P){const It=P[Mt];It instanceof hf?(a_(It.layers,this.zoom,f),Pw(It,H,rt.positions,X,We.iconPositions,this.showCollisionBoxes,f,this.tileID.canonical,this.tileZoom,this.projection)):It.hasPattern&&(It instanceof tf||It instanceof yg||It instanceof Uf)&&(a_(It.layers,this.zoom,f),It.addFeatures(F,this.tileID.canonical,We.patternPositions,f,this.tileTransform))}this.status="done",w(null,{buckets:ct(P).filter(Mt=>!Mt.isEmpty()),featureIndex:D,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rt.image,lineAtlas:L,imageAtlas:We,glyphMap:this.returnDependencies?H:null,iconMap:this.returnDependencies?X:null,glyphPositions:this.returnDependencies?rt.positions:null})}}Be.length?m.send("getImages",{icons:Be,source:this.source,tileID:this.tileID,type:"patterns"},(rt,We)=>{j||(j=rt,te=We,Ze.call(this))},void 0,!1,_e):te={},Ze.call(this)}}function a_(s,i,a){const f=new Ge(i);for(const m of s)m.recalculate(f,a)}class Kv{constructor(i){this.entries={},this.scheduler=i}request(i,a,f,m){const w=this.entries[i]=this.entries[i]||{callbacks:[]};if(w.result){const[S,D]=w.result;return this.scheduler?this.scheduler.add(()=>{m(S,D)},a):m(S,D),()=>{}}return w.callbacks.push(m),w.cancel||(w.cancel=f((S,D)=>{w.result=[S,D];for(const P of w.callbacks)this.scheduler?this.scheduler.add(()=>{P(S,D)},a):P(S,D);setTimeout(()=>delete this.entries[i],3e3)})),()=>{w.result||(w.callbacks=w.callbacks.filter(S=>S!==m),w.callbacks.length||(w.cancel(),delete this.entries[i]))}}}function Jv(s,i,a){const f=JSON.stringify(s.request);return s.data&&(this.deduped.entries[f]={result:[null,s.data]}),this.deduped.request(f,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},m=>{const w=qr(s.request,(S,D,P,L)=>{S?m(S):D&&m(null,{vectorTile:a?void 0:new Sc(new rf(D)),rawData:D,cacheControl:P,expires:L})});return()=>{w.cancel(),m()}},i)}p.ARRAY_TYPE=sl,p.AUTH_ERR_MSG=ds,p.Aabb=Pu,p.Actor=class{constructor(s,i,a){this.target=s,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},fn(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ti()?s:ve,this.scheduler=new qw}send(s,i,a,f,m=!1,w){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=w,this.callbacks[S]=a);const D=hr(this.globalScope)?void 0:[];return this.target.postMessage({id:S,type:s,hasCallback:!!a,targetMapId:f,mustQueue:m,sourceMapId:this.mapId,data:$t(i,D)},D),{cancel:()=>{a&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:f,sourceMapId:this.mapId})}}}receive(s){const i=s.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if("<cancel>"===i.type){const f=this.cancelCallbacks[a];delete this.cancelCallbacks[a],f&&f.cancel()}else if(i.mustQueue||ti()){const f=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,i),f&&f.metadata||{type:"message"})}else this.processTask(a,i)}processTask(s,i){if("<response>"===i.type){const a=this.callbacks[s];delete this.callbacks[s],a&&(i.error?a(gt(i.error)):a(null,gt(i.data)))}else{const a=hr(this.globalScope)?void 0:[],f=i.hasCallback?(w,S)=>{delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:w?$t(w):null,data:$t(S,a)},a)}:w=>{},m=gt(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,m,f);else if(this.parent.getWorkerSource){const w=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,w[0],m.source)[w[1]](m,f)}else f(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},p.CanonicalTileID=Sd,p.Color=Ur,p.ColorMode=ll,p.CullFaceMode=Pc,p.DEMData=$g,p.DataConstantProperty=Dt,p.DedupedRequest=Kv,p.DepthMode=Xf,p.EXTENT=cr,p.Elevation=class{isDataAvailableAtPoint(s){const i=this._source();if(this.isUsingMockSource()||!i||s.y<0||s.y>1)return!1;const a=i.getSource().maxzoom,f=1<<a,m=Math.floor(s.x),w=Math.floor((s.x-m)*f),S=Math.floor(s.y*f),D=this.findDEMTileFor(new yo(a,m,a,w,S));return!(!D||!D.dem)}getAtPointOrZero(s,i=0){return this.getAtPoint(s,i)||0}getAtPoint(s,i,a=!0){if(this.isUsingMockSource())return null;null==i&&(i=null);const f=this._source();if(!f||s.y<0||s.y>1)return i;const m=f.getSource().maxzoom,w=1<<m,S=Math.floor(s.x),D=s.x-S,P=new yo(m,S,m,Math.floor(D*w),Math.floor(s.y*w)),L=this.findDEMTileFor(P);if(!L||!L.dem)return i;const F=L.dem,V=1<<L.tileID.canonical.z,j=(D*V-L.tileID.canonical.x)*F.dim,H=(s.y*V-L.tileID.canonical.y)*F.dim,X=Math.floor(j),te=Math.floor(H);return(a?this.exaggeration():1)*ni(ni(F.get(X,te),F.get(X,te+1),H-te),ni(F.get(X+1,te),F.get(X+1,te+1),H-te),j-X)}getAtTileOffset(s,i,a){const f=1<<s.canonical.z;return this.getAtPointOrZero(new kf(s.wrap+(s.canonical.x+i/cr)/f,(s.canonical.y+a/cr)/f))}getAtTileOffsetFunc(s,i,a,f){return m=>{const w=this.getAtTileOffset(s,m.x,m.y),S=f.upVector(s.canonical,m.x,m.y);return Ml(S,S,w*f.upVectorScale(s.canonical,i,a).metersToTile),S}}getForTilePoints(s,i,a,f){if(this.isUsingMockSource())return!1;const m=qg.create(this,s,f);return!!m&&(i.forEach(w=>{w[2]=this.exaggeration()*m.getElevationAt(w[0],w[1],a)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const i=this.findDEMTileFor(s);if(!i||!i.dem)return null;const a=i.dem.tree,f=i.tileID,m=1<<s.canonical.z-f.canonical.z;let w=s.canonical.x/m-f.canonical.x,S=s.canonical.y/m-f.canonical.y,D=0;for(let P=0;P<s.canonical.z-f.canonical.z&&!a.leaves[D];P++){w*=2,S*=2;const L=2*Math.floor(S)+Math.floor(w);D=a.childOffsets[D]+L,w%=1,S%=1}return{min:this.exaggeration()*a.minimums[D],max:this.exaggeration()*a.maximums[D]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,i,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},p.ErrorEvent=ps,p.EvaluationParameters=Ge,p.Event=_i,p.Evented=fa,p.FillExtrusionBucket=Uf,p.Frustum=iy,p.FrustumCorners=ry,p.GLOBE_METERS_TO_ECEF=Mv,p.GLOBE_RADIUS=Ch,p.GLOBE_SCALE_MATCH_LATITUDE=45,p.GLOBE_ZOOM_THRESHOLD_MAX=6,p.GLOBE_ZOOM_THRESHOLD_MIN=5,p.GlobeSharedBuffers=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const s of this._wireframeSegments)s.destroy()}}_createGrid(s){const i=new Fr,a=new Qa,f=65;for(let m=0;m<f;m++)for(let w=0;w<f;w++)i.emplaceBack(w,m);this._gridSegments=[];for(let m=0,w=0;m<Ep.length;m++){const S=Ep[m];for(let P=0;P<S;P++)for(let L=0;L<64;L++){const F=P*f+L;a.emplaceBack(F+1,F,F+f),a.emplaceBack(F+f,F+f+1,F+1)}const D=64*S*2;this._gridSegments.push(Vs.simpleSegment(0,w,(S+1)*f,D)),w+=D}this._gridBuffer=s.createVertexBuffer(i,jf.members),this._gridIndexBuffer=s.createIndexBuffer(a,!0)}_createPoles(s){const i=new Qa;for(let m=0;m<=64;m++)i.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(i,!0);const a=new eu,f=new eu;this._poleSegments=[];for(let m=0,w=0;m<5;m++){const S=360/(1<<m);a.emplaceBack(0,-Ch,0,.5,0),f.emplaceBack(0,-Ch,0,.5,1);for(let D=0;D<=64;D++){const P=D/64,L=ni(0,S,P),[F,V,j]=Nd(zr,Lv,L,Ch);a.emplaceBack(F,V,j,P,0),f.emplaceBack(F,V,j,P,1)}this._poleSegments.push(Vs.simpleSegment(w,0,66,64)),w+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Dv,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(f,Dv,!1)}getGridBuffers(s){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[s]]}getPoleBuffers(s){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}getWirefameBuffers(s,i){if(!this._wireframeSegments){const a=new il,f=64,m=f+1;this._wireframeSegments=[];for(let w=0,S=0;w<Ep.length;w++){const D=Ep[w];for(let L=0;L<D;L++)for(let F=0;F<f;F++){const V=L*m+F;a.emplaceBack(V,V+1),a.emplaceBack(V,V+m),a.emplaceBack(V,V+m+1)}const P=D*f*3;this._wireframeSegments.push(Vs.simpleSegment(0,S,(D+1)*m,P)),S+=P}this._wireframeIndexBuffer=s.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[i]]}},p.GlyphManager=Ld,p.ImagePosition=Ry,p.LivePerformanceUtils=Xt,p.LngLat=Ai,p.LngLatBounds=mh,p.LocalGlyphMode=Pl,p.MAX_MERCATOR_LATITUDE=Hc,p.MercatorCoordinate=kf,p.ONE_EM=24,p.OverscaledTileID=yo,p.PerformanceMarkers=st,p.Properties=wn,p.RGBAImage=Xu,p.Ray=ny,p.RequestManager=class{constructor(s,i,a){this._transformRequestFn=s,this._customAccessToken=i,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const s=function(){let i="";for(let a=0;a<10;a++)i+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",he,i].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=s.token,this._skuTokenExpiresAt=s.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(s,i){return this._transformRequestFn&&this._transformRequestFn(s,i)||{url:s}}normalizeStyleURL(s,i){if(!oi(s))return s;const a=No(s);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeGlyphsURL(s,i){if(!oi(s))return s;const a=No(s);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||i)}normalizeSourceURL(s,i,a,f){if(!oi(s))return s;const m=No(s);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),a&&m.params.push(`language=${a}`),f&&m.params.push(`worldview=${f}`),this._makeAPIURL(m,this._customAccessToken||i)}normalizeSpriteURL(s,i,a,f){const m=No(s);return oi(s)?(m.path=`/styles/v1${m.path}/sprite${i}${a}`,this._makeAPIURL(m,this._customAccessToken||f)):(m.path+=`${i}${a}`,_r(m))}normalizeTileURL(s,i,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),s&&!oi(s))return s;const f=No(s);f.path=f.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${i||a&&"raster"!==f.authority&&512===a?"@2x":""}${Ct.supported?".webp":"$1"}`),"raster"===f.authority?f.path=`/${ft.RASTER_URL_PREFIX}${f.path}`:(f.path=f.path.replace(/^.+\/v4\//,"/"),f.path=`/${ft.TILE_URL_VERSION}${f.path}`);const m=this._customAccessToken||function(w){for(const S of w){const D=S.match(/^access_token=(.*)$/);if(D)return D[1]}return null}(f.params)||ft.ACCESS_TOKEN;return ft.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&f.params.push(`sku=${this._skuToken}`),this._makeAPIURL(f,m)}canonicalizeTileURL(s,i){const a=No(s);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return s;let f="mapbox://";a.path.match(/^\/raster\/v1\//)?f+=`raster/${a.path.replace(`/${ft.RASTER_URL_PREFIX}/`,"")}`:f+=`tiles/${a.path.replace(`/${ft.TILE_URL_VERSION}/`,"")}`;let m=a.params;return i&&(m=m.filter(w=>!w.match(/^access_token=/))),m.length&&(f+=`?${m.join("&")}`),f}canonicalizeTileset(s,i){const a=!!i&&oi(i),f=[];for(const m of s.tiles||[])As(m)?f.push(this.canonicalizeTileURL(m,a)):f.push(m);return f}_makeAPIURL(s,i){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=No(ft.API_URL);if(s.protocol=f.protocol,s.authority=f.authority,"http"===s.protocol){const m=s.params.indexOf("secure");m>=0&&s.params.splice(m,1)}if("/"!==f.path&&(s.path=`${f.path}${s.path}`),!ft.REQUIRE_ACCESS_TOKEN)return _r(s);if(i=i||ft.ACCESS_TOKEN,!this._silenceAuthErrors){if(!i)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===i[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return s.params=s.params.filter(m=>-1===m.indexOf("access_token")),s.params.push(`access_token=${i||""}`),_r(s)}},p.ResourceType=lr,p.SegmentVector=Vs,p.SourceCache=Zf,p.StencilMode=i_,p.StructArrayLayout1ui2=hd,p.StructArrayLayout2f1f2i16=Mu,p.StructArrayLayout2i4=Fr,p.StructArrayLayout2ui4=il,p.StructArrayLayout3f12=rl,p.StructArrayLayout3ui6=Qa,p.StructArrayLayout4i8=Ro,p.StructArrayLayout5f20=eu,p.Texture=ul,p.Tile=Dp,p.Transitionable=zt,p.Uniform1f=Yp,p.Uniform1i=class extends Cl{constructor(s){super(s),this.current=0}set(s,i,a){this.fetchUniformLocation(s,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},p.Uniform2f=class extends Cl{constructor(s){super(s),this.current=[0,0]}set(s,i,a){this.fetchUniformLocation(s,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}},p.Uniform3f=class extends Cl{constructor(s){super(s),this.current=[0,0,0]}set(s,i,a){this.fetchUniformLocation(s,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}},p.Uniform4f=Sl,p.UniformColor=Xh,p.UniformMatrix2f=class extends Cl{constructor(s){super(s),this.current=ip}set(s,i,a){if(this.fetchUniformLocation(s,i))for(let f=0;f<4;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}},p.UniformMatrix3f=class extends Cl{constructor(s){super(s),this.current=Kp}set(s,i,a){if(this.fetchUniformLocation(s,i))for(let f=0;f<9;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}},p.UniformMatrix4f=class extends Cl{constructor(s){super(s),this.current=w0}set(s,i,a){if(this.fetchUniformLocation(s,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let f=1;f<16;f++)if(a[f]!==this.current[f]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}},p.UnwrappedTileID=nv,p.ValidationError=Tn,p.VectorTileFeature=ef,p.VectorTileWorkerSource=class extends fa{constructor(s,i,a,f,m){super(),this.actor=s,this.layerIndex=i,this.availableImages=a,this.loadVectorData=m||Jv,this.loading={},this.loaded={},this.deduped=new Kv(s.scheduler),this.isSpriteLoaded=f,this.scheduler=s.scheduler}loadTile(s,i){const a=s.uid,f=s&&s.request,m=f&&f.collectResourceTiming,w=this.loading[a]=new Xw(s);w.abort=this.loadVectorData(s,(S,D)=>{const P=!this.loading[a];if(delete this.loading[a],P||S||!D)return w.status="done",P||(this.loaded[a]=w),i(S);const L=D.rawData,F={};D.expires&&(F.expires=D.expires),D.cacheControl&&(F.cacheControl=D.cacheControl),w.vectorTile=D.vectorTile||new Sc(new rf(L));const V=()=>{w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,(j,H)=>{if(j||!H)return i(j);const X={};if(m){const te=zn(f);te.length>0&&(X.resourceTiming=JSON.parse(JSON.stringify(te)))}i(null,Me({rawTileData:L.slice(0)},H,F,X))})};this.isSpriteLoaded?V():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(V,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom}):V()}),this.loaded=this.loaded||{},this.loaded[a]=w})}reloadTile(s,i){const a=this.loaded,f=s.uid,m=this;if(a&&a[f]){const w=a[f];w.showCollisionBoxes=s.showCollisionBoxes,w.enableTerrain=!!s.enableTerrain,w.projection=s.projection,w.tileTransform=uf(s.tileID.canonical,s.projection);const S=(D,P)=>{const L=w.reloadCallback;L&&(delete w.reloadCallback,w.parse(w.vectorTile,m.layerIndex,this.availableImages,m.actor,L)),i(D,P)};"parsing"===w.status?w.reloadCallback=S:"done"===w.status&&(w.vectorTile?w.parse(w.vectorTile,this.layerIndex,this.availableImages,this.actor,S):S())}}abortTile(s,i){const a=s.uid,f=this.loading[a];f&&(f.abort&&f.abort(),delete this.loading[a]),i()}removeTile(s,i){const a=this.loaded,f=s.uid;a&&a[f]&&delete a[f],i()}},p.WritingMode=Al,p.ZoomHistory=nn,p.add=Xc,p.addDynamicAttributes=Xy,p.adjoint=function(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=i[4],D=i[5],P=i[6],L=i[7],F=i[8];return s[0]=S*F-D*L,s[1]=m*L-f*F,s[2]=f*D-m*S,s[3]=D*P-w*F,s[4]=a*F-m*P,s[5]=m*w-a*D,s[6]=w*L-S*P,s[7]=f*P-a*L,s[8]=a*S-f*w,s},p.asyncAll=Pe,p.bezier=Ve,p.bindAll=fn,p.boundsAttributes=Tp,p.bufferConvexPolygon=function(s,i){const a=[];for(let f=0;f<s.length;f++){const m=At(f-1,-1,s.length-1),w=At(f+1,-1,s.length-1),S=s[f],D=s[w],P=s[m].sub(S).unit(),L=D.sub(S).unit(),F=L.angleWithSep(P.x,P.y),V=P.add(L).unit().mult(-1*i/Math.sin(F/2));a.push(S.add(V))}return a},p.cacheEntryPossiblyAdded=function(s){ur++,ur>Bt&&(s.getActor().send("enforceCacheSizeLimit",ht),ur=0)},p.calculateGlobeLabelMatrix=function(s,i){const{x:a,y:f}=s.point,m=Ow(a,f,s.worldSize/s._pixelsPerMercatorPixel,0,0);return _d(m,m,Sp(Mc(i)))},p.calculateGlobeMatrix=function(s){const{x:i,y:a}=s.point,{lng:f,lat:m}=s._center;return Ow(i,a,s.worldSize,f,m)},p.calculateGlobeMercatorMatrix=function(s){const i=s.pixelsPerMeter,a=i/Ql(1,s.center.lat),f=ec(new Float64Array(16));return ap(f,f,[s.point.x,s.point.y,0]),Kh(f,f,[a,a,i]),Float32Array.from(f)},p.circumferenceAtLatitude=Nf,p.clamp=ue,p.clearTileCache=function(s){if(!on())return;const i=ve.caches.delete(fe);s&&i.catch(s).then(()=>s())},p.clipLine=_v,p.clone=function(s){var i=new sl(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},p.clone$1=Bn,p.collisionCircleLayout=Cy,p.config=ft,p.conjugate=function(s,i){return s[0]=-i[0],s[1]=-i[1],s[2]=-i[2],s[3]=i[3],s},p.create=function(){var s=new sl(16);return sl!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.create$1=A0,p.createExpression=bs,p.createLayout=bn,p.createStyleLayer=function(s){return"custom"===s.type?new jw(s):new $w[s.type](s)},p.cross=cp,p.degToRad=se,p.distance=function(s,i){return Math.hypot(i[0]-s[0],i[1]-s[1],i[2]-s[2])},p.div=function(s,i,a){return s[0]=i[0]/a[0],s[1]=i[1]/a[1],s[2]=i[2]/a[2],s},p.dot=tc,p.earthRadius=Wh,p.ease=qe,p.easeCubicInOut=pt,p.ecefToLatLng=function([s,i,a]){const f=Math.hypot(s,i,a),m=Math.atan2(s,a),w=.5*Math.PI-Math.acos(-i/f);return new Ai(we(m),we(w))},p.emitValidationErrors=T,p.endsWith=Lt,p.enforceCacheSizeLimit=function(s){sn(),ae&&ae.then(i=>{i.keys().then(a=>{for(let f=0;f<a.length-s;f++)i.delete(a[f])})})},p.evaluateSizeForFeature=vp,p.evaluateSizeForZoom=ic,p.evaluateVariableOffset=Cv,p.evented=Ne,p.exactEquals=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]},p.exactEquals$1=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]},p.exported=ci,p.exported$1=Ct,p.extend=Me,p.extend$1=Na,p.fillExtrusionHeightLift=J0,p.filterObject=Rn,p.fromMat4=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[4],s[4]=i[5],s[5]=i[6],s[6]=i[8],s[7]=i[9],s[8]=i[10],s},p.fromQuat=function(s,i){var a=i[0],f=i[1],m=i[2],w=i[3],S=a+a,D=f+f,P=m+m,L=a*S,F=f*S,V=f*D,j=m*S,H=m*D,X=m*P,te=w*S,_e=w*D,Ue=w*P;return s[0]=1-V-X,s[1]=F+Ue,s[2]=j-_e,s[3]=0,s[4]=F-Ue,s[5]=1-L-X,s[6]=H+te,s[7]=0,s[8]=j+_e,s[9]=H-te,s[10]=1-L-V,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.fromRotation=function(s,i){var a=Math.sin(i),f=Math.cos(i);return s[0]=f,s[1]=a,s[2]=0,s[3]=-a,s[4]=f,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},p.fromScaling=qu,p.furthestTileCorner=function(s){const i=Math.round((s+45+360)%360/90)%4;return J[i]},p.getAABBPointSquareDist=function(s,i,a){let f=0;for(let m=0;m<2;++m){const w=a?a[m]:0;s[m]>w&&(f+=(s[m]-w)*(s[m]-w)),i[m]<w&&(f+=(w-i[m])*(w-i[m]))}return f},p.getAnchorAlignment=Ny,p.getAnchorJustification=Pg,p.getBounds=function(s){let i=1/0,a=1/0,f=-1/0,m=-1/0;for(const w of s)i=Math.min(i,w.x),a=Math.min(a,w.y),f=Math.max(f,w.x),m=Math.max(m,w.y);return{min:new Y(i,a),max:new Y(f,m)}},p.getColumn=ye,p.getGridMatrix=function(s,i,a,f){const m=i.getNorth(),w=i.getSouth(),S=i.getWest(),D=i.getEast(),P=1<<s.z,L=D-S,F=m-w,V=L/64,j=-F/Ep[a],H=[0,V,0,j,0,0,m,S,0];if(s.z>0){const X=180/f;Zm(H,H,[X/L+1,0,0,0,X/F+1,0,-.5*X/V,.5*X/j,1])}return H[2]=P,H[5]=s.x,H[8]=s.y,H},p.getImage=wo,p.getJSON=function(s,i){return Ei(Me(s,{type:"json"}),i)},p.getLatitudinalLod=function(s){const i=80.051129;s=ue(s,-80.051129,i)/i*90;const a=Math.pow(Math.abs(Math.sin(se(s))),3);return Math.round(a*(Ep.length-1))},p.getMapSessionAPI=yt,p.getPerformanceMeasurement=zn,p.getProjection=Bv,p.getRTLTextPluginStatus=Se,p.getReferrer=Cr,p.getTilePoint=function(s,{x:i,y:a},f=0){return new Y(((i-f)*s.scale-s.x)*cr,(a*s.scale-s.y)*cr)},p.getTileVec3=function(s,i,a=0){return zf(((i.x-a)*s.scale-s.x)*cr,(i.y*s.scale-s.y)*cr,gd(i.z,i.y))},p.getVideo=function(s,i){const a=ve.document.createElement("video");a.muted=!0,a.onloadstart=function(){i(null,a)};for(let f=0;f<s.length;f++){const m=ve.document.createElement("source");ui(s[f])||(a.crossOrigin="Anonymous"),m.src=s[f],a.appendChild(m)}return{cancel:()=>{}}},p.globeCenterToScreenPoint=function(s){const i=[0,0,0],a=ec(new Float64Array(16));return _d(a,s.pixelMatrix,s.globeMatrix),js(i,i,a),new Y(i[0],i[1])},p.globeDenormalizeECEF=Sp,p.globeECEFOrigin=function(s,i){const a=[0,0,0];return js(a,a,Fd(Mc(i.canonical))),js(a,a,s),a},p.globeNormalizeECEF=Fd,p.globePixelsToTileUnits=function(s,i){return cr/(512*Math.pow(2,s))*Ng(Mc(i))},p.globePoleMatrixForTile=function(s,i,a){const f=ec(new Float64Array(16)),m=(i/(1<<s)-.5)*Math.PI*2;return rg(f,a.globeMatrix,m),Float32Array.from(f)},p.globeTileBounds=Mc,p.globeTiltAtLngLat=Rv,p.globeToMercatorTransition=af,p.globeUseCustomAntiAliasing=function(s,i,a){const f=af(a.zoom),m=s.style.map._antialias,w=!!i.extStandardDerivatives,S=i.extStandardDerivativesForceOff||s.terrain&&s.terrain.exaggeration()>0;return 0===f&&!m&&!S&&w},p.identity=ec,p.identity$1=ty,p.invert=Wm,p.isFullscreen=function(){return!!ve.document.fullscreenElement||!!ve.document.webkitFullscreenElement},p.isLngLatBehindGlobe=function(s,i){return Rv(s,i)>Math.PI/2*1.01},p.isMapAuthenticated=function(s){return at.has(s)},p.isMapboxURL=oi,p.isSafariWithAntialiasingBug=function(s){const i=s.navigator?s.navigator.userAgent:null;return!!hr(s)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},p.latFromMercatorY=ea,p.latLngToECEF=Cp,p.len=Qm,p.length=_h,p.length$1=function(s){return Math.hypot(s[0],s[1],s[2],s[3])},p.lngFromMercatorX=Dl,p.loadVectorTile=Jv,p.makeRequest=Ei,p.mapValue=function(s,i,a,f,m){return ue((s-i)/(a-i)*(m-f)+f,f,m)},p.mercatorScale=qx,p.mercatorXfromLng=Tl,p.mercatorYfromLat=bc,p.mercatorZfromAltitude=Ql,p.mul=P0,p.mul$1=Qx,p.multiply=_d,p.multiply$1=Zm,p.multiply$2=Jm,p.nextPowerOfTwo=Vt,p.normalize=Au,p.normalize$1=ew,p.normalize$2=ey,p.number=ni,p.ortho=function(s,i,a,f,m,w,S){var D=1/(i-a),P=1/(f-m),L=1/(w-S);return s[0]=-2*D,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*P,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+a)*D,s[13]=(m+f)*P,s[14]=(S+w)*L,s[15]=1,s},p.pbf=rf,p.perspective=function(s,i,a,f,m){var w,S=1/Math.tan(i/2);return s[0]=S/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=S,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,null!=m&&m!==1/0?(s[10]=(m+f)*(w=1/(f-m)),s[14]=2*m*f*w):(s[10]=-1,s[14]=-2*f),s},p.pick=function(s,i){const a={};for(let f=0;f<i.length;f++){const m=i[f];m in s&&(a[m]=s[m])}return a},p.plugin=Qe,p.pointGeometry=Y,p.polygonContainsPoint=md,p.polygonIntersectsBox=Kx,p.polygonIntersectsPolygon=I0,p.polygonizeBounds=function(s,i,a=0,f=!0){const m=new Y(a,a),w=s.sub(m),S=i.add(m),D=[w,new Y(S.x,w.y),S,new Y(w.x,S.y)];return f&&D.push(w.clone()),D},p.posAttributes=jf,p.postMapLoadEvent=Oe,p.postPerformanceEvent=nt,p.postTurnstileEvent=W,p.potpack=Py,p.prevPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log(s)/Math.LN2))},p.radToDeg=we,p.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],p.registerForPluginStateChange=function(s){return s({pluginStatus:be,pluginURL:Re}),Ne.on("pluginStateChange",s),s},p.removeAuthState=function(s){at.delete(s)},p.renderColorRamp=ay,p.resample=Hx,p.rotateX=Ym,p.rotateX$1=L0,p.rotateY=rg,p.rotateY$1=ag,p.rotateZ=function(s,i,a){var f=Math.sin(a),m=Math.cos(a),w=i[0],S=i[1],D=i[2],P=i[3],L=i[4],F=i[5],V=i[6],j=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=w*m+L*f,s[1]=S*m+F*f,s[2]=D*m+V*f,s[3]=P*m+j*f,s[4]=L*m-w*f,s[5]=F*m-S*f,s[6]=V*m-D*f,s[7]=j*m-P*f,s},p.rotateZ$1=function(s,i,a){a*=.5;var f=i[0],m=i[1],w=i[2],S=i[3],D=Math.sin(a),P=Math.cos(a);return s[0]=f*P+m*D,s[1]=m*P-f*D,s[2]=w*P+S*D,s[3]=S*P-w*D,s},p.scale=Kh,p.scale$1=og,p.scale$2=Ml,p.scaleAndAdd=xd,p.set=function(s,i,a,f){return s[0]=i,s[1]=a,s[2]=f,s},p.setCacheLimits=function(s,i){ht=s,Bt=i},p.setColumn=function(s,i,a){s[4*i+0]=a[0],s[4*i+1]=a[1],s[4*i+2]=a[2],s[4*i+3]=a[3]},p.setRTLTextPlugin=function(s,i,a=!1){if(be===q||be===Z||be===ge)throw new Error("setRTLTextPlugin cannot be called multiple times.");Re=ci.resolveURL(s),be=q,De=i,xe(),a||Ye()},p.smoothstep=Zt,p.spec=Rt,p.squaredLength=function(s){var i=s[0],a=s[1],f=s[2];return i*i+a*a+f*f},p.storeAuthState=function(s,i){i?at.add(s):at.delete(s)},p.sub=Ec,p.subtract=Km,p.symbolSize=_w,p.tileAABB=function(s,i,a,f,m,w,S,D,P){if("globe"===P.name)return function Lw(s,i,a){const f=i/s.worldSize,m=s.globeMatrix;if(a.z<=1){const It=Mc(a).getCorners();return Vy(It,m,f),Pu.fromPoints(It)}const w=Og(a),S=jy(w);Vy(S,m,f);const D=Number.MAX_VALUE,P=[-D,-D,-D],L=[D,D,D];if(w.contains(s.center)){for(const ln of S)lp(L,L,ln),vd(P,P,ln);P[2]=0;const It=s.point,Ht=[It.x*f,It.y*f,0];return lp(L,L,Ht),vd(P,P,Ht),new Pu(L,P)}const F=[m[12]*f,m[13]*f,m[14]*f],V=w.getCenter(),j=ue(s.center.lat,-85.051129,Hc),H=ue(V.lat,-85.051129,Hc),X=Tl(s.center.lng),te=bc(j);let _e=X-Tl(V.lng);const Ue=te-bc(H);_e>.5?_e-=1:_e<-.5&&(_e+=1);let Xe=0;Math.abs(_e)>Math.abs(Ue)?Xe=_e>=0?1:3:(Xe=Ue>=0?0:2,xd(F,F,[m[4]*f,m[5]*f,m[6]*f],-Math.sin(se(Ue>=0?w.getSouth():w.getNorth()))*Ch));const Be=S[Xe],Ze=S[(Xe+1)%4],rt=new Od(Be,Ze,F),We=[Uy(rt,0)||Be[0],Uy(rt,1)||Be[1],Uy(rt,2)||Be[2]],Mt=af(s.zoom);if(Mt>0){const It=function({x:ln,y:kt,z:Wt},Kt,rn,cn,jt){const In=1/(1<<Wt);let sr=ln*In,Ln=sr+In,Gn=kt*In,Dn=Gn+In,fr=0;const Dr=(sr+Ln)/2-cn;return Dr>.5?fr=-1:Dr<-.5&&(fr=1),sr=((sr+fr)*Kt-(cn*=Kt))*rn+cn,Ln=((Ln+fr)*Kt-cn)*rn+cn,Gn=(Gn*Kt-(jt*=Kt))*rn+jt,Dn=(Dn*Kt-jt)*rn+jt,[[sr,Dn,0],[Ln,Dn,0],[Ln,Gn,0],[sr,Gn,0]]}(a,i,s._pixelsPerMercatorPixel,X,te);for(let ln=0;ln<S.length;ln++)Kc(S[ln],It[ln],Mt);const Ht=Xc([],It[Xe],It[(Xe+1)%4]);Ml(Ht,Ht,.5),Kc(We,Ht,Mt)}for(const It of S)lp(L,L,It),vd(P,P,It);return L[2]=Math.min(Be[2],Ze[2]),lp(L,L,We),vd(P,P,We),new Pu(L,P)}(s,i,new Sd(a,f,m));const L=uf({z:a,x:f,y:m},P);return new Pu([(w+L.x/L.scale)*i,i*(L.y/L.scale),S],[(w+L.x2/L.scale)*i,i*(L.y2/L.scale),D])},p.tileCornersToBounds=Og,p.tileTransform=uf,p.transformMat3=function(s,i,a){var f=i[0],m=i[1],w=i[2];return s[0]=f*a[0]+m*a[3]+w*a[6],s[1]=f*a[1]+m*a[4]+w*a[7],s[2]=f*a[2]+m*a[5]+w*a[8],s},p.transformMat4=js,p.transformMat4$1=nc,p.transformQuat=R0,p.transitionTileAABBinECEF=Pv,p.translate=ap,p.transpose=function(s,i){if(s===i){var a=i[1],f=i[2],m=i[5];s[1]=i[3],s[2]=i[6],s[3]=a,s[5]=i[7],s[6]=f,s[7]=m}else s[0]=i[0],s[1]=i[3],s[2]=i[6],s[3]=i[1],s[4]=i[4],s[5]=i[7],s[6]=i[2],s[7]=i[5],s[8]=i[8];return s},p.triggerPluginCompletionEvent=Ce,p.uniqueId=dt,p.updateGlobeVertexNormal=function(s,i,a,f,m){const w=5*i+2;s.float32[w+0]=a,s.float32[w+1]=f,s.float32[w+2]=m},p.validateCustomStyleLayer=function(s){const i=[],a=s.id;return void 0===a&&i.push({message:`layers.${a}: missing required property "id"`}),void 0===s.render&&i.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&"2d"!==s.renderingMode&&"3d"!==s.renderingMode&&i.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),i},p.validateFilter=s=>x(tl(s)),p.validateFog=s=>x(Po(s)),p.validateLayer=s=>x(br(s)),p.validateLight=s=>x(zs(s)),p.validateSource=s=>x($u(s)),p.validateStyle=u,p.validateTerrain=s=>x(El(s)),p.values=ct,p.vectorTile=_g,p.version=$e,p.warnOnce=Sn,p.window=ve,p.wrap=At}),Fe(0,function(p){function ve(Le){if("number"==typeof Le||"boolean"==typeof Le||"string"==typeof Le||null==Le)return JSON.stringify(Le);if(Array.isArray(Le)){let ne="[";for(const Oe of Le)ne+=`${ve(Oe)},`;return`${ne}]`}let W="{";for(const ne of Object.keys(Le).sort())W+=`${ne}:${ve(Le[ne])},`;return`${W}}`}function $e(Le){let W="";for(const ne of p.refProperties)W+=`/${ve(Le[ne])}`;return W}class ut{constructor(W){this.keyCache={},W&&this.replace(W)}replace(W){this._layerConfigs={},this._layers={},this.update(W,[])}update(W,ne){for(const He of W)this._layerConfigs[He.id]=He,(this._layers[He.id]=p.createStyleLayer(He)).compileFilter(),this.keyCache[He.id]&&delete this.keyCache[He.id];for(const He of ne)delete this.keyCache[He],delete this._layerConfigs[He],delete this._layers[He];this.familiesBySource={};const Oe=function(He,nt){const bt={};for(let at=0;at<He.length;at++){const st=nt&&nt[He[at].id]||$e(He[at]);nt&&(nt[He[at].id]=st);let Xt=bt[st];Xt||(Xt=bt[st]=[]),Xt.push(He[at])}const yt=[];for(const at in bt)yt.push(bt[at]);return yt}(p.values(this._layerConfigs),this.keyCache);for(const He of Oe){const nt=He.map(yn=>this._layers[yn.id]),bt=nt[0];if("none"===bt.visibility)continue;const yt=bt.source||"";let at=this.familiesBySource[yt];at||(at=this.familiesBySource[yt]={});const st=bt.sourceLayer||"_geojsonTileLayer";let Xt=at[st];Xt||(Xt=at[st]=[]),Xt.push(nt)}}}class ft{loadTile(W,ne){const{uid:Oe,encoding:He,rawImageData:nt,padding:bt,buildQuadTree:yt}=W,at=p.window.ImageBitmap&&nt instanceof p.window.ImageBitmap?this.getImageData(nt,bt):nt;ne(null,new p.DEMData(Oe,at,He,bt<1,yt))}getImageData(W,ne){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(W.width,W.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=W.width,this.offscreenCanvas.height=W.height,this.offscreenCanvasContext.drawImage(W,0,0,W.width,W.height);const Oe=this.offscreenCanvasContext.getImageData(-ne,-ne,W.width+2*ne,W.height+2*ne);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Oe}}var Ct=function Le(W,ne){var Oe,He=W&&W.type;if("FeatureCollection"===He)for(Oe=0;Oe<W.features.length;Oe++)Le(W.features[Oe],ne);else if("GeometryCollection"===He)for(Oe=0;Oe<W.geometries.length;Oe++)Le(W.geometries[Oe],ne);else if("Feature"===He)Le(W.geometry,ne);else if("Polygon"===He)Yt(W.coordinates,ne);else if("MultiPolygon"===He)for(Oe=0;Oe<W.coordinates.length;Oe++)Yt(W.coordinates[Oe],ne);return W};function Yt(Le,W){if(0!==Le.length){Ot(Le[0],W);for(var ne=1;ne<Le.length;ne++)Ot(Le[ne],!W)}}function Ot(Le,W){for(var ne=0,Oe=0,He=0,nt=Le.length,bt=nt-1;He<nt;bt=He++){var yt=(Le[He][0]-Le[bt][0])*(Le[bt][1]+Le[He][1]),at=ne+yt;Oe+=Math.abs(ne)>=Math.abs(yt)?ne-at+yt:yt-at+ne,ne=at}ne+Oe>=0!=!!W&&Le.reverse()}const xt=p.VectorTileFeature.prototype.toGeoJSON;class Ut{constructor(W){this._feature=W,this.extent=p.EXTENT,this.type=W.type,this.properties=W.tags,"id"in W&&!isNaN(W.id)&&(this.id=parseInt(W.id,10))}loadGeometry(){if(1===this._feature.type){const W=[];for(const ne of this._feature.geometry)W.push([new p.pointGeometry(ne[0],ne[1])]);return W}{const W=[];for(const ne of this._feature.geometry){const Oe=[];for(const He of ne)Oe.push(new p.pointGeometry(He[0],He[1]));W.push(Oe)}return W}}toGeoJSON(W,ne,Oe){return xt.call(this,W,ne,Oe)}}class pn{constructor(W){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.EXTENT,this.length=W.length,this._features=W}feature(W){return new Ut(this._features[W])}}var he={exports:{}},Ie=p.pointGeometry,le=p.vectorTile.VectorTileFeature,Y=ce;function ce(Le,W){this.options=W||{},this.features=Le,this.length=Le.length}function ke(Le,W){this.id="number"==typeof Le.id?Le.id:void 0,this.type=Le.type,this.rawGeometry=1===Le.type?[Le.geometry]:Le.geometry,this.properties=Le.tags,this.extent=W||4096}ce.prototype.feature=function(Le){return new ke(this.features[Le],this.options.extent)},ke.prototype.loadGeometry=function(){var Le=this.rawGeometry;this.geometry=[];for(var W=0;W<Le.length;W++){for(var ne=Le[W],Oe=[],He=0;He<ne.length;He++)Oe.push(new Ie(ne[He][0],ne[He][1]));this.geometry.push(Oe)}return this.geometry},ke.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Le=this.geometry,W=1/0,ne=-1/0,Oe=1/0,He=-1/0,nt=0;nt<Le.length;nt++)for(var bt=Le[nt],yt=0;yt<bt.length;yt++){var at=bt[yt];W=Math.min(W,at.x),ne=Math.max(ne,at.x),Oe=Math.min(Oe,at.y),He=Math.max(He,at.y)}return[W,Oe,ne,He]},ke.prototype.toGeoJSON=le.prototype.toGeoJSON;var de=p.pbf,se=Y;function we(Le){var W=new de;return function(ne,Oe){for(var He in ne.layers)Oe.writeMessage(3,J,ne.layers[He])}(Le,W),W.finish()}function J(Le,W){var ne;W.writeVarintField(15,Le.version||1),W.writeStringField(1,Le.name||""),W.writeVarintField(5,Le.extent||4096);var Oe={keys:[],values:[],keycache:{},valuecache:{}};for(ne=0;ne<Le.length;ne++)Oe.feature=Le.feature(ne),W.writeMessage(2,pt,Oe);var He=Oe.keys;for(ne=0;ne<He.length;ne++)W.writeStringField(3,He[ne]);var nt=Oe.values;for(ne=0;ne<nt.length;ne++)W.writeMessage(4,At,nt[ne])}function pt(Le,W){var ne=Le.feature;void 0!==ne.id&&W.writeVarintField(1,ne.id),W.writeMessage(2,Ve,Le),W.writeVarintField(3,ne.type),W.writeMessage(4,Zt,ne)}function Ve(Le,W){var ne=Le.feature,Oe=Le.keys,He=Le.values,nt=Le.keycache,bt=Le.valuecache;for(var yt in ne.properties){var at=ne.properties[yt],st=nt[yt];if(null!==at){void 0===st&&(Oe.push(yt),nt[yt]=st=Oe.length-1),W.writeVarint(st);var Xt=typeof at;"string"!==Xt&&"boolean"!==Xt&&"number"!==Xt&&(at=JSON.stringify(at));var yn=Xt+":"+at,tn=bt[yn];void 0===tn&&(He.push(at),bt[yn]=tn=He.length-1),W.writeVarint(tn)}}}function qe(Le,W){return(W<<3)+(7&Le)}function ue(Le){return Le<<1^Le>>31}function Zt(Le,W){for(var ne=Le.loadGeometry(),Oe=Le.type,He=0,nt=0,bt=ne.length,yt=0;yt<bt;yt++){var at=ne[yt],st=1;1===Oe&&(st=at.length),W.writeVarint(qe(1,st));for(var Xt=3===Oe?at.length-1:at.length,yn=0;yn<Xt;yn++){1===yn&&1!==Oe&&W.writeVarint(qe(2,Xt-1));var tn=at[yn].x-He,zn=at[yn].y-nt;W.writeVarint(ue(tn)),W.writeVarint(ue(zn)),He+=tn,nt+=zn}3===Oe&&W.writeVarint(qe(7,1))}}function At(Le,W){var ne=typeof Le;"string"===ne?W.writeStringField(1,Le):"boolean"===ne?W.writeBooleanField(7,Le):"number"===ne&&(Le%1!=0?W.writeDoubleField(3,Le):Le<0?W.writeSVarintField(6,Le):W.writeVarintField(5,Le))}function Pe(Le,W,ne,Oe,He,nt){if(He-Oe<=ne)return;const bt=Oe+He>>1;ct(Le,W,bt,Oe,He,nt%2),Pe(Le,W,ne,Oe,bt-1,nt+1),Pe(Le,W,ne,bt+1,He,nt+1)}function ct(Le,W,ne,Oe,He,nt){for(;He>Oe;){if(He-Oe>600){const st=He-Oe+1,Xt=ne-Oe+1,yn=Math.log(st),tn=.5*Math.exp(2*yn/3),zn=.5*Math.sqrt(yn*tn*(st-tn)/st)*(Xt-st/2<0?-1:1);ct(Le,W,ne,Math.max(Oe,Math.floor(ne-Xt*tn/st+zn)),Math.min(He,Math.floor(ne+(st-Xt)*tn/st+zn)),nt)}const bt=W[2*ne+nt];let yt=Oe,at=He;for(Me(Le,W,Oe,ne),W[2*He+nt]>bt&&Me(Le,W,Oe,He);yt<at;){for(Me(Le,W,yt,at),yt++,at--;W[2*yt+nt]<bt;)yt++;for(;W[2*at+nt]>bt;)at--}W[2*Oe+nt]===bt?Me(Le,W,Oe,at):(at++,Me(Le,W,at,He)),at<=ne&&(Oe=at+1),ne<=at&&(He=at-1)}}function Me(Le,W,ne,Oe){tt(Le,ne,Oe),tt(W,2*ne,2*Oe),tt(W,2*ne+1,2*Oe+1)}function tt(Le,W,ne){const Oe=Le[W];Le[W]=Le[ne],Le[ne]=Oe}function dt(Le,W,ne,Oe){const He=Le-ne,nt=W-Oe;return He*He+nt*nt}he.exports=we,he.exports.fromVectorTileJs=we,he.exports.fromGeojsonVt=function(Le,W){W=W||{};var ne={};for(var Oe in Le)ne[Oe]=new se(Le[Oe].features,W),ne[Oe].name=Oe,ne[Oe].version=W.version,ne[Oe].extent=W.extent;return we({layers:ne})},he.exports.GeoJSONWrapper=se;const Ae=Le=>Le[0],Vt=Le=>Le[1];class Nt{constructor(W,ne=Ae,Oe=Vt,He=64,nt=Float64Array){this.nodeSize=He,this.points=W;const bt=W.length<65536?Uint16Array:Uint32Array,yt=this.ids=new bt(W.length),at=this.coords=new nt(2*W.length);for(let st=0;st<W.length;st++)yt[st]=st,at[2*st]=ne(W[st]),at[2*st+1]=Oe(W[st]);Pe(yt,at,He,0,yt.length-1,0)}range(W,ne,Oe,He){return function(nt,bt,yt,at,st,Xt,yn){const tn=[0,nt.length-1,0],zn=[];let $n,Fn;for(;tn.length;){const or=tn.pop(),nr=tn.pop(),ci=tn.pop();if(nr-ci<=yn){for(let _i=ci;_i<=nr;_i++)$n=bt[2*_i],Fn=bt[2*_i+1],$n>=yt&&$n<=st&&Fn>=at&&Fn<=Xt&&zn.push(nt[_i]);continue}const Nn=Math.floor((ci+nr)/2);$n=bt[2*Nn],Fn=bt[2*Nn+1],$n>=yt&&$n<=st&&Fn>=at&&Fn<=Xt&&zn.push(nt[Nn]);const dr=(or+1)%2;(0===or?yt<=$n:at<=Fn)&&(tn.push(ci),tn.push(Nn-1),tn.push(dr)),(0===or?st>=$n:Xt>=Fn)&&(tn.push(Nn+1),tn.push(nr),tn.push(dr))}return zn}(this.ids,this.coords,W,ne,Oe,He,this.nodeSize)}within(W,ne,Oe){return function(He,nt,bt,yt,at,st){const Xt=[0,He.length-1,0],yn=[],tn=at*at;for(;Xt.length;){const zn=Xt.pop(),$n=Xt.pop(),Fn=Xt.pop();if($n-Fn<=st){for(let dr=Fn;dr<=$n;dr++)dt(nt[2*dr],nt[2*dr+1],bt,yt)<=tn&&yn.push(He[dr]);continue}const or=Math.floor((Fn+$n)/2),nr=nt[2*or],ci=nt[2*or+1];dt(nr,ci,bt,yt)<=tn&&yn.push(He[or]);const Nn=(zn+1)%2;(0===zn?bt-at<=nr:yt-at<=ci)&&(Xt.push(Fn),Xt.push(or-1),Xt.push(Nn)),(0===zn?bt+at>=nr:yt+at>=ci)&&(Xt.push(or+1),Xt.push($n),Xt.push(Nn))}return yn}(this.ids,this.coords,W,ne,Oe,this.nodeSize)}}const fn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Le=>Le},Lt=Math.fround||(Mn=new Float32Array(1),Le=>(Mn[0]=+Le,Mn[0]));var Mn;class Rn{constructor(W){this.options=Zn(Object.create(fn),W),this.trees=new Array(this.options.maxZoom+1)}load(W){const{log:ne,minZoom:Oe,maxZoom:He,nodeSize:nt}=this.options;ne&&console.time("total time");const bt=`prepare ${W.length} points`;ne&&console.time(bt),this.points=W;let yt=[];for(let at=0;at<W.length;at++)W[at].geometry&&yt.push(vn(W[at],at));this.trees[He+1]=new Nt(yt,hr,_t,nt,Float32Array),ne&&console.timeEnd(bt);for(let at=He;at>=Oe;at--){const st=+Date.now();yt=this._cluster(yt,at),this.trees[at]=new Nt(yt,hr,_t,nt,Float32Array),ne&&console.log("z%d: %d clusters in %dms",at,yt.length,+Date.now()-st)}return ne&&console.timeEnd("total time"),this}getClusters(W,ne){let Oe=((W[0]+180)%360+360)%360-180;const He=Math.max(-90,Math.min(90,W[1]));let nt=180===W[2]?180:((W[2]+180)%360+360)%360-180;const bt=Math.max(-90,Math.min(90,W[3]));if(W[2]-W[0]>=360)Oe=-180,nt=180;else if(Oe>nt){const Xt=this.getClusters([Oe,He,180,bt],ne),yn=this.getClusters([-180,He,nt,bt],ne);return Xt.concat(yn)}const yt=this.trees[this._limitZoom(ne)],at=yt.range(Jn(Oe),ti(bt),Jn(nt),ti(He)),st=[];for(const Xt of at){const yn=yt.points[Xt];st.push(yn.numPoints?Sn(yn):this.points[yn.index])}return st}getChildren(W){const ne=this._getOriginId(W),Oe=this._getOriginZoom(W),He="No cluster with the specified id.",nt=this.trees[Oe];if(!nt)throw new Error(He);const bt=nt.points[ne];if(!bt)throw new Error(He);const yt=this.options.radius/(this.options.extent*Math.pow(2,Oe-1)),at=nt.within(bt.x,bt.y,yt),st=[];for(const Xt of at){const yn=nt.points[Xt];yn.parentId===W&&st.push(yn.numPoints?Sn(yn):this.points[yn.index])}if(0===st.length)throw new Error(He);return st}getLeaves(W,ne,Oe){const He=[];return this._appendLeaves(He,W,ne=ne||10,Oe=Oe||0,0),He}getTile(W,ne,Oe){const He=this.trees[this._limitZoom(W)],nt=Math.pow(2,W),{extent:bt,radius:yt}=this.options,at=yt/bt,st=(Oe-at)/nt,Xt=(Oe+1+at)/nt,yn={features:[]};return this._addTileFeatures(He.range((ne-at)/nt,st,(ne+1+at)/nt,Xt),He.points,ne,Oe,nt,yn),0===ne&&this._addTileFeatures(He.range(1-at/nt,st,1,Xt),He.points,nt,Oe,nt,yn),ne===nt-1&&this._addTileFeatures(He.range(0,st,at/nt,Xt),He.points,-1,Oe,nt,yn),yn.features.length?yn:null}getClusterExpansionZoom(W){let ne=this._getOriginZoom(W)-1;for(;ne<=this.options.maxZoom;){const Oe=this.getChildren(W);if(ne++,1!==Oe.length)break;W=Oe[0].properties.cluster_id}return ne}_appendLeaves(W,ne,Oe,He,nt){const bt=this.getChildren(ne);for(const yt of bt){const at=yt.properties;if(at&&at.cluster?nt+at.point_count<=He?nt+=at.point_count:nt=this._appendLeaves(W,at.cluster_id,Oe,He,nt):nt<He?nt++:W.push(yt),W.length===Oe)break}return nt}_addTileFeatures(W,ne,Oe,He,nt,bt){for(const yt of W){const at=ne[yt],st=at.numPoints;let Xt,yn,tn;if(st)Xt=hn(at),yn=at.x,tn=at.y;else{const Fn=this.points[at.index];Xt=Fn.properties,yn=Jn(Fn.geometry.coordinates[0]),tn=ti(Fn.geometry.coordinates[1])}const zn={type:1,geometry:[[Math.round(this.options.extent*(yn*nt-Oe)),Math.round(this.options.extent*(tn*nt-He))]],tags:Xt};let $n;st?$n=at.id:this.options.generateId?$n=at.index:this.points[at.index].id&&($n=this.points[at.index].id),void 0!==$n&&(zn.id=$n),bt.features.push(zn)}}_limitZoom(W){return Math.max(this.options.minZoom,Math.min(Math.floor(+W),this.options.maxZoom+1))}_cluster(W,ne){const Oe=[],{radius:He,extent:nt,reduce:bt,minPoints:yt}=this.options,at=He/(nt*Math.pow(2,ne));for(let st=0;st<W.length;st++){const Xt=W[st];if(Xt.zoom<=ne)continue;Xt.zoom=ne;const yn=this.trees[ne+1],tn=yn.within(Xt.x,Xt.y,at),zn=Xt.numPoints||1;let $n=zn;for(const Fn of tn){const or=yn.points[Fn];or.zoom>ne&&($n+=or.numPoints||1)}if($n>zn&&$n>=yt){let Fn=Xt.x*zn,or=Xt.y*zn,nr=bt&&zn>1?this._map(Xt,!0):null;const ci=(st<<5)+(ne+1)+this.points.length;for(const Nn of tn){const dr=yn.points[Nn];if(dr.zoom<=ne)continue;dr.zoom=ne;const _i=dr.numPoints||1;Fn+=dr.x*_i,or+=dr.y*_i,dr.parentId=ci,bt&&(nr||(nr=this._map(Xt,!0)),bt(nr,this._map(dr)))}Xt.parentId=ci,Oe.push(Bn(Fn/$n,or/$n,ci,$n,nr))}else if(Oe.push(Xt),$n>1)for(const Fn of tn){const or=yn.points[Fn];or.zoom<=ne||(or.zoom=ne,Oe.push(or))}}return Oe}_getOriginId(W){return W-this.points.length>>5}_getOriginZoom(W){return(W-this.points.length)%32}_map(W,ne){if(W.numPoints)return ne?Zn({},W.properties):W.properties;const Oe=this.points[W.index].properties,He=this.options.map(Oe);return ne&&He===Oe?Zn({},He):He}}function Bn(Le,W,ne,Oe,He){return{x:Lt(Le),y:Lt(W),zoom:1/0,id:ne,parentId:-1,numPoints:Oe,properties:He}}function vn(Le,W){const[ne,Oe]=Le.geometry.coordinates;return{x:Lt(Jn(ne)),y:Lt(ti(Oe)),zoom:1/0,index:W,parentId:-1}}function Sn(Le){return{type:"Feature",id:Le.id,properties:hn(Le),geometry:{type:"Point",coordinates:[(W=Le.x,360*(W-.5)),io(Le.y)]}};var W}function hn(Le){const W=Le.numPoints,ne=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W;return Zn(Zn({},Le.properties),{cluster:!0,cluster_id:Le.id,point_count:W,point_count_abbreviated:ne})}function Jn(Le){return Le/360+.5}function ti(Le){const W=Math.sin(Le*Math.PI/180),ne=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return ne<0?0:ne>1?1:ne}function io(Le){const W=(180-360*Le)*Math.PI/180;return 360*Math.atan(Math.exp(W))/Math.PI-90}function Zn(Le,W){for(const ne in W)Le[ne]=W[ne];return Le}function hr(Le){return Le.x}function _t(Le){return Le.y}function ye(Le,W,ne,Oe){for(var He,nt=Oe,bt=ne-W>>1,yt=ne-W,at=Le[W],st=Le[W+1],Xt=Le[ne],yn=Le[ne+1],tn=W+3;tn<ne;tn+=3){var zn=fe(Le[tn],Le[tn+1],at,st,Xt,yn);if(zn>nt)He=tn,nt=zn;else if(zn===nt){var $n=Math.abs(tn-bt);$n<yt&&(He=tn,yt=$n)}}nt>Oe&&(He-W>3&&ye(Le,W,He,Oe),Le[He+2]=nt,ne-He>3&&ye(Le,He,ne,Oe))}function fe(Le,W,ne,Oe,He,nt){var bt=He-ne,yt=nt-Oe;if(0!==bt||0!==yt){var at=((Le-ne)*bt+(W-Oe)*yt)/(bt*bt+yt*yt);at>1?(ne=He,Oe=nt):at>0&&(ne+=bt*at,Oe+=yt*at)}return(bt=Le-ne)*bt+(yt=W-Oe)*yt}function ae(Le,W,ne,Oe){var He={id:void 0===Le?null:Le,type:W,geometry:ne,tags:Oe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(nt){var bt=nt.geometry,yt=nt.type;if("Point"===yt||"MultiPoint"===yt||"LineString"===yt)ze(nt,bt);else if("Polygon"===yt||"MultiLineString"===yt)for(var at=0;at<bt.length;at++)ze(nt,bt[at]);else if("MultiPolygon"===yt)for(at=0;at<bt.length;at++)for(var st=0;st<bt[at].length;st++)ze(nt,bt[at][st])}(He),He}function ze(Le,W){for(var ne=0;ne<W.length;ne+=3)Le.minX=Math.min(Le.minX,W[ne]),Le.minY=Math.min(Le.minY,W[ne+1]),Le.maxX=Math.max(Le.maxX,W[ne]),Le.maxY=Math.max(Le.maxY,W[ne+1])}function ht(Le,W,ne,Oe){if(W.geometry){var He=W.geometry.coordinates,nt=W.geometry.type,bt=Math.pow(ne.tolerance/((1<<ne.maxZoom)*ne.extent),2),yt=[],at=W.id;if(ne.promoteId?at=W.properties[ne.promoteId]:ne.generateId&&(at=Oe||0),"Point"===nt)Bt(He,yt);else if("MultiPoint"===nt)for(var st=0;st<He.length;st++)Bt(He[st],yt);else if("LineString"===nt)on(He,yt,bt,!1);else if("MultiLineString"===nt){if(ne.lineMetrics){for(st=0;st<He.length;st++)on(He[st],yt=[],bt,!1),Le.push(ae(at,"LineString",yt,W.properties));return}sn(He,yt,bt,!1)}else if("Polygon"===nt)sn(He,yt,bt,!0);else{if("MultiPolygon"!==nt){if("GeometryCollection"===nt){for(st=0;st<W.geometry.geometries.length;st++)ht(Le,{id:at,geometry:W.geometry.geometries[st],properties:W.properties},ne,Oe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(st=0;st<He.length;st++){var Xt=[];sn(He[st],Xt,bt,!0),yt.push(Xt)}}Le.push(ae(at,nt,yt,W.properties))}}function Bt(Le,W){W.push(Gt(Le[0])),W.push(ur(Le[1])),W.push(0)}function on(Le,W,ne,Oe){for(var He,nt,bt=0,yt=0;yt<Le.length;yt++){var at=Gt(Le[yt][0]),st=ur(Le[yt][1]);W.push(at),W.push(st),W.push(0),yt>0&&(bt+=Oe?(He*st-at*nt)/2:Math.sqrt(Math.pow(at-He,2)+Math.pow(st-nt,2))),He=at,nt=st}var Xt=W.length-3;W[2]=1,ye(W,0,Xt,ne),W[Xt+2]=1,W.size=Math.abs(bt),W.start=0,W.end=W.size}function sn(Le,W,ne,Oe){for(var He=0;He<Le.length;He++){var nt=[];on(Le[He],nt,ne,Oe),W.push(nt)}}function Gt(Le){return Le/360+.5}function ur(Le){var W=Math.sin(Le*Math.PI/180),ne=.5-.25*Math.log((1+W)/(1-W))/Math.PI;return ne<0?0:ne>1?1:ne}function lr(Le,W,ne,Oe,He,nt,bt,yt){if(Oe/=W,nt>=(ne/=W)&&bt<Oe)return Le;if(bt<ne||nt>=Oe)return null;for(var at=[],st=0;st<Le.length;st++){var Xt=Le[st],yn=Xt.geometry,tn=Xt.type,zn=0===He?Xt.minX:Xt.minY,$n=0===He?Xt.maxX:Xt.maxY;if(zn>=ne&&$n<Oe)at.push(Xt);else if(!($n<ne||zn>=Oe)){var Fn=[];if("Point"===tn||"MultiPoint"===tn)En(yn,Fn,ne,Oe,He);else if("LineString"===tn)Cr(yn,Fn,ne,Oe,He,!1,yt.lineMetrics);else if("MultiLineString"===tn)qr(yn,Fn,ne,Oe,He,!1);else if("Polygon"===tn)qr(yn,Fn,ne,Oe,He,!0);else if("MultiPolygon"===tn)for(var or=0;or<yn.length;or++){var nr=[];qr(yn[or],nr,ne,Oe,He,!0),nr.length&&Fn.push(nr)}if(Fn.length){if(yt.lineMetrics&&"LineString"===tn){for(or=0;or<Fn.length;or++)at.push(ae(Xt.id,tn,Fn[or],Xt.tags));continue}"LineString"!==tn&&"MultiLineString"!==tn||(1===Fn.length?(tn="LineString",Fn=Fn[0]):tn="MultiLineString"),"Point"!==tn&&"MultiPoint"!==tn||(tn=3===Fn.length?"Point":"MultiPoint"),at.push(ae(Xt.id,tn,Fn,Xt.tags))}}}return at.length?at:null}function En(Le,W,ne,Oe,He){for(var nt=0;nt<Le.length;nt+=3){var bt=Le[nt+He];bt>=ne&&bt<=Oe&&(W.push(Le[nt]),W.push(Le[nt+1]),W.push(Le[nt+2]))}}function Cr(Le,W,ne,Oe,He,nt,bt){for(var yt,at,st=Ei(Le),Xt=0===He?Do:jo,yn=Le.start,tn=0;tn<Le.length-3;tn+=3){var zn=Le[tn],$n=Le[tn+1],Fn=Le[tn+2],or=Le[tn+3],nr=Le[tn+4],ci=0===He?zn:$n,Nn=0===He?or:nr,dr=!1;bt&&(yt=Math.sqrt(Math.pow(zn-or,2)+Math.pow($n-nr,2))),ci<ne?Nn>ne&&(at=Xt(st,zn,$n,or,nr,ne),bt&&(st.start=yn+yt*at)):ci>Oe?Nn<Oe&&(at=Xt(st,zn,$n,or,nr,Oe),bt&&(st.start=yn+yt*at)):ui(st,zn,$n,Fn),Nn<ne&&ci>=ne&&(at=Xt(st,zn,$n,or,nr,ne),dr=!0),Nn>Oe&&ci<=Oe&&(at=Xt(st,zn,$n,or,nr,Oe),dr=!0),!nt&&dr&&(bt&&(st.end=yn+yt*at),W.push(st),st=Ei(Le)),bt&&(yn+=yt)}var _i=Le.length-3;zn=Le[_i],$n=Le[_i+1],Fn=Le[_i+2],(ci=0===He?zn:$n)>=ne&&ci<=Oe&&ui(st,zn,$n,Fn),_i=st.length-3,nt&&_i>=3&&(st[_i]!==st[0]||st[_i+1]!==st[1])&&ui(st,st[0],st[1],st[2]),st.length&&W.push(st)}function Ei(Le){var W=[];return W.size=Le.size,W.start=Le.start,W.end=Le.end,W}function qr(Le,W,ne,Oe,He,nt){for(var bt=0;bt<Le.length;bt++)Cr(Le[bt],W,ne,Oe,He,nt,!1)}function ui(Le,W,ne,Oe){Le.push(W),Le.push(ne),Le.push(Oe)}function Do(Le,W,ne,Oe,He,nt){var bt=(nt-W)/(Oe-W);return Le.push(nt),Le.push(ne+(He-ne)*bt),Le.push(1),bt}function jo(Le,W,ne,Oe,He,nt){var bt=(nt-ne)/(He-ne);return Le.push(W+(Oe-W)*bt),Le.push(nt),Le.push(1),bt}function es(Le,W){for(var ne=[],Oe=0;Oe<Le.length;Oe++){var He,nt=Le[Oe],bt=nt.type;if("Point"===bt||"MultiPoint"===bt||"LineString"===bt)He=wo(nt.geometry,W);else if("MultiLineString"===bt||"Polygon"===bt){He=[];for(var yt=0;yt<nt.geometry.length;yt++)He.push(wo(nt.geometry[yt],W))}else if("MultiPolygon"===bt)for(He=[],yt=0;yt<nt.geometry.length;yt++){for(var at=[],st=0;st<nt.geometry[yt].length;st++)at.push(wo(nt.geometry[yt][st],W));He.push(at)}ne.push(ae(nt.id,bt,He,nt.tags))}return ne}function wo(Le,W){var ne=[];ne.size=Le.size,void 0!==Le.start&&(ne.start=Le.start,ne.end=Le.end);for(var Oe=0;Oe<Le.length;Oe+=3)ne.push(Le[Oe]+W,Le[Oe+1],Le[Oe+2]);return ne}function ds(Le,W){if(Le.transformed)return Le;var ne,Oe,He,nt=1<<Le.z,bt=Le.x,yt=Le.y;for(ne=0;ne<Le.features.length;ne++){var at=Le.features[ne],st=at.geometry,Xt=at.type;if(at.geometry=[],1===Xt)for(Oe=0;Oe<st.length;Oe+=2)at.geometry.push(oi(st[Oe],st[Oe+1],W,nt,bt,yt));else for(Oe=0;Oe<st.length;Oe++){var yn=[];for(He=0;He<st[Oe].length;He+=2)yn.push(oi(st[Oe][He],st[Oe][He+1],W,nt,bt,yt));at.geometry.push(yn)}}return Le.transformed=!0,Le}function oi(Le,W,ne,Oe,He,nt){return[Math.round(ne*(Le*Oe-He)),Math.round(ne*(W*Oe-nt))]}function As(Le,W,ne,Oe,He){for(var nt=W===He.maxZoom?0:He.tolerance/((1<<W)*He.extent),bt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ne,y:Oe,z:W,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},yt=0;yt<Le.length;yt++){bt.numFeatures++,ts(bt,Le[yt],nt,He);var at=Le[yt].minX,st=Le[yt].minY,Xt=Le[yt].maxX,yn=Le[yt].maxY;at<bt.minX&&(bt.minX=at),st<bt.minY&&(bt.minY=st),Xt>bt.maxX&&(bt.maxX=Xt),yn>bt.maxY&&(bt.maxY=yn)}return bt}function ts(Le,W,ne,Oe){var He=W.geometry,nt=W.type,bt=[];if("Point"===nt||"MultiPoint"===nt)for(var yt=0;yt<He.length;yt+=3)bt.push(He[yt]),bt.push(He[yt+1]),Le.numPoints++,Le.numSimplified++;else if("LineString"===nt)gn(bt,He,Le,ne,!1,!1);else if("MultiLineString"===nt||"Polygon"===nt)for(yt=0;yt<He.length;yt++)gn(bt,He[yt],Le,ne,"Polygon"===nt,0===yt);else if("MultiPolygon"===nt)for(var at=0;at<He.length;at++){var st=He[at];for(yt=0;yt<st.length;yt++)gn(bt,st[yt],Le,ne,!0,0===yt)}if(bt.length){var Xt=W.tags||null;if("LineString"===nt&&Oe.lineMetrics){for(var yn in Xt={},W.tags)Xt[yn]=W.tags[yn];Xt.mapbox_clip_start=He.start/He.size,Xt.mapbox_clip_end=He.end/He.size}var tn={geometry:bt,type:"Polygon"===nt||"MultiPolygon"===nt?3:"LineString"===nt||"MultiLineString"===nt?2:1,tags:Xt};null!==W.id&&(tn.id=W.id),Le.features.push(tn)}}function gn(Le,W,ne,Oe,He,nt){var bt=Oe*Oe;if(Oe>0&&W.size<(He?bt:Oe))ne.numPoints+=W.length/3;else{for(var yt=[],at=0;at<W.length;at+=3)(0===Oe||W[at+2]>bt)&&(ne.numSimplified++,yt.push(W[at]),yt.push(W[at+1])),ne.numPoints++;He&&function(st,Xt){for(var yn=0,tn=0,zn=st.length,$n=zn-2;tn<zn;$n=tn,tn+=2)yn+=(st[tn]-st[$n])*(st[tn+1]+st[$n+1]);if(yn>0===Xt)for(tn=0,zn=st.length;tn<zn/2;tn+=2){var Fn=st[tn],or=st[tn+1];st[tn]=st[zn-2-tn],st[tn+1]=st[zn-1-tn],st[zn-2-tn]=Fn,st[zn-1-tn]=or}}(yt,nt),Le.push(yt)}}function au(Le,W){var ne=(W=this.options=function(He,nt){for(var bt in nt)He[bt]=nt[bt];return He}(Object.create(this.options),W)).debug;if(ne&&console.time("preprocess data"),W.maxZoom<0||W.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(W.promoteId&&W.generateId)throw new Error("promoteId and generateId cannot be used together.");var He,nt,bt,yt,at,st,Oe=function(He,nt){var bt=[];if("FeatureCollection"===He.type)for(var yt=0;yt<He.features.length;yt++)ht(bt,He.features[yt],nt,yt);else ht(bt,"Feature"===He.type?He:{geometry:He},nt);return bt}(Le,W);this.tiles={},this.tileCoords=[],ne&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",W.indexMaxZoom,W.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),yt=He=Oe,at=lr(He,1,-1-(bt=(nt=W).buffer/nt.extent),bt,0,-1,2,nt),st=lr(He,1,1-bt,2+bt,0,-1,2,nt),(at||st)&&(yt=lr(He,1,-bt,1+bt,0,-1,2,nt)||[],at&&(yt=es(at,1).concat(yt)),st&&(yt=yt.concat(es(st,-1)))),(Oe=yt).length&&this.splitTile(Oe,0,0,0),ne&&(Oe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function No(Le,W,ne){return 32*((1<<Le)*ne+W)+Le}function _r(Le,W){const ne=Le.tileID.canonical;if(!this._geoJSONIndex)return W(null,null);const Oe=this._geoJSONIndex.getTile(ne.z,ne.x,ne.y);if(!Oe)return W(null,null);const He=new pn(Oe.features);let nt=he.exports(He);0===nt.byteOffset&&nt.byteLength===nt.buffer.byteLength||(nt=new Uint8Array(nt)),W(null,{vectorTile:He,rawData:nt.buffer})}au.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},au.prototype.splitTile=function(Le,W,ne,Oe,He,nt,bt){for(var yt=[Le,W,ne,Oe],at=this.options,st=at.debug;yt.length;){Oe=yt.pop(),ne=yt.pop(),W=yt.pop(),Le=yt.pop();var Xt=1<<W,yn=No(W,ne,Oe),tn=this.tiles[yn];if(!tn&&(st>1&&console.time("creation"),tn=this.tiles[yn]=As(Le,W,ne,Oe,at),this.tileCoords.push({z:W,x:ne,y:Oe}),st)){st>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",W,ne,Oe,tn.numFeatures,tn.numPoints,tn.numSimplified),console.timeEnd("creation"));var zn="z"+W;this.stats[zn]=(this.stats[zn]||0)+1,this.total++}if(tn.source=Le,He){if(W===at.maxZoom||W===He)continue;var $n=1<<He-W;if(ne!==Math.floor(nt/$n)||Oe!==Math.floor(bt/$n))continue}else if(W===at.indexMaxZoom||tn.numPoints<=at.indexMaxPoints)continue;if(tn.source=null,0!==Le.length){st>1&&console.time("clipping");var Fn,or,nr,ci,Nn,dr,_i=.5*at.buffer/at.extent,ps=.5-_i,fa=.5+_i,Rt=1+_i;Fn=or=nr=ci=null,Nn=lr(Le,Xt,ne-_i,ne+fa,0,tn.minX,tn.maxX,at),dr=lr(Le,Xt,ne+ps,ne+Rt,0,tn.minX,tn.maxX,at),Le=null,Nn&&(Fn=lr(Nn,Xt,Oe-_i,Oe+fa,1,tn.minY,tn.maxY,at),or=lr(Nn,Xt,Oe+ps,Oe+Rt,1,tn.minY,tn.maxY,at),Nn=null),dr&&(nr=lr(dr,Xt,Oe-_i,Oe+fa,1,tn.minY,tn.maxY,at),ci=lr(dr,Xt,Oe+ps,Oe+Rt,1,tn.minY,tn.maxY,at),dr=null),st>1&&console.timeEnd("clipping"),yt.push(Fn||[],W+1,2*ne,2*Oe),yt.push(or||[],W+1,2*ne,2*Oe+1),yt.push(nr||[],W+1,2*ne+1,2*Oe),yt.push(ci||[],W+1,2*ne+1,2*Oe+1)}}},au.prototype.getTile=function(Le,W,ne){var Oe=this.options,He=Oe.extent,nt=Oe.debug;if(Le<0||Le>24)return null;var bt=1<<Le,yt=No(Le,W=(W%bt+bt)%bt,ne);if(this.tiles[yt])return ds(this.tiles[yt],He);nt>1&&console.log("drilling down to z%d-%d-%d",Le,W,ne);for(var at,st=Le,Xt=W,yn=ne;!at&&st>0;)st--,Xt=Math.floor(Xt/2),yn=Math.floor(yn/2),at=this.tiles[No(st,Xt,yn)];return at&&at.source?(nt>1&&console.log("found parent tile z%d-%d-%d",st,Xt,yn),nt>1&&console.time("drilling down"),this.splitTile(at.source,st,Xt,yn,Le,W,ne),nt>1&&console.timeEnd("drilling down"),this.tiles[yt]?ds(this.tiles[yt],He):null):null};class Oa extends p.VectorTileWorkerSource{constructor(W,ne,Oe,He,nt){super(W,ne,Oe,He,_r),nt&&(this.loadGeoJSON=nt)}loadData(W,ne){const Oe=W&&W.request,He=Oe&&Oe.collectResourceTiming;this.loadGeoJSON(W,(nt,bt)=>{if(nt||!bt)return ne(nt);if("object"!=typeof bt)return ne(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));{Ct(bt,!0);try{if(W.filter){const at=p.createExpression(W.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===at.result)throw new Error(at.value.map(Xt=>`${Xt.key}: ${Xt.message}`).join(", "));bt={type:"FeatureCollection",features:bt.features.filter(Xt=>at.value.evaluate({zoom:0},Xt))}}this._geoJSONIndex=W.cluster?new Rn(function({superclusterOptions:at,clusterProperties:st}){if(!st||!at)return at;const Xt={},yn={},tn={accumulated:null,zoom:0},zn={properties:null},$n=Object.keys(st);for(const Fn of $n){const[or,nr]=st[Fn],ci=p.createExpression(nr),Nn=p.createExpression("string"==typeof or?[or,["accumulated"],["get",Fn]]:or);Xt[Fn]=ci.value,yn[Fn]=Nn.value}return at.map=Fn=>{zn.properties=Fn;const or={};for(const nr of $n)or[nr]=Xt[nr].evaluate(tn,zn);return or},at.reduce=(Fn,or)=>{zn.properties=or;for(const nr of $n)tn.accumulated=Fn[nr],Fn[nr]=yn[nr].evaluate(tn,zn)},at}(W)).load(bt.features):new au(at=bt,W.geojsonVtOptions)}catch(at){return ne(at)}this.loaded={};const yt={};if(He){const at=p.getPerformanceMeasurement(Oe);at&&(yt.resourceTiming={},yt.resourceTiming[W.source]=JSON.parse(JSON.stringify(at)))}ne(null,yt)}var at})}reloadTile(W,ne){const Oe=this.loaded;return Oe&&Oe[W.uid]?super.reloadTile(W,ne):this.loadTile(W,ne)}loadGeoJSON(W,ne){if(W.request)p.getJSON(W.request,ne);else{if("string"!=typeof W.data)return ne(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`));try{return ne(null,JSON.parse(W.data))}catch{return ne(new Error(`Input data given to '${W.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(W,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom(W.clusterId))}catch(Oe){ne(Oe)}}getClusterChildren(W,ne){try{ne(null,this._geoJSONIndex.getChildren(W.clusterId))}catch(Oe){ne(Oe)}}getClusterLeaves(W,ne){try{ne(null,this._geoJSONIndex.getLeaves(W.clusterId,W.limit,W.offset))}catch(Oe){ne(Oe)}}}class Go{constructor(W){this.self=W,this.actor=new p.Actor(W,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=p.getProjection({name:"mercator"}),this.workerSourceTypes={vector:p.VectorTileWorkerSource,geojson:Oa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ne,Oe)=>{if(this.workerSourceTypes[ne])throw new Error(`Worker source with name "${ne}" already registered.`);this.workerSourceTypes[ne]=Oe},this.self.registerRTLTextPlugin=ne=>{if(p.plugin.isParsed())throw new Error("RTL text plugin already registered.");p.plugin.applyArabicShaping=ne.applyArabicShaping,p.plugin.processBidirectionalText=ne.processBidirectionalText,p.plugin.processStyledBidirectionalText=ne.processStyledBidirectionalText}}clearCaches(W,ne,Oe){delete this.layerIndexes[W],delete this.availableImages[W],delete this.workerSources[W],delete this.demWorkerSources[W],Oe()}checkIfReady(W,ne,Oe){Oe()}setReferrer(W,ne){this.referrer=ne}spriteLoaded(W,ne){this.isSpriteLoaded[W]=ne;for(const Oe in this.workerSources[W]){const He=this.workerSources[W][Oe];for(const nt in He)He[nt]instanceof p.VectorTileWorkerSource&&(He[nt].isSpriteLoaded=ne,He[nt].fire(new p.Event("isSpriteLoaded")))}}setImages(W,ne,Oe){this.availableImages[W]=ne;for(const He in this.workerSources[W]){const nt=this.workerSources[W][He];for(const bt in nt)nt[bt].availableImages=ne}Oe()}enableTerrain(W,ne,Oe){this.terrain=ne,Oe()}setProjection(W,ne){this.projections[W]=p.getProjection(ne)}setLayers(W,ne,Oe){this.getLayerIndex(W).replace(ne),Oe()}updateLayers(W,ne,Oe){this.getLayerIndex(W).update(ne.layers,ne.removedIds),Oe()}loadTile(W,ne,Oe){const He=this.enableTerrain?p.extend({enableTerrain:this.terrain},ne):ne;He.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,ne.type,ne.source).loadTile(He,Oe)}loadDEMTile(W,ne,Oe){const He=this.enableTerrain?p.extend({buildQuadTree:this.terrain},ne):ne;this.getDEMWorkerSource(W,ne.source).loadTile(He,Oe)}reloadTile(W,ne,Oe){const He=this.enableTerrain?p.extend({enableTerrain:this.terrain},ne):ne;He.projection=this.projections[W]||this.defaultProjection,this.getWorkerSource(W,ne.type,ne.source).reloadTile(He,Oe)}abortTile(W,ne,Oe){this.getWorkerSource(W,ne.type,ne.source).abortTile(ne,Oe)}removeTile(W,ne,Oe){this.getWorkerSource(W,ne.type,ne.source).removeTile(ne,Oe)}removeSource(W,ne,Oe){if(!this.workerSources[W]||!this.workerSources[W][ne.type]||!this.workerSources[W][ne.type][ne.source])return;const He=this.workerSources[W][ne.type][ne.source];delete this.workerSources[W][ne.type][ne.source],void 0!==He.removeSource?He.removeSource(ne,Oe):Oe()}loadWorkerSource(W,ne,Oe){try{this.self.importScripts(ne.url),Oe()}catch(He){Oe(He.toString())}}syncRTLPluginState(W,ne,Oe){try{p.plugin.setState(ne);const He=p.plugin.getPluginURL();if(p.plugin.isLoaded()&&!p.plugin.isParsed()&&null!=He){this.self.importScripts(He);const nt=p.plugin.isParsed();Oe(nt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${He}`),nt)}}catch(He){Oe(He.toString())}}getAvailableImages(W){let ne=this.availableImages[W];return ne||(ne=[]),ne}getLayerIndex(W){let ne=this.layerIndexes[W];return ne||(ne=this.layerIndexes[W]=new ut),ne}getWorkerSource(W,ne,Oe){return this.workerSources[W]||(this.workerSources[W]={}),this.workerSources[W][ne]||(this.workerSources[W][ne]={}),this.workerSources[W][ne][Oe]||(this.workerSources[W][ne][Oe]=new this.workerSourceTypes[ne]({send:(nt,bt,yt,at,st,Xt)=>{this.actor.send(nt,bt,yt,W,st,Xt)},scheduler:this.actor.scheduler},this.getLayerIndex(W),this.getAvailableImages(W),this.isSpriteLoaded[W])),this.workerSources[W][ne][Oe]}getDEMWorkerSource(W,ne){return this.demWorkerSources[W]||(this.demWorkerSources[W]={}),this.demWorkerSources[W][ne]||(this.demWorkerSources[W][ne]=new ft),this.demWorkerSources[W][ne]}enforceCacheSizeLimit(W,ne){p.enforceCacheSizeLimit(ne)}getWorkerPerformanceMetrics(W,ne,Oe){Oe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Go(self)),Go}),Fe(0,function(p){function ve(v,l){if(Array.isArray(v)){if(!Array.isArray(l)||v.length!==l.length)return!1;for(let g=0;g<v.length;g++)if(!ve(v[g],l[g]))return!1;return!0}if("object"==typeof v&&null!==v&&null!==l){if("object"!=typeof l||Object.keys(v).length!==Object.keys(l).length)return!1;for(const g in v)if(!ve(v[g],l[g]))return!1;return!0}return v===l}var $e=ut;function ut(v){return l=v,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var b,I,M=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(M);try{I=new Worker(O),b=!0}catch{b=!1}return I&&I.terminate(),URL.revokeObjectURL(O),b}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var b=document.createElement("canvas");b.width=b.height=1;var I=b.getContext("2d");if(!I)return!1;var M=I.getImageData(0,0,1,1);return M&&M.width===b.width}()||(void 0===ft[g=l&&l.failIfMajorPerformanceCaveat]&&(ft[g]=function(b){var I,O,B,U,M=(O=b,B=document.createElement("canvas"),(U=Object.create(ut.webGLContextAttributes)).failIfMajorPerformanceCaveat=O,B.getContext("webgl",U)||B.getContext("experimental-webgl",U));if(!M)return!1;try{I=M.createShader(M.VERTEX_SHADER)}catch{return!1}return!(!I||M.isContextLost())&&(M.shaderSource(I,"void main() {}"),M.compileShader(I),!0===M.getShaderParameter(I,M.COMPILE_STATUS))}(g)),!ft[g]||document.documentMode));var l,g}var ft={};function Ct(v,l,g){const b=p.window.document.createElement(v);return void 0!==l&&(b.className=l),g&&g.appendChild(b),b}function Yt(v,l,g){const b=p.window.document.createElementNS("http://www.w3.org/2000/svg",v);for(const I of Object.keys(l))b.setAttributeNS(null,I,l[I]);return g&&g.appendChild(b),b}ut.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const Ot=p.window.document&&p.window.document.documentElement.style,xt=Ot&&void 0!==Ot.userSelect?"userSelect":"WebkitUserSelect";let Ut;function pn(){Ot&&xt&&(Ut=Ot[xt],Ot[xt]="none")}function he(){Ot&&xt&&(Ot[xt]=Ut)}function Ie(v){v.preventDefault(),v.stopPropagation(),p.window.removeEventListener("click",Ie,!0)}function le(){p.window.addEventListener("click",Ie,!0),p.window.setTimeout(()=>{p.window.removeEventListener("click",Ie,!0)},0)}function Y(v,l){const g=v.getBoundingClientRect();return de(v,g,l)}function ce(v,l){const g=v.getBoundingClientRect(),b=[];for(let I=0;I<l.length;I++)b.push(de(v,g,l[I]));return b}function ke(v){return void 0!==p.window.InstallTrigger&&2===v.button&&v.ctrlKey&&p.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:v.button}function de(v,l,g){const b=v.offsetWidth===l.width?1:v.offsetWidth/l.width;return new p.pointGeometry((g.clientX-l.left)*b,(g.clientY-l.top)*b)}function se(v,l){var g=l[0],b=l[1],I=l[2],M=l[3],O=g*M-I*b;return O?(v[0]=M*(O=1/O),v[1]=-b*O,v[2]=-I*O,v[3]=g*O,v):null}function we(v){const{userImage:l}=v;return!!(l&&l.render&&l.render())&&(v.data.replace(new Uint8Array(l.data.buffer)),!0)}class J extends p.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new p.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(l){if(this.loaded!==l&&(this.loaded=l,l)){for(const{ids:g,callback:b}of this.requestors)this._notify(g,b);this.requestors=[]}}hasImage(l){return!!this.getImage(l)}getImage(l){return this.images[l]}addImage(l,g){this._validate(l,g)&&(this.images[l]=g)}_validate(l,g){let b=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchX" value`))),b=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "stretchY" value`))),b=!1),this._validateContent(g.content,g)||(this.fire(new p.ErrorEvent(new Error(`Image "${l}" has invalid "content" value`))),b=!1),b}_validateStretch(l,g){if(!l)return!0;let b=0;for(const I of l){if(I[0]<b||I[1]<I[0]||g<I[1])return!1;b=I[1]}return!0}_validateContent(l,g){return!(l&&(4!==l.length||l[0]<0||g.data.width<l[0]||l[1]<0||g.data.height<l[1]||l[2]<0||g.data.width<l[2]||l[3]<0||g.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))}updateImage(l,g){g.version=this.images[l].version+1,this.images[l]=g,this.updatedImages[l]=!0}removeImage(l){const g=this.images[l];delete this.images[l],delete this.patterns[l],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(l,g){let b=!0;if(!this.isLoaded())for(const I of l)this.images[I]||(b=!1);this.isLoaded()||b?this._notify(l,g):this.requestors.push({ids:l,callback:g})}_notify(l,g){const b={};for(const I of l){this.images[I]||this.fire(new p.Event("styleimagemissing",{id:I}));const M=this.images[I];M?b[I]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:Boolean(M.userImage&&M.userImage.render)}:p.warnOnce(`Image "${I}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}g(null,b)}getPixelSize(){const{width:l,height:g}=this.atlasImage;return{width:l,height:g}}getPattern(l){const g=this.patterns[l],b=this.getImage(l);if(!b)return null;if(g&&g.position.version===b.version)return g.position;if(g)g.position.version=b.version;else{const I={w:b.data.width+2,h:b.data.height+2,x:0,y:0},M=new p.ImagePosition(I,b);this.patterns[l]={bin:I,position:M}}return this._updatePatternAtlas(),this.patterns[l].position}bind(l){const g=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new p.Texture(l,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)}_updatePatternAtlas(){const l=[];for(const M in this.patterns)l.push(this.patterns[M].bin);const{w:g,h:b}=p.potpack(l),I=this.atlasImage;I.resize({width:g||1,height:b||1});for(const M in this.patterns){const{bin:O}=this.patterns[M],B=O.x+1,U=O.y+1,$=this.images[M].data,q=$.width,Z=$.height;p.RGBAImage.copy($,I,{x:0,y:0},{x:B,y:U},{width:q,height:Z}),p.RGBAImage.copy($,I,{x:0,y:Z-1},{x:B,y:U-1},{width:q,height:1}),p.RGBAImage.copy($,I,{x:0,y:0},{x:B,y:U+Z},{width:q,height:1}),p.RGBAImage.copy($,I,{x:q-1,y:0},{x:B-1,y:U},{width:1,height:Z}),p.RGBAImage.copy($,I,{x:0,y:0},{x:B+q,y:U},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(l){for(const g of l){if(this.callbackDispatchedThisFrame[g])continue;this.callbackDispatchedThisFrame[g]=!0;const b=this.images[g];we(b)&&this.updateImage(g,b)}}}const pt=new p.Properties({anchor:new p.DataConstantProperty(p.spec.light.anchor),position:new class{constructor(){this.specification=p.spec.light.position}possiblyEvaluate(v,l){return function([g,b,I]){const M=p.degToRad(b+90),O=p.degToRad(I);return{x:g*Math.cos(M)*Math.sin(O),y:g*Math.sin(M)*Math.sin(O),z:g*Math.cos(O),azimuthal:b,polar:I}}(v.expression.evaluate(l))}interpolate(v,l,g){return{x:p.number(v.x,l.x,g),y:p.number(v.y,l.y,g),z:p.number(v.z,l.z,g),azimuthal:p.number(v.azimuthal,l.azimuthal,g),polar:p.number(v.polar,l.polar,g)}}},color:new p.DataConstantProperty(p.spec.light.color),intensity:new p.DataConstantProperty(p.spec.light.intensity)}),Ve="-transition";class qe extends p.Evented{constructor(l){super(),this._transitionable=new p.Transitionable(pt),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(l,g={}){if(!this._validate(p.validateLight,l,g))for(const b in l){const I=l[b];p.endsWith(b,Ve)?this._transitionable.setTransition(b.slice(0,-Ve.length),I):this._transitionable.setValue(b,I)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,b){return(!b||!1!==b.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}const ue=new p.Properties({source:new p.DataConstantProperty(p.spec.terrain.source),exaggeration:new p.DataConstantProperty(p.spec.terrain.exaggeration)}),Zt="-transition";class At extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(ue),this.set(l),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=g}get(){return this._transitionable.serialize()}set(l){for(const g in l){const b=l[g];p.endsWith(g,Zt)?this._transitionable.setTransition(g.slice(0,-Zt.length),b):this._transitionable.setValue(g,b)}}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}}function Pe(v,l,g,b){const I=p.smoothstep(45,65,g),[M,O]=ct(v,b),B=p.length(l);let U=1-Math.min(1,Math.exp((B-M)/(O-M)*-6));return U*=U*U,U=Math.min(1,1.00747*U),U*I*v.alpha}function ct(v,l){const g=.5/Math.tan(.5*l);return[v.range[0]+g,v.range[1]+g]}const Me=new p.Properties({range:new p.DataConstantProperty(p.spec.fog.range),color:new p.DataConstantProperty(p.spec.fog.color),"high-color":new p.DataConstantProperty(p.spec.fog["high-color"]),"space-color":new p.DataConstantProperty(p.spec.fog["space-color"]),"horizon-blend":new p.DataConstantProperty(p.spec.fog["horizon-blend"]),"star-intensity":new p.DataConstantProperty(p.spec.fog["star-intensity"])}),tt="-transition";class dt extends p.Evented{constructor(l,g){super(),this._transitionable=new p.Transitionable(Me),this.set(l),this._transitioning=this._transitionable.untransitioned(),this._transform=g}get state(){const l=this._transform,g="globe"===l.projection.name,b=p.globeToMercatorTransition(l.zoom),I=this.properties.get("range"),M=[.5,3];return{range:g?[p.number(M[0],I[0],b),p.number(M[1],I[1],b)]:I,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(l,g={}){if(!this._validate(p.validateFog,l,g)){for(const b of Object.keys(p.spec.fog))l&&void 0===l[b]&&(l[b]=p.spec.fog[b].default);for(const b in l){const I=l[b];p.endsWith(b,tt)?this._transitionable.setTransition(b.slice(0,-tt.length),I):this._transitionable.setValue(b,I)}}}getOpacity(l){if(!this._transform.projection.supportsFog)return 0;const g=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:p.smoothstep(45,65,l))*g.a}getOpacityAtLatLng(l,g){return this._transform.projection.supportsFog?function(b,I,M){const O=p.MercatorCoordinate.fromLngLat(I),B=M.elevation?M.elevation.getAtPointOrZero(O):0,U=[O.x,O.y,B];return p.transformMat4(U,U,M.mercatorFogMatrix),Pe(b,U,M.pitch,M._fov)}(this.state,l,g):0}getFovAdjustedRange(l){return this._transform.projection.supportsFog?ct(this.state,l):[0,1]}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,g,b){return(!b||!1!==b.validate)&&p.emitValidationErrors(this,l.call(p.validateStyle,p.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:p.spec})))}}class Ae{constructor(l,g){this.workerPool=l,this.actors=[],this.currentActor=0,this.id=p.uniqueId();const b=this.workerPool.acquire(this.id);for(let I=0;I<b.length;I++){const M=new Ae.Actor(b[I],g,this.id);M.name=`Worker ${I}`,this.actors.push(M)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(l,g,b){p.asyncAll(this.actors,(I,M)=>{I.send(l,g,M)},b=b||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(l=>{l.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Vt(v,l,g){return l*(p.EXTENT/(v.tileSize*Math.pow(2,g-v.tileID.overscaledZ)))}Ae.Actor=p.Actor;class Nt{constructor(l,g,b,I){this.screenBounds=l,this.cameraPoint=g,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=b,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,I)}static createFromScreenPoints(l,g){let b,I;if(l instanceof p.pointGeometry||"number"==typeof l[0]){const M=p.pointGeometry.convert(l);b=[M],I=g.isPointAboveHorizon(M)}else{const M=p.pointGeometry.convert(l[0]),O=p.pointGeometry.convert(l[1]);b=[M,O],I=p.polygonizeBounds(M,O).every(B=>g.isPointAboveHorizon(B))}return new Nt(b,g.getCameraPoint(),I,g)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(l){return p.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],l)}bufferedCameraGeometry(l){const g=this.screenBounds[0],b=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,b,0,!1);return this.cameraPoint.y>b.y&&(this.cameraPoint.x>g.x&&this.cameraPoint.x<b.x?I.splice(3,0,this.cameraPoint):this.cameraPoint.x>=b.x?I[2]=this.cameraPoint:this.cameraPoint.x<=g.x&&(I[3]=this.cameraPoint)),p.bufferConvexPolygon(I,l)}bufferedCameraGeometryGlobe(l){const g=this.screenBounds[0],b=1===this.screenBounds.length?this.screenBounds[0].add(new p.pointGeometry(1,1)):this.screenBounds[1],I=p.polygonizeBounds(g,b,l),M=this.cameraPoint.clone();switch(3*((M.y>g.y)+(M.y>b.y))+((M.x>g.x)+(M.x>b.x))){case 0:I[0]=M,I[4]=M.clone();break;case 1:I.splice(1,0,M);break;case 2:I[1]=M;break;case 3:I.splice(4,0,M);break;case 5:I.splice(2,0,M);break;case 6:I[3]=M;break;case 7:I.splice(3,0,M);break;case 8:I[2]=M}return I}containsTile(l,g,b,I=0){const M=l.queryPadding/g._pixelsPerMercatorPixel+1,O=b?this._bufferedCameraMercator(M,g):this._bufferedScreenMercator(M,g);let B=l.tileID.wrap+(O.unwrapped?I:0);const U=O.polygon.map(Ce=>p.getTilePoint(l.tileTransform,Ce,B));if(!p.polygonIntersectsBox(U,0,0,p.EXTENT,p.EXTENT))return;B=l.tileID.wrap+(this.screenGeometryMercator.unwrapped?I:0);const $=this.screenGeometryMercator.polygon.map(Ce=>p.getTileVec3(l.tileTransform,Ce,B)),q=$.map(Ce=>new p.pointGeometry(Ce[0],Ce[1])),Z=g.getFreeCameraOptions().position||new p.MercatorCoordinate(0,0,0),ge=p.getTileVec3(l.tileTransform,Z,B),De=$.map(Ce=>{const xe=p.sub(Ce,Ce,ge);return p.normalize(xe,xe),new p.Ray(ge,xe)}),be=Vt(l,1,g.zoom)*g._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:q,tilespaceRays:De,bufferedTilespaceGeometry:U,bufferedTilespaceBounds:(Re=p.getBounds(U),Re.min.x=p.clamp(Re.min.x,0,p.EXTENT),Re.min.y=p.clamp(Re.min.y,0,p.EXTENT),Re.max.x=p.clamp(Re.max.x,0,p.EXTENT),Re.max.y=p.clamp(Re.max.y,0,p.EXTENT),Re),tile:l,tileID:l.tileID,pixelToTileUnitsFactor:be};var Re}_bufferedScreenMercator(l,g){const b=Mn(l);if(this._screenRaycastCache[b])return this._screenRaycastCache[b];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedScreenGeometry(l),g):{polygon:this.bufferedScreenGeometry(l).map(M=>g.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[b]=I,I}}_bufferedCameraMercator(l,g){const b=Mn(l);if(this._cameraRaycastCache[b])return this._cameraRaycastCache[b];{let I;return I="globe"===g.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(l),g):{polygon:this.bufferedCameraGeometry(l).map(M=>g.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[b]=I,I}}_projectAndResample(l,g){const b=function(M,O){const B=p.multiply([],O.pixelMatrix,O.globeMatrix),U=[0,-p.GLOBE_RADIUS,0,1],$=[0,p.GLOBE_RADIUS,0,1],q=[0,0,0,1];p.transformMat4$1(U,U,B),p.transformMat4$1($,$,B),p.transformMat4$1(q,q,B);const Z=new p.pointGeometry(U[0]/U[3],U[1]/U[3]),ge=new p.pointGeometry($[0]/$[3],$[1]/$[3]),De=p.polygonContainsPoint(M,Z)&&U[3]<q[3],be=p.polygonContainsPoint(M,ge)&&$[3]<q[3];if(!De&&!be)return null;const Re=function(it,St,zt){for(let Pt=1;Pt<it.length;Pt++){const dn=Lt(St.pointCoordinate3D(it[Pt-1]).x),wt=Lt(St.pointCoordinate3D(it[Pt]).x);if(zt<0){if(dn<wt)return{idx:Pt,t:-dn/(wt-1-dn)}}else if(wt<dn)return{idx:Pt,t:(1-dn)/(wt+1-dn)}}return null}(M,O,De?-1:1);if(!Re)return null;const{idx:Ce,t:xe}=Re;let Ne=Ce>1?fn(M.slice(0,Ce),O):[],Se=Ce<M.length?fn(M.slice(Ce),O):[];Ne=Ne.map(it=>new p.pointGeometry(Lt(it.x),it.y)),Se=Se.map(it=>new p.pointGeometry(Lt(it.x),it.y));const Ye=[...Ne];0===Ye.length&&Ye.push(Se[Se.length-1]);const Qe=p.number(Ye[Ye.length-1].y,(0===Se.length?Ne[0]:Se[0]).y,xe);let Ge;return Ge=De?[new p.pointGeometry(0,Qe),new p.pointGeometry(0,0),new p.pointGeometry(1,0),new p.pointGeometry(1,Qe)]:[new p.pointGeometry(1,Qe),new p.pointGeometry(1,1),new p.pointGeometry(0,1),new p.pointGeometry(0,Qe)],Ye.push(...Ge),0===Se.length?Ye.push(Ne[0]):Ye.push(...Se),{polygon:Ye.map(it=>new p.MercatorCoordinate(it.x,it.y)),unwrapped:!1}}(l,g);if(b)return b;const I=function(M,O){let B=!1,U=-1/0,$=0;for(let Z=0;Z<M.length-1;Z++)M[Z].x>U&&(U=M[Z].x,$=Z);for(let Z=0;Z<M.length-1;Z++){const ge=($+Z)%(M.length-1),De=M[ge],be=M[ge+1];Math.abs(De.x-be.x)>.5&&(De.x<be.x?(De.x+=1,0===ge&&(M[M.length-1].x+=1)):(be.x+=1,ge+1===M.length-1&&(M[0].x+=1)),B=!0)}const q=p.mercatorXfromLng(O.center.lng);return B&&q<Math.abs(q-1)&&M.forEach(Z=>{Z.x-=1}),{polygon:M,unwrapped:B}}(fn(l,g).map(M=>new p.pointGeometry(Lt(M.x),M.y)),g);return{polygon:I.polygon.map(M=>new p.MercatorCoordinate(M.x,M.y)),unwrapped:I.unwrapped}}}function fn(v,l){return p.resample(v,g=>{const b=l.pointCoordinate3D(g);g.x=b.x,g.y=b.y},1/256)}function Lt(v){return v<0?1+v%1:v%1}function Mn(v){return 100*v|0}function Rn(v,l,g,b,I){const M=function(O,B){if(O)return I(O);if(B){v.url&&B.tiles&&v.tiles&&delete v.tiles;const U=p.pick(p.extend(B,v),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);B.vector_layers&&(U.vectorLayers=B.vector_layers,U.vectorLayerIds=U.vectorLayers.map($=>$.id)),U.tiles=l.canonicalizeTileset(U,v.url),I(null,U)}};return v.url?p.getJSON(l.transformRequest(l.normalizeSourceURL(v.url,null,g,b),p.ResourceType.Source),M):p.exported.frame(()=>M(null,v))}class Bn{constructor(l,g,b){this.bounds=p.LngLatBounds.convert(this.validateBounds(l)),this.minzoom=g||0,this.maxzoom=b||24}validateBounds(l){return Array.isArray(l)&&4===l.length?[Math.max(-180,l[0]),Math.max(-90,l[1]),Math.min(180,l[2]),Math.min(90,l[3])]:[-180,-90,180,90]}contains(l){const g=Math.pow(2,l.z),b=Math.floor(p.mercatorXfromLng(this.bounds.getWest())*g),I=Math.floor(p.mercatorYfromLat(this.bounds.getNorth())*g),M=Math.ceil(p.mercatorXfromLng(this.bounds.getEast())*g),O=Math.ceil(p.mercatorYfromLat(this.bounds.getSouth())*g);return l.x>=b&&l.x<M&&l.y>=I&&l.y<O}}class vn{constructor(l,g,b){this.context=l;const I=l.gl;this.buffer=I.createBuffer(),this.dynamicDraw=Boolean(b),this.context.unbindVAO(),l.bindElementBuffer.set(this.buffer),I.bufferData(I.ELEMENT_ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.context.unbindVAO(),this.bind(),g.bufferSubData(g.ELEMENT_ARRAY_BUFFER,0,l.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Sn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class hn{constructor(l,g,b,I){this.length=g.length,this.attributes=b,this.itemSize=g.bytesPerElement,this.dynamicDraw=I,this.context=l;const M=l.gl;this.buffer=M.createBuffer(),l.bindVertexBuffer.set(this.buffer),M.bufferData(M.ARRAY_BUFFER,g.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||g.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(l){const g=this.context.gl;this.bind(),g.bufferSubData(g.ARRAY_BUFFER,0,l.arrayBuffer)}enableAttributes(l,g){for(let b=0;b<this.attributes.length;b++){const I=g.attributes[this.attributes[b].name];void 0!==I&&l.enableVertexAttribArray(I)}}setVertexAttribPointers(l,g,b){for(let I=0;I<this.attributes.length;I++){const M=this.attributes[I],O=g.attributes[M.name];void 0!==O&&l.vertexAttribPointer(O,M.components,l[Sn[M.type]],!1,this.itemSize,M.offset+this.itemSize*(b||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Jn{constructor(l){this.gl=l.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(l){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ti extends Jn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class io extends Jn{getDefault(){return 1}set(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)}}class Zn extends Jn{getDefault(){return 0}set(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)}}class hr extends Jn{getDefault(){return[!0,!0,!0,!0]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class _t extends Jn{getDefault(){return!0}set(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)}}class ye extends Jn{getDefault(){return 255}set(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)}}class fe extends Jn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(l){const g=this.current;(l.func!==g.func||l.ref!==g.ref||l.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)}}class ae extends Jn{getDefault(){const l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)}}class ze extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=l,this.dirty=!1}}class ht extends Jn{getDefault(){return[0,1]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)}}class Bt extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=l,this.dirty=!1}}class on extends Jn{getDefault(){return this.gl.LESS}set(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)}}class sn extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.BLEND):g.disable(g.BLEND),this.current=l,this.dirty=!1}}class Gt extends Jn{getDefault(){const l=this.gl;return[l.ONE,l.ZERO]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)}}class ur extends Jn{getDefault(){return p.Color.transparent}set(l){const g=this.current;(l.r!==g.r||l.g!==g.g||l.b!==g.b||l.a!==g.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)}}class lr extends Jn{getDefault(){return this.gl.FUNC_ADD}set(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)}}class En extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;l?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=l,this.dirty=!1}}class Cr extends Jn{getDefault(){return this.gl.BACK}set(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)}}class Ei extends Jn{getDefault(){return this.gl.CCW}set(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)}}class qr extends Jn{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}}class ui extends Jn{getDefault(){return this.gl.TEXTURE0}set(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)}}class Do extends Jn{getDefault(){const l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]}set(l){const g=this.current;(l[0]!==g[0]||l[1]!==g[1]||l[2]!==g[2]||l[3]!==g[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)}}class jo extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,l),this.current=l,this.dirty=!1}}class es extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class wo extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindTexture(g.TEXTURE_2D,l),this.current=l,this.dirty=!1}}class ds extends Jn{getDefault(){return null}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class oi extends Jn{getDefault(){return null}set(l){const g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1}}class As extends Jn{constructor(l){super(l),this.vao=l.extVertexArrayObject}getDefault(){return null}set(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)}}class ts extends Jn{getDefault(){return 4}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}}class gn extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}}class au extends Jn{getDefault(){return!1}set(l){if(l===this.current&&!this.dirty)return;const g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}}class No extends Jn{constructor(l,g){super(l),this.context=l,this.parent=g}getDefault(){return null}}class _r extends No{setDirty(){this.dirty=!0}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}}class Oa extends No{attachment(){return this.gl.DEPTH_ATTACHMENT}set(l){if(l===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,this.attachment(),g.RENDERBUFFER,l),this.current=l,this.dirty=!1}}class Go extends Oa{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Le{constructor(l,g,b,I){this.context=l,this.width=g,this.height=b;const M=this.framebuffer=l.gl.createFramebuffer();this.colorAttachment=new _r(l,M),I&&(this.depthAttachment=new Oa(l,M))}destroy(){const l=this.context.gl,g=this.colorAttachment.get();if(g&&l.deleteTexture(g),this.depthAttachment){const b=this.depthAttachment.get();b&&l.deleteRenderbuffer(b)}l.deleteFramebuffer(this.framebuffer)}}class W{constructor(l){this.gl=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ti(this),this.clearDepth=new io(this),this.clearStencil=new Zn(this),this.colorMask=new hr(this),this.depthMask=new _t(this),this.stencilMask=new ye(this),this.stencilFunc=new fe(this),this.stencilOp=new ae(this),this.stencilTest=new ze(this),this.depthRange=new ht(this),this.depthTest=new Bt(this),this.depthFunc=new on(this),this.blend=new sn(this),this.blendFunc=new Gt(this),this.blendColor=new ur(this),this.blendEquation=new lr(this),this.cullFace=new En(this),this.cullFaceSide=new Cr(this),this.frontFace=new Ei(this),this.program=new qr(this),this.activeTexture=new ui(this),this.viewport=new Do(this),this.bindFramebuffer=new jo(this),this.bindRenderbuffer=new es(this),this.bindTexture=new wo(this),this.bindVertexBuffer=new ds(this),this.bindElementBuffer=new oi(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new As(this),this.pixelStoreUnpack=new ts(this),this.pixelStoreUnpackPremultiplyAlpha=new gn(this),this.pixelStoreUnpackFlipY=new au(this),this.extTextureFilterAnisotropic=l.getExtension("EXT_texture_filter_anisotropic")||l.getExtension("MOZ_EXT_texture_filter_anisotropic")||l.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=l.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=l.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=l.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=l.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.extTextureHalfFloat=l.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(l.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=l.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l.getExtension("OES_standard_derivatives"),this.extTimerQuery=l.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=l.getParameter(l.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(l,g){return new vn(this,l,g)}createVertexBuffer(l,g,b){return new hn(this,l,g,b)}createRenderbuffer(l,g,b){const I=this.gl,M=I.createRenderbuffer();return this.bindRenderbuffer.set(M),I.renderbufferStorage(I.RENDERBUFFER,l,g,b),this.bindRenderbuffer.set(null),M}createFramebuffer(l,g,b){return new Le(this,l,g,b)}clear({color:l,depth:g,stencil:b}){const I=this.gl;let M=0;l&&(M|=I.COLOR_BUFFER_BIT,this.clearColor.set(l),this.colorMask.set([!0,!0,!0,!0])),void 0!==g&&(M|=I.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(g),this.depthMask.set(!0)),void 0!==b&&(M|=I.STENCIL_BUFFER_BIT,this.clearStencil.set(b),this.stencilMask.set(255)),I.clear(M)}setCullFace(l){!1===l.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(l.mode),this.frontFace.set(l.frontFace))}setDepthMode(l){l.func!==this.gl.ALWAYS||l.mask?(this.depthTest.set(!0),this.depthFunc.set(l.func),this.depthMask.set(l.mask),this.depthRange.set(l.range)):this.depthTest.set(!1)}setStencilMode(l){l.test.func!==this.gl.ALWAYS||l.mask?(this.stencilTest.set(!0),this.stencilMask.set(l.mask),this.stencilOp.set([l.fail,l.depthFail,l.pass]),this.stencilFunc.set({func:l.test.func,ref:l.ref,mask:l.test.mask})):this.stencilTest.set(!1)}setColorMode(l){ve(l.blendFunction,p.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(l.blendFunction),this.blendColor.set(l.blendColor)),this.colorMask.set(l.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class ne extends p.Evented{constructor(l,g,b,I){super(),this.id=l,this.dispatcher=b,this.setEventedParent(I),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=p.extend({type:"raster"},g),p.extend(this,p.pick(g,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Rn(this._options,this.map._requestManager,null,null,(l,g)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(p.extend(this,g),g.bounds&&(this.tileBounds=new Bn(g.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(g.tiles),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(l){this.map=l,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return p.extend({},this._options)}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,g){const b=p.exported.devicePixelRatio>=2,I=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),b,this.tileSize);l.request=p.getImage(this.map._requestManager.transformRequest(I,p.ResourceType.Tile),(M,O,B,U)=>(delete l.request,l.aborted?(l.state="unloaded",g(null)):M?(l.state="errored",g(M)):O?(this.map._refreshExpiredTiles&&l.setExpiryData({cacheControl:B,expires:U}),l.setTexture(O,this.map.painter),l.state="loaded",p.cacheEntryPossiblyAdded(this.dispatcher),void g(null)):g(null)))}static loadTileData(l,g,b){l.setTexture(g,b)}static unloadTileData(l,g){l.texture&&g.saveTileTexture(l.texture)}abortTile(l,g){l.request&&(l.request.cancel(),delete l.request),g()}unloadTile(l,g){l.texture&&this.map.painter.saveTileTexture(l.texture),g()}hasTransition(){return!1}}let Oe;function He(v,l,g,b,I,M,O,B){const U=[v,g,I,l,b,M,1,1,1],$=[O,B,1],q=p.adjoint([],U),[Z,ge,De]=p.transformMat3($,$,p.transpose(q,q));return p.multiply$1(U,[Z,0,0,0,ge,0,0,0,De],U)}class nt extends p.Evented{constructor(l,g,b,I){super(),this.id=l,this.dispatcher=b,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(I),this.options=g,this._dirty=!1}load(l,g){this._loaded=g||!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=p.getImage(this.map._requestManager.transformRequest(this.url,p.ResourceType.Image),(b,I)=>{if(this._imageRequest=null,this._loaded=!0,b)this.fire(new p.ErrorEvent(b));else if(I){const{HTMLImageElement:M}=p.window;this.image=I instanceof M?p.exported.getImageData(I):I,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,l&&(this.coordinates=l),this._finishLoading()}})}loaded(){return this._loaded}updateImage(l){return this.image&&l.url?(this._imageRequest&&l.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=l.url,this.load(l.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(l){this.map=l,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(l){this.coordinates=l,this._boundsArray=void 0;const g=l.map(p.MercatorCoordinate.fromLngLat);return this.tileID=function(b){let I=1/0,M=1/0,O=-1/0,B=-1/0;for(const Z of b)I=Math.min(I,Z.x),M=Math.min(M,Z.y),O=Math.max(O,Z.x),B=Math.max(B,Z.y);const U=Math.max(O-I,B-M),$=Math.max(0,Math.floor(-Math.log(U)/Math.LN2)),q=Math.pow(2,$);return new p.CanonicalTileID($,Math.floor((I+O)/2*q),Math.floor((M+B)/2*q))}(g),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(l){for(const U in this.tiles){const $=this.tiles[U];"loaded"!==$.state&&($.state="loaded",$.texture=this.texture)}if(this._boundsArray)return;const g=p.tileTransform(this.tileID,this.map.transform.projection),[b,I,M,O]=this.coordinates.map(U=>{const $=g.projection.project(U[0],U[1]);return p.getTilePoint(g,$)._round()});this.perspectiveTransform=function(U,$,q,Z,ge,De,be,Re,Ce,xe){const Ne=He(0,0,U,0,0,$,U,$),Se=He(q,Z,ge,De,be,Re,Ce,xe);return p.multiply$1(Se,p.adjoint(Ne,Ne),Se),[Se[6]/Se[8]*U/p.EXTENT,Se[7]/Se[8]*$/p.EXTENT]}(this.width,this.height,b.x,b.y,I.x,I.y,O.x,O.y,M.x,M.y);const B=this._boundsArray=new p.StructArrayLayout4i8;B.emplaceBack(b.x,b.y,0,0),B.emplaceBack(I.x,I.y,p.EXTENT,0),B.emplaceBack(O.x,O.y,0,p.EXTENT),B.emplaceBack(M.x,M.y,p.EXTENT,p.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=l.createVertexBuffer(B,p.boundsAttributes.members),this.boundsSegments=p.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const l=this.map.painter.context,g=l.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new p.Texture(l,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(l)}loadTile(l,g){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},g(null)):(l.state="errored",g(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const bt={vector:class extends p.Evented{constructor(v,l,g,b){if(super(),this.id=v,this.dispatcher=g,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,p.extend(this,p.pick(l,["url","scheme","tileSize","promoteId"])),this._options=p.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b),this._tileWorkers={},this._deduped=new p.DedupedRequest}load(v){this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,g=this.map._worldview;this._tileJSONRequest=Rn(this._options,this.map._requestManager,l,g,(b,I)=>{this._tileJSONRequest=null,this._loaded=!0,b?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),g&&2!==g.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${g}`),this.fire(new p.ErrorEvent(b))):I&&(p.extend(this,I),I.bounds&&(this.tileBounds=new Bn(I.bounds,this.minzoom,this.maxzoom)),p.postTurnstileEvent(I.tiles,this.map._requestManager._customAccessToken),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))),v&&v(b)})}loaded(){return this._loaded}hasTile(v){return!this.tileBounds||this.tileBounds.contains(v.canonical)}onAdd(v){this.map=v,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>{const v=this.map.style._getSourceCaches(this.id);for(const l of v)l.clearTiles()})}setSourceProperty(v){v(),this.reload()}setTiles(v){return this._options.tiles=v,this.reload(),this}setUrl(v){return this.url=v,this._options.url=v,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return p.extend({},this._options)}loadTile(v,l){const g=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(g,p.ResourceType.Tile),data:void 0,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,tileSize:this.tileSize*v.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:v.isSymbolTile};if(b.request.collectResourceTiming=this._collectResourceTiming,v.actor&&"expired"!==v.state)"loading"===v.state?v.reloadCallback=l:v.request=v.actor.send("reloadTile",b,I.bind(this));else if(v.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)v.request=v.actor.send("loadTile",b,I.bind(this),void 0,!0);else{const M=p.loadVectorTile.call({deduped:this._deduped},b,(O,B)=>{O||!B?I.call(this,O):(b.data={cacheControl:B.cacheControl,expires:B.expires,rawData:B.rawData.slice(0)},v.actor&&v.actor.send("loadTile",b,I.bind(this),void 0,!0))},!0);v.request={cancel:M}}function I(M,O){return delete v.request,v.aborted?l(null):M&&404!==M.status?l(M):(O&&O.resourceTiming&&(v.resourceTiming=O.resourceTiming),this.map._refreshExpiredTiles&&O&&v.setExpiryData(O),v.loadVectorData(O,this.map.painter),p.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(v.reloadCallback&&(this.loadTile(v,v.reloadCallback),v.reloadCallback=null)))}}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.actor&&v.actor.send("abortTile",{uid:v.uid,type:this.type,source:this.id})}unloadTile(v){v.unloadVectorData(),v.actor&&v.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},raster:ne,"raster-dem":class extends ne{constructor(v,l,g,b){super(v,l,g,b),this.type="raster-dem",this.maxzoom=22,this._options=p.extend({type:"raster-dem"},l),this.encoding=l.encoding||"mapbox"}loadTile(v,l){const g=this.map._requestManager.normalizeTileURL(v.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function b(I,M){I&&(v.state="errored",l(I)),M&&(v.dem=M,v.dem.onDeserialize(),v.needsHillshadePrepare=!0,v.needsDEMTextureUpload=!0,v.state="loaded",l(null))}v.request=p.getImage(this.map._requestManager.transformRequest(g,p.ResourceType.Tile),function(I,M,O,B){if(delete v.request,v.aborted)v.state="unloaded",l(null);else if(I)v.state="errored",l(I);else if(M){this.map._refreshExpiredTiles&&v.setExpiryData({cacheControl:O,expires:B});const U=p.window.ImageBitmap&&M instanceof p.window.ImageBitmap&&(null==Oe&&(Oe=p.window.OffscreenCanvas&&new p.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof p.window.createImageBitmap),Oe),$=1-(M.width-p.prevPowerOfTwo(M.width))/2;$<1||v.neighboringTiles||(v.neighboringTiles=this._getNeighboringTiles(v.tileID));const q=U?M:p.exported.getImageData(M,$),Z={uid:v.uid,coord:v.tileID,source:this.id,rawImageData:q,encoding:this.encoding,padding:$};v.actor&&"expired"!==v.state||(v.actor=this.dispatcher.getActor(),v.actor.send("loadDEMTile",Z,b.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(v){const l=v.canonical,g=Math.pow(2,l.z),b=(l.x-1+g)%g,I=0===l.x?v.wrap-1:v.wrap,M=(l.x+1+g)%g,O=l.x+1===g?v.wrap+1:v.wrap,B={};return B[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y).key]={backfilled:!1},B[new p.OverscaledTileID(v.overscaledZ,O,l.z,M,l.y).key]={backfilled:!1},l.y>0&&(B[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y-1).key]={backfilled:!1},B[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y-1).key]={backfilled:!1},B[new p.OverscaledTileID(v.overscaledZ,O,l.z,M,l.y-1).key]={backfilled:!1}),l.y+1<g&&(B[new p.OverscaledTileID(v.overscaledZ,I,l.z,b,l.y+1).key]={backfilled:!1},B[new p.OverscaledTileID(v.overscaledZ,v.wrap,l.z,l.x,l.y+1).key]={backfilled:!1},B[new p.OverscaledTileID(v.overscaledZ,O,l.z,M,l.y+1).key]={backfilled:!1}),B}unloadTile(v){v.demTexture&&this.map.painter.saveTileTexture(v.demTexture),v.fbo&&(v.fbo.destroy(),delete v.fbo),v.dem&&delete v.dem,delete v.neighboringTiles,v.state="unloaded"}},geojson:class extends p.Evented{constructor(v,l,g,b){super(),this.id=v,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=g.getActor(),this.setEventedParent(b),this._data=l.data,this._options=p.extend({},l),this._collectResourceTiming=l.collectResourceTiming,void 0!==l.maxzoom&&(this.maxzoom=l.maxzoom),l.type&&(this.type=l.type),l.attribution&&(this.attribution=l.attribution),this.promoteId=l.promoteId;const I=p.EXTENT/this.tileSize;this.workerOptions=p.extend({source:this.id,cluster:l.cluster||!1,geojsonVtOptions:{buffer:(void 0!==l.buffer?l.buffer:128)*I,tolerance:(void 0!==l.tolerance?l.tolerance:.375)*I,extent:p.EXTENT,maxZoom:this.maxzoom,lineMetrics:l.lineMetrics||!1,generateId:l.generateId||!1},superclusterOptions:{maxZoom:void 0!==l.clusterMaxZoom?l.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,l.clusterMinPoints||2),extent:p.EXTENT,radius:(void 0!==l.clusterRadius?l.clusterRadius:50)*I,log:!1,generateId:l.generateId||!1},clusterProperties:l.clusterProperties,filter:l.filter},l.workerOptions)}onAdd(v){this.map=v,this.setData(this._data)}setData(v){return this._data=v,this._updateWorkerData(),this}getClusterExpansionZoom(v,l){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:v,source:this.id},l),this}getClusterChildren(v,l){return this.actor.send("geojson.getClusterChildren",{clusterId:v,source:this.id},l),this}getClusterLeaves(v,l,g,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:v,limit:l,offset:g},b),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new p.Event("dataloading",{dataType:"source"})),this._loaded=!1;const v=p.extend({},this.workerOptions),l=this._data;"string"==typeof l?(v.request=this.map._requestManager.transformRequest(p.exported.resolveURL(l),p.ResourceType.Source),v.request.collectResourceTiming=this._collectResourceTiming):v.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,v,(g,b)=>{if(this._loaded=!0,this._pendingLoad=null,g)this.fire(new p.ErrorEvent(g));else{const I={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&b&&b.resourceTiming&&b.resourceTiming[this.id]&&(I.resourceTiming=b.resourceTiming[this.id]),this.fire(new p.Event("data",I)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(v,l){const g=v.actor?"reloadTile":"loadTile";v.actor=this.actor,v.request=this.actor.send(g,{type:this.type,uid:v.uid,tileID:v.tileID,tileZoom:v.tileZoom,zoom:v.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:p.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(b,I)=>(delete v.request,v.unloadVectorData(),v.aborted?l(null):b?l(b):(v.loadVectorData(I,this.map.painter,"reloadTile"===g),l(null))),void 0,"loadTile"===g)}abortTile(v){v.request&&(v.request.cancel(),delete v.request),v.aborted=!0}unloadTile(v){v.unloadVectorData(),this.actor.send("removeTile",{uid:v.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return p.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends nt{constructor(v,l,g,b){super(v,l,g,b),this.roundZoom=!0,this.type="video",this.options=l}load(){this._loaded=!1;const v=this.options;this.urls=[];for(const l of v.urls)this.urls.push(this.map._requestManager.transformRequest(l,p.ResourceType.Source).url);p.getVideo(this.urls,(l,g)=>{this._loaded=!0,l?this.fire(new p.ErrorEvent(l)):g&&(this.video=g,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(v){if(this.video){const l=this.video.seekable;v<l.start(0)||v>l.end(0)?this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${l.start(0)} and ${l.end(0)}-second mark.`))):this.video.currentTime=v}}getVideo(){return this.video}onAdd(v){this.map||(this.map=v,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const v=this.map.painter.context,l=v.gl;this.texture?this.video.paused||(this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.texSubImage2D(l.TEXTURE_2D,0,0,0,l.RGBA,l.UNSIGNED_BYTE,this.video)):(this.texture=new p.Texture(v,this.video,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(v)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:nt,canvas:class extends nt{constructor(v,l,g,b){super(v,l,g,b),l.coordinates?Array.isArray(l.coordinates)&&4===l.coordinates.length&&!l.coordinates.some(I=>!Array.isArray(I)||2!==I.length||I.some(M=>"number"!=typeof M))||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "coordinates"'))),l.animate&&"boolean"!=typeof l.animate&&this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'optional "animate" property must be a boolean value'))),l.canvas?"string"==typeof l.canvas||l.canvas instanceof p.window.HTMLCanvasElement||this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new p.ErrorEvent(new p.ValidationError(`sources.${v}`,null,'missing required property "canvas"'))),this.options=l,this.animate=void 0===l.animate||l.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof p.window.HTMLCanvasElement?this.options.canvas:p.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new p.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(v){this.map=v,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let v=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,v=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,v=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const l=this.map.painter.context;this.texture?(v||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new p.Texture(l,this.canvas,l.gl.RGBA,{premultiply:!0}),this._prepareData(l)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const v of[this.canvas.width,this.canvas.height])if(isNaN(v)||v<=0)return!0;return!1}},custom:class extends p.Evented{constructor(v,l,g,b){super(),this.id=v,this.type="custom",this._dataType="raster",this._dispatcher=g,this._implementation=l,this.setEventedParent(b),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new p.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new p.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Bn(this._implementation.bounds,this.minzoom,this.maxzoom)),l.update=this._update.bind(this),l.clearTiles=this._clearTiles.bind(this),l.coveringTiles=this._coveringTiles.bind(this),p.extend(this,p.pick(l,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return p.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new p.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(v){this._map=v,this._loaded=!1,this.fire(new p.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(v),this.load()}onRemove(v){this._implementation.onRemove&&this._implementation.onRemove(v)}hasTile(v){if(this._implementation.hasTile){const{x:l,y:g,z:b}=v.canonical;return this._implementation.hasTile({x:l,y:g,z:b})}return!this.tileBounds||this.tileBounds.contains(v.canonical)}loadTile(v,l){const{x:g,y:b,z:I}=v.tileID.canonical,M=new p.window.AbortController;v.request=Promise.resolve(this._implementation.loadTile({x:g,y:b,z:I},{signal:M.signal})).then(function(O){return delete v.request,v.aborted?(v.state="unloaded",l(null)):void 0===O?(v.state="errored",l(null)):null===O?(this.loadTileData(v,{width:this.tileSize,height:this.tileSize,data:null}),v.state="loaded",l(null)):(B=O)instanceof p.window.ImageData||B instanceof p.window.HTMLCanvasElement||B instanceof p.window.ImageBitmap||B instanceof p.window.HTMLImageElement?(this.loadTileData(v,O),v.state="loaded",void l(null)):(v.state="errored",l(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var B}.bind(this)).catch(O=>{20!==O.code&&(v.state="errored",l(O))}),v.request.cancel=()=>M.abort()}loadTileData(v,l){ne.loadTileData(v,l,this._map.painter)}unloadTileData(v){ne.unloadTileData(v,this._map.painter)}unloadTile(v,l){if(this.unloadTileData(v),this._implementation.unloadTile){const{x:g,y:b,z:I}=v.tileID.canonical;this._implementation.unloadTile({x:g,y:b,z:I})}l()}abortTile(v,l){v.request&&v.request.cancel&&(v.request.cancel(),delete v.request),l()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(v=>({x:v.canonical.x,y:v.canonical.y,z:v.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new p.Event("data",{dataType:"source",sourceDataType:"content"}))}}},yt=function(v,l,g,b){const I=new bt[l.type](v,l,g,b);if(I.id!==v)throw new Error(`Expected Source id to be ${v} instead of ${I.id}`);return p.bindAll(["load","abort","unload","serialize","prepare"],I),I};function at(v,l){const g=p.identity([]);return p.scale(g,g,[.5*v.width,.5*-v.height,1]),p.translate(g,g,[1,-1,0]),p.multiply(g,g,v.calculateProjMatrix(l.toUnwrapped())),Float32Array.from(g)}function st(v,l,g,b,I,M,O,B=!1){const U=v.tilesIn(b,O,B);U.sort(yn);const $=[];for(const Z of U)$.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(l,g,v._state,Z,I,M,at(v.transform,Z.tile.tileID),B)});const q=function(Z){const ge={},De={};for(const be of Z){const Re=be.queryResults,Ce=be.wrappedTileID,xe=De[Ce]=De[Ce]||{};for(const Ne in Re){const Se=Re[Ne],Ye=xe[Ne]=xe[Ne]||{},Qe=ge[Ne]=ge[Ne]||[];for(const Ge of Se)Ye[Ge.featureIndex]||(Ye[Ge.featureIndex]=!0,Qe.push(Ge))}}return ge}($);for(const Z in q)q[Z].forEach(ge=>{const De=ge.feature,be=De.layer;be&&"background"!==be.type&&"sky"!==be.type&&(De.source=be.source,be["source-layer"]&&(De.sourceLayer=be["source-layer"]),De.state=void 0!==De.id?v.getFeatureState(be["source-layer"],De.id):{})});return q}function Xt(v,l){const g=v.getRenderableIds().map(M=>v.getTileByID(M)),b=[],I={};for(let M=0;M<g.length;M++){const O=g[M],B=O.tileID.canonical.key;I[B]||(I[B]=!0,O.querySourceFeatures(b,l))}return b}function yn(v,l){const g=v.tileID,b=l.tileID;return g.overscaledZ-b.overscaledZ||g.canonical.y-b.canonical.y||g.wrap-b.wrap||g.canonical.x-b.canonical.x}function tn(){return null!=Af.workerClass?new Af.workerClass:new p.window.Worker(Af.workerUrl)}const zn="mapboxgl_preloaded_worker_pool";class $n{constructor(){this.active={}}acquire(l){if(!this.workers)for(this.workers=[];this.workers.length<$n.workerCount;)this.workers.push(new tn);return this.active[l]=!0,this.workers.slice()}release(l){delete this.active[l],0===this.numActive()&&(this.workers.forEach(g=>{g.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[zn]}numActive(){return Object.keys(this.active).length}}let Fn;function or(){return Fn||(Fn=new $n),Fn}function nr(v,l){const g={};for(const b in v)"ref"!==b&&(g[b]=v[b]);return p.refProperties.forEach(b=>{b in l&&(g[b]=l[b])}),g}function ci(v){v=v.slice();const l=Object.create(null);for(let g=0;g<v.length;g++)l[v[g].id]=v[g];for(let g=0;g<v.length;g++)"ref"in v[g]&&(v[g]=nr(v[g],l[v[g].ref]));return v}$n.workerCount=2;const Nn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function dr(v,l,g){g.push({command:Nn.addSource,args:[v,l[v]]})}function _i(v,l,g){l.push({command:Nn.removeSource,args:[v]}),g[v]=!0}function ps(v,l,g,b){_i(v,g,b),dr(v,l,g)}function fa(v,l,g){let b;for(b in v[g])if(v[g].hasOwnProperty(b)&&"data"!==b&&!ve(v[g][b],l[g][b]))return!1;for(b in l[g])if(l[g].hasOwnProperty(b)&&"data"!==b&&!ve(v[g][b],l[g][b]))return!1;return!0}function Rt(v,l,g,b,I,M){let O;for(O in l=l||{},v=v||{})v.hasOwnProperty(O)&&(ve(v[O],l[O])||g.push({command:M,args:[b,O,l[O],I]}));for(O in l)l.hasOwnProperty(O)&&!v.hasOwnProperty(O)&&(ve(v[O],l[O])||g.push({command:M,args:[b,O,l[O],I]}))}function Na(v){return v.id}function go(v,l){return v[l.id]=l,v}class ra{constructor(l,g){this.reset(l,g)}reset(l,g){this.points=l||[],this._distances=[0];for(let b=1;b<this.points.length;b++)this._distances[b]=this._distances[b-1]+this.points[b].dist(this.points[b-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(g||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(l){if(1===this.points.length)return this.points[0];l=p.clamp(l,0,1);let g=1,b=this._distances[g];const I=l*this.paddedLength+this.padding;for(;b<I&&g<this._distances.length;)b=this._distances[++g];const M=g-1,O=this._distances[M],B=b-O,U=B>0?(I-O)/B:0;return this.points[M].mult(1-U).add(this.points[g].mult(U))}}class Di{constructor(l,g,b){const I=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(l/b),this.yCellCount=Math.ceil(g/b);for(let O=0;O<this.xCellCount*this.yCellCount;O++)I.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=l,this.height=g,this.xScale=this.xCellCount/l,this.yScale=this.yCellCount/g,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(l,g,b,I,M){this._forEachCell(g,b,I,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(l),this.bboxes.push(g),this.bboxes.push(b),this.bboxes.push(I),this.bboxes.push(M)}insertCircle(l,g,b,I){this._forEachCell(g-I,b-I,g+I,b+I,this._insertCircleCell,this.circleUid++),this.circleKeys.push(l),this.circles.push(g),this.circles.push(b),this.circles.push(I)}_insertBoxCell(l,g,b,I,M,O){this.boxCells[M].push(O)}_insertCircleCell(l,g,b,I,M,O){this.circleCells[M].push(O)}_query(l,g,b,I,M,O){if(b<0||l>this.width||I<0||g>this.height)return!M&&[];const B=[];if(l<=0&&g<=0&&this.width<=b&&this.height<=I){if(M)return!0;for(let U=0;U<this.boxKeys.length;U++)B.push({key:this.boxKeys[U],x1:this.bboxes[4*U],y1:this.bboxes[4*U+1],x2:this.bboxes[4*U+2],y2:this.bboxes[4*U+3]});for(let U=0;U<this.circleKeys.length;U++){const $=this.circles[3*U],q=this.circles[3*U+1],Z=this.circles[3*U+2];B.push({key:this.circleKeys[U],x1:$-Z,y1:q-Z,x2:$+Z,y2:q+Z})}return O?B.filter(O):B}return this._forEachCell(l,g,b,I,this._queryCell,B,{hitTest:M,seenUids:{box:{},circle:{}}},O),M?B.length>0:B}_queryCircle(l,g,b,I,M){const O=l-b,B=l+b,U=g-b,$=g+b;if(B<0||O>this.width||$<0||U>this.height)return!I&&[];const q=[];return this._forEachCell(O,U,B,$,this._queryCellCircle,q,{hitTest:I,circle:{x:l,y:g,radius:b},seenUids:{box:{},circle:{}}},M),I?q.length>0:q}query(l,g,b,I,M){return this._query(l,g,b,I,!1,M)}hitTest(l,g,b,I,M){return this._query(l,g,b,I,!0,M)}hitTestCircle(l,g,b,I){return this._queryCircle(l,g,b,!0,I)}_queryCell(l,g,b,I,M,O,B,U){const $=B.seenUids,q=this.boxCells[M];if(null!==q){const ge=this.bboxes;for(const De of q)if(!$.box[De]){$.box[De]=!0;const be=4*De;if(l<=ge[be+2]&&g<=ge[be+3]&&b>=ge[be+0]&&I>=ge[be+1]&&(!U||U(this.boxKeys[De]))){if(B.hitTest)return O.push(!0),!0;O.push({key:this.boxKeys[De],x1:ge[be],y1:ge[be+1],x2:ge[be+2],y2:ge[be+3]})}}}const Z=this.circleCells[M];if(null!==Z){const ge=this.circles;for(const De of Z)if(!$.circle[De]){$.circle[De]=!0;const be=3*De;if(this._circleAndRectCollide(ge[be],ge[be+1],ge[be+2],l,g,b,I)&&(!U||U(this.circleKeys[De]))){if(B.hitTest)return O.push(!0),!0;{const Re=ge[be],Ce=ge[be+1],xe=ge[be+2];O.push({key:this.circleKeys[De],x1:Re-xe,y1:Ce-xe,x2:Re+xe,y2:Ce+xe})}}}}}_queryCellCircle(l,g,b,I,M,O,B,U){const $=B.circle,q=B.seenUids,Z=this.boxCells[M];if(null!==Z){const De=this.bboxes;for(const be of Z)if(!q.box[be]){q.box[be]=!0;const Re=4*be;if(this._circleAndRectCollide($.x,$.y,$.radius,De[Re+0],De[Re+1],De[Re+2],De[Re+3])&&(!U||U(this.boxKeys[be])))return O.push(!0),!0}}const ge=this.circleCells[M];if(null!==ge){const De=this.circles;for(const be of ge)if(!q.circle[be]){q.circle[be]=!0;const Re=3*be;if(this._circlesCollide(De[Re],De[Re+1],De[Re+2],$.x,$.y,$.radius)&&(!U||U(this.circleKeys[be])))return O.push(!0),!0}}}_forEachCell(l,g,b,I,M,O,B,U){const $=this._convertToXCellCoord(l),q=this._convertToYCellCoord(g),Z=this._convertToXCellCoord(b),ge=this._convertToYCellCoord(I);for(let De=$;De<=Z;De++)for(let be=q;be<=ge;be++)if(M.call(this,l,g,b,I,this.xCellCount*be+De,O,B,U))return}_convertToXCellCoord(l){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(l*this.xScale)))}_convertToYCellCoord(l){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(l*this.yScale)))}_circlesCollide(l,g,b,I,M,O){const B=I-l,U=M-g,$=b+O;return $*$>B*B+U*U}_circleAndRectCollide(l,g,b,I,M,O,B){const U=(O-I)/2,$=Math.abs(l-(I+U));if($>U+b)return!1;const q=(B-M)/2,Z=Math.abs(g-(M+q));if(Z>q+b)return!1;if($<=U||Z<=q)return!0;const ge=$-U,De=Z-q;return ge*ge+De*De<=b*b}}const uu=Math.tan(85*Math.PI/180);function Yu(v,l,g,b,I,M,O){const B=p.create();if(g)if("globe"===M.name){const U=p.calculateGlobeLabelMatrix(I,l);p.multiply(B,B,U)}else{const U=se([],O);B[0]=U[0],B[1]=U[1],B[4]=U[2],B[5]=U[3],b||p.rotateZ(B,B,I.angle)}else p.multiply(B,I.labelPlaneMatrix,v);return B}function Vl(v,l,g,b,I,M,O){const B=Yu(v,l,g,b,I,M,O);return"globe"===M.name&&g||(B[2]=B[6]=B[10]=B[14]=0),B}function di(v,l,g,b,I,M,O){if(g){if("globe"===M.name){const B=Yu(v,l,g,b,I,M,O);return p.invert(B,B),p.multiply(B,v,B),B}{const B=p.clone(v),U=p.identity([]);return U[0]=O[0],U[1]=O[1],U[4]=O[2],U[5]=O[3],p.multiply(B,B,U),b||p.rotateZ(B,B,-I.angle),B}}return I.glCoordMatrix}function un(v,l,g=0){const b=[v.x,v.y,g,1];g?p.transformMat4$1(b,b,l):Kr(b,b,l);const I=b[3];return{point:[b[0]/I,b[1]/I,b[2]/I],signedDistanceFromCamera:I}}function qn(v,l){const g=[v[0],v[1],v[2],1];p.transformMat4$1(g,g,l);const b=g[3];return{point:[g[0]/b,g[1]/b,g[2]/b],signedDistanceFromCamera:b}}function vr(v,l){return Math.min(.5+v/l*.5,1.5)}function Cu(v,l){const g=v[0]/v[3],b=v[1]/v[3];return g>=-l[0]&&g<=l[0]&&b>=-l[1]&&b<=l[1]}function pl(v,l,g,b,I,M,O,B,U,$){const q=g.transform,Z=b?v.textSizeData:v.iconSizeData,ge=p.evaluateSizeForZoom(Z,g.transform.zoom),De="globe"===q.projection.name,be=[256/g.width*2+1,256/g.height*2+1],Re=b?v.text.dynamicLayoutVertexArray:v.icon.dynamicLayoutVertexArray;Re.clear();let Ce=null;De&&(Ce=b?v.text.globeExtVertexArray:v.icon.globeExtVertexArray);const xe=v.lineVertexArray,Ne=b?v.text.placedSymbolArray:v.icon.placedSymbolArray,Se=g.transform.width/g.transform.height;let Ye=!1;for(let Qe=0;Qe<Ne.length;Qe++){const Ge=Ne.get(Qe);if(Ge.writingMode!==p.WritingMode.vertical||Ye||0!==Qe&&Ne.get(Qe-1).writingMode===p.WritingMode.horizontal||(Ye=!0),(Ge.hidden||Ge.writingMode===p.WritingMode.vertical)&&!Ye){gr(Ge.numGlyphs,Re);continue}Ye=!1;const it=new p.pointGeometry(Ge.tileAnchorX,Ge.tileAnchorY),St=U?U(it):[0,0,0],zt=q.projection.projectTilePoint(it.x,it.y,$.canonical),Pt=[zt.x+St[0],zt.y+St[1],zt.z+St[2]],dn=[...Pt,1];if(p.transformMat4$1(dn,dn,l),!Cu(dn,be)){gr(Ge.numGlyphs,Re);continue}const wt=vr(g.transform.cameraToCenterDistance,dn[3]),en=p.evaluateSizeForFeature(Z,ge,Ge),Jt=O?en/wt:en*wt,Dt=un(new p.pointGeometry(Pt[0],Pt[1]),I,Pt[2]);if(Dt.signedDistanceFromCamera<=0){gr(Ge.numGlyphs,Re);continue}let mt={};const An=O?null:U,_n=Hs(Ge,Jt,!1,B,l,I,M,v.glyphOffsetArray,xe,Re,Ce,Dt.point,it,mt,Se,An,q.projection,$,O);Ye=_n.useVertical,An&&_n.needsFlipping&&(mt={}),(_n.notEnoughRoom||Ye||_n.needsFlipping&&Hs(Ge,Jt,!0,B,l,I,M,v.glyphOffsetArray,xe,Re,Ce,Dt.point,it,mt,Se,An,q.projection,$,O).notEnoughRoom)&&gr(Ge.numGlyphs,Re)}b?(v.text.dynamicLayoutVertexBuffer.updateData(Re),Ce&&v.text.globeExtVertexBuffer.updateData(Ce)):(v.icon.dynamicLayoutVertexBuffer.updateData(Re),Ce&&v.icon.globeExtVertexBuffer.updateData(Ce))}function Qt(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re){const Ce=B.glyphStartIndex+B.numGlyphs,xe=B.lineStartIndex,Ne=B.lineStartIndex+B.lineLength,Se=l.getoffsetX(B.glyphStartIndex),Ye=l.getoffsetX(Ce-1),Qe=xn(v*Se,g,b,I,M,O,B.segment,xe,Ne,U,$,q,Z,ge,!0,De,be,Re);if(!Qe)return null;const Ge=xn(v*Ye,g,b,I,M,O,B.segment,xe,Ne,U,$,q,Z,ge,!0,De,be,Re);return Ge?{first:Qe,last:Ge}:null}function gl(v,l,g,b){return v.writingMode===p.WritingMode.horizontal&&Math.abs(g.y-l.y)>Math.abs(g.x-l.x)*b?{useVertical:!0}:v.writingMode===p.WritingMode.vertical?l.y<g.y?{needsFlipping:!0}:null:0!==v.flipState&&function(I,M,O){const B=(M.x-I.x)*O;return 0===B||Math.abs((M.y-I.y)/B)>uu}(l,g,b)?1===v.flipState?{needsFlipping:!0}:null:l.x>g.x?{needsFlipping:!0}:null}function Hs(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re,Ce,xe,Ne){const Se=l/24,Ye=v.lineOffsetX*Se,Qe=v.lineOffsetY*Se;let Ge=[];if(v.numGlyphs>1){const it=v.glyphStartIndex+v.numGlyphs,St=v.lineStartIndex,zt=v.lineStartIndex+v.lineLength,Pt=Qt(Se,B,Ye,Qe,g,Z,ge,v,U,M,De,Re,!1,Ce,xe,Ne);if(!Pt)return{notEnoughRoom:!0};const dn=qn(Pt.first.point,O).point,wt=qn(Pt.last.point,O).point,en=new p.pointGeometry(dn[0],dn[1]),Jt=new p.pointGeometry(wt[0],wt[1]);if(b&&!g){const Dt=gl(v,en,Jt,be);if(v.flipState=Dt&&Dt.needsFlipping?1:2,Dt)return Dt}Ge=[Pt.first];for(let Dt=v.glyphStartIndex+1;Dt<it-1;Dt++){const mt=xn(Se*B.getoffsetX(Dt),Ye,Qe,g,Z,ge,v.segment,St,zt,U,M,De,Re,!1,!1,Ce,xe,Ne);if(!mt)return{notEnoughRoom:!0};Ge.push(mt)}Ge.push(Pt.last)}else{if(b&&!g){const St=un(ge,I).point,zt=v.lineStartIndex+v.segment+1,Pt=new p.pointGeometry(U.getx(zt),U.gety(zt)),dn=un(Pt,I),wt=dn.signedDistanceFromCamera>0?dn.point:pr(ge,Pt,St,1,I,void 0,Ce,xe.canonical),en=gl(v,new p.pointGeometry(St[0],St[1]),new p.pointGeometry(wt[0],wt[1]),be);if(v.flipState=en&&en.needsFlipping?1:2,en)return en}const it=xn(Se*B.getoffsetX(v.glyphStartIndex),Ye,Qe,g,Z,ge,v.segment,v.lineStartIndex,v.lineStartIndex+v.lineLength,U,M,De,Re,!1,!1,Ce,xe,Ne);if(!it)return{notEnoughRoom:!0};Ge=[it]}if(q)for(const it of Ge)p.updateGlobeVertexNormal(q,$.length+0,it.up[0],it.up[1],it.up[2]),p.updateGlobeVertexNormal(q,$.length+1,it.up[0],it.up[1],it.up[2]),p.updateGlobeVertexNormal(q,$.length+2,it.up[0],it.up[1],it.up[2]),p.updateGlobeVertexNormal(q,$.length+3,it.up[0],it.up[1],it.up[2]),p.addDynamicAttributes($,it.point[0],it.point[1],it.point[2],it.angle);else for(const it of Ge)p.addDynamicAttributes($,it.point[0],it.point[1],it.point[2],it.angle);return{}}function hc(v,l,g,b,I){const M=b.projectTilePoint(v.x,v.y,l);if(!I)return un(M,g,M.z);const O=I(v);return un(new p.pointGeometry(M.x+O[0],M.y+O[1]),g,M.z+O[2])}function pr(v,l,g,b,I,M,O,B){const U=hc(v.add(v.sub(l)._unit()),B,I,O,M).point,$=p.sub([],g,U);return p.scaleAndAdd([],g,$,b/p.length($))}function xn(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re,Ce,xe){const Ne=b?v-l:v+l;let Se=Ne>0?1:-1,Ye=0;b&&(Se*=-1,Ye=Math.PI),Se<0&&(Ye+=Math.PI);let Qe=Se>0?B+O:B+O+1,Ge=I,it=I,St=0,zt=0;const Pt=Math.abs(Ne),dn=[],wt=[];let en=M;const Jt=()=>{const bn=Qe-Se;return 0===St?M:new p.pointGeometry($.getx(bn),$.gety(bn))},Dt=()=>{const bn=Jt();return pr(bn,en||bn,it,Pt-St+1,q,ge,Re,Ce.canonical)};for(;St+zt<=Pt;){if(Qe+=Se,Qe<B||Qe>=U)return null;if(it=Ge,dn.push(Ge),De&&wt.push(en||Jt()),Ge=Z[Qe],void 0===Ge){en=new p.pointGeometry($.getx(Qe),$.gety(Qe));const bn=hc(en,Ce.canonical,q,Re,ge);Ge=bn.signedDistanceFromCamera>0?Z[Qe]=bn.point:Dt()}else en=null;St+=zt,zt=p.distance(it,Ge)}en=en||new p.pointGeometry($.getx(Qe),$.gety(Qe));const mt=Jt();be&&ge&&(Z[Qe]=Ge=void 0===Z[Qe]?Ge:Dt(),zt=p.distance(it,Ge));const An=(Pt-St)/zt,_n=en.sub(mt).mult(An)._add(mt),Cn=p.sub([],Ge,it),wn=p.scaleAndAdd([],it,Cn,An);let Vn=[0,0,1],mr=Cn[0],ir=Cn[1];if(xe&&(Vn=Re.upVector(Ce.canonical,_n.x,_n.y),0!==Vn[0]||0!==Vn[1]||1!==Vn[2])){const bn=[1,0,0],xr=[0,1,0];bn[0]=Vn[2],bn[1]=0,bn[2]=-Vn[0],p.cross(xr,Vn,bn),p.normalize(bn,bn),p.normalize(xr,xr),mr=p.dot(Cn,bn),ir=p.dot(Cn,xr)}if(g){const bn=p.cross([],Vn,Cn);p.normalize(bn,bn),p.scaleAndAdd(wn,wn,bn,g*Se)}const Xn=Ye+Math.atan2(ir,mr);return dn.push(wn),De&&wt.push(_n),{point:wn,angle:Xn,path:dn,tilePath:wt,up:Vn}}const Uh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function gr(v,l){for(let g=0;g<v;g++){const b=l.length;l.resize(b+4),l.float32.set(Uh,4*b)}}function Kr(v,l,g){const b=l[0],I=l[1];return v[0]=g[0]*b+g[4]*I+g[12],v[1]=g[1]*b+g[5]*I+g[13],v[3]=g[3]*b+g[7]*I+g[15],v}const gs=100;class Vh{constructor(l,g,b=new Di(l.width+200,l.height+200,25),I=new Di(l.width+200,l.height+200,25)){this.transform=l,this.grid=b,this.ignoredGrid=I,this.pitchfactor=Math.cos(l._pitch)*l.cameraToCenterDistance,this.screenRightBoundary=l.width+gs,this.screenBottomBoundary=l.height+gs,this.gridRightBoundary=l.width+200,this.gridBottomBoundary=l.height+200,this.fogState=g}placeCollisionBox(l,g,b,I,M,O,B,U){let $=b.projectedAnchorX,q=b.projectedAnchorY,Z=b.projectedAnchorZ;const ge=b.elevation,De=b.tileID;if(ge&&De){const Qe=l.getProjection().upVector(De.canonical,b.tileAnchorX,b.tileAnchorY),Ge=l.getProjection().upVectorScale(De.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;$+=Qe[0]*ge*Ge,q+=Qe[1]*ge*Ge,Z+=Qe[2]*ge*Ge}const be=this.projectAndGetPerspectiveRatio(B,[$,q,Z],b.tileID,"globe"===l.projection.name||!!ge||this.transform.pitch>0,l.getProjection()),Re=O*be.perspectiveRatio,Ce=(b.x1*g+I.x-b.padding)*Re+be.point.x,xe=(b.y1*g+I.y-b.padding)*Re+be.point.y,Ne=(b.x2*g+I.x+b.padding)*Re+be.point.x,Se=(b.y2*g+I.y+b.padding)*Re+be.point.y,Ye=be.perspectiveRatio<=.55||be.occluded;return!this.isInsideGrid(Ce,xe,Ne,Se)||!M&&this.grid.hitTest(Ce,xe,Ne,Se,U)||Ye?{box:[],offscreen:!1,occluded:be.occluded}:{box:[Ce,xe,Ne,Se],offscreen:this.isOffscreen(Ce,xe,Ne,Se),occluded:!1}}placeCollisionCircles(l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re){const Ce=[],xe=this.transform.elevation,Ne=xe?xe.getAtTileOffsetFunc(Re,this.transform.center.lat,this.transform.worldSize,l.getProjection()):mt=>[0,0,0],Se=new p.pointGeometry(b.tileAnchorX,b.tileAnchorY),Ye=l.getProjection().projectTilePoint(b.tileAnchorX,b.tileAnchorY,Re.canonical),Qe=Ne(Se),Ge=[Ye.x+Qe[0],Ye.y+Qe[1],Ye.z+Qe[2]],it="globe"===l.projection.name,St=this.projectAndGetPerspectiveRatio(B,[Ge[0],Ge[1],Ge[2]],Re,it||!!xe||this.transform.pitch>0,l.getProjection()),{perspectiveRatio:zt}=St,Pt=(Z?O/zt:O*zt)/p.ONE_EM,dn=un(new p.pointGeometry(Ge[0],Ge[1]),U,Ge[2]).point,wt=St.signedDistanceFromCamera>0?Qt(Pt,M,b.lineOffsetX*Pt,b.lineOffsetY*Pt,!1,dn,Se,b,I,U,{},xe&&!Z?Ne:null,Z&&!!xe,l.getProjection(),Re,Z):null;let en=!1,Jt=!1,Dt=!0;if(wt&&!St.occluded){const mt=.5*De*zt+be,An=new p.pointGeometry(-100,-100),_n=new p.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Cn=new ra,wn=wt.first,Vn=wt.last;let mr=[];for(let bn=wn.path.length-1;bn>=1;bn--)mr.push(wn.path[bn]);for(let bn=1;bn<Vn.path.length;bn++)mr.push(Vn.path[bn]);const ir=2.5*mt;if($){const bn=mr.map(xe&&!it?(xr,Fr)=>{const ao=Ne(Fr<wn.path.length-1?wn.tilePath[wn.path.length-1-Fr]:Vn.tilePath[Fr-wn.path.length+2]);return xr[2]=ao[2],qn(xr,$)}:xr=>qn(xr,$));mr=bn.some(xr=>xr.signedDistanceFromCamera<=0)?[]:bn.map(xr=>xr.point)}let Xn=[];if(mr.length>0){const bn=mr.map(uo=>new p.pointGeometry(uo[0],uo[1]));let xr=1/0,Fr=-1/0,ao=1/0,Ro=-1/0;for(let uo=0;uo<bn.length;uo++)xr=Math.min(xr,bn[uo].x),ao=Math.min(ao,bn[uo].y),Fr=Math.max(Fr,bn[uo].x),Ro=Math.max(Ro,bn[uo].y);Xn=xr>=An.x&&Fr<=_n.x&&ao>=An.y&&Ro<=_n.y?[bn]:Fr<An.x||xr>_n.x||Ro<An.y||ao>_n.y?[]:p.clipLine([bn],An.x,An.y,_n.x,_n.y)}for(const bn of Xn){Cn.reset(bn,.25*mt);let xr=0;xr=Cn.length<=.5*mt?1:Math.ceil(Cn.paddedLength/ir)+1;for(let Fr=0;Fr<xr;Fr++){const ao=Fr/Math.max(xr-1,1),Ro=Cn.lerp(ao),uo=Ro.x+gs,aa=Ro.y+gs;Ce.push(uo,aa,mt,0);const gu=uo-mt,ya=aa-mt,Wo=uo+mt,Yo=aa+mt;if(Dt=Dt&&this.isOffscreen(gu,ya,Wo,Yo),Jt=Jt||this.isInsideGrid(gu,ya,Wo,Yo),!g&&this.grid.hitTestCircle(uo,aa,mt,ge)&&(en=!0,!q))return{circles:[],offscreen:!1,collisionDetected:en,occluded:!1}}}}return{circles:!q&&en||!Jt?[]:Ce,offscreen:Dt,collisionDetected:en,occluded:St.occluded}}queryRenderedSymbols(l){if(0===l.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const g=[];let b=1/0,I=1/0,M=-1/0,O=-1/0;for(const q of l){const Z=new p.pointGeometry(q.x+gs,q.y+gs);b=Math.min(b,Z.x),I=Math.min(I,Z.y),M=Math.max(M,Z.x),O=Math.max(O,Z.y),g.push(Z)}const B=this.grid.query(b,I,M,O).concat(this.ignoredGrid.query(b,I,M,O)),U={},$={};for(const q of B){const Z=q.key;if(void 0===U[Z.bucketInstanceId]&&(U[Z.bucketInstanceId]={}),U[Z.bucketInstanceId][Z.featureIndex])continue;const ge=[new p.pointGeometry(q.x1,q.y1),new p.pointGeometry(q.x2,q.y1),new p.pointGeometry(q.x2,q.y2),new p.pointGeometry(q.x1,q.y2)];p.polygonIntersectsPolygon(g,ge)&&(U[Z.bucketInstanceId][Z.featureIndex]=!0,void 0===$[Z.bucketInstanceId]&&($[Z.bucketInstanceId]=[]),$[Z.bucketInstanceId].push(Z.featureIndex))}return $}insertCollisionBox(l,g,b,I,M){(g?this.ignoredGrid:this.grid).insert({bucketInstanceId:b,featureIndex:I,collisionGroupID:M},l[0],l[1],l[2],l[3])}insertCollisionCircles(l,g,b,I,M){const O=g?this.ignoredGrid:this.grid,B={bucketInstanceId:b,featureIndex:I,collisionGroupID:M};for(let U=0;U<l.length;U+=4)O.insertCircle(B,l[U],l[U+1],l[U+2])}projectAndGetPerspectiveRatio(l,g,b,I,M){const O=[g[0],g[1],g[2],1];let B=!1;if(g[2]||this.transform.pitch>0){p.transformMat4$1(O,O,l);const U="globe"===M.name;this.fogState&&b&&!U&&(B=function($,q,Z,ge,De,be){const Re=be.calculateFogTileMatrix(De),Ce=[q,Z,ge];return p.transformMat4(Ce,Ce,Re),Pe($,Ce,be.pitch,be._fov)}(this.fogState,g[0],g[1],g[2],b.toUnwrapped(),this.transform)>.9)}else Kr(O,O,l);return{point:new p.pointGeometry((O[0]/O[3]+1)/2*this.transform.width+gs,(-O[1]/O[3]+1)/2*this.transform.height+gs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(M)/O[3]*.5,1.5),signedDistanceFromCamera:O[3],occluded:I&&O[2]>O[3]||B}}isOffscreen(l,g,b,I){return b<gs||l>=this.screenRightBoundary||I<gs||g>this.screenBottomBoundary}isInsideGrid(l,g,b,I){return b>=0&&l<this.gridRightBoundary&&I>=0&&g<this.gridBottomBoundary}getViewportMatrix(){const l=p.identity([]);return p.translate(l,l,[-100,-100,0]),l}}function ch(v,l,g){const b=l.createTileMatrix(v,v.worldSize,g.toUnwrapped());return p.multiply(new Float32Array(16),v.projMatrix,b)}function mn(v,l,g){if(l.projection.name===g.projection.name)return v.projMatrix;const b=g.clone();return b.setProjection(l.projection),ch(b,l.getProjection(),v)}function Ps(v,l,g){return l.name===g.projection.name?v.projMatrix:ch(g,l,v)}class ka{constructor(l,g,b,I){this.opacity=l?Math.max(0,Math.min(1,l.opacity+(l.placed?g:-g))):I&&b?1:0,this.placed=b}isHidden(){return 0===this.opacity&&!this.placed}}class ba{constructor(l,g,b,I,M,O=!1){this.text=new ka(l?l.text:null,g,b,M),this.icon=new ka(l?l.icon:null,g,I,M),this.clipped=O}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ia{constructor(l,g,b,I=!1){this.text=l,this.icon=g,this.skipFade=b,this.clipped=I}}class Ur{constructor(){this.invProjMatrix=p.create(),this.viewportMatrix=p.create(),this.circles=[]}}class oo{constructor(l,g,b,I,M){this.bucketInstanceId=l,this.featureIndex=g,this.sourceLayerIndex=b,this.bucketIndex=I,this.tileID=M}}class gi{constructor(l){this.crossSourceCollisions=l,this.maxGroupID=0,this.collisionGroups={}}get(l){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[l]){const g=++this.maxGroupID;this.collisionGroups[l]={ID:g,predicate:b=>b.collisionGroupID===g}}return this.collisionGroups[l]}}function hi(v,l,g,b,I){const{horizontalAlign:M,verticalAlign:O}=p.getAnchorAlignment(v),B=-(M-.5)*l,U=-(O-.5)*g,$=p.evaluateVariableOffset(v,b);return new p.pointGeometry(B+$[0]*I,U+$[1]*I)}function lu(v,l,g,b,I){const M=new p.pointGeometry(v,l);return g&&M._rotate(b?I:-I),M}class ad{constructor(l,g,b,I,M){this.transform=l.clone(),this.projection=l.projection.name,this.collisionIndex=new Vh(this.transform,M),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=g,this.retainedQueryData={},this.collisionGroups=new gi(b),this.collisionCircleArrays={},this.prevPlacement=I,I&&(I.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(l,g,b,I){const M=b.getBucket(g),O=b.latestFeatureIndex;if(!M||!O||g.id!==M.layerIds[0])return;const B=M.layers[0].layout,U=b.collisionBoxArray,$=Math.pow(2,this.transform.zoom-b.tileID.overscaledZ),q=b.tileSize/p.EXTENT,Z=b.tileID.toUnwrapped();this.transform.setProjection(M.projection);const ge=(De=b.tileID,be=M.getProjection(),Re=this.transform,be.name===this.projection?Re.calculateProjMatrix(De.toUnwrapped()):ch(Re,be,De));var De,be,Re;const Ce="map"===B.get("text-pitch-alignment"),xe="map"===B.get("text-rotation-alignment");g.compileFilter();const Ne=g.dynamicFilter(),Se=g.dynamicFilterNeedsFeature(),Ye=this.transform.calculatePixelsToTileUnitsMatrix(b),Qe=Vl(ge,b.tileID.canonical,Ce,xe,this.transform,M.getProjection(),Ye);let Ge=null;if(Ce){const zt=di(ge,b.tileID.canonical,Ce,xe,this.transform,M.getProjection(),Ye);Ge=p.multiply([],this.transform.labelPlaneMatrix,zt)}let it=null;Ne&&b.latestFeatureIndex&&(it={unwrappedTileID:Z,dynamicFilter:Ne,dynamicFilterNeedsFeature:Se,featureIndex:b.latestFeatureIndex}),this.retainedQueryData[M.bucketInstanceId]=new oo(M.bucketInstanceId,O,M.sourceLayerIndex,M.index,b.tileID);const St={bucket:M,layout:B,posMatrix:ge,textLabelPlaneMatrix:Qe,labelToScreenMatrix:Ge,clippingData:it,scale:$,textPixelRatio:q,holdingForFade:b.holdingForFade(),collisionBoxArray:U,partiallyEvaluatedTextSize:p.evaluateSizeForZoom(M.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:p.evaluateSizeForZoom(M.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(M.sourceID)};if(I)for(const zt of M.sortKeyRanges){const{sortKey:Pt,symbolInstanceStart:dn,symbolInstanceEnd:wt}=zt;l.push({sortKey:Pt,symbolInstanceStart:dn,symbolInstanceEnd:wt,parameters:St})}else l.push({symbolInstanceStart:0,symbolInstanceEnd:M.symbolInstances.length,parameters:St})}attemptAnchorPlacement(l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re,Ce,xe,Ne){const Se=[ge.textOffset0,ge.textOffset1],Ye=hi(l,b,I,Se,M),Qe=this.collisionIndex.placeCollisionBox(be,M,g,lu(Ye.x,Ye.y,O,B,this.transform.angle),Z,U,$,q.predicate);if(Ce){const Ge=be.getSymbolInstanceIconSize(Ne,this.transform.zoom,ge.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(be,Ge,Ce,lu(Ye.x,Ye.y,O,B,this.transform.angle),Z,U,$,q.predicate).box.length)return}if(Qe.box.length>0){let Ge;return this.prevPlacement&&this.prevPlacement.variableOffsets[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID]&&this.prevPlacement.placements[ge.crossTileID].text&&(Ge=this.prevPlacement.variableOffsets[ge.crossTileID].anchor),this.variableOffsets[ge.crossTileID]={textOffset:Se,width:b,height:I,anchor:l,textScale:M,prevAnchor:Ge},this.markUsedJustification(be,l,ge,Re),be.allowVerticalPlacement&&(this.markUsedOrientation(be,Re,ge),this.placedOrientations[ge.crossTileID]=Re),{shift:Ye,placedGlyphBoxes:Qe}}}placeLayerBucketPart(l,g,b,I){const{bucket:M,layout:O,posMatrix:B,textLabelPlaneMatrix:U,labelToScreenMatrix:$,clippingData:q,textPixelRatio:Z,holdingForFade:ge,collisionBoxArray:De,partiallyEvaluatedTextSize:be,partiallyEvaluatedIconSize:Re,collisionGroup:Ce}=l.parameters,xe=O.get("text-optional"),Ne=O.get("icon-optional"),Se=O.get("text-allow-overlap"),Ye=O.get("icon-allow-overlap"),Qe="map"===O.get("text-rotation-alignment"),Ge="map"===O.get("text-pitch-alignment"),it="none"!==O.get("icon-text-fit"),St="viewport-y"===O.get("symbol-z-order");this.transform.setProjection(M.projection);let zt=Se&&(Ye||!M.hasIconData()||Ne),Pt=Ye&&(Se||!M.hasTextData()||xe);!M.collisionArrays&&De&&M.deserializeCollisionBoxes(De),b&&I&&M.updateCollisionDebugBuffers(this.transform.zoom,De);const dn=(wt,en,Jt)=>{if(q){const Wo={zoom:this.transform.zoom,pitch:this.transform.pitch};let Yo=null;if(q.dynamicFilterNeedsFeature){const Ii=this.retainedQueryData[M.bucketInstanceId];Yo=q.featureIndex.loadFeature({featureIndex:wt.featureIndex,bucketIndex:Ii.bucketIndex,sourceLayerIndex:Ii.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,q.dynamicFilter)(Wo,Yo,this.retainedQueryData[M.bucketInstanceId].tileID.canonical,new p.pointGeometry(wt.tileAnchorX,wt.tileAnchorY),this.transform.calculateDistanceTileData(q.unwrappedTileID)))return this.placements[wt.crossTileID]=new ia(!1,!1,!1,!0),void(g[wt.crossTileID]=!0)}if(g[wt.crossTileID])return;if(ge)return void(this.placements[wt.crossTileID]=new ia(!1,!1,!1));let Dt=!1,mt=!1,An=!0,_n=!1,Cn=!1,wn=null,Vn={box:null,offscreen:null,occluded:null},mr={box:null,offscreen:null,occluded:null},ir=null,Xn=null,bn=null,xr=0,Fr=0,ao=0;Jt.textFeatureIndex?xr=Jt.textFeatureIndex:wt.useRuntimeCollisionCircles&&(xr=wt.featureIndex),Jt.verticalTextFeatureIndex&&(Fr=Jt.verticalTextFeatureIndex);const Ro=Wo=>{Wo.tileID=this.retainedQueryData[M.bucketInstanceId].tileID,(this.transform.elevation||Wo.elevation)&&(Wo.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[M.bucketInstanceId].tileID,Wo.tileAnchorX,Wo.tileAnchorY):0)},uo=Jt.textBox;if(uo){Ro(uo);const Wo=Ii=>{let Us=p.WritingMode.horizontal;if(M.allowVerticalPlacement&&!Ii&&this.prevPlacement){const Ma=this.prevPlacement.placedOrientations[wt.crossTileID];Ma&&(this.placedOrientations[wt.crossTileID]=Ma,Us=Ma,this.markUsedOrientation(M,Us,wt))}return Us},Yo=(Ii,Us)=>{if(M.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&Jt.verticalTextBox){for(const Ma of M.writingModes)if(Ma===p.WritingMode.vertical?(Vn=Us(),mr=Vn):Vn=Ii(),Vn&&Vn.box&&Vn.box.length)break}else Vn=Ii()};if(O.get("text-variable-anchor")){let Ii=O.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[wt.crossTileID]){const So=this.prevPlacement.variableOffsets[wt.crossTileID];Ii.indexOf(So.anchor)>0&&(Ii=Ii.filter(Mu=>Mu!==So.anchor),Ii.unshift(So.anchor))}const Us=(So,Mu,jc)=>{const rl=M.getSymbolInstanceTextSize(be,wt,this.transform.zoom,en),Qa=(So.x2-So.x1)*rl+2*So.padding,ph=(So.y2-So.y1)*rl+2*So.padding,Gc=it&&!Ye?Mu:null;Gc&&Ro(Gc);let ua={box:[],offscreen:!1,occluded:!1};const eu=Se?2*Ii.length:Ii.length;for(let $c=0;$c<eu;++$c){const il=this.attemptAnchorPlacement(Ii[$c%Ii.length],So,Qa,ph,rl,Qe,Ge,Z,B,Ce,$c>=Ii.length,wt,en,M,jc,Gc,be,Re);if(il&&(ua=il.placedGlyphBoxes,ua&&ua.box&&ua.box.length)){Dt=!0,wn=il.shift;break}}return ua};Yo(()=>Us(uo,Jt.iconBox,p.WritingMode.horizontal),()=>{const So=Jt.verticalTextBox;return So&&Ro(So),M.allowVerticalPlacement&&!(Vn&&Vn.box&&Vn.box.length)&&wt.numVerticalGlyphVertices>0&&So?Us(So,Jt.verticalIconBox,p.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Vn&&(Dt=Vn.box,An=Vn.offscreen,_n=Vn.occluded);const Ma=Wo(Vn&&Vn.box);if(!Dt&&this.prevPlacement){const So=this.prevPlacement.variableOffsets[wt.crossTileID];So&&(this.variableOffsets[wt.crossTileID]=So,this.markUsedJustification(M,So.anchor,wt,Ma))}}else{const Ii=(Us,Ma)=>{const So=M.getSymbolInstanceTextSize(be,wt,this.transform.zoom,en),Mu=this.collisionIndex.placeCollisionBox(M,So,Us,new p.pointGeometry(0,0),Se,Z,B,Ce.predicate);return Mu&&Mu.box&&Mu.box.length&&(this.markUsedOrientation(M,Ma,wt),this.placedOrientations[wt.crossTileID]=Ma),Mu};Yo(()=>Ii(uo,p.WritingMode.horizontal),()=>{const Us=Jt.verticalTextBox;return M.allowVerticalPlacement&&wt.numVerticalGlyphVertices>0&&Us?(Ro(Us),Ii(Us,p.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Wo(Vn&&Vn.box&&Vn.box.length)}}if(ir=Vn,Dt=ir&&ir.box&&ir.box.length>0,An=ir&&ir.offscreen,_n=ir&&ir.occluded,wt.useRuntimeCollisionCircles){const Wo=M.text.placedSymbolArray.get(wt.centerJustifiedTextSymbolIndex>=0?wt.centerJustifiedTextSymbolIndex:wt.verticalPlacedTextSymbolIndex),Yo=p.evaluateSizeForFeature(M.textSizeData,be,Wo),Ii=O.get("text-padding");Xn=this.collisionIndex.placeCollisionCircles(M,Se,Wo,M.lineVertexArray,M.glyphOffsetArray,Yo,B,U,$,b,Ge,Ce.predicate,wt.collisionCircleDiameter*Yo/p.ONE_EM,Ii,this.retainedQueryData[M.bucketInstanceId].tileID),Dt=Se||Xn.circles.length>0&&!Xn.collisionDetected,An=An&&Xn.offscreen,_n=Xn.occluded}if(Jt.iconFeatureIndex&&(ao=Jt.iconFeatureIndex),Jt.iconBox){const Wo=Yo=>{Ro(Yo);const Ii=it&&wn?lu(wn.x,wn.y,Qe,Ge,this.transform.angle):new p.pointGeometry(0,0),Us=M.getSymbolInstanceIconSize(Re,this.transform.zoom,wt.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(M,Us,Yo,Ii,Ye,Z,B,Ce.predicate)};mr&&mr.box&&mr.box.length&&Jt.verticalIconBox?(bn=Wo(Jt.verticalIconBox),mt=bn.box.length>0):(bn=Wo(Jt.iconBox),mt=bn.box.length>0),An=An&&bn.offscreen,Cn=bn.occluded}const aa=xe||0===wt.numHorizontalGlyphVertices&&0===wt.numVerticalGlyphVertices,gu=Ne||0===wt.numIconVertices;if(aa||gu?gu?aa||(mt=mt&&Dt):Dt=mt&&Dt:mt=Dt=mt&&Dt,Dt&&ir&&ir.box&&this.collisionIndex.insertCollisionBox(ir.box,O.get("text-ignore-placement"),M.bucketInstanceId,mr&&mr.box&&Fr?Fr:xr,Ce.ID),mt&&bn&&this.collisionIndex.insertCollisionBox(bn.box,O.get("icon-ignore-placement"),M.bucketInstanceId,ao,Ce.ID),Xn&&(Dt&&this.collisionIndex.insertCollisionCircles(Xn.circles,O.get("text-ignore-placement"),M.bucketInstanceId,xr,Ce.ID),b)){const Wo=M.bucketInstanceId;let Yo=this.collisionCircleArrays[Wo];void 0===Yo&&(Yo=this.collisionCircleArrays[Wo]=new Ur);for(let Ii=0;Ii<Xn.circles.length;Ii+=4)Yo.circles.push(Xn.circles[Ii+0]),Yo.circles.push(Xn.circles[Ii+1]),Yo.circles.push(Xn.circles[Ii+2]),Yo.circles.push(Xn.collisionDetected?1:0)}const ya="globe"!==M.projection.name;zt=zt&&(ya||!_n),Pt=Pt&&(ya||!Cn),this.placements[wt.crossTileID]=new ia(Dt||zt,mt||Pt,An||M.justReloaded),g[wt.crossTileID]=!0};if(St){const wt=M.getSortedSymbolIndexes(this.transform.angle);for(let en=wt.length-1;en>=0;--en){const Jt=wt[en];dn(M.symbolInstances.get(Jt),Jt,M.collisionArrays[Jt])}}else for(let wt=l.symbolInstanceStart;wt<l.symbolInstanceEnd;wt++)dn(M.symbolInstances.get(wt),wt,M.collisionArrays[wt]);if(b&&M.bucketInstanceId in this.collisionCircleArrays){const wt=this.collisionCircleArrays[M.bucketInstanceId];p.invert(wt.invProjMatrix,B),wt.viewportMatrix=this.collisionIndex.getViewportMatrix()}M.justReloaded=!1}markUsedJustification(l,g,b,I){let M;M=I===p.WritingMode.vertical?b.verticalPlacedTextSymbolIndex:{left:b.leftJustifiedTextSymbolIndex,center:b.centerJustifiedTextSymbolIndex,right:b.rightJustifiedTextSymbolIndex}[p.getAnchorJustification(g)];const O=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex,b.verticalPlacedTextSymbolIndex];for(const B of O)B>=0&&(l.text.placedSymbolArray.get(B).crossTileID=M>=0&&B!==M?0:b.crossTileID)}markUsedOrientation(l,g,b){const I=g===p.WritingMode.horizontal||g===p.WritingMode.horizontalOnly?g:0,M=g===p.WritingMode.vertical?g:0,O=[b.leftJustifiedTextSymbolIndex,b.centerJustifiedTextSymbolIndex,b.rightJustifiedTextSymbolIndex].filter(B=>-1!==B);for(const B of O)l.text.placedSymbolArray.get(B).placedOrientation=I;-1!==b.verticalPlacedTextSymbolIndex&&(l.text.placedSymbolArray.get(b.verticalPlacedTextSymbolIndex).placedOrientation=M)}commit(l){this.commitTime=l,this.zoomAtLastRecencyCheck=this.transform.zoom;const g=this.prevPlacement;let b=!1;this.prevZoomAdjustment=g?g.zoomAdjustment(this.transform.zoom):0;const I=g?g.symbolFadeChange(l):1,M=g?g.opacities:{},O=g?g.variableOffsets:{},B=g?g.placedOrientations:{};for(const U in this.placements){const $=this.placements[U],q=M[U];q?(this.opacities[U]=new ba(q,I,$.text,$.icon,null,$.clipped),b=b||$.text!==q.text.placed||$.icon!==q.icon.placed):(this.opacities[U]=new ba(null,I,$.text,$.icon,$.skipFade,$.clipped),b=b||$.text||$.icon)}for(const U in M){const $=M[U];if(!this.opacities[U]){const q=new ba($,I,!1,!1);q.isHidden()||(this.opacities[U]=q,b=b||$.text.placed||$.icon.placed)}}for(const U in O)this.variableOffsets[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.variableOffsets[U]=O[U]);for(const U in B)this.placedOrientations[U]||!this.opacities[U]||this.opacities[U].isHidden()||(this.placedOrientations[U]=B[U]);b?this.lastPlacementChangeTime=l:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=g?g.lastPlacementChangeTime:l)}updateLayerOpacities(l,g){const b={};for(const I of g){const M=I.getBucket(l);M&&I.latestFeatureIndex&&l.id===M.layerIds[0]&&this.updateBucketOpacities(M,b,I.collisionBoxArray)}}updateBucketOpacities(l,g,b){l.hasTextData()&&l.text.opacityVertexArray.clear(),l.hasIconData()&&l.icon.opacityVertexArray.clear(),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexArray.clear(),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexArray.clear();const I=l.layers[0].layout,M=!!l.layers[0].dynamicFilter(),O=new ba(null,0,!1,!1,!0),B=I.get("text-allow-overlap"),U=I.get("icon-allow-overlap"),$=I.get("text-variable-anchor"),q="map"===I.get("text-rotation-alignment"),Z="map"===I.get("text-pitch-alignment"),ge="none"!==I.get("icon-text-fit"),De=new ba(null,0,B&&(U||!l.hasIconData()||I.get("icon-optional")),U&&(B||!l.hasTextData()||I.get("text-optional")),!0);!l.collisionArrays&&b&&(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData())&&l.deserializeCollisionBoxes(b);const be=(Ce,xe,Ne)=>{for(let Se=0;Se<xe/4;Se++)Ce.opacityVertexArray.emplaceBack(Ne)};let Re=0;for(let Ce=0;Ce<l.symbolInstances.length;Ce++){const xe=l.symbolInstances.get(Ce),{numHorizontalGlyphVertices:Ne,numVerticalGlyphVertices:Se,crossTileID:Ye}=xe;let Qe=this.opacities[Ye];g[Ye]?Qe=O:Qe||(Qe=De,this.opacities[Ye]=Qe),g[Ye]=!0;const Ge=Ne>0||Se>0,it=xe.numIconVertices>0,St=this.placedOrientations[xe.crossTileID],zt=St===p.WritingMode.vertical,Pt=St===p.WritingMode.horizontal||St===p.WritingMode.horizontalOnly;if(!Ge&&!it||Qe.isHidden()||Re++,Ge){const dn=kn(Qe.text);be(l.text,Ne,zt?ws:dn),be(l.text,Se,Pt?ws:dn);const wt=Qe.text.isHidden();[xe.rightJustifiedTextSymbolIndex,xe.centerJustifiedTextSymbolIndex,xe.leftJustifiedTextSymbolIndex].forEach(Dt=>{Dt>=0&&(l.text.placedSymbolArray.get(Dt).hidden=wt||zt?1:0)}),xe.verticalPlacedTextSymbolIndex>=0&&(l.text.placedSymbolArray.get(xe.verticalPlacedTextSymbolIndex).hidden=wt||Pt?1:0);const en=this.variableOffsets[xe.crossTileID];en&&this.markUsedJustification(l,en.anchor,xe,St);const Jt=this.placedOrientations[xe.crossTileID];Jt&&(this.markUsedJustification(l,"left",xe,Jt),this.markUsedOrientation(l,Jt,xe))}if(it){const dn=kn(Qe.icon);xe.placedIconSymbolIndex>=0&&(be(l.icon,xe.numIconVertices,zt?ws:dn),l.icon.placedSymbolArray.get(xe.placedIconSymbolIndex).hidden=Qe.icon.isHidden()),xe.verticalPlacedIconSymbolIndex>=0&&(be(l.icon,xe.numVerticalIconVertices,Pt?ws:dn),l.icon.placedSymbolArray.get(xe.verticalPlacedIconSymbolIndex).hidden=Qe.icon.isHidden())}if(l.hasIconCollisionBoxData()||l.hasTextCollisionBoxData()){const dn=l.collisionArrays[Ce];if(dn){let wt=new p.pointGeometry(0,0),en=!0;if(dn.textBox||dn.verticalTextBox){if($){const Dt=this.variableOffsets[Ye];Dt?(wt=hi(Dt.anchor,Dt.width,Dt.height,Dt.textOffset,Dt.textScale),q&&wt._rotate(Z?this.transform.angle:-this.transform.angle)):en=!1}M&&(en=!Qe.clipped),dn.textBox&&Rs(l.textCollisionBox.collisionVertexArray,Qe.text.placed,!en||zt,wt.x,wt.y),dn.verticalTextBox&&Rs(l.textCollisionBox.collisionVertexArray,Qe.text.placed,!en||Pt,wt.x,wt.y)}const Jt=en&&Boolean(!Pt&&dn.verticalIconBox);dn.iconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Qe.icon.placed,Jt,ge?wt.x:0,ge?wt.y:0),dn.verticalIconBox&&Rs(l.iconCollisionBox.collisionVertexArray,Qe.icon.placed,!Jt,ge?wt.x:0,ge?wt.y:0)}}}if(l.fullyClipped=0===Re,l.sortFeatures(this.transform.angle),this.retainedQueryData[l.bucketInstanceId]&&(this.retainedQueryData[l.bucketInstanceId].featureSortOrder=l.featureSortOrder),l.hasTextData()&&l.text.opacityVertexBuffer&&l.text.opacityVertexBuffer.updateData(l.text.opacityVertexArray),l.hasIconData()&&l.icon.opacityVertexBuffer&&l.icon.opacityVertexBuffer.updateData(l.icon.opacityVertexArray),l.hasIconCollisionBoxData()&&l.iconCollisionBox.collisionVertexBuffer&&l.iconCollisionBox.collisionVertexBuffer.updateData(l.iconCollisionBox.collisionVertexArray),l.hasTextCollisionBoxData()&&l.textCollisionBox.collisionVertexBuffer&&l.textCollisionBox.collisionVertexBuffer.updateData(l.textCollisionBox.collisionVertexArray),l.bucketInstanceId in this.collisionCircleArrays){const Ce=this.collisionCircleArrays[l.bucketInstanceId];l.placementInvProjMatrix=Ce.invProjMatrix,l.placementViewportMatrix=Ce.viewportMatrix,l.collisionCircleArray=Ce.circles,delete this.collisionCircleArrays[l.bucketInstanceId]}}symbolFadeChange(l){return 0===this.fadeDuration?1:(l-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(l){return Math.max(0,(this.transform.zoom-l)/1.5)}hasTransitions(l){return this.stale||l-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(l,g){const b=this.zoomAtLastRecencyCheck===g?1-this.zoomAdjustment(g):1;return this.zoomAtLastRecencyCheck=g,this.commitTime+this.fadeDuration*b>l}setStale(){this.stale=!0}}function Rs(v,l,g,b,I){v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0),v.emplaceBack(l?1:0,g?1:0,b||0,I||0)}const ms=Math.pow(2,25),Fa=Math.pow(2,24),Vr=Math.pow(2,17),li=Math.pow(2,16),Ci=Math.pow(2,9),jh=Math.pow(2,8),fc=Math.pow(2,1);function kn(v){if(0===v.opacity&&!v.placed)return 0;if(1===v.opacity&&v.placed)return 4294967295;const l=v.placed?1:0,g=Math.floor(127*v.opacity);return g*ms+l*Fa+g*Vr+l*li+g*Ci+l*jh+g*fc+l}const ws=0;class Ea{constructor(l){this._sortAcrossTiles="viewport-y"!==l.layout.get("symbol-z-order")&&void 0!==l.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(l,g,b,I,M){const O=this._bucketParts;for(;this._currentTileIndex<l.length;)if(g.getBucketParts(O,I,l[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,O.sort((B,U)=>B.sortKey-U.sortKey));this._currentPartIndex<O.length;){const B=O[this._currentPartIndex];if(g.placeLayerBucketPart(B,this._seenCrossTileIDs,b,0===B.symbolInstanceStart),this._currentPartIndex++,M())return!0}return!1}}class Ca{constructor(l,g,b,I,M,O,B,U){this.placement=new ad(l,M,O,B,U),this._currentPlacementIndex=g.length-1,this._forceFullPlacement=b,this._showCollisionBoxes=I,this._done=!1}isDone(){return this._done}continuePlacement(l,g,b){const I=p.exported.now(),M=()=>{const O=p.exported.now()-I;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=g[l[this._currentPlacementIndex]],B=this.placement.collisionIndex.transform.zoom;if("symbol"===O.type&&(!O.minzoom||O.minzoom<=B)&&(!O.maxzoom||O.maxzoom>B)){if(this._inProgressLayer||(this._inProgressLayer=new Ea(O)),this._inProgressLayer.continuePlacement(b[O.source],this.placement,this._showCollisionBoxes,O,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(l){return this.placement.commit(l),this.placement}}const Su=512/p.EXTENT/2;class za{constructor(l,g,b){this.tileID=l,this.indexedSymbolInstances={},this.bucketInstanceId=b;for(let I=0;I<g.length;I++){const M=g.get(I),O=M.key;this.indexedSymbolInstances[O]||(this.indexedSymbolInstances[O]=[]),this.indexedSymbolInstances[O].push({crossTileID:M.crossTileID,coord:this.getScaledCoordinates(M,l)})}}getScaledCoordinates(l,g){const b=Su/Math.pow(2,g.canonical.z-this.tileID.canonical.z);return{x:Math.floor((g.canonical.x*p.EXTENT+l.tileAnchorX)*b),y:Math.floor((g.canonical.y*p.EXTENT+l.tileAnchorY)*b)}}findMatches(l,g,b){const I=this.tileID.canonical.z<g.canonical.z?1:Math.pow(2,this.tileID.canonical.z-g.canonical.z);for(let M=0;M<l.length;M++){const O=l.get(M);if(O.crossTileID)continue;const B=this.indexedSymbolInstances[O.key];if(!B)continue;const U=this.getScaledCoordinates(O,g);for(const $ of B)if(Math.abs($.coord.x-U.x)<=I&&Math.abs($.coord.y-U.y)<=I&&!b[$.crossTileID]){b[$.crossTileID]=!0,O.crossTileID=$.crossTileID;break}}}}class dc{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class cs{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(l){const g=Math.round((l-this.lng)/360);if(0!==g)for(const b in this.indexes){const I=this.indexes[b],M={};for(const O in I){const B=I[O];B.tileID=B.tileID.unwrapTo(B.tileID.wrap+g),M[B.tileID.key]=B}this.indexes[b]=M}this.lng=l}addBucket(l,g,b){if(this.indexes[l.overscaledZ]&&this.indexes[l.overscaledZ][l.key]){if(this.indexes[l.overscaledZ][l.key].bucketInstanceId===g.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(l.overscaledZ,this.indexes[l.overscaledZ][l.key])}for(let M=0;M<g.symbolInstances.length;M++)g.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[l.overscaledZ]||(this.usedCrossTileIDs[l.overscaledZ]={});const I=this.usedCrossTileIDs[l.overscaledZ];for(const M in this.indexes){const O=this.indexes[M];if(Number(M)>l.overscaledZ)for(const B in O){const U=O[B];U.tileID.isChildOf(l)&&U.findMatches(g.symbolInstances,l,I)}else{const B=O[l.scaledTo(Number(M)).key];B&&B.findMatches(g.symbolInstances,l,I)}}for(let M=0;M<g.symbolInstances.length;M++){const O=g.symbolInstances.get(M);O.crossTileID||(O.crossTileID=b.generate(),I[O.crossTileID]=!0)}return void 0===this.indexes[l.overscaledZ]&&(this.indexes[l.overscaledZ]={}),this.indexes[l.overscaledZ][l.key]=new za(l,g.symbolInstances,g.bucketInstanceId),!0}removeBucketCrossTileIDs(l,g){for(const b in g.indexedSymbolInstances)for(const I of g.indexedSymbolInstances[b])delete this.usedCrossTileIDs[l][I.crossTileID]}removeStaleBuckets(l){let g=!1;for(const b in this.indexes){const I=this.indexes[b];for(const M in I)l[I[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(b,I[M]),delete I[M],g=!0)}return g}}class ml{constructor(){this.layerIndexes={},this.crossTileIDs=new dc,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(l,g,b,I){let M=this.layerIndexes[l.id];void 0===M&&(M=this.layerIndexes[l.id]=new cs);let O=!1;const B={};"globe"!==I.name&&M.handleWrapJump(b);for(const U of g){const $=U.getBucket(l);$&&l.id===$.layerIds[0]&&($.bucketInstanceId||($.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(U.tileID,$,this.crossTileIDs)&&(O=!0),B[$.bucketInstanceId]=!0)}return M.removeStaleBuckets(B)&&(O=!0),O}pruneUnusedLayers(l){const g={};l.forEach(b=>{g[b]=!0});for(const b in this.layerIndexes)g[b]||delete this.layerIndexes[b]}}const $o=(v,l)=>p.emitValidationErrors(v,l&&l.filter(g=>"source.canvas"!==g.identifier)),bo=p.pick(Nn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Eo=p.pick(Nn,["setCenter","setZoom","setBearing","setPitch"]),Bc={version:8,layers:[],sources:{}},wr={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class da extends p.Evented{constructor(l,g={}){super(),this.map=l,this.dispatcher=new Ae(or(),this),this.imageManager=new J,this.imageManager.setEventedParent(this),this.glyphManager=new p.GlyphManager(l._requestManager,g.localFontFamily?p.LocalGlyphMode.all:g.localIdeographFontFamily?p.LocalGlyphMode.ideographs:p.LocalGlyphMode.none,g.localFontFamily||g.localIdeographFontFamily),this.crossTileSymbolIndex=new ml,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new p.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",p.getReferrer());const b=this;this._rtlTextPluginCallback=da.registerForPluginStateChange(I=>{b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:I.pluginStatus,pluginURL:I.pluginURL},(M,O)=>{if(p.triggerPluginCompletionEvent(M),O&&O.every(B=>B))for(const B in b._sourceCaches){const U=b._sourceCaches[B],$=U.getSource().type;"vector"!==$&&"geojson"!==$||U.reload()}})}),this.on("data",I=>{if("source"!==I.dataType||"metadata"!==I.sourceDataType)return;const M=this.getSource(I.sourceId);if(M&&M.vectorLayerIds)for(const O in this._layers){const B=this._layers[O];B.source===M.id&&this._validateLayer(B)}})}loadURL(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"}));const b="boolean"==typeof g.validate?g.validate:!p.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,g.accessToken);const I=this.map._requestManager.transformRequest(l,p.ResourceType.Style);this._request=p.getJSON(I,(M,O)=>{this._request=null,M?this.fire(new p.ErrorEvent(M)):O&&this._load(O,b)})}loadJSON(l,g={}){this.fire(new p.Event("dataloading",{dataType:"style"})),this._request=p.exported.frame(()=>{this._request=null,this._load(l,!1!==g.validate)})}loadEmpty(){this.fire(new p.Event("dataloading",{dataType:"style"})),this._load(Bc,!1)}_updateLayerCount(l,g){const b=g?1:-1;l.is3D()&&(this._num3DLayers+=b),"circle"===l.type&&(this._numCircleLayers+=b),"symbol"===l.type&&(this._numSymbolLayers+=b)}_load(l,g){if(g&&$o(this,p.validateStyle(l)))return;this._loaded=!0,this.stylesheet=p.clone$1(l),this._updateMapProjection();for(const I in l.sources)this.addSource(I,l.sources[I],{validate:!1});this._changed=!1,l.sprite?this._loadSprite(l.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(l.glyphs);const b=ci(this.stylesheet.layers);this._order=b.map(I=>I.id),this._layers={},this._serializedLayers={};for(let I of b)I=p.createStyleLayer(I),I.setEventedParent(this,{layer:{id:I.id}}),this._layers[I.id]=I,this._serializedLayers[I.id]=I.serialize(),this._updateLayerCount(I,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new qe(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new p.Event("data",{dataType:"style"})),this.fire(new p.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(l){l?this.stylesheet.projection=l:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(l){this._spriteRequest=function(g,b,I){let M,O,B;const U=p.exported.devicePixelRatio>1?"@2x":"";let $=p.getJSON(b.transformRequest(b.normalizeSpriteURL(g,U,".json"),p.ResourceType.SpriteJSON),(ge,De)=>{$=null,B||(B=ge,M=De,Z())}),q=p.getImage(b.transformRequest(b.normalizeSpriteURL(g,U,".png"),p.ResourceType.SpriteImage),(ge,De)=>{q=null,B||(B=ge,O=De,Z())});function Z(){if(B)I(B);else if(M&&O){const ge=p.exported.getImageData(O),De={};for(const be in M){const{width:Re,height:Ce,x:xe,y:Ne,sdf:Se,pixelRatio:Ye,stretchX:Qe,stretchY:Ge,content:it}=M[be],St=new p.RGBAImage({width:Re,height:Ce});p.RGBAImage.copy(ge,St,{x:xe,y:Ne},{x:0,y:0},{width:Re,height:Ce}),De[be]={data:St,pixelRatio:Ye,sdf:Se,stretchX:Qe,stretchY:Ge,content:it}}I(null,De)}}return{cancel(){$&&($.cancel(),$=null),q&&(q.cancel(),q=null)}}}(l,this.map._requestManager,(g,b)=>{if(this._spriteRequest=null,g)this.fire(new p.ErrorEvent(g));else if(b)for(const I in b)this.imageManager.addImage(I,b[I]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new p.Event("data",{dataType:"style"}))})}_validateLayer(l){const g=this.getSource(l.source);if(!g)return;const b=l.sourceLayer;b&&("geojson"===g.type||g.vectorLayerIds&&-1===g.vectorLayerIds.indexOf(b))&&this.fire(new p.ErrorEvent(new Error(`Source layer "${b}" does not exist on source "${g.id}" as specified by style layer "${l.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const l in this._sourceCaches)if(!this._sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(l){const g=[];for(const b of l){const I=this._layers[b];"custom"!==I.type&&g.push(I.serialize())}return g}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const l in this._sourceCaches)if(this._sourceCaches[l].hasTransition())return!0;for(const l in this._layers)if(this._layers[l].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(l){return!!this.terrain&&wr[l.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(l){if(!this._loaded)return;const g=this._changed;if(this._changed){const I=Object.keys(this._updatedLayers),M=Object.keys(this._removedLayers);(I.length||M.length)&&this._updateWorkerLayers(I,M);for(const O in this._updatedSources){const B=this._updatedSources[O];"reload"===B?this._reloadSource(O):"clear"===B&&this._clearSource(O)}this._updateTilesForChangedImages();for(const O in this._updatedPaintProps)this._layers[O].updateTransitions(l);this.light.updateTransitions(l),this.fog&&this.fog.updateTransitions(l),this._resetUpdates()}const b={};for(const I in this._sourceCaches){const M=this._sourceCaches[I];b[I]=M.used,M.used=!1}for(const I of this._order){const M=this._layers[I];if(M.recalculate(l,this._availableImages),!M.isHidden(l.zoom)){const B=this._getLayerSourceCache(M);B&&(B.used=!0)}const O=this.map.painter;if(O){const B=M.getProgramIds();if(!B)continue;const U=M.getProgramConfiguration(l.zoom);for(const $ of B)O.useProgram($,U)}}for(const I in b){const M=this._sourceCaches[I];b[I]!==M.used&&M.getSource().fire(new p.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light.recalculate(l),this.terrain&&this.terrain.recalculate(l),this.fog&&this.fog.recalculate(l),this.z=l.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),g&&this.fire(new p.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const l=Object.keys(this._changedImages);if(l.length){for(const g in this._sourceCaches)this._sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}}_updateWorkerLayers(l,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:g})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(l){if(this._checkLoaded(),$o(this,p.validateStyle(l)))return!1;(l=p.clone$1(l)).layers=ci(l.layers);const g=function(I,M){if(!I)return[{command:Nn.setStyle,args:[M]}];let O=[];try{if(!ve(I.version,M.version))return[{command:Nn.setStyle,args:[M]}];ve(I.center,M.center)||O.push({command:Nn.setCenter,args:[M.center]}),ve(I.zoom,M.zoom)||O.push({command:Nn.setZoom,args:[M.zoom]}),ve(I.bearing,M.bearing)||O.push({command:Nn.setBearing,args:[M.bearing]}),ve(I.pitch,M.pitch)||O.push({command:Nn.setPitch,args:[M.pitch]}),ve(I.sprite,M.sprite)||O.push({command:Nn.setSprite,args:[M.sprite]}),ve(I.glyphs,M.glyphs)||O.push({command:Nn.setGlyphs,args:[M.glyphs]}),ve(I.transition,M.transition)||O.push({command:Nn.setTransition,args:[M.transition]}),ve(I.light,M.light)||O.push({command:Nn.setLight,args:[M.light]}),ve(I.fog,M.fog)||O.push({command:Nn.setFog,args:[M.fog]}),ve(I.projection,M.projection)||O.push({command:Nn.setProjection,args:[M.projection]});const B={},U=[];!function(Z,ge,De,be){let Re;for(Re in ge=ge||{},Z=Z||{})Z.hasOwnProperty(Re)&&(ge.hasOwnProperty(Re)||_i(Re,De,be));for(Re in ge)ge.hasOwnProperty(Re)&&(Z.hasOwnProperty(Re)?ve(Z[Re],ge[Re])||("geojson"===Z[Re].type&&"geojson"===ge[Re].type&&fa(Z,ge,Re)?De.push({command:Nn.setGeoJSONSourceData,args:[Re,ge[Re].data]}):ps(Re,ge,De,be)):dr(Re,ge,De))}(I.sources,M.sources,U,B);const $=[];I.layers&&I.layers.forEach(Z=>{Z.source&&B[Z.source]?O.push({command:Nn.removeLayer,args:[Z.id]}):$.push(Z)});let q=I.terrain;q&&B[q.source]&&(O.push({command:Nn.setTerrain,args:[void 0]}),q=void 0),O=O.concat(U),ve(q,M.terrain)||O.push({command:Nn.setTerrain,args:[M.terrain]}),function(Z,ge,De){ge=ge||[];const be=(Z=Z||[]).map(Na),Re=ge.map(Na),Ce=Z.reduce(go,{}),xe=ge.reduce(go,{}),Ne=be.slice(),Se=Object.create(null);let Ye,Qe,Ge,it,St,zt,Pt;for(Ye=0,Qe=0;Ye<be.length;Ye++)Ge=be[Ye],xe.hasOwnProperty(Ge)?Qe++:(De.push({command:Nn.removeLayer,args:[Ge]}),Ne.splice(Ne.indexOf(Ge,Qe),1));for(Ye=0,Qe=0;Ye<Re.length;Ye++)Ge=Re[Re.length-1-Ye],Ne[Ne.length-1-Ye]!==Ge&&(Ce.hasOwnProperty(Ge)?(De.push({command:Nn.removeLayer,args:[Ge]}),Ne.splice(Ne.lastIndexOf(Ge,Ne.length-Qe),1)):Qe++,zt=Ne[Ne.length-Ye],De.push({command:Nn.addLayer,args:[xe[Ge],zt]}),Ne.splice(Ne.length-Ye,0,Ge),Se[Ge]=!0);for(Ye=0;Ye<Re.length;Ye++)if(Ge=Re[Ye],it=Ce[Ge],St=xe[Ge],!Se[Ge]&&!ve(it,St))if(ve(it.source,St.source)&&ve(it["source-layer"],St["source-layer"])&&ve(it.type,St.type)){for(Pt in Rt(it.layout,St.layout,De,Ge,null,Nn.setLayoutProperty),Rt(it.paint,St.paint,De,Ge,null,Nn.setPaintProperty),ve(it.filter,St.filter)||De.push({command:Nn.setFilter,args:[Ge,St.filter]}),ve(it.minzoom,St.minzoom)&&ve(it.maxzoom,St.maxzoom)||De.push({command:Nn.setLayerZoomRange,args:[Ge,St.minzoom,St.maxzoom]}),it)it.hasOwnProperty(Pt)&&"layout"!==Pt&&"paint"!==Pt&&"filter"!==Pt&&"metadata"!==Pt&&"minzoom"!==Pt&&"maxzoom"!==Pt&&(0===Pt.indexOf("paint.")?Rt(it[Pt],St[Pt],De,Ge,Pt.slice(6),Nn.setPaintProperty):ve(it[Pt],St[Pt])||De.push({command:Nn.setLayerProperty,args:[Ge,Pt,St[Pt]]}));for(Pt in St)St.hasOwnProperty(Pt)&&!it.hasOwnProperty(Pt)&&"layout"!==Pt&&"paint"!==Pt&&"filter"!==Pt&&"metadata"!==Pt&&"minzoom"!==Pt&&"maxzoom"!==Pt&&(0===Pt.indexOf("paint.")?Rt(it[Pt],St[Pt],De,Ge,Pt.slice(6),Nn.setPaintProperty):ve(it[Pt],St[Pt])||De.push({command:Nn.setLayerProperty,args:[Ge,Pt,St[Pt]]}))}else De.push({command:Nn.removeLayer,args:[Ge]}),zt=Ne[Ne.lastIndexOf(Ge)+1],De.push({command:Nn.addLayer,args:[St,zt]})}($,M.layers,O)}catch(B){console.warn("Unable to compute style diff:",B),O=[{command:Nn.setStyle,args:[M]}]}return O}(this.serialize(),l).filter(I=>!(I.command in Eo));if(0===g.length)return!1;const b=g.filter(I=>!(I.command in bo));if(b.length>0)throw new Error(`Unimplemented: ${b.map(I=>I.command).join(", ")}.`);return g.forEach(I=>{"setTransition"!==I.command&&"setProjection"!==I.command&&this[I.command].apply(this,I.args)}),this.stylesheet=l,this._updateMapProjection(),!0}addImage(l,g){return this.getImage(l)?this.fire(new p.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(l,g),this._afterImageUpdated(l),this)}updateImage(l,g){this.imageManager.updateImage(l,g)}getImage(l){return this.imageManager.getImage(l)}removeImage(l){return this.getImage(l)?(this.imageManager.removeImage(l),this._afterImageUpdated(l),this):this.fire(new p.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new p.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(l,g,b={}){if(this._checkLoaded(),void 0!==this.getSource(l))throw new Error("There is already a source with this ID");if(!g.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(g).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(p.validateSource,`sources.${l}`,g,null,b))return;this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);const I=yt(l,g,this.dispatcher,this);I.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(l),source:I.serialize(),sourceId:l}));const M=O=>{const B=(O?"symbol:":"other:")+l,U=this._sourceCaches[B]=new p.SourceCache(B,I,O);(O?this._symbolSourceCaches:this._otherSourceCaches)[l]=U,U.style=this,U.onAdd(this.map)};M(!1),"vector"!==g.type&&"geojson"!==g.type||M(!0),I.onAdd&&I.onAdd(this.map),this._changed=!0}removeSource(l){this._checkLoaded();const g=this.getSource(l);if(!g)throw new Error("There is no source with this ID");for(const I in this._layers)if(this._layers[I].source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while layer "${I}" is using it.`)));if(this.terrain&&this.terrain.get().source===l)return this.fire(new p.ErrorEvent(new Error(`Source "${l}" cannot be removed while terrain is using it.`)));const b=this._getSourceCaches(l);for(const I of b)delete this._sourceCaches[I.id],delete this._updatedSources[I.id],I.fire(new p.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:I.getSource().id})),I.setEventedParent(null),I.clearTiles();return delete this._otherSourceCaches[l],delete this._symbolSourceCaches[l],g.setEventedParent(null),g.onRemove&&g.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(l,g){this._checkLoaded(),this.getSource(l).setData(g),this._changed=!0}getSource(l){const g=this._getSourceCache(l);return g&&g.getSource()}_getSources(){const l=[];for(const g in this._otherSourceCaches){const b=this._getSourceCache(g);b&&l.push(b.getSource())}return l}addLayer(l,g,b={}){this._checkLoaded();const I=l.id;if(this.getLayer(I))return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${I}" already exists on this map`)));let M;if("custom"===l.type){if($o(this,p.validateCustomStyleLayer(l)))return;M=p.createStyleLayer(l)}else{if("object"==typeof l.source&&(this.addSource(I,l.source),l=p.clone$1(l),l=p.extend(l,{source:I})),this._validate(p.validateLayer,`layers.${I}`,l,{arrayIndex:-1},b))return;M=p.createStyleLayer(l),this._validateLayer(M),M.setEventedParent(this,{layer:{id:I}}),this._serializedLayers[M.id]=M.serialize(),this._updateLayerCount(M,!0)}const O=g?this._order.indexOf(g):this._order.length;if(g&&-1===O)return void this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`)));this._order.splice(O,0,I),this._layerOrderChanged=!0,this._layers[I]=M;const B=this._getLayerSourceCache(M);if(this._removedLayers[I]&&M.source&&B&&"custom"!==M.type){const U=this._removedLayers[I];delete this._removedLayers[I],U.type!==M.type?this._updatedSources[M.source]="clear":(this._updatedSources[M.source]="reload",B.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(l,g){if(this._checkLoaded(),this._changed=!0,!this._layers[l])return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be moved.`)));if(l===g)return;const b=this._order.indexOf(l);this._order.splice(b,1);const I=g?this._order.indexOf(g):this._order.length;g&&-1===I?this.fire(new p.ErrorEvent(new Error(`Layer with id "${g}" does not exist on this map.`))):(this._order.splice(I,0,l),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(l){this._checkLoaded();const g=this._layers[l];if(!g)return void this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be removed.`)));g.setEventedParent(null),this._updateLayerCount(g,!1);const b=this._order.indexOf(l);this._order.splice(b,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=g,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],g.onRemove&&g.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(l){return this._layers[l]}hasLayer(l){return l in this._layers}hasLayerType(l){for(const g in this._layers)if(this._layers[g].type===l)return!0;return!1}setLayerZoomRange(l,g,b){this._checkLoaded();const I=this.getLayer(l);I?I.minzoom===g&&I.maxzoom===b||(null!=g&&(I.minzoom=g),null!=b&&(I.maxzoom=b),this._updateLayer(I)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(l,g,b={}){this._checkLoaded();const I=this.getLayer(l);if(I){if(!ve(I.filter,g))return null==g?(I.filter=void 0,void this._updateLayer(I)):void(this._validate(p.validateFilter,`layers.${I.id}.filter`,g,{layerType:I.type},b)||(I.filter=p.clone$1(g),this._updateLayer(I)))}else this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be filtered.`)))}getFilter(l){const g=this.getLayer(l);return g&&p.clone$1(g.filter)}setLayoutProperty(l,g,b,I={}){this._checkLoaded();const M=this.getLayer(l);M?ve(M.getLayoutProperty(g),b)||(M.setLayoutProperty(g,b,I),this._updateLayer(M)):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(l,g){const b=this.getLayer(l);if(b)return b.getLayoutProperty(g);this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style.`)))}setPaintProperty(l,g,b,I={}){this._checkLoaded();const M=this.getLayer(l);M?ve(M.getPaintProperty(g),b)||(M.setPaintProperty(g,b,I)&&this._updateLayer(M),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new p.ErrorEvent(new Error(`The layer '${l}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(l,g){const b=this.getLayer(l);return b&&b.getPaintProperty(g)}setFeatureState(l,g){this._checkLoaded();const b=l.source,I=l.sourceLayer,M=this.getSource(b);if(!M)return void this.fire(new p.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const O=M.type;if("geojson"===O&&I)return void this.fire(new p.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===O&&!I)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided.")));const B=this._getSourceCaches(b);for(const U of B)U.setFeatureState(I,l.id,g)}removeFeatureState(l,g){this._checkLoaded();const b=l.source,I=this.getSource(b);if(!I)return void this.fire(new p.ErrorEvent(new Error(`The source '${b}' does not exist in the map's style.`)));const M=I.type,O="vector"===M?l.sourceLayer:void 0;if("vector"===M&&!O)return void this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(g&&"string"!=typeof l.id&&"number"!=typeof l.id)return void this.fire(new p.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const B=this._getSourceCaches(b);for(const U of B)U.removeFeatureState(O,l.id,g)}getFeatureState(l){this._checkLoaded();const g=l.source,b=l.sourceLayer,I=this.getSource(g);if(I){if("vector"!==I.type||b)return void 0===l.id&&this.fire(new p.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(g)[0].getFeatureState(b,l.id);this.fire(new p.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new p.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)))}getTransition(){return p.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const l={};for(const g in this._sourceCaches){const b=this._sourceCaches[g].getSource();l[b.id]||(l[b.id]=b.serialize())}return p.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:l,layers:this._serializeLayers(this._order)},g=>void 0!==g)}_updateLayer(l){this._updatedLayers[l.id]=!0;const g=this._getLayerSourceCache(l);l.source&&!this._updatedSources[l.source]&&g&&"raster"!==g.getSource().type&&(this._updatedSources[l.source]="reload",g.pause()),this._changed=!0,l.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(l){const g=O=>"fill-extrusion"===this._layers[O].type,b={},I=[];for(let O=this._order.length-1;O>=0;O--){const B=this._order[O];if(g(B)){b[B]=O;for(const U of l){const $=U[B];if($)for(const q of $)I.push(q)}}}I.sort((O,B)=>B.intersectionZ-O.intersectionZ);const M=[];for(let O=this._order.length-1;O>=0;O--){const B=this._order[O];if(g(B))for(let U=I.length-1;U>=0;U--){const $=I[U].feature;if(b[$.layer.id]<O)break;M.push($),I.pop()}else for(const U of l){const $=U[B];if($)for(const q of $)M.push(q.feature)}}return M}queryRenderedFeatures(l,g,b){g&&g.filter&&this._validate(p.validateFilter,"queryRenderedFeatures.filter",g.filter,null,g);const I={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new p.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const U of g.layers){const $=this._layers[U];if(!$)return this.fire(new p.ErrorEvent(new Error(`The layer '${U}' does not exist in the map's style and cannot be queried for features.`))),[];I[$.source]=!0}}const M=[];g.availableImages=this._availableImages;const O=g&&g.layers?g.layers.some(U=>{const $=this.getLayer(U);return $&&$.is3D()}):this.has3DLayers(),B=Nt.createFromScreenPoints(l,b);for(const U in this._sourceCaches){const $=this._sourceCaches[U].getSource().id;g.layers&&!I[$]||M.push(st(this._sourceCaches[U],this._layers,this._serializedLayers,B,g,b,O,!!this.map._showQueryGeometry))}return this.placement&&M.push(function(U,$,q,Z,ge,De,be){const Re={},Ce=De.queryRenderedSymbols(Z),xe=[];for(const Ne of Object.keys(Ce).map(Number))xe.push(be[Ne]);xe.sort(yn);for(const Ne of xe){const Se=Ne.featureIndex.lookupSymbolFeatures(Ce[Ne.bucketInstanceId],$,Ne.bucketIndex,Ne.sourceLayerIndex,ge.filter,ge.layers,ge.availableImages,U);for(const Ye in Se){const Qe=Re[Ye]=Re[Ye]||[],Ge=Se[Ye];Ge.sort((it,St)=>{const zt=Ne.featureSortOrder;if(zt){const Pt=zt.indexOf(it.featureIndex);return zt.indexOf(St.featureIndex)-Pt}return St.featureIndex-it.featureIndex});for(const it of Ge)Qe.push(it)}}for(const Ne in Re)Re[Ne].forEach(Se=>{const Ye=Se.feature,Qe=q(U[Ne]).getFeatureState(Ye.layer["source-layer"],Ye.id);Ye.source=Ye.layer.source,Ye.layer["source-layer"]&&(Ye.sourceLayer=Ye.layer["source-layer"]),Ye.state=Qe});return Re}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),B.screenGeometry,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(M)}querySourceFeatures(l,g){g&&g.filter&&this._validate(p.validateFilter,"querySourceFeatures.filter",g.filter,null,g);const b=this._getSourceCaches(l);let I=[];for(const M of b)I=I.concat(Xt(M,g));return I}addSourceType(l,g,b){return da.getSourceType(l)?b(new Error(`A source type called "${l}" already exists.`)):(da.setSourceType(l,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:g.workerSourceURL},b):b(null,null))}getLight(){return this.light.getLight()}setLight(l,g={}){this._checkLoaded();const b=this.light.getLight();let I=!1;for(const O in l)if(!ve(l[O],b[O])){I=!0;break}if(!I)return;const M=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(l,g),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(l,g=1){if(this._checkLoaded(),!l)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===g){if("object"==typeof l.source){const b="terrain-dem-src";this.addSource(b,l.source),l=p.clone$1(l),l=p.extend(l,{source:b})}if(this._validate(p.validateTerrain,"terrain",l))return}if(!this.terrain||this.terrain&&g!==this.terrain.drapeRenderMode)this._createTerrain(l,g);else{const b=this.terrain,I=b.get();for(const M of Object.keys(p.spec.terrain))!l.hasOwnProperty(M)&&p.spec.terrain[M].default&&(l[M]=p.spec.terrain[M].default);for(const M in l)if(!ve(l[M],I[M])){b.set(l),this.stylesheet.terrain=l;const O=this._setTransitionParameters({duration:0});b.updateTransitions(O);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(l){const g=this.fog=new dt(l,this.map.transform);this.stylesheet.fog=l;const b=this._setTransitionParameters({duration:0});g.updateTransitions(b)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const l of this.map._markers)l._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(l){if(this._checkLoaded(),!l)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const g=this.fog,b=g.get();0===Object.keys(l).length&&g.set(l);for(const I in l)if(!ve(l[I],b[I])){g.set(l),this.stylesheet.fog=l;const M=this._setTransitionParameters({duration:0});g.updateTransitions(M);break}}else this._createFog(l);this._markersNeedUpdate=!0}_setTransitionParameters(l){return{now:p.exported.now(),transition:p.extend(l,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const l=this._order.filter(b=>this.isLayerDraped(this._layers[b])),g=this._order.filter(b=>!this.isLayerDraped(this._layers[b]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...l),this._drapedFirstOrder.push(...g)}_createTerrain(l,g){const b=this.terrain=new At(l,g);this.stylesheet.terrain=l,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const I=this._setTransitionParameters({duration:0});b.updateTransitions(I)}_force3DLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"fill-extrusion"===g.type&&this._updateLayer(g)}}_forceSymbolLayerUpdate(){for(const l in this._layers){const g=this._layers[l];"symbol"===g.type&&this._updateLayer(g)}}_validate(l,g,b,I,M={}){return(!M||!1!==M.validate)&&$o(this,l.call(p.validateStyle,p.extend({key:g,style:this.serialize(),value:b,styleSpec:p.spec},I)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),p.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const l in this._layers)this._layers[l].setEventedParent(null);for(const l in this._sourceCaches)this._sourceCaches[l].clearTiles(),this._sourceCaches[l].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(l){const g=this._getSourceCaches(l);for(const b of g)b.clearTiles()}_reloadSource(l){const g=this._getSourceCaches(l);for(const b of g)b.resume(),b.reload()}_reloadSources(){for(const l of this._getSources())l.reload&&l.reload()}_updateSources(l){for(const g in this._sourceCaches)this._sourceCaches[g].update(l)}_generateCollisionBoxes(){for(const l in this._sourceCaches){const g=this._sourceCaches[l];g.resume(),g.reload()}}_updatePlacement(l,g,b,I,M=!1){let O=!1,B=!1;const U={};for(const $ of this._order){const q=this._layers[$];if("symbol"!==q.type)continue;if(!U[q.source]){const ge=this._getLayerSourceCache(q);if(!ge)continue;U[q.source]=ge.getRenderableIds(!0).map(De=>ge.getTileByID(De)).sort((De,be)=>be.tileID.overscaledZ-De.tileID.overscaledZ||(De.tileID.isLessThan(be.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer(q,U[q.source],l.center.lng,l.projection);O=O||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),M=M||this._layerOrderChanged||0===b,this._layerOrderChanged&&this.fire(new p.Event("neworder")),(M||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(p.exported.now(),l.zoom))&&(this.pauseablePlacement=new Ca(l,this._order,M,g,b,I,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,U),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(p.exported.now()),B=!0),O&&this.pauseablePlacement.placement.setStale()),B||O)for(const $ of this._order){const q=this._layers[$];"symbol"===q.type&&this.placement.updateLayerOpacities(q,U[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(p.exported.now())}_releaseSymbolFadeTiles(){for(const l in this._sourceCaches)this._sourceCaches[l].releaseSymbolFadeTiles()}getImages(l,g,b){this.imageManager.getImages(g.icons,b),this._updateTilesForChangedImages();const I=M=>{M&&M.setDependencies(g.tileID.key,g.type,g.icons)};I(this._otherSourceCaches[g.source]),I(this._symbolSourceCaches[g.source])}getGlyphs(l,g,b){this.glyphManager.getGlyphs(g.stacks,b)}getResource(l,g,b){return p.makeRequest(g,b)}_getSourceCache(l){return this._otherSourceCaches[l]}_getLayerSourceCache(l){return"symbol"===l.type?this._symbolSourceCaches[l.source]:this._otherSourceCaches[l.source]}_getSourceCaches(l){const g=[];return this._otherSourceCaches[l]&&g.push(this._otherSourceCaches[l]),this._symbolSourceCaches[l]&&g.push(this._symbolSourceCaches[l]),g}_isSourceCacheLoaded(l){const g=this._getSourceCaches(l);return 0===g.length?(this.fire(new p.ErrorEvent(new Error(`There is no source with ID '${l}'`))),!1):g.every(b=>b.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}da.getSourceType=function(v){return bt[v]},da.setSourceType=function(v,l){bt[v]=l},da.registerForPluginStateChange=p.registerForPluginStateChange;var Sf="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Sa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Xs="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Ku="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Jr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let jl={},Iu={};const Ju=[];ns(Sf,Ju),ns(Xs,Ju),ns(Ku,Ju),ns(Jr,Ju),jl=jr("",Xs),Iu=jr(Jr,Ku);const mo=jr("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Wn=Sf,Gl="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var pc={background:jr("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:jr("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:jr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:jr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:jr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:jr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:jr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:jr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:jr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:jr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:jr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:jr("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:jr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:jr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);float roof_radiance=clamp(u_lightpos.z,0.0,1.0);roof_radiance=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roof_radiance);v_roof_color.rgb+=clamp(color.rgb*roof_radiance*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:jr("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);directional*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\nv_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:jr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:jr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:jr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:jr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:jr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:jr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:jr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:jr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:jr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:jr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:jr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sa),skyboxGradient:jr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Sa),skyboxCapture:jr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:jr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;\n#ifdef GLOBE_POLES\nvec3 up_vector=normalize(globe_pos)*u_tile_up_scale;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:jr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ns(v,l){const g=v.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let b of g)if(b=b.trim(),"#"===b[0]&&b.includes("if")&&!b.includes("endif")){b=b.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const I=b.split(" ");for(const M of I)l.includes(M)||l.push(M)}}function jr(v,l){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,b=l.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),I={},M=[...Ju];return ns(v,M),ns(l,M),{fragmentSource:v=v.replace(g,(O,B,U,$,q)=>(I[q]=!0,"define"===B?`\n#ifndef HAS_UNIFORM_u_${q}\nvarying ${U} ${$} ${q};\n#else\nuniform ${U} ${$} u_${q};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${q}\n    ${U} ${$} ${q} = u_${q};\n#endif\n`)),vertexSource:l=l.replace(g,(O,B,U,$,q)=>{const Z="float"===$?"vec2":"vec4",ge=q.match(/color/)?"color":Z;return I[q]?"define"===B?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${U} ${Z} a_${q};\nvarying ${U} ${$} ${q};\n#else\nuniform ${U} ${$} u_${q};\n#endif\n`:"vec4"===ge?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = a_${q};\n#else\n    ${U} ${$} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${q} = unpack_mix_${ge}(a_${q}, u_${q}_t);\n#else\n    ${U} ${$} ${q} = u_${q};\n#endif\n`:"define"===B?`\n#ifndef HAS_UNIFORM_u_${q}\nuniform lowp float u_${q}_t;\nattribute ${U} ${Z} a_${q};\n#else\nuniform ${U} ${$} u_${q};\n#endif\n`:"vec4"===ge?`\n#ifndef HAS_UNIFORM_u_${q}\n    ${U} ${$} ${q} = a_${q};\n#else\n    ${U} ${$} ${q} = u_${q};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${q}\n    ${U} ${$} ${q} = unpack_mix_${ge}(a_${q}, u_${q}_t);\n#else\n    ${U} ${$} ${q} = u_${q};\n#endif\n`}),staticAttributes:b,usedDefines:M}}class cu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(l,g,b,I,M,O,B){this.context=l;let U=this.boundPaintVertexBuffers.length!==I.length;for(let q=0;!U&&q<I.length;q++)this.boundPaintVertexBuffers[q]!==I[q]&&(U=!0);let $=this.boundDynamicVertexBuffers.length!==B.length;for(let q=0;!$&&q<B.length;q++)this.boundDynamicVertexBuffers[q]!==B[q]&&($=!0);if(!l.extVertexArrayObject||!this.vao||this.boundProgram!==g||this.boundLayoutVertexBuffer!==b||U||$||this.boundIndexBuffer!==M||this.boundVertexOffset!==O)this.freshBind(g,b,I,M,O,B);else{l.bindVertexArrayOES.set(this.vao);for(const q of B)q&&q.bind();M&&M.dynamicDraw&&M.bind()}}freshBind(l,g,b,I,M,O){let B;const U=l.numAttributes,$=this.context,q=$.gl;if($.extVertexArrayObject)this.vao&&this.destroy(),this.vao=$.extVertexArrayObject.createVertexArrayOES(),$.bindVertexArrayOES.set(this.vao),B=0,this.boundProgram=l,this.boundLayoutVertexBuffer=g,this.boundPaintVertexBuffers=b,this.boundIndexBuffer=I,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=O;else{B=$.currentNumAttributes||0;for(let Z=U;Z<B;Z++)q.disableVertexAttribArray(Z)}g.enableAttributes(q,l),g.bind(),g.setVertexAttribPointers(q,l,M);for(const Z of b)Z.enableAttributes(q,l),Z.bind(),Z.setVertexAttribPointers(q,l,M);for(const Z of O)Z&&(Z.enableAttributes(q,l),Z.bind(),Z.setVertexAttribPointers(q,l,M));I&&I.bind(),$.currentNumAttributes=U}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Tu(v,l){const g=Math.pow(2,l.canonical.z),b=l.canonical.y;return[new p.MercatorCoordinate(0,b/g).toLngLat().lat,new p.MercatorCoordinate(0,(b+1)/g).toLngLat().lat]}function Nu(v,l,g,b,I,M,O){const B=v.context,U=B.gl,$=g.fbo;if(!$)return;v.prepareDrawTile();const q=v.useProgram("hillshade");B.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,$.colorAttachment.get());const Z=((Re,Ce,xe,Ne)=>{const Se=xe.paint.get("hillshade-shadow-color"),Ye=xe.paint.get("hillshade-highlight-color"),Qe=xe.paint.get("hillshade-accent-color");let Ge=xe.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===xe.paint.get("hillshade-illumination-anchor")&&(Ge-=Re.transform.angle);const it=!Re.options.moving;return{u_matrix:Ne||Re.transform.calculateProjMatrix(Ce.tileID.toUnwrapped(),it),u_image:0,u_latrange:Tu(0,Ce.tileID),u_light:[xe.paint.get("hillshade-exaggeration"),Ge],u_shadow:Se,u_highlight:Ye,u_accent:Qe}})(v,g,b,v.terrain?l.projMatrix:null);v.prepareDrawProgram(B,q,l.toUnwrapped());const{tileBoundsBuffer:ge,tileBoundsIndexBuffer:De,tileBoundsSegments:be}=v.getTileBoundsBuffers(g);q.draw(B,U.TRIANGLES,I,M,O,p.CullFaceMode.disabled,Z,b.id,ge,De,be)}function hh(v,l,g){if(!l.needsDEMTextureUpload)return;const b=v.context,I=b.gl;b.pixelStoreUnpackPremultiplyAlpha.set(!1),l.demTexture=l.demTexture||v.getTileTexture(g.stride);const M=g.getPixels();l.demTexture?l.demTexture.update(M,{premultiply:!1}):l.demTexture=new p.Texture(b,M,I.RGBA,{premultiply:!1}),l.needsDEMTextureUpload=!1}function Pn(v,l,g,b,I,M){const O=v.context,B=O.gl;if(!l.dem)return;const U=l.dem;if(O.activeTexture.set(B.TEXTURE1),hh(v,l,U),!l.demTexture)return;l.demTexture.bind(B.NEAREST,B.CLAMP_TO_EDGE);const $=U.dim;O.activeTexture.set(B.TEXTURE0);let q=l.fbo;if(!q){const be=new p.Texture(O,{width:$,height:$,data:null},B.RGBA);be.bind(B.LINEAR,B.CLAMP_TO_EDGE),q=l.fbo=O.createFramebuffer($,$,!0),q.colorAttachment.set(be.texture)}O.bindFramebuffer.set(q.framebuffer),O.viewport.set([0,0,$,$]);const{tileBoundsBuffer:Z,tileBoundsIndexBuffer:ge,tileBoundsSegments:De}=v.getMercatorTileBoundsBuffers();v.useProgram("hillshadePrepare").draw(O,B.TRIANGLES,b,I,M,p.CullFaceMode.disabled,((be,Re)=>{const Ce=Re.stride,xe=p.create();return p.ortho(xe,0,p.EXTENT,-p.EXTENT,0,0,1),p.translate(xe,xe,[0,-p.EXTENT,0]),{u_matrix:xe,u_image:1,u_dimension:[Ce,Ce],u_zoom:be.overscaledZ,u_unpack:Re.unpackVector}})(l.tileID,U),g.id,Z,ge,De),l.needsHillshadePrepare=!1}const Ha=v=>({u_matrix:new p.UniformMatrix4f(v),u_image0:new p.Uniform1i(v),u_skirt_height:new p.Uniform1f(v)}),rr=(v,l)=>({u_matrix:v,u_image0:0,u_skirt_height:l}),ku=(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De)=>({u_proj_matrix:Float32Array.from(v),u_globe_matrix:l,u_normalize_matrix:Float32Array.from(b),u_merc_matrix:g,u_zoom_transition:I,u_merc_center:M,u_image0:0,u_frustum_tl:O,u_frustum_tr:B,u_frustum_br:U,u_frustum_bl:$,u_globe_pos:q,u_globe_radius:Z,u_viewport:ge,u_grid_matrix:De?Float32Array.from(De):new Float32Array(9)});function Is(v,l){return null!=v&&null!=l&&!(!v.hasData()||!l.hasData())&&null!=v.demTexture&&null!=l.demTexture&&v.tileID.key!==l.tileID.key}const hu=new class{constructor(){this.operations={}}newMorphing(v,l,g,b,I){if(v in this.operations){const M=this.operations[v];M.to.tileID.key!==g.tileID.key&&(M.queued=g)}else this.operations[v]={startTime:b,phase:0,duration:I,from:l,to:g,queued:null}}getMorphValuesForProxy(v){if(!(v in this.operations))return null;const l=this.operations[v];return{from:l.from,to:l.to,phase:l.phase}}update(v){for(const l in this.operations){const g=this.operations[l];for(g.phase=(v-g.startTime)/g.duration;g.phase>=1||!this._validOp(g);)if(!this._nextOp(g,v)){delete this.operations[l];break}}}_nextOp(v,l){return!!v.queued&&(v.from=v.to,v.to=v.queued,v.queued=null,v.phase=0,v.startTime=l,!0)}_validOp(v){return v.from.hasData()&&v.to.hasData()}},Gr={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ni(v,l){const g=1<<v.z;return!l&&(0===v.x||v.x===g-1)||0===v.y||v.y===g-1}const Si=v=>({u_matrix:v});function Xa(v,l,g,b,I){if(I>0){const M=p.exported.now(),O=(M-v.timeAdded)/I,B=l?(M-l.timeAdded)/I:-1,U=g.getSource(),$=b.coveringZoomLevel({tileSize:U.tileSize,roundZoom:U.roundZoom}),q=!l||Math.abs(l.tileID.overscaledZ-$)>Math.abs(v.tileID.overscaledZ-$),Z=q&&v.refreshedUponExpiration?1:p.clamp(q?O:1-B,0,1);return v.refreshedUponExpiration&&O>=1&&(v.refreshedUponExpiration=!1),l?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class Mo extends p.SourceCache{constructor(l){const g={type:"raster-dem",maxzoom:l.transform.maxZoom},b=new Ae(or(),null),I=yt("mock-dem",g,b,l.style);super("mock-dem",I,!1),I.setEventedParent(this),this._sourceLoaded=!0}_loadTile(l,g){l.state="loaded",g(null)}}class gc extends p.SourceCache{constructor(l){const g=yt("proxy",{type:"geojson",maxzoom:l.transform.maxZoom},new Ae(or(),null),l.style);super("proxy",g,!1),g.setEventedParent(this),this.map=this.getSource().map=l,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(l,g,b){if(l.freezeTileCoverage)return;this.transform=l;const I=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,O)=>{if(M[O.key]="",!this._tiles[O.key]){const B=new p.Tile(O,this._source.tileSize*O.overscaleFactor(),l.tileZoom);B.state="loaded",this._tiles[O.key]=B}return M},{});for(const M in this._tiles)M in I||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(l){const g=this.proxyCachedFBO[l];if(void 0!==g){const b=Object.values(g);this.renderCachePool.push(...b),delete this.proxyCachedFBO[l]}}deallocRenderCache(){this.renderCache.forEach(l=>l.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Gh extends p.OverscaledTileID{constructor(l,g,b){super(l.overscaledZ,l.wrap,l.canonical.z,l.canonical.x,l.canonical.y),this.proxyTileKey=g,this.projMatrix=b}}class oa extends p.Elevation{constructor(l,g){super(),this.painter=l,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[b,I,M]=function(U){const $=new p.StructArrayLayout4i8,q=new p.StructArrayLayout3ui6,Z=131;$.reserve(17161),q.reserve(33800);const ge=p.EXTENT/128,De=p.EXTENT+ge/2,be=De+ge;for(let Ce=-ge;Ce<be;Ce+=ge)for(let xe=-ge;xe<be;xe+=ge){const Ne=xe<0||xe>De||Ce<0||Ce>De?24575:0,Se=p.clamp(Math.round(xe),0,p.EXTENT),Ye=p.clamp(Math.round(Ce),0,p.EXTENT);$.emplaceBack(Se+Ne,Ye,Se,Ye)}const Re=(Ce,xe)=>{const Ne=xe*Z+Ce;q.emplaceBack(Ne+1,Ne,Ne+Z),q.emplaceBack(Ne+Z,Ne+Z+1,Ne+1)};for(let Ce=1;Ce<129;Ce++)for(let xe=1;xe<129;xe++)Re(xe,Ce);return[0,129].forEach(Ce=>{for(let xe=0;xe<130;xe++)Re(xe,Ce),Re(Ce,xe)}),[$,q,32768]}(),O=l.context;this.gridBuffer=O.createVertexBuffer(b,p.boundsAttributes.members),this.gridIndexBuffer=O.createIndexBuffer(I),this.gridSegments=p.SegmentVector.simpleSegment(0,0,b.length,I.length),this.gridNoSkirtSegments=p.SegmentVector.simpleSegment(0,0,b.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new gc(g.map),this.orthoMatrix=p.create(),p.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,p.EXTENT,0,p.EXTENT,0,1);const B=O.gl;this._overlapStencilMode=new p.StencilMode({func:B.GEQUAL,mask:255},0,255,B.KEEP,B.KEEP,B.REPLACE),this._previousZoom=l.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=g,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Mo(g.map)}set style(l){l.on("data",this._onStyleDataEvent.bind(this)),l.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=l,this._checkRenderCacheEfficiency()}update(l,g,b){if(l&&l.terrain){this._style!==l&&(this.style=l),this.enabled=!0;const I=l.terrain.properties;this.sourceCache=0===l.terrain.drapeRenderMode?this._mockSourceCache:l._getSourceCache(I.get("source")),this._exaggeration=I.get("exaggeration");const M=()=>{this.sourceCache.used&&p.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const O=this.getScaledDemTileSize();this.sourceCache.update(g,O,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,M(),this._initializing=!0),M(),g.updateElevation(!b),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(g),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(l){this._findCoveringTileCache[l]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const l=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==l.efficiency&&p.warnOnce(`Terrain render cache efficiency is not optimal (${l.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${l.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(l){l.coord&&"source"===l.dataType?this._clearRenderCacheForTile(l.sourceCacheId,l.coord):"style"===l.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const l in this._style._sourceCaches)this._style._sourceCaches[l].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(l=>l.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const l=2*this.proxySourceCache.getSource().tileSize;return[l,l]}set useVertexMorphing(l){this._useVertexMorphing=l}updateTileBinding(l){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const g=this.proxySourceCache,b=this.painter.transform;this._initializing&&(this._initializing=0===b._centerAltitude&&-1===this.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(b.center),-1),this._emptyDEMTextureDirty=!this._initializing);const I=this.proxyCoords=g.getIds().map(U=>{const $=g.getTileByID(U).tileID;return $.projMatrix=b.calculateProjMatrix($.toUnwrapped()),$});(function(U,$){const q=$.transform.pointCoordinate($.transform.getCameraPoint()),Z=new p.pointGeometry(q.x,q.y);U.sort((ge,De)=>{if(De.overscaledZ-ge.overscaledZ)return De.overscaledZ-ge.overscaledZ;const be=new p.pointGeometry(ge.canonical.x+(1<<ge.canonical.z)*ge.wrap,ge.canonical.y),Re=new p.pointGeometry(De.canonical.x+(1<<De.canonical.z)*De.wrap,De.canonical.y),Ce=Z.mult(1<<ge.canonical.z);return Ce.x-=.5,Ce.y-=.5,Ce.distSqr(be)-Ce.distSqr(Re)})})(I,this.painter),this._previousZoom=b.zoom;const M=this.proxyToSource||{};this.proxyToSource={},I.forEach(U=>{this.proxyToSource[U.key]={}}),this.terrainTileForTile={};const O=this._style._sourceCaches;for(const U in O){const $=O[U];if(!$.used||($!==this.sourceCache&&this.resetTileLookupCache($.id),this._setupProxiedCoordsForOrtho($,l[U],M),$.usedForTerrain))continue;const q=l[U];$.getSource().reparseOverscaled&&this._assignTerrainTiles(q)}this.proxiedCoords[g.id]=I.map(U=>new Gh(U,U.key,this.orthoMatrix)),this._assignTerrainTiles(I),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1,this._updateTimestamp=p.exported.now();const B={};this._visibleDemTiles=[];for(const U of this.proxyCoords){const $=this.terrainTileForTile[U.key];if(!$)continue;const q=$.tileID.key;q in B||(this._visibleDemTiles.push($),B[q]=q)}}_assignTerrainTiles(l){this._initializing||l.forEach(g=>{if(this.terrainTileForTile[g.key])return;const b=this._findTileCoveringTileID(g,this.sourceCache);b&&(this.terrainTileForTile[g.key]=b)})}_prepareDEMTextures(){const l=this.painter.context,g=l.gl;for(const b in this.terrainTileForTile){const I=this.terrainTileForTile[b],M=I.dem;!M||I.demTexture&&!I.needsDEMTextureUpload||(l.activeTexture.set(g.TEXTURE1),hh(this.painter,I,M))}}_prepareDemTileUniforms(l,g,b,I){if(!g||null==g.demTexture)return!1;const M=l.tileID.canonical,O=Math.pow(2,g.tileID.canonical.z-M.z),B=I||"";return b[`u_dem_tl${B}`]=[M.x*O%1,M.y*O%1],b[`u_dem_scale${B}`]=O,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const l=this.painter.context,g=l.gl;if(!this._emptyDepthBufferTexture){const b=new p.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new p.Texture(l,b,g.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let l=0;const g=this._visibleDemTiles.reduce((b,I)=>{if(!I.dem)return b;const M=I.dem.tree.minimums[0];return M>0&&l++,b+M},0);return l?g/l:0}_updateEmptyDEMTexture(){const l=this.painter.context,g=l.gl;l.activeTexture.set(g.TEXTURE2);const b=this._getLoadedAreaMinimum(),I=new p.RGBAImage({width:1,height:1},new Uint8Array(p.DEMData.pack(b,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(I,{premultiply:!1}):M=this._emptyDEMTexture=new p.Texture(l,I,g.RGBA,{premultiply:!1}),M}setupElevationDraw(l,g,b){const I=this.painter.context,M=I.gl,O=(B=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:p.DEMData.getUnpackVector(B),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var B;O.u_dem_size=this.sourceCache.getSource().tileSize,O.u_exaggeration=this.exaggeration();let U=null,$=null,q=1;if(b&&b.morphing&&this._useVertexMorphing){const Z=b.morphing.srcDemTile,ge=b.morphing.dstDemTile;q=b.morphing.phase,Z&&ge&&(this._prepareDemTileUniforms(l,Z,O,"_prev")&&($=Z),this._prepareDemTileUniforms(l,ge,O)&&(U=ge))}if($&&U?(I.activeTexture.set(M.TEXTURE2),U.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),I.activeTexture.set(M.TEXTURE4),$.demTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE,M.NEAREST),O.u_dem_lerp=q):(U=this.terrainTileForTile[l.tileID.key],I.activeTexture.set(M.TEXTURE2),(this._prepareDemTileUniforms(l,U,O)?U.demTexture:this.emptyDEMTexture).bind(M.NEAREST,M.CLAMP_TO_EDGE)),I.activeTexture.set(M.TEXTURE3),b&&b.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),this._depthFBO&&(O.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),O.u_depth_size_inv=[1,1]),b&&b.useMeterToDem&&U){const Z=(1<<U.tileID.canonical.z)*p.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;O.u_meter_to_dem=Z}if(b&&b.labelPlaneMatrixInv&&(O.u_label_plane_matrix_inv=b.labelPlaneMatrixInv),g.setTerrainUniformValues(I,O),"globe"===this.painter.transform.projection.name){const Z=this.globeUniformValues(this.painter.transform,l.tileID.canonical,b&&b.useDenormalizedUpVectorScale);g.setGlobeUniformValues(I,Z)}}globeUniformValues(l,g,b){const I=l.projection;return{u_tile_tl_up:I.upVector(g,0,0),u_tile_tr_up:I.upVector(g,p.EXTENT,0),u_tile_br_up:I.upVector(g,p.EXTENT,p.EXTENT),u_tile_bl_up:I.upVector(g,0,p.EXTENT),u_tile_up_scale:b?p.GLOBE_METERS_TO_ECEF:I.upVectorScale(g,l.center.lat,l.worldSize).metersToTile}}renderToBackBuffer(l){const g=this.painter,b=this.painter.context;0!==l.length&&(b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),g.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(I,M,O,B,U){if("globe"===I.transform.projection.name)!function($,q,Z,ge,De){const be=$.context,Re=be.gl;let Ce,xe;const Ne=$.options.showTerrainWireframe?2:0,Se=$.transform,Ye=p.globeUseCustomAntiAliasing($,be,Se),Qe=(Dt,mt)=>{if(xe===Dt)return;const An=[Gr[Dt],"PROJECTION_GLOBE_VIEW"];Ye&&An.push("CUSTOM_ANTIALIASING"),mt&&An.push(Gr[Ne]),Ce=$.useProgram("globeRaster",null,An),xe=Dt},Ge=$.colorModeForRenderPass(),it=new p.DepthMode(Re.LEQUAL,p.DepthMode.ReadWrite,$.depthRangeFor3D);hu.update(De);const St=p.calculateGlobeMercatorMatrix(Se),zt=[p.mercatorXfromLng(Se.center.lng),p.mercatorYfromLat(Se.center.lat)],Pt=Ne?[!1,!0]:[!1],dn=$.globeSharedBuffers,wt=[Se.width*p.exported.devicePixelRatio,Se.height*p.exported.devicePixelRatio],en=Float32Array.from(Se.globeMatrix),Jt={useDenormalizedUpVectorScale:!0};if(Pt.forEach(Dt=>{xe=-1;const mt=Dt?Re.LINES:Re.TRIANGLES;for(const An of ge){const _n=Z.getTile(An),Cn=p.StencilMode.disabled,wn=q.prevTerrainTileForTile[An.key],Vn=q.terrainTileForTile[An.key];Is(wn,Vn)&&hu.newMorphing(An.key,wn,Vn,De,250),be.activeTexture.set(Re.TEXTURE0),_n.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE);const mr=hu.getMorphValuesForProxy(An.key),ir=mr?1:0;mr&&p.extend$1(Jt,{morphing:{srcDemTile:mr.from,dstDemTile:mr.to,phase:p.easeCubicInOut(mr.phase)}});const Xn=p.tileCornersToBounds(An.canonical),bn=p.getLatitudinalLod(Xn.getCenter().lat),xr=p.getGridMatrix(An.canonical,Xn,bn,Se.worldSize/Se._pixelsPerMercatorPixel),Fr=p.globeNormalizeECEF(p.globeTileBounds(An.canonical)),ao=ku(Se.projMatrix,en,St,Fr,p.globeToMercatorTransition(Se.zoom),zt,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,wt,xr);if(Qe(ir,Dt),q.setupElevationDraw(_n,Ce,Jt),$.prepareDrawProgram(be,Ce,An.toUnwrapped()),dn){const[Ro,uo,aa]=Dt?dn.getWirefameBuffers($.context,bn):dn.getGridBuffers(bn);Ce.draw(be,mt,it,Cn,Ge,p.CullFaceMode.backCCW,ao,"globe_raster",Ro,uo,aa)}}}),dn){const Dt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Ye&&Dt.push("CUSTOM_ANTIALIASING"),Ce=$.useProgram("globeRaster",null,Dt);for(const mt of ge){const{x:An,y:_n,z:Cn}=mt.canonical,wn=0===_n,Vn=_n===(1<<Cn)-1,[mr,ir,Xn,bn]=dn.getPoleBuffers(Cn);if(bn&&(wn||Vn)){const xr=Z.getTile(mt);be.activeTexture.set(Re.TEXTURE0),xr.texture.bind(Re.LINEAR,Re.CLAMP_TO_EDGE);let Fr=p.globePoleMatrixForTile(Cn,An,Se);const ao=p.globeNormalizeECEF(p.globeTileBounds(mt.canonical)),Ro=(uo,aa)=>uo.draw(be,Re.TRIANGLES,it,p.StencilMode.disabled,Ge,p.CullFaceMode.disabled,ku(Se.projMatrix,Fr,Fr,ao,0,zt,Se.frustumCorners.TL,Se.frustumCorners.TR,Se.frustumCorners.BR,Se.frustumCorners.BL,Se.globeCenterInViewSpace,Se.globeRadius,wt),"globe_pole_raster",aa,Xn,bn);q.setupElevationDraw(xr,Ce,Jt),$.prepareDrawProgram(be,Ce,mt.toUnwrapped()),wn&&Ro(Ce,mr),Vn&&(Fr=p.scale(p.create(),Fr,[1,-1,1]),Ro(Ce,ir))}}}}(I,M,O,B,U);else{const $=I.context,q=$.gl;let Z,ge;const De=I.options.showTerrainWireframe?2:0,be=(Se,Ye)=>{if(ge===Se)return;const Qe=[Gr[Se]];Ye&&Qe.push(Gr[De]),Z=I.useProgram("terrainRaster",null,Qe),ge=Se},Re=I.colorModeForRenderPass(),Ce=new p.DepthMode(q.LEQUAL,p.DepthMode.ReadWrite,I.depthRangeFor3D);hu.update(U);const xe=I.transform,Ne=6*Math.pow(1.5,22-xe.zoom)*M.exaggeration();(De?[!1,!0]:[!1]).forEach(Se=>{ge=-1;const Ye=Se?q.LINES:q.TRIANGLES,[Qe,Ge]=Se?M.getWirefameBuffer():[M.gridIndexBuffer,M.gridSegments];for(const it of B){const St=O.getTile(it),zt=p.StencilMode.disabled,Pt=M.prevTerrainTileForTile[it.key],dn=M.terrainTileForTile[it.key];Is(Pt,dn)&&hu.newMorphing(it.key,Pt,dn,U,250),$.activeTexture.set(q.TEXTURE0),St.texture.bind(q.LINEAR,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const wt=hu.getMorphValuesForProxy(it.key),en=wt?1:0;let Jt;wt&&(Jt={morphing:{srcDemTile:wt.from,dstDemTile:wt.to,phase:p.easeCubicInOut(wt.phase)}});const Dt=rr(it.projMatrix,ni(it.canonical,xe.renderWorldCopies)?Ne/10:Ne);be(en,Se),M.setupElevationDraw(St,Z,Jt),I.prepareDrawProgram($,Z,it.toUnwrapped()),Z.draw($,Ye,Ce,zt,Re,p.CullFaceMode.backCCW,Dt,"terrain_raster",M.gridBuffer,Qe,Ge)}})}}(g,this,this.proxySourceCache,l,this._updateTimestamp),this.renderingToTexture=!0,g.gpuTimingDeferredRenderEnd(),l.splice(0,l.length))}renderBatch(l){if(0===this._drapedRenderBatches.length)return l+1;this.renderingToTexture=!0;const g=this.painter,b=this.painter.context,I=this.proxySourceCache,M=this.proxiedCoords[I.id],O=this._drapedRenderBatches.shift(),B=[],U=g.style.order;let $=0;for(const q of M){const Z=I.getTileByID(q.proxyTileKey),ge=I.proxyCachedFBO[q.key]?I.proxyCachedFBO[q.key][l]:void 0,De=void 0!==ge?I.renderCache[ge]:this.pool[$++],be=void 0!==ge;if(Z.texture=De.tex,be&&!De.dirty){B.push(Z.tileID);continue}let Re;b.bindFramebuffer.set(De.fb.framebuffer),this.renderedToTile=!1,De.dirty&&(b.clear({color:p.Color.transparent,stencil:0}),De.dirty=!1);for(let Ce=O.start;Ce<=O.end;++Ce){const xe=g.style._layers[U[Ce]];if(xe.isHidden(g.transform.zoom))continue;const Ne=g.style._getLayerSourceCache(xe),Se=Ne?this.proxyToSource[q.key][Ne.id]:[q];if(!Se)continue;const Ye=Se;b.viewport.set([0,0,De.fb.width,De.fb.height]),Re!==(Ne?Ne.id:null)&&(this._setupStencil(De,Se,xe,Ne),Re=Ne?Ne.id:null),g.renderLayer(g,Ne,xe,Ye)}this.renderedToTile?(De.dirty=!0,B.push(Z.tileID)):be||--$,5===$&&($=0,this.renderToBackBuffer(B))}return this.renderToBackBuffer(B),this.renderingToTexture=!1,b.bindFramebuffer.set(null),b.viewport.set([0,0,g.width,g.height]),O.end+1}postRender(){}renderCacheEfficiency(l){const g=l.order.length;if(0===g)return{efficiency:100};let b,I=0,M=0,O=!1;for(let B=0;B<g;++B){const U=l._layers[l.order[B]];this._style.isLayerDraped(U)?(O&&++I,++M):O||(O=!0,b=U.id)}return 0===M?{efficiency:100}:{efficiency:100*(1-I/M),firstUndrapedLayer:b}}getMinElevationBelowMSL(){let l=0;return this._visibleDemTiles.filter(g=>g.dem).forEach(g=>{l=Math.min(l,g.dem.tree.minimums[0])}),0===l?l:(l-30)*this._exaggeration}raycast(l,g,b){if(!this._visibleDemTiles)return null;const I=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const O=M.tileID,B=1<<O.overscaledZ,{x:U,y:$}=O.canonical,q=U/B,Z=(U+1)/B,ge=$/B,De=($+1)/B;return{minx:q,miny:ge,maxx:Z,maxy:De,t:M.dem.tree.raycastRoot(q,ge,Z,De,l,g,b),tile:M}});I.sort((M,O)=>(null!==M.t?M.t:Number.MAX_VALUE)-(null!==O.t?O.t:Number.MAX_VALUE));for(const M of I){if(null==M.t)return null;const O=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,l,g,b);if(null!=O)return O}return null}_createFBO(){const l=this.painter.context,g=l.gl,b=this.drapeBufferSize;l.activeTexture.set(g.TEXTURE0);const I=new p.Texture(l,{width:b[0],height:b[1],data:null},g.RGBA);I.bind(g.LINEAR,g.CLAMP_TO_EDGE);const M=l.createFramebuffer(b[0],b[1],!1);return M.colorAttachment.set(I.texture),M.depthAttachment=new Go(l,M.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=l.createRenderbuffer(l.gl.DEPTH_STENCIL,b[0],b[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),l.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),l.extTextureFilterAnisotropic&&!l.extTextureFilterAnisotropicForceOff&&g.texParameterf(g.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax),{fb:M,tex:I,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const l in this._style._sourceCaches)if(this._style._sourceCaches[l].hasTransition())return!0;return this._style.order.some(l=>{const g=this._style._layers[l],b=g.isHidden(this.painter.transform.zoom),I=g.getCrossfadeParameters(),M=!!I&&1!==I.t,O=g.hasTransition();return"custom"!==g.type&&!b&&(M||O)})}_clearRasterFadeFromRenderCache(){let l=!1;for(const g in this._style._sourceCaches)if(this._style._sourceCaches[g]._source instanceof ne){l=!0;break}if(l)for(let g=0;g<this._style.order.length;++g){const b=this._style._layers[this._style.order[g]],I=b.isHidden(this.painter.transform.zoom),M=this._style._getLayerSourceCache(b);if("raster"!==b.type||I||!M)continue;const O=b.paint.get("raster-fade-duration");for(const B of this.proxyCoords){const U=this.proxyToSource[B.key][M.id];if(U)for(const $ of U){const q=Xa(M.getTile($),M.findLoadedParent($,0),M,this.painter.transform,O);(1!==q.opacity||0!==q.mix)&&this._clearRenderCacheForTile(M.id,$)}}}}_setupDrapedRenderBatches(){const l=this._style.order,g=l.length;if(0===g)return;const b=[];let I,M=0,O=this._style._layers[l[M]];for(;!this._style.isLayerDraped(O)&&O.isHidden(this.painter.transform.zoom)&&++M<g;)O=this._style._layers[l[M]];for(;M<g;++M){const B=this._style._layers[l[M]];B.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(B)?void 0===I&&(I=M):void 0!==I&&(b.push({start:I,end:M-1}),I=void 0))}void 0!==I&&b.push({start:I,end:M-1}),this._drapedRenderBatches=b}_setupRenderCache(l){const g=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,g.renderCache.length>g.renderCachePool.length){const O=Object.values(g.proxyCachedFBO);g.proxyCachedFBO={};for(let B=0;B<O.length;++B){const U=Object.values(O[B]);g.renderCachePool.push(...U)}}return}this._clearRasterFadeFromRenderCache();const b=this.proxyCoords,I=this._tilesDirty;for(let O=b.length-1;O>=0;O--){const B=b[O];if(g.getTileByID(B.key),void 0!==g.proxyCachedFBO[B.key]){const U=l[B.key],$=this.proxyToSource[B.key];let q=0;for(const Z in $){const ge=$[Z],De=U[Z];if(!De||De.length!==ge.length||ge.some((be,Re)=>be!==De[Re]||I[Z]&&I[Z].hasOwnProperty(be.key))){q=-1;break}++q}for(const Z in g.proxyCachedFBO[B.key])g.renderCache[g.proxyCachedFBO[B.key][Z]].dirty=q<0||q!==Object.values(U).length}}const M=[...this._drapedRenderBatches];M.sort((O,B)=>B.end-B.start-(O.end-O.start));for(const O of M)for(const B of b){if(g.proxyCachedFBO[B.key])continue;let U=g.renderCachePool.pop();void 0===U&&g.renderCache.length<50&&(U=g.renderCache.length,g.renderCache.push(this._createFBO())),void 0!==U&&(g.proxyCachedFBO[B.key]={},g.proxyCachedFBO[B.key][O.start]=U,g.renderCache[U].dirty=!0)}this._tilesDirty={}}_setupStencil(l,g,b,I){if(!I||!this._sourceTilesOverlap[I.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,O=M.gl;if(g.length<=1)return void(this._overlapStencilType=!1);let B;if(b.isTileClipped())B=g.length,this._overlapStencilMode.test={func:O.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(g[0].overscaledZ>g[g.length-1].overscaledZ))return void(this._overlapStencilType=!1);B=1,this._overlapStencilMode.test={func:O.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+B>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=B,this._overlapStencilMode.ref=this._stencilRef,b.isTileClipped()&&this._renderTileClippingMasks(g,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(l){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[l.key]),this._overlapStencilMode):p.StencilMode.disabled}_renderTileClippingMasks(l,g){const b=this.painter,I=this.painter.context,M=I.gl;b._tileClippingMaskIDs={},I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=b.useProgram("clippingMask");for(const B of l){const U=b._tileClippingMaskIDs[B.key]=--g;O.draw(I,M.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:M.ALWAYS,mask:0},U,255,M.KEEP,M.KEEP,M.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Si(B.projMatrix),"$clipping",b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}}pointCoordinate(l){const g=this.painter.transform;if(l.x<0||l.x>g.width||l.y<0||l.y>g.height)return null;const b=[l.x,l.y,1,1];p.transformMat4$1(b,b,g.pixelMatrixInverse),p.scale$1(b,b,1/b[3]),b[0]/=g.worldSize,b[1]/=g.worldSize;const I=g._camera.position,M=p.mercatorZfromAltitude(1,g.center.lat),O=[I[0],I[1],I[2]/M,0],B=p.subtract([],b.slice(0,3),O);p.normalize(B,B);const U=this.raycast(O,B,this._exaggeration);return null!==U&&U?(p.scaleAndAdd(O,O,B,U),O[3]=O[2],O[2]*=M,O):null}drawDepth(){const l=this.painter,g=l.context,b=this.proxySourceCache,I=Math.ceil(l.width),M=Math.ceil(l.height);if(!this._depthFBO||this._depthFBO.width===I&&this._depthFBO.height===M||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const O=g.gl,B=g.createFramebuffer(I,M,!0);g.activeTexture.set(O.TEXTURE0);const U=new p.Texture(g,{width:I,height:M,data:null},O.RGBA);U.bind(O.NEAREST,O.CLAMP_TO_EDGE),B.colorAttachment.set(U.texture);const $=g.createRenderbuffer(g.gl.DEPTH_COMPONENT16,I,M);B.depthAttachment.set($),this._depthFBO=B,this._depthTexture=U}g.bindFramebuffer.set(this._depthFBO.framebuffer),g.viewport.set([0,0,I,M]),function(O,B,U,$){if("globe"===O.transform.projection.name)return;const q=O.context,Z=q.gl;q.clear({depth:1});const ge=O.useProgram("terrainDepth"),De=new p.DepthMode(Z.LESS,p.DepthMode.ReadWrite,O.depthRangeFor3D);for(const be of $){const Re=U.getTile(be),Ce=rr(be.projMatrix,0);B.setupElevationDraw(Re,ge),ge.draw(q,Z.TRIANGLES,De,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.backCCW,Ce,"terrain_depth",B.gridBuffer,B.gridIndexBuffer,B.gridNoSkirtSegments)}}(l,this,b,this.proxyCoords)}_setupProxiedCoordsForOrtho(l,g,b){if(l.getSource()instanceof nt)return this._setupProxiedCoordsForImageSource(l,g,b);this._findCoveringTileCache[l.id]=this._findCoveringTileCache[l.id]||{};const I=this.proxiedCoords[l.id]=[],M=this.proxyCoords;for(let B=0;B<M.length;B++){const U=M[B],$=this._findTileCoveringTileID(U,l);if($){const q=this._createProxiedId(U,$,b[U.key]&&b[U.key][l.id]);I.push(q),this.proxyToSource[U.key][l.id]=[q]}}let O=!1;for(let B=0;B<g.length;B++){const U=l.getTile(g[B]);if(!U||!U.hasData())continue;const $=this._findTileCoveringTileID(U.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==U.tileID.canonical.z){const q=this.proxyToSource[$.tileID.key][l.id],Z=this._createProxiedId($.tileID,U,b[$.tileID.key]&&b[$.tileID.key][l.id]);q?q.splice(q.length-1,0,Z):this.proxyToSource[$.tileID.key][l.id]=[Z],I.push(Z),O=!0}}this._sourceTilesOverlap[l.id]=O}_setupProxiedCoordsForImageSource(l,g,b){if(!l.getSource().loaded())return;const I=this.proxiedCoords[l.id]=[],M=this.proxyCoords,O=l.getSource(),B=new p.pointGeometry(O.tileID.x,O.tileID.y)._div(1<<O.tileID.z),U=O.coordinates.map(p.MercatorCoordinate.fromLngLat).reduce((q,Z)=>(q.min.x=Math.min(q.min.x,Z.x-B.x),q.min.y=Math.min(q.min.y,Z.y-B.y),q.max.x=Math.max(q.max.x,Z.x-B.x),q.max.y=Math.max(q.max.y,Z.y-B.y),q),{min:new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new p.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(q,Z)=>{const ge=q.wrap+q.canonical.x/(1<<q.canonical.z),De=q.canonical.y/(1<<q.canonical.z),be=p.EXTENT/(1<<q.canonical.z),Re=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),Ce=Z.canonical.y/(1<<Z.canonical.z);return ge+be<Re+U.min.x||ge>Re+U.max.x||De+be<Ce+U.min.y||De>Ce+U.max.y};for(let q=0;q<M.length;q++){const Z=M[q];for(let ge=0;ge<g.length;ge++){const De=l.getTile(g[ge]);if(!De||!De.hasData()||$(Z,De.tileID))continue;const be=this._createProxiedId(Z,De,b[Z.key]&&b[Z.key][l.id]),Re=this.proxyToSource[Z.key][l.id];Re?Re.push(be):this.proxyToSource[Z.key][l.id]=[be],I.push(be)}}}_createProxiedId(l,g,b){let I=this.orthoMatrix;if(b){const M=b.find(O=>O.key===g.tileID.key);if(M)return M}if(g.tileID.key!==l.key){const M=l.canonical.z-g.tileID.canonical.z;let O,B,U;I=p.create();const $=g.tileID.wrap-l.wrap<<l.overscaledZ;M>0?(O=p.EXTENT>>M,B=O*((g.tileID.canonical.x<<M)-l.canonical.x+$),U=O*((g.tileID.canonical.y<<M)-l.canonical.y)):(O=p.EXTENT<<-M,B=p.EXTENT*(g.tileID.canonical.x-(l.canonical.x+$<<-M)),U=p.EXTENT*(g.tileID.canonical.y-(l.canonical.y<<-M))),p.ortho(I,0,O,0,O,0,1),p.translate(I,I,[B,U,0])}return new Gh(g.tileID,l.key,I)}_findTileCoveringTileID(l,g){let b=g.getTile(l);if(b&&b.hasData())return b;const I=this._findCoveringTileCache[g.id],M=I[l.key];if(b=M?g.getTileByID(M):null,b&&b.hasData()||null===M)return b;let O=b?b.tileID:l,B=O.overscaledZ;const U=g.getSource().minzoom,$=[];if(!M){const Z=g.getSource().maxzoom;if(l.canonical.z>=Z){const ge=l.canonical.z-Z;g.getSource().reparseOverscaled?(B=Math.max(l.canonical.z+2,g.transform.tileZoom),O=new p.OverscaledTileID(B,l.wrap,Z,l.canonical.x>>ge,l.canonical.y>>ge)):0!==ge&&(B=Z,O=new p.OverscaledTileID(B,l.wrap,Z,l.canonical.x>>ge,l.canonical.y>>ge))}O.key!==l.key&&($.push(O.key),b=g.getTile(O))}const q=Z=>{$.forEach(ge=>{I[ge]=Z}),$.length=0};for(B-=1;B>=U&&(!b||!b.hasData());B--){b&&q(b.tileID.key);const Z=O.calculateScaledKey(B);if(b=g.getTileByID(Z),b&&b.hasData())break;const ge=I[Z];if(null===ge)break;void 0===ge?$.push(Z):b=g.getTileByID(ge)}return q(b?b.tileID.key:null),b&&b.hasData()?b:null}findDEMTileFor(l){return this.enabled?this._findTileCoveringTileID(l,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(l,g){let b=this._tilesDirty[l];b||(b=this._tilesDirty[l]={}),b[g.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const l=function(g){let b=0;const I=new p.StructArrayLayout2ui4,M=131;for(let O=1;O<129;O++){for(let B=1;B<129;B++)b=O*M+B,I.emplaceBack(b,b+1),I.emplaceBack(b,b+M),I.emplaceBack(b+1,b+M),128===O&&I.emplaceBack(b+M,b+M+1);I.emplaceBack(b+1,b+1+M)}return I}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(l),this.wireframeSegments=p.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,l.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class $r{static cacheKey(l,g,b,I){let M=`${g}${I?I.cacheKey:""}`;for(const O of b)l.usedDefines.includes(O)&&(M+=`/${O}`);return M}constructor(l,g,b,I,M,O){const B=l.gl;this.program=B.createProgram();const U=function(Ce){const xe=[];for(let Ne=0;Ne<Ce.length;Ne++){if(null===Ce[Ne])continue;const Se=Ce[Ne].split(" ");xe.push(Se.pop())}return xe}(b.staticAttributes),$=I?I.getBinderAttributes():[],q=U.concat($);let Z=I?I.defines():[];Z=Z.concat(O.map(Ce=>`#define ${Ce}`));const ge=Z.concat(l.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Gl):Gl,Gl,Wn,mo.fragmentSource,Iu.fragmentSource,b.fragmentSource).join("\n"),De=Z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Wn,mo.vertexSource,Iu.vertexSource,jl.vertexSource,b.vertexSource).join("\n"),be=B.createShader(B.FRAGMENT_SHADER);if(B.isContextLost())return void(this.failedToCreate=!0);B.shaderSource(be,ge),B.compileShader(be),B.attachShader(this.program,be);const Re=B.createShader(B.VERTEX_SHADER);if(B.isContextLost())this.failedToCreate=!0;else{B.shaderSource(Re,De),B.compileShader(Re),B.attachShader(this.program,Re),this.attributes={},this.numAttributes=q.length;for(let Ce=0;Ce<this.numAttributes;Ce++)q[Ce]&&(B.bindAttribLocation(this.program,Ce,q[Ce]),this.attributes[q[Ce]]=Ce);B.linkProgram(this.program),B.deleteShader(Re),B.deleteShader(be),this.fixedUniforms=M(l),this.binderUniforms=I?I.getUniforms(l):[],O.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new p.Uniform1i(Ce=l),u_dem_prev:new p.Uniform1i(Ce),u_dem_unpack:new p.Uniform4f(Ce),u_dem_tl:new p.Uniform2f(Ce),u_dem_scale:new p.Uniform1f(Ce),u_dem_tl_prev:new p.Uniform2f(Ce),u_dem_scale_prev:new p.Uniform1f(Ce),u_dem_size:new p.Uniform1f(Ce),u_dem_lerp:new p.Uniform1f(Ce),u_exaggeration:new p.Uniform1f(Ce),u_depth:new p.Uniform1i(Ce),u_depth_size_inv:new p.Uniform2f(Ce),u_meter_to_dem:new p.Uniform1f(Ce),u_label_plane_matrix_inv:new p.UniformMatrix4f(Ce)}),O.includes("GLOBE")&&(this.globeUniforms=(Ce=>({u_tile_tl_up:new p.Uniform3f(Ce),u_tile_tr_up:new p.Uniform3f(Ce),u_tile_br_up:new p.Uniform3f(Ce),u_tile_bl_up:new p.Uniform3f(Ce),u_tile_up_scale:new p.Uniform1f(Ce)}))(l)),O.includes("FOG")&&(this.fogUniforms=(Ce=>({u_fog_matrix:new p.UniformMatrix4f(Ce),u_fog_range:new p.Uniform2f(Ce),u_fog_color:new p.Uniform4f(Ce),u_fog_horizon_blend:new p.Uniform1f(Ce),u_fog_temporal_offset:new p.Uniform1f(Ce),u_frustum_tl:new p.Uniform3f(Ce),u_frustum_tr:new p.Uniform3f(Ce),u_frustum_br:new p.Uniform3f(Ce),u_frustum_bl:new p.Uniform3f(Ce),u_globe_pos:new p.Uniform3f(Ce),u_globe_radius:new p.Uniform1f(Ce),u_globe_transition:new p.Uniform1f(Ce),u_is_globe:new p.Uniform1i(Ce),u_viewport:new p.Uniform2f(Ce)}))(l))}var Ce}setTerrainUniformValues(l,g){if(!this.terrainUniforms)return;const b=this.terrainUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I]&&b[I].set(this.program,I,g[I])}}setGlobeUniformValues(l,g){if(!this.globeUniforms)return;const b=this.globeUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I]&&b[I].set(this.program,I,g[I])}}setFogUniformValues(l,g){if(!this.fogUniforms)return;const b=this.fogUniforms;if(!this.failedToCreate){l.program.set(this.program);for(const I in g)b[I].set(this.program,I,g[I])}}draw(l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re){const Ce=l.gl;if(this.failedToCreate)return;l.program.set(this.program),l.setDepthMode(b),l.setStencilMode(I),l.setColorMode(M),l.setCullFace(O);for(const Ne of Object.keys(this.fixedUniforms))this.fixedUniforms[Ne].set(this.program,Ne,B[Ne]);be&&be.setUniforms(this.program,l,this.binderUniforms,ge,{zoom:De});const xe={[Ce.LINES]:2,[Ce.TRIANGLES]:3,[Ce.LINE_STRIP]:1}[g];for(const Ne of Z.get()){const Se=Ne.vaos||(Ne.vaos={});(Se[U]||(Se[U]=new cu)).bind(l,this,$,be?be.getPaintVertexBuffers():[],q,Ne.vertexOffset,Re||[]),Ce.drawElements(g,Ne.primitiveLength*xe,Ce.UNSIGNED_SHORT,Ne.primitiveOffset*xe*2)}}}function Hr(v,l,g){const b=1/Vt(g,1,l.transform.tileZoom),I=Math.pow(2,g.tileID.overscaledZ),M=g.tileSize*Math.pow(2,l.transform.tileZoom)/I,O=M*(g.tileID.canonical.x+g.tileID.wrap*I),B=M*g.tileID.canonical.y;return{u_image:0,u_texsize:g.imageAtlasTexture.size,u_scale:[b,v.fromScale,v.toScale],u_fade:v.t,u_pixel_coord_upper:[O>>16,B>>16],u_pixel_coord_lower:[65535&O,65535&B]}}const Fu=p.create(),Ia=(v,l,g,b,I,M,O,B,U,$,q)=>{const Z=l.style.light,ge=Z.properties.get("position"),De=[ge.x,ge.y,ge.z],be=p.create$1();"viewport"===Z.properties.get("anchor")&&(p.fromRotation(be,-l.transform.angle),p.transformMat3(De,De,be));const Re=Z.properties.get("color"),Ce=l.transform,xe={u_matrix:v,u_lightpos:De,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[Re.r,Re.g,Re.b],u_vertical_gradient:+g,u_opacity:b,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Fu,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:I,u_edge_radius:M};return"globe"===Ce.projection.name&&(xe.u_tile_id=[O.canonical.x,O.canonical.y,1<<O.canonical.z],xe.u_zoom_transition=U,xe.u_inv_rot_matrix=q,xe.u_merc_center=$,xe.u_up_dir=Ce.projection.upVector(new p.CanonicalTileID(0,0,0),$[0]*p.EXTENT,$[1]*p.EXTENT),xe.u_height_lift=B),xe},Zs=(v,l,g,b,I,M,O,B,U,$,q,Z,ge)=>{const De=Ia(v,l,g,b,I,M,O,$,q,Z,ge),be={u_height_factor:-Math.pow(2,O.overscaledZ)/U.tileSize/8};return p.extend(De,Hr(B,l,U),be)},ys=v=>({u_matrix:v}),zu=(v,l,g,b)=>p.extend(ys(v),Hr(g,l,b)),mc=(v,l)=>({u_matrix:v,u_world:l}),yl=(v,l,g,b,I)=>p.extend(zu(v,l,g,b),{u_world:I}),_s=p.create(),Du=(v,l,g,b,I,M)=>{const O=v.transform,B="globe"===O.projection.name;let U;if("map"===M.paint.get("circle-pitch-alignment"))if(B){const q=p.globePixelsToTileUnits(O.zoom,l.canonical)*O._pixelsPerMercatorPixel;U=Float32Array.from([q,0,0,q])}else U=O.calculatePixelsToTileUnitsMatrix(g);else U=new Float32Array([O.pixelsToGLUnits[0],0,0,O.pixelsToGLUnits[1]]);const $={u_camera_to_center_distance:O.cameraToCenterDistance,u_matrix:v.translatePosMatrix(l.projMatrix,g,M.paint.get("circle-translate"),M.paint.get("circle-translate-anchor")),u_device_pixel_ratio:p.exported.devicePixelRatio,u_extrude_scale:U,u_inv_rot_matrix:_s,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(B){$.u_inv_rot_matrix=b,$.u_merc_center=I,$.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],$.u_zoom_transition=p.globeToMercatorTransition(O.zoom);const q=I[0]*p.EXTENT,Z=I[1]*p.EXTENT;$.u_up_dir=O.projection.upVector(new p.CanonicalTileID(0,0,0),q,Z)}return $},pa=v=>{const l=[];return"map"===v.paint.get("circle-pitch-alignment")&&l.push("PITCH_WITH_MAP"),"map"===v.paint.get("circle-pitch-scale")&&l.push("SCALE_WITH_MAP"),l},Ta=(v,l,g,b)=>{const I=p.EXTENT/g.tileSize;return{u_matrix:v,u_camera_to_center_distance:l.getCameraToCenterDistance(b),u_extrude_scale:[l.pixelsToGLUnits[0]/I,l.pixelsToGLUnits[1]/I]}},Ls=(v,l,g=1)=>({u_matrix:v,u_color:l,u_overlay:0,u_overlay_scale:g}),ga=p.create(),fu=(v,l,g,b,I,M,O)=>{const B=v.transform,U="globe"===B.projection.name,$=U?p.globePixelsToTileUnits(B.zoom,l.canonical)*B._pixelsPerMercatorPixel:Vt(g,1,M),q={u_matrix:l.projMatrix,u_extrude_scale:$,u_intensity:O,u_inv_rot_matrix:ga,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(U){q.u_inv_rot_matrix=b,q.u_merc_center=I,q.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],q.u_zoom_transition=p.globeToMercatorTransition(B.zoom);const Z=I[0]*p.EXTENT,ge=I[1]*p.EXTENT;q.u_up_dir=B.projection.upVector(new p.CanonicalTileID(0,0,0),Z,ge)}return q},vi=(v,l,g,b,I,M,O,B)=>{const U=v.transform,$=U.calculatePixelsToTileUnitsMatrix(l),q={u_matrix:mi(v,l,g,I),u_pixels_to_tile_units:$,u_device_pixel_ratio:O,u_units_to_pixels:[1/U.pixelsToGLUnits[0],1/U.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:M,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:B};if(hs(g)){const Z=xi(l,v.transform);q.u_texsize=l.lineAtlasTexture.size,q.u_scale=[Z,b.fromScale,b.toScale],q.u_mix=b.t}return q},ma=(v,l,g,b,I,M)=>{const O=v.transform,B=xi(l,O);return{u_matrix:mi(v,l,g,I),u_texsize:l.imageAtlasTexture.size,u_pixels_to_tile_units:O.calculatePixelsToTileUnitsMatrix(l),u_device_pixel_ratio:M,u_image:0,u_scale:[B,b.fromScale,b.toScale],u_fade:b.t,u_units_to_pixels:[1/O.pixelsToGLUnits[0],1/O.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function xi(v,l){return 1/Vt(v,1,l.tileZoom)}function mi(v,l,g,b){return v.translatePosMatrix(b||l.tileID.projMatrix,l,g.paint.get("line-translate"),g.paint.get("line-translate-anchor"))}function hs(v){const l=v.paint.get("line-dasharray").value;return l.value||"constant"!==l.kind}const Ws=(v,l,g,b,I,M)=>{return{u_matrix:v,u_tl_parent:l,u_scale_parent:g,u_fade_t:b.mix,u_opacity:b.opacity*I.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:I.paint.get("raster-brightness-min"),u_brightness_high:I.paint.get("raster-brightness-max"),u_saturation_factor:(B=I.paint.get("raster-saturation"),B>0?1-1/(1.001-B):-B),u_contrast_factor:(O=I.paint.get("raster-contrast"),O>0?1/(1-O):1+O),u_spin_weights:Za(I.paint.get("raster-hue-rotate")),u_perspective_transform:M};var O,B};function Za(v){v*=Math.PI/180;const l=Math.sin(v),g=Math.cos(v);return[(2*g+1)/3,(-Math.sqrt(3)*l-g+1)/3,(Math.sqrt(3)*l-g+1)/3]}const Co=p.create(),Hn=(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re)=>{const Ce=I.transform,xe={u_is_size_zoom_constant:+("constant"===v||"source"===v),u_is_size_feature_constant:+("constant"===v||"camera"===v),u_size_t:l?l.uSizeT:0,u_size:l?l.uSize:0,u_camera_to_center_distance:Ce.cameraToCenterDistance,u_rotate_symbol:+g,u_aspect_ratio:Ce.width/Ce.height,u_fade_change:I.options.fadeDuration?I.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:O,u_coord_matrix:B,u_is_text:+U,u_pitch_with_map:+b,u_texsize:$,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Co,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Co,u_up_vector:[0,-1,0]};return"globe"===Re.name&&(xe.u_tile_id=[q.canonical.x,q.canonical.y,1<<q.canonical.z],xe.u_zoom_transition=Z,xe.u_inv_rot_matrix=De,xe.u_merc_center=ge,xe.u_camera_forward=Ce._camera.forward(),xe.u_ecef_origin=p.globeECEFOrigin(Ce.globeMatrix,q.toUnwrapped()),xe.u_tile_matrix=Float32Array.from(Ce.globeMatrix),xe.u_up_vector=be),xe},Nr=(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re,Ce)=>p.extend(Hn(v,l,g,b,I,M,O,B,U,$,Z,ge,De,be,Re,Ce),{u_gamma_scale:b?I.transform.cameraToCenterDistance*Math.cos(I.terrain?0:I.transform._pitch):1,u_device_pixel_ratio:p.exported.devicePixelRatio,u_is_halo:+q}),ko=(v,l,g,b,I,M,O,B,U,$,q,Z,ge,De,be,Re)=>p.extend(Nr(v,l,g,b,I,M,O,B,!0,U,!0,q,Z,ge,De,be,Re),{u_texsize_icon:$,u_texture_icon:1}),Wa=(v,l,g)=>({u_matrix:v,u_opacity:l,u_color:g}),$l=(v,l,g,b,I,M)=>p.extend(function(O,B,U,$){const q=U.imageManager.getPattern(O.from.toString()),Z=U.imageManager.getPattern(O.to.toString()),{width:ge,height:De}=U.imageManager.getPixelSize(),be=Math.pow(2,$.tileID.overscaledZ),Re=$.tileSize*Math.pow(2,U.transform.tileZoom)/be,Ce=Re*($.tileID.canonical.x+$.tileID.wrap*be),xe=Re*$.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[ge,De],u_mix:B.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:B.fromScale,u_scale_b:B.toScale,u_tile_units_to_pixels:1/Vt($,1,U.transform.tileZoom),u_pixel_coord_upper:[Ce>>16,xe>>16],u_pixel_coord_lower:[65535&Ce,65535&xe]}}(b,M,g,I),{u_matrix:v,u_opacity:l}),rs={fillExtrusion:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v)}),fillExtrusionPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_lightpos:new p.Uniform3f(v),u_lightintensity:new p.Uniform1f(v),u_lightcolor:new p.Uniform3f(v),u_vertical_gradient:new p.Uniform1f(v),u_height_factor:new p.Uniform1f(v),u_edge_radius:new p.Uniform1f(v),u_ao:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_up_dir:new p.Uniform3f(v),u_height_lift:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v)}),fill:v=>({u_matrix:new p.UniformMatrix4f(v)}),fillPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v)}),fillOutline:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v)}),fillOutlinePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_world:new p.Uniform2f(v),u_image:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v)}),circle:v=>({u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),collisionBox:v=>({u_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_extrude_scale:new p.Uniform2f(v)}),collisionCircle:v=>({u_matrix:new p.UniformMatrix4f(v),u_inv_matrix:new p.UniformMatrix4f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_viewport_size:new p.Uniform2f(v)}),debug:v=>({u_color:new p.UniformColor(v),u_matrix:new p.UniformMatrix4f(v),u_overlay:new p.Uniform1i(v),u_overlay_scale:new p.Uniform1f(v)}),clippingMask:v=>({u_matrix:new p.UniformMatrix4f(v)}),heatmap:v=>({u_extrude_scale:new p.Uniform1f(v),u_intensity:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_up_dir:new p.Uniform3f(v)}),heatmapTexture:v=>({u_image:new p.Uniform1i(v),u_color_ramp:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v)}),hillshade:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_latrange:new p.Uniform2f(v),u_light:new p.Uniform2f(v),u_shadow:new p.UniformColor(v),u_highlight:new p.UniformColor(v),u_accent:new p.UniformColor(v)}),hillshadePrepare:v=>({u_matrix:new p.UniformMatrix4f(v),u_image:new p.Uniform1i(v),u_dimension:new p.Uniform2f(v),u_zoom:new p.Uniform1f(v),u_unpack:new p.Uniform4f(v)}),line:v=>({u_matrix:new p.UniformMatrix4f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_units_to_pixels:new p.Uniform2f(v),u_dash_image:new p.Uniform1i(v),u_gradient_image:new p.Uniform1i(v),u_image_height:new p.Uniform1f(v),u_texsize:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_mix:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v),u_trim_offset:new p.Uniform2f(v)}),linePattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_texsize:new p.Uniform2f(v),u_pixels_to_tile_units:new p.UniformMatrix2f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_units_to_pixels:new p.Uniform2f(v),u_scale:new p.Uniform3f(v),u_fade:new p.Uniform1f(v),u_alpha_discard_threshold:new p.Uniform1f(v)}),raster:v=>({u_matrix:new p.UniformMatrix4f(v),u_tl_parent:new p.Uniform2f(v),u_scale_parent:new p.Uniform1f(v),u_fade_t:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_image0:new p.Uniform1i(v),u_image1:new p.Uniform1i(v),u_brightness_low:new p.Uniform1f(v),u_brightness_high:new p.Uniform1f(v),u_saturation_factor:new p.Uniform1f(v),u_contrast_factor:new p.Uniform1f(v),u_spin_weights:new p.Uniform3f(v),u_perspective_transform:new p.Uniform2f(v)}),symbolIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_texture:new p.Uniform1i(v)}),symbolSDF:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_tile_id:new p.Uniform3f(v),u_zoom_transition:new p.Uniform1f(v),u_inv_rot_matrix:new p.UniformMatrix4f(v),u_merc_center:new p.Uniform2f(v),u_camera_forward:new p.Uniform3f(v),u_tile_matrix:new p.UniformMatrix4f(v),u_up_vector:new p.Uniform3f(v),u_ecef_origin:new p.Uniform3f(v),u_is_halo:new p.Uniform1i(v)}),symbolTextAndIcon:v=>({u_is_size_zoom_constant:new p.Uniform1i(v),u_is_size_feature_constant:new p.Uniform1i(v),u_size_t:new p.Uniform1f(v),u_size:new p.Uniform1f(v),u_camera_to_center_distance:new p.Uniform1f(v),u_rotate_symbol:new p.Uniform1i(v),u_aspect_ratio:new p.Uniform1f(v),u_fade_change:new p.Uniform1f(v),u_matrix:new p.UniformMatrix4f(v),u_label_plane_matrix:new p.UniformMatrix4f(v),u_coord_matrix:new p.UniformMatrix4f(v),u_is_text:new p.Uniform1i(v),u_pitch_with_map:new p.Uniform1i(v),u_texsize:new p.Uniform2f(v),u_texsize_icon:new p.Uniform2f(v),u_texture:new p.Uniform1i(v),u_texture_icon:new p.Uniform1i(v),u_gamma_scale:new p.Uniform1f(v),u_device_pixel_ratio:new p.Uniform1f(v),u_is_halo:new p.Uniform1i(v)}),background:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_color:new p.UniformColor(v)}),backgroundPattern:v=>({u_matrix:new p.UniformMatrix4f(v),u_opacity:new p.Uniform1f(v),u_image:new p.Uniform1i(v),u_pattern_tl_a:new p.Uniform2f(v),u_pattern_br_a:new p.Uniform2f(v),u_pattern_tl_b:new p.Uniform2f(v),u_pattern_br_b:new p.Uniform2f(v),u_texsize:new p.Uniform2f(v),u_mix:new p.Uniform1f(v),u_pattern_size_a:new p.Uniform2f(v),u_pattern_size_b:new p.Uniform2f(v),u_scale_a:new p.Uniform1f(v),u_scale_b:new p.Uniform1f(v),u_pixel_coord_upper:new p.Uniform2f(v),u_pixel_coord_lower:new p.Uniform2f(v),u_tile_units_to_pixels:new p.Uniform1f(v)}),terrainRaster:Ha,terrainDepth:Ha,skybox:v=>({u_matrix:new p.UniformMatrix4f(v),u_sun_direction:new p.Uniform3f(v),u_cubemap:new p.Uniform1i(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxGradient:v=>({u_matrix:new p.UniformMatrix4f(v),u_color_ramp:new p.Uniform1i(v),u_center_direction:new p.Uniform3f(v),u_radius:new p.Uniform1f(v),u_opacity:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v)}),skyboxCapture:v=>({u_matrix_3f:new p.UniformMatrix3f(v),u_sun_direction:new p.Uniform3f(v),u_sun_intensity:new p.Uniform1f(v),u_color_tint_r:new p.Uniform4f(v),u_color_tint_m:new p.Uniform4f(v),u_luminance:new p.Uniform1f(v)}),globeRaster:v=>({u_proj_matrix:new p.UniformMatrix4f(v),u_globe_matrix:new p.UniformMatrix4f(v),u_normalize_matrix:new p.UniformMatrix4f(v),u_merc_matrix:new p.UniformMatrix4f(v),u_zoom_transition:new p.Uniform1f(v),u_merc_center:new p.Uniform2f(v),u_image0:new p.Uniform1i(v),u_grid_matrix:new p.UniformMatrix3f(v),u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_globe_pos:new p.Uniform3f(v),u_globe_radius:new p.Uniform1f(v),u_viewport:new p.Uniform2f(v)}),globeAtmosphere:v=>({u_frustum_tl:new p.Uniform3f(v),u_frustum_tr:new p.Uniform3f(v),u_frustum_br:new p.Uniform3f(v),u_frustum_bl:new p.Uniform3f(v),u_horizon:new p.Uniform1f(v),u_transition:new p.Uniform1f(v),u_fadeout_range:new p.Uniform1f(v),u_color:new p.Uniform4f(v),u_high_color:new p.Uniform4f(v),u_space_color:new p.Uniform4f(v),u_star_intensity:new p.Uniform1f(v),u_star_density:new p.Uniform1f(v),u_star_size:new p.Uniform1f(v),u_temporal_offset:new p.Uniform1f(v),u_horizon_angle:new p.Uniform1f(v),u_rotation_matrix:new p.UniformMatrix4f(v)})};let Ys;function ri(v,l,g,b,I,M,O){const B=v.context,U=B.gl,$=v.transform,q=v.useProgram("collisionBox"),Z=[];let ge=0,De=0;for(let Ye=0;Ye<b.length;Ye++){const Qe=b[Ye],Ge=l.getTile(Qe),it=Ge.getBucket(g);if(!it)continue;const St=mn(Qe,it,$);let zt=St;0===I[0]&&0===I[1]||(zt=v.translatePosMatrix(St,Ge,I,M));const Pt=O?it.textCollisionBox:it.iconCollisionBox,dn=it.collisionCircleArray;if(dn.length>0){const wt=p.create(),en=zt;p.mul(wt,it.placementInvProjMatrix,$.glCoordMatrix),p.mul(wt,wt,it.placementViewportMatrix),Z.push({circleArray:dn,circleOffset:De,transform:en,invTransform:wt,projection:it.getProjection()}),ge+=dn.length/4,De=ge}Pt&&(v.terrain&&v.terrain.setupElevationDraw(Ge,q),q.draw(B,U.LINES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,Ta(zt,$,Ge,it.getProjection()),g.id,Pt.layoutVertexBuffer,Pt.indexBuffer,Pt.segments,null,$.zoom,null,[Pt.collisionVertexBuffer,Pt.collisionVertexBufferExt]))}if(!O||!Z.length)return;const be=v.useProgram("collisionCircle"),Re=new p.StructArrayLayout2f1f2i16;Re.resize(4*ge),Re._trim();let Ce=0;for(const Ye of Z)for(let Qe=0;Qe<Ye.circleArray.length/4;Qe++){const Ge=4*Qe,it=Ye.circleArray[Ge+0],St=Ye.circleArray[Ge+1],zt=Ye.circleArray[Ge+2],Pt=Ye.circleArray[Ge+3];Re.emplace(Ce++,it,St,zt,Pt,0),Re.emplace(Ce++,it,St,zt,Pt,1),Re.emplace(Ce++,it,St,zt,Pt,2),Re.emplace(Ce++,it,St,zt,Pt,3)}(!Ys||Ys.length<2*ge)&&(Ys=function(Ye){const Qe=2*Ye,Ge=new p.StructArrayLayout3ui6;Ge.resize(Qe),Ge._trim();for(let it=0;it<Qe;it++){const St=6*it;Ge.uint16[St+0]=4*it+0,Ge.uint16[St+1]=4*it+1,Ge.uint16[St+2]=4*it+2,Ge.uint16[St+3]=4*it+2,Ge.uint16[St+4]=4*it+3,Ge.uint16[St+5]=4*it+0}return Ge}(ge));const xe=B.createIndexBuffer(Ys,!0),Ne=B.createVertexBuffer(Re,p.collisionCircleLayout.members,!0);for(const Ye of Z){const Qe={u_matrix:Ye.transform,u_inv_matrix:Ye.invTransform,u_camera_to_center_distance:(Se=$).getCameraToCenterDistance(Ye.projection),u_viewport_size:[Se.width,Se.height]};be.draw(B,U.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,v.colorModeForRenderPass(),p.CullFaceMode.disabled,Qe,g.id,Ne,xe,p.SegmentVector.simpleSegment(0,2*Ye.circleOffset,Ye.circleArray.length,Ye.circleArray.length/2),null,$.zoom)}var Se;Ne.destroy(),xe.destroy()}const Bu=p.create();function qo(v,l,g,b,I,M){const{horizontalAlign:O,verticalAlign:B}=p.getAnchorAlignment(v),U=-(O-.5)*l,$=-(B-.5)*g,q=p.evaluateVariableOffset(v,b);return new p.pointGeometry((U/I+q[0])*M,($/I+q[1])*M)}function Rr(v,l,g,b,I,M,O,B,U,$,q){const Z=v.text.placedSymbolArray,ge=v.text.dynamicLayoutVertexArray,De=v.icon.dynamicLayoutVertexArray,be={},Re=Ps(B,v.getProjection(),M),Ce=M.elevation,xe=v.getProjection().upVectorScale(B.canonical,M.center.lat,M.worldSize);ge.clear();for(let Ne=0;Ne<Z.length;Ne++){const Se=Z.get(Ne),Ye=v.allowVerticalPlacement&&!Se.placedOrientation,Qe=Se.hidden||!Se.crossTileID||Ye?null:b[Se.crossTileID];if(Qe){const Ge=new p.pointGeometry(Se.tileAnchorX,Se.tileAnchorY),it=v.getProjection().upVector(B.canonical,Ge.x,Ge.y),St=Ce?Ce.getAtTileOffset(B,Ge.x,Ge.y):0,zt=qn([Se.projectedAnchorX+St*it[0]*xe.metersToTile,Se.projectedAnchorY+St*it[1]*xe.metersToTile,Se.projectedAnchorZ+St*it[2]*xe.metersToTile],g?Re:O),Pt=vr(M.getCameraToCenterDistance(v.getProjection()),zt.signedDistanceFromCamera);let dn=I.evaluateSizeForFeature(v.textSizeData,$,Se)*Pt/p.ONE_EM;g&&(dn*=v.tilePixelRatio/U);const{width:wt,height:en,anchor:Jt,textOffset:Dt,textScale:mt}=Qe,An=qo(Jt,wt,en,Dt,mt,dn);let _n;if(g){const wn=Ge.add(An),{x:Vn,y:mr,z:ir}=v.getProjection().projectTilePoint(wn.x,wn.y,B.canonical);_n=qn([Vn+St*it[0]*xe.metersToTile,mr+St*it[1]*xe.metersToTile,ir+St*it[2]*xe.metersToTile],O).point}else{const wn=l?An.rotate(-M.angle):An;_n=[zt.point[0]+wn.x,zt.point[1]+wn.y,0]}const Cn=v.allowVerticalPlacement&&Se.placedOrientation===p.WritingMode.vertical?Math.PI/2:0;for(let wn=0;wn<Se.numGlyphs;wn++)p.addDynamicAttributes(ge,_n[0],_n[1],_n[2],Cn);q&&Se.associatedIconIndex>=0&&(be[Se.associatedIconIndex]={shiftedAnchor:_n,angle:Cn})}else gr(Se.numGlyphs,ge)}if(q){De.clear();const Ne=v.icon.placedSymbolArray;for(let Se=0;Se<Ne.length;Se++){const Ye=Ne.get(Se);if(Ye.hidden)gr(Ye.numGlyphs,De);else{const Qe=be[Se];if(Qe)for(let Ge=0;Ge<Ye.numGlyphs;Ge++)p.addDynamicAttributes(De,Qe.shiftedAnchor[0],Qe.shiftedAnchor[1],Qe.shiftedAnchor[2],Qe.angle);else gr(Ye.numGlyphs,De)}}v.icon.dynamicLayoutVertexBuffer.updateData(De)}v.text.dynamicLayoutVertexBuffer.updateData(ge)}function Qu(v,l,g){return g.iconsInText&&l?"symbolTextAndIcon":v?"symbolSDF":"symbolIcon"}function ql(v,l,g,b,I,M,O,B,U,$,q,Z){const ge=v.context,De=ge.gl,be=v.transform,Re="map"===B,Ce="map"===U,xe=Re&&"point"!==g.layout.get("symbol-placement"),Ne=Re&&!Ce&&!xe,Se=void 0!==g.layout.get("symbol-sort-key").constantOr(1);let Ye=!1;const Qe=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),Ge=[p.mercatorXfromLng(be.center.lng),p.mercatorYfromLat(be.center.lat)],it=g.layout.get("text-variable-anchor"),St="globe"===be.projection.name,zt=[],Pt=[0,-1,0];let dn=Pt;!St&&!be.mercatorFromTransition||Re||(dn=function(wt){const en=wt._camera.getWorldToCamera(wt.worldSize,1),Jt=p.multiply([],en,wt.globeMatrix);p.invert(Jt,Jt);const Dt=[0,0,0],mt=[0,1,0,0];return p.transformMat4$1(mt,mt,Jt),Dt[0]=mt[0],Dt[1]=mt[1],Dt[2]=mt[2],p.normalize(Dt,Dt),Dt}(be));for(const wt of b){const en=l.getTile(wt),Jt=en.getBucket(g);if(!Jt||"mercator"===Jt.projection.name&&St)continue;const Dt=I?Jt.text:Jt.icon;if(!Dt||Jt.fullyClipped||!Dt.segments.get().length)continue;const mt=Dt.programConfigurations.get(g.id),An=I||Jt.sdfIcons,_n=I?Jt.textSizeData:Jt.iconSizeData,Cn=Ce||0!==be.pitch,wn=p.evaluateSizeForZoom(_n,be.zoom);let Vn,mr,ir,Xn,bn=[0,0],xr=null;if(I){if(mr=en.glyphAtlasTexture,ir=De.LINEAR,Vn=en.glyphAtlasTexture.size,Jt.iconsInText){bn=en.imageAtlasTexture.size,xr=en.imageAtlasTexture;const ua="composite"===_n.kind||"camera"===_n.kind;Xn=Cn||v.options.rotating||v.options.zooming||ua?De.LINEAR:De.NEAREST}}else{const ua=1!==g.layout.get("icon-size").constantOr(0)||Jt.iconsNeedLinear;mr=en.imageAtlasTexture,ir=An||v.options.rotating||v.options.zooming||ua||Cn?De.LINEAR:De.NEAREST,Vn=en.imageAtlasTexture.size}const Fr="globe"===Jt.projection.name,ao=Fr?dn:Pt,Ro=Fr?p.globeToMercatorTransition(be.zoom):0,uo=Ps(wt,Jt.getProjection(),be),aa=be.calculatePixelsToTileUnitsMatrix(en),gu=Yu(uo,en.tileID.canonical,Ce,Re,be,Jt.getProjection(),aa),ya=v.terrain&&Ce&&xe?p.invert(p.create(),gu):Bu,Wo=di(uo,en.tileID.canonical,Ce,Re,be,Jt.getProjection(),aa),Yo=it&&Jt.hasTextData(),Ii="none"!==g.layout.get("icon-text-fit")&&Yo&&Jt.hasIconData();if(xe){const ua=be.elevation,eu=ua?ua.getAtTileOffsetFunc(wt,be.center.lat,be.worldSize,Jt.getProjection()):il=>[0,0,0],$c=Vl(uo,en.tileID.canonical,Ce,Re,be,Jt.getProjection(),aa);pl(Jt,uo,v,I,$c,Wo,Ce,$,eu,wt)}const Us=xe||I&&it||Ii,Ma=v.translatePosMatrix(uo,en,M,O),So=Us?Bu:gu,Mu=v.translatePosMatrix(Wo,en,M,O,!0),jc=Jt.getProjection().createInversionMatrix(be,wt.canonical),rl=[];v.terrainRenderModeElevated()&&Ce&&rl.push("PITCH_WITH_MAP_TERRAIN"),Fr&&rl.push("PROJECTION_GLOBE_VIEW"),Us&&rl.push("PROJECTED_POS_ON_VIEWPORT");const Qa=An&&0!==g.paint.get(I?"text-halo-width":"icon-halo-width").constantOr(1);let ph;ph=An?Jt.iconsInText?ko(_n.kind,wn,Ne,Ce,v,Ma,So,Mu,Vn,bn,wt,Ro,Ge,jc,ao,Jt.getProjection()):Nr(_n.kind,wn,Ne,Ce,v,Ma,So,Mu,I,Vn,!0,wt,Ro,Ge,jc,ao,Jt.getProjection()):Hn(_n.kind,wn,Ne,Ce,v,Ma,So,Mu,I,Vn,wt,Ro,Ge,jc,ao,Jt.getProjection());const Gc={program:v.useProgram(Qu(An,I,Jt),mt,rl),buffers:Dt,uniformValues:ph,atlasTexture:mr,atlasTextureIcon:xr,atlasInterpolation:ir,atlasInterpolationIcon:Xn,isSDF:An,hasHalo:Qa,tile:en,labelPlaneMatrixInv:ya};if(Se&&Jt.canOverlap){Ye=!0;const ua=Dt.segments.get();for(const eu of ua)zt.push({segments:new p.SegmentVector([eu]),sortKey:eu.sortKey,state:Gc})}else zt.push({segments:Dt.segments,sortKey:0,state:Gc})}Ye&&zt.sort((wt,en)=>wt.sortKey-en.sortKey);for(const wt of zt){const en=wt.state;if(v.terrain&&v.terrain.setupElevationDraw(en.tile,en.program,{useDepthForOcclusion:!St,labelPlaneMatrixInv:en.labelPlaneMatrixInv}),ge.activeTexture.set(De.TEXTURE0),en.atlasTexture.bind(en.atlasInterpolation,De.CLAMP_TO_EDGE),en.atlasTextureIcon&&(ge.activeTexture.set(De.TEXTURE1),en.atlasTextureIcon&&en.atlasTextureIcon.bind(en.atlasInterpolationIcon,De.CLAMP_TO_EDGE)),en.isSDF){const Jt=en.uniformValues;en.hasHalo&&(Jt.u_is_halo=1,_l(en.buffers,wt.segments,g,v,en.program,Qe,q,Z,Jt)),Jt.u_is_halo=0}_l(en.buffers,wt.segments,g,v,en.program,Qe,q,Z,en.uniformValues)}}function _l(v,l,g,b,I,M,O,B,U){const $=b.context,q=[v.dynamicLayoutVertexBuffer,v.opacityVertexBuffer,v.globeExtVertexBuffer];I.draw($,$.gl.TRIANGLES,M,O,B,p.CullFaceMode.disabled,U,g.id,v.layoutVertexBuffer,v.indexBuffer,l,g.paint,b.transform.zoom,v.programConfigurations.get(g.id),q)}function Ba(v,l,g,b,I,M,O){const B=v.context.gl,U=g.paint.get("fill-pattern"),$=U&&U.constantOr(1),q=g.getCrossfadeParameters();let Z,ge,De,be,Re;O?(ge=$&&!g.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Z=B.LINES):(ge=$?"fillPattern":"fill",Z=B.TRIANGLES);for(const Ce of b){const xe=l.getTile(Ce);if($&&!xe.patternsLoaded())continue;const Ne=xe.getBucket(g);if(!Ne)continue;v.prepareDrawTile();const Se=Ne.programConfigurations.get(g.id),Ye=v.useProgram(ge,Se);$&&(v.context.activeTexture.set(B.TEXTURE0),xe.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),Se.updatePaintBuffers(q));const Qe=U.constantOr(null);if(Qe&&xe.imageAtlas){const it=xe.imageAtlas,St=it.patternPositions[Qe.to.toString()],zt=it.patternPositions[Qe.from.toString()];St&&zt&&Se.setConstantPatternPositions(St,zt)}const Ge=v.translatePosMatrix(Ce.projMatrix,xe,g.paint.get("fill-translate"),g.paint.get("fill-translate-anchor"));if(O){be=Ne.indexBuffer2,Re=Ne.segments2;const it=v.terrain&&v.terrain.renderingToTexture?v.terrain.drapeBufferSize:[B.drawingBufferWidth,B.drawingBufferHeight];De="fillOutlinePattern"===ge&&$?yl(Ge,v,q,xe,it):mc(Ge,it)}else be=Ne.indexBuffer,Re=Ne.segments,De=$?zu(Ge,v,q,xe):ys(Ge);v.prepareDrawProgram(v.context,Ye,Ce.toUnwrapped()),Ye.draw(v.context,Z,I,v.stencilModeForClipping(Ce),M,p.CullFaceMode.disabled,De,g.id,Ne.layoutVertexBuffer,be,Re,g.paint,v.transform.zoom,Se)}}function Fo(v,l,g,b,I,M,O){const B=v.context,U=B.gl,$=v.transform,q=g.paint.get("fill-extrusion-pattern"),Z=q.constantOr(1),ge=g.getCrossfadeParameters(),De=g.paint.get("fill-extrusion-opacity"),be=[g.paint.get("fill-extrusion-ambient-occlusion-intensity"),g.paint.get("fill-extrusion-ambient-occlusion-radius")],Re=g.layout.get("fill-extrusion-edge-radius"),Ce="globe"===$.projection.name?p.fillExtrusionHeightLift():0,xe="globe"===$.projection.name,Ne=xe?p.globeToMercatorTransition($.zoom):0,Se=[p.mercatorXfromLng($.center.lng),p.mercatorYfromLat($.center.lat)],Ye=[];xe&&(Ye.push("PROJECTION_GLOBE_VIEW"),v.style.terrainSetForDrapingOnly()&&Ye.push("TERRAIN")),be[0]>0&&Ye.push("FAUX_AO");for(const Qe of b){const Ge=l.getTile(Qe),it=Ge.getBucket(g);if(!it||it.projection.name!==$.projection.name)continue;const St=it.programConfigurations.get(g.id),zt=v.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",St,Ye);if(v.terrain){const mt=v.terrain;if(v.style.terrainSetForDrapingOnly())mt.setupElevationDraw(Ge,zt,{useMeterToDem:!0});else{if(!it.enableTerrain)continue;if(mt.setupElevationDraw(Ge,zt,{useMeterToDem:!0}),Ho(B,l,Qe,it,g,mt),!it.centroidVertexBuffer){const An=zt.attributes.a_centroid_pos;void 0!==An&&U.vertexAttrib2f(An,0,0)}}}Z&&(v.context.activeTexture.set(U.TEXTURE0),Ge.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),St.updatePaintBuffers(ge));const Pt=q.constantOr(null);if(Pt&&Ge.imageAtlas){const mt=Ge.imageAtlas,An=mt.patternPositions[Pt.to.toString()],_n=mt.patternPositions[Pt.from.toString()];An&&_n&&St.setConstantPatternPositions(An,_n)}const dn=v.translatePosMatrix(Qe.projMatrix,Ge,g.paint.get("fill-extrusion-translate"),g.paint.get("fill-extrusion-translate-anchor")),wt=$.projection.createInversionMatrix($,Qe.canonical),en=g.paint.get("fill-extrusion-vertical-gradient"),Jt=Z?Zs(dn,v,en,De,be,Re,Qe,ge,Ge,Ce,Ne,Se,wt):Ia(dn,v,en,De,be,Re,Qe,Ce,Ne,Se,wt);v.prepareDrawProgram(B,zt,Qe.toUnwrapped());const Dt=[];v.terrain&&Dt.push(it.centroidVertexBuffer),xe&&Dt.push(it.layoutVertexExtBuffer),zt.draw(B,B.gl.TRIANGLES,I,M,O,p.CullFaceMode.backCCW,Jt,g.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,g.paint,v.transform.zoom,St,Dt)}}function Ho(v,l,g,b,I,M){const O=[xe=>{let Ne=xe.canonical.x-1,Se=xe.wrap;return Ne<0&&(Ne=(1<<xe.canonical.z)-1,Se--),new p.OverscaledTileID(xe.overscaledZ,Se,xe.canonical.z,Ne,xe.canonical.y)},xe=>{let Ne=xe.canonical.x+1,Se=xe.wrap;return Ne===1<<xe.canonical.z&&(Ne=0,Se++),new p.OverscaledTileID(xe.overscaledZ,Se,xe.canonical.z,Ne,xe.canonical.y)},xe=>new p.OverscaledTileID(xe.overscaledZ,xe.wrap,xe.canonical.z,xe.canonical.x,(0===xe.canonical.y?1<<xe.canonical.z:xe.canonical.y)-1),xe=>new p.OverscaledTileID(xe.overscaledZ,xe.wrap,xe.canonical.z,xe.canonical.x,xe.canonical.y===(1<<xe.canonical.z)-1?0:xe.canonical.y+1)],B=xe=>{const Ne=l.getSource().minzoom,Se=Qe=>{const Ge=l.getTileByID(Qe);if(Ge&&Ge.hasData())return Ge.getBucket(I)},Ye=[0,-1,1];for(const Qe of Ye){if(xe.overscaledZ+Qe<Ne)continue;const Ge=Se(xe.calculateScaledKey(xe.overscaledZ+Qe));if(Ge)return Ge}},U=[0,0,0],$=(xe,Ne)=>(U[0]=Math.min(xe.min.y,Ne.min.y),U[1]=Math.max(xe.max.y,Ne.max.y),U[2]=p.EXTENT-Ne.min.x>xe.max.x?Ne.min.x-p.EXTENT:xe.max.x,U),q=(xe,Ne)=>(U[0]=Math.min(xe.min.x,Ne.min.x),U[1]=Math.max(xe.max.x,Ne.max.x),U[2]=p.EXTENT-Ne.min.y>xe.max.y?Ne.min.y-p.EXTENT:xe.max.y,U),Z=[(xe,Ne)=>$(xe,Ne),(xe,Ne)=>$(Ne,xe),(xe,Ne)=>q(xe,Ne),(xe,Ne)=>q(Ne,xe)],ge=new p.pointGeometry(0,0);let De,be,Re;const Ce=(xe,Ne,Se,Ye,Qe)=>{const Ge=[[Ye?Se:xe,Ye?xe:Se,0],[Ye?Se:Ne,Ye?Ne:Se,0]],it=Qe<0?p.EXTENT+Qe:Qe,St=[Ye?it:(xe+Ne)/2,Ye?(xe+Ne)/2:it,0];return 0===Se&&Qe<0||0!==Se&&Qe>0?M.getForTilePoints(Re,[St],!0,be):Ge.push(St),M.getForTilePoints(g,Ge,!0,De),Math.max(Ge[0][2],Ge[1][2],St[2])/M.exaggeration()};for(let xe=0;xe<4;xe++){const Ne=(xe<2?1:5)-xe,Se=b.borders[xe];if(0===Se.length)continue;const Ye=Re=O[xe](g),Qe=B(Ye);if(!(Qe&&Qe instanceof p.FillExtrusionBucket&&Qe.enableTerrain)||b.borderDoneWithNeighborZ[xe]===Qe.canonical.z&&Qe.borderDoneWithNeighborZ[Ne]===b.canonical.z||(be=M.findDEMTileFor(Ye),!be||!be.dem))continue;if(!De){const zt=M.findDEMTileFor(g);if(!zt||!zt.dem)return;De=zt}const Ge=Qe.borders[Ne];let it=0;const St=Qe.borderDoneWithNeighborZ[Ne]!==b.canonical.z;if(b.canonical.z===Qe.canonical.z){for(let zt=0;zt<Se.length;zt++){const Pt=b.featuresOnBorder[Se[zt]],dn=Pt.borders[xe];let wt;for(;it<Ge.length&&(wt=Qe.featuresOnBorder[Ge[it]],!(wt.borders[Ne][1]>dn[0]+3));)St&&Qe.encodeCentroid(void 0,wt,!1),it++;if(wt&&it<Ge.length){const en=it;let Jt=0;for(;!(wt.borders[Ne][0]>dn[1]-3)&&(Jt++,++it!==Ge.length);)wt=Qe.featuresOnBorder[Ge[it]];if(wt=Qe.featuresOnBorder[Ge[en]],Pt.intersectsCount()>1||wt.intersectsCount()>1||1!==Jt){1!==Jt&&(it=en),b.encodeCentroid(void 0,Pt,!1),St&&Qe.encodeCentroid(void 0,wt,!1);continue}const Dt=Z[xe](Pt,wt),mt=xe%2?p.EXTENT-1:0;ge.x=Ce(Dt[0],Math.min(p.EXTENT-1,Dt[1]),mt,xe<2,Dt[2]),ge.y=0,b.encodeCentroid(ge,Pt,!1),St&&Qe.encodeCentroid(ge,wt,!1)}else b.encodeCentroid(void 0,Pt,!1)}b.borderDoneWithNeighborZ[xe]=Qe.canonical.z,b.needsCentroidUpdate=!0,St&&(Qe.borderDoneWithNeighborZ[Ne]=b.canonical.z,Qe.needsCentroidUpdate=!0)}else{for(const zt of Se)b.encodeCentroid(void 0,b.featuresOnBorder[zt],!1);if(St){for(const zt of Ge)Qe.encodeCentroid(void 0,Qe.featuresOnBorder[zt],!1);Qe.borderDoneWithNeighborZ[Ne]=b.canonical.z,Qe.needsCentroidUpdate=!0}b.borderDoneWithNeighborZ[xe]=Qe.canonical.z,b.needsCentroidUpdate=!0}}(b.needsCentroidUpdate||!b.centroidVertexBuffer&&0!==b.centroidVertexArray.length)&&b.uploadCentroid(v)}const Os=new p.Color(1,0,0,1),Ao=new p.Color(0,1,0,1),yc=new p.Color(0,0,1,1),Uu=new p.Color(1,0,1,1),Mi=new p.Color(0,1,1,1);function is(v,l,g){const b=v.context,I=v.transform,M=b.gl,O="globe"===I.projection.name,B=O?["PROJECTION_GLOBE_VIEW"]:null;let U=g.projMatrix;if(O&&p.globeToMercatorTransition(I.zoom)>0){const Pt=p.transitionTileAABBinECEF(g.canonical,I),dn=p.globeDenormalizeECEF(Pt);U=p.multiply(new Float32Array(16),I.globeMatrix,dn),p.multiply(U,I.projMatrix,U)}const $=v.useProgram("debug",null,B),q=l.getTileByID(g.key);v.terrain&&v.terrain.setupElevationDraw(q,$);const Z=p.DepthMode.disabled,ge=p.StencilMode.disabled,De=v.colorModeForRenderPass();b.activeTexture.set(M.TEXTURE0),v.emptyTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),O?q._makeGlobeTileDebugBuffers(v.context,I):q._makeDebugTileBoundsBuffers(v.context,I.projection);const Re=q._tileDebugBuffer||v.debugBuffer,Ce=q._tileDebugIndexBuffer||v.debugIndexBuffer,xe=q._tileDebugSegments||v.debugSegments;$.draw(b,M.LINE_STRIP,Z,ge,De,p.CullFaceMode.disabled,Ls(U,p.Color.red),"$debug",Re,Ce,xe,null,null,null,[q._globeTileDebugBorderBuffer]);const Ne=q.latestRawTileData,Se=Math.floor((Ne&&Ne.byteLength||0)/1024),Ye=l.getTile(g).tileSize,Qe=512/Math.min(Ye,512)*(g.overscaledZ/I.zoom)*.5;let Ge=g.canonical.toString();g.overscaledZ!==g.canonical.z&&(Ge+=` => ${g.overscaledZ}`),Ge+=` ${Se}kb`,function(Pt,dn){Pt.initDebugOverlayCanvas();const wt=Pt.debugOverlayCanvas,en=Pt.context.gl,Jt=Pt.debugOverlayCanvas.getContext("2d");Jt.clearRect(0,0,wt.width,wt.height),Jt.shadowColor="white",Jt.shadowBlur=2,Jt.lineWidth=1.5,Jt.strokeStyle="white",Jt.textBaseline="top",Jt.font="bold 36px Open Sans, sans-serif",Jt.fillText(dn,5,5),Jt.strokeText(dn,5,5),Pt.debugOverlayTexture.update(wt),Pt.debugOverlayTexture.bind(en.LINEAR,en.CLAMP_TO_EDGE)}(v,Ge);const it=q._tileDebugTextBuffer||v.debugBuffer,St=q._tileDebugTextIndexBuffer||v.quadTriangleIndexBuffer,zt=q._tileDebugTextSegments||v.debugSegments;$.draw(b,M.TRIANGLES,Z,ge,p.ColorMode.alphaBlended,p.CullFaceMode.disabled,Ls(U,p.Color.transparent,Qe),"$debug",it,St,zt,null,null,null,[q._globeTileDebugTextBuffer])}function Xo(v,l,g,b){os(v,0,l+g/2,v.transform.width,g,b)}function Ua(v,l,g,b){os(v,l-g/2,0,g,v.transform.height,b)}function os(v,l,g,b,I,M){const O=v.context,B=O.gl;B.enable(B.SCISSOR_TEST),B.scissor(l*p.exported.devicePixelRatio,g*p.exported.devicePixelRatio,b*p.exported.devicePixelRatio,I*p.exported.devicePixelRatio),O.clear({color:M}),B.disable(B.SCISSOR_TEST)}const Vu=p.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:du}=Vu;function so(v,l,g,b){v.emplaceBack(l,g,b)}class Lr{constructor(l){this.vertexArray=new p.StructArrayLayout3f12,this.indices=new p.StructArrayLayout3ui6,so(this.vertexArray,-1,-1,1),so(this.vertexArray,1,-1,1),so(this.vertexArray,-1,1,1),so(this.vertexArray,1,1,1),so(this.vertexArray,-1,-1,-1),so(this.vertexArray,1,-1,-1),so(this.vertexArray,-1,1,-1),so(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=l.createVertexBuffer(this.vertexArray,du),this.indexBuffer=l.createIndexBuffer(this.indices),this.segment=p.SegmentVector.simpleSegment(0,0,36,12)}}function vs(v,l,g,b,I,M){const O=v.gl,B=l.paint.get("sky-atmosphere-color"),U=l.paint.get("sky-atmosphere-halo-color"),$=l.paint.get("sky-atmosphere-sun-intensity"),q={u_matrix_3f:p.fromMat4(p.create$1(),b),u_sun_direction:I,u_sun_intensity:$,u_color_tint_r:[(be=B).r,be.g,be.b,be.a],u_color_tint_m:[(Re=U).r,Re.g,Re.b,Re.a],u_luminance:5e-5};var be,Re;O.framebufferTexture2D(O.FRAMEBUFFER,O.COLOR_ATTACHMENT0,O.TEXTURE_CUBE_MAP_POSITIVE_X+M,l.skyboxTexture,0),g.draw(v,O.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,p.ColorMode.unblended,p.CullFaceMode.frontCW,q,"skyboxCapture",l.skyboxGeometry.vertexBuffer,l.skyboxGeometry.indexBuffer,l.skyboxGeometry.segment)}const vo=p.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Uc{constructor(l){const g=new p.StructArrayLayout5f20;g.emplaceBack(-1,1,1,0,0),g.emplaceBack(1,1,1,1,0),g.emplaceBack(1,-1,1,1,1),g.emplaceBack(-1,-1,1,0,1);const b=new p.StructArrayLayout3ui6;b.emplaceBack(0,1,2),b.emplaceBack(2,3,0),this.vertexBuffer=l.createVertexBuffer(g,vo.members),this.indexBuffer=l.createIndexBuffer(b),this.segments=p.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ts={symbol:function(v,l,g,b,I){if("translucent"!==v.renderPass)return;const M=p.StencilMode.disabled,O=v.colorModeForRenderPass();g.layout.get("text-variable-anchor")&&function(B,U,$,q,Z,ge,De){const be=U.transform,Re="map"===Z,Ce="map"===ge;for(const xe of B){const Ne=q.getTile(xe),Se=Ne.getBucket($);if(!Se||!Se.text||!Se.text.segments.get().length)continue;const Ye=p.evaluateSizeForZoom(Se.textSizeData,be.zoom),Qe=Ps(xe,Se.getProjection(),be),Ge=be.calculatePixelsToTileUnitsMatrix(Ne),it=Yu(Qe,Ne.tileID.canonical,Ce,Re,be,Se.getProjection(),Ge),St="none"!==$.layout.get("icon-text-fit")&&Se.hasIconData();if(Ye){const zt=Math.pow(2,be.zoom-Ne.tileID.overscaledZ);Rr(Se,Re,Ce,De,p.symbolSize,be,it,xe,zt,Ye,St)}}}(b,v,g,l,g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),I),0!==g.paint.get("icon-opacity").constantOr(1)&&ql(v,l,g,b,!1,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),g.layout.get("icon-rotation-alignment"),g.layout.get("icon-pitch-alignment"),g.layout.get("icon-keep-upright"),M,O),0!==g.paint.get("text-opacity").constantOr(1)&&ql(v,l,g,b,!0,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),g.layout.get("text-rotation-alignment"),g.layout.get("text-pitch-alignment"),g.layout.get("text-keep-upright"),M,O),l.map.showCollisionBoxes&&(ri(v,l,g,b,g.paint.get("text-translate"),g.paint.get("text-translate-anchor"),!0),ri(v,l,g,b,g.paint.get("icon-translate"),g.paint.get("icon-translate-anchor"),!1))},circle:function(v,l,g,b){if("translucent"!==v.renderPass)return;const I=g.paint.get("circle-opacity"),M=g.paint.get("circle-stroke-width"),O=g.paint.get("circle-stroke-opacity"),B=void 0!==g.layout.get("circle-sort-key").constantOr(1);if(0===I.constantOr(1)&&(0===M.constantOr(1)||0===O.constantOr(1)))return;const U=v.context,$=U.gl,q=v.transform,Z=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),ge=p.StencilMode.disabled,De=v.colorModeForRenderPass(),be="globe"===q.projection.name,Re=[p.mercatorXfromLng(q.center.lng),p.mercatorYfromLat(q.center.lat)],Ce=[];for(let Ne=0;Ne<b.length;Ne++){const Se=b[Ne],Ye=l.getTile(Se),Qe=Ye.getBucket(g);if(!Qe||Qe.projection.name!==q.projection.name)continue;const Ge=Qe.programConfigurations.get(g.id),it=pa(g);be&&it.push("PROJECTION_GLOBE_VIEW");const St=v.useProgram("circle",Ge,it),zt=Qe.layoutVertexBuffer,Pt=Qe.globeExtVertexBuffer,dn=Qe.indexBuffer,wt=q.projection.createInversionMatrix(q,Se.canonical),en={programConfiguration:Ge,program:St,layoutVertexBuffer:zt,globeExtVertexBuffer:Pt,indexBuffer:dn,uniformValues:Du(v,Se,Ye,wt,Re,g),tile:Ye};if(B){const Jt=Qe.segments.get();for(const Dt of Jt)Ce.push({segments:new p.SegmentVector([Dt]),sortKey:Dt.sortKey,state:en})}else Ce.push({segments:Qe.segments,sortKey:0,state:en})}B&&Ce.sort((Ne,Se)=>Ne.sortKey-Se.sortKey);const xe={useDepthForOcclusion:!be};for(const Ne of Ce){const{programConfiguration:Se,program:Ye,layoutVertexBuffer:Qe,globeExtVertexBuffer:Ge,indexBuffer:it,uniformValues:St,tile:zt}=Ne.state,Pt=Ne.segments;v.terrain&&v.terrain.setupElevationDraw(zt,Ye,xe),v.prepareDrawProgram(U,Ye,zt.tileID.toUnwrapped()),Ye.draw(U,$.TRIANGLES,Z,ge,De,p.CullFaceMode.disabled,St,g.id,Qe,it,Pt,g.paint,q.zoom,Se,[Ge])}},heatmap:function(v,l,g,b){if(0!==g.paint.get("heatmap-opacity"))if("offscreen"===v.renderPass){const I=v.context,M=I.gl,O=p.StencilMode.disabled,B=new p.ColorMode([M.ONE,M.ONE],p.Color.transparent,[!0,!0,!0,!0]);(function(De,be,Re,Ce){const xe=De.gl,Ne=be.width*Ce,Se=be.height*Ce;De.activeTexture.set(xe.TEXTURE1),De.viewport.set([0,0,Ne,Se]);let Ye=Re.heatmapFbo;if(!Ye||Ye&&(Ye.width!==Ne||Ye.height!==Se)){Ye&&Ye.destroy();const Qe=xe.createTexture();xe.bindTexture(xe.TEXTURE_2D,Qe),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_S,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_WRAP_T,xe.CLAMP_TO_EDGE),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MIN_FILTER,xe.LINEAR),xe.texParameteri(xe.TEXTURE_2D,xe.TEXTURE_MAG_FILTER,xe.LINEAR),Ye=Re.heatmapFbo=De.createFramebuffer(Ne,Se,!1),function(Ge,it,St,zt,Pt,dn){const wt=Ge.gl;wt.texImage2D(wt.TEXTURE_2D,0,wt.RGBA,Pt,dn,0,wt.RGBA,Ge.extRenderToTextureHalfFloat?Ge.extTextureHalfFloat.HALF_FLOAT_OES:wt.UNSIGNED_BYTE,null),zt.colorAttachment.set(St)}(De,0,Qe,Ye,Ne,Se)}else xe.bindTexture(xe.TEXTURE_2D,Ye.colorAttachment.get()),De.bindFramebuffer.set(Ye.framebuffer)})(I,v,g,"globe"===v.transform.projection.name?.5:.25),I.clear({color:p.Color.transparent});const U=v.transform,$="globe"===U.projection.name,q=$?["PROJECTION_GLOBE_VIEW"]:null,Z=$?p.CullFaceMode.frontCCW:p.CullFaceMode.disabled,ge=[p.mercatorXfromLng(U.center.lng),p.mercatorYfromLat(U.center.lat)];for(let De=0;De<b.length;De++){const be=b[De];if(l.hasRenderableParent(be))continue;const Re=l.getTile(be),Ce=Re.getBucket(g);if(!Ce||Ce.projection.name!==U.projection.name)continue;const xe=Ce.programConfigurations.get(g.id),Ne=v.useProgram("heatmap",xe,q),{zoom:Se}=v.transform;v.terrain&&v.terrain.setupElevationDraw(Re,Ne),v.prepareDrawProgram(I,Ne,be.toUnwrapped());const Ye=U.projection.createInversionMatrix(U,be.canonical);Ne.draw(I,M.TRIANGLES,p.DepthMode.disabled,O,B,Z,fu(v,be,Re,Ye,ge,Se,g.paint.get("heatmap-intensity")),g.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,g.paint,v.transform.zoom,xe,$?[Ce.globeExtVertexBuffer]:null)}I.viewport.set([0,0,v.width,v.height])}else"translucent"===v.renderPass&&(v.context.setColorMode(v.colorModeForRenderPass()),function(I,M){const O=I.context,B=O.gl,U=M.heatmapFbo;if(!U)return;O.activeTexture.set(B.TEXTURE0),B.bindTexture(B.TEXTURE_2D,U.colorAttachment.get()),O.activeTexture.set(B.TEXTURE1);let $=M.colorRampTexture;$||($=M.colorRampTexture=new p.Texture(O,M.colorRamp,B.RGBA)),$.bind(B.LINEAR,B.CLAMP_TO_EDGE),I.useProgram("heatmapTexture").draw(O,B.TRIANGLES,p.DepthMode.disabled,p.StencilMode.disabled,I.colorModeForRenderPass(),p.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:M.paint.get("heatmap-opacity")},M.id,I.viewportBuffer,I.quadTriangleIndexBuffer,I.viewportSegments,M.paint,I.transform.zoom)}(v,g))},line:function(v,l,g,b){if("translucent"!==v.renderPass)return;const I=g.paint.get("line-opacity"),M=g.paint.get("line-width");if(0===I.constantOr(1)||0===M.constantOr(1))return;const O=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),B=v.colorModeForRenderPass(),U=v.terrain&&v.terrain.renderingToTexture?1:p.exported.devicePixelRatio,$=g.paint.get("line-dasharray"),q=$.constantOr(1),Z=g.layout.get("line-cap"),ge=g.paint.get("line-pattern"),De=ge.constantOr(1),be=g.paint.get("line-gradient"),Re=g.getCrossfadeParameters(),Ce=De?"linePattern":"line",xe=v.context,Ne=xe.gl,Se=(Qe=>{const Ge=[];hs(Qe)&&Ge.push("RENDER_LINE_DASH"),Qe.paint.get("line-gradient")&&Ge.push("RENDER_LINE_GRADIENT");const it=Qe.paint.get("line-trim-offset");0===it[0]&&0===it[1]||Ge.push("RENDER_LINE_TRIM_OFFSET");const St=Qe.paint.get("line-pattern").constantOr(1),zt=1!==Qe.paint.get("line-opacity").constantOr(1);return!St&&zt&&Ge.push("RENDER_LINE_ALPHA_DISCARD"),Ge})(g);let Ye=Se.includes("RENDER_LINE_ALPHA_DISCARD");v.terrain&&v.terrain.clipOrMaskOverlapStencilType()&&(Ye=!1);for(const Qe of b){const Ge=l.getTile(Qe);if(De&&!Ge.patternsLoaded())continue;const it=Ge.getBucket(g);if(!it)continue;v.prepareDrawTile();const St=it.programConfigurations.get(g.id),zt=v.useProgram(Ce,St,Se),Pt=ge.constantOr(null);if(Pt&&Ge.imageAtlas){const _n=Ge.imageAtlas,Cn=_n.patternPositions[Pt.to.toString()],wn=_n.patternPositions[Pt.from.toString()];Cn&&wn&&St.setConstantPatternPositions(Cn,wn)}const dn=$.constantOr(null),wt=Z.constantOr(null);if(!De&&dn&&wt&&Ge.lineAtlas){const _n=Ge.lineAtlas,Cn=_n.getDash(dn.to,wt),wn=_n.getDash(dn.from,wt);Cn&&wn&&St.setConstantPatternPositions(Cn,wn)}let[en,Jt]=g.paint.get("line-trim-offset");("round"===wt||"square"===wt)&&en!==Jt&&(0===en&&(en-=1),1===Jt&&(Jt+=1));const Dt=v.terrain?Qe.projMatrix:null,mt=De?ma(v,Ge,g,Re,Dt,U):vi(v,Ge,g,Re,Dt,it.lineClipsArray.length,U,[en,Jt]);if(be){const _n=it.gradients[g.id];let Cn=_n.texture;if(g.gradientVersion!==_n.version){let wn=256;if(g.stepInterpolant){const Vn=l.getSource().maxzoom,mr=Qe.canonical.z===Vn?Math.ceil(1<<v.transform.maxZoom-Qe.canonical.z):1;wn=p.clamp(p.nextPowerOfTwo(it.maxLineLength/p.EXTENT*1024*mr),256,xe.maxTextureSize)}_n.gradient=p.renderColorRamp({expression:g.gradientExpression(),evaluationKey:"lineProgress",resolution:wn,image:_n.gradient||void 0,clips:it.lineClipsArray}),_n.texture?_n.texture.update(_n.gradient):_n.texture=new p.Texture(xe,_n.gradient,Ne.RGBA),_n.version=g.gradientVersion,Cn=_n.texture}xe.activeTexture.set(Ne.TEXTURE1),Cn.bind(g.stepInterpolant?Ne.NEAREST:Ne.LINEAR,Ne.CLAMP_TO_EDGE)}q&&(xe.activeTexture.set(Ne.TEXTURE0),Ge.lineAtlasTexture.bind(Ne.LINEAR,Ne.REPEAT),St.updatePaintBuffers(Re)),De&&(xe.activeTexture.set(Ne.TEXTURE0),Ge.imageAtlasTexture.bind(Ne.LINEAR,Ne.CLAMP_TO_EDGE),St.updatePaintBuffers(Re)),v.prepareDrawProgram(xe,zt,Qe.toUnwrapped());const An=_n=>{zt.draw(xe,Ne.TRIANGLES,O,_n,B,p.CullFaceMode.disabled,mt,g.id,it.layoutVertexBuffer,it.indexBuffer,it.segments,g.paint,v.transform.zoom,St,[it.layoutVertexBuffer2])};if(Ye){const _n=v.stencilModeForClipping(Qe).ref;0===_n&&v.terrain&&xe.clear({stencil:0});const Cn={func:Ne.EQUAL,mask:255};mt.u_alpha_discard_threshold=.8,An(new p.StencilMode(Cn,_n,255,Ne.KEEP,Ne.KEEP,Ne.INVERT)),mt.u_alpha_discard_threshold=0,An(new p.StencilMode(Cn,_n,255,Ne.KEEP,Ne.KEEP,Ne.KEEP))}else An(v.stencilModeForClipping(Qe))}Ye&&(v.resetStencilClippingMasks(),v.terrain&&xe.clear({stencil:0}))},fill:function(v,l,g,b){const I=g.paint.get("fill-color"),M=g.paint.get("fill-opacity");if(0===M.constantOr(1))return;const O=v.colorModeForRenderPass(),B=g.paint.get("fill-pattern"),U=v.opaquePassEnabledForLayer()&&!B.constantOr(1)&&1===I.constantOr(p.Color.transparent).a&&1===M.constantOr(0)?"opaque":"translucent";if(v.renderPass===U){const $=v.depthModeForSublayer(1,"opaque"===v.renderPass?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly);Ba(v,l,g,b,$,O,!1)}if("translucent"===v.renderPass&&g.paint.get("fill-antialias")){const $=v.depthModeForSublayer(g.getPaintProperty("fill-outline-color")?2:0,p.DepthMode.ReadOnly);Ba(v,l,g,b,$,O,!0)}},"fill-extrusion":function(v,l,g,b){const I=g.paint.get("fill-extrusion-opacity");if(0!==I&&"translucent"===v.renderPass){const M=new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D);if(1!==I||g.paint.get("fill-extrusion-pattern").constantOr(1))Fo(v,l,g,b,M,p.StencilMode.disabled,p.ColorMode.disabled),Fo(v,l,g,b,M,v.stencilModeFor3D(),v.colorModeForRenderPass()),v.resetStencilClippingMasks();else{const O=v.colorModeForRenderPass();Fo(v,l,g,b,M,p.StencilMode.disabled,O)}}},hillshade:function(v,l,g,b){if("offscreen"!==v.renderPass&&"translucent"!==v.renderPass)return;const I=v.context,M=v.depthModeForSublayer(0,p.DepthMode.ReadOnly),O=v.colorModeForRenderPass(),B=v.terrain&&v.terrain.renderingToTexture,[U,$]="translucent"!==v.renderPass||B?[{},b]:v.stencilConfigForOverlap(b);for(const q of $){const Z=l.getTile(q);if(Z.needsHillshadePrepare&&"offscreen"===v.renderPass)Pn(v,Z,g,M,p.StencilMode.disabled,O);else if("translucent"===v.renderPass){const ge=B&&v.terrain?v.terrain.stencilModeForRTTOverlap(q):U[q.overscaledZ];Nu(v,q,Z,g,M,ge,O)}}I.viewport.set([0,0,v.width,v.height]),v.resetStencilClippingMasks()},raster:function(v,l,g,b,I,M){if("translucent"!==v.renderPass||0===g.paint.get("raster-opacity")||!b.length)return;const O=v.context,B=O.gl,U=l.getSource(),$=v.useProgram("raster"),q=v.colorModeForRenderPass(),Z=v.terrain&&v.terrain.renderingToTexture,[ge,De]=U instanceof nt||Z?[{},b]:v.stencilConfigForOverlap(b),be=De[De.length-1].overscaledZ,Re=!v.options.moving;for(const Ce of De){const xe=Z?p.DepthMode.disabled:v.depthModeForSublayer(Ce.overscaledZ-be,1===g.paint.get("raster-opacity")?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly,B.LESS),Ne=Ce.toUnwrapped(),Se=l.getTile(Ce);if(Z&&(!Se||!Se.hasData()))continue;const Ye=Z?Ce.projMatrix:v.transform.calculateProjMatrix(Ne,Re),Qe=v.terrain&&Z?v.terrain.stencilModeForRTTOverlap(Ce):ge[Ce.overscaledZ],Ge=M?0:g.paint.get("raster-fade-duration");Se.registerFadeDuration(Ge);const it=l.findLoadedParent(Ce,0),St=Xa(Se,it,l,v.transform,Ge);let zt,Pt;v.terrain&&v.terrain.prepareDrawTile();const dn="nearest"===g.paint.get("raster-resampling")?B.NEAREST:B.LINEAR;O.activeTexture.set(B.TEXTURE0),Se.texture.bind(dn,B.CLAMP_TO_EDGE),O.activeTexture.set(B.TEXTURE1),it?(it.texture.bind(dn,B.CLAMP_TO_EDGE),zt=Math.pow(2,it.tileID.overscaledZ-Se.tileID.overscaledZ),Pt=[Se.tileID.canonical.x*zt%1,Se.tileID.canonical.y*zt%1]):Se.texture.bind(dn,B.CLAMP_TO_EDGE);const wt=Ws(Ye,Pt||[0,0],zt||1,St,g,U instanceof nt?U.perspectiveTransform:[0,0]);if(v.prepareDrawProgram(O,$,Ne),U instanceof nt)U.boundsBuffer&&U.boundsSegments&&$.draw(O,B.TRIANGLES,xe,p.StencilMode.disabled,q,p.CullFaceMode.disabled,wt,g.id,U.boundsBuffer,v.quadTriangleIndexBuffer,U.boundsSegments);else{const{tileBoundsBuffer:en,tileBoundsIndexBuffer:Jt,tileBoundsSegments:Dt}=v.getTileBoundsBuffers(Se);$.draw(O,B.TRIANGLES,xe,Qe,q,p.CullFaceMode.disabled,wt,g.id,en,Jt,Dt)}}v.resetStencilClippingMasks()},background:function(v,l,g,b){const I=g.paint.get("background-color"),M=g.paint.get("background-opacity");if(0===M)return;const O=v.context,B=O.gl,U=v.transform,$=U.tileSize,q=g.paint.get("background-pattern");if(v.isPatternMissing(q))return;const Z=!q&&1===I.a&&1===M&&v.opaquePassEnabledForLayer()?"opaque":"translucent";if(v.renderPass!==Z)return;const ge=p.StencilMode.disabled,De=v.depthModeForSublayer(0,"opaque"===Z?p.DepthMode.ReadWrite:p.DepthMode.ReadOnly),be=v.colorModeForRenderPass(),Re=v.useProgram(q?"backgroundPattern":"background");let Ce,xe=b;xe||(Ce=v.getBackgroundTiles(),xe=Object.values(Ce).map(Se=>Se.tileID)),q&&(O.activeTexture.set(B.TEXTURE0),v.imageManager.bind(v.context));const Ne=g.getCrossfadeParameters();for(const Se of xe){const Ye=Se.toUnwrapped(),Qe=b?Se.projMatrix:v.transform.calculateProjMatrix(Ye);v.prepareDrawTile();const Ge=l?l.getTile(Se):Ce?Ce[Se.key]:new p.Tile(Se,$,U.zoom,v),it=q?$l(Qe,M,v,q,{tileID:Se,tileSize:$},Ne):Wa(Qe,M,I);v.prepareDrawProgram(O,Re,Ye);const{tileBoundsBuffer:St,tileBoundsIndexBuffer:zt,tileBoundsSegments:Pt}=v.getTileBoundsBuffers(Ge);Re.draw(O,B.TRIANGLES,De,ge,be,p.CullFaceMode.disabled,it,g.id,St,zt,Pt)}},sky:function(v,l,g){const b=v.transform,I="mercator"===b.projection.name||"globe"===b.projection.name?1:p.smoothstep(7,8,b.zoom),M=g.paint.get("sky-opacity")*I;if(0===M)return;const O=v.context,B=g.paint.get("sky-type"),U=new p.DepthMode(O.gl.LEQUAL,p.DepthMode.ReadOnly,[0,1]),$=v.frameCounter/1e3%1;"atmosphere"===B?"offscreen"===v.renderPass?g.needsSkyboxCapture(v)&&(function(q,Z,ge,De){const be=q.context,Re=be.gl;let Ce=Z.skyboxFbo;if(!Ce){Ce=Z.skyboxFbo=be.createFramebuffer(32,32,!1),Z.skyboxGeometry=new Lr(be),Z.skyboxTexture=be.gl.createTexture(),Re.bindTexture(Re.TEXTURE_CUBE_MAP,Z.skyboxTexture),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_WRAP_S,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_WRAP_T,Re.CLAMP_TO_EDGE),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_MIN_FILTER,Re.LINEAR),Re.texParameteri(Re.TEXTURE_CUBE_MAP,Re.TEXTURE_MAG_FILTER,Re.LINEAR);for(let Ye=0;Ye<6;++Ye)Re.texImage2D(Re.TEXTURE_CUBE_MAP_POSITIVE_X+Ye,0,Re.RGBA,32,32,0,Re.RGBA,Re.UNSIGNED_BYTE,null)}be.bindFramebuffer.set(Ce.framebuffer),be.viewport.set([0,0,32,32]);const xe=Z.getCenter(q,!0),Ne=q.useProgram("skyboxCapture"),Se=new Float64Array(16);p.identity(Se),p.rotateY(Se,Se,.5*-Math.PI),vs(be,Z,Ne,Se,xe,0),p.identity(Se),p.rotateY(Se,Se,.5*Math.PI),vs(be,Z,Ne,Se,xe,1),p.identity(Se),p.rotateX(Se,Se,.5*-Math.PI),vs(be,Z,Ne,Se,xe,2),p.identity(Se),p.rotateX(Se,Se,.5*Math.PI),vs(be,Z,Ne,Se,xe,3),p.identity(Se),vs(be,Z,Ne,Se,xe,4),p.identity(Se),p.rotateY(Se,Se,Math.PI),vs(be,Z,Ne,Se,xe,5),be.viewport.set([0,0,q.width,q.height])}(v,g),g.markSkyboxValid(v)):"sky"===v.renderPass&&function(q,Z,ge,De,be){const Re=q.context,Ce=Re.gl,xe=q.transform,Ne=q.useProgram("skybox");Re.activeTexture.set(Ce.TEXTURE0),Ce.bindTexture(Ce.TEXTURE_CUBE_MAP,Z.skyboxTexture);const Se={u_matrix:xe.skyboxMatrix,u_sun_direction:Z.getCenter(q,!1),u_cubemap:0,u_opacity:De,u_temporal_offset:be};q.prepareDrawProgram(Re,Ne),Ne.draw(Re,Ce.TRIANGLES,ge,p.StencilMode.disabled,q.colorModeForRenderPass(),p.CullFaceMode.backCW,Se,"skybox",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,g,U,M,$):"gradient"===B&&"sky"===v.renderPass&&function(q,Z,ge,De,be){const Re=q.context,Ce=Re.gl,xe=q.transform,Ne=q.useProgram("skyboxGradient");Z.skyboxGeometry||(Z.skyboxGeometry=new Lr(Re)),Re.activeTexture.set(Ce.TEXTURE0);let Se=Z.colorRampTexture;Se||(Se=Z.colorRampTexture=new p.Texture(Re,Z.colorRamp,Ce.RGBA)),Se.bind(Ce.LINEAR,Ce.CLAMP_TO_EDGE);const Ye=(Qe=xe.skyboxMatrix,Ge=Z.getCenter(q,!1),it=Z.paint.get("sky-gradient-radius"),St=De,zt=be,{u_matrix:Qe,u_color_ramp:0,u_center_direction:Ge,u_radius:p.degToRad(it),u_opacity:St,u_temporal_offset:zt});var Qe,Ge,it,St,zt;q.prepareDrawProgram(Re,Ne),Ne.draw(Re,Ce.TRIANGLES,ge,p.StencilMode.disabled,q.colorModeForRenderPass(),p.CullFaceMode.backCW,Ye,"skyboxGradient",Z.skyboxGeometry.vertexBuffer,Z.skyboxGeometry.indexBuffer,Z.skyboxGeometry.segment)}(v,g,U,M,$)},debug:function(v,l,g){for(let b=0;b<g.length;b++)is(v,l,g[b])},custom:function(v,l,g){const b=v.context,I=g.implementation;if(v.transform.projection.unsupportedLayers&&v.transform.projection.unsupportedLayers.includes("custom"))p.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===v.renderPass){const M=I.prerender;M&&(v.setCustomLayerDefaults(),b.setColorMode(v.colorModeForRenderPass()),M.call(I,b.gl,v.transform.customLayerMatrix()),b.setDirty(),v.setBaseState())}else if("translucent"===v.renderPass){v.setCustomLayerDefaults(),b.setColorMode(v.colorModeForRenderPass()),b.setStencilMode(p.StencilMode.disabled);const M="3d"===I.renderingMode?new p.DepthMode(v.context.gl.LEQUAL,p.DepthMode.ReadWrite,v.depthRangeFor3D):v.depthModeForSublayer(0,p.DepthMode.ReadOnly);b.setDepthMode(M),I.render(b.gl,v.transform.customLayerMatrix()),b.setDirty(),v.setBaseState(),b.bindFramebuffer.set(null)}}};class fs{constructor(l,g){this.context=new W(l),this.transform=g,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=p.SourceCache.maxUnderzooming+p.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ml,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(l,g){const b=!!l&&!!l.terrain&&this.transform.projection.supportsTerrain;if(!(b||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new oa(this,l));const I=this._terrain;this.transform.elevation=b?I:null,I.update(l,this.transform,g)}_updateFog(l){const g=l.fog;if(!g||"globe"===this.transform.projection.name||g.getOpacity(this.transform.pitch)<1||g.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[b,I]=g.getFovAdjustedRange(this.transform._fov);if(b>I)return void(this.transform.fogCullDistSq=null);const M=b+.78*(I-b);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(l,g){if(this.width=l*p.exported.devicePixelRatio,this.height=g*p.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const b of this.style.order)this.style._layers[b].resize()}setup(){const l=this.context,g=new p.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(p.EXTENT,0),g.emplaceBack(0,p.EXTENT),g.emplaceBack(p.EXTENT,p.EXTENT),this.tileExtentBuffer=l.createVertexBuffer(g,p.posAttributes.members),this.tileExtentSegments=p.SegmentVector.simpleSegment(0,0,4,2);const b=new p.StructArrayLayout2i4;b.emplaceBack(0,0),b.emplaceBack(p.EXTENT,0),b.emplaceBack(0,p.EXTENT),b.emplaceBack(p.EXTENT,p.EXTENT),this.debugBuffer=l.createVertexBuffer(b,p.posAttributes.members),this.debugSegments=p.SegmentVector.simpleSegment(0,0,4,5);const I=new p.StructArrayLayout2i4;I.emplaceBack(-1,-1),I.emplaceBack(1,-1),I.emplaceBack(-1,1),I.emplaceBack(1,1),this.viewportBuffer=l.createVertexBuffer(I,p.posAttributes.members),this.viewportSegments=p.SegmentVector.simpleSegment(0,0,4,2);const M=new p.StructArrayLayout4i8;M.emplaceBack(0,0,0,0),M.emplaceBack(p.EXTENT,0,p.EXTENT,0),M.emplaceBack(0,p.EXTENT,0,p.EXTENT),M.emplaceBack(p.EXTENT,p.EXTENT,p.EXTENT,p.EXTENT),this.mercatorBoundsBuffer=l.createVertexBuffer(M,p.boundsAttributes.members),this.mercatorBoundsSegments=p.SegmentVector.simpleSegment(0,0,4,2);const O=new p.StructArrayLayout3ui6;O.emplaceBack(0,1,2),O.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=l.createIndexBuffer(O);const B=new p.StructArrayLayout1ui2;for(const $ of[0,1,3,2,0])B.emplaceBack($);this.debugIndexBuffer=l.createIndexBuffer(B),this.emptyTexture=new p.Texture(l,new p.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),l.gl.RGBA),this.identityMat=p.create();const U=this.context.gl;this.stencilClearMode=new p.StencilMode({func:U.ALWAYS,mask:0},0,255,U.ZERO,U.ZERO,U.ZERO),this.loadTimeStamps.push(p.window.performance.now()),this.atmosphereBuffer=new Uc(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(l){return l._makeTileBoundsBuffers(this.context,this.transform.projection),l._tileBoundsBuffer?{tileBoundsBuffer:l._tileBoundsBuffer,tileBoundsIndexBuffer:l._tileBoundsIndexBuffer,tileBoundsSegments:l._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const l=this.context,g=l.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(l,g.TRIANGLES,p.DepthMode.disabled,this.stencilClearMode,p.ColorMode.disabled,p.CullFaceMode.disabled,Si(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(l,g,b){if(!g||this.currentStencilSource===g.id||!l.isTileClipped()||!b||0===b.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let B=!1;for(const U of b)if(void 0===this._tileClippingMaskIDs[U.key]){B=!0;break}if(!B)return}this.currentStencilSource=g.id;const I=this.context,M=I.gl;this.nextStencilID+b.length>256&&this.clearStencil(),I.setColorMode(p.ColorMode.disabled),I.setDepthMode(p.DepthMode.disabled);const O=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const B of b){const U=g.getTile(B),$=this._tileClippingMaskIDs[B.key]=this.nextStencilID++,{tileBoundsBuffer:q,tileBoundsIndexBuffer:Z,tileBoundsSegments:ge}=this.getTileBoundsBuffers(U);O.draw(I,M.TRIANGLES,p.DepthMode.disabled,new p.StencilMode({func:M.ALWAYS,mask:0},$,255,M.KEEP,M.KEEP,M.REPLACE),p.ColorMode.disabled,p.CullFaceMode.disabled,Si(B.projMatrix),"$clipping",q,Z,ge)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const l=this.nextStencilID++,g=this.context.gl;return new p.StencilMode({func:g.NOTEQUAL,mask:255},l,255,g.KEEP,g.KEEP,g.REPLACE)}stencilModeForClipping(l){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(l);const g=this.context.gl;return new p.StencilMode({func:g.EQUAL,mask:255},this._tileClippingMaskIDs[l.key],0,g.KEEP,g.KEEP,g.REPLACE)}stencilConfigForOverlap(l){const g=this.context.gl,b=l.sort((O,B)=>B.overscaledZ-O.overscaledZ),I=b[b.length-1].overscaledZ,M=b[0].overscaledZ-I+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const O={};for(let B=0;B<M;B++)O[B+I]=new p.StencilMode({func:g.GEQUAL,mask:255},B+this.nextStencilID,255,g.KEEP,g.KEEP,g.REPLACE);return this.nextStencilID+=M,[O,b]}return[{[I]:p.StencilMode.disabled},b]}colorModeForRenderPass(){const l=this.context.gl;return this._showOverdrawInspector?new p.ColorMode([l.CONSTANT_COLOR,l.ONE],new p.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?p.ColorMode.unblended:p.ColorMode.alphaBlended}depthModeForSublayer(l,g,b){if(!this.opaquePassEnabledForLayer())return p.DepthMode.disabled;const I=1-((1+this.currentLayer)*this.numSublayers+l)*this.depthEpsilon;return new p.DepthMode(b||this.context.gl.LEQUAL,g,[I,I])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(l,g){this.style=l,this.options=g,this.imageManager=l.imageManager,this.glyphManager=l.glyphManager,this.symbolFadeChange=l.placement.symbolFadeChange(p.exported.now()),this.imageManager.beginFrame();const b=this.style.order,I=this.style._sourceCaches;for(const U in I){const $=I[U];$.used&&$.prepare(this.context)}const M={},O={},B={};for(const U in I){const $=I[U];M[U]=$.getVisibleCoordinates(),O[U]=M[U].slice().reverse(),B[U]=$.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let U=0;U<b.length;U++)if(this.style._layers[b[U]].is3D()){this.opaquePassCutoff=U;break}if(this.terrain&&(this.terrain.updateTileBinding(B),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new p.GlobeSharedBuffers(this.context)),p.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const U of b){const $=this.style._layers[U],q=l._getLayerSourceCache($);if(!$.hasOffscreenPass()||$.isHidden(this.transform.zoom))continue;const Z=q?O[q.id]:void 0;("custom"===$.type||$.isSky()||Z&&Z.length)&&this.renderLayer(this,q,$,Z)}if(this.depthRangeFor3D=[0,1-(l.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:g.showOverdrawInspector?p.Color.black:p.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=g.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=b.length-1;this.currentLayer>=0;this.currentLayer--){const U=this.style._layers[b[this.currentLayer]],$=l._getLayerSourceCache(U);if(U.isSky())continue;const q=$?O[$.id]:void 0;this._renderTileClippingMasks(U,$,q),this.renderLayer(this,$,U,q)}if(this.style.fog&&this.transform.projection.supportsFog&&function(U,$){const q=U.context,Z=q.gl,ge=U.transform,De=new p.DepthMode(Z.LEQUAL,p.DepthMode.ReadOnly,[0,1]),be=U.useProgram("globeAtmosphere",null,"globe"===ge.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),Re=p.globeToMercatorTransition(ge.zoom),Ce=$.properties.get("color").toArray01(),xe=$.properties.get("high-color").toArray01(),Ne=$.properties.get("space-color").toArray01PremultipliedAlpha(),Se=p.identity$1([]);p.rotateY$1(Se,Se,-p.degToRad(ge._center.lng)),p.rotateX$1(Se,Se,p.degToRad(ge._center.lat)),p.rotateZ$1(Se,Se,ge.angle),p.rotateX$1(Se,Se,-ge._pitch);const Ye=p.fromQuat(new Float32Array(16),Se),Qe=p.mapValue($.properties.get("star-intensity"),0,1,0,.25),it=p.mapValue($.properties.get("horizon-blend"),0,1,5e-4,.25),St=p.globeUseCustomAntiAliasing(U,q,ge)&&5e-4===it?ge.worldSize/(2*Math.PI*1.025)-1:ge.globeRadius,zt=U.frameCounter/1e3%1,Pt=p.length(ge.globeCenterInViewSpace),dn=Math.sqrt(Math.pow(Pt,2)-Math.pow(St,2)),wt=Math.acos(dn/Pt),en={u_frustum_tl:ge.frustumCorners.TL,u_frustum_tr:ge.frustumCorners.TR,u_frustum_br:ge.frustumCorners.BR,u_frustum_bl:ge.frustumCorners.BL,u_horizon:ge.frustumCorners.horizon,u_transition:Re,u_fadeout_range:it,u_color:Ce,u_high_color:xe,u_space_color:Ne,u_star_intensity:Qe,u_star_size:5*p.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:zt,u_horizon_angle:wt,u_rotation_matrix:Ye};U.prepareDrawProgram(q,be);const Jt=U.atmosphereBuffer;Jt&&be.draw(q,Z.TRIANGLES,De,p.StencilMode.disabled,p.ColorMode.alphaBlended,p.CullFaceMode.backCW,en,"skybox",Jt.vertexBuffer,Jt.indexBuffer,Jt.segments)}(this,this.style.fog),this.renderPass="sky",(p.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<b.length;this.currentLayer++){const U=this.style._layers[b[this.currentLayer]],$=l._getLayerSourceCache(U);U.isSky()&&this.renderLayer(this,$,U,$?O[$.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<b.length;){const U=this.style._layers[b[this.currentLayer]],$=l._getLayerSourceCache(U);if(U.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(U)){if(U.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const q=$?("symbol"===U.type?B:O)[$.id]:void 0;this._renderTileClippingMasks(U,$,$?M[$.id]:void 0),this.renderLayer(this,$,U,q),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let U=null;p.values(this.style._layers).forEach($=>{const q=l._getLayerSourceCache($);q&&!$.isHidden(this.transform.zoom)&&(!U||U.getSource().maxzoom<q.getSource().maxzoom)&&(U=q)}),U&&this.options.showTileBoundaries&&Ts.debug(this,U,U.getVisibleCoordinates())}this.options.showPadding&&function(U){const $=U.transform.padding;Xo(U,U.transform.height-($.top||0),3,Os),Xo(U,$.bottom||0,3,Ao),Ua(U,$.left||0,3,yc),Ua(U,U.transform.width-($.right||0),3,Uu);const q=U.transform.centerPoint;var Z,ge,De,be;os(Z=U,(ge=q.x)-1,(De=U.transform.height-q.y)-10,2,20,be=Mi),os(Z,ge-10,De-1,20,2,be)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(p.window.performance.now()),this.saveCanvasCopy())}}renderLayer(l,g,b,I){b.isHidden(this.transform.zoom)||("background"===b.type||"sky"===b.type||"custom"===b.type||I&&I.length)&&(this.id=b.id,this.gpuTimingStart(b),l.transform.projection.unsupportedLayers&&l.transform.projection.unsupportedLayers.includes(b.type)||Ts[b.type](l,g,b,I,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(l){if(!this.options.gpuTiming)return;const g=this.context.extTimerQuery;let b=this.gpuTimers[l.id];b||(b=this.gpuTimers[l.id]={calls:0,cpuTime:0,query:g.createQueryEXT()}),b.calls++,g.beginQueryEXT(g.TIME_ELAPSED_EXT,b.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const l=this.context.extTimerQuery,g=l.createQueryEXT();this.deferredRenderGpuTimeQueries.push(g),l.beginQueryEXT(l.TIME_ELAPSED_EXT,g)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;l.endQueryEXT(l.TIME_ELAPSED_EXT)}collectGpuTimers(){const l=this.gpuTimers;return this.gpuTimers={},l}collectDeferredRenderGpuQueries(){const l=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],l}queryGpuTimers(l){const g={};for(const b in l){const I=l[b],M=this.context.extTimerQuery,O=M.getQueryObjectEXT(I.query,M.QUERY_RESULT_EXT)/1e6;M.deleteQueryEXT(I.query),g[b]=O}return g}queryGpuTimeDeferredRender(l){if(!this.options.gpuTimingDeferredRender)return 0;const g=this.context.extTimerQuery;let b=0;for(const I of l)b+=g.getQueryObjectEXT(I,g.QUERY_RESULT_EXT)/1e6,g.deleteQueryEXT(I);return b}translatePosMatrix(l,g,b,I,M){if(!b[0]&&!b[1])return l;const O=M?"map"===I?this.transform.angle:0:"viewport"===I?-this.transform.angle:0;if(O){const $=Math.sin(O),q=Math.cos(O);b=[b[0]*q-b[1]*$,b[0]*$+b[1]*q]}const B=[M?b[0]:Vt(g,b[0],this.transform.zoom),M?b[1]:Vt(g,b[1],this.transform.zoom),0],U=new Float32Array(16);return p.translate(U,l,B),U}saveTileTexture(l){const g=this._tileTextures[l.size[0]];g?g.push(l):this._tileTextures[l.size[0]]=[l]}getTileTexture(l){const g=this._tileTextures[l];return g&&g.length>0?g.pop():null}isPatternMissing(l){if(!l)return!1;if(!l.from||!l.to)return!0;const g=this.imageManager.getPattern(l.from.toString()),b=this.imageManager.getPattern(l.to.toString());return!g||!b}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const l=this.terrain&&this.terrain.renderingToTexture,g=this.style&&this.style.fog,b=[];return this.terrainRenderModeElevated()&&b.push("TERRAIN"),"globe"===this.transform.projection.name&&b.push("GLOBE"),g&&!l&&0!==g.getOpacity(this.transform.pitch)&&b.push("FOG"),l&&b.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&b.push("OVERDRAW_INSPECTOR"),b}useProgram(l,g,b){this.cache=this.cache||{};const I=b||[],M=this.currentGlobalDefines().concat(I),O=$r.cacheKey(pc[l],l,M,g);return this.cache[O]||(this.cache[O]=new $r(this.context,l,pc[l],g,rs[l],M)),this.cache[O]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const l=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(l.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=p.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new p.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(l,g,b){if(this.terrain&&this.terrain.renderingToTexture)return;const I=this.style.fog;if(I){const M=I.getOpacity(this.transform.pitch),O=((B,U,$,q,Z,ge,De,be,Re,Ce,xe)=>{const Ne=B.transform,Se=U.properties.get("color").toArray01();Se[3]=q;const Ye=B.frameCounter/1e3%1;return{u_fog_matrix:$?Ne.calculateFogTileMatrix($):B.identityMat,u_fog_range:U.getFovAdjustedRange(Ne._fov),u_fog_color:Se,u_fog_horizon_blend:U.properties.get("horizon-blend"),u_fog_temporal_offset:Ye,u_frustum_tl:Z,u_frustum_tr:ge,u_frustum_br:De,u_frustum_bl:be,u_globe_pos:Re,u_globe_radius:Ce,u_viewport:xe,u_globe_transition:p.globeToMercatorTransition(Ne.zoom),u_is_globe:+("globe"===Ne.projection.name)}})(this,I,b,M,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*p.exported.devicePixelRatio,this.transform.height*p.exported.devicePixelRatio]);g.setFogUniformValues(l,O)}}setTileLoadedFlag(l){this.tileLoaded=l}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const l=this.context.gl,g=l.createTexture();return l.bindTexture(l.TEXTURE_2D,g),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,l.drawingBufferWidth,l.drawingBufferHeight,0),g}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const l=this.style&&this.style.fog;return!!l&&0!==l.getOpacity(this.transform.pitch)}getBackgroundTiles(){const l=this._backgroundTiles,g=this._backgroundTiles={},b=this.transform.coveringTiles({tileSize:512});for(const I of b)g[I.key]=l[I.key]||new p.Tile(I,512,this.transform.tileZoom,this);return g}clearBackgroundTiles(){this._backgroundTiles={}}}class ss{constructor(l=0,g=0,b=0,I=0){if(isNaN(l)||l<0||isNaN(g)||g<0||isNaN(b)||b<0||isNaN(I)||I<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=l,this.bottom=g,this.left=b,this.right=I}interpolate(l,g,b){return null!=g.top&&null!=l.top&&(this.top=p.number(l.top,g.top,b)),null!=g.bottom&&null!=l.bottom&&(this.bottom=p.number(l.bottom,g.bottom,b)),null!=g.left&&null!=l.left&&(this.left=p.number(l.left,g.left,b)),null!=g.right&&null!=l.right&&(this.right=p.number(l.right,g.right,b)),this}getCenter(l,g){const b=p.clamp((this.left+l-this.right)/2,0,l),I=p.clamp((this.top+g-this.bottom)/2,0,g);return new p.pointGeometry(b,I)}equals(l){return this.top===l.top&&this.bottom===l.bottom&&this.left===l.left&&this.right===l.right}clone(){return new ss(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function el(v,l){const g=p.getColumn(v,3);p.fromQuat(v,l),p.setColumn(v,3,g)}function Hl(v,l){const g=p.identity$1([]);return p.rotateZ$1(g,g,-l),p.rotateX$1(g,g,-v),g}function Da(v,l){const g=[v[0],v[1],0],b=[l[0],l[1],0];if(p.length(g)>=1e-15){const O=p.normalize([],g);p.scale$2(b,O,p.dot(b,O)),l[0]=b[0],l[1]=b[1]}const I=p.cross([],l,v);if(p.len(I)<1e-15)return null;const M=Math.atan2(-I[1],I[0]);return Hl(Math.atan2(Math.sqrt(v[0]*v[0]+v[1]*v[1]),-v[2]),M)}class ju{constructor(l,g){this.position=l,this.orientation=g}get position(){return this._position}set position(l){if(l){const g=l instanceof p.MercatorCoordinate?l:new p.MercatorCoordinate(l[0],l[1],l[2]);this._renderWorldCopies&&(g.x=p.wrap(g.x,0,1)),this._position=g}else this._position=null}lookAtPoint(l,g){if(this.orientation=null,!this.position)return;const b=this._elevation?this._elevation.getAtPointOrZero(p.MercatorCoordinate.fromLngLat(l)):0,I=this.position,M=p.MercatorCoordinate.fromLngLat(l,b),O=[M.x-I.x,M.y-I.y,M.z-I.z];g||(g=[0,0,1]),g[2]=Math.abs(g[2]),this.orientation=Da(O,g)}setPitchBearing(l,g){this.orientation=Hl(p.degToRad(l),p.degToRad(-g))}}class bs{constructor(l,g){this._transform=p.identity([]),this.orientation=g,this.position=l}get mercatorPosition(){const l=this.position;return new p.MercatorCoordinate(l[0],l[1],l[2])}get position(){const l=p.getColumn(this._transform,3);return[l[0],l[1],l[2]]}set position(l){var g;l&&p.setColumn(this._transform,3,[(g=l)[0],g[1],g[2],1])}get orientation(){return this._orientation}set orientation(l){this._orientation=l||p.identity$1([]),l&&el(this._transform,this._orientation)}getPitchBearing(){const l=this.forward(),g=this.right();return{bearing:Math.atan2(-g[1],g[0]),pitch:Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2])}}setPitchBearing(l,g){this._orientation=Hl(l,g),el(this._transform,this._orientation)}forward(){const l=p.getColumn(this._transform,2);return[-l[0],-l[1],-l[2]]}up(){const l=p.getColumn(this._transform,1);return[-l[0],-l[1],-l[2]]}right(){const l=p.getColumn(this._transform,0);return[l[0],l[1],l[2]]}getCameraToWorld(l,g){const b=new Float64Array(16);return p.invert(b,this.getWorldToCamera(l,g)),b}getWorldToCameraPosition(l,g,b){const I=this.position;p.scale$2(I,I,-l);const M=new Float64Array(16);return p.fromScaling(M,[b,b,b]),p.translate(M,M,I),M[10]*=g,M}getWorldToCamera(l,g){const b=new Float64Array(16),I=new Float64Array(4),M=this.position;return p.conjugate(I,this._orientation),p.scale$2(M,M,-l),p.fromQuat(b,I),p.translate(b,b,M),b[1]*=-1,b[5]*=-1,b[9]*=-1,b[13]*=-1,b[8]*=g,b[9]*=g,b[10]*=g,b[11]*=g,b}getCameraToClipPerspective(l,g,b,I){const M=new Float64Array(16);return p.perspective(M,l,g,b,I),M}getDistanceToElevation(l){const g=0===l?0:p.mercatorZfromAltitude(l,this.position[1]),b=this.forward();return(g-this.position[2])/b[2]}clone(){return new bs([...this.position],[...this.orientation])}}function pu(v,l){const g=fh(v.projection,v.zoom,v.width,v.height),b=function(M,O,B,U,$){const q=new p.LngLat(B.lng-180*vl,B.lat),Z=new p.LngLat(B.lng+180*vl,B.lat),ge=M.project(q.lng,q.lat),De=M.project(Z.lng,Z.lat),be=-Math.atan2(De.y-ge.y,De.x-ge.x),Re=p.MercatorCoordinate.fromLngLat(B);Re.y=p.clamp(Re.y,-.999975,.999975);const Ce=Re.toLngLat(),xe=M.project(Ce.lng,Ce.lat),Ne=p.MercatorCoordinate.fromLngLat(Ce);Ne.x+=vl;const Se=Ne.toLngLat(),Ye=M.project(Se.lng,Se.lat),Qe=Tn(Ye.x-xe.x,Ye.y-xe.y,be),Ge=p.MercatorCoordinate.fromLngLat(Ce);Ge.y+=vl;const it=Ge.toLngLat(),St=M.project(it.lng,it.lat),zt=Tn(St.x-xe.x,St.y-xe.y,be),Pt=Math.abs(Qe.x)/Math.abs(zt.y),dn=p.identity([]);p.rotateZ(dn,dn,-be*(1-($?0:U)));const wt=p.identity([]);return p.scale(wt,wt,[1,1-(1-Pt)*U,1]),wt[4]=-zt.x/zt.y*U,p.rotateZ(wt,wt,be),p.multiply(wt,dn,wt),wt}(v.projection,0,v.center,g,l),I=zo(v);return p.scale(b,b,[I,I,1]),b}function zo(v){const l=v.projection,g=fh(v.projection,v.zoom,v.width,v.height),b=Ds(l,v.center),I=Ds(l,p.LngLat.convert(l.center));return Math.pow(2,b*g+(1-g)*I)}function fh(v,l,g,b,I=1/0){const M=v.range;if(!M)return 0;const O=Math.min(I,Math.max(g,b)),B=Math.log(O/1024)/Math.LN2;return p.smoothstep(M[0]+B,M[1]+B,l)}const vl=1/4e4;function Ds(v,l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),b=new p.LngLat(l.lng-180*vl,g),I=new p.LngLat(l.lng+180*vl,g),M=v.project(b.lng,g),O=v.project(I.lng,g),B=p.MercatorCoordinate.fromLngLat(b),U=p.MercatorCoordinate.fromLngLat(I),$=O.x-M.x,q=O.y-M.y,Z=U.x-B.x,ge=U.y-B.y,De=Math.sqrt((Z*Z+ge*ge)/($*$+q*q));return Math.log(De)/Math.LN2}function Tn(v,l,g){const b=Math.cos(g),I=Math.sin(g);return{x:v*b-l*I,y:v*I+l*b}}class Ya{constructor(l,g,b,I,M,O,B){this.tileSize=512,this._renderWorldCopies=void 0===M||M,this._minZoom=l||0,this._maxZoom=g||22,this._minPitch=b??0,this._maxPitch=I??60,this.setProjection(O),this.setMaxBounds(B),this.width=0,this.height=0,this._center=new p.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ss,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new bs,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const l=new Ya(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return l._elevation=this._elevation,l._centerAltitude=this._centerAltitude,l._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,l.tileSize=this.tileSize,l.mercatorFromTransition=this.mercatorFromTransition,l.width=this.width,l.height=this.height,l.cameraElevationReference=this.cameraElevationReference,l._center=this._center,l._setZoom(this.zoom),l._seaLevelZoom=this._seaLevelZoom,l.angle=this.angle,l._fov=this._fov,l._pitch=this._pitch,l._nearZ=this._nearZ,l._farZ=this._farZ,l._averageElevation=this._averageElevation,l._unmodified=this._unmodified,l._edgeInsets=this._edgeInsets.clone(),l._camera=this._camera.clone(),l._calcMatrices(),l.freezeTileCoverage=this.freezeTileCoverage,l.frustumCorners=this.frustumCorners,l}get elevation(){return this._elevation}set elevation(l){this._elevation!==l&&(this._elevation=l,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(l){const g=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||g)&&this._updateCameraOnTerrain(),(l||g)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return p.pick(this.projection,["name","center","parallels"])}setProjection(l){this.projectionOptions=l||{name:"mercator"};const g=this.projection?this.getProjection():void 0;this.projection=p.getProjection(this.projectionOptions);const b=!ve(g,this.getProjection());return b&&this._calcMatrices(),this.mercatorFromTransition=!1,b}setMercatorFromTransition(){const l=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=p.getProjection({name:"mercator"});const g=l!==this.projection.name;return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(l){this._minZoom!==l&&(this._minZoom=l,this.zoom=Math.max(this.zoom,l))}get maxZoom(){return this._maxZoom}set maxZoom(l){this._maxZoom!==l&&(this._maxZoom=l,this.zoom=Math.min(this.zoom,l))}get minPitch(){return this._minPitch}set minPitch(l){this._minPitch!==l&&(this._minPitch=l,this.pitch=Math.max(this.pitch,l))}get maxPitch(){return this._maxPitch}set maxPitch(l){this._maxPitch!==l&&(this._maxPitch=l,this.pitch=Math.min(this.pitch,l))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(l){void 0===l?l=!0:null===l&&(l=!1),this._renderWorldCopies=l}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const l=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(l))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return p.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new p.pointGeometry(this.width,this.height)}get bearing(){return p.wrap(this.rotation,-180,180)}set bearing(l){this.rotation=l}get rotation(){return-this.angle/Math.PI*180}set rotation(l){const g=-l*Math.PI/180;var b,I,M,O,B,U,$,q,Z,ge;this.angle!==g&&(this._unmodified=!1,this.angle=g,this._calcMatrices(),this.rotationMatrix=(b=new p.ARRAY_TYPE(4),p.ARRAY_TYPE!=Float32Array&&(b[1]=0,b[2]=0),b[0]=1,b[3]=1,b),I=this.rotationMatrix,O=this.angle,B=(M=this.rotationMatrix)[0],U=M[1],$=M[2],q=M[3],Z=Math.sin(O),ge=Math.cos(O),I[0]=B*ge+$*Z,I[1]=U*ge+q*Z,I[2]=B*-Z+$*ge,I[3]=U*-Z+q*ge)}get pitch(){return this._pitch/Math.PI*180}set pitch(l){const g=p.clamp(l,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==g&&(this._unmodified=!1,this._pitch=g,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const l=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/l)}set fov(l){l=Math.max(.01,Math.min(60,l)),this._fov!==l&&(this._unmodified=!1,this._fov=p.degToRad(l),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(l){this._averageElevation=l,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(l){const g=Math.min(Math.max(l,this.minZoom),this.maxZoom);this._zoom!==g&&(this._unmodified=!1,this._setZoom(g),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(l){this._zoom=l,this.scale=this.zoomScale(l),this.tileZoom=Math.floor(l),this.zoomFraction=l-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const l=this._elevation;this._centerAltitude=l.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=l.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const l=this._elevation,g=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],b=this.horizonLineFromTop();let I=0,M=0;for(let O=0;O<g.length;O++){const B=new p.pointGeometry(g[O][0]*this.width,b+g[O][1]*(this.height-b)),U=l.pointCoordinate(B);if(!U)continue;const $=1/Math.hypot(U[0]-this._camera.position[0],U[1]-this._camera.position[1]);I+=U[3]*$,M+=$}return 0===M?NaN:I/M}get center(){return this._center}set center(l){l.lat===this._center.lat&&l.lng===this._center.lng||(this._unmodified=!1,this._center=l,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const l=this._seaLevelZoom,g=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),b=this.pixelsPerMeter/this.worldSize*g,I=this._mercatorZfromZoom(l),M=this._mercatorZfromZoom(this._maxZoom),O=Math.max(I-b,M);this._setZoom(this._zoomFromMercatorZ(O))}get padding(){return this._edgeInsets.toJSON()}set padding(l){this._edgeInsets.equals(l)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,l,1),this._calcMatrices())}computeZoomRelativeTo(l){const g=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,l.toAltitude()));let b;b=l.z<this._camera.position[2]?[g.x,g.y,g.z]:[l.x,l.y,l.z];const I=p.length(p.sub([],this._camera.position,b));return p.clamp(this._zoomFromMercatorZ(I),this._minZoom,this._maxZoom)}setFreeCameraOptions(l){if(!this.height||!l.position&&!l.orientation)return;this._updateCameraState();let g=!1;if(l.orientation&&!p.exactEquals(l.orientation,this._camera.orientation)&&(g=this._setCameraOrientation(l.orientation)),l.position){const b=[l.position.x,l.position.y,l.position.z];p.exactEquals$1(b,this._camera.position)||(this._setCameraPosition(b),g=!0)}g&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const l=this._camera.position,g=new ju;return g.position=new p.MercatorCoordinate(l[0],l[1],l[2]),g.orientation=this._camera.orientation,g._elevation=this.elevation,g._renderWorldCopies=this.renderWorldCopies,g}_setCameraOrientation(l){if(!p.length$1(l))return!1;p.normalize$1(l,l);const g=p.transformQuat([],[0,0,-1],l),b=p.transformQuat([],[0,-1,0],l);if(b[2]<0)return!1;const I=Da(g,b);return!!I&&(this._camera.orientation=I,!0)}_setCameraPosition(l){const g=this.zoomScale(this.minZoom)*this.tileSize,b=this.zoomScale(this.maxZoom)*this.tileSize,I=this.cameraToCenterDistance;l[2]=p.clamp(l[2],I/b,I/g),this._camera.position=l}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(l){return this._edgeInsets.equals(l)}interpolatePadding(l,g,b){this._unmodified=!1,this._edgeInsets.interpolate(l,g,b),this._constrain(),this._calcMatrices()}coveringZoomLevel(l){const g=(l.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/l.tileSize));return Math.max(0,g)}getVisibleUnwrappedCoordinates(l){const g=[new p.UnwrappedTileID(0,l)];if(this.renderWorldCopies){const b=this.pointCoordinate(new p.pointGeometry(0,0)),I=this.pointCoordinate(new p.pointGeometry(this.width,0)),M=this.pointCoordinate(new p.pointGeometry(this.width,this.height)),O=this.pointCoordinate(new p.pointGeometry(0,this.height)),B=Math.floor(Math.min(b.x,I.x,M.x,O.x)),U=Math.floor(Math.max(b.x,I.x,M.x,O.x)),$=1;for(let q=B-$;q<=U+$;q++)0!==q&&g.push(new p.UnwrappedTileID(q,l))}return g}coveringTiles(l){let g=this.coveringZoomLevel(l);const b=g,I=this.elevation&&!l.isTerrainDEM,M="mercator"===this.projection.name;if(void 0!==l.minzoom&&g<l.minzoom)return[];void 0!==l.maxzoom&&g>l.maxzoom&&(g=l.maxzoom);const O=this.locationCoordinate(this.center),B=this.center.lat,U=1<<g,$=[U*O.x,U*O.y,0],q="globe"===this.projection.name,Z=!q,ge=p.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g,Z),De=q?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),be=U*p.mercatorZfromAltitude(1,this.center.lat),Re=this._camera.position[2]/p.mercatorZfromAltitude(1,this.center.lat),Ce=[U*De.x,U*De.y,Re*(Z?1:be)],xe=this.cameraToCenterDistance/l.tileSize*(l.roundZoom?1:.502),Ne=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?g:0,Se=l.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,Ye=l.isTerrainDEM?-Se:this._elevation?this._elevation.getMinElevationBelowMSL():0,Qe=this.projection.isReprojectedInTileSpace?zo(this):1,Ge=mt=>{const _n=new p.MercatorCoordinate(mt.x+25e-6,mt.y,mt.z),Cn=new p.MercatorCoordinate(mt.x,mt.y+25e-6,mt.z),wn=mt.toLngLat(),Vn=_n.toLngLat(),mr=Cn.toLngLat(),ir=this.locationCoordinate(wn),Xn=this.locationCoordinate(Vn),bn=this.locationCoordinate(mr),xr=Math.hypot(Xn.x-ir.x,Xn.y-ir.y),Fr=Math.hypot(bn.x-ir.x,bn.y-ir.y);return Math.sqrt(xr*Fr)*Qe/25e-6},it=mt=>{const An=Se,_n=Ye;return{aabb:p.tileAABB(this,U,0,0,0,mt,_n,An,this.projection),zoom:0,x:0,y:0,minZ:_n,maxZ:An,wrap:mt,fullyVisible:!1}},St=[];let zt=[];const Pt=g,dn=l.reparseOverscaled?b:g,wt=mt=>mt*mt,en=wt((Re-this._centerAltitude)*be),Jt=mt=>{if(!this._elevation||!mt.tileID||!M)return;const An=this._elevation.getMinMaxForTile(mt.tileID),_n=mt.aabb;An?(_n.min[2]=An.min,_n.max[2]=An.max,_n.center[2]=(_n.min[2]+_n.max[2])/2):(mt.shouldSplit=Dt(mt),mt.shouldSplit||(_n.min[2]=_n.max[2]=_n.center[2]=this._centerAltitude))},Dt=mt=>{if(mt.zoom<Ne)return!0;if(mt.zoom===Pt)return!1;if(null!=mt.shouldSplit)return mt.shouldSplit;const An=mt.aabb.distanceX(Ce),_n=mt.aabb.distanceY(Ce);let Cn=en,wn=1;if(q){Cn=wt(mt.aabb.distanceZ(Ce));const ir=Math.pow(2,mt.zoom),Xn=p.latFromMercatorY((mt.y+1)/ir),bn=p.latFromMercatorY(mt.y/ir),xr=Math.min(Math.max(B,Xn),bn),Fr=p.circumferenceAtLatitude(xr)/p.circumferenceAtLatitude(B);if(wn=xr===B?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Fr/this._mercatorScaleRatio),this.zoom<=p.GLOBE_ZOOM_THRESHOLD_MIN&&mt.zoom===Pt-1&&Fr>=.9)return!0}else if(I&&(Cn=wt(mt.aabb.distanceZ(Ce)*be)),this.projection.isReprojectedInTileSpace&&b<=5){const ir=Math.pow(2,mt.zoom),Xn=Ge(new p.MercatorCoordinate((mt.x+.5)/ir,(mt.y+.5)/ir));wn=Xn>.85?1:Xn}const Vn=An*An+_n*_n+Cn;return Vn<wt((1<<Pt-mt.zoom)*xe*wn*((ir,Xn)=>{if(Xn*wt(.707)<ir)return 1;const bn=Math.sqrt(Xn/ir);return bn/(1.4144271570014144+(Math.pow(1.1,bn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Cn,en),Vn))};if(this.renderWorldCopies)for(let mt=1;mt<=3;mt++)St.push(it(-mt)),St.push(it(mt));for(St.push(it(0));St.length>0;){const mt=St.pop(),An=mt.x,_n=mt.y;let Cn=mt.fullyVisible;if(!Cn){const wn=mt.aabb.intersects(ge);if(0===wn)continue;Cn=2===wn}if(mt.zoom!==Pt&&Dt(mt))for(let wn=0;wn<4;wn++){const Vn=(An<<1)+wn%2,mr=(_n<<1)+(wn>>1),ir={aabb:M?mt.aabb.quadrant(wn):p.tileAABB(this,U,mt.zoom+1,Vn,mr,mt.wrap,mt.minZ,mt.maxZ,this.projection),zoom:mt.zoom+1,x:Vn,y:mr,wrap:mt.wrap,fullyVisible:Cn,tileID:void 0,shouldSplit:void 0,minZ:mt.minZ,maxZ:mt.maxZ};I&&!q&&(ir.tileID=new p.OverscaledTileID(mt.zoom+1===Pt?dn:mt.zoom+1,mt.wrap,mt.zoom+1,Vn,mr),Jt(ir)),St.push(ir)}else{const wn=mt.zoom===Pt?dn:mt.zoom;if(l.minzoom&&l.minzoom>wn)continue;const Vn=$[0]-(.5+An+(mt.wrap<<mt.zoom))*(1<<g-mt.zoom),mr=$[1]-.5-_n,ir=mt.tileID?mt.tileID:new p.OverscaledTileID(wn,mt.wrap,mt.zoom,An,_n);zt.push({tileID:ir,distanceSq:Vn*Vn+mr*mr})}}if(this.fogCullDistSq){const mt=this.fogCullDistSq,An=this.horizonLineFromTop();zt=zt.filter(_n=>{const Cn=[0,0,0,1],wn=[p.EXTENT,p.EXTENT,0,1],Vn=this.calculateFogTileMatrix(_n.tileID.toUnwrapped());p.transformMat4$1(Cn,Cn,Vn),p.transformMat4$1(wn,wn,Vn);const mr=p.getAABBPointSquareDist(Cn,wn);if(0===mr)return!0;let ir=!1;const Xn=this._elevation;if(Xn&&mr>mt&&0!==An){const bn=this.calculateProjMatrix(_n.tileID.toUnwrapped());let xr;l.isTerrainDEM||(xr=Xn.getMinMaxForTile(_n.tileID)),xr||(xr={min:Ye,max:Se});const Fr=p.furthestTileCorner(this.rotation),ao=[Fr[0]*p.EXTENT,Fr[1]*p.EXTENT,xr.max];p.transformMat4(ao,ao,bn),ir=(1-ao[1])*this.height*.5<An}return mr<mt||ir})}return zt.sort((mt,An)=>mt.distanceSq-An.distanceSq).map(mt=>mt.tileID)}resize(l,g){this.width=l,this.height=g,this.pixelsToGLUnits=[2/l,-2/g],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(l){return Math.pow(2,l)}scaleZoom(l){return Math.log(l)/Math.LN2}project(l){const g=p.clamp(l.lat,-p.MAX_MERCATOR_LATITUDE,p.MAX_MERCATOR_LATITUDE),b=this.projection.project(l.lng,g);return new p.pointGeometry(b.x*this.worldSize,b.y*this.worldSize)}unproject(l){return this.projection.unproject(l.x/this.worldSize,l.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(l,g){let b,I;const M=this.centerPoint;if("globe"===this.projection.name){const B=this.worldSize;b=(g.x-M.x)/B,I=(g.y-M.y)/B}else{const B=this.pointCoordinate(g),U=this.pointCoordinate(M);b=B.x-U.x,I=B.y-U.y}const O=this.locationCoordinate(l);this.setLocation(new p.MercatorCoordinate(O.x-b,O.y-I))}setLocation(l){this.center=this.coordinateLocation(l),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(l){return this.projection.locationPoint(this,l)}locationPoint3D(l){return this.projection.locationPoint(this,l,!0)}pointLocation(l){return this.coordinateLocation(this.pointCoordinate(l))}pointLocation3D(l){return this.coordinateLocation(this.pointCoordinate3D(l))}locationCoordinate(l,g){const b=g?p.mercatorZfromAltitude(g,l.lat):void 0,I=this.projection.project(l.lng,l.lat);return new p.MercatorCoordinate(I.x,I.y,b)}coordinateLocation(l){return this.projection.unproject(l.x,l.y)}pointRayIntersection(l,g){const b=g??this._centerAltitude,I=[l.x,l.y,0,1],M=[l.x,l.y,1,1];p.transformMat4$1(I,I,this.pixelMatrixInverse),p.transformMat4$1(M,M,this.pixelMatrixInverse);const O=M[3];p.scale$1(I,I,1/I[3]),p.scale$1(M,M,1/O);const B=I[2],U=M[2];return{p0:I,p1:M,t:B===U?0:(b-B)/(U-B)}}screenPointToMercatorRay(l){const g=[l.x,l.y,0,1],b=[l.x,l.y,1,1];return p.transformMat4$1(g,g,this.pixelMatrixInverse),p.transformMat4$1(b,b,this.pixelMatrixInverse),p.scale$1(g,g,1/g[3]),p.scale$1(b,b,1/b[3]),g[2]=p.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,b[2]=p.mercatorZfromAltitude(b[2],this._center.lat)*this.worldSize,p.scale$1(g,g,1/this.worldSize),p.scale$1(b,b,1/this.worldSize),new p.Ray([g[0],g[1],g[2]],p.normalize([],p.sub([],b,g)))}rayIntersectionCoordinate(l){const{p0:g,p1:b,t:I}=l,M=p.mercatorZfromAltitude(g[2],this._center.lat),O=p.mercatorZfromAltitude(b[2],this._center.lat);return new p.MercatorCoordinate(p.number(g[0],b[0],I)/this.worldSize,p.number(g[1],b[1],I)/this.worldSize,p.number(M,O,I))}pointCoordinate(l,g=this._centerAltitude){return this.projection.pointCoordinate(this,l.x,l.y,g)}pointCoordinate3D(l){if(!this.elevation)return this.pointCoordinate(l);let g=this.projection.pointCoordinate3D(this,l.x,l.y);if(g)return new p.MercatorCoordinate(g[0],g[1],g[2]);let b=0,I=this.horizonLineFromTop();if(l.y>I)return this.pointCoordinate(l);const M=.02*I,O=l.clone();for(let B=0;B<10&&I-b>M;B++){O.y=p.number(b,I,.66);const U=this.projection.pointCoordinate3D(this,O.x,O.y);U?(I=O.y,g=U):b=O.y}return g?new p.MercatorCoordinate(g[0],g[1],g[2]):this.pointCoordinate(l)}isPointAboveHorizon(l){return this.projection.isPointAboveHorizon(this,l)}_coordinatePoint(l,g){const b=g&&this.elevation?this.elevation.getAtPointOrZero(l,this._centerAltitude):this._centerAltitude,I=[l.x*this.worldSize,l.y*this.worldSize,b+l.toAltitude(),1];return p.transformMat4$1(I,I,this.pixelMatrix),I[3]>0?new p.pointGeometry(I[0]/I[3],I[1]/I[3]):new p.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getGlobeBounds(){const{top:l,left:g}=this._edgeInsets,b=this.height-this._edgeInsets.bottom,I=this.width-this._edgeInsets.right,M=this.pointCoordinate3D(new p.pointGeometry(g,l)),O=this.pointCoordinate3D(new p.pointGeometry(I,l)),B=this.pointCoordinate3D(new p.pointGeometry(I,b)),U=this.pointCoordinate3D(new p.pointGeometry(g,b));let $=Math.min(M.x,U.x),q=Math.max(O.x,B.x),Z=Math.min(M.y,O.y),ge=Math.max(U.y,B.y);const De=Math.pow(2,-this.zoom)/16,be=(xe,Ne,Se,Ye)=>{const Qe=(xe+Se)/2,Ge=(Ne+Ye)/2,it=new p.pointGeometry(Qe,Ge),St=this.pointCoordinate3D(it),zt=Math.max(0,$-St.x,Z-St.y,St.x-q,St.y-ge);$=Math.min($,St.x),q=Math.max(q,St.x),Z=Math.min(Z,St.y),ge=Math.max(ge,St.y),zt>De&&(be(xe,Ne,Qe,Ge),be(Qe,Ge,Se,Ye))};be(g,l,I,l),be(I,l,I,b),be(I,b,g,b),be(g,b,g,l);const Re=new p.LngLat(p.lngFromMercatorX(q),p.latFromMercatorY(Z)),Ce=new p.LngLat(p.lngFromMercatorX($),p.latFromMercatorY(ge));return new p.LngLatBounds(Ce,Re)}_getBounds(l,g){if("globe"===this.projection.name)return this._getGlobeBounds();const b=new p.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),I=new p.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),M=new p.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),O=new p.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let B=this.pointCoordinate(b,l),U=this.pointCoordinate(I,l);const $=this.pointCoordinate(M,g),q=this.pointCoordinate(O,g),Z=(ge,De)=>(De.y-ge.y)/(De.x-ge.x);return B.y>1&&U.y>=0?B=new p.MercatorCoordinate((1-q.y)/Z(q,B)+q.x,1):B.y<0&&U.y<=1&&(B=new p.MercatorCoordinate(-q.y/Z(q,B)+q.x,0)),U.y>1&&B.y>=0?U=new p.MercatorCoordinate((1-$.y)/Z($,U)+$.x,1):U.y<0&&B.y<=1&&(U=new p.MercatorCoordinate(-$.y/Z($,U)+$.x,0)),(new p.LngLatBounds).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(q)).extend(this.coordinateLocation($))}_getBounds3D(){const l=this.elevation;if(!l.visibleDemTiles.length||l.isUsingMockSource())return this._getBounds(0,0);const g=l.visibleDemTiles.reduce((b,I)=>{if(I.dem){const M=I.dem.tree;b.min=Math.min(b.min,M.minimums[0]),b.max=Math.max(b.max,M.maximums[0])}return b},{min:Number.MAX_VALUE,max:0});return this._getBounds(g.min*l.exaggeration(),g.max*l.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(l=!0){const g=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,b=this.height/2-g*(1-this._horizonShift);return l?Math.max(0,b):b}getMaxBounds(){return this.maxBounds}setMaxBounds(l){this.maxBounds=l,this.minLat=-p.MAX_MERCATOR_LATITUDE,this.maxLat=p.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,l&&(this.minLat=l.getSouth(),this.maxLat=l.getNorth(),this.minLng=l.getWest(),this.maxLng=l.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=p.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=p.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=p.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=p.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(l,g){return this.projection.createTileMatrix(this,g,l)}calculateDistanceTileData(l){const g=l.key,b=this._distanceTileDataCache;if(b[g])return b[g];const I=l.canonical,M=1/this.height,O=this.cameraWorldSize/this.zoomScale(I.z),B=(I.x+Math.pow(2,I.z)*l.wrap)*O,U=I.y*O,$=this.point,q=this.angle,Z=Math.sin(-q),ge=-Math.cos(-q);return b[g]={bearing:[Z,ge],center:[($.x-B)*M,($.y-U)*M],scale:O/p.EXTENT*M},b[g]}calculateFogTileMatrix(l){const g=l.key,b=this._fogTileMatrixCache;if(b[g])return b[g];const I=this.projection.createTileMatrix(this,this.cameraWorldSize,l);return p.multiply(I,this.worldToFogMatrix,I),b[g]=new Float32Array(I),b[g]}calculateProjMatrix(l,g=!1){const b=l.key,I=g?this._alignedProjMatrixCache:this._projMatrixCache;if(I[b])return I[b];const M=this.calculatePosMatrix(l,this.worldSize);return p.multiply(M,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:g?this.alignedProjMatrix:this.projMatrix,M),I[b]=new Float32Array(M),I[b]}calculatePixelsToTileUnitsMatrix(l){const g=l.tileID.key,b=this._pixelsToTileUnitsCache;if(b[g])return b[g];const I=function(M,O){const{scale:B}=M.tileTransform,U=B*p.EXTENT/(M.tileSize*Math.pow(2,O.zoom-M.tileID.overscaledZ+M.tileID.canonical.z));return $=new Float32Array(4),ge=(q=O.inverseAdjustmentMatrix)[1],De=q[2],be=q[3],Ce=(Z=[U,U])[1],$[0]=q[0]*(Re=Z[0]),$[1]=ge*Re,$[2]=De*Ce,$[3]=be*Ce,$;var $,q,Z,ge,De,be,Re,Ce}(l,this);return b[g]=I,b[g]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),I=this._camera.forward(),M=p.mercatorZfromAltitude(1,this._center.lat);b[2]/=M,I[2]/=M,p.normalize(I,I);const O=l.raycast(b,I,l.exaggeration());if(O){const B=p.scaleAndAdd([],b,I,O),U=new p.MercatorCoordinate(B[0],B[1],p.mercatorZfromAltitude(B[2],p.latFromMercatorY(B[1]))),$=(U.z+p.length([U.x-b[0],U.y-b[1],U.z-b[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ($),this._centerAltitude=U.toAltitude(),this._center=this.coordinateLocation(U),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const l=this._elevation;this._updateCameraState();const g=p.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,b=this._computeCameraPosition(g),I=l.getAtPointOrZero(new p.MercatorCoordinate(...b)),M=this._minimumHeightOverTerrain()*Math.cos(p.degToRad(this._maxPitch)),O=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*I;if(O<M){const B=this.locationCoordinate(this._center,this._centerAltitude),U=[B.x-b[0],B.y-b[1],B.z-b[2]],$=p.length(U);U[2]-=(M-O)/this._pixelsPerMercatorPixel;const q=p.length(U);if(0===q)return;p.scale$2(U,U,$/q*this._pixelsPerMercatorPixel),this._camera.position=[B.x-U[0],B.y-U[1],B.z*this._pixelsPerMercatorPixel-U[2]],this._camera.orientation=Da(U,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const l="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||l){const ge=this.center;return ge.lat=p.clamp(ge.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!l)&&(ge.lng=p.clamp(ge.lng,this.minLng,this.maxLng)),this.center=ge,void(this._constraining=!1)}const g=this._unmodified,{x:b,y:I}=this.point;let M=0,O=b,B=I;const U=this.width/2,$=this.height/2,q=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(I-$<q&&(B=q+$),I+$>Z&&(B=Z-$),Z-q<this.height&&(M=Math.max(M,this.height/(Z-q)),B=(Z+q)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const ge=this.worldMinX*this.scale,De=this.worldMaxX*this.scale,be=this.worldSize/2-(ge+De)/2;O=(b+be+this.worldSize)%this.worldSize-be,O-U<ge&&(O=ge+U),O+U>De&&(O=De-U),De-ge<this.width&&(M=Math.max(M,this.width/(De-ge)),O=(De+ge)/2)}O===b&&B===I||(this.center=this.unproject(new p.pointGeometry(O,B))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCameraAltitude(),this._unmodified=g,this._constraining=!1}_minZoomForBounds(){let l=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(l=Math.max(l,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),l}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const l=this.centerOffset,g=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=p.mercatorZfromAltitude(1,this.center.lat)/p.mercatorZfromAltitude(1,p.GLOBE_SCALE_MATCH_LATITUDE));const b=fh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,b),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const I=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?g:1),M=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);M[8]=2*-l.x/this.width,M[9]=2*l.y/this.height;let O=p.mul([],M,I);if(this.projection.isReprojectedInTileSpace){const Qe=this.locationCoordinate(this.center),Ge=p.identity([]);p.translate(Ge,Ge,[Qe.x*this.worldSize,Qe.y*this.worldSize,0]),p.multiply(Ge,Ge,pu(this)),p.translate(Ge,Ge,[-Qe.x*this.worldSize,-Qe.y*this.worldSize,0]),p.multiply(O,O,Ge),this.inverseAdjustmentMatrix=function(it){const St=pu(it,!0);return se([],[St[0],St[1],St[4],St[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=p.scale([],O,[this.worldSize,this.worldSize,this.worldSize/g,1]),this.projMatrix=O,this.invProjMatrix=p.invert(new Float64Array(16),this.projMatrix);const B=p.invert([],M);this.frustumCorners=p.FrustumCorners.fromInvProjectionMatrix(B,this.horizonLineFromTop(),this.height);const U=new Float32Array(16);p.identity(U),p.scale(U,U,[1,-1,1]),p.rotateX(U,U,this._pitch),p.rotateZ(U,U,this.angle);const $=p.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),q=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;$[8]=2*-l.x/this.width,$[9]=2*(l.y+q)/this.height,this.skyboxMatrix=p.multiply(U,$,U);const Z=this.point,ge=Z.x,De=Z.y,be=this.width%2/2,Re=this.height%2/2,Ce=Math.cos(this.angle),xe=Math.sin(this.angle),Ne=ge-Math.round(ge)+Ce*be+xe*Re,Se=De-Math.round(De)+Ce*Re+xe*be,Ye=new Float64Array(O);if(p.translate(Ye,Ye,[Ne>.5?Ne-1:Ne,Se>.5?Se-1:Se,0]),this.alignedProjMatrix=Ye,O=p.create(),p.scale(O,O,[this.width/2,-this.height/2,1]),p.translate(O,O,[1,-1,0]),this.labelPlaneMatrix=O,O=p.create(),p.scale(O,O,[1,-1,1]),p.translate(O,O,[-1,-1,0]),p.scale(O,O,[2/this.width,2/this.height,1]),this.glCoordMatrix=O,this.pixelMatrix=p.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},O=p.invert(new Float64Array(16),this.pixelMatrix),!O)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=O,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=p.calculateGlobeMatrix(this);const Qe=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=p.transformMat4(Qe,Qe,I),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=O;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const l=this.cameraWorldSize,g=this.cameraPixelsPerMeter,b=this._camera.position,I=1/this.height/this._pixelsPerMercatorPixel,M=[l,l,g];p.scale$2(M,M,I),p.scale$2(b,b,-1),p.multiply$2(b,b,M);const O=p.create();p.translate(O,O,b),p.scale(O,O,M),this.mercatorFogMatrix=O,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(l,g,I)}_computeCameraPosition(l){const g=(l=l||this.pixelsPerMeter)/this.pixelsPerMeter,b=this._camera.forward(),I=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*g-l/this.worldSize*this._centerAltitude;return[I.x/this.worldSize-b[0]*M,I.y/this.worldSize-b[1]*M,l/this.worldSize*this._centerAltitude-b[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(l){const g=this._maxCameraBoundsDistance()*Math.cos(this._pitch),b=this._camera.position[2],I=l[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),I>0&&(M=Math.min((g-b)/I,1)),this._camera.position=p.scaleAndAdd([],this._camera.position,l,M),this._updateStateFromCamera()}_updateStateFromCamera(){const l=this._camera.position,g=this._camera.forward(),{pitch:b,bearing:I}=this._camera.getPitchBearing(),M=p.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,O=this._mercatorZfromZoom(this._maxZoom)*Math.cos(p.degToRad(this._maxPitch)),B=Math.max((l[2]-M)/Math.cos(b),O),U=this._zoomFromMercatorZ(B);p.scaleAndAdd(l,l,g,B),this._pitch=p.clamp(b,p.degToRad(this.minPitch),p.degToRad(this.maxPitch)),this.angle=p.wrap(I,-Math.PI,Math.PI),this._setZoom(p.clamp(U,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new p.MercatorCoordinate(l[0],l[1],l[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(l){return Math.pow(2,l)*this.tileSize}_mercatorZfromZoom(l){return this.cameraToCenterDistance/this._worldSizeFromZoom(l)}_minimumHeightOverTerrain(){const l=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(l)}_zoomFromMercatorZ(l){return this.scaleZoom(this.cameraToCenterDistance/(l*this.tileSize))}zoomFromMercatorZAdjusted(l){const g=O=>{const B=this.getCameraToCenterDistance(this.projection,O);return this.scaleZoom(B/(l*this.tileSize))};let b,I=g(this.zoom),M=Math.abs(I-g(I));for(;b!==M;)I=g(I),b=M,M=Math.abs(I-g(I));return I}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(p.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(l,g){const b=Math.min(l.x,g.x),I=Math.max(l.x,g.x),M=Math.min(l.y,g.y),O=Math.max(l.y,g.y);if(M<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const B=[new p.pointGeometry(b,M),new p.pointGeometry(I,O),new p.pointGeometry(b,O),new p.pointGeometry(I,M)],U=this.renderWorldCopies?-3:0,$=this.renderWorldCopies?4:1;for(const q of B){const Z=this.pointRayIntersection(q);if(Z.t<0)return!0;const ge=this.rayIntersectionCoordinate(Z);if(ge.x<U||ge.y<0||ge.x>$||ge.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+p.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new p.pointGeometry(0,0),new p.pointGeometry(this.width,this.height))}zoomDeltaToMovement(l,g){const b=p.length(p.sub([],this._camera.position,l)),I=this._zoomFromMercatorZ(b)+g;return b-this._mercatorZfromZoom(I)}getCameraPoint(){if("globe"===this.projection.name){const l=function(g,b){const I=[g[0],g[1],g[2],1];p.transformMat4$1(I,I,b);const M=Math.max(I[3],1e-6);return[I[0]/M,I[1]/M,I[2]/M,M]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new p.pointGeometry(l[0],l[1])}{const l=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new p.pointGeometry(0,l))}}getCameraToCenterDistance(l,g=this.zoom){const b=fh(l,g,this.width,this.height,1024),I=l.pixelSpaceConversion(this.center.lat,this.worldSize,b);return.5/Math.tan(.5*this._fov)*this.height*I}getWorldToCameraMatrix(){const l=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&p.multiply(l,l,this.globeMatrix),l}}function Xl(v,l){let g=!1,b=null;const I=()=>{b=null,g&&(v(),b=setTimeout(I,l),g=!1)};return()=>(g=!0,b||I(),b)}class xl{constructor(l){this._hashName=l&&encodeURIComponent(l),p.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Xl(this._updateHashUnthrottled.bind(this),300)}addTo(l){return this._map=l,p.window.addEventListener("hashchange",this._onHashChange,!1),l.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),p.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const l=this._map;if(!l)return"";const g=Es(l);if(this._hashName){const b=this._hashName;let I=!1;const M=p.window.location.hash.slice(1).split("&").map(O=>{const B=O.split("=")[0];return B===b?(I=!0,`${B}=${g}`):O}).filter(O=>O);return I||M.push(`${b}=${g}`),`#${M.join("&")}`}return`#${g}`}_getCurrentHash(){const l=p.window.location.hash.replace("#","");if(this._hashName){let g;return l.split("&").map(b=>b.split("=")).forEach(b=>{b[0]===this._hashName&&(g=b)}),(g&&g[1]||"").split("/")}return l.split("/")}_onHashChange(){const l=this._map;if(!l)return!1;const g=this._getCurrentHash();if(g.length>=3&&!g.some(b=>isNaN(b))){const b=l.dragRotate.isEnabled()&&l.touchZoomRotate.isEnabled()?+(g[3]||0):l.getBearing();return l.jumpTo({center:[+g[2],+g[1]],zoom:+g[0],bearing:b,pitch:+(g[4]||0)}),!0}return!1}_updateHashUnthrottled(){const l=p.window.location.href.replace(/(#.+)?$/,this.getHashString());p.window.history.replaceState(p.window.history.state,null,l)}}function Es(v,l){const g=v.getCenter(),b=Math.round(100*v.getZoom())/100,I=Math.ceil((b*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,I),O=Math.round(g.lng*M)/M,B=Math.round(g.lat*M)/M,U=v.getBearing(),$=v.getPitch();let q=l?`/${O}/${B}/${b}`:`${b}/${B}/${O}`;return(U||$)&&(q+="/"+Math.round(10*U)/10),$&&(q+=`/${Math.round($)}`),q}const as={linearity:.3,easing:p.bezier(0,0,.3,1)},_c=p.extend({deceleration:2500,maxSpeed:1400},as),Ns=p.extend({deceleration:20,maxSpeed:1400},as),$h=p.extend({deceleration:1e3,maxSpeed:360},as),Vc=p.extend({deceleration:1e3,maxSpeed:90},as);class ks{constructor(l){this._map=l,this.clear()}clear(){this._inertiaBuffer=[]}record(l){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:p.exported.now(),settings:l})}_drainInertiaBuffer(){const l=this._inertiaBuffer,g=p.exported.now();for(;l.length>0&&g-l[0].time>160;)l.shift()}_onMoveEnd(l){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const g={zoom:0,bearing:0,pitch:0,pan:new p.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)g.zoom+=M.zoomDelta||0,g.bearing+=M.bearingDelta||0,g.pitch+=M.pitchDelta||0,M.panDelta&&g.pan._add(M.panDelta),M.around&&(g.around=M.around),M.pinchAround&&(g.pinchAround=M.pinchAround);const b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,I={};if(g.pan.mag()){const M=Ks(g.pan.mag(),b,p.extend({},_c,l||{}));I.offset=g.pan.mult(M.amount/g.pan.mag()),I.center=this._map.transform.center,Gu(I,M)}if(g.zoom){const M=Ks(g.zoom,b,Ns);I.zoom=this._map.transform.zoom+M.amount,Gu(I,M)}if(g.bearing){const M=Ks(g.bearing,b,$h);I.bearing=this._map.transform.bearing+p.clamp(M.amount,-179,179),Gu(I,M)}if(g.pitch){const M=Ks(g.pitch,b,Vc);I.pitch=this._map.transform.pitch+M.amount,Gu(I,M)}if(I.zoom||I.bearing){const M=void 0===g.pinchAround?g.around:g.pinchAround;I.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),I.noMoveStart=!0,I}}function Gu(v,l){(!v.duration||v.duration<l.duration)&&(v.duration=l.duration,v.easing=l.easing)}function Ks(v,l,g){const{maxSpeed:b,linearity:I,deceleration:M}=g,O=p.clamp(v*I/(l/1e3),-b,b),B=Math.abs(O)/(M*I);return{easing:g.easing,duration:1e3*B,amount:O*(B/2)}}class Cs extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b,I={}){const M=Y(g.getCanvasContainer(),b),O=g.unproject(M);super(l,p.extend({point:M,lngLat:O,originalEvent:b},I)),this._defaultPrevented=!1,this.target=g}}class wl extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b){const I="touchend"===l?b.changedTouches:b.touches,M=ce(g.getCanvasContainer(),I),O=M.map(U=>g.unproject(U)),B=M.reduce((U,$,q,Z)=>U.add($.div(Z.length)),new p.pointGeometry(0,0));super(l,{points:M,point:B,lngLats:O,lngLat:g.unproject(B),originalEvent:b}),this._defaultPrevented=!1}}class ud extends p.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(l,g,b){super(l,{originalEvent:b}),this._defaultPrevented=!1}}class qh{constructor(l,g){this._map=l,this._clickTolerance=g.clickTolerance}reset(){this._mousedownPos=void 0}wheel(l){return this._firePreventable(new ud(l.type,this._map,l))}mousedown(l,g){return this._mousedownPos=g,this._firePreventable(new Cs(l.type,this._map,l))}mouseup(l){this._map.fire(new Cs(l.type,this._map,l))}preclick(l){const g=p.extend({},l);g.type="preclick",this._map.fire(new Cs(g.type,this._map,g))}click(l,g){this._mousedownPos&&this._mousedownPos.dist(g)>=this._clickTolerance||(this.preclick(l),this._map.fire(new Cs(l.type,this._map,l)))}dblclick(l){return this._firePreventable(new Cs(l.type,this._map,l))}mouseover(l){this._map.fire(new Cs(l.type,this._map,l))}mouseout(l){this._map.fire(new Cs(l.type,this._map,l))}touchstart(l){return this._firePreventable(new wl(l.type,this._map,l))}touchmove(l){this._map.fire(new wl(l.type,this._map,l))}touchend(l){this._map.fire(new wl(l.type,this._map,l))}touchcancel(l){this._map.fire(new wl(l.type,this._map,l))}_firePreventable(l){if(this._map.fire(l),l.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ka{constructor(l){this._map=l}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(l){this._map.fire(new Cs(l.type,this._map,l))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Cs("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(l){this._delayContextMenu?this._contextMenuEvent=l:this._map.fire(new Cs(l.type,this._map,l)),this._map.listens("contextmenu")&&l.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zl{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._container=l.getContainer(),this._clickTolerance=g.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(l,g){this.isEnabled()&&l.shiftKey&&0===l.button&&(pn(),this._startPos=this._lastPos=g,this._active=!0)}mousemoveWindow(l,g){if(!this._active)return;const b=g,I=this._startPos,M=this._lastPos;if(!I||!M||M.equals(b)||!this._box&&b.dist(I)<this._clickTolerance)return;this._lastPos=b,this._box||(this._box=Ct("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",l));const O=Math.min(I.x,b.x),B=Math.max(I.x,b.x),U=Math.min(I.y,b.y),$=Math.max(I.y,b.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${O}px,${U}px)`,this._box.style.width=B-O+"px",this._box.style.height=$-U+"px")})}mouseupWindow(l,g){if(!this._active)return;const b=this._startPos,I=g;if(b&&0===l.button){if(this.reset(),le(),b.x!==I.x||b.y!==I.y)return this._map.fire(new p.Event("boxzoomend",{originalEvent:l})),{cameraAnimation:M=>M.fitScreenCoordinates(b,I,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",l)}}keydown(l){this._active&&27===l.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",l))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),he(),delete this._startPos,delete this._lastPos}_fireEvent(l,g){return this._map.fire(new p.Event(l,{originalEvent:g}))}}function bl(v,l){const g={};for(let b=0;b<v.length;b++)g[v[b].identifier]=l[b];return g}class Wl{constructor(l){this.reset(),this.numTouches=l.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(l,g,b){(this.centroid||b.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=l.timeStamp),b.length===this.numTouches&&(this.centroid=function(I){const M=new p.pointGeometry(0,0);for(const O of I)M._add(O);return M.div(I.length)}(g),this.touches=bl(b,g)))}touchmove(l,g,b){if(this.aborted||!this.centroid)return;const I=bl(b,g);for(const M in this.touches){const O=this.touches[M],B=I[M];(!B||B.dist(O)>30)&&(this.aborted=!0)}}touchend(l,g,b){if((!this.centroid||l.timeStamp-this.startTime>500)&&(this.aborted=!0),0===b.length){const I=!this.aborted&&this.centroid;if(this.reset(),I)return I}}}class tl{constructor(l){this.singleTap=new Wl(l),this.numTaps=l.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(l,g,b){this.singleTap.touchstart(l,g,b)}touchmove(l,g,b){this.singleTap.touchmove(l,g,b)}touchend(l,g,b){const I=this.singleTap.touchend(l,g,b);if(I){const M=l.timeStamp-this.lastTime<500,O=!this.lastTap||this.lastTap.dist(I)<30;if(M&&O||this.reset(),this.count++,this.lastTime=l.timeStamp,this.lastTap=I,this.count===this.numTaps)return this.reset(),I}}}class Fs{constructor(){this._zoomIn=new tl({numTouches:1,numTaps:2}),this._zoomOut=new tl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(l,g,b){this._zoomIn.touchstart(l,g,b),this._zoomOut.touchstart(l,g,b)}touchmove(l,g,b){this._zoomIn.touchmove(l,g,b),this._zoomOut.touchmove(l,g,b)}touchend(l,g,b){const I=this._zoomIn.touchend(l,g,b),M=this._zoomOut.touchend(l,g,b);return I?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()+1,around:O.unproject(I)},{originalEvent:l})}):M?(this._active=!0,l.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:O=>O.easeTo({duration:300,zoom:O.getZoom()-1,around:O.unproject(M)},{originalEvent:l})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const vc={0:1,2:2};class nl{constructor(l){this.reset(),this._clickTolerance=l.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(l,g){return!1}_move(l,g){return{}}mousedown(l,g){if(this._lastPoint)return;const b=ke(l);this._correctButton(l,b)&&(this._lastPoint=g,this._eventButton=b)}mousemoveWindow(l,g){const b=this._lastPoint;if(b)if(l.preventDefault(),null!=this._eventButton&&function(I,M){const O=vc[M];return void 0===I.buttons||(I.buttons&O)!==O}(l,this._eventButton))this.reset();else if(this._moved||!(g.dist(b)<this._clickTolerance))return this._moved=!0,this._lastPoint=g,this._move(b,g)}mouseupWindow(l){this._lastPoint&&ke(l)===this._eventButton&&(this._moved&&le(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class us extends nl{mousedown(l,g){super.mousedown(l,g),this._lastPoint&&(this._active=!0)}_correctButton(l,g){return 0===g&&!l.ctrlKey}_move(l,g){return{around:g,panDelta:g.sub(l)}}}class br extends nl{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const b=.8*(g.x-l.x);if(b)return this._active=!0,{bearingDelta:b}}contextmenu(l){l.preventDefault()}}class sa extends nl{_correctButton(l,g){return 0===g&&l.ctrlKey||2===g}_move(l,g){const b=-.5*(g.y-l.y);if(b)return this._active=!0,{pitchDelta:b}}contextmenu(l){l.preventDefault()}}class Js{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._minTouches=1,this._clickTolerance=g.clickTolerance||1,this.reset(),p.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new p.pointGeometry(0,0)}touchstart(l,g,b){return this._calculateTransform(l,g,b)}touchmove(l,g,b){if(this._active&&!(b.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===b.length&&!p.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return l.cancelable&&l.preventDefault(),this._calculateTransform(l,g,b)}}touchend(l,g,b){this._calculateTransform(l,g,b),this._active&&b.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(l,g,b){b.length>0&&(this._active=!0);const I=bl(b,g),M=new p.pointGeometry(0,0),O=new p.pointGeometry(0,0);let B=0;for(const $ in I){const q=I[$],Z=this._touches[$];Z&&(M._add(q),O._add(q.sub(Z)),B++,I[$]=q)}if(this._touches=I,B<this._minTouches||!O.mag())return;const U=O.div(B);return this._sum._add(U),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(B),panDelta:U}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ct("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class $u{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(l){}_move(l,g,b){return{}}touchstart(l,g,b){this._firstTwoTouches||b.length<2||(this._firstTwoTouches=[b[0].identifier,b[1].identifier],this._start([g[0],g[1]]))}touchmove(l,g,b){const I=this._firstTwoTouches;if(!I)return;l.preventDefault();const[M,O]=I,B=zs(b,g,M),U=zs(b,g,O);if(!B||!U)return;const $=this._aroundCenter?null:B.add(U).div(2);return this._move([B,U],$,l)}touchend(l,g,b){if(!this._firstTwoTouches)return;const[I,M]=this._firstTwoTouches,O=zs(b,g,I),B=zs(b,g,M);O&&B||(this._active&&le(),this.reset())}touchcancel(){this.reset()}enable(l){this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zs(v,l,g){for(let b=0;b<v.length;b++)if(v[b].identifier===g)return l[b]}function El(v,l){return Math.log(v/l)/Math.LN2}class Po extends $u{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(l){this._startDistance=this._distance=l[0].dist(l[1])}_move(l,g){const b=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(El(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:El(this._distance,b),pinchAround:g}}}function Zo(v,l){return 180*v.angleWith(l)/Math.PI}class Bs extends $u{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])}_move(l,g){const b=this._vector;if(this._vector=l[0].sub(l[1]),b&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Zo(this._vector,b),pinchAround:g}}_isBelowThreshold(l){this._minDiameter=Math.min(this._minDiameter,l.mag());const g=25/(Math.PI*this._minDiameter)*360,b=this._startVector;if(!b)return!1;const I=Zo(l,b);return Math.abs(I)<g}}function xc(v){return Math.abs(v.y)>Math.abs(v.x)}class u extends $u{constructor(l){super(),this._map=l}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(l){this._lastPoints=l,xc(l[0].sub(l[1]))&&(this._valid=!1)}_move(l,g,b){const I=this._lastPoints;if(!I)return;const M=l[0].sub(I[0]),O=l[1].sub(I[1]);return this._map._cooperativeGestures&&!p.isFullscreen()&&b.touches.length<3||(this._valid=this.gestureBeginsVertically(M,O,b.timeStamp),!this._valid)?void 0:(this._lastPoints=l,this._active=!0,{pitchDelta:(M.y+O.y)/2*-.5})}gestureBeginsVertically(l,g,b){if(void 0!==this._valid)return this._valid;const I=l.mag()>=2,M=g.mag()>=2;if(!I&&!M)return;if(!I||!M)return null==this._firstMove&&(this._firstMove=b),b-this._firstMove<100&&void 0;const O=l.y>0==g.y>0;return xc(l)&&xc(g)&&O}}const h={panStep:100,bearingStep:15,pitchStep:10};class y{constructor(){const l=h;this._panStep=l.panStep,this._bearingStep=l.bearingStep,this._pitchStep=l.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(l){if(l.altKey||l.ctrlKey||l.metaKey)return;let g=0,b=0,I=0,M=0,O=0;switch(l.keyCode){case 61:case 107:case 171:case 187:g=1;break;case 189:case 109:case 173:g=-1;break;case 37:l.shiftKey?b=-1:(l.preventDefault(),M=-1);break;case 39:l.shiftKey?b=1:(l.preventDefault(),M=1);break;case 38:l.shiftKey?I=1:(l.preventDefault(),O=-1);break;case 40:l.shiftKey?I=-1:(l.preventDefault(),O=1);break;default:return}return this._rotationDisabled&&(b=0,I=0),{cameraAnimation:B=>{const U=B.getZoom();B.easeTo({duration:300,easeId:"keyboardHandler",easing:x,zoom:g?Math.round(U)+g*(l.shiftKey?2:1):U,bearing:B.getBearing()+b*this._bearingStep,pitch:B.getPitch()+I*this._pitchStep,offset:[-M*this._panStep,-O*this._panStep],center:B.getCenter()},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function x(v){return v*(2-v)}const T=4.000244140625;class k{constructor(l,g){this._map=l,this._el=l.getCanvasContainer(),this._handler=g,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,p.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(l){this._defaultZoomRate=l}setWheelZoomRate(l){this._wheelZoomRate=l}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(l){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!l&&"center"===l.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(l){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(l.ctrlKey||l.metaKey||this.isZooming()||p.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let g=l.deltaMode===p.window.WheelEvent.DOM_DELTA_LINE?40*l.deltaY:l.deltaY;const b=p.exported.now(),I=b-(this._lastWheelEventTime||0);this._lastWheelEventTime=b,0!==g&&g%T==0?this._type="wheel":0!==g&&Math.abs(g)<4?this._type="trackpad":I>400?(this._type=null,this._lastValue=g,this._timeout=setTimeout(this._onTimeout,40,l)):this._type||(this._type=Math.abs(I*g)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,g+=this._lastValue)),l.shiftKey&&g&&(g/=4),this._type&&(this._lastWheelEvent=l,this._delta-=g,this._active||this._start(l)),l.preventDefault()}_onTimeout(l){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)}_start(l){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const g=Y(this._el,l);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:g,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const l=this._map.transform;"wheel"===this._type&&l.projection.wrap&&(l._center.lng>=180||l._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const g=()=>l._terrainEnabled()&&this._aroundCoord?l.computeZoomRelativeTo(this._aroundCoord):l.zoom;if(0!==this._delta){const U="wheel"===this._type&&Math.abs(this._delta)>T?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*U)));this._delta<0&&0!==$&&($=1/$);const q=g(),Z=Math.pow(2,q),ge="number"==typeof this._targetZoom?l.zoomScale(this._targetZoom):Z;this._targetZoom=Math.min(l.maxZoom,Math.max(l.minZoom,l.scaleZoom(ge*$))),"wheel"===this._type&&(this._startZoom=q,this._easing=this._smoothOutEasing(200)),this._delta=0}const b="number"==typeof this._targetZoom?this._targetZoom:g(),I=this._startZoom,M=this._easing;let O,B=!1;if("wheel"===this._type&&I&&M){const U=Math.min((p.exported.now()-this._lastWheelEventTime)/200,1),$=M(U);O=p.number(I,b,$),U<1?this._frameId||(this._frameId=!0):B=!0}else O=b,B=!0;return this._active=!0,B&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!B,zoomDelta:O-g(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(l){let g=p.ease;if(this._prevEase){const b=this._prevEase,I=(p.exported.now()-b.start)/b.duration,M=b.easing(I+.01)-b.easing(I),O=.27/Math.sqrt(M*M+1e-4)*.01,B=Math.sqrt(.0729-O*O);g=p.bezier(O,B,.25,1)}return this._prevEase={start:p.exported.now(),duration:l,easing:g},g}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Ct("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(p.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class G{constructor(l,g){this._clickZoom=l,this._tapZoom=g}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class K{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(l,g){return l.preventDefault(),{cameraAnimation:b=>{b.easeTo({duration:300,zoom:b.getZoom()+(l.shiftKey?-1:1),around:b.unproject(g)},{originalEvent:l})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class re{constructor(){this._tap=new tl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(l,g,b){this._swipePoint||(this._tapTime&&l.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?b.length>0&&(this._swipePoint=g[0],this._swipeTouch=b[0].identifier):this._tap.touchstart(l,g,b))}touchmove(l,g,b){if(this._tapTime){if(this._swipePoint){if(b[0].identifier!==this._swipeTouch)return;const I=g[0],M=I.y-this._swipePoint.y;return this._swipePoint=I,l.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(l,g,b)}touchend(l,g,b){this._tapTime?this._swipePoint&&0===b.length&&this.reset():this._tap.touchend(l,g,b)&&(this._tapTime=l.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class et{constructor(l,g,b){this._el=l,this._mousePan=g,this._touchPan=b}enable(l){this._inertiaOptions=l||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ft{constructor(l,g,b){this._pitchWithRotate=l.pitchWithRotate,this._mouseRotate=g,this._mousePitch=b}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class $t{constructor(l,g,b,I){this._el=l,this._touchZoom=g,this._touchRotate=b,this._tapDragZoom=I,this._rotationDisabled=!1,this._enabled=!0}enable(l){this._touchZoom.enable(l),this._rotationDisabled||this._touchRotate.enable(l),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const gt=v=>v.zoom||v.drag||v.pitch||v.rotate;class nn extends p.Event{}class Un{constructor(){this.constants=[1,1,.01],this.radius=0}setup(l,g){const b=p.sub([],g,l);this.radius=p.length(b[2]<0?p.div([],b,this.constants):[b[0],b[1],0])}projectRay(l){p.div(l,l,this.constants),p.normalize(l,l),p.mul$1(l,l,this.constants);const g=p.scale$2([],l,this.radius);if(g[2]>0){const b=p.scale$2([],[0,0,1],p.dot(g,[0,0,1])),I=p.scale$2([],p.normalize([],[g[0],g[1],0]),this.radius),M=p.add([],g,p.scale$2([],p.sub([],p.add([],I,b),g),2));g[0]=M[0],g[1]=M[1]}return g}}function Qn(v){return v.panDelta&&v.panDelta.mag()||v.zoomDelta||v.bearingDelta||v.pitchDelta}class Sr{constructor(l,g){this._map=l,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new ks(l),this._bearingSnap=g.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Un,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(g),p.bindAll(["handleEvent","handleWindowEvent"],this);const b=this._el;this._listeners=[[b,"touchstart",{passive:!0}],[b,"touchmove",{passive:!1}],[b,"touchend",void 0],[b,"touchcancel",void 0],[b,"mousedown",void 0],[b,"mousemove",void 0],[b,"mouseup",void 0],[p.window.document,"mousemove",{capture:!0}],[p.window.document,"mouseup",void 0],[b,"mouseover",void 0],[b,"mouseout",void 0],[b,"dblclick",void 0],[b,"click",void 0],[b,"keydown",{capture:!1}],[b,"keyup",void 0],[b,"wheel",{passive:!1}],[b,"contextmenu",void 0],[p.window,"blur",void 0]];for(const[I,M,O]of this._listeners)I.addEventListener(M,I===p.window.document?this.handleWindowEvent:this.handleEvent,O)}destroy(){for(const[l,g,b]of this._listeners)l.removeEventListener(g,l===p.window.document?this.handleWindowEvent:this.handleEvent,b)}_addDefaultHandlers(l){const g=this._map,b=g.getCanvasContainer();this._add("mapEvent",new qh(g,l));const I=g.boxZoom=new Zl(g,l);this._add("boxZoom",I);const M=new Fs,O=new K;g.doubleClickZoom=new G(O,M),this._add("tapZoom",M),this._add("clickZoom",O);const B=new re;this._add("tapDragZoom",B);const U=g.touchPitch=new u(g);this._add("touchPitch",U);const $=new br(l),q=new sa(l);g.dragRotate=new Ft(l,$,q),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",q,["mouseRotate"]);const Z=new us(l),ge=new Js(g,l);g.dragPan=new et(b,Z,ge),this._add("mousePan",Z),this._add("touchPan",ge,["touchZoom","touchRotate"]);const De=new Bs,be=new Po;g.touchZoomRotate=new $t(b,be,De,B),this._add("touchRotate",De,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ka(g));const Re=g.scrollZoom=new k(g,this);this._add("scrollZoom",Re,["mousePan"]);const Ce=g.keyboard=new y;this._add("keyboard",Ce);for(const xe of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])l.interactive&&l[xe]&&g[xe].enable(l[xe])}_add(l,g,b){this._handlers.push({handlerName:l,handler:g,allowed:b}),this._handlersById[l]=g}stop(l){if(!this._updatingCamera){for(const{handler:g}of this._handlers)g.reset();this._inertia.clear(),this._fireEvents({},{},l),this._changes=[]}}isActive(){for(const{handler:l}of this._handlers)if(l.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!gt(this._eventsInProgress)||this.isZooming()}_blockedByActive(l,g,b){for(const I in l)if(I!==b&&(!g||g.indexOf(I)<0))return!0;return!1}handleWindowEvent(l){this.handleEvent(l,`${l.type}Window`)}_getMapTouches(l){const g=[];for(const b of l)this._el.contains(b.target)&&g.push(b);return g}handleEvent(l,g){this._updatingCamera=!0;const b="renderFrame"===l.type,I=b?void 0:l,M={needsRenderFrame:!1},O={},B={},U=l.touches?this._getMapTouches(l.touches):void 0,$=U?ce(this._el,U):b?void 0:Y(this._el,l);for(const{handlerName:ge,handler:De,allowed:be}of this._handlers){if(!De.isEnabled())continue;let Re;this._blockedByActive(B,be,ge)?De.reset():De[g||l.type]&&(Re=De[g||l.type](l,$,U),this.mergeHandlerResult(M,O,Re,ge,I),Re&&Re.needsRenderFrame&&this._triggerRenderFrame()),(Re||De.isActive())&&(B[ge]=De)}const q={};for(const ge in this._previousActiveHandlers)B[ge]||(q[ge]=I);this._previousActiveHandlers=B,(Object.keys(q).length||Qn(M))&&(this._changes.push([M,O,q]),this._triggerRenderFrame()),(Object.keys(B).length||Qn(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=M;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(l,g,b,I,M){if(!b)return;p.extend(l,b);const O={handlerName:I,originalEvent:b.originalEvent||M};void 0!==b.zoomDelta&&(g.zoom=O),void 0!==b.panDelta&&(g.drag=O),void 0!==b.pitchDelta&&(g.pitch=O),void 0!==b.bearingDelta&&(g.rotate=O)}_applyChanges(){const l={},g={},b={};for(const[I,M,O]of this._changes)I.panDelta&&(l.panDelta=(l.panDelta||new p.pointGeometry(0,0))._add(I.panDelta)),I.zoomDelta&&(l.zoomDelta=(l.zoomDelta||0)+I.zoomDelta),I.bearingDelta&&(l.bearingDelta=(l.bearingDelta||0)+I.bearingDelta),I.pitchDelta&&(l.pitchDelta=(l.pitchDelta||0)+I.pitchDelta),void 0!==I.around&&(l.around=I.around),void 0!==I.aroundCoord&&(l.aroundCoord=I.aroundCoord),void 0!==I.pinchAround&&(l.pinchAround=I.pinchAround),I.noInertia&&(l.noInertia=I.noInertia),p.extend(g,M),p.extend(b,O);this._updateMapTransform(l,g,b),this._changes=[]}_updateMapTransform(l,g,b){const I=this._map,M=I.transform,O=Ne=>[Ne.x,Ne.y,Ne.z];if((Ne=>{const Se=this._eventsInProgress.drag;return Se&&!this._handlersById[Se.handlerName].isActive()})()&&!Qn(l)){const Ne=M.zoom;M.cameraElevationReference="sea",M.recenterOnTerrain(),M.cameraElevationReference="ground",Ne!==M.zoom&&this._map._update(!0)}if(!Qn(l))return void this._fireEvents(g,b,!0);let{panDelta:B,zoomDelta:U,bearingDelta:$,pitchDelta:q,around:Z,aroundCoord:ge,pinchAround:De}=l;void 0!==De&&(Z=De),(Ne=>g.drag&&!this._eventsInProgress.drag)()&&Z&&(this._dragOrigin=O(M.pointCoordinate3D(Z)),this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",I._stop(!0),Z=Z||I.transform.centerPoint,$&&(M.bearing+=$),q&&(M.pitch+=q),M._updateCameraState();const be=[0,0,0];if(B)if("mercator"===M.projection.name){const Ne=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(Z).dir),Se=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(Z.sub(B)).dir);be[0]=Se[0]-Ne[0],be[1]=Se[1]-Ne[1]}else{const Ne=M.pointCoordinate(Z);if("globe"===M.projection.name){B=B.rotate(-M.angle);const Se=M._pixelsPerMercatorPixel/M.worldSize;be[0]=-B.x*p.mercatorScale(p.latFromMercatorY(Ne.y))*Se,be[1]=-B.y*p.mercatorScale(M.center.lat)*Se}else{const Se=M.pointCoordinate(Z.sub(B));Ne&&Se&&(be[0]=Se.x-Ne.x,be[1]=Se.y-Ne.y)}}const Re=M.zoom,Ce=[0,0,0];if(U){const Ne=O(ge||M.pointCoordinate3D(Z)),Se={dir:p.normalize([],p.sub([],Ne,M._camera.position))};if(Se.dir[2]<0){const Ye=M.zoomDeltaToMovement(Ne,U);p.scale$2(Ce,Se.dir,Ye)}}const xe=p.add(be,be,Ce);M._translateCameraConstrained(xe),U&&Math.abs(M.zoom-Re)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),l.noInertia||this._inertia.record(l),this._fireEvents(g,b,!0)}_fireEvents(l,g,b){const I=gt(this._eventsInProgress),M=gt(l),O={};for(const q in l){const{originalEvent:Z}=l[q];this._eventsInProgress[q]||(O[`${q}start`]=Z),this._eventsInProgress[q]=l[q]}!I&&M&&this._fireEvent("movestart",M.originalEvent);for(const q in O)this._fireEvent(q,O[q]);M&&this._fireEvent("move",M.originalEvent);for(const q in l){const{originalEvent:Z}=l[q];this._fireEvent(q,Z)}const B={};let U;for(const q in this._eventsInProgress){const{handlerName:Z,originalEvent:ge}=this._eventsInProgress[q];this._handlersById[Z].isActive()||(delete this._eventsInProgress[q],U=g[Z]||ge,B[`${q}end`]=U)}for(const q in B)this._fireEvent(q,B[q]);const $=gt(this._eventsInProgress);if(b&&(I||M)&&!$){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=ge=>0!==ge&&-this._bearingSnap<ge&&ge<this._bearingSnap;q?(Z(q.bearing||this._map.getBearing())&&(q.bearing=0),this._map.easeTo(q,{originalEvent:U})):(this._map.fire(new p.Event("moveend",{originalEvent:U})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(l,g){this._map.fire(new p.Event(l,g?{originalEvent:g}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(l=>{this._frameId=void 0,this.handleEvent(new nn("renderFrame",{timeStamp:l})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Bo="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xs extends p.Evented{constructor(l,g){super(),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=g.bearingSnap,p.bindAll(["_renderFrameCallback"],this)}getCenter(){return new p.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(l,g){return this.jumpTo({center:l},g)}panBy(l,g,b){return l=p.pointGeometry.convert(l).mult(-1),this.panTo(this.transform.center,p.extend({offset:l},g),b)}panTo(l,g,b){return this.easeTo(p.extend({center:l},g),b)}getZoom(){return this.transform.zoom}setZoom(l,g){return this.jumpTo({zoom:l},g),this}zoomTo(l,g,b){return this.easeTo(p.extend({zoom:l},g),b)}zoomIn(l,g){return this.zoomTo(this.getZoom()+1,l,g),this}zoomOut(l,g){return this.zoomTo(this.getZoom()-1,l,g),this}getBearing(){return this.transform.bearing}setBearing(l,g){return this.jumpTo({bearing:l},g),this}getPadding(){return this.transform.padding}setPadding(l,g){return this.jumpTo({padding:l},g),this}rotateTo(l,g,b){return this.easeTo(p.extend({bearing:l},g),b)}resetNorth(l,g){return this.rotateTo(0,p.extend({duration:1e3},l),g),this}resetNorthPitch(l,g){return this.easeTo(p.extend({bearing:0,pitch:0,duration:1e3},l),g),this}snapToNorth(l,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,g):this}getPitch(){return this.transform.pitch}setPitch(l,g){return this.jumpTo({pitch:l},g),this}cameraForBounds(l,g){l=p.LngLatBounds.convert(l);const b=g&&g.bearing||0,I=l.getNorthWest(),M=l.getSouthEast();return this._cameraForBounds(this.transform,I,M,b,g)}_extendCameraOptions(l){const g={top:0,bottom:0,right:0,left:0};if("number"==typeof(l=p.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},l)).padding){const b=l.padding;l.padding={top:b,bottom:b,right:b,left:b}}return l.padding=p.extend(g,l.padding),l}_minimumAABBFrustumDistance(l,g){const b=g.max[0]-g.min[0],I=g.max[1]-g.min[1];return b/I>l.aspect?b/(2*Math.tan(.5*l.fovX)*l.aspect):I/(2*Math.tan(.5*l.fovY)*l.aspect)}_cameraForBoundsOnGlobe(l,g,b,I,M){const O=l.clone(),B=this._extendCameraOptions(M);O.bearing=I;const U=p.LngLat.convert(g),$=p.LngLat.convert(b),q=.5*(U.lat+$.lat),Z=.5*(U.lng+$.lng),ge=p.latLngToECEF(q,Z),De=p.normalize([],ge),be=p.normalize([],p.cross([],De,[0,1,0])),Re=p.cross([],be,De),Ce=[be[0],be[1],be[2],0,Re[0],Re[1],Re[2],0,De[0],De[1],De[2],0,0,0,0,1],xe=[ge,p.latLngToECEF(U.lat,U.lng),p.latLngToECEF($.lat,U.lng),p.latLngToECEF($.lat,$.lng),p.latLngToECEF(U.lat,$.lng),p.latLngToECEF(q,U.lng),p.latLngToECEF(q,$.lng),p.latLngToECEF(U.lat,Z),p.latLngToECEF($.lat,Z)];let Ne=p.Aabb.fromPoints(xe.map(_n=>[p.dot(be,_n),p.dot(Re,_n),p.dot(De,_n)]));const Se=p.transformMat4([],Ne.center,Ce);0===p.squaredLength(Se)&&p.set(Se,0,0,1),p.normalize(Se,Se),p.scale$2(Se,Se,p.GLOBE_RADIUS),O.center=p.ecefToLatLng(Se);const Ye=O.getWorldToCameraMatrix(),Qe=p.invert(new Float64Array(16),Ye);Ne=p.Aabb.applyTransform(Ne,p.multiply([],Ye,Ce)),p.transformMat4(Se,Se,Ye);const Ge=.5*(Ne.max[2]-Ne.min[2]),it=this._minimumAABBFrustumDistance(O,Ne),St=p.scale$2([],[0,0,1],Ge),zt=p.add(St,Se,St),Pt=it+(0===O.pitch?0:p.distance(Se,zt)),dn=O.globeCenterInViewSpace,wt=p.sub([],Se,[dn[0],dn[1],dn[2]]);p.normalize(wt,wt),p.scale$2(wt,wt,Pt);const en=p.add([],Se,wt);p.transformMat4(en,en,Qe);const Jt=p.earthRadius/p.GLOBE_RADIUS,Dt=p.length(en),mt=p.mercatorZfromAltitude(Dt*Jt-p.earthRadius,0),An=Math.min(O.zoomFromMercatorZAdjusted(mt),B.maxZoom);return An>.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"mercator"}),O.zoom=An,this._cameraForBounds(O,g,b,I,M)):{center:O.center,zoom:An,bearing:I}}queryTerrainElevation(l,g){const b=this.transform.elevation;return b?(g=p.extend({},{exaggerated:!0},g),b.getAtPoint(p.MercatorCoordinate.fromLngLat(l),null,g.exaggerated)):null}_cameraForBounds(l,g,b,I,M){if("globe"===l.projection.name)return this._cameraForBoundsOnGlobe(l,g,b,I,M);const O=l.clone(),B=this._extendCameraOptions(M),U=O.padding;O.bearing=I;const $=p.LngLat.convert(g),q=p.LngLat.convert(b),Z=new p.LngLat($.lng,q.lat),ge=new p.LngLat(q.lng,$.lat),De=O.project($),be=O.project(q),Re=this.queryTerrainElevation($),Ce=this.queryTerrainElevation(q),xe=this.queryTerrainElevation(Z),Ne=this.queryTerrainElevation(ge),Se=[[De.x,De.y,Math.min(Re||0,Ce||0,xe||0,Ne||0)],[be.x,be.y,Math.max(Re||0,Ce||0,xe||0,Ne||0)]];let Ye=p.Aabb.fromPoints(Se);const Qe=O.getWorldToCameraMatrix(),Ge=p.invert(new Float64Array(16),Qe);Ye=p.Aabb.applyTransform(Ye,Qe);const it=p.sub([],Ye.max,Ye.min),St=U.left||0,zt=U.right||0,Pt=U.bottom||0,dn=U.top||0,{left:wt,right:en,top:Jt,bottom:Dt}=B.padding,mt=.5*(St+zt),An=.5*(dn+Pt),_n=Math.min(O.scaleZoom(O.scale*Math.min((O.width-(St+zt+wt+en))/it[0],(O.height-(Pt+dn+Dt+Jt))/it[1])),B.maxZoom),Cn=O.scale/O.zoomScale(_n);Ye=new p.Aabb([Ye.min[0]-(wt+mt)*Cn,Ye.min[1]-(Dt+An)*Cn,Ye.min[2]],[Ye.max[0]+(en+mt)*Cn,Ye.max[1]+(Jt+An)*Cn,Ye.max[2]]);const wn=.5*it[2],Vn=this._minimumAABBFrustumDistance(O,Ye),mr=[0,0,1,0];p.transformMat4$1(mr,mr,Qe),p.normalize$2(mr,mr);const ir=p.scale$2([],mr,Vn+wn),Xn=p.add([],Ye.center,ir),bn=("number"==typeof B.offset.x&&"number"==typeof B.offset.y?new p.pointGeometry(B.offset.x,B.offset.y):p.pointGeometry.convert(B.offset)).rotate(-p.degToRad(I));Ye.center[0]-=bn.x*Cn,Ye.center[1]+=bn.y*Cn,p.transformMat4(Ye.center,Ye.center,Ge),p.transformMat4(Xn,Xn,Ge);const xr=[Ye.center[0],Ye.center[1],Xn[2]*O.pixelsPerMeter];p.scale$2(xr,xr,1/O.worldSize);const Fr=p.lngFromMercatorX(xr[0]),ao=p.latFromMercatorY(xr[1]),Ro=Math.min(O._zoomFromMercatorZ(xr[2]),B.maxZoom),uo=new p.LngLat(Fr,ao);return O.mercatorFromTransition&&Ro<.5*(p.GLOBE_ZOOM_THRESHOLD_MIN+p.GLOBE_ZOOM_THRESHOLD_MAX)?(O.setProjection({name:"globe"}),O.zoom=Ro,this._cameraForBounds(O,g,b,I,M)):{center:uo,zoom:Ro,bearing:I}}fitBounds(l,g,b){const I=this.cameraForBounds(l,g);return this._fitInternal(I,g,b)}fitScreenCoordinates(l,g,b,I,M){const O=p.pointGeometry.convert(l),B=p.pointGeometry.convert(g),U=new p.pointGeometry(Math.min(O.x,B.x),Math.min(O.y,B.y)),$=new p.pointGeometry(Math.max(O.x,B.x),Math.max(O.y,B.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(O,B))return this;const q=this.transform.pointLocation3D(U),Z=this.transform.pointLocation3D($),ge=this.transform.pointLocation3D(new p.pointGeometry(U.x,$.y)),De=this.transform.pointLocation3D(new p.pointGeometry($.x,U.y)),be=[Math.min(q.lng,Z.lng,ge.lng,De.lng),Math.min(q.lat,Z.lat,ge.lat,De.lat)],Re=[Math.max(q.lng,Z.lng,ge.lng,De.lng),Math.max(q.lat,Z.lat,ge.lat,De.lat)],Ce=this._cameraForBounds(this.transform,be,Re,b,I);return this._fitInternal(Ce,I,M)}_fitInternal(l,g,b){return l?(delete(g=p.extend(l,g)).padding,g.linear?this.easeTo(g,b):this.flyTo(g,b)):this}jumpTo(l,g){this.stop();const b=l.preloadOnly?this.transform.clone():this.transform;let I=!1,M=!1,O=!1;return"zoom"in l&&b.zoom!==+l.zoom&&(I=!0,b.zoom=+l.zoom),void 0!==l.center&&(b.center=p.LngLat.convert(l.center)),"bearing"in l&&b.bearing!==+l.bearing&&(M=!0,b.bearing=+l.bearing),"pitch"in l&&b.pitch!==+l.pitch&&(O=!0,b.pitch=+l.pitch),null==l.padding||b.isPaddingEqual(l.padding)||(b.padding=l.padding),l.preloadOnly?(this._preloadTiles(b),this):(this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),I&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),M&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),O&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||p.warnOnce(Bo),this.transform.getFreeCameraOptions()}setFreeCameraOptions(l,g){const b=this.transform;if(!b.projection.supportsFreeCamera)return p.warnOnce(Bo),this;this.stop();const I=b.zoom,M=b.pitch,O=b.bearing;b.setFreeCameraOptions(l);const B=I!==b.zoom,U=M!==b.pitch,$=O!==b.bearing;return this.fire(new p.Event("movestart",g)).fire(new p.Event("move",g)),B&&this.fire(new p.Event("zoomstart",g)).fire(new p.Event("zoom",g)).fire(new p.Event("zoomend",g)),$&&this.fire(new p.Event("rotatestart",g)).fire(new p.Event("rotate",g)).fire(new p.Event("rotateend",g)),U&&this.fire(new p.Event("pitchstart",g)).fire(new p.Event("pitch",g)).fire(new p.Event("pitchend",g)),this.fire(new p.Event("moveend",g)),this}easeTo(l,g){this._stop(!1,l.easeId),(!1===(l=p.extend({offset:[0,0],duration:500,easing:p.ease},l)).animate||!l.essential&&p.exported.prefersReducedMotion)&&(l.duration=0);const b=this.transform,I=this.getZoom(),M=this.getBearing(),O=this.getPitch(),B=this.getPadding(),U="zoom"in l?+l.zoom:I,$="bearing"in l?this._normalizeBearing(l.bearing,M):M,q="pitch"in l?+l.pitch:O,Z="padding"in l?l.padding:b.padding,ge=p.pointGeometry.convert(l.offset);let De,be,Re;if("globe"===b.projection.name){const zt=p.MercatorCoordinate.fromLngLat(b.center),Pt=ge.rotate(-b.angle);zt.x+=Pt.x/b.worldSize,zt.y+=Pt.y/b.worldSize;const dn=zt.toLngLat(),wt=p.LngLat.convert(l.center||dn);this._normalizeCenter(wt),De=b.centerPoint.add(Pt),be=new p.pointGeometry(zt.x,zt.y).mult(b.worldSize),Re=new p.pointGeometry(p.mercatorXfromLng(wt.lng),p.mercatorYfromLat(wt.lat)).mult(b.worldSize).sub(be)}else{De=b.centerPoint.add(ge);const zt=b.pointLocation(De),Pt=p.LngLat.convert(l.center||zt);this._normalizeCenter(Pt),be=b.project(zt),Re=b.project(Pt).sub(be)}const Ce=b.zoomScale(U-I);let xe,Ne;l.around&&(xe=p.LngLat.convert(l.around),Ne=b.locationPoint(xe));const Se=this._zooming||U!==I,Ye=this._rotating||M!==$,Qe=this._pitching||q!==O,Ge=!b.isPaddingEqual(Z),it=zt=>Pt=>{if(Se&&(zt.zoom=p.number(I,U,Pt)),Ye&&(zt.bearing=p.number(M,$,Pt)),Qe&&(zt.pitch=p.number(O,q,Pt)),Ge&&(zt.interpolatePadding(B,Z,Pt),De=zt.centerPoint.add(ge)),xe)zt.setLocationAtPoint(xe,Ne);else{const dn=zt.zoomScale(zt.zoom-I),wt=U>I?Math.min(2,Ce):Math.max(.5,Ce),en=Math.pow(wt,1-Pt),Jt=zt.unproject(be.add(Re.mult(Pt*en)).mult(dn));zt.setLocationAtPoint(zt.renderWorldCopies?Jt.wrap():Jt,De)}return l.preloadOnly||this._fireMoveEvents(g),zt};if(l.preloadOnly){const zt=this._emulate(it,l.duration,b);return this._preloadTiles(zt),this}const St={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Se,this._rotating=Ye,this._pitching=Qe,this._padding=Ge,this._easeId=l.easeId,this._prepareEase(g,l.noMoveStart,St),this._ease(it(b),zt=>{b.recenterOnTerrain(),this._afterEase(g,zt)},l),this}_prepareEase(l,g,b={}){this._moving=!0,this.transform.cameraElevationReference="sea",g||b.moving||this.fire(new p.Event("movestart",l)),this._zooming&&!b.zooming&&this.fire(new p.Event("zoomstart",l)),this._rotating&&!b.rotating&&this.fire(new p.Event("rotatestart",l)),this._pitching&&!b.pitching&&this.fire(new p.Event("pitchstart",l))}_fireMoveEvents(l){this.fire(new p.Event("move",l)),this._zooming&&this.fire(new p.Event("zoom",l)),this._rotating&&this.fire(new p.Event("rotate",l)),this._pitching&&this.fire(new p.Event("pitch",l))}_afterEase(l,g){if(this._easeId&&g&&this._easeId===g)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const b=this._zooming,I=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,b&&this.fire(new p.Event("zoomend",l)),I&&this.fire(new p.Event("rotateend",l)),M&&this.fire(new p.Event("pitchend",l)),this.fire(new p.Event("moveend",l))}flyTo(l,g){if(!l.essential&&p.exported.prefersReducedMotion){const Cn=p.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Cn,g)}this.stop(),l=p.extend({offset:[0,0],speed:1.2,curve:1.42,easing:p.ease},l);const b=this.transform,I=this.getZoom(),M=this.getBearing(),O=this.getPitch(),B=this.getPadding(),U="zoom"in l?p.clamp(+l.zoom,b.minZoom,b.maxZoom):I,$="bearing"in l?this._normalizeBearing(l.bearing,M):M,q="pitch"in l?+l.pitch:O,Z="padding"in l?l.padding:b.padding,ge=b.zoomScale(U-I),De=p.pointGeometry.convert(l.offset);let be=b.centerPoint.add(De);const Re=b.pointLocation(be),Ce=p.LngLat.convert(l.center||Re);this._normalizeCenter(Ce);const xe=b.project(Re),Ne=b.project(Ce).sub(xe);let Se=l.curve;const Ye=Math.max(b.width,b.height),Qe=Ye/ge,Ge=Ne.mag();if("minZoom"in l){const Cn=p.clamp(Math.min(l.minZoom,I,U),b.minZoom,b.maxZoom),wn=Ye/b.zoomScale(Cn-I);Se=Math.sqrt(wn/Ge*2)}const it=Se*Se;function St(Cn){const wn=(Qe*Qe-Ye*Ye+(Cn?-1:1)*it*it*Ge*Ge)/(2*(Cn?Qe:Ye)*it*Ge);return Math.log(Math.sqrt(wn*wn+1)-wn)}function zt(Cn){return(Math.exp(Cn)-Math.exp(-Cn))/2}function Pt(Cn){return(Math.exp(Cn)+Math.exp(-Cn))/2}const dn=St(0);let wt=function(Cn){return Pt(dn)/Pt(dn+Se*Cn)},en=function(Cn){return Ye*((Pt(dn)*(zt(wn=dn+Se*Cn)/Pt(wn))-zt(dn))/it)/Ge;var wn},Jt=(St(1)-dn)/Se;if(Math.abs(Ge)<1e-6||!isFinite(Jt)){if(Math.abs(Ye-Qe)<1e-6)return this.easeTo(l,g);const Cn=Qe<Ye?-1:1;Jt=Math.abs(Math.log(Qe/Ye))/Se,en=function(){return 0},wt=function(wn){return Math.exp(Cn*Se*wn)}}l.duration="duration"in l?+l.duration:1e3*Jt/("screenSpeed"in l?+l.screenSpeed/Se:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0);const Dt=M!==$,mt=q!==O,An=!b.isPaddingEqual(Z),_n=Cn=>wn=>{const Vn=wn*Jt,mr=1/wt(Vn);Cn.zoom=1===wn?U:I+Cn.scaleZoom(mr),Dt&&(Cn.bearing=p.number(M,$,wn)),mt&&(Cn.pitch=p.number(O,q,wn)),An&&(Cn.interpolatePadding(B,Z,wn),be=Cn.centerPoint.add(De));const ir=1===wn?Ce:Cn.unproject(xe.add(Ne.mult(en(Vn))).mult(mr));return Cn.setLocationAtPoint(Cn.renderWorldCopies?ir.wrap():ir,be),Cn._updateCameraOnTerrain(),l.preloadOnly||this._fireMoveEvents(g),Cn};if(l.preloadOnly){const Cn=this._emulate(_n,l.duration,b);return this._preloadTiles(Cn),this}return this._zooming=!0,this._rotating=Dt,this._pitching=mt,this._padding=An,this._prepareEase(g,!1),this._ease(_n(b),()=>this._afterEase(g),l),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(l,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const b=this._onEaseEnd;this._onEaseEnd=void 0,b.call(this,g)}if(!l){const b=this.handlers;b&&b.stop(!1)}return this}_ease(l,g,b){!1===b.animate||0===b.duration?(l(1),g()):(this._easeStart=p.exported.now(),this._easeOptions=b,this._onEaseFrame=l,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const l=Math.min((p.exported.now()-this._easeStart)/this._easeOptions.duration,1),g=this._onEaseFrame;g&&g(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(l,g){l=p.wrap(l,-180,180);const b=Math.abs(l-g);return Math.abs(l-360-g)<b&&(l-=360),Math.abs(l+360-g)<b&&(l+=360),l}_normalizeCenter(l){const g=this.transform;if(!g.renderWorldCopies||g.maxBounds)return;const b=l.lng-g.center.lng;l.lng+=b>180?-360:b<-180?360:0}_emulate(l,g,b){const I=Math.ceil(15*g/1e3),M=[],O=l(b.clone());for(let B=0;B<=I;B++){const U=O(B/I);M.push(U.clone())}return M}}class Ss{constructor(l={}){this.options=l,p.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(l){const g=this.options&&this.options.compact;return this._map=l,this._container=Ct("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Ct("button","mapboxgl-ctrl-attrib-button",this._container),Ct("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Ct("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),g&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===g&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(l,g){const b=this._map._getUIString(`AttributionControl.${g}`);l.setAttribute("aria-label",b),l.removeAttribute("title"),l.firstElementChild&&l.firstElementChild.setAttribute("title",b)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let l=this._editLink;l||(l=this._editLink=this._container.querySelector(".mapbox-improve-map"));const g=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||p.config.ACCESS_TOKEN}];if(l){const b=g.reduce((I,M,O)=>(M.value&&(I+=`${M.key}=${M.value}${O<g.length-1?"&":""}`),I),"?");l.href=`${p.config.FEEDBACK_URL}/${b}#${Es(this._map,!0)}`,l.rel="noopener nofollow",this._setElementTitle(l,"MapFeedback")}}_updateData(l){!l||"metadata"!==l.sourceDataType&&"visibility"!==l.sourceDataType&&"style"!==l.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let l=[];if(this._map.style.stylesheet){const I=this._map.style.stylesheet;this.styleOwner=I.owner,this.styleId=I.id}const g=this._map.style._sourceCaches;for(const I in g){const M=g[I];if(M.used){const O=M.getSource();O.attribution&&l.indexOf(O.attribution)<0&&l.push(O.attribution)}}l.sort((I,M)=>I.length-M.length),l=l.filter((I,M)=>{for(let O=M+1;O<l.length;O++)if(l[O].indexOf(I)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?l=[...this.options.customAttribution,...l]:l.unshift(this.options.customAttribution));const b=l.join(" | ");b!==this._attribHTML&&(this._attribHTML=b,l.length?(this._innerContainer.innerHTML=b,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Va{constructor(){p.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(l){this._map=l,this._container=Ct("div","mapboxgl-ctrl");const g=Ct("a","mapboxgl-ctrl-logo");return g.target="_blank",g.rel="noopener nofollow",g.href="https://www.mapbox.com/",g.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),g.setAttribute("rel","noopener nofollow"),this._container.appendChild(g),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(l){l&&"metadata"!==l.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const l=this._map.style._sourceCaches;if(0===Object.entries(l).length)return!0;for(const g in l){const b=l[g].getSource();if(b.hasOwnProperty("mapbox_logo")&&!b.mapbox_logo)return!1}return!0}_updateCompact(){const l=this._container.children;if(l.length){const g=l[0];this._map.getCanvasContainer().offsetWidth<250?g.classList.add("mapboxgl-compact"):g.classList.remove("mapboxgl-compact")}}}class Yl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(l){const g=++this._id;return this._queue.push({callback:l,id:g,cancelled:!1}),g}remove(l){const g=this._currentlyRunning,b=g?this._queue.concat(g):this._queue;for(const I of b)if(I.id===l)return void(I.cancelled=!0)}run(l=0){const g=this._currentlyRunning=this._queue;this._queue=[];for(const b of g)if(!b.cancelled&&(b.callback(l),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function If(v,l,g){if(v=new p.LngLat(v.lng,v.lat),l){const b=new p.LngLat(v.lng-360,v.lat),I=new p.LngLat(v.lng+360,v.lat),M=360*Math.ceil(Math.abs(v.lng-g.center.lng)/360),O=g.locationPoint(v).distSqr(l),B=l.x<0||l.y<0||l.x>g.width||l.y>g.height;g.locationPoint(b).distSqr(l)<O&&(B||Math.abs(b.lng-g.center.lng)<M)?v=b:g.locationPoint(I).distSqr(l)<O&&(B||Math.abs(I.lng-g.center.lng)<M)&&(v=I)}for(;Math.abs(v.lng-g.center.lng)>180;){const b=g.locationPoint(v);if(b.x>=0&&b.y>=0&&b.x<=g.width&&b.y<=g.height)break;v.lng>g.center.lng?v.lng-=360:v.lng+=360}return v}const Jd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Tf extends p.Evented{constructor(l,g){if(super(),(l instanceof p.window.HTMLElement||g)&&(l=p.extend({element:l},g)),p.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=l&&l.occludedOpacity||.2,l&&l.element)this._element=l.element,this._offset=p.pointGeometry.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Ct("div");const I=41,M=27,O=Yt("svg",{display:"block",height:I*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${I}`},this._element),B=Yt("radialGradient",{id:"shadowGradient"},Yt("defs",{},O));Yt("stop",{offset:"10%","stop-opacity":.4},B),Yt("stop",{offset:"100%","stop-opacity":.05},B),Yt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},O),Yt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},O),Yt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},O),Yt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},O),this._offset=p.pointGeometry.convert(l&&l.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",I=>{I.preventDefault()}),this._element.addEventListener("mousedown",I=>{I.preventDefault()});const b=this._element.classList;for(const I in Jd)b.remove(`mapboxgl-marker-anchor-${I}`);b.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(l){return l===this._map||(this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._updateMoving),l.on("moveend",this._update),l.on("remove",this._clearFadeTimer),l._addMarker(this),this.setDraggable(this._draggable),this._update(),l.on("click",this._onMapClick)),this}remove(){const l=this._map;return l&&(l.off("click",this._onMapClick),l.off("move",this._updateMoving),l.off("moveend",this._update),l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler),l.off("mouseup",this._onUp),l.off("touchend",this._onUp),l.off("mousemove",this._onMove),l.off("touchmove",this._onMove),l.off("remove",this._clearFadeTimer),l._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(l){return this._lngLat=p.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){const I=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[I,-1*(24.6+I)],"bottom-right":[-I,-1*(24.6+I)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,l._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(l){const g=l.code,b=l.charCode||l.keyCode;"Space"!==g&&"Enter"!==g&&32!==b&&13!==b||this.togglePopup()}_onMapClick(l){const g=l.originalEvent.target,b=this._element;this._popup&&(g===b||b.contains(g))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const l=this._popup;return l?(l.isOpen()?(l.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(l.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const l=this._map,g=this._pos;if(!l||!g)return!1;const b=l.unproject(g),I=l.getFreeCameraOptions();if(!I.position)return!1;const M=I.position.toLngLat();return M.distanceTo(b)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const l=this._map;if(!l)return;const g=this._pos;if(!g||g.x<0||g.x>l.transform.width||g.y<0||g.y>l.transform.height)return void this._clearFadeTimer();const b=l.unproject(g);let I;l._showingGlobe()&&p.isLngLatBehindGlobe(l.transform,this._lngLat)?I=0:(I=1-l._queryFogOpacity(b),l.transform._terrainEnabled()&&l.getTerrain()&&this._behindTerrain()&&(I*=this._occludedOpacity)),this._element.style.opacity=`${I}`,this._element.style.pointerEvents=I>0?"auto":"none",this._popup&&this._popup._setOpacity(I),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const l=this._pos;if(!l||!this._map)return;const g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${l.x}px,${l.y}px)\n            ${Jd[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const l=this._pos,g=this._map,b=this.getPitchAlignment();if(!g||!l||"map"!==b)return"";if(!g._showingGlobe()){const U=g.getPitch();return U?`rotateX(${U}deg)`:""}const I=p.radToDeg(p.globeTiltAtLngLat(g.transform,this._lngLat)),M=l.sub(p.globeCenterToScreenPoint(g.transform)),O=Math.abs(M.x)+Math.abs(M.y);if(0===O)return"";const B=I/O;return`rotateX(${-M.y*B}deg) rotateY(${M.x*B}deg)`}_calculateZTransform(){const l=this._pos,g=this._map;if(!g||!l)return"";let b=0;const I=this.getRotationAlignment();if("map"===I)if(g._showingGlobe()){const M=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),O=g.project(new p.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);b=p.radToDeg(Math.atan2(O.y,O.x))-90}else b=-g.getBearing();else if("horizon"===I){const M=p.smoothstep(4,6,g.getZoom()),O=p.globeCenterToScreenPoint(g.transform);O.y+=M*g.transform.height;const B=l.sub(O),U=p.radToDeg(Math.atan2(B.y,B.x));b=(U>90?U-270:U+90)*(1-M)}return b+=this._rotation,b?`rotateZ(${b}deg)`:""}_update(l){p.window.cancelAnimationFrame(this._updateFrameId);const g=this._map;g&&(g.transform.renderWorldCopies&&(this._lngLat=If(this._lngLat,this._pos,g.transform)),this._pos=g.project(this._lngLat),!0===l?this._updateFrameId=p.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),g._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(g._showingGlobe()||g.getTerrain()||g.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(l){return this._offset=p.pointGeometry.convert(l),this._update(),this}_onMove(l){const g=this._map;if(!g)return;const b=this._pointerdownPos,I=this._positionDelta;if(b&&I){if(!this._isDragging){const M=this._clickTolerance||g._clickTolerance;if(l.point.dist(b)<M)return;this._isDragging=!0}this._pos=l.point.sub(I),this._lngLat=g.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new p.Event("dragstart"))),this.fire(new p.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const l=this._map;l&&(l.off("mousemove",this._onMove),l.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new p.Event("dragend")),this._state="inactive"}_addDragHandler(l){const g=this._map,b=this._pos;g&&b&&this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(b),this._pointerdownPos=l.point,this._state="pending",g.on("mousemove",this._onMove),g.on("touchmove",this._onMove),g.once("mouseup",this._onUp),g.once("touchend",this._onUp))}setDraggable(l){this._draggable=!!l;const g=this._map;return g&&(l?(g.on("mousedown",this._addDragHandler),g.on("touchstart",this._addDragHandler)):(g.off("mousedown",this._addDragHandler),g.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(l){return this._rotation=l||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(l){return this._rotationAlignment=l||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(l){return this._pitchAlignment=l||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(l){return this._occludedOpacity=l||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ja={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Kl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ld(v=new p.pointGeometry(0,0),l="bottom"){if("number"==typeof v){const g=Math.round(Math.sqrt(.5*Math.pow(v,2)));switch(l){case"top":return new p.pointGeometry(0,v);case"top-left":return new p.pointGeometry(g,g);case"top-right":return new p.pointGeometry(-g,g);case"bottom":return new p.pointGeometry(0,-v);case"bottom-left":return new p.pointGeometry(g,-g);case"bottom-right":return new p.pointGeometry(-g,-g);case"left":return new p.pointGeometry(v,0);case"right":return new p.pointGeometry(-v,0)}return new p.pointGeometry(0,0)}return v instanceof p.pointGeometry||Array.isArray(v)?p.pointGeometry.convert(v):p.pointGeometry.convert(v[l]||[0,0])}class dh{constructor(l){this.jumpTo(l)}getValue(l){if(l<=this._startTime)return this._start;if(l>=this._endTime)return this._end;const g=p.easeCubicInOut((l-this._startTime)/(this._endTime-this._startTime));return this._start*(1-g)+this._end*g}isEasing(l){return l>=this._startTime&&l<=this._endTime}jumpTo(l){this._startTime=-1/0,this._endTime=-1/0,this._start=l,this._end=l}easeTo(l,g,b){this._start=this.getValue(g),this._end=l,this._startTime=g,this._endTime=g+b}}const Jl={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Qd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Df(v){v.parentNode&&v.parentNode.removeChild(v)}const Hp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xp{constructor(l,g,b=!1){this._clickTolerance=10,this.element=g,this.mouseRotate=new br({clickTolerance:l.dragRotate._mouseRotate._clickTolerance}),this.map=l,b&&(this.mousePitch=new sa({clickTolerance:l.dragRotate._mousePitch._clickTolerance})),p.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),g.addEventListener("mousedown",this.mousedown),g.addEventListener("touchstart",this.touchstart,{passive:!1}),g.addEventListener("touchmove",this.touchmove),g.addEventListener("touchend",this.touchend),g.addEventListener("touchcancel",this.reset)}down(l,g){this.mouseRotate.mousedown(l,g),this.mousePitch&&this.mousePitch.mousedown(l,g),pn()}move(l,g){const b=this.map,I=this.mouseRotate.mousemoveWindow(l,g),M=I&&I.bearingDelta;if(M&&b.setBearing(b.getBearing()+M),this.mousePitch){const O=this.mousePitch.mousemoveWindow(l,g),B=O&&O.pitchDelta;B&&b.setPitch(b.getPitch()+B)}}off(){const l=this.element;l.removeEventListener("mousedown",this.mousedown),l.removeEventListener("touchstart",this.touchstart,{passive:!1}),l.removeEventListener("touchmove",this.touchmove),l.removeEventListener("touchend",this.touchend),l.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){he(),p.window.removeEventListener("mousemove",this.mousemove),p.window.removeEventListener("mouseup",this.mouseup)}mousedown(l){this.down(p.extend({},l,{ctrlKey:!0,preventDefault:()=>l.preventDefault()}),Y(this.element,l)),p.window.addEventListener("mousemove",this.mousemove),p.window.addEventListener("mouseup",this.mouseup)}mousemove(l){this.move(l,Y(this.element,l))}mouseup(l){this.mouseRotate.mouseupWindow(l),this.mousePitch&&this.mousePitch.mouseupWindow(l),this.offTemp()}touchstart(l){1!==l.targetTouches.length?this.reset():(this._startPos=this._lastPos=ce(this.element,l.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>l.preventDefault()},this._startPos))}touchmove(l){1!==l.targetTouches.length?this.reset():(this._lastPos=ce(this.element,l.targetTouches)[0],this.move({preventDefault:()=>l.preventDefault()},this._lastPos))}touchend(l){0===l.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const cd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Mf={maxWidth:100,unit:"metric"};function ep(v,l,g){const b=Hh(l),I=b/l,M={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[g];this._map._requestDomTask(()=>{this._container.style.width=v*I+"px",this._container.innerHTML=`${b}&nbsp;${M}`})}function Hh(v){const l=Math.pow(10,`${Math.floor(v)}`.length-1);let g=v/l;return g=g>=10?10:g>=5?5:g>=3?3:g>=2?2:g>=1?1:function(b){const I=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*I)/I}(g),l*g}const Af={version:p.version,supported:$e,setRTLTextPlugin:p.setRTLTextPlugin,getRTLTextPluginStatus:p.getRTLTextPluginStatus,Map:class extends xs{constructor(v){if(p.LivePerformanceUtils.mark(p.PerformanceMarkers.create),null!=(v=p.extend({},Qd,v)).minZoom&&null!=v.maxZoom&&v.minZoom>v.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=v.minPitch&&null!=v.maxPitch&&v.minPitch>v.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=v.minPitch&&v.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=v.maxPitch&&v.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(v.antialias&&p.isSafariWithAntialiasingBug(p.window)&&(v.antialias=!1,p.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ya(v.minZoom,v.maxZoom,v.minPitch,v.maxPitch,v.renderWorldCopies),v),this._interactive=v.interactive,this._minTileCacheSize=v.minTileCacheSize,this._maxTileCacheSize=v.maxTileCacheSize,this._failIfMajorPerformanceCaveat=v.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=v.preserveDrawingBuffer,this._antialias=v.antialias,this._trackResize=v.trackResize,this._bearingSnap=v.bearingSnap,this._refreshExpiredTiles=v.refreshExpiredTiles,this._fadeDuration=v.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=v.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=v.collectResourceTiming,this._optimizeForTerrain=v.optimizeForTerrain,this._language=this._parseLanguage(v.language),this._worldview=v.worldview,this._renderTaskQueue=new Yl,this._domRenderTaskQueue=new Yl,this._controls=[],this._markers=[],this._popups=[],this._mapId=p.uniqueId(),this._locale=p.extend({},Jl,v.locale),this._clickTolerance=v.clickTolerance,this._cooperativeGestures=v.cooperativeGestures,this._performanceMetricsCollection=v.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new dh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new p.RequestManager(v.transformRequest,v.accessToken,v.testMode),this._silenceAuthErrors=!!v.testMode,"string"==typeof v.container){if(this._container=p.window.document.getElementById(v.container),!this._container)throw new Error(`Container '${v.container}' not found.`)}else{if(!(v.container instanceof p.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=v.container}if(this._container.childNodes.length>0&&p.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),v.maxBounds&&this.setMaxBounds(v.maxBounds),p.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==p.window&&(p.window.addEventListener("online",this._onWindowOnline,!1),p.window.addEventListener("resize",this._onWindowResize,!1),p.window.addEventListener("orientationchange",this._onWindowResize,!1),p.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Sr(this,v),this._localFontFamily=v.localFontFamily,this._localIdeographFontFamily=v.localIdeographFontFamily,v.style&&this.setStyle(v.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),v.projection&&this.setProjection(v.projection),this._hash=v.hash&&new xl("string"==typeof v.hash&&v.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:v.center,zoom:v.zoom,bearing:v.bearing,pitch:v.pitch}),v.bounds&&(this.resize(),this.fitBounds(v.bounds,p.extend({},v.fitBoundsOptions,{duration:0})))),this.resize(),v.attributionControl&&this.addControl(new Ss({customAttribution:v.customAttribution})),this._logoControl=new Va,this.addControl(this._logoControl,v.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",l=>{this._update("style"===l.dataType),this.fire(new p.Event(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new p.Event(`${l.dataType}dataloading`,l))})}_getMapId(){return this._mapId}addControl(v,l){if(void 0===l&&(l=v.getDefaultPosition?v.getDefaultPosition():"top-right"),!v||!v.onAdd)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const g=v.onAdd(this);this._controls.push(v);const b=this._controlPositions[l];return-1!==l.indexOf("bottom")?b.insertBefore(g,b.firstChild):b.appendChild(g),this}removeControl(v){if(!v||!v.onRemove)return this.fire(new p.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const l=this._controls.indexOf(v);return l>-1&&this._controls.splice(l,1),v.onRemove(this),this}hasControl(v){return this._controls.indexOf(v)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(v){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const l=!this._moving;return l&&this.fire(new p.Event("movestart",v)).fire(new p.Event("move",v)),this.fire(new p.Event("resize",v)),l&&this.fire(new p.Event("moveend",v)),this}getBounds(){return"globe"===this.transform.projection.name&&p.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly when viewing the poles."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(v){return this.transform.setMaxBounds(p.LngLatBounds.convert(v)),this._update()}setMinZoom(v){if((v=v??-2)>=-2&&v<=this.transform.maxZoom)return this.transform.minZoom=v,this._update(),this.getZoom()<v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(v){if((v=v??22)>=this.transform.minZoom)return this.transform.maxZoom=v,this._update(),this.getZoom()>v?this.setZoom(v):this.fire(new p.Event("zoomstart")).fire(new p.Event("zoom")).fire(new p.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(v){if((v=v??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(v>=0&&v<=this.transform.maxPitch)return this.transform.minPitch=v,this._update(),this.getPitch()<v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(v){if((v=v??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(v>=this.transform.minPitch)return this.transform.maxPitch=v,this._update(),this.getPitch()>v?this.setPitch(v):this.fire(new p.Event("pitchstart")).fire(new p.Event("pitch")).fire(new p.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(v){return this.transform.renderWorldCopies=v,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(v){return"auto"===v?p.window.navigator.language:Array.isArray(v)?0===v.length?void 0:v.map(l=>"auto"===l?p.window.navigator.language:l):v}setLanguage(v){const l=this._parseLanguage(v);if(!this.style||l===this._language)return this;this._language=l,this.style._reloadSources();for(const g of this._controls)g._setLanguage&&g._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(v){return this.style&&v!==this._worldview?(this._worldview=v,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(v){return this._lazyInitEmptyStyle(),v?"string"==typeof v&&(v={name:v}):v=null,this._useExplicitProjection=!!v,this._prioritizeAndUpdateProjection(v,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const v=this.transform,l=v.projection.name;let g;"globe"===l&&v.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?(v.setMercatorFromTransition(),g=!0):"mercator"===l&&v.zoom<p.GLOBE_ZOOM_THRESHOLD_MAX&&(v.setProjection({name:"globe"}),g=!0),g&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(v,l){return this._updateProjection(v||l||{name:"mercator"})}_updateProjection(v){let l;if(l="globe"===v.name&&this.transform.zoom>=p.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(v),this.style.applyProjectionUpdate(),l){this.painter.clearBackgroundTiles();for(const g in this.style._sourceCaches)this.style._sourceCaches[g].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(v){return this.transform.locationPoint3D(p.LngLat.convert(v))}unproject(v){return this.transform.pointLocation3D(p.pointGeometry.convert(v))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(v,l,g){if("mouseenter"===v||"mouseover"===v){let b=!1;const I=O=>{const B=l.filter($=>this.getLayer($)),U=B.length?this.queryRenderedFeatures(O.point,{layers:B}):[];U.length?b||(b=!0,g.call(this,new Cs(v,this,O.originalEvent,{features:U}))):b=!1},M=()=>{b=!1};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:M}}}if("mouseleave"===v||"mouseout"===v){let b=!1;const I=O=>{const B=l.filter(U=>this.getLayer(U));(B.length?this.queryRenderedFeatures(O.point,{layers:B}):[]).length?b=!0:b&&(b=!1,g.call(this,new Cs(v,this,O.originalEvent)))},M=O=>{b&&(b=!1,g.call(this,new Cs(v,this,O.originalEvent)))};return{layers:new Set(l),listener:g,delegates:{mousemove:I,mouseout:M}}}{const b=I=>{const M=l.filter(B=>this.getLayer(B)),O=M.length?this.queryRenderedFeatures(I.point,{layers:M}):[];O.length&&(I.features=O,g.call(this,I),delete I.features)};return{layers:new Set(l),listener:g,delegates:{[v]:b}}}}on(v,l,g){if(void 0===g)return super.on(v,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(v,l,g);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[v]=this._delegatedListeners[v]||[],this._delegatedListeners[v].push(b);for(const I in b.delegates)this.on(I,b.delegates[I]);return this}once(v,l,g){if(void 0===g)return super.once(v,l);Array.isArray(l)||(l=[l]);const b=this._createDelegatedListener(v,l,g);for(const I in b.delegates)this.once(I,b.delegates[I]);return this}off(v,l,g){if(void 0===g)return super.off(v,l);l=new Set(Array.isArray(l)?l:[l]);const b=(M,O)=>{if(M.size!==O.size)return!1;for(const B of M)if(!O.has(B))return!1;return!0},I=this._delegatedListeners?this._delegatedListeners[v]:void 0;return I&&(M=>{for(let O=0;O<M.length;O++){const B=M[O];if(B.listener===g&&b(B.layers,l)){for(const U in B.delegates)this.off(U,B.delegates[U]);return M.splice(O,1),this}}})(I),this}queryRenderedFeatures(v,l){return this.style?(void 0!==l||void 0===v||v instanceof p.pointGeometry||Array.isArray(v)||(l=v,v=void 0),this.style.queryRenderedFeatures(v=v||[[0,0],[this.transform.width,this.transform.height]],l=l||{},this.transform)):[]}querySourceFeatures(v,l){return this.style.querySourceFeatures(v,l)}setStyle(v,l){return!1!==(l=p.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},l)).diff&&l.localIdeographFontFamily===this._localIdeographFontFamily&&l.localFontFamily===this._localFontFamily&&this.style&&v?(this._diffStyle(v,l),this):(this._localIdeographFontFamily=l.localIdeographFontFamily,this._localFontFamily=l.localFontFamily,this._updateStyle(v,l))}_getUIString(v){const l=this._locale[v];if(null==l)throw new Error(`Missing UI string '${v}'`);return l}_updateStyle(v,l){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),v&&(this.style=new da(this,l||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof v?this.style.loadURL(v):this.style.loadJSON(v)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new da(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(v,l){if("string"==typeof v){const g=this._requestManager.normalizeStyleURL(v),b=this._requestManager.transformRequest(g,p.ResourceType.Style);p.getJSON(b,(I,M)=>{I?this.fire(new p.ErrorEvent(I)):M&&this._updateDiff(M,l)})}else"object"==typeof v&&this._updateDiff(v,l)}_updateDiff(v,l){try{this.style.setState(v)&&this._update(!0)}catch(g){p.warnOnce(`Unable to perform style diff: ${g.message||g.error||g}.  Rebuilding the style from scratch.`),this._updateStyle(v,l)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(p.warnOnce("There is no style added to the map."),!1)}addSource(v,l){return this._lazyInitEmptyStyle(),this.style.addSource(v,l),this._update(!0)}isSourceLoaded(v){return!!this.style&&this.style._isSourceCacheLoaded(v)}areTilesLoaded(){const v=this.style&&this.style._sourceCaches;for(const l in v){const g=v[l]._tiles;for(const b in g){const I=g[b];if("loaded"!==I.state&&"errored"!==I.state)return!1}}return!0}addSourceType(v,l,g){this._lazyInitEmptyStyle(),this.style.addSourceType(v,l,g)}removeSource(v){return this.style.removeSource(v),this._updateTerrain(),this._update(!0)}getSource(v){return this.style.getSource(v)}addImage(v,l,{pixelRatio:g=1,sdf:b=!1,stretchX:I,stretchY:M,content:O}={}){if(this._lazyInitEmptyStyle(),l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap){const{width:B,height:U,data:$}=p.exported.getImageData(l);this.style.addImage(v,{data:new p.RGBAImage({width:B,height:U},$),pixelRatio:g,stretchX:I,stretchY:M,content:O,sdf:b,version:0})}else if(void 0===l.width||void 0===l.height)this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:B,height:U}=l,$=l;this.style.addImage(v,{data:new p.RGBAImage({width:B,height:U},new Uint8Array($.data)),pixelRatio:g,stretchX:I,stretchY:M,content:O,sdf:b,version:0,userImage:$}),$.onAdd&&$.onAdd(this,v)}}updateImage(v,l){const g=this.style.getImage(v);if(!g)return void this.fire(new p.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const b=l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap?p.exported.getImageData(l):l,{width:I,height:M}=b;void 0!==I&&void 0!==M?I===g.data.width&&M===g.data.height?(g.data.replace(b.data,!(l instanceof p.window.HTMLImageElement||p.window.ImageBitmap&&l instanceof p.window.ImageBitmap)),this.style.updateImage(v,g)):this.fire(new p.ErrorEvent(new Error(`The width and height of the updated image (${I}, ${M})\n                must be that same as the previous version of the image\n                (${g.data.width}, ${g.data.height})`))):this.fire(new p.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(v){return v?!!this.style.getImage(v):(this.fire(new p.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(v){this.style.removeImage(v)}loadImage(v,l){p.getImage(this._requestManager.transformRequest(v,p.ResourceType.Image),(g,b)=>{l(g,b instanceof p.window.HTMLImageElement?p.exported.getImageData(b):b)})}listImages(){return this.style.listImages()}addLayer(v,l){return this._lazyInitEmptyStyle(),this.style.addLayer(v,l),this._update(!0)}moveLayer(v,l){return this.style.moveLayer(v,l),this._update(!0)}removeLayer(v){return this.style.removeLayer(v),this._update(!0)}getLayer(v){return this.style.getLayer(v)}setLayerZoomRange(v,l,g){return this.style.setLayerZoomRange(v,l,g),this._update(!0)}setFilter(v,l,g={}){return this.style.setFilter(v,l,g),this._update(!0)}getFilter(v){return this.style.getFilter(v)}setPaintProperty(v,l,g,b={}){return this.style.setPaintProperty(v,l,g,b),this._update(!0)}getPaintProperty(v,l){return this.style.getPaintProperty(v,l)}setLayoutProperty(v,l,g,b={}){return this.style.setLayoutProperty(v,l,g,b),this._update(!0)}getLayoutProperty(v,l){return this.style.getLayoutProperty(v,l)}setLight(v,l={}){return this._lazyInitEmptyStyle(),this.style.setLight(v,l),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(v){return this._lazyInitEmptyStyle(),!v&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(v),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(v){return this._lazyInitEmptyStyle(),this.style.setFog(v),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(v){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(p.LngLat.convert(v),this.transform):0}setFeatureState(v,l){return this.style.setFeatureState(v,l),this._update()}removeFeatureState(v,l){return this.style.removeFeatureState(v,l),this._update()}getFeatureState(v){return this.style.getFeatureState(v)}_updateContainerDimensions(){if(!this._container)return;const v=this._container.getBoundingClientRect().width||400,l=this._container.getBoundingClientRect().height||300;let g,b,I,M=this._container;for(;M&&(!b||!I);){const O=p.window.getComputedStyle(M).transform;O&&"none"!==O&&(g=O.match(/matrix.*\((.+)\)/)[1].split(", "),g[0]&&"0"!==g[0]&&"1"!==g[0]&&(b=g[0]),g[3]&&"0"!==g[3]&&"1"!==g[3]&&(I=g[3])),M=M.parentElement}this._containerWidth=b?Math.abs(v/b):v,this._containerHeight=I?Math.abs(l/I):l}_detectMissingCSS(){"rgb(250, 128, 114)"!==p.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&p.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const v=this._container;v.classList.add("mapboxgl-map"),(this._missingCSSCanary=Ct("div","mapboxgl-canary",v)).style.visibility="hidden",this._detectMissingCSS();const l=this._canvasContainer=Ct("div","mapboxgl-canvas-container",v);this._interactive&&l.classList.add("mapboxgl-interactive"),this._canvas=Ct("canvas","mapboxgl-canvas",l),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const g=this._controlContainer=Ct("div","mapboxgl-control-container",v),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(I=>{b[I]=Ct("div",`mapboxgl-ctrl-${I}`,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(v,l){const g=p.exported.devicePixelRatio||1;this._canvas.width=g*Math.ceil(v),this._canvas.height=g*Math.ceil(l),this._canvas.style.width=`${v}px`,this._canvas.style.height=`${l}px`}_addMarker(v){this._markers.push(v)}_removeMarker(v){const l=this._markers.indexOf(v);-1!==l&&this._markers.splice(l,1)}_addPopup(v){this._popups.push(v)}_removePopup(v){const l=this._popups.indexOf(v);-1!==l&&this._popups.splice(l,1)}_setupPainter(){const v=p.extend({},$e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),l=this._canvas.getContext("webgl",v)||this._canvas.getContext("experimental-webgl",v);l?(p.storeAuthState(l,!0),this.painter=new fs(l,this.transform),this.on("data",g=>{"source"===g.dataType&&this.painter.setTileLoadedFlag(!0)}),p.exported$1.testSupport(l)):this.fire(new p.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(v){v.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new p.Event("webglcontextlost",{originalEvent:v}))}_contextRestored(v){this._setupPainter(),this.resize(),this._update(),this.fire(new p.Event("webglcontextrestored",{originalEvent:v}))}_onMapScroll(v){if(v.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(v){return this.style?(this._styleDirty=this._styleDirty||v,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(v){return this._update(),this._renderTaskQueue.add(v)}_cancelRenderFrame(v){this._renderTaskQueue.remove(v)}_requestDomTask(v){!this.loaded()||this.loaded()&&!this.isMoving()?v():this._domRenderTaskQueue.add(v)}_render(v){let l;const g=this.painter.context.extTimerQuery,b=p.exported.now();if(this.listens("gpu-timing-frame")&&(l=g.createQueryEXT(),g.beginQueryEXT(g.TIME_ELAPSED_EXT,l)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],p.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],p.window.performance.now())),this._renderTaskQueue.run(v),this._domRenderTaskQueue.run(v),this._removed)return;this._updateProjectionTransition();let I=!1;const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const U=this.transform.zoom,$=this.transform.pitch,q=p.exported.now();this.style.zoomHistory.update(U,q);const Z=new p.EvaluationParameters(U,{now:q,fadeDuration:M,pitch:$,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ge=Z.crossFadingFactor();1===ge&&ge===this._crossFadingFactor||(I=!0,this._crossFadingFactor=ge),this.style.update(Z)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let O=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),O=this._updateAverageElevation(b),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):O=this._updateAverageElevation(b),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new p.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new p.Event("load"))),this.style&&(this.style.hasTransitions()||I)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),l){const U=p.exported.now()-b;g.endQueryEXT(g.TIME_ELAPSED_EXT,l),setTimeout(()=>{const $=g.getQueryObjectEXT(l,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(l),this.fire(new p.Event("gpu-timing-frame",{cpuTime:U,gpuTime:$})),p.window.performance.mark("frame-gpu",{startTime:b,detail:{gpuTime:$}})},50)}if(this.listens("gpu-timing-layer")){const U=this.painter.collectGpuTimers();setTimeout(()=>{const $=this.painter.queryGpuTimers(U);this.fire(new p.Event("gpu-timing-layer",{layerTimes:$}))},50)}if(this.listens("gpu-timing-deferred-render")){const U=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const $=this.painter.queryGpuTimeDeferredRender(U);this.fire(new p.Event("gpu-timing-deferred-render",{gpuTime:$}))},50)}const B=this._sourcesDirty||this._styleDirty||this._placementDirty||O;if(B||this._repaint)this.triggerRepaint();else{const U=!this.isMoving()&&this.loaded();if(U&&(O=this._updateAverageElevation(b,!0)),O)this.triggerRepaint();else if(this._triggerFrame(!1),U&&(this.fire(new p.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const $=this._calculateSpeedIndex();this.fire(new p.Event("speedindexcompleted",{speedIndex:$})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||B||(this._fullyLoaded=!0,p.LivePerformanceUtils.mark(p.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&p.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.painter.transform.projection,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(v){for(const l of this._markers)v&&!this.getRenderWorldCopies()&&(l._lngLat=l._lngLat.wrap()),l._update();for(const l of this._popups)!v||this.getRenderWorldCopies()||l._trackPointer||(l._lngLat=l._lngLat.wrap()),l._update()}_updateAverageElevation(v,l=!1){const g=b=>(this.transform.averageElevation=b,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&g(0);if((l||v-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(v)){const b=this.transform.averageElevation;let I=this.transform.sampleAverageElevation(),M=!1;this.transform.elevation&&(M=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(I)?I=0:this._averageElevationLastSampledAt=v;const O=Math.abs(b-I);if(O>1){if(this._isInitialLoad||M)return this._averageElevation.jumpTo(I),g(I);this._averageElevation.easeTo(I,v,300)}else if(O>1e-4)return this._averageElevation.jumpTo(I),g(I)}return!!this._averageElevation.isEasing(v)&&g(this._averageElevation.getValue(v))}_authenticate(){p.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,v=>{if(v&&(v.message===p.AUTH_ERR_MSG||401===v.status)){const l=this.painter.context.gl;p.storeAuthState(l,!1),this._logoControl instanceof Va&&this._logoControl._updateLogo(),l&&l.clear(l.DEPTH_BUFFER_BIT|l.COLOR_BUFFER_BIT|l.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new p.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),p.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const v=this.painter.canvasCopy(),l=this.painter.getCanvasCopiesAndTimestamps();l.timeStamps.push(performance.now());const g=this.painter.context.gl,b=g.createFramebuffer();function I(M){g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,M,0);const O=new Uint8Array(g.drawingBufferWidth*g.drawingBufferHeight*4);return g.readPixels(0,0,g.drawingBufferWidth,g.drawingBufferHeight,g.RGBA,g.UNSIGNED_BYTE,O),O}return g.bindFramebuffer(g.FRAMEBUFFER,b),this._canvasPixelComparison(I(v),l.canvasCopies.map(I),l.timeStamps)}_canvasPixelComparison(v,l,g){let b=g[1]-g[0];const I=v.length/4;for(let M=0;M<l.length;M++){const O=l[M];let B=0;for(let U=0;U<O.length;U+=4)O[U]===v[U]&&O[U+1]===v[U+1]&&O[U+2]===v[U+2]&&O[U+3]===v[U+3]&&(B+=1);b+=(g[M+2]-g[M+1])*(1-B/I)}return b}remove(){this._hash&&this._hash.remove();for(const l of this._controls)l.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==p.window&&(p.window.removeEventListener("resize",this._onWindowResize,!1),p.window.removeEventListener("orientationchange",this._onWindowResize,!1),p.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),p.window.removeEventListener("online",this._onWindowOnline,!1),p.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const v=this.painter.context.gl.getExtension("WEBGL_lose_context");v&&v.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),Df(this._canvasContainer),Df(this._controlContainer),Df(this._missingCSSCanary),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),p.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new p.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(v){this._renderNextFrame=this._renderNextFrame||v,this.style&&!this._frame&&(this._frame=p.exported.frame(l=>{const g=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,g&&this._render(l)}))}_preloadTiles(v){const l=this.style?Object.values(this.style._sourceCaches):[];return p.asyncAll(l,(g,b)=>g._preloadTiles(v,b),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(v){this._trackResize&&this.resize({originalEvent:v})._update()}_onVisibilityChange(){"hidden"===p.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(v){this._showTileBoundaries!==v&&(this._showTileBoundaries=v,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(v){this._showTerrainWireframe!==v&&(this._showTerrainWireframe=v,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(v){this._speedIndexTiming!==v&&(this._speedIndexTiming=v,this._update())}get showPadding(){return!!this._showPadding}set showPadding(v){this._showPadding!==v&&(this._showPadding=v,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(v){this._showCollisionBoxes!==v&&(this._showCollisionBoxes=v,v?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(v){this._showOverdrawInspector!==v&&(this._showOverdrawInspector=v,this._update())}get repaint(){return!!this._repaint}set repaint(v){this._repaint!==v&&(this._repaint=v,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(v){this._vertices=v,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(v){this._showTileAABBs!==v&&(this._showTileAABBs=v,v&&this._update())}_setCacheLimits(v,l){p.setCacheLimits(v,l)}get version(){return p.version}},NavigationControl:class{constructor(v){this.options=p.extend({},Hp,v),this._container=Ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",l=>l.preventDefault()),this.options.showZoom&&(p.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",l=>{this._map&&this._map.zoomIn({},{originalEvent:l})}),Ct("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",l=>{this._map&&this._map.zoomOut({},{originalEvent:l})}),Ct("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(p.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",l=>{const g=this._map;g&&(this.options.visualizePitch?g.resetNorthPitch({},{originalEvent:l}):g.resetNorth({},{originalEvent:l}))}),this._compassIcon=Ct("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const v=this._map;if(!v)return;const l=v.getZoom(),g=l===v.getMaxZoom(),b=l===v.getMinZoom();this._zoomInButton.disabled=g,this._zoomOutButton.disabled=b,this._zoomInButton.setAttribute("aria-disabled",g.toString()),this._zoomOutButton.setAttribute("aria-disabled",b.toString())}_rotateCompassArrow(){const v=this._map;if(!v)return;const l=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(v.transform.pitch*(Math.PI/180)),.5)}) rotateX(${v.transform.pitch}deg) rotateZ(${v.transform.angle*(180/Math.PI)}deg)`:`rotate(${v.transform.angle*(180/Math.PI)}deg)`;v._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=l)})}onAdd(v){return this._map=v,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),v.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&v.on("pitch",this._rotateCompassArrow),v.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xp(v,this._compass,this.options.visualizePitch)),this._container}onRemove(){const v=this._map;v&&(this._container.remove(),this.options.showZoom&&v.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&v.off("pitch",this._rotateCompassArrow),v.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(v,l){const g=Ct("button",v,this._container);return g.type="button",g.addEventListener("click",l),g}_setButtonTitle(v,l){if(!this._map)return;const g=this._map._getUIString(`NavigationControl.${l}`);v.setAttribute("aria-label",g),v.firstElementChild&&v.firstElementChild.setAttribute("title",g)}},GeolocateControl:class extends p.Evented{constructor(v){super(),this.options=p.extend({geolocation:p.window.navigator.geolocation},cd,v),p.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Xl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(v){return this._map=v,this._container=Ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(v){const l=(g=!!this.options.geolocation)=>{this._supportsGeolocation=g,v(g)};void 0!==this._supportsGeolocation?v(this._supportsGeolocation):void 0!==p.window.navigator.permissions?p.window.navigator.permissions.query({name:"geolocation"}).then(g=>l("denied"!==g.state)).catch(()=>l()):l()}_isOutOfMapMaxBounds(v){const l=this._map.getMaxBounds(),g=v.coords;return!!l&&(g.longitude<l.getWest()||g.longitude>l.getEast()||g.latitude<l.getSouth()||g.latitude>l.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(v){if(this._map){if(this._isOutOfMapMaxBounds(v))return this._setErrorState(),this.fire(new p.Event("outofmaxbounds",v)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=v,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(v),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(v),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("geolocate",v)),this._finish()}}_updateCamera(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude),g=v.coords.accuracy,b=this._map.getBearing(),I=p.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(l.toBounds(g),I,{geolocateSource:!0})}_updateMarker(v){if(v){const l=new p.LngLat(v.coords.longitude,v.coords.latitude);this._accuracyCircleMarker.setLngLat(l).addTo(this._map),this._userLocationDotMarker.setLngLat(l).addTo(this._map),this._accuracy=v.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const v=this._map.transform,l=p.mercatorZfromAltitude(1,v._center.lat)*v.worldSize,g=Math.ceil(2*this._accuracy*l);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(v){if(this._map){if(this.options.trackUserLocation)if(1===v.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===v.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new p.Event("error",v)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(v){if(this._container.addEventListener("contextmenu",l=>l.preventDefault()),this._geolocateButton=Ct("button","mapboxgl-ctrl-geolocate",this._container),Ct("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===v){p.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const l=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}else{const l=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",l),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",l)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Ct("div","mapboxgl-user-location"),this._dotElement.appendChild(Ct("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Ct("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Tf({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Ct("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Tf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",l=>{l.geolocateSource||"ACTIVE_LOCK"!==this._watchState||l.originalEvent&&"resize"===l.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new p.Event("trackuserlocationend")))})}_onDeviceOrientation(v){this._userLocationDotMarker&&(v.webkitCompassHeading?this._heading=v.webkitCompassHeading:!0===v.absolute&&(this._heading=-1*v.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return p.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new p.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new p.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new p.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let v;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(v={maximumAge:6e5,timeout:0},this._noTimeout=!0):(v=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,v),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const v=()=>{p.window.addEventListener("ondeviceorientationabsolute"in p.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==p.window.DeviceMotionEvent&&"function"==typeof p.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(l=>{"granted"===l&&v()}).catch(console.error):v()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),p.window.removeEventListener("deviceorientation",this._onDeviceOrientation),p.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Ss,ScaleControl:class{constructor(v){this.options=p.extend({},Mf,v),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=ep.bind(this)),p.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const v=this.options.maxWidth||100,l=this._map,g=l._containerHeight/2,b=l._containerWidth/2-v/2,I=l.unproject([b,g]),M=l.unproject([b+v,g]),O=I.distanceTo(M);if("imperial"===this.options.unit){const B=3.2808*O;B>5280?this._setScale(v,B/5280,"mile"):this._setScale(v,B,"foot")}else"nautical"===this.options.unit?this._setScale(v,O/1852,"nautical-mile"):O>=1e3?this._setScale(v,O/1e3,"kilometer"):this._setScale(v,O,"meter")}_setScale(v,l,g){const b=Hh(l),I=b/l;this._map._requestDomTask(()=>{this._container.style.width=v*I+"px",this._container.innerHTML="nautical-mile"!==g?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:g}).format(b):`${b}&nbsp;nm`})}onAdd(v){return this._map=v,this._language=v.getLanguage(),this._container=Ct("div","mapboxgl-ctrl mapboxgl-ctrl-scale",v.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(v){this._language=v,this._update()}setUnit(v){this.options.unit=v,this._update()}},FullscreenControl:class{constructor(v){this._fullscreen=!1,v&&v.container&&(v.container instanceof p.window.HTMLElement?this._container=v.container:p.warnOnce("Full screen control 'container' must be a DOM element.")),p.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in p.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in p.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(v){return this._map=v,this._container||(this._container=this._map.getContainer()),this._controlContainer=Ct("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",p.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,p.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!p.window.document.fullscreenEnabled&&!p.window.document.webkitFullscreenEnabled)}_setupUI(){const v=this._fullscreenButton=Ct("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Ct("span","mapboxgl-ctrl-icon",v).setAttribute("aria-hidden","true"),v.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),p.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const v=this._getTitle();this._fullscreenButton.setAttribute("aria-label",v),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",v)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(p.window.document.fullscreenElement||p.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?p.window.document.exitFullscreen?p.window.document.exitFullscreen():p.window.document.webkitCancelFullScreen&&p.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends p.Evented{constructor(v){super(),this.options=p.extend(Object.create(Ja),v),p.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(v&&v.className?v.className.trim().split(/\s+/):[])}addTo(v){return this._map&&this.remove(),this._map=v,this.options.closeOnClick&&v.on("preclick",this._onClose),this.options.closeOnMove&&v.on("move",this._onClose),v.on("remove",this.remove),this._update(),v._addPopup(this),this._focusFirstElement(),this._trackPointer?(v.on("mousemove",this._onMouseEvent),v.on("mouseup",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")):v.on("move",this._update),this.fire(new p.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const v=this._map;return v&&(v.off("move",this._update),v.off("move",this._onClose),v.off("preclick",this._onClose),v.off("click",this._onClose),v.off("remove",this.remove),v.off("mousemove",this._onMouseEvent),v.off("mouseup",this._onMouseEvent),v.off("drag",this._onMouseEvent),v._canvasContainer&&v._canvasContainer.classList.remove("mapboxgl-track-pointer"),v._removePopup(this),this._map=void 0),this.fire(new p.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(v){this._lngLat=p.LngLat.convert(v),this._pos=null,this._trackPointer=!1,this._update();const l=this._map;return l&&(l.on("move",this._update),l.off("mousemove",this._onMouseEvent),l._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const v=this._map;return v&&(v.off("move",this._update),v.on("mousemove",this._onMouseEvent),v.on("drag",this._onMouseEvent),v._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(v){return this.setDOMContent(p.window.document.createTextNode(v))}setHTML(v){const l=p.window.document.createDocumentFragment(),g=p.window.document.createElement("body");let b;for(g.innerHTML=v;b=g.firstChild,b;)l.appendChild(b);return this.setDOMContent(l)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(v){return this.options.maxWidth=v,this._update(),this}setDOMContent(v){let l=this._content;if(l)for(;l.hasChildNodes();)l.firstChild&&l.removeChild(l.firstChild);else l=this._content=Ct("div","mapboxgl-popup-content",this._container||void 0);if(l.appendChild(v),this.options.closeButton){const g=this._closeButton=Ct("button","mapboxgl-popup-close-button",l);g.type="button",g.setAttribute("aria-label","Close popup"),g.setAttribute("aria-hidden","true"),g.innerHTML="&#215;",g.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(v){return this._classList.add(v),this._updateClassList(),this}removeClassName(v){return this._classList.delete(v),this._updateClassList(),this}setOffset(v){return this.options.offset=v,this._update(),this}toggleClassName(v){let l;return this._classList.delete(v)?l=!1:(this._classList.add(v),l=!0),this._updateClassList(),l}_onMouseEvent(v){this._update(v.point)}_getAnchor(v){if(this.options.anchor)return this.options.anchor;const l=this._map,g=this._container,b=this._pos;if(!l||!g||!b)return"bottom";const I=g.offsetWidth,M=g.offsetHeight,O=b.x<I/2,B=b.x>l.transform.width-I/2;if(b.y+v<M)return O?"top-left":B?"top-right":"top";if(b.y>l.transform.height-M){if(O)return"bottom-left";if(B)return"bottom-right"}return O?"left":B?"right":"bottom"}_updateClassList(){const v=this._container;if(!v)return;const l=[...this._classList];l.push("mapboxgl-popup"),this._anchor&&l.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&l.push("mapboxgl-popup-track-pointer"),v.className=l.join(" ")}_update(v){const l=this._map,g=this._content;if(!l||!this._lngLat&&!this._trackPointer||!g)return;let b=this._container;if(b||(b=this._container=Ct("div","mapboxgl-popup",l.getContainer()),this._tip=Ct("div","mapboxgl-popup-tip",b),b.appendChild(g)),this.options.maxWidth&&b.style.maxWidth!==this.options.maxWidth&&(b.style.maxWidth=this.options.maxWidth),l.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=If(this._lngLat,this._pos,l.transform)),!this._trackPointer||v){const I=this._pos=this._trackPointer&&v?v:l.project(this._lngLat),M=ld(this.options.offset),O=this._anchor=this._getAnchor(M.y),B=ld(this.options.offset,O),U=I.add(B).round();l._requestDomTask(()=>{this._container&&O&&(this._container.style.transform=`${Jd[O]} translate(${U.x}px,${U.y}px)`)})}if(!this._marker&&l._showingGlobe()){const I=p.isLngLatBehindGlobe(l.transform,this._lngLat)?0:1;this._setOpacity(I)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const v=this._container.querySelector(Kl);v&&v.focus()}_onClose(){this.remove()}_setOpacity(v){this._container&&(this._container.style.opacity=`${v}`),this._content&&(this._content.style.pointerEvents=v?"auto":"none")}},Marker:Tf,Style:da,LngLat:p.LngLat,LngLatBounds:p.LngLatBounds,Point:p.pointGeometry,MercatorCoordinate:p.MercatorCoordinate,FreeCameraOptions:ju,Evented:p.Evented,config:p.config,prewarm:function(){or().acquire(zn)},clearPrewarmedResources:function(){const v=Fn;v&&(v.isPreloaded()&&1===v.numActive()?(v.release(zn),Fn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return p.config.ACCESS_TOKEN},set accessToken(v){p.config.ACCESS_TOKEN=v},get baseApiUrl(){return p.config.API_URL},set baseApiUrl(v){p.config.API_URL=v},get workerCount(){return $n.workerCount},set workerCount(v){$n.workerCount=v},get maxParallelImageRequests(){return p.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(v){p.config.MAX_PARALLEL_IMAGE_REQUESTS=v},clearStorage(v){p.clearTileCache(v)},workerUrl:"",workerClass:null,setNow:p.exported.setNow,restoreNow:p.exported.restoreNow};return Af}),Ee}()},5943:an=>{"use strict";var vt=Object.getOwnPropertySymbols,je=Object.prototype.hasOwnProperty,Ee=Object.prototype.propertyIsEnumerable;function Fe(p){if(null==p)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(p)}an.exports=function lt(){try{if(!Object.assign)return!1;var p=new String("abc");if(p[5]="de","5"===Object.getOwnPropertyNames(p)[0])return!1;for(var ve={},$e=0;$e<10;$e++)ve["_"+String.fromCharCode($e)]=$e;if("0123456789"!==Object.getOwnPropertyNames(ve).map(function(Ct){return ve[Ct]}).join(""))return!1;var ft={};return"abcdefghijklmnopqrst".split("").forEach(function(Ct){ft[Ct]=Ct}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},ft)).join("")}catch{return!1}}()?Object.assign:function(p,ve){for(var $e,ft,ut=Fe(p),Ct=1;Ct<arguments.length;Ct++){for(var Yt in $e=Object(arguments[Ct]))je.call($e,Yt)&&(ut[Yt]=$e[Yt]);if(vt){ft=vt($e);for(var Ot=0;Ot<ft.length;Ot++)Ee.call($e,ft[Ot])&&(ut[ft[Ot]]=$e[ft[Ot]])}}return ut}},1175:an=>{"use strict";var vt=function(je){return je!=je};an.exports=function(Ee,Fe){return 0===Ee&&0===Fe?1/Ee==1/Fe:!!(Ee===Fe||vt(Ee)&&vt(Fe))}},2e3:(an,vt,je)=>{"use strict";var Ee=je(2358),Fe=je(5685),lt=je(1175),p=je(6305),ve=je(3859),$e=Fe(p(),Object);Ee($e,{getPolyfill:p,implementation:lt,shim:ve}),an.exports=$e},6305:(an,vt,je)=>{"use strict";var Ee=je(1175);an.exports=function(){return"function"==typeof Object.is?Object.is:Ee}},3859:(an,vt,je)=>{"use strict";var Ee=je(6305),Fe=je(2358);an.exports=function(){var p=Ee();return Fe(Object,{is:p},{is:function(){return Object.is!==p}}),p}},2450:(an,vt,je)=>{"use strict";var Ee;if(!Object.keys){var Fe=Object.prototype.hasOwnProperty,lt=Object.prototype.toString,p=je(9978),ve=Object.prototype.propertyIsEnumerable,$e=!ve.call({toString:null},"toString"),ut=ve.call(function(){},"prototype"),ft=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Ct=function(Ut){var pn=Ut.constructor;return pn&&pn.prototype===Ut},Yt={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},Ot=function(){if(typeof window>"u")return!1;for(var Ut in window)try{if(!Yt["$"+Ut]&&Fe.call(window,Ut)&&null!==window[Ut]&&"object"==typeof window[Ut])try{Ct(window[Ut])}catch{return!0}}catch{return!0}return!1}();Ee=function(pn){var he=null!==pn&&"object"==typeof pn,Ie="[object Function]"===lt.call(pn),le=p(pn),Y=he&&"[object String]"===lt.call(pn),ce=[];if(!he&&!Ie&&!le)throw new TypeError("Object.keys called on a non-object");var ke=ut&&Ie;if(Y&&pn.length>0&&!Fe.call(pn,0))for(var de=0;de<pn.length;++de)ce.push(String(de));if(le&&pn.length>0)for(var se=0;se<pn.length;++se)ce.push(String(se));else for(var we in pn)(!ke||"prototype"!==we)&&Fe.call(pn,we)&&ce.push(String(we));if($e)for(var J=function(Ut){if(typeof window>"u"||!Ot)return Ct(Ut);try{return Ct(Ut)}catch{return!1}}(pn),pt=0;pt<ft.length;++pt)(!J||"constructor"!==ft[pt])&&Fe.call(pn,ft[pt])&&ce.push(ft[pt]);return ce}}an.exports=Ee},1356:(an,vt,je)=>{"use strict";var Ee=Array.prototype.slice,Fe=je(9978),lt=Object.keys,p=lt?function(ut){return lt(ut)}:je(2450),ve=Object.keys;p.shim=function(){if(Object.keys){var ut=function(){var ft=Object.keys(arguments);return ft&&ft.length===arguments.length}(1,2);ut||(Object.keys=function(Ct){return Fe(Ct)?ve(Ee.call(Ct)):ve(Ct)})}else Object.keys=p;return Object.keys||p},an.exports=p},9978:an=>{"use strict";var vt=Object.prototype.toString;an.exports=function(Ee){var Fe=vt.call(Ee),lt="[object Arguments]"===Fe;return lt||(lt="[object Array]"!==Fe&&null!==Ee&&"object"==typeof Ee&&"number"==typeof Ee.length&&Ee.length>=0&&"[object Function]"===vt.call(Ee.callee)),lt}},1766:an=>{an.exports=function(je,Ee,Fe,lt){var p=je[0],ve=je[1],$e=!1;void 0===Fe&&(Fe=0),void 0===lt&&(lt=Ee.length);for(var ut=(lt-Fe)/2,ft=0,Ct=ut-1;ft<ut;Ct=ft++){var Yt=Ee[Fe+2*ft+0],Ot=Ee[Fe+2*ft+1],Ut=Ee[Fe+2*Ct+1];Ot>ve!=Ut>ve&&p<(Ee[Fe+2*Ct+0]-Yt)*(ve-Ot)/(Ut-Ot)+Yt&&($e=!$e)}return $e}},3870:(an,vt,je)=>{var Ee=je(1766),Fe=je(2260);an.exports=function(p,ve,$e,ut){return ve.length>0&&Array.isArray(ve[0])?Fe(p,ve,$e,ut):Ee(p,ve,$e,ut)},an.exports.nested=Fe,an.exports.flat=Ee},2260:an=>{an.exports=function(je,Ee,Fe,lt){var p=je[0],ve=je[1],$e=!1;void 0===Fe&&(Fe=0),void 0===lt&&(lt=Ee.length);for(var ut=lt-Fe,ft=0,Ct=ut-1;ft<ut;Ct=ft++){var Yt=Ee[ft+Fe][0],Ot=Ee[ft+Fe][1],Ut=Ee[Ct+Fe][1];Ot>ve!=Ut>ve&&p<(Ee[Ct+Fe][0]-Yt)*(ve-Ot)/(Ut-Ot)+Yt&&($e=!$e)}return $e}},9855:function(an){an.exports=function(){"use strict";function vt(_t,ye){if(!(_t instanceof ye))throw new TypeError("Cannot call a class as a function")}function je(_t,ye){for(var fe=0;fe<ye.length;fe++){var ae=ye[fe];ae.enumerable=ae.enumerable||!1,ae.configurable=!0,"value"in ae&&(ae.writable=!0),Object.defineProperty(_t,ae.key,ae)}}function Ee(_t,ye,fe){return ye&&je(_t.prototype,ye),fe&&je(_t,fe),_t}var Fe=function _t(ye,fe){this.next=null,this.key=ye,this.data=fe,this.left=null,this.right=null};function lt(_t,ye){return _t>ye?1:_t<ye?-1:0}function p(_t,ye,fe){for(var ae=new Fe(null,null),ze=ae,ht=ae;;){var Bt=fe(_t,ye.key);if(Bt<0){if(null===ye.left)break;if(fe(_t,ye.left.key)<0&&(ye.left=(on=ye.left).right,on.right=ye,null===(ye=on).left))break;ht.left=ye,ht=ye,ye=ye.left}else{if(!(Bt>0))break;if(null===ye.right)break;var on;if(fe(_t,ye.right.key)>0&&(ye.right=(on=ye.right).left,on.left=ye,null===(ye=on).right))break;ze.right=ye,ze=ye,ye=ye.right}}return ze.right=ye.left,ht.left=ye.right,ye.left=ae.right,ye.right=ae.left,ye}function ve(_t,ye,fe,ae){var ze=new Fe(_t,ye);if(null===fe)return ze.left=ze.right=null,ze;var ht=ae(_t,(fe=p(_t,fe,ae)).key);return ht<0?(ze.left=fe.left,ze.right=fe,fe.left=null):ht>=0&&(ze.right=fe.right,ze.left=fe,fe.right=null),ze}function $e(_t,ye,fe){var ae=null,ze=null;if(ye){var ht=fe((ye=p(_t,ye,fe)).key,_t);0===ht?(ae=ye.left,ze=ye.right):ht<0?(ze=ye.right,ye.right=null,ae=ye):(ae=ye.left,ye.left=null,ze=ye)}return{left:ae,right:ze}}function ft(_t,ye,fe,ae,ze){if(_t){ae(ye+(fe?"\u2514\u2500\u2500 ":"\u251c\u2500\u2500 ")+ze(_t)+"\n");var ht=ye+(fe?"    ":"\u2502   ");_t.left&&ft(_t.left,ht,!1,ae,ze),_t.right&&ft(_t.right,ht,!0,ae,ze)}}var Ct=function(){function _t(ye){void 0===ye&&(ye=lt),this._root=null,this._size=0,this._comparator=ye}return _t.prototype.insert=function(ye,fe){return this._size++,this._root=ve(ye,fe,this._root,this._comparator)},_t.prototype.add=function(ye,fe){var ae=new Fe(ye,fe);null===this._root&&(ae.left=ae.right=null,this._size++,this._root=ae);var ze=this._comparator,ht=p(ye,this._root,ze),Bt=ze(ye,ht.key);return 0===Bt?this._root=ht:(Bt<0?(ae.left=ht.left,ae.right=ht,ht.left=null):Bt>0&&(ae.right=ht.right,ae.left=ht,ht.right=null),this._size++,this._root=ae),this._root},_t.prototype.remove=function(ye){this._root=this._remove(ye,this._root,this._comparator)},_t.prototype._remove=function(ye,fe,ae){var ze;return null===fe?null:0===ae(ye,(fe=p(ye,fe,ae)).key)?(null===fe.left?ze=fe.right:(ze=p(ye,fe.left,ae)).right=fe.right,this._size--,ze):fe},_t.prototype.pop=function(){var ye=this._root;if(ye){for(;ye.left;)ye=ye.left;return this._root=p(ye.key,this._root,this._comparator),this._root=this._remove(ye.key,this._root,this._comparator),{key:ye.key,data:ye.data}}return null},_t.prototype.findStatic=function(ye){for(var fe=this._root,ae=this._comparator;fe;){var ze=ae(ye,fe.key);if(0===ze)return fe;fe=ze<0?fe.left:fe.right}return null},_t.prototype.find=function(ye){return this._root&&(this._root=p(ye,this._root,this._comparator),0!==this._comparator(ye,this._root.key))?null:this._root},_t.prototype.contains=function(ye){for(var fe=this._root,ae=this._comparator;fe;){var ze=ae(ye,fe.key);if(0===ze)return!0;fe=ze<0?fe.left:fe.right}return!1},_t.prototype.forEach=function(ye,fe){for(var ae=this._root,ze=[],ht=!1;!ht;)null!==ae?(ze.push(ae),ae=ae.left):0!==ze.length?(ae=ze.pop(),ye.call(fe,ae),ae=ae.right):ht=!0;return this},_t.prototype.range=function(ye,fe,ae,ze){for(var ht=[],Bt=this._comparator,on=this._root;0!==ht.length||on;)if(on)ht.push(on),on=on.left;else{if(Bt((on=ht.pop()).key,fe)>0)break;if(Bt(on.key,ye)>=0&&ae.call(ze,on))return this;on=on.right}return this},_t.prototype.keys=function(){var ye=[];return this.forEach(function(fe){return ye.push(fe.key)}),ye},_t.prototype.values=function(){var ye=[];return this.forEach(function(fe){return ye.push(fe.data)}),ye},_t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},_t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},_t.prototype.minNode=function(ye){if(void 0===ye&&(ye=this._root),ye)for(;ye.left;)ye=ye.left;return ye},_t.prototype.maxNode=function(ye){if(void 0===ye&&(ye=this._root),ye)for(;ye.right;)ye=ye.right;return ye},_t.prototype.at=function(ye){for(var fe=this._root,ae=!1,ze=0,ht=[];!ae;)if(fe)ht.push(fe),fe=fe.left;else if(ht.length>0){if(fe=ht.pop(),ze===ye)return fe;ze++,fe=fe.right}else ae=!0;return null},_t.prototype.next=function(ye){var fe=this._root,ae=null;if(ye.right){for(ae=ye.right;ae.left;)ae=ae.left;return ae}for(var ze=this._comparator;fe;){var ht=ze(ye.key,fe.key);if(0===ht)break;ht<0?(ae=fe,fe=fe.left):fe=fe.right}return ae},_t.prototype.prev=function(ye){var fe=this._root,ae=null;if(null!==ye.left){for(ae=ye.left;ae.right;)ae=ae.right;return ae}for(var ze=this._comparator;fe;){var ht=ze(ye.key,fe.key);if(0===ht)break;ht<0?fe=fe.left:(ae=fe,fe=fe.right)}return ae},_t.prototype.clear=function(){return this._root=null,this._size=0,this},_t.prototype.toList=function(){return function xt(_t){for(var ye=_t,fe=[],ae=!1,ze=new Fe(null,null),ht=ze;!ae;)ye?(fe.push(ye),ye=ye.left):fe.length>0?ye=(ye=ht=ht.next=fe.pop()).right:ae=!0;return ht.next=null,ze.next}(this._root)},_t.prototype.load=function(ye,fe,ae){void 0===fe&&(fe=[]),void 0===ae&&(ae=!1);var ze=ye.length,ht=this._comparator;if(ae&&he(ye,fe,0,ze-1,ht),null===this._root)this._root=Yt(ye,fe,0,ze),this._size=ze;else{var Bt=function pn(_t,ye,fe){for(var ae=new Fe(null,null),ze=ae,ht=_t,Bt=ye;null!==ht&&null!==Bt;)fe(ht.key,Bt.key)<0?(ze.next=ht,ht=ht.next):(ze.next=Bt,Bt=Bt.next),ze=ze.next;return null!==ht?ze.next=ht:null!==Bt&&(ze.next=Bt),ae.next}(this.toList(),function Ot(_t,ye){for(var fe=new Fe(null,null),ae=fe,ze=0;ze<_t.length;ze++)ae=ae.next=new Fe(_t[ze],ye[ze]);return ae.next=null,fe.next}(ye,fe),ht);this._root=Ut({head:Bt},0,ze=this._size+ze)}return this},_t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(_t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(_t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),_t.prototype.toString=function(ye){void 0===ye&&(ye=function(ze){return String(ze.key)});var fe=[];return ft(this._root,"",!0,function(ae){return fe.push(ae)},ye),fe.join("")},_t.prototype.update=function(ye,fe,ae){var ze=this._comparator,ht=$e(ye,this._root,ze),Bt=ht.left,on=ht.right;ze(ye,fe)<0?on=ve(fe,ae,on,ze):Bt=ve(fe,ae,Bt,ze),this._root=function ut(_t,ye,fe){return null===ye?_t:(null===_t||((ye=p(_t.key,ye,fe)).left=_t),ye)}(Bt,on,ze)},_t.prototype.split=function(ye){return $e(ye,this._root,this._comparator)},_t}();function Yt(_t,ye,fe,ae){var ze=ae-fe;if(ze>0){var ht=fe+Math.floor(ze/2),sn=new Fe(_t[ht],ye[ht]);return sn.left=Yt(_t,ye,fe,ht),sn.right=Yt(_t,ye,ht+1,ae),sn}return null}function Ut(_t,ye,fe){var ae=fe-ye;if(ae>0){var ze=ye+Math.floor(ae/2),ht=Ut(_t,ye,ze),Bt=_t.head;return Bt.left=ht,_t.head=_t.head.next,Bt.right=Ut(_t,ze+1,fe),Bt}return null}function he(_t,ye,fe,ae,ze){if(!(fe>=ae)){for(var ht=_t[fe+ae>>1],Bt=fe-1,on=ae+1;;){do{Bt++}while(ze(_t[Bt],ht)<0);do{on--}while(ze(_t[on],ht)>0);if(Bt>=on)break;var sn=_t[Bt];_t[Bt]=_t[on],_t[on]=sn,sn=ye[Bt],ye[Bt]=ye[on],ye[on]=sn}he(_t,ye,fe,on,ze),he(_t,ye,on+1,ae,ze)}}var Ie=function(ye,fe){return ye.ll.x<=fe.x&&fe.x<=ye.ur.x&&ye.ll.y<=fe.y&&fe.y<=ye.ur.y},le=function(ye,fe){return fe.ur.x<ye.ll.x||ye.ur.x<fe.ll.x||fe.ur.y<ye.ll.y||ye.ur.y<fe.ll.y?null:{ll:{x:ye.ll.x<fe.ll.x?fe.ll.x:ye.ll.x,y:ye.ll.y<fe.ll.y?fe.ll.y:ye.ll.y},ur:{x:ye.ur.x<fe.ur.x?ye.ur.x:fe.ur.x,y:ye.ur.y<fe.ur.y?ye.ur.y:fe.ur.y}}},Y=Number.EPSILON;void 0===Y&&(Y=Math.pow(2,-52));var ce=Y*Y,ke=function(ye,fe){if(-Y<ye&&ye<Y&&-Y<fe&&fe<Y)return 0;var ae=ye-fe;return ae*ae<ce*ye*fe?0:ye<fe?-1:1},de=function(){function _t(){vt(this,_t),this.reset()}return Ee(_t,[{key:"reset",value:function(){this.xRounder=new se,this.yRounder=new se}},{key:"round",value:function(fe,ae){return{x:this.xRounder.round(fe),y:this.yRounder.round(ae)}}}]),_t}(),se=function(){function _t(){vt(this,_t),this.tree=new Ct,this.round(0)}return Ee(_t,[{key:"round",value:function(fe){var ae=this.tree.add(fe),ze=this.tree.prev(ae);if(null!==ze&&0===ke(ae.key,ze.key))return this.tree.remove(fe),ze.key;var ht=this.tree.next(ae);return null!==ht&&0===ke(ae.key,ht.key)?(this.tree.remove(fe),ht.key):fe}}]),_t}(),we=new de,J=function(ye,fe){return ye.x*fe.y-ye.y*fe.x},pt=function(ye,fe){return ye.x*fe.x+ye.y*fe.y},Ve=function(ye,fe,ae){var Bt=J({x:fe.x-ye.x,y:fe.y-ye.y},{x:ae.x-ye.x,y:ae.y-ye.y});return ke(Bt,0)},qe=function(ye){return Math.sqrt(pt(ye,ye))},ue=function(ye,fe,ae){var ze={x:fe.x-ye.x,y:fe.y-ye.y},ht={x:ae.x-ye.x,y:ae.y-ye.y};return J(ht,ze)/qe(ht)/qe(ze)},Zt=function(ye,fe,ae){var ze={x:fe.x-ye.x,y:fe.y-ye.y},ht={x:ae.x-ye.x,y:ae.y-ye.y};return pt(ht,ze)/qe(ht)/qe(ze)},At=function(ye,fe,ae){return 0===fe.y?null:{x:ye.x+fe.x/fe.y*(ae-ye.y),y:ae}},Pe=function(ye,fe,ae){return 0===fe.x?null:{x:ae,y:ye.y+fe.y/fe.x*(ae-ye.x)}},Me=function(){function _t(ye,fe){vt(this,_t),void 0===ye.events?ye.events=[this]:ye.events.push(this),this.point=ye,this.isLeft=fe}return Ee(_t,null,[{key:"compare",value:function(fe,ae){var ze=_t.comparePoints(fe.point,ae.point);return 0!==ze?ze:(fe.point!==ae.point&&fe.link(ae),fe.isLeft!==ae.isLeft?fe.isLeft?1:-1:dt.compare(fe.segment,ae.segment))}},{key:"comparePoints",value:function(fe,ae){return fe.x<ae.x?-1:fe.x>ae.x?1:fe.y<ae.y?-1:fe.y>ae.y?1:0}}]),Ee(_t,[{key:"link",value:function(fe){if(fe.point===this.point)throw new Error("Tried to link already linked events");for(var ae=fe.point.events,ze=0,ht=ae.length;ze<ht;ze++){var Bt=ae[ze];this.point.events.push(Bt),Bt.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var fe=this.point.events.length,ae=0;ae<fe;ae++){var ze=this.point.events[ae];if(void 0===ze.segment.consumedBy)for(var ht=ae+1;ht<fe;ht++){var Bt=this.point.events[ht];void 0===Bt.consumedBy&&ze.otherSE.point.events===Bt.otherSE.point.events&&ze.segment.consume(Bt.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var fe=[],ae=0,ze=this.point.events.length;ae<ze;ae++){var ht=this.point.events[ae];ht!==this&&!ht.segment.ringOut&&ht.segment.isInResult()&&fe.push(ht)}return fe}},{key:"getLeftmostComparator",value:function(fe){var ae=this,ze=new Map,ht=function(on){var sn=on.otherSE;ze.set(on,{sine:ue(ae.point,fe.point,sn.point),cosine:Zt(ae.point,fe.point,sn.point)})};return function(Bt,on){ze.has(Bt)||ht(Bt),ze.has(on)||ht(on);var sn=ze.get(Bt),Gt=sn.sine,ur=sn.cosine,lr=ze.get(on),En=lr.sine,Cr=lr.cosine;return Gt>=0&&En>=0?ur<Cr?1:ur>Cr?-1:0:Gt<0&&En<0?ur<Cr?-1:ur>Cr?1:0:En<Gt?-1:En>Gt?1:0}}}]),_t}(),tt=0,dt=function(){function _t(ye,fe,ae,ze){vt(this,_t),this.id=++tt,this.leftSE=ye,ye.segment=this,ye.otherSE=fe,this.rightSE=fe,fe.segment=this,fe.otherSE=ye,this.rings=ae,this.windings=ze}return Ee(_t,null,[{key:"compare",value:function(fe,ae){var ze=fe.leftSE.point.x,ht=ae.leftSE.point.x,Bt=fe.rightSE.point.x,on=ae.rightSE.point.x;if(on<ze)return 1;if(Bt<ht)return-1;var sn=fe.leftSE.point.y,Gt=ae.leftSE.point.y,ur=fe.rightSE.point.y,lr=ae.rightSE.point.y;if(ze<ht){if(Gt<sn&&Gt<ur)return 1;if(Gt>sn&&Gt>ur)return-1;var En=fe.comparePoint(ae.leftSE.point);if(En<0)return 1;if(En>0)return-1;var Cr=ae.comparePoint(fe.rightSE.point);return 0!==Cr?Cr:-1}if(ze>ht){if(sn<Gt&&sn<lr)return-1;if(sn>Gt&&sn>lr)return 1;var Ei=ae.comparePoint(fe.leftSE.point);if(0!==Ei)return Ei;var qr=fe.comparePoint(ae.rightSE.point);return qr<0?1:qr>0?-1:1}if(sn<Gt)return-1;if(sn>Gt)return 1;if(Bt<on){var ui=ae.comparePoint(fe.rightSE.point);if(0!==ui)return ui}if(Bt>on){var Do=fe.comparePoint(ae.rightSE.point);if(Do<0)return 1;if(Do>0)return-1}if(Bt!==on){var jo=ur-sn,es=Bt-ze,wo=lr-Gt,ds=on-ht;if(jo>es&&wo<ds)return 1;if(jo<es&&wo>ds)return-1}return Bt>on?1:Bt<on||ur<lr?-1:ur>lr?1:fe.id<ae.id?-1:fe.id>ae.id?1:0}}]),Ee(_t,[{key:"replaceRightSE",value:function(fe){this.rightSE=fe,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var fe=this.leftSE.point.y,ae=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:fe<ae?fe:ae},ur:{x:this.rightSE.point.x,y:fe>ae?fe:ae}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(fe){return fe.x===this.leftSE.point.x&&fe.y===this.leftSE.point.y||fe.x===this.rightSE.point.x&&fe.y===this.rightSE.point.y}},{key:"comparePoint",value:function(fe){if(this.isAnEndpoint(fe))return 0;var ae=this.leftSE.point,ze=this.rightSE.point,ht=this.vector();if(ae.x===ze.x)return fe.x===ae.x?0:fe.x<ae.x?1:-1;if(fe.x===ae.x+(fe.y-ae.y)/ht.y*ht.x)return 0;var Gt=ae.y+(fe.x-ae.x)/ht.x*ht.y;return fe.y===Gt?0:fe.y<Gt?-1:1}},{key:"getIntersection",value:function(fe){var ae=this.bbox(),ze=fe.bbox(),ht=le(ae,ze);if(null===ht)return null;var Bt=this.leftSE.point,on=this.rightSE.point,sn=fe.leftSE.point,Gt=fe.rightSE.point,ur=Ie(ae,sn)&&0===this.comparePoint(sn),lr=Ie(ze,Bt)&&0===fe.comparePoint(Bt),En=Ie(ae,Gt)&&0===this.comparePoint(Gt),Cr=Ie(ze,on)&&0===fe.comparePoint(on);if(lr&&ur)return Cr&&!En?on:!Cr&&En?Gt:null;if(lr)return En&&Bt.x===Gt.x&&Bt.y===Gt.y?null:Bt;if(ur)return Cr&&on.x===sn.x&&on.y===sn.y?null:sn;if(Cr&&En)return null;if(Cr)return on;if(En)return Gt;var Ei=function(ye,fe,ae,ze){if(0===fe.x)return Pe(ae,ze,ye.x);if(0===ze.x)return Pe(ye,fe,ae.x);if(0===fe.y)return At(ae,ze,ye.y);if(0===ze.y)return At(ye,fe,ae.y);var ht=J(fe,ze);if(0==ht)return null;var Bt={x:ae.x-ye.x,y:ae.y-ye.y},on=J(Bt,fe)/ht,sn=J(Bt,ze)/ht;return{x:(ye.x+sn*fe.x+(ae.x+on*ze.x))/2,y:(ye.y+sn*fe.y+(ae.y+on*ze.y))/2}}(Bt,this.vector(),sn,fe.vector());return null!==Ei&&Ie(ht,Ei)?we.round(Ei.x,Ei.y):null}},{key:"split",value:function(fe){var ae=[],ze=void 0!==fe.events,ht=new Me(fe,!0),Bt=new Me(fe,!1),on=this.rightSE;this.replaceRightSE(Bt),ae.push(Bt),ae.push(ht);var sn=new _t(ht,on,this.rings.slice(),this.windings.slice());return Me.comparePoints(sn.leftSE.point,sn.rightSE.point)>0&&sn.swapEvents(),Me.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),ze&&(ht.checkForConsuming(),Bt.checkForConsuming()),ae}},{key:"swapEvents",value:function(){var fe=this.rightSE;this.rightSE=this.leftSE,this.leftSE=fe,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var ae=0,ze=this.windings.length;ae<ze;ae++)this.windings[ae]*=-1}},{key:"consume",value:function(fe){for(var ae=this,ze=fe;ae.consumedBy;)ae=ae.consumedBy;for(;ze.consumedBy;)ze=ze.consumedBy;var ht=_t.compare(ae,ze);if(0!==ht){if(ht>0){var Bt=ae;ae=ze,ze=Bt}if(ae.prev===ze){var on=ae;ae=ze,ze=on}for(var sn=0,Gt=ze.rings.length;sn<Gt;sn++){var ur=ze.rings[sn],lr=ze.windings[sn],En=ae.rings.indexOf(ur);-1===En?(ae.rings.push(ur),ae.windings.push(lr)):ae.windings[En]+=lr}ze.rings=null,ze.windings=null,ze.consumedBy=ae,ze.leftSE.consumedBy=ae.leftSE,ze.rightSE.consumedBy=ae.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this._prevInResult=this.prev?this.prev.isInResult()?this.prev:this.prev.prevInResult():null),this._prevInResult}},{key:"beforeState",value:function(){return void 0!==this._beforeState||(this._beforeState=this.prev?(this.prev.consumedBy||this.prev).afterState():{rings:[],windings:[],multiPolys:[]}),this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var fe=this.beforeState();this._afterState={rings:fe.rings.slice(0),windings:fe.windings.slice(0),multiPolys:[]};for(var ae=this._afterState.rings,ze=this._afterState.windings,ht=this._afterState.multiPolys,Bt=0,on=this.rings.length;Bt<on;Bt++){var sn=this.rings[Bt],Gt=this.windings[Bt],ur=ae.indexOf(sn);-1===ur?(ae.push(sn),ze.push(Gt)):ze[ur]+=Gt}for(var lr=[],En=[],Cr=0,Ei=ae.length;Cr<Ei;Cr++)if(0!==ze[Cr]){var qr=ae[Cr],ui=qr.poly;if(-1===En.indexOf(ui))if(qr.isExterior)lr.push(ui);else{-1===En.indexOf(ui)&&En.push(ui);var Do=lr.indexOf(qr.poly);-1!==Do&&lr.splice(Do,1)}}for(var jo=0,es=lr.length;jo<es;jo++){var wo=lr[jo].multiPoly;-1===ht.indexOf(wo)&&ht.push(wo)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var fe=this.beforeState().multiPolys,ae=this.afterState().multiPolys;switch(hn.type){case"union":this._isInResult=0===fe.length!=(0===ae.length);break;case"intersection":var Bt,on;fe.length<ae.length?(Bt=fe.length,on=ae.length):(Bt=ae.length,on=fe.length),this._isInResult=on===hn.numMultiPolys&&Bt<on;break;case"xor":var sn=Math.abs(fe.length-ae.length);this._isInResult=sn%2==1;break;case"difference":var Gt=function(lr){return 1===lr.length&&lr[0].isSubject};this._isInResult=Gt(fe)!==Gt(ae);break;default:throw new Error("Unrecognized operation type found ".concat(hn.type))}return this._isInResult}}],[{key:"fromRing",value:function(fe,ae,ze){var ht,Bt,on,sn=Me.comparePoints(fe,ae);if(sn<0)ht=fe,Bt=ae,on=1;else{if(!(sn>0))throw new Error("Tried to create degenerate segment at [".concat(fe.x,", ").concat(fe.y,"]"));ht=ae,Bt=fe,on=-1}return new _t(new Me(ht,!0),new Me(Bt,!1),[ze],[on])}}]),_t}(),Ae=function(){function _t(ye,fe,ae){if(vt(this,_t),!Array.isArray(ye)||0===ye.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=fe,this.isExterior=ae,this.segments=[],"number"!=typeof ye[0][0]||"number"!=typeof ye[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var ze=we.round(ye[0][0],ye[0][1]);this.bbox={ll:{x:ze.x,y:ze.y},ur:{x:ze.x,y:ze.y}};for(var ht=ze,Bt=1,on=ye.length;Bt<on;Bt++){if("number"!=typeof ye[Bt][0]||"number"!=typeof ye[Bt][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var sn=we.round(ye[Bt][0],ye[Bt][1]);sn.x===ht.x&&sn.y===ht.y||(this.segments.push(dt.fromRing(ht,sn,this)),sn.x<this.bbox.ll.x&&(this.bbox.ll.x=sn.x),sn.y<this.bbox.ll.y&&(this.bbox.ll.y=sn.y),sn.x>this.bbox.ur.x&&(this.bbox.ur.x=sn.x),sn.y>this.bbox.ur.y&&(this.bbox.ur.y=sn.y),ht=sn)}(ze.x!==ht.x||ze.y!==ht.y)&&this.segments.push(dt.fromRing(ht,ze,this))}return Ee(_t,[{key:"getSweepEvents",value:function(){for(var fe=[],ae=0,ze=this.segments.length;ae<ze;ae++){var ht=this.segments[ae];fe.push(ht.leftSE),fe.push(ht.rightSE)}return fe}}]),_t}(),Vt=function(){function _t(ye,fe){if(vt(this,_t),!Array.isArray(ye))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Ae(ye[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var ae=1,ze=ye.length;ae<ze;ae++){var ht=new Ae(ye[ae],this,!1);ht.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ht.bbox.ll.x),ht.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ht.bbox.ll.y),ht.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ht.bbox.ur.x),ht.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ht.bbox.ur.y),this.interiorRings.push(ht)}this.multiPoly=fe}return Ee(_t,[{key:"getSweepEvents",value:function(){for(var fe=this.exteriorRing.getSweepEvents(),ae=0,ze=this.interiorRings.length;ae<ze;ae++)for(var ht=this.interiorRings[ae].getSweepEvents(),Bt=0,on=ht.length;Bt<on;Bt++)fe.push(ht[Bt]);return fe}}]),_t}(),Nt=function(){function _t(ye,fe){if(vt(this,_t),!Array.isArray(ye))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof ye[0][0][0]&&(ye=[ye])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var ae=0,ze=ye.length;ae<ze;ae++){var ht=new Vt(ye[ae],this);ht.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ht.bbox.ll.x),ht.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ht.bbox.ll.y),ht.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ht.bbox.ur.x),ht.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ht.bbox.ur.y),this.polys.push(ht)}this.isSubject=fe}return Ee(_t,[{key:"getSweepEvents",value:function(){for(var fe=[],ae=0,ze=this.polys.length;ae<ze;ae++)for(var ht=this.polys[ae].getSweepEvents(),Bt=0,on=ht.length;Bt<on;Bt++)fe.push(ht[Bt]);return fe}}]),_t}(),fn=function(){function _t(ye){vt(this,_t),this.events=ye;for(var fe=0,ae=ye.length;fe<ae;fe++)ye[fe].segment.ringOut=this;this.poly=null}return Ee(_t,null,[{key:"factory",value:function(fe){for(var ae=[],ze=0,ht=fe.length;ze<ht;ze++){var Bt=fe[ze];if(Bt.isInResult()&&!Bt.ringOut){for(var on=null,sn=Bt.leftSE,Gt=Bt.rightSE,ur=[sn],lr=sn.point,En=[];on=sn,ur.push(sn=Gt),sn.point!==lr;)for(;;){var Cr=sn.getAvailableLinkedEvents();if(0===Cr.length){var Ei=ur[0].point,qr=ur[ur.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Ei.x,",")+" ".concat(Ei.y,"]. Last matching segment found ends at")+" [".concat(qr.x,", ").concat(qr.y,"]."))}if(1===Cr.length){Gt=Cr[0].otherSE;break}for(var ui=null,Do=0,jo=En.length;Do<jo;Do++)if(En[Do].point===sn.point){ui=Do;break}if(null===ui){En.push({index:ur.length,point:sn.point});var ds=sn.getLeftmostComparator(on);Gt=Cr.sort(ds)[0].otherSE;break}var es=En.splice(ui)[0],wo=ur.splice(es.index);wo.unshift(wo[0].otherSE),ae.push(new _t(wo.reverse()))}ae.push(new _t(ur))}}return ae}}]),Ee(_t,[{key:"getGeom",value:function(){for(var fe=this.events[0].point,ae=[fe],ze=1,ht=this.events.length-1;ze<ht;ze++){var Bt=this.events[ze].point;0!==Ve(Bt,fe,this.events[ze+1].point)&&(ae.push(Bt),fe=Bt)}if(1===ae.length)return null;0===Ve(ae[0],fe,ae[1])&&ae.shift(),ae.push(ae[0]);for(var ur=this.isExteriorRing()?1:-1,lr=this.isExteriorRing()?0:ae.length-1,En=this.isExteriorRing()?ae.length:-1,Cr=[],Ei=lr;Ei!=En;Ei+=ur)Cr.push([ae[Ei].x,ae[Ei].y]);return Cr}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var fe=this.enclosingRing();this._isExteriorRing=!fe||!fe.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var fe=this.events[0],ae=1,ze=this.events.length;ae<ze;ae++){var ht=this.events[ae];Me.compare(fe,ht)>0&&(fe=ht)}for(var Bt=fe.segment.prevInResult(),on=Bt?Bt.prevInResult():null;;){if(!Bt)return null;if(!on)return Bt.ringOut;if(on.ringOut!==Bt.ringOut)return on.ringOut.enclosingRing()!==Bt.ringOut?Bt.ringOut:Bt.ringOut.enclosingRing();Bt=on.prevInResult(),on=Bt?Bt.prevInResult():null}}}]),_t}(),Lt=function(){function _t(ye){vt(this,_t),this.exteriorRing=ye,ye.poly=this,this.interiorRings=[]}return Ee(_t,[{key:"addInterior",value:function(fe){this.interiorRings.push(fe),fe.poly=this}},{key:"getGeom",value:function(){var fe=[this.exteriorRing.getGeom()];if(null===fe[0])return null;for(var ae=0,ze=this.interiorRings.length;ae<ze;ae++){var ht=this.interiorRings[ae].getGeom();null!==ht&&fe.push(ht)}return fe}}]),_t}(),Mn=function(){function _t(ye){vt(this,_t),this.rings=ye,this.polys=this._composePolys(ye)}return Ee(_t,[{key:"getGeom",value:function(){for(var fe=[],ae=0,ze=this.polys.length;ae<ze;ae++){var ht=this.polys[ae].getGeom();null!==ht&&fe.push(ht)}return fe}},{key:"_composePolys",value:function(fe){for(var ae=[],ze=0,ht=fe.length;ze<ht;ze++){var Bt=fe[ze];if(!Bt.poly)if(Bt.isExteriorRing())ae.push(new Lt(Bt));else{var on=Bt.enclosingRing();on.poly||ae.push(new Lt(on)),on.poly.addInterior(Bt)}}return ae}}]),_t}(),Rn=function(){function _t(ye){var fe=arguments.length>1&&void 0!==arguments[1]?arguments[1]:dt.compare;vt(this,_t),this.queue=ye,this.tree=new Ct(fe),this.segments=[]}return Ee(_t,[{key:"process",value:function(fe){var ae=fe.segment,ze=[];if(fe.consumedBy)return fe.isLeft?this.queue.remove(fe.otherSE):this.tree.remove(ae),ze;var ht=fe.isLeft?this.tree.insert(ae):this.tree.find(ae);if(!ht)throw new Error("Unable to find segment #".concat(ae.id," ")+"[".concat(ae.leftSE.point.x,", ").concat(ae.leftSE.point.y,"] -> ")+"[".concat(ae.rightSE.point.x,", ").concat(ae.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var Bt=ht,on=ht,sn=void 0,Gt=void 0;void 0===sn;)null===(Bt=this.tree.prev(Bt))?sn=null:void 0===Bt.key.consumedBy&&(sn=Bt.key);for(;void 0===Gt;)null===(on=this.tree.next(on))?Gt=null:void 0===on.key.consumedBy&&(Gt=on.key);if(fe.isLeft){var ur=null;if(sn){var lr=sn.getIntersection(ae);if(null!==lr&&(ae.isAnEndpoint(lr)||(ur=lr),!sn.isAnEndpoint(lr)))for(var En=this._splitSafely(sn,lr),Cr=0,Ei=En.length;Cr<Ei;Cr++)ze.push(En[Cr])}var qr=null;if(Gt){var ui=Gt.getIntersection(ae);if(null!==ui&&(ae.isAnEndpoint(ui)||(qr=ui),!Gt.isAnEndpoint(ui)))for(var Do=this._splitSafely(Gt,ui),jo=0,es=Do.length;jo<es;jo++)ze.push(Do[jo])}if(null!==ur||null!==qr){var wo;wo=null===ur?qr:null===qr||Me.comparePoints(ur,qr)<=0?ur:qr,this.queue.remove(ae.rightSE),ze.push(ae.rightSE);for(var oi=ae.split(wo),As=0,ts=oi.length;As<ts;As++)ze.push(oi[As])}ze.length>0?(this.tree.remove(ae),ze.push(fe)):(this.segments.push(ae),ae.prev=sn)}else{if(sn&&Gt){var gn=sn.getIntersection(Gt);if(null!==gn){if(!sn.isAnEndpoint(gn))for(var au=this._splitSafely(sn,gn),No=0,_r=au.length;No<_r;No++)ze.push(au[No]);if(!Gt.isAnEndpoint(gn))for(var Oa=this._splitSafely(Gt,gn),Go=0,Le=Oa.length;Go<Le;Go++)ze.push(Oa[Go])}}this.tree.remove(ae)}return ze}},{key:"_splitSafely",value:function(fe,ae){this.tree.remove(fe);var ze=fe.rightSE;this.queue.remove(ze);var ht=fe.split(ae);return ht.push(ze),void 0===fe.consumedBy&&this.tree.insert(fe),ht}}]),_t}(),Bn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,vn=typeof process<"u"&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,hn=new(function(){function _t(){vt(this,_t)}return Ee(_t,[{key:"run",value:function(fe,ae,ze){hn.type=fe,we.reset();for(var ht=[new Nt(ae,!0)],Bt=0,on=ze.length;Bt<on;Bt++)ht.push(new Nt(ze[Bt],!1));if(hn.numMultiPolys=ht.length,"difference"===hn.type)for(var sn=ht[0],Gt=1;Gt<ht.length;)null!==le(ht[Gt].bbox,sn.bbox)?Gt++:ht.splice(Gt,1);if("intersection"===hn.type)for(var ur=0,lr=ht.length;ur<lr;ur++)for(var En=ht[ur],Cr=ur+1,Ei=ht.length;Cr<Ei;Cr++)if(null===le(En.bbox,ht[Cr].bbox))return[];for(var qr=new Ct(Me.compare),ui=0,Do=ht.length;ui<Do;ui++)for(var jo=ht[ui].getSweepEvents(),es=0,wo=jo.length;es<wo;es++)if(qr.insert(jo[es]),qr.size>Bn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var ds=new Rn(qr),oi=qr.size,As=qr.pop();As;){var ts=As.key;if(qr.size===oi){var gn=ts.segment;throw new Error("Unable to pop() ".concat(ts.isLeft?"left":"right"," SweepEvent ")+"[".concat(ts.point.x,", ").concat(ts.point.y,"] from segment #").concat(gn.id," ")+"[".concat(gn.leftSE.point.x,", ").concat(gn.leftSE.point.y,"] -> ")+"[".concat(gn.rightSE.point.x,", ").concat(gn.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(qr.size>Bn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(ds.segments.length>vn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var au=ds.process(ts),No=0,_r=au.length;No<_r;No++){var Oa=au[No];void 0===Oa.consumedBy&&qr.insert(Oa)}oi=qr.size,As=qr.pop()}we.reset();var Go=fn.factory(ds.segments);return new Mn(Go).getGeom()}}]),_t}());return{union:function(ye){for(var fe=arguments.length,ae=new Array(fe>1?fe-1:0),ze=1;ze<fe;ze++)ae[ze-1]=arguments[ze];return hn.run("union",ye,ae)},intersection:function(ye){for(var fe=arguments.length,ae=new Array(fe>1?fe-1:0),ze=1;ze<fe;ze++)ae[ze-1]=arguments[ze];return hn.run("intersection",ye,ae)},xor:function(ye){for(var fe=arguments.length,ae=new Array(fe>1?fe-1:0),ze=1;ze<fe;ze++)ae[ze-1]=arguments[ze];return hn.run("xor",ye,ae)},difference:function(ye){for(var fe=arguments.length,ae=new Array(fe>1?fe-1:0),ze=1;ze<fe;ze++)ae[ze-1]=arguments[ze];return hn.run("difference",ye,ae)}}}()},3544:(an,vt,je)=>{"use strict";an.exports=Fe,an.exports.default=Fe;var Ee=je(6709);function Fe(le,Y){if(!(this instanceof Fe))return new Fe(le,Y);this._maxEntries=Math.max(4,le||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),Y&&this._initFormat(Y),this.clear()}function lt(le,Y,ce){if(!ce)return Y.indexOf(le);for(var ke=0;ke<Y.length;ke++)if(ce(le,Y[ke]))return ke;return-1}function p(le,Y){ve(le,0,le.children.length,Y,le)}function ve(le,Y,ce,ke,de){de||(de=he(null)),de.minX=1/0,de.minY=1/0,de.maxX=-1/0,de.maxY=-1/0;for(var we,se=Y;se<ce;se++)we=le.children[se],$e(de,le.leaf?ke(we):we);return de}function $e(le,Y){return le.minX=Math.min(le.minX,Y.minX),le.minY=Math.min(le.minY,Y.minY),le.maxX=Math.max(le.maxX,Y.maxX),le.maxY=Math.max(le.maxY,Y.maxY),le}function ut(le,Y){return le.minX-Y.minX}function ft(le,Y){return le.minY-Y.minY}function Ct(le){return(le.maxX-le.minX)*(le.maxY-le.minY)}function Yt(le){return le.maxX-le.minX+(le.maxY-le.minY)}function Ot(le,Y){return(Math.max(Y.maxX,le.maxX)-Math.min(Y.minX,le.minX))*(Math.max(Y.maxY,le.maxY)-Math.min(Y.minY,le.minY))}function xt(le,Y){var ce=Math.max(le.minX,Y.minX),ke=Math.max(le.minY,Y.minY),de=Math.min(le.maxX,Y.maxX),se=Math.min(le.maxY,Y.maxY);return Math.max(0,de-ce)*Math.max(0,se-ke)}function Ut(le,Y){return le.minX<=Y.minX&&le.minY<=Y.minY&&Y.maxX<=le.maxX&&Y.maxY<=le.maxY}function pn(le,Y){return Y.minX<=le.maxX&&Y.minY<=le.maxY&&Y.maxX>=le.minX&&Y.maxY>=le.minY}function he(le){return{children:le,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ie(le,Y,ce,ke,de){for(var we,se=[Y,ce];se.length;)!((ce=se.pop())-(Y=se.pop())<=ke)&&(we=Y+Math.ceil((ce-Y)/ke/2)*ke,Ee(le,we,Y,ce,de),se.push(Y,we,we,ce))}Fe.prototype={all:function(){return this._all(this.data,[])},search:function(le){var Y=this.data,ce=[],ke=this.toBBox;if(!pn(le,Y))return ce;for(var se,we,J,pt,de=[];Y;){for(se=0,we=Y.children.length;se<we;se++)J=Y.children[se],pn(le,pt=Y.leaf?ke(J):J)&&(Y.leaf?ce.push(J):Ut(le,pt)?this._all(J,ce):de.push(J));Y=de.pop()}return ce},collides:function(le){var Y=this.data,ce=this.toBBox;if(!pn(le,Y))return!1;for(var de,se,we,J,ke=[];Y;){for(de=0,se=Y.children.length;de<se;de++)if(we=Y.children[de],pn(le,J=Y.leaf?ce(we):we)){if(Y.leaf||Ut(le,J))return!0;ke.push(we)}Y=ke.pop()}return!1},load:function(le){if(!le||!le.length)return this;if(le.length<this._minEntries){for(var Y=0,ce=le.length;Y<ce;Y++)this.insert(le[Y]);return this}var ke=this._build(le.slice(),0,le.length-1,0);if(this.data.children.length)if(this.data.height===ke.height)this._splitRoot(this.data,ke);else{if(this.data.height<ke.height){var de=this.data;this.data=ke,ke=de}this._insert(ke,this.data.height-ke.height-1,!0)}else this.data=ke;return this},insert:function(le){return le&&this._insert(le,this.data.height-1),this},clear:function(){return this.data=he([]),this},remove:function(le,Y){if(!le)return this;for(var we,J,pt,Ve,ce=this.data,ke=this.toBBox(le),de=[],se=[];ce||de.length;){if(ce||(ce=de.pop(),J=de[de.length-1],we=se.pop(),Ve=!0),ce.leaf&&-1!==(pt=lt(le,ce.children,Y)))return ce.children.splice(pt,1),de.push(ce),this._condense(de),this;Ve||ce.leaf||!Ut(ce,ke)?J?(we++,ce=J.children[we],Ve=!1):ce=null:(de.push(ce),se.push(we),we=0,J=ce,ce=ce.children[0])}return this},toBBox:function(le){return le},compareMinX:ut,compareMinY:ft,toJSON:function(){return this.data},fromJSON:function(le){return this.data=le,this},_all:function(le,Y){for(var ce=[];le;)le.leaf?Y.push.apply(Y,le.children):ce.push.apply(ce,le.children),le=ce.pop();return Y},_build:function(le,Y,ce,ke){var we,de=ce-Y+1,se=this._maxEntries;if(de<=se)return p(we=he(le.slice(Y,ce+1)),this.toBBox),we;ke||(ke=Math.ceil(Math.log(de)/Math.log(se)),se=Math.ceil(de/Math.pow(se,ke-1))),(we=he([])).leaf=!1,we.height=ke;var Ve,qe,ue,Zt,J=Math.ceil(de/se),pt=J*Math.ceil(Math.sqrt(se));for(Ie(le,Y,ce,pt,this.compareMinX),Ve=Y;Ve<=ce;Ve+=pt)for(Ie(le,Ve,ue=Math.min(Ve+pt-1,ce),J,this.compareMinY),qe=Ve;qe<=ue;qe+=J)Zt=Math.min(qe+J-1,ue),we.children.push(this._build(le,qe,Zt,ke-1));return p(we,this.toBBox),we},_chooseSubtree:function(le,Y,ce,ke){for(var de,se,we,J,pt,Ve,qe,ue;ke.push(Y),!Y.leaf&&ke.length-1!==ce;){for(qe=ue=1/0,de=0,se=Y.children.length;de<se;de++)pt=Ct(we=Y.children[de]),(Ve=Ot(le,we)-pt)<ue?(ue=Ve,qe=pt<qe?pt:qe,J=we):Ve===ue&&pt<qe&&(qe=pt,J=we);Y=J||Y.children[0]}return Y},_insert:function(le,Y,ce){var de=ce?le:(0,this.toBBox)(le),se=[],we=this._chooseSubtree(de,this.data,Y,se);for(we.children.push(le),$e(we,de);Y>=0&&se[Y].children.length>this._maxEntries;)this._split(se,Y),Y--;this._adjustParentBBoxes(de,se,Y)},_split:function(le,Y){var ce=le[Y],ke=ce.children.length,de=this._minEntries;this._chooseSplitAxis(ce,de,ke);var se=this._chooseSplitIndex(ce,de,ke),we=he(ce.children.splice(se,ce.children.length-se));we.height=ce.height,we.leaf=ce.leaf,p(ce,this.toBBox),p(we,this.toBBox),Y?le[Y-1].children.push(we):this._splitRoot(ce,we)},_splitRoot:function(le,Y){this.data=he([le,Y]),this.data.height=le.height+1,this.data.leaf=!1,p(this.data,this.toBBox)},_chooseSplitIndex:function(le,Y,ce){var ke,de,se,we,J,pt,Ve,qe;for(pt=Ve=1/0,ke=Y;ke<=ce-Y;ke++)we=xt(de=ve(le,0,ke,this.toBBox),se=ve(le,ke,ce,this.toBBox)),J=Ct(de)+Ct(se),we<pt?(pt=we,qe=ke,Ve=J<Ve?J:Ve):we===pt&&J<Ve&&(Ve=J,qe=ke);return qe},_chooseSplitAxis:function(le,Y,ce){var ke=le.leaf?this.compareMinX:ut,de=le.leaf?this.compareMinY:ft;this._allDistMargin(le,Y,ce,ke)<this._allDistMargin(le,Y,ce,de)&&le.children.sort(ke)},_allDistMargin:function(le,Y,ce,ke){le.children.sort(ke);var pt,Ve,de=this.toBBox,se=ve(le,0,Y,de),we=ve(le,ce-Y,ce,de),J=Yt(se)+Yt(we);for(pt=Y;pt<ce-Y;pt++)Ve=le.children[pt],$e(se,le.leaf?de(Ve):Ve),J+=Yt(se);for(pt=ce-Y-1;pt>=Y;pt--)Ve=le.children[pt],$e(we,le.leaf?de(Ve):Ve),J+=Yt(we);return J},_adjustParentBBoxes:function(le,Y,ce){for(var ke=ce;ke>=0;ke--)$e(Y[ke],le)},_condense:function(le){for(var ce,Y=le.length-1;Y>=0;Y--)0===le[Y].children.length?Y>0?(ce=le[Y-1].children).splice(ce.indexOf(le[Y]),1):this.clear():p(le[Y],this.toBBox)},_initFormat:function(le){var Y=["return a"," - b",";"];this.compareMinX=new Function("a","b",Y.join(le[0])),this.compareMinY=new Function("a","b",Y.join(le[1])),this.toBBox=new Function("a","return {minX: a"+le[0]+", minY: a"+le[1]+", maxX: a"+le[2]+", maxY: a"+le[3]+"};")}}},6709:function(an){an.exports=function(){"use strict";function je(lt,p,ve,$e,ut){for(;$e>ve;){if($e-ve>600){var ft=$e-ve+1,Ct=p-ve+1,Yt=Math.log(ft),Ot=.5*Math.exp(2*Yt/3),xt=.5*Math.sqrt(Yt*Ot*(ft-Ot)/ft)*(Ct-ft/2<0?-1:1);je(lt,p,Math.max(ve,Math.floor(p-Ct*Ot/ft+xt)),Math.min($e,Math.floor(p+(ft-Ct)*Ot/ft+xt)),ut)}var he=lt[p],Ie=ve,le=$e;for(Ee(lt,ve,p),ut(lt[$e],he)>0&&Ee(lt,ve,$e);Ie<le;){for(Ee(lt,Ie,le),Ie++,le--;ut(lt[Ie],he)<0;)Ie++;for(;ut(lt[le],he)>0;)le--}0===ut(lt[ve],he)?Ee(lt,ve,le):Ee(lt,++le,$e),le<=p&&(ve=le+1),p<=le&&($e=le-1)}}function Ee(lt,p,ve){var $e=lt[p];lt[p]=lt[ve],lt[ve]=$e}function Fe(lt,p){return lt<p?-1:lt>p?1:0}return function vt(lt,p,ve,$e,ut){je(lt,p,ve||0,$e||lt.length-1,ut||Fe)}}()},4468:(an,vt,je)=>{"use strict";var Ee=je(9582).functionsHaveConfigurableNames(),Fe=Object,lt=TypeError;an.exports=function(){if(null!=this&&this!==Fe(this))throw new lt("RegExp.prototype.flags getter called on non-object");var ve="";return this.hasIndices&&(ve+="d"),this.global&&(ve+="g"),this.ignoreCase&&(ve+="i"),this.multiline&&(ve+="m"),this.dotAll&&(ve+="s"),this.unicode&&(ve+="u"),this.sticky&&(ve+="y"),ve},Ee&&Object.defineProperty&&Object.defineProperty(an.exports,"name",{value:"get flags"})},9235:(an,vt,je)=>{"use strict";var Ee=je(2358),Fe=je(5685),lt=je(4468),p=je(6343),ve=je(1956),$e=Fe(p());Ee($e,{getPolyfill:p,implementation:lt,shim:ve}),an.exports=$e},6343:(an,vt,je)=>{"use strict";var Ee=je(4468),Fe=je(2358).supportsDescriptors,lt=Object.getOwnPropertyDescriptor;an.exports=function(){if(Fe&&"gim"===/a/gim.flags){var ve=lt(RegExp.prototype,"flags");if(ve&&"function"==typeof ve.get&&"boolean"==typeof RegExp.prototype.dotAll&&"boolean"==typeof RegExp.prototype.hasIndices){var $e="",ut={};if(Object.defineProperty(ut,"hasIndices",{get:function(){$e+="d"}}),Object.defineProperty(ut,"sticky",{get:function(){$e+="y"}}),"dy"===$e)return ve.get}}return Ee}},1956:(an,vt,je)=>{"use strict";var Ee=je(2358).supportsDescriptors,Fe=je(6343),lt=Object.getOwnPropertyDescriptor,p=Object.defineProperty,ve=TypeError,$e=Object.getPrototypeOf,ut=/a/;an.exports=function(){if(!Ee||!$e)throw new ve("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var Ct=Fe(),Yt=$e(ut),Ot=lt(Yt,"flags");return(!Ot||Ot.get!==Ct)&&p(Yt,"flags",{configurable:!0,enumerable:!1,get:Ct}),Ct}},7563:function(an,vt){!function(je){"use strict";function lt(Ut,pn,he,Ie,le){let Y,ce,ke,de,se=pn[0],we=Ie[0],J=0,pt=0;we>se==we>-se?(Y=se,se=pn[++J]):(Y=we,we=Ie[++pt]);let Ve=0;if(J<Ut&&pt<he)for(we>se==we>-se?(ke=Y-((ce=se+Y)-se),se=pn[++J]):(ke=Y-((ce=we+Y)-we),we=Ie[++pt]),Y=ce,0!==ke&&(le[Ve++]=ke);J<Ut&&pt<he;)we>se==we>-se?(ke=Y-((ce=Y+se)-(de=ce-Y))+(se-de),se=pn[++J]):(ke=Y-((ce=Y+we)-(de=ce-Y))+(we-de),we=Ie[++pt]),Y=ce,0!==ke&&(le[Ve++]=ke);for(;J<Ut;)ke=Y-((ce=Y+se)-(de=ce-Y))+(se-de),se=pn[++J],Y=ce,0!==ke&&(le[Ve++]=ke);for(;pt<he;)ke=Y-((ce=Y+we)-(de=ce-Y))+(we-de),we=Ie[++pt],Y=ce,0!==ke&&(le[Ve++]=ke);return 0===Y&&0!==Ve||(le[Ve++]=Y),Ve}function p(Ut){return new Float64Array(Ut)}const ft=p(4),Ct=p(8),Yt=p(12),Ot=p(16),xt=p(4);je.orient2d=function(Ut,pn,he,Ie,le,Y){const ce=(pn-Y)*(he-le),ke=(Ut-le)*(Ie-Y),de=ce-ke;if(0===ce||0===ke||ce>0!=ke>0)return de;const se=Math.abs(ce+ke);return Math.abs(de)>=33306690738754716e-32*se?de:-function(we,J,pt,Ve,qe,ue,Zt){let At,Pe,ct,Me,tt,dt,Ae,Vt,Nt,fn,Lt,Mn,Rn,Bn,vn,Sn,hn,Jn;const ti=we-qe,io=pt-qe,Zn=J-ue,hr=Ve-ue;tt=(vn=(Vt=ti-(Ae=(dt=134217729*ti)-(dt-ti)))*(fn=hr-(Nt=(dt=134217729*hr)-(dt-hr)))-((Bn=ti*hr)-Ae*Nt-Vt*Nt-Ae*fn))-(Lt=vn-(hn=(Vt=Zn-(Ae=(dt=134217729*Zn)-(dt-Zn)))*(fn=io-(Nt=(dt=134217729*io)-(dt-io)))-((Sn=Zn*io)-Ae*Nt-Vt*Nt-Ae*fn))),ft[0]=vn-(Lt+tt)+(tt-hn),tt=(Rn=Bn-((Mn=Bn+Lt)-(tt=Mn-Bn))+(Lt-tt))-(Lt=Rn-Sn),ft[1]=Rn-(Lt+tt)+(tt-Sn),tt=(Jn=Mn+Lt)-Mn,ft[2]=Mn-(Jn-tt)+(Lt-tt),ft[3]=Jn;let _t=function(ht,Bt){let on=Bt[0];for(let sn=1;sn<4;sn++)on+=Bt[sn];return on}(0,ft),ye=22204460492503146e-32*Zt;if(_t>=ye||-_t>=ye||(At=we-(ti+(tt=we-ti))+(tt-qe),ct=pt-(io+(tt=pt-io))+(tt-qe),Pe=J-(Zn+(tt=J-Zn))+(tt-ue),Me=Ve-(hr+(tt=Ve-hr))+(tt-ue),0===At&&0===Pe&&0===ct&&0===Me)||(ye=11093356479670487e-47*Zt+33306690738754706e-32*Math.abs(_t),(_t+=ti*Me+hr*At-(Zn*ct+io*Pe))>=ye||-_t>=ye))return _t;tt=(vn=(Vt=At-(Ae=(dt=134217729*At)-(dt-At)))*(fn=hr-(Nt=(dt=134217729*hr)-(dt-hr)))-((Bn=At*hr)-Ae*Nt-Vt*Nt-Ae*fn))-(Lt=vn-(hn=(Vt=Pe-(Ae=(dt=134217729*Pe)-(dt-Pe)))*(fn=io-(Nt=(dt=134217729*io)-(dt-io)))-((Sn=Pe*io)-Ae*Nt-Vt*Nt-Ae*fn))),xt[0]=vn-(Lt+tt)+(tt-hn),tt=(Rn=Bn-((Mn=Bn+Lt)-(tt=Mn-Bn))+(Lt-tt))-(Lt=Rn-Sn),xt[1]=Rn-(Lt+tt)+(tt-Sn),tt=(Jn=Mn+Lt)-Mn,xt[2]=Mn-(Jn-tt)+(Lt-tt),xt[3]=Jn;const fe=lt(4,ft,4,xt,Ct);tt=(vn=(Vt=ti-(Ae=(dt=134217729*ti)-(dt-ti)))*(fn=Me-(Nt=(dt=134217729*Me)-(dt-Me)))-((Bn=ti*Me)-Ae*Nt-Vt*Nt-Ae*fn))-(Lt=vn-(hn=(Vt=Zn-(Ae=(dt=134217729*Zn)-(dt-Zn)))*(fn=ct-(Nt=(dt=134217729*ct)-(dt-ct)))-((Sn=Zn*ct)-Ae*Nt-Vt*Nt-Ae*fn))),xt[0]=vn-(Lt+tt)+(tt-hn),tt=(Rn=Bn-((Mn=Bn+Lt)-(tt=Mn-Bn))+(Lt-tt))-(Lt=Rn-Sn),xt[1]=Rn-(Lt+tt)+(tt-Sn),tt=(Jn=Mn+Lt)-Mn,xt[2]=Mn-(Jn-tt)+(Lt-tt),xt[3]=Jn;const ae=lt(fe,Ct,4,xt,Yt);tt=(vn=(Vt=At-(Ae=(dt=134217729*At)-(dt-At)))*(fn=Me-(Nt=(dt=134217729*Me)-(dt-Me)))-((Bn=At*Me)-Ae*Nt-Vt*Nt-Ae*fn))-(Lt=vn-(hn=(Vt=Pe-(Ae=(dt=134217729*Pe)-(dt-Pe)))*(fn=ct-(Nt=(dt=134217729*ct)-(dt-ct)))-((Sn=Pe*ct)-Ae*Nt-Vt*Nt-Ae*fn))),xt[0]=vn-(Lt+tt)+(tt-hn),tt=(Rn=Bn-((Mn=Bn+Lt)-(tt=Mn-Bn))+(Lt-tt))-(Lt=Rn-Sn),xt[1]=Rn-(Lt+tt)+(tt-Sn),tt=(Jn=Mn+Lt)-Mn,xt[2]=Mn-(Jn-tt)+(Lt-tt),xt[3]=Jn;const ze=lt(ae,Yt,4,xt,Ot);return Ot[ze-1]}(Ut,pn,he,Ie,le,Y,se)},je.orient2dfast=function(Ut,pn,he,Ie,le,Y){return(pn-Y)*(he-le)-(Ut-le)*(Ie-Y)},Object.defineProperty(je,"__esModule",{value:!0})}(vt)},9231:an=>{"use strict";an.exports={eudist:function(je,Ee,Fe){for(var lt=je.length,p=0,ve=0;ve<lt;ve++){var $e=(je[ve]||0)-(Ee[ve]||0);p+=$e*$e}return Fe?Math.sqrt(p):p},mandist:function(je,Ee,Fe){for(var lt=je.length,p=0,ve=0;ve<lt;ve++)p+=Math.abs((je[ve]||0)-(Ee[ve]||0));return Fe?Math.sqrt(p):p},dist:function(je,Ee,Fe){var lt=Math.abs(je-Ee);return Fe?lt:lt*lt}}},5561:(an,vt,je)=>{"use strict";var Ee=je(9231),Fe=Ee.eudist,lt=Ee.dist;an.exports={kmrand:function(ve,$e){for(var ut={},ft=[],Ct=$e<<2,Yt=ve.length,Ot=ve[0].length>0;ft.length<$e&&Ct-- >0;){var xt=ve[Math.floor(Math.random()*Yt)],Ut=Ot?xt.join("_"):""+xt;ut[Ut]||(ut[Ut]=!0,ft.push(xt))}if(ft.length<$e)throw new Error("Error initializating clusters");return ft},kmpp:function(ve,$e){var ut=ve[0].length?Fe:lt,ft=[],Ct=ve.length,Yt=ve[0].length>0,xt=ve[Math.floor(Math.random()*Ct)];for(Yt&&xt.join("_"),ft.push(xt);ft.length<$e;){for(var pn=[],he=ft.length,Ie=0,le=[],Y=0;Y<Ct;Y++){for(var ce=1/0,ke=0;ke<he;ke++){var de=ut(ve[Y],ft[ke]);de<=ce&&(ce=de)}pn[Y]=ce}for(var se=0;se<Ct;se++)Ie+=pn[se];for(var we=0;we<Ct;we++)le[we]={i:we,v:ve[we],pr:pn[we]/Ie,cs:0};le.sort(function(qe,ue){return qe.pr-ue.pr}),le[0].cs=le[0].pr;for(var J=1;J<Ct;J++)le[J].cs=le[J-1].cs+le[J].pr;for(var pt=Math.random(),Ve=0;Ve<Ct-1&&le[Ve++].cs<pt;);ft.push(le[Ve-1].v)}return ft}}},9475:(an,vt,je)=>{"use strict";var Ee=je(9231),Fe=je(5561),lt=Ee.eudist,$e=Fe.kmrand,ut=Fe.kmpp;function Ct(Ot,xt,Ut){Ut=Ut||[];for(var pn=0;pn<Ot;pn++)Ut[pn]=xt;return Ut}an.exports=function Yt(Ot,xt,Ut,pn){var he=[],Ie=[],le=[],Y=[],ce=!1,ke=pn||1e4,de=Ot.length,se=Ot[0].length,we=se>0,J=[];if(Ut)he="kmrand"==Ut?$e(Ot,xt):"kmpp"==Ut?ut(Ot,xt):Ut;else for(var pt={};he.length<xt;){var Ve=Math.floor(Math.random()*de);pt[Ve]||(pt[Ve]=!0,he.push(Ot[Ve]))}do{Ct(xt,0,J);for(var qe=0;qe<de;qe++){for(var ue=1/0,Zt=0,At=0;At<xt;At++)(Y=we?lt(Ot[qe],he[At]):Math.abs(Ot[qe]-he[At]))<=ue&&(ue=Y,Zt=At);le[qe]=Zt,J[Zt]++}for(var Pe=[],Me=(Ie=[],0);Me<xt;Me++)Pe[Me]=we?Ct(se,0,Pe[Me]):0,Ie[Me]=he[Me];if(we){for(var tt=0;tt<xt;tt++)he[tt]=[];for(var dt=0;dt<de;dt++)for(var Vt=Pe[le[dt]],Nt=Ot[dt],fn=0;fn<se;fn++)Vt[fn]+=Nt[fn];ce=!0;for(var Lt=0;Lt<xt;Lt++){for(var Mn=he[Lt],Rn=Pe[Lt],Bn=Ie[Lt],vn=J[Lt],Sn=0;Sn<se;Sn++)Mn[Sn]=Rn[Sn]/vn||0;if(ce)for(var hn=0;hn<se;hn++)if(Bn[hn]!=Mn[hn]){ce=!1;break}}}else{for(var Jn=0;Jn<de;Jn++)Pe[le[Jn]]+=Ot[Jn];for(var io=0;io<xt;io++)he[io]=Pe[io]/J[io]||0;ce=!0;for(var Zn=0;Zn<xt;Zn++)if(Ie[Zn]!=he[Zn]){ce=!1;break}}ce=ce||--ke<=0}while(!ce);return{it:1e4-ke,k:xt,idxs:le,centroids:he}}},7253:(an,vt,je)=>{"use strict";je.r(vt),je.d(vt,{default:()=>Ee});class Ee{constructor(p=[],ve=Fe){if(this.data=p,this.length=this.data.length,this.compare=ve,this.length>0)for(let $e=(this.length>>1)-1;$e>=0;$e--)this._down($e)}push(p){this.data.push(p),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const p=this.data[0],ve=this.data.pop();return this.length--,this.length>0&&(this.data[0]=ve,this._down(0)),p}peek(){return this.data[0]}_up(p){const{data:ve,compare:$e}=this,ut=ve[p];for(;p>0;){const ft=p-1>>1,Ct=ve[ft];if($e(ut,Ct)>=0)break;ve[p]=Ct,p=ft}ve[p]=ut}_down(p){const{data:ve,compare:$e}=this,ut=this.length>>1,ft=ve[p];for(;p<ut;){let Ct=1+(p<<1),Yt=ve[Ct];const Ot=Ct+1;if(Ot<this.length&&$e(ve[Ot],Yt)<0&&(Ct=Ot,Yt=ve[Ot]),$e(Yt,ft)>=0)break;ve[p]=Yt,p=Ct}ve[p]=ft}}function Fe(lt,p){return lt<p?-1:lt>p?1:0}},770:function(an,vt){!function(je){"use strict";function Ee(){}function Fe(u){this.message=u||""}function lt(u){this.message=u||""}function p(u){this.message=u||""}function ve(){}function $e(u){return null===u?nt:u.color}function ut(u){return null===u?null:u.parent}function ft(u,h){null!==u&&(u.color=h)}function Ct(u){return null===u?null:u.left}function Yt(u){return null===u?null:u.right}function Ot(){this.root_=null,this.size_=0}function xt(){}function Ut(){this.array_=[],arguments[0]instanceof oi&&this.addAll(arguments[0])}function pn(){}function he(u){this.message=u||""}function Ie(){this.array_=[]}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(u){if(null==this)throw new TypeError(this+" is not an object");var h=Object(this),y=Math.max(Math.min(h.length,9007199254740991),0)||0,x=1 in arguments&&parseInt(Number(arguments[1]),10)||0;x=x<0?Math.max(y+x,0):Math.min(x,y);var T=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:y;for(T=T<0?Math.max(y+arguments[2],0):Math.min(T,y);x<T;)h[x]=u,++x;return h},writable:!0}),Number.isFinite=Number.isFinite||function(u){return"number"==typeof u&&isFinite(u)},Number.isInteger=Number.isInteger||function(u){return"number"==typeof u&&isFinite(u)&&Math.floor(u)===u},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(u){return u!=u},Math.trunc=Math.trunc||function(u){return u<0?Math.ceil(u):Math.floor(u)};var le=function(){};le.prototype.interfaces_=function(){return[]},le.prototype.getClass=function(){return le},le.prototype.equalsWithTolerance=function(u,h,y){return Math.abs(u-h)<=y};var Y=function(u){function h(y){u.call(this,y),this.name="IllegalArgumentException",this.message=y,this.stack=(new u).stack}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(Error),ce=function(){},ke={MAX_VALUE:{configurable:!0}};ce.isNaN=function(u){return Number.isNaN(u)},ce.doubleToLongBits=function(u){return u},ce.longBitsToDouble=function(u){return u},ce.isInfinite=function(u){return!Number.isFinite(u)},ke.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(ce,ke);var de=function(){},se=function(){},we=function(){},J=function u(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=u.NULL_ORDINATE;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.z=h.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=u.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},pt={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};J.prototype.setOrdinate=function(u,h){switch(u){case J.X:this.x=h;break;case J.Y:this.y=h;break;case J.Z:this.z=h;break;default:throw new Y("Invalid ordinate index: "+u)}},J.prototype.equals2D=function(){if(1===arguments.length){var u=arguments[0];return this.x===u.x&&this.y===u.y}if(2===arguments.length){var h=arguments[0],y=arguments[1];return!!le.equalsWithTolerance(this.x,h.x,y)&&!!le.equalsWithTolerance(this.y,h.y,y)}},J.prototype.getOrdinate=function(u){switch(u){case J.X:return this.x;case J.Y:return this.y;case J.Z:return this.z}throw new Y("Invalid ordinate index: "+u)},J.prototype.equals3D=function(u){return this.x===u.x&&this.y===u.y&&(this.z===u.z||ce.isNaN(this.z))&&ce.isNaN(u.z)},J.prototype.equals=function(u){return u instanceof J&&this.equals2D(u)},J.prototype.equalInZ=function(u,h){return le.equalsWithTolerance(this.z,u.z,h)},J.prototype.compareTo=function(u){return this.x<u.x?-1:this.x>u.x?1:this.y<u.y?-1:this.y>u.y?1:0},J.prototype.clone=function(){},J.prototype.copy=function(){return new J(this)},J.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},J.prototype.distance3D=function(u){var h=this.x-u.x,y=this.y-u.y,x=this.z-u.z;return Math.sqrt(h*h+y*y+x*x)},J.prototype.distance=function(u){var h=this.x-u.x,y=this.y-u.y;return Math.sqrt(h*h+y*y)},J.prototype.hashCode=function(){var u=17;return 37*(u=37*u+J.hashCode(this.x))+J.hashCode(this.y)},J.prototype.setCoordinate=function(u){this.x=u.x,this.y=u.y,this.z=u.z},J.prototype.interfaces_=function(){return[de,se,Ee]},J.prototype.getClass=function(){return J},J.hashCode=function(){if(1===arguments.length){var h=ce.doubleToLongBits(arguments[0]);return Math.trunc((h^h)>>>32)}},pt.DimensionalComparator.get=function(){return Ve},pt.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},pt.NULL_ORDINATE.get=function(){return ce.NaN},pt.X.get=function(){return 0},pt.Y.get=function(){return 1},pt.Z.get=function(){return 2},Object.defineProperties(J,pt);var Ve=function(u){if(this._dimensionsToTest=2,0!==arguments.length&&1===arguments.length){var h=arguments[0];if(2!==h&&3!==h)throw new Y("only 2 or 3 dimensions may be specified");this._dimensionsToTest=h}};Ve.prototype.compare=function(u,h){var y=u,x=h,T=Ve.compare(y.x,x.x);if(0!==T)return T;var k=Ve.compare(y.y,x.y);return 0!==k?k:this._dimensionsToTest<=2?0:Ve.compare(y.z,x.z)},Ve.prototype.interfaces_=function(){return[we]},Ve.prototype.getClass=function(){return Ve},Ve.compare=function(u,h){return u<h?-1:u>h?1:ce.isNaN(u)?ce.isNaN(h)?0:-1:ce.isNaN(h)?1:0};var qe=function(){};qe.prototype.create=function(){},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe};var ue=function(){},Zt={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};ue.prototype.interfaces_=function(){return[]},ue.prototype.getClass=function(){return ue},ue.toLocationSymbol=function(u){switch(u){case ue.EXTERIOR:return"e";case ue.BOUNDARY:return"b";case ue.INTERIOR:return"i";case ue.NONE:return"-"}throw new Y("Unknown location value: "+u)},Zt.INTERIOR.get=function(){return 0},Zt.BOUNDARY.get=function(){return 1},Zt.EXTERIOR.get=function(){return 2},Zt.NONE.get=function(){return-1},Object.defineProperties(ue,Zt);var At=function(u,h){return u.interfaces_&&u.interfaces_().indexOf(h)>-1},Pe=function(){},ct={LOG_10:{configurable:!0}};Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe},Pe.log10=function(u){var h=Math.log(u);return ce.isInfinite(h)||ce.isNaN(h)?h:h/Pe.LOG_10},Pe.min=function(u,h,y,x){var T=u;return h<T&&(T=h),y<T&&(T=y),x<T&&(T=x),T},Pe.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1],y=arguments[2];return u<h?h:u>y?y:u}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var x=arguments[0],T=arguments[1],k=arguments[2];return x<T?T:x>k?k:x}},Pe.wrap=function(u,h){return u<0?h- -u%h:u%h},Pe.max=function(){if(3===arguments.length){var h=arguments[1],y=arguments[2],x=arguments[0];return h>x&&(x=h),y>x&&(x=y),x}if(4===arguments.length){var k=arguments[1],G=arguments[2],K=arguments[3],re=arguments[0];return k>re&&(re=k),G>re&&(re=G),K>re&&(re=K),re}},Pe.average=function(u,h){return(u+h)/2},ct.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Pe,ct);var Me=function(u){this.str=u};Me.prototype.append=function(u){this.str+=u},Me.prototype.setCharAt=function(u,h){this.str=this.str.substr(0,u)+h+this.str.substr(u+1)},Me.prototype.toString=function(u){return this.str};var tt=function(u){this.value=u};tt.prototype.intValue=function(){return this.value},tt.prototype.compareTo=function(u){return this.value<u?-1:this.value>u?1:0},tt.isNaN=function(u){return Number.isNaN(u)};var dt=function(){};dt.isWhitespace=function(u){return u<=32&&u>=0||127===u},dt.toUpperCase=function(u){return u.toUpperCase()};var Ae=function u(){this._hi=0,this._lo=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof u?this.init(arguments[0]):"string"==typeof arguments[0]&&u.call(this,u.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},Vt={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Ae.prototype.le=function(u){return(this._hi<u._hi||this._hi===u._hi)&&this._lo<=u._lo},Ae.prototype.extractSignificantDigits=function(u,h){var y=this.abs(),x=Ae.magnitude(y._hi),T=Ae.TEN.pow(x);(y=y.divide(T)).gt(Ae.TEN)?(y=y.divide(Ae.TEN),x+=1):y.lt(Ae.ONE)&&(y=y.multiply(Ae.TEN),x-=1);for(var k=x+1,G=new Me,K=Ae.MAX_PRINT_DIGITS-1,re=0;re<=K;re++){u&&re===k&&G.append(".");var et=Math.trunc(y._hi);if(et<0)break;var Ft=!1,$t=0;et>9?(Ft=!0,$t="9"):$t="0"+et,G.append($t),y=y.subtract(Ae.valueOf(et)).multiply(Ae.TEN),Ft&&y.selfAdd(Ae.TEN);var gt=!0,nn=Ae.magnitude(y._hi);if(nn<0&&Math.abs(nn)>=K-re&&(gt=!1),!gt)break}return h[0]=x,G.toString()},Ae.prototype.sqr=function(){return this.multiply(this)},Ae.prototype.doubleValue=function(){return this._hi+this._lo},Ae.prototype.subtract=function(){return arguments[0]instanceof Ae?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},Ae.prototype.equals=function(){if(1===arguments.length){var u=arguments[0];return this._hi===u._hi&&this._lo===u._lo}},Ae.prototype.isZero=function(){return 0===this._hi&&0===this._lo},Ae.prototype.selfSubtract=function(){if(arguments[0]instanceof Ae){var u=arguments[0];return this.isNaN()?this:this.selfAdd(-u._hi,-u._lo)}if("number"==typeof arguments[0]){var h=arguments[0];return this.isNaN()?this:this.selfAdd(-h,0)}},Ae.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Ae.prototype.min=function(u){return this.le(u)?this:u},Ae.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Ae){var u=arguments[0];return this.selfDivide(u._hi,u._lo)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var y=arguments[0],T=null,k=null,G=null,K=null,re=null,et=null,Ft=null,$t=null;return this._hi=$t=(re=this._hi/y)+(et=(this._hi-(Ft=re*y)-($t=(T=(et=Ae.SPLIT*re)-(T=et-re))*(G=($t=Ae.SPLIT*y)-(G=$t-y))-Ft+T*(K=y-G)+(k=re-T)*G+k*K)+this._lo-re*arguments[1])/y),this._lo=re-$t+et,this}},Ae.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"},Ae.prototype.divide=function(){if(arguments[0]instanceof Ae){var u=arguments[0],h=null,y=null,x=null,T=null,k=null,G=null,K=null,re=null;return y=(k=this._hi/u._hi)-(h=(G=Ae.SPLIT*k)-(h=G-k)),re=h*(x=(re=Ae.SPLIT*u._hi)-(x=re-u._hi))-(K=k*u._hi)+h*(T=u._hi-x)+y*x+y*T,new Ae(re=k+(G=(this._hi-K-re+this._lo-k*u._lo)/u._hi),k-re+G)}if("number"==typeof arguments[0]){var et=arguments[0];return ce.isNaN(et)?Ae.createNaN():Ae.copy(this).selfDivide(et,0)}},Ae.prototype.ge=function(u){return(this._hi>u._hi||this._hi===u._hi)&&this._lo>=u._lo},Ae.prototype.pow=function(u){if(0===u)return Ae.valueOf(1);var h=new Ae(this),y=Ae.valueOf(1),x=Math.abs(u);if(x>1)for(;x>0;)x%2==1&&y.selfMultiply(h),(x/=2)>0&&(h=h.sqr());else y=h;return u<0?y.reciprocal():y},Ae.prototype.ceil=function(){if(this.isNaN())return Ae.NaN;var u=Math.ceil(this._hi),h=0;return u===this._hi&&(h=Math.ceil(this._lo)),new Ae(u,h)},Ae.prototype.compareTo=function(u){return this._hi<u._hi?-1:this._hi>u._hi?1:this._lo<u._lo?-1:this._lo>u._lo?1:0},Ae.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Ae.prototype.setValue=function(){return arguments[0]instanceof Ae||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},Ae.prototype.max=function(u){return this.ge(u)?this:u},Ae.prototype.sqrt=function(){if(this.isZero())return Ae.valueOf(0);if(this.isNegative())return Ae.NaN;var u=1/Math.sqrt(this._hi),y=Ae.valueOf(this._hi*u),x=this.subtract(y.sqr())._hi*(.5*u);return y.add(x)},Ae.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Ae){var u=arguments[0];return this.selfAdd(u._hi,u._lo)}if("number"==typeof arguments[0]){var h=arguments[0],y=null,x=null,T=null,G=null,K=null;return this._hi=(y=(T=this._hi+h)+(K=h-(G=T-this._hi)+(this._hi-(T-G))+this._lo))+(x=K+(T-y)),this._lo=x+(y-this._hi),this}}else if(2===arguments.length){var re=arguments[0],et=arguments[1],Ft=null,$t=null,gt=null,nn=null,Un=null,Qn=null,Sr=null;Un=(nn=this._hi+re)-(Qn=nn-this._hi),gt=($t=this._lo+et)-(Sr=$t-this._lo);var Bo=(Ft=nn+(Qn=(Un=re-Qn+(this._hi-Un))+$t))+(Qn=(gt=et-Sr+(this._lo-gt))+(Qn+(nn-Ft))),xs=Qn+(Ft-Bo);return this._hi=Bo,this._lo=xs,this}},Ae.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Ae){var u=arguments[0];return this.selfMultiply(u._hi,u._lo)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var y=arguments[0],T=null,k=null,G=null,K=null,re=null,et=null;T=(re=Ae.SPLIT*this._hi)-this._hi,T=re-T;var Ft=(re=this._hi*y)+(et=T*(G=(et=Ae.SPLIT*y)-(G=et-y))-re+T*(K=y-G)+(k=this._hi-T)*G+k*K+(this._hi*arguments[1]+this._lo*y)),$t=et+(T=re-Ft);return this._hi=Ft,this._lo=$t,this}},Ae.prototype.selfSqr=function(){return this.selfMultiply(this)},Ae.prototype.floor=function(){if(this.isNaN())return Ae.NaN;var u=Math.floor(this._hi),h=0;return u===this._hi&&(h=Math.floor(this._lo)),new Ae(u,h)},Ae.prototype.negate=function(){return this.isNaN()?this:new Ae(-this._hi,-this._lo)},Ae.prototype.clone=function(){},Ae.prototype.multiply=function(){if(arguments[0]instanceof Ae){var u=arguments[0];return u.isNaN()?Ae.createNaN():Ae.copy(this).selfMultiply(u)}if("number"==typeof arguments[0]){var h=arguments[0];return ce.isNaN(h)?Ae.createNaN():Ae.copy(this).selfMultiply(h,0)}},Ae.prototype.isNaN=function(){return ce.isNaN(this._hi)},Ae.prototype.intValue=function(){return Math.trunc(this._hi)},Ae.prototype.toString=function(){var u=Ae.magnitude(this._hi);return u>=-3&&u<=20?this.toStandardNotation():this.toSciNotation()},Ae.prototype.toStandardNotation=function(){var u=this.getSpecialNumberString();if(null!==u)return u;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!0,h),x=h[0]+1,T=y;return"."===y.charAt(0)?T="0"+y:x<0?T="0."+Ae.stringOfChar("0",-x)+y:-1===y.indexOf(".")&&(T=y+Ae.stringOfChar("0",x-y.length)+".0"),this.isNegative()?"-"+T:T},Ae.prototype.reciprocal=function(){var h,x,T,G,u=null,y=null,k=null,K=null;h=(T=1/this._hi)-(u=(k=Ae.SPLIT*T)-(u=k-T)),y=(K=Ae.SPLIT*this._hi)-this._hi;var re=T+(k=(1-(G=T*this._hi)-(K=u*(y=K-y)-G+u*(x=this._hi-y)+h*y+h*x)-T*this._lo)/this._hi);return new Ae(re,T-re+k)},Ae.prototype.toSciNotation=function(){if(this.isZero())return Ae.SCI_NOT_ZERO;var u=this.getSpecialNumberString();if(null!==u)return u;var h=new Array(1).fill(null),y=this.extractSignificantDigits(!1,h),x=Ae.SCI_NOT_EXPONENT_CHAR+h[0];if("0"===y.charAt(0))throw new Error("Found leading zero: "+y);var T="";y.length>1&&(T=y.substring(1));var k=y.charAt(0)+"."+T;return this.isNegative()?"-"+k+x:k+x},Ae.prototype.abs=function(){return this.isNaN()?Ae.NaN:this.isNegative()?this.negate():new Ae(this)},Ae.prototype.isPositive=function(){return(this._hi>0||0===this._hi)&&this._lo>0},Ae.prototype.lt=function(u){return(this._hi<u._hi||this._hi===u._hi)&&this._lo<u._lo},Ae.prototype.add=function(){if(arguments[0]instanceof Ae){var u=arguments[0];return Ae.copy(this).selfAdd(u)}if("number"==typeof arguments[0]){var h=arguments[0];return Ae.copy(this).selfAdd(h)}},Ae.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this._hi=arguments[0],this._lo=0;else if(arguments[0]instanceof Ae){var h=arguments[0];this._hi=h._hi,this._lo=h._lo}}else if(2===arguments.length){var x=arguments[1];this._hi=arguments[0],this._lo=x}},Ae.prototype.gt=function(u){return(this._hi>u._hi||this._hi===u._hi)&&this._lo>u._lo},Ae.prototype.isNegative=function(){return(this._hi<0||0===this._hi)&&this._lo<0},Ae.prototype.trunc=function(){return this.isNaN()?Ae.NaN:this.isPositive()?this.floor():this.ceil()},Ae.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0},Ae.prototype.interfaces_=function(){return[Ee,de,se]},Ae.prototype.getClass=function(){return Ae},Ae.sqr=function(u){return Ae.valueOf(u).selfMultiply(u)},Ae.valueOf=function(){return"string"==typeof arguments[0]?Ae.parse(arguments[0]):"number"==typeof arguments[0]?new Ae(arguments[0]):void 0},Ae.sqrt=function(u){return Ae.valueOf(u).sqrt()},Ae.parse=function(u){for(var h=0,y=u.length;dt.isWhitespace(u.charAt(h));)h++;var x=!1;if(h<y){var T=u.charAt(h);"-"!==T&&"+"!==T||(h++,"-"===T&&(x=!0))}for(var k=new Ae,G=0,K=0,re=0;!(h>=y);){var et=u.charAt(h);if(h++,dt.isDigit(et)){var Ft=et-"0";k.selfMultiply(Ae.TEN),k.selfAdd(Ft),G++}else{if("."!==et){if("e"===et||"E"===et){var $t=u.substring(h);try{re=tt.parseInt($t)}catch(Sr){throw Sr instanceof Error?new Error("Invalid exponent "+$t+" in string "+u):Sr}break}throw new Error("Unexpected character '"+et+"' at position "+h+" in string "+u)}K=G}}var gt=k,nn=G-K-re;if(0===nn)gt=k;else if(nn>0){var Un=Ae.TEN.pow(nn);gt=k.divide(Un)}else if(nn<0){var Qn=Ae.TEN.pow(-nn);gt=k.multiply(Qn)}return x?gt.negate():gt},Ae.createNaN=function(){return new Ae(ce.NaN,ce.NaN)},Ae.copy=function(u){return new Ae(u)},Ae.magnitude=function(u){var h=Math.abs(u),y=Math.log(h)/Math.log(10),x=Math.trunc(Math.floor(y));return 10*Math.pow(10,x)<=h&&(x+=1),x},Ae.stringOfChar=function(u,h){for(var y=new Me,x=0;x<h;x++)y.append(u);return y.toString()},Vt.PI.get=function(){return new Ae(3.141592653589793,12246467991473532e-32)},Vt.TWO_PI.get=function(){return new Ae(6.283185307179586,24492935982947064e-32)},Vt.PI_2.get=function(){return new Ae(1.5707963267948966,6123233995736766e-32)},Vt.E.get=function(){return new Ae(2.718281828459045,14456468917292502e-32)},Vt.NaN.get=function(){return new Ae(ce.NaN,ce.NaN)},Vt.EPS.get=function(){return 123259516440783e-46},Vt.SPLIT.get=function(){return 134217729},Vt.MAX_PRINT_DIGITS.get=function(){return 32},Vt.TEN.get=function(){return Ae.valueOf(10)},Vt.ONE.get=function(){return Ae.valueOf(1)},Vt.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},Vt.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Ae,Vt);var Nt=function(){},fn={DP_SAFE_EPSILON:{configurable:!0}};Nt.prototype.interfaces_=function(){return[]},Nt.prototype.getClass=function(){return Nt},Nt.orientationIndex=function(u,h,y){var x=Nt.orientationIndexFilter(u,h,y);if(x<=1)return x;var T=Ae.valueOf(h.x).selfAdd(-u.x),k=Ae.valueOf(h.y).selfAdd(-u.y),G=Ae.valueOf(y.x).selfAdd(-h.x),K=Ae.valueOf(y.y).selfAdd(-h.y);return T.selfMultiply(K).selfSubtract(k.selfMultiply(G)).signum()},Nt.signOfDet2x2=function(u,h,y,x){return u.multiply(x).selfSubtract(h.multiply(y)).signum()},Nt.intersection=function(u,h,y,x){var T=Ae.valueOf(x.y).selfSubtract(y.y).selfMultiply(Ae.valueOf(h.x).selfSubtract(u.x)),k=Ae.valueOf(x.x).selfSubtract(y.x).selfMultiply(Ae.valueOf(h.y).selfSubtract(u.y)),G=T.subtract(k),K=Ae.valueOf(x.x).selfSubtract(y.x).selfMultiply(Ae.valueOf(u.y).selfSubtract(y.y)),re=Ae.valueOf(x.y).selfSubtract(y.y).selfMultiply(Ae.valueOf(u.x).selfSubtract(y.x)),et=K.subtract(re).selfDivide(G).doubleValue(),Ft=Ae.valueOf(u.x).selfAdd(Ae.valueOf(h.x).selfSubtract(u.x).selfMultiply(et)).doubleValue(),$t=Ae.valueOf(h.x).selfSubtract(u.x).selfMultiply(Ae.valueOf(u.y).selfSubtract(y.y)),gt=Ae.valueOf(h.y).selfSubtract(u.y).selfMultiply(Ae.valueOf(u.x).selfSubtract(y.x)),nn=$t.subtract(gt).selfDivide(G).doubleValue(),Un=Ae.valueOf(y.y).selfAdd(Ae.valueOf(x.y).selfSubtract(y.y).selfMultiply(nn)).doubleValue();return new J(Ft,Un)},Nt.orientationIndexFilter=function(u,h,y){var x=null,T=(u.x-y.x)*(h.y-y.y),k=(u.y-y.y)*(h.x-y.x),G=T-k;if(T>0){if(k<=0)return Nt.signum(G);x=T+k}else{if(!(T<0)||k>=0)return Nt.signum(G);x=-T-k}var K=Nt.DP_SAFE_EPSILON*x;return G>=K||-G>=K?Nt.signum(G):2},Nt.signum=function(u){return u>0?1:u<0?-1:0},fn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Nt,fn);var Lt=function(){},Mn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Mn.X.get=function(){return 0},Mn.Y.get=function(){return 1},Mn.Z.get=function(){return 2},Mn.M.get=function(){return 3},Lt.prototype.setOrdinate=function(u,h,y){},Lt.prototype.size=function(){},Lt.prototype.getOrdinate=function(u,h){},Lt.prototype.getCoordinate=function(){},Lt.prototype.getCoordinateCopy=function(u){},Lt.prototype.getDimension=function(){},Lt.prototype.getX=function(u){},Lt.prototype.clone=function(){},Lt.prototype.expandEnvelope=function(u){},Lt.prototype.copy=function(){},Lt.prototype.getY=function(u){},Lt.prototype.toCoordinateArray=function(){},Lt.prototype.interfaces_=function(){return[se]},Lt.prototype.getClass=function(){return Lt},Object.defineProperties(Lt,Mn);var Rn=function(){},Bn=function(u){function h(){u.call(this,"Projective point not representable on the Cartesian plane.")}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Rn),vn=function(){};vn.arraycopy=function(u,h,y,x,T){for(var k=0,G=h;G<h+T;G++)y[x+k]=u[G],k++},vn.getProperty=function(u){return{"line.separator":"\n"}[u]};var Sn=function u(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var h=arguments[0];this.x=h.x,this.y=h.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var x=arguments[1];this.x=arguments[0],this.y=x,this.w=1}else if(arguments[0]instanceof u&&arguments[1]instanceof u){var T=arguments[0],k=arguments[1];this.x=T.y*k.w-k.y*T.w,this.y=k.x*T.w-T.x*k.w,this.w=T.x*k.y-k.x*T.y}else if(arguments[0]instanceof J&&arguments[1]instanceof J){var G=arguments[0],K=arguments[1];this.x=G.y-K.y,this.y=K.x-G.x,this.w=G.x*K.y-K.x*G.y}}else if(3===arguments.length){var et=arguments[1],Ft=arguments[2];this.x=arguments[0],this.y=et,this.w=Ft}else if(4===arguments.length){var $t=arguments[0],gt=arguments[1],nn=arguments[2],Un=arguments[3],Qn=$t.y-gt.y,Sr=gt.x-$t.x,Bo=$t.x*gt.y-gt.x*$t.y,xs=nn.y-Un.y,Ss=Un.x-nn.x,Va=nn.x*Un.y-Un.x*nn.y;this.x=Sr*Va-Ss*Bo,this.y=xs*Bo-Qn*Va,this.w=Qn*Ss-xs*Sr}};Sn.prototype.getY=function(){var u=this.y/this.w;if(ce.isNaN(u)||ce.isInfinite(u))throw new Bn;return u},Sn.prototype.getX=function(){var u=this.x/this.w;if(ce.isNaN(u)||ce.isInfinite(u))throw new Bn;return u},Sn.prototype.getCoordinate=function(){var u=new J;return u.x=this.getX(),u.y=this.getY(),u},Sn.prototype.interfaces_=function(){return[]},Sn.prototype.getClass=function(){return Sn},Sn.intersection=function(u,h,y,x){var T=u.y-h.y,k=h.x-u.x,G=u.x*h.y-h.x*u.y,K=y.y-x.y,re=x.x-y.x,et=y.x*x.y-x.x*y.y,Ft=T*re-K*k,$t=(k*et-re*G)/Ft,gt=(K*G-T*et)/Ft;if(ce.isNaN($t)||ce.isInfinite($t)||ce.isNaN(gt)||ce.isInfinite(gt))throw new Bn;return new J($t,gt)};var hn=function u(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof J){var h=arguments[0];this.init(h.x,h.x,h.y,h.y)}else arguments[0]instanceof u&&this.init(arguments[0]);else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.init(x.x,T.x,x.y,T.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Jn={serialVersionUID:{configurable:!0}};hn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},hn.prototype.equals=function(u){if(!(u instanceof hn))return!1;var h=u;return this.isNull()?h.isNull():this._maxx===h.getMaxX()&&this._maxy===h.getMaxY()&&this._minx===h.getMinX()&&this._miny===h.getMinY()},hn.prototype.intersection=function(u){return this.isNull()||u.isNull()||!this.intersects(u)?new hn:new hn(this._minx>u._minx?this._minx:u._minx,this._maxx<u._maxx?this._maxx:u._maxx,this._miny>u._miny?this._miny:u._miny,this._maxy<u._maxy?this._maxy:u._maxy)},hn.prototype.isNull=function(){return this._maxx<this._minx},hn.prototype.getMaxX=function(){return this._maxx},hn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];return this.covers(u.x,u.y)}if(arguments[0]instanceof hn){var h=arguments[0];return!this.isNull()&&!h.isNull()&&h.getMinX()>=this._minx&&h.getMaxX()<=this._maxx&&h.getMinY()>=this._miny&&h.getMaxY()<=this._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&y>=this._minx&&y<=this._maxx&&x>=this._miny&&x<=this._maxy}},hn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof hn){var u=arguments[0];return!this.isNull()&&!u.isNull()&&!(u._minx>this._maxx||u._maxx<this._minx||u._miny>this._maxy||u._maxy<this._miny)}if(arguments[0]instanceof J){var h=arguments[0];return this.intersects(h.x,h.y)}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return!this.isNull()&&!(y>this._maxx||y<this._minx||x>this._maxy||x<this._miny)}},hn.prototype.getMinY=function(){return this._miny},hn.prototype.getMinX=function(){return this._minx},hn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];this.expandToInclude(u.x,u.y)}else if(arguments[0]instanceof hn){var h=arguments[0];if(h.isNull())return null;this.isNull()?(this._minx=h.getMinX(),this._maxx=h.getMaxX(),this._miny=h.getMinY(),this._maxy=h.getMaxY()):(h._minx<this._minx&&(this._minx=h._minx),h._maxx>this._maxx&&(this._maxx=h._maxx),h._miny<this._miny&&(this._miny=h._miny),h._maxy>this._maxy&&(this._maxy=h._maxy))}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.isNull()?(this._minx=y,this._maxx=y,this._miny=x,this._maxy=x):(y<this._minx&&(this._minx=y),y>this._maxx&&(this._maxx=y),x<this._miny&&(this._miny=x),x>this._maxy&&(this._maxy=x))}},hn.prototype.minExtent=function(){if(this.isNull())return 0;var u=this.getWidth(),h=this.getHeight();return u<h?u:h},hn.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx},hn.prototype.compareTo=function(u){var h=u;return this.isNull()?h.isNull()?0:-1:h.isNull()?1:this._minx<h._minx?-1:this._minx>h._minx?1:this._miny<h._miny?-1:this._miny>h._miny?1:this._maxx<h._maxx?-1:this._maxx>h._maxx?1:this._maxy<h._maxy?-1:this._maxy>h._maxy?1:0},hn.prototype.translate=function(u,h){if(this.isNull())return null;this.init(this.getMinX()+u,this.getMaxX()+u,this.getMinY()+h,this.getMaxY()+h)},hn.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"},hn.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1},hn.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny},hn.prototype.maxExtent=function(){if(this.isNull())return 0;var u=this.getWidth(),h=this.getHeight();return u>h?u:h},hn.prototype.expandBy=function(){if(1===arguments.length){var u=arguments[0];this.expandBy(u,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this.isNull())return null;this._minx-=h,this._maxx+=h,this._miny-=y,this._maxy+=y,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}},hn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof hn)return this.covers(arguments[0]);if(arguments[0]instanceof J)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},hn.prototype.centre=function(){return this.isNull()?null:new J((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},hn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];this.init(u.x,u.x,u.y,u.y)}else if(arguments[0]instanceof hn){var h=arguments[0];this._minx=h._minx,this._maxx=h._maxx,this._miny=h._miny,this._maxy=h._maxy}}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this.init(y.x,x.x,y.y,x.y)}else if(4===arguments.length){var T=arguments[0],k=arguments[1],G=arguments[2],K=arguments[3];T<k?(this._minx=T,this._maxx=k):(this._minx=k,this._maxx=T),G<K?(this._miny=G,this._maxy=K):(this._miny=K,this._maxy=G)}},hn.prototype.getMaxY=function(){return this._maxy},hn.prototype.distance=function(u){if(this.intersects(u))return 0;var h=0;this._maxx<u._minx?h=u._minx-this._maxx:this._minx>u._maxx&&(h=this._minx-u._maxx);var y=0;return this._maxy<u._miny?y=u._miny-this._maxy:this._miny>u._maxy&&(y=this._miny-u._maxy),0===h?y:0===y?h:Math.sqrt(h*h+y*y)},hn.prototype.hashCode=function(){var u=17;return 37*(u=37*(u=37*(u=37*u+J.hashCode(this._minx))+J.hashCode(this._maxx))+J.hashCode(this._miny))+J.hashCode(this._maxy)},hn.prototype.interfaces_=function(){return[de,Ee]},hn.prototype.getClass=function(){return hn},hn.intersects=function(){if(3===arguments.length){var u=arguments[0],h=arguments[1],y=arguments[2];return y.x>=(u.x<h.x?u.x:h.x)&&y.x<=(u.x>h.x?u.x:h.x)&&y.y>=(u.y<h.y?u.y:h.y)&&y.y<=(u.y>h.y?u.y:h.y)}if(4===arguments.length){var x=arguments[0],T=arguments[1],k=arguments[2],G=arguments[3],K=Math.min(k.x,G.x),re=Math.max(k.x,G.x),et=Math.min(x.x,T.x),Ft=Math.max(x.x,T.x);return!(et>re||Ft<K||(K=Math.min(k.y,G.y),re=Math.max(k.y,G.y),et=Math.min(x.y,T.y),Ft=Math.max(x.y,T.y),et>re||Ft<K))}},Jn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(hn,Jn);var ti={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},io=function(u){this.geometryFactory=u||new pr};io.prototype.read=function(u){var h,y;u=u.replace(/[\n\r]/g," ");var T=ti.typeStr.exec(u);if(-1!==u.search("EMPTY")&&((T=ti.emptyTypeStr.exec(u))[2]=void 0),T&&(y=T[1].toLowerCase(),hr[y]&&(h=hr[y].apply(this,[T[2]]))),void 0===h)throw new Error("Could not parse WKT "+u);return h},io.prototype.write=function(u){return this.extractGeometry(u)},io.prototype.extractGeometry=function(u){var h=u.getGeometryType().toLowerCase();if(!Zn[h])return null;var y=h.toUpperCase();return u.isEmpty()?y+" EMPTY":y+"("+Zn[h].apply(this,[u])+")"};var Zn={coordinate:function(u){return u.x+" "+u.y},point:function(u){return Zn.coordinate.call(this,u._coordinates._coordinates[0])},multipoint:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+Zn.point.apply(this,[u._geometries[y]])+")");return h.join(",")},linestring:function(u){for(var h=[],y=0,x=u._points._coordinates.length;y<x;++y)h.push(Zn.coordinate.apply(this,[u._points._coordinates[y]]));return h.join(",")},linearring:function(u){for(var h=[],y=0,x=u._points._coordinates.length;y<x;++y)h.push(Zn.coordinate.apply(this,[u._points._coordinates[y]]));return h.join(",")},multilinestring:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+Zn.linestring.apply(this,[u._geometries[y]])+")");return h.join(",")},polygon:function(u){var h=[];h.push("("+Zn.linestring.apply(this,[u._shell])+")");for(var y=0,x=u._holes.length;y<x;++y)h.push("("+Zn.linestring.apply(this,[u._holes[y]])+")");return h.join(",")},multipolygon:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push("("+Zn.polygon.apply(this,[u._geometries[y]])+")");return h.join(",")},geometrycollection:function(u){for(var h=[],y=0,x=u._geometries.length;y<x;++y)h.push(this.extractGeometry(u._geometries[y]));return h.join(",")}},hr={point:function(u){if(void 0===u)return this.geometryFactory.createPoint();var h=u.trim().split(ti.spaces);return this.geometryFactory.createPoint(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])))},multipoint:function(u){if(void 0===u)return this.geometryFactory.createMultiPoint();for(var h,y=u.trim().split(","),x=[],T=0,k=y.length;T<k;++T)h=y[T].replace(ti.trimParens,"$1"),x.push(hr.point.apply(this,[h]));return this.geometryFactory.createMultiPoint(x)},linestring:function(u){if(void 0===u)return this.geometryFactory.createLineString();for(var h,y=u.trim().split(","),x=[],T=0,k=y.length;T<k;++T)h=y[T].trim().split(ti.spaces),x.push(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLineString(x)},linearring:function(u){if(void 0===u)return this.geometryFactory.createLinearRing();for(var h,y=u.trim().split(","),x=[],T=0,k=y.length;T<k;++T)h=y[T].trim().split(ti.spaces),x.push(new J(Number.parseFloat(h[0]),Number.parseFloat(h[1])));return this.geometryFactory.createLinearRing(x)},multilinestring:function(u){if(void 0===u)return this.geometryFactory.createMultiLineString();for(var h,y=u.trim().split(ti.parenComma),x=[],T=0,k=y.length;T<k;++T)h=y[T].replace(ti.trimParens,"$1"),x.push(hr.linestring.apply(this,[h]));return this.geometryFactory.createMultiLineString(x)},polygon:function(u){if(void 0===u)return this.geometryFactory.createPolygon();for(var h,y,x,T,k=u.trim().split(ti.parenComma),G=[],K=0,re=k.length;K<re;++K)h=k[K].replace(ti.trimParens,"$1"),y=hr.linestring.apply(this,[h]),x=this.geometryFactory.createLinearRing(y._points),0===K?T=x:G.push(x);return this.geometryFactory.createPolygon(T,G)},multipolygon:function(u){if(void 0===u)return this.geometryFactory.createMultiPolygon();for(var h,y=u.trim().split(ti.doubleParenComma),x=[],T=0,k=y.length;T<k;++T)h=y[T].replace(ti.trimParens,"$1"),x.push(hr.polygon.apply(this,[h]));return this.geometryFactory.createMultiPolygon(x)},geometrycollection:function(u){if(void 0===u)return this.geometryFactory.createGeometryCollection();for(var h=(u=u.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),y=[],x=0,T=h.length;x<T;++x)y.push(this.read(h[x]));return this.geometryFactory.createGeometryCollection(y)}},_t=function(u){this.parser=new io(u)};_t.prototype.write=function(u){return this.parser.write(u)},_t.toLineString=function(u,h){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+u.x+" "+u.y+", "+h.x+" "+h.y+" )"};var ye=function(u){function h(y){u.call(this,y),this.name="RuntimeException",this.message=y,this.stack=(new u).stack}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(Error),fe=function(u){function h(){u.call(this),0===arguments.length?u.call(this):1===arguments.length&&u.call(this,arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ye),ae=function(){};ae.prototype.interfaces_=function(){return[]},ae.prototype.getClass=function(){return ae},ae.shouldNeverReachHere=function(){if(0===arguments.length)ae.shouldNeverReachHere(null);else if(1===arguments.length){var u=arguments[0];throw new fe("Should never reach here"+(null!==u?": "+u:""))}},ae.isTrue=function(){var h;if(1===arguments.length)ae.isTrue(arguments[0],null);else if(2===arguments.length&&(h=arguments[1],!arguments[0]))throw null===h?new fe:new fe(h)},ae.equals=function(){var u,h,y;if(2===arguments.length)ae.equals(u=arguments[0],h=arguments[1],null);else if(3===arguments.length&&(y=arguments[2],!(h=arguments[1]).equals(u=arguments[0])))throw new fe("Expected "+u+" but encountered "+h+(null!==y?": "+y:""))};var ze=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new J,this._intPt[1]=new J,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},ht={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ze.prototype.getIndexAlongSegment=function(u,h){return this.computeIntLineIndex(),this._intLineIndex[u][h]},ze.prototype.getTopologySummary=function(){var u=new Me;return this.isEndPoint()&&u.append(" endpoint"),this._isProper&&u.append(" proper"),this.isCollinear()&&u.append(" collinear"),u.toString()},ze.prototype.computeIntersection=function(u,h,y,x){this._inputLines[0][0]=u,this._inputLines[0][1]=h,this._inputLines[1][0]=y,this._inputLines[1][1]=x,this._result=this.computeIntersect(u,h,y,x)},ze.prototype.getIntersectionNum=function(){return this._result},ze.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this._intLineIndex&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var u=arguments[0];this.getEdgeDistance(u,0)>this.getEdgeDistance(u,1)?(this._intLineIndex[u][0]=0,this._intLineIndex[u][1]=1):(this._intLineIndex[u][0]=1,this._intLineIndex[u][1]=0)}},ze.prototype.isProper=function(){return this.hasIntersection()&&this._isProper},ze.prototype.setPrecisionModel=function(u){this._precisionModel=u},ze.prototype.isInteriorIntersection=function(){if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var u=arguments[0],h=0;h<this._result;h++)if(!this._intPt[h].equals2D(this._inputLines[u][0])&&!this._intPt[h].equals2D(this._inputLines[u][1]))return!0;return!1}},ze.prototype.getIntersection=function(u){return this._intPt[u]},ze.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper},ze.prototype.hasIntersection=function(){return this._result!==ze.NO_INTERSECTION},ze.prototype.getEdgeDistance=function(u,h){return ze.computeEdgeDistance(this._intPt[h],this._inputLines[u][0],this._inputLines[u][1])},ze.prototype.isCollinear=function(){return this._result===ze.COLLINEAR_INTERSECTION},ze.prototype.toString=function(){return _t.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+_t.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()},ze.prototype.getEndpoint=function(u,h){return this._inputLines[u][h]},ze.prototype.isIntersection=function(u){for(var h=0;h<this._result;h++)if(this._intPt[h].equals2D(u))return!0;return!1},ze.prototype.getIntersectionAlongSegment=function(u,h){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[u][h]]},ze.prototype.interfaces_=function(){return[]},ze.prototype.getClass=function(){return ze},ze.computeEdgeDistance=function(u,h,y){var x=Math.abs(y.x-h.x),T=Math.abs(y.y-h.y),k=-1;if(u.equals(h))k=0;else if(u.equals(y))k=x>T?x:T;else{var G=Math.abs(u.x-h.x),K=Math.abs(u.y-h.y);0!==(k=x>T?G:K)||u.equals(h)||(k=Math.max(G,K))}return ae.isTrue(!(0===k&&!u.equals(h)),"Bad distance calculation"),k},ze.nonRobustComputeEdgeDistance=function(u,h,y){var x=u.x-h.x,T=u.y-h.y,k=Math.sqrt(x*x+T*T);return ae.isTrue(!(0===k&&!u.equals(h)),"Invalid distance calculation"),k},ht.DONT_INTERSECT.get=function(){return 0},ht.DO_INTERSECT.get=function(){return 1},ht.COLLINEAR.get=function(){return 2},ht.NO_INTERSECTION.get=function(){return 0},ht.POINT_INTERSECTION.get=function(){return 1},ht.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(ze,ht);var Bt=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isInSegmentEnvelopes=function(y){var x=new hn(this._inputLines[0][0],this._inputLines[0][1]),T=new hn(this._inputLines[1][0],this._inputLines[1][1]);return x.contains(y)&&T.contains(y)},h.prototype.computeIntersection=function(){if(3!==arguments.length)return u.prototype.computeIntersection.apply(this,arguments);var y=arguments[0],x=arguments[1],T=arguments[2];if(this._isProper=!1,hn.intersects(x,T,y)&&0===Gt.orientationIndex(x,T,y)&&0===Gt.orientationIndex(T,x,y))return this._isProper=!0,(y.equals(x)||y.equals(T))&&(this._isProper=!1),this._result=u.POINT_INTERSECTION,null;this._result=u.NO_INTERSECTION},h.prototype.normalizeToMinimum=function(y,x,T,k,G){G.x=this.smallestInAbsValue(y.x,x.x,T.x,k.x),G.y=this.smallestInAbsValue(y.y,x.y,T.y,k.y),y.x-=G.x,y.y-=G.y,x.x-=G.x,x.y-=G.y,T.x-=G.x,T.y-=G.y,k.x-=G.x,k.y-=G.y},h.prototype.safeHCoordinateIntersection=function(y,x,T,k){var G=null;try{G=Sn.intersection(y,x,T,k)}catch(K){if(!(K instanceof Bn))throw K;G=h.nearestEndpoint(y,x,T,k)}return G},h.prototype.intersection=function(y,x,T,k){var G=this.intersectionWithNormalization(y,x,T,k);return this.isInSegmentEnvelopes(G)||(G=new J(h.nearestEndpoint(y,x,T,k))),null!==this._precisionModel&&this._precisionModel.makePrecise(G),G},h.prototype.smallestInAbsValue=function(y,x,T,k){var G=y,K=Math.abs(G);return Math.abs(x)<K&&(G=x,K=Math.abs(x)),Math.abs(T)<K&&(G=T,K=Math.abs(T)),Math.abs(k)<K&&(G=k),G},h.prototype.checkDD=function(y,x,T,k,G){var K=Nt.intersection(y,x,T,k),re=this.isInSegmentEnvelopes(K);vn.out.println("DD in env = "+re+"  --------------------- "+K),G.distance(K)>1e-4&&vn.out.println("Distance = "+G.distance(K))},h.prototype.intersectionWithNormalization=function(y,x,T,k){var G=new J(y),K=new J(x),re=new J(T),et=new J(k),Ft=new J;this.normalizeToEnvCentre(G,K,re,et,Ft);var $t=this.safeHCoordinateIntersection(G,K,re,et);return $t.x+=Ft.x,$t.y+=Ft.y,$t},h.prototype.computeCollinearIntersection=function(y,x,T,k){var G=hn.intersects(y,x,T),K=hn.intersects(y,x,k),re=hn.intersects(T,k,y),et=hn.intersects(T,k,x);return G&&K?(this._intPt[0]=T,this._intPt[1]=k,u.COLLINEAR_INTERSECTION):re&&et?(this._intPt[0]=y,this._intPt[1]=x,u.COLLINEAR_INTERSECTION):G&&re?(this._intPt[0]=T,this._intPt[1]=y,!T.equals(y)||K||et?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):G&&et?(this._intPt[0]=T,this._intPt[1]=x,!T.equals(x)||K||re?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):K&&re?(this._intPt[0]=k,this._intPt[1]=y,!k.equals(y)||G||et?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):K&&et?(this._intPt[0]=k,this._intPt[1]=x,!k.equals(x)||G||re?u.COLLINEAR_INTERSECTION:u.POINT_INTERSECTION):u.NO_INTERSECTION},h.prototype.normalizeToEnvCentre=function(y,x,T,k,G){var K=y.x<x.x?y.x:x.x,re=y.y<x.y?y.y:x.y,et=y.x>x.x?y.x:x.x,Ft=y.y>x.y?y.y:x.y,$t=T.x<k.x?T.x:k.x,gt=T.y<k.y?T.y:k.y,nn=T.x>k.x?T.x:k.x,Un=T.y>k.y?T.y:k.y,Sr=((re>gt?re:gt)+(Ft<Un?Ft:Un))/2;G.x=((K>$t?K:$t)+(et<nn?et:nn))/2,G.y=Sr,y.x-=G.x,y.y-=G.y,x.x-=G.x,x.y-=G.y,T.x-=G.x,T.y-=G.y,k.x-=G.x,k.y-=G.y},h.prototype.computeIntersect=function(y,x,T,k){if(this._isProper=!1,!hn.intersects(y,x,T,k))return u.NO_INTERSECTION;var G=Gt.orientationIndex(y,x,T),K=Gt.orientationIndex(y,x,k);if(G>0&&K>0||G<0&&K<0)return u.NO_INTERSECTION;var re=Gt.orientationIndex(T,k,y),et=Gt.orientationIndex(T,k,x);return re>0&&et>0||re<0&&et<0?u.NO_INTERSECTION:0===G&&0===K&&0===re&&0===et?this.computeCollinearIntersection(y,x,T,k):(0===G||0===K||0===re||0===et?(this._isProper=!1,y.equals2D(T)||y.equals2D(k)?this._intPt[0]=y:x.equals2D(T)||x.equals2D(k)?this._intPt[0]=x:0===G?this._intPt[0]=new J(T):0===K?this._intPt[0]=new J(k):0===re?this._intPt[0]=new J(y):0===et&&(this._intPt[0]=new J(x))):(this._isProper=!0,this._intPt[0]=this.intersection(y,x,T,k)),u.POINT_INTERSECTION)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.nearestEndpoint=function(y,x,T,k){var G=y,K=Gt.distancePointLine(y,T,k),re=Gt.distancePointLine(x,T,k);return re<K&&(K=re,G=x),(re=Gt.distancePointLine(T,y,x))<K&&(K=re,G=T),(re=Gt.distancePointLine(k,y,x))<K&&(K=re,G=k),G},h}(ze),on=function(){};on.prototype.interfaces_=function(){return[]},on.prototype.getClass=function(){return on},on.orientationIndex=function(u,h,y){return on.signOfDet2x2(h.x-u.x,h.y-u.y,y.x-h.x,y.y-h.y)},on.signOfDet2x2=function(u,h,y,x){var T=null,k=null,G=null;if(T=1,0===u||0===x)return 0===h||0===y?0:h>0?y>0?-T:T:y>0?T:-T;if(0===h||0===y)return x>0?u>0?T:-T:u>0?-T:T;if(h>0?x>0?h<=x||(T=-T,k=u,u=y,y=k,k=h,h=x,x=k):h<=-x?(T=-T,y=-y,x=-x):(k=u,u=-y,y=k,k=h,h=-x,x=k):x>0?-h<=x?(T=-T,u=-u,h=-h):(k=-u,u=y,y=k,k=-h,h=x,x=k):h>=x?(u=-u,h=-h,y=-y,x=-x):(T=-T,k=-u,u=-y,y=k,k=-h,h=-x,x=k),u>0){if(!(y>0&&u<=y))return T}else{if(y>0||!(u>=y))return-T;T=-T,u=-u,y=-y}for(;;){if((x-=(G=Math.floor(y/u))*h)<0)return-T;if(x>h)return T;if(u>(y-=G*u)+y){if(h<x+x)return T}else{if(h>x+x)return-T;y=u-y,x=h-x,T=-T}if(0===x)return 0===y?0:-T;if(0===y||(u-=(G=Math.floor(u/y))*y,(h-=G*x)<0))return T;if(h>x)return-T;if(y>u+u){if(x<h+h)return-T}else{if(x>h+h)return T;u=y-u,h=x-h,T=-T}if(0===h)return 0===u?0:T;if(0===u)return-T}};var sn=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1,this._p=arguments[0]};sn.prototype.countSegment=function(u,h){if(u.x<this._p.x&&h.x<this._p.x)return null;if(this._p.x===h.x&&this._p.y===h.y)return this._isPointOnSegment=!0,null;if(u.y===this._p.y&&h.y===this._p.y){var y=u.x,x=h.x;return y>x&&(y=h.x,x=u.x),this._p.x>=y&&this._p.x<=x&&(this._isPointOnSegment=!0),null}if(u.y>this._p.y&&h.y<=this._p.y||h.y>this._p.y&&u.y<=this._p.y){var k=u.y-this._p.y,K=h.y-this._p.y,re=on.signOfDet2x2(u.x-this._p.x,k,h.x-this._p.x,K);if(0===re)return this._isPointOnSegment=!0,null;K<k&&(re=-re),re>0&&this._crossingCount++}},sn.prototype.isPointInPolygon=function(){return this.getLocation()!==ue.EXTERIOR},sn.prototype.getLocation=function(){return this._isPointOnSegment?ue.BOUNDARY:this._crossingCount%2==1?ue.INTERIOR:ue.EXTERIOR},sn.prototype.isOnSegment=function(){return this._isPointOnSegment},sn.prototype.interfaces_=function(){return[]},sn.prototype.getClass=function(){return sn},sn.locatePointInRing=function(){if(arguments[0]instanceof J&&At(arguments[1],Lt)){for(var h=arguments[1],y=new sn(arguments[0]),x=new J,T=new J,k=1;k<h.size();k++)if(h.getCoordinate(k,x),h.getCoordinate(k-1,T),y.countSegment(x,T),y.isOnSegment())return y.getLocation();return y.getLocation()}if(arguments[0]instanceof J&&arguments[1]instanceof Array){for(var K=arguments[1],re=new sn(arguments[0]),et=1;et<K.length;et++)if(re.countSegment(K[et],K[et-1]),re.isOnSegment())return re.getLocation();return re.getLocation()}};var Gt=function(){},ur={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Gt.prototype.interfaces_=function(){return[]},Gt.prototype.getClass=function(){return Gt},Gt.orientationIndex=function(u,h,y){return Nt.orientationIndex(u,h,y)},Gt.signedArea=function(){if(arguments[0]instanceof Array){var u=arguments[0];if(u.length<3)return 0;for(var h=0,y=u[0].x,x=1;x<u.length-1;x++)h+=(u[x].x-y)*(u[x-1].y-u[x+1].y);return h/2}if(At(arguments[0],Lt)){var G=arguments[0],K=G.size();if(K<3)return 0;var re=new J,et=new J,Ft=new J;G.getCoordinate(0,et),G.getCoordinate(1,Ft);var $t=et.x;Ft.x-=$t;for(var gt=0,nn=1;nn<K-1;nn++)re.y=et.y,et.x=Ft.x,et.y=Ft.y,G.getCoordinate(nn+1,Ft),Ft.x-=$t,gt+=et.x*(re.y-Ft.y);return gt/2}},Gt.distanceLineLine=function(u,h,y,x){if(u.equals(h))return Gt.distancePointLine(u,y,x);if(y.equals(x))return Gt.distancePointLine(x,u,h);var T=!1;if(hn.intersects(u,h,y,x)){var k=(h.x-u.x)*(x.y-y.y)-(h.y-u.y)*(x.x-y.x);if(0===k)T=!0;else{var K=((u.y-y.y)*(h.x-u.x)-(u.x-y.x)*(h.y-u.y))/k,re=((u.y-y.y)*(x.x-y.x)-(u.x-y.x)*(x.y-y.y))/k;(re<0||re>1||K<0||K>1)&&(T=!0)}}else T=!0;return T?Pe.min(Gt.distancePointLine(u,y,x),Gt.distancePointLine(h,y,x),Gt.distancePointLine(y,u,h),Gt.distancePointLine(x,u,h)):0},Gt.isPointInRing=function(u,h){return Gt.locatePointInRing(u,h)!==ue.EXTERIOR},Gt.computeLength=function(u){var h=u.size();if(h<=1)return 0;var y=0,x=new J;u.getCoordinate(0,x);for(var T=x.x,k=x.y,G=1;G<h;G++){u.getCoordinate(G,x);var K=x.x,re=x.y,et=K-T,Ft=re-k;y+=Math.sqrt(et*et+Ft*Ft),T=K,k=re}return y},Gt.isCCW=function(u){var h=u.length-1;if(h<3)throw new Y("Ring has fewer than 4 points, so orientation cannot be determined");for(var y=u[0],x=0,T=1;T<=h;T++){var k=u[T];k.y>y.y&&(y=k,x=T)}var G=x;do{(G-=1)<0&&(G=h)}while(u[G].equals2D(y)&&G!==x);var K=x;do{K=(K+1)%h}while(u[K].equals2D(y)&&K!==x);var re=u[G],et=u[K];if(re.equals2D(y)||et.equals2D(y)||re.equals2D(et))return!1;var Ft=Gt.computeOrientation(re,y,et);return 0===Ft?re.x>et.x:Ft>0},Gt.locatePointInRing=function(u,h){return sn.locatePointInRing(u,h)},Gt.distancePointLinePerpendicular=function(u,h,y){var x=(y.x-h.x)*(y.x-h.x)+(y.y-h.y)*(y.y-h.y);return Math.abs(((h.y-u.y)*(y.x-h.x)-(h.x-u.x)*(y.y-h.y))/x)*Math.sqrt(x)},Gt.computeOrientation=function(u,h,y){return Gt.orientationIndex(u,h,y)},Gt.distancePointLine=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];if(0===h.length)throw new Y("Line array must contain at least one vertex");for(var y=u.distance(h[0]),x=0;x<h.length-1;x++){var T=Gt.distancePointLine(u,h[x],h[x+1]);T<y&&(y=T)}return y}if(3===arguments.length){var k=arguments[0],G=arguments[1],K=arguments[2];if(G.x===K.x&&G.y===K.y)return k.distance(G);var re=(K.x-G.x)*(K.x-G.x)+(K.y-G.y)*(K.y-G.y),et=((k.x-G.x)*(K.x-G.x)+(k.y-G.y)*(K.y-G.y))/re;return et<=0?k.distance(G):et>=1?k.distance(K):Math.abs(((G.y-k.y)*(K.x-G.x)-(G.x-k.x)*(K.y-G.y))/re)*Math.sqrt(re)}},Gt.isOnLine=function(u,h){for(var y=new Bt,x=1;x<h.length;x++)if(y.computeIntersection(u,h[x-1],h[x]),y.hasIntersection())return!0;return!1},ur.CLOCKWISE.get=function(){return-1},ur.RIGHT.get=function(){return Gt.CLOCKWISE},ur.COUNTERCLOCKWISE.get=function(){return 1},ur.LEFT.get=function(){return Gt.COUNTERCLOCKWISE},ur.COLLINEAR.get=function(){return 0},ur.STRAIGHT.get=function(){return Gt.COLLINEAR},Object.defineProperties(Gt,ur);var lr=function(){};lr.prototype.filter=function(u){},lr.prototype.interfaces_=function(){return[]},lr.prototype.getClass=function(){return lr};var En=function(){var u=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=u,this._SRID=u.getSRID()},Cr={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};En.prototype.isGeometryCollection=function(){return this.getSortIndex()===En.SORTINDEX_GEOMETRYCOLLECTION},En.prototype.getFactory=function(){return this._factory},En.prototype.getGeometryN=function(u){return this},En.prototype.getArea=function(){return 0},En.prototype.isRectangle=function(){return!1},En.prototype.equals=function(){if(arguments[0]instanceof En){var u=arguments[0];return null!==u&&this.equalsTopo(u)}if(arguments[0]instanceof Object){var h=arguments[0];return h instanceof En&&this.equalsExact(h)}},En.prototype.equalsExact=function(u){return this===u||this.equalsExact(u,0)},En.prototype.geometryChanged=function(){this.apply(En.geometryChangedFilter)},En.prototype.geometryChangedAction=function(){this._envelope=null},En.prototype.equalsNorm=function(u){return null!==u&&this.norm().equalsExact(u.norm())},En.prototype.getLength=function(){return 0},En.prototype.getNumGeometries=function(){return 1},En.prototype.compareTo=function(){if(1===arguments.length){var u=arguments[0],h=u;return this.getSortIndex()!==h.getSortIndex()?this.getSortIndex()-h.getSortIndex():this.isEmpty()&&h.isEmpty()?0:this.isEmpty()?-1:h.isEmpty()?1:this.compareToSameClass(u)}if(2===arguments.length){var y=arguments[0],x=arguments[1];return this.getSortIndex()!==y.getSortIndex()?this.getSortIndex()-y.getSortIndex():this.isEmpty()&&y.isEmpty()?0:this.isEmpty()?-1:y.isEmpty()?1:this.compareToSameClass(y,x)}},En.prototype.getUserData=function(){return this._userData},En.prototype.getSRID=function(){return this._SRID},En.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},En.prototype.checkNotGeometryCollection=function(u){if(u.getSortIndex()===En.SORTINDEX_GEOMETRYCOLLECTION)throw new Y("This method does not support GeometryCollection arguments")},En.prototype.equal=function(u,h,y){return 0===y?u.equals(h):u.distance(h)<=y},En.prototype.norm=function(){var u=this.copy();return u.normalize(),u},En.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()},En.prototype.getEnvelopeInternal=function(){return null===this._envelope&&(this._envelope=this.computeEnvelopeInternal()),new hn(this._envelope)},En.prototype.setSRID=function(u){this._SRID=u},En.prototype.setUserData=function(u){this._userData=u},En.prototype.compare=function(u,h){for(var y=u.iterator(),x=h.iterator();y.hasNext()&&x.hasNext();){var T=y.next(),k=x.next(),G=T.compareTo(k);if(0!==G)return G}return y.hasNext()?1:x.hasNext()?-1:0},En.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},En.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===En.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===En.SORTINDEX_MULTIPOINT||this.getSortIndex()===En.SORTINDEX_MULTILINESTRING||this.getSortIndex()===En.SORTINDEX_MULTIPOLYGON},En.prototype.interfaces_=function(){return[se,de,Ee]},En.prototype.getClass=function(){return En},En.hasNonEmptyElements=function(u){for(var h=0;h<u.length;h++)if(!u[h].isEmpty())return!0;return!1},En.hasNullElements=function(u){for(var h=0;h<u.length;h++)if(null===u[h])return!0;return!1},Cr.serialVersionUID.get=function(){return 0x799ea46522854c00},Cr.SORTINDEX_POINT.get=function(){return 0},Cr.SORTINDEX_MULTIPOINT.get=function(){return 1},Cr.SORTINDEX_LINESTRING.get=function(){return 2},Cr.SORTINDEX_LINEARRING.get=function(){return 3},Cr.SORTINDEX_MULTILINESTRING.get=function(){return 4},Cr.SORTINDEX_POLYGON.get=function(){return 5},Cr.SORTINDEX_MULTIPOLYGON.get=function(){return 6},Cr.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},Cr.geometryChangedFilter.get=function(){return Ei},Object.defineProperties(En,Cr);var Ei=function(){};Ei.interfaces_=function(){return[lr]},Ei.filter=function(u){u.geometryChangedAction()};var qr=function(){};qr.prototype.filter=function(u){},qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr};var ui=function(){},Do={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};ui.prototype.isInBoundary=function(u){},ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},Do.Mod2BoundaryNodeRule.get=function(){return jo},Do.EndPointBoundaryNodeRule.get=function(){return es},Do.MultiValentEndPointBoundaryNodeRule.get=function(){return wo},Do.MonoValentEndPointBoundaryNodeRule.get=function(){return ds},Do.MOD2_BOUNDARY_RULE.get=function(){return new jo},Do.ENDPOINT_BOUNDARY_RULE.get=function(){return new es},Do.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new wo},Do.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ds},Do.OGC_SFS_BOUNDARY_RULE.get=function(){return ui.MOD2_BOUNDARY_RULE},Object.defineProperties(ui,Do);var jo=function(){};jo.prototype.isInBoundary=function(u){return u%2==1},jo.prototype.interfaces_=function(){return[ui]},jo.prototype.getClass=function(){return jo};var es=function(){};es.prototype.isInBoundary=function(u){return u>0},es.prototype.interfaces_=function(){return[ui]},es.prototype.getClass=function(){return es};var wo=function(){};wo.prototype.isInBoundary=function(u){return u>1},wo.prototype.interfaces_=function(){return[ui]},wo.prototype.getClass=function(){return wo};var ds=function(){};ds.prototype.isInBoundary=function(u){return 1===u},ds.prototype.interfaces_=function(){return[ui]},ds.prototype.getClass=function(){return ds};var oi=function(){};oi.prototype.add=function(){},oi.prototype.addAll=function(){},oi.prototype.isEmpty=function(){},oi.prototype.iterator=function(){},oi.prototype.size=function(){},oi.prototype.toArray=function(){},oi.prototype.remove=function(){},(Fe.prototype=new Error).name="IndexOutOfBoundsException";var As=function(){};As.prototype.hasNext=function(){},As.prototype.next=function(){},As.prototype.remove=function(){};var ts=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.get=function(){},h.prototype.set=function(){},h.prototype.isEmpty=function(){},h}(oi);(lt.prototype=new Error).name="NoSuchElementException";var gn=function(u){function h(){u.call(this),this.array_=[],arguments[0]instanceof oi&&this.addAll(arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.ensureCapacity=function(){},h.prototype.interfaces_=function(){return[u,oi]},h.prototype.add=function(y){return 1===arguments.length?this.array_.push(y):this.array_.splice(arguments[0],arguments[1]),!0},h.prototype.clear=function(){this.array_=[]},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.set=function(y,x){var T=this.array_[y];return this.array_[y]=x,T},h.prototype.iterator=function(){return new au(this)},h.prototype.get=function(y){if(y<0||y>=this.size())throw new Fe;return this.array_[y]},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.size=function(){return this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.remove=function(y){for(var x=!1,T=0,k=this.array_.length;T<k;T++)if(this.array_[T]===y){this.array_.splice(T,1),x=!0;break}return x},h}(ts),au=function(u){function h(y){u.call(this),this.arrayList_=y,this.position_=0}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new lt;return this.arrayList_.get(this.position_++)},h.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},h.prototype.set=function(y){return this.arrayList_.set(this.position_-1,y)},h.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},h}(As),No=function(u){function h(){if(u.call(this),0!==arguments.length)if(1===arguments.length){var x=arguments[0];this.ensureCapacity(x.length),this.add(x,!0)}else if(2===arguments.length){var T=arguments[0],k=arguments[1];this.ensureCapacity(T.length),this.add(T,k)}}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={coordArrayType:{configurable:!0}};return y.coordArrayType.get=function(){return new Array(0).fill(null)},h.prototype.getCoordinate=function(x){return this.get(x)},h.prototype.addAll=function(){if(2===arguments.length){for(var T=arguments[1],k=!1,G=arguments[0].iterator();G.hasNext();)this.add(G.next(),T),k=!0;return k}return u.prototype.addAll.apply(this,arguments)},h.prototype.clone=function(){for(var x=u.prototype.clone.call(this),T=0;T<this.size();T++)x.add(T,this.get(T).copy());return x},h.prototype.toCoordinateArray=function(){return this.toArray(h.coordArrayType)},h.prototype.add=function(){if(1===arguments.length)u.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof J&&"boolean"==typeof arguments[1]){var G=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(G))return null;u.prototype.add.call(this,G)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var et=arguments[0],Ft=arguments[1];if(arguments[2])for(var $t=0;$t<et.length;$t++)this.add(et[$t],Ft);else for(var gt=et.length-1;gt>=0;gt--)this.add(et[gt],Ft);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof J){var nn=arguments[0],Un=arguments[1];if(!arguments[2]){var Qn=this.size();if(Qn>0&&(nn>0&&this.get(nn-1).equals2D(Un)||nn<Qn&&this.get(nn).equals2D(Un)))return null}u.prototype.add.call(this,nn,Un)}}else if(4===arguments.length){var Sr=arguments[0],Bo=arguments[1],xs=arguments[2],Ss=arguments[3],Va=1;xs>Ss&&(Va=-1);for(var Yl=xs;Yl!==Ss;Yl+=Va)this.add(Sr[Yl],Bo);return!0}},h.prototype.closeRing=function(){this.size()>0&&this.add(new J(this.get(0)),!1)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},Object.defineProperties(h,y),h}(gn),_r=function(){},Oa={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Oa.ForwardComparator.get=function(){return Go},Oa.BidirectionalComparator.get=function(){return Le},Oa.coordArrayType.get=function(){return new Array(0).fill(null)},_r.prototype.interfaces_=function(){return[]},_r.prototype.getClass=function(){return _r},_r.isRing=function(u){return!(u.length<4||!u[0].equals2D(u[u.length-1]))},_r.ptNotInList=function(u,h){for(var y=0;y<u.length;y++){var x=u[y];if(_r.indexOf(x,h)<0)return x}return null},_r.scroll=function(u,h){var y=_r.indexOf(h,u);if(y<0)return null;var x=new Array(u.length).fill(null);vn.arraycopy(u,y,x,0,u.length-y),vn.arraycopy(u,0,x,u.length-y,y),vn.arraycopy(x,0,u,0,u.length)},_r.equals=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];if(u===h)return!0;if(null===u||null===h||u.length!==h.length)return!1;for(var y=0;y<u.length;y++)if(!u[y].equals(h[y]))return!1;return!0}if(3===arguments.length){var x=arguments[0],T=arguments[1],k=arguments[2];if(x===T)return!0;if(null===x||null===T||x.length!==T.length)return!1;for(var G=0;G<x.length;G++)if(0!==k.compare(x[G],T[G]))return!1;return!0}},_r.intersection=function(u,h){for(var y=new No,x=0;x<u.length;x++)h.intersects(u[x])&&y.add(u[x],!0);return y.toCoordinateArray()},_r.hasRepeatedPoints=function(u){for(var h=1;h<u.length;h++)if(u[h-1].equals(u[h]))return!0;return!1},_r.removeRepeatedPoints=function(u){return _r.hasRepeatedPoints(u)?new No(u,!1).toCoordinateArray():u},_r.reverse=function(u){for(var h=u.length-1,y=Math.trunc(h/2),x=0;x<=y;x++){var T=u[x];u[x]=u[h-x],u[h-x]=T}},_r.removeNull=function(u){for(var h=0,y=0;y<u.length;y++)null!==u[y]&&h++;var x=new Array(h).fill(null);if(0===h)return x;for(var T=0,k=0;k<u.length;k++)null!==u[k]&&(x[T++]=u[k]);return x},_r.copyDeep=function(){if(1===arguments.length){for(var u=arguments[0],h=new Array(u.length).fill(null),y=0;y<u.length;y++)h[y]=new J(u[y]);return h}if(5===arguments.length)for(var x=arguments[0],T=arguments[1],k=arguments[2],G=arguments[3],K=arguments[4],re=0;re<K;re++)k[G+re]=new J(x[T+re])},_r.isEqualReversed=function(u,h){for(var y=0;y<u.length;y++)if(0!==u[y].compareTo(h[u.length-y-1]))return!1;return!0},_r.envelope=function(u){for(var h=new hn,y=0;y<u.length;y++)h.expandToInclude(u[y]);return h},_r.toCoordinateArray=function(u){return u.toArray(_r.coordArrayType)},_r.atLeastNCoordinatesOrNothing=function(u,h){return h.length>=u?h:[]},_r.indexOf=function(u,h){for(var y=0;y<h.length;y++)if(u.equals(h[y]))return y;return-1},_r.increasingDirection=function(u){for(var h=0;h<Math.trunc(u.length/2);h++){var x=u[h].compareTo(u[u.length-1-h]);if(0!==x)return x}return 1},_r.compare=function(u,h){for(var y=0;y<u.length&&y<h.length;){var x=u[y].compareTo(h[y]);if(0!==x)return x;y++}return y<h.length?-1:y<u.length?1:0},_r.minCoordinate=function(u){for(var h=null,y=0;y<u.length;y++)(null===h||h.compareTo(u[y])>0)&&(h=u[y]);return h},_r.extract=function(u,h,y){h=Pe.clamp(h,0,u.length);var x=(y=Pe.clamp(y,-1,u.length))-h+1;y<0&&(x=0),h>=u.length&&(x=0),y<h&&(x=0);var T=new Array(x).fill(null);if(0===x)return T;for(var k=0,G=h;G<=y;G++)T[k++]=u[G];return T},Object.defineProperties(_r,Oa);var Go=function(){};Go.prototype.compare=function(u,h){return _r.compare(u,h)},Go.prototype.interfaces_=function(){return[we]},Go.prototype.getClass=function(){return Go};var Le=function(){};Le.prototype.compare=function(u,h){var y=u,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;var T=_r.compare(y,x);return _r.isEqualReversed(y,x)?0:T},Le.prototype.OLDcompare=function(u,h){var y=u,x=h;if(y.length<x.length)return-1;if(y.length>x.length)return 1;if(0===y.length)return 0;for(var T=_r.increasingDirection(y),k=_r.increasingDirection(x),G=T>0?0:y.length-1,K=k>0?0:y.length-1,re=0;re<y.length;re++){var et=y[G].compareTo(x[K]);if(0!==et)return et;G+=T,K+=k}return 0},Le.prototype.interfaces_=function(){return[we]},Le.prototype.getClass=function(){return Le};var W=function(){};W.prototype.get=function(){},W.prototype.put=function(){},W.prototype.size=function(){},W.prototype.values=function(){},W.prototype.entrySet=function(){};var ne=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h}(W);(p.prototype=new Error).name="OperationNotSupported",(ve.prototype=new oi).contains=function(){};var Oe=function(u){function h(){u.call(this),this.array_=[],arguments[0]instanceof oi&&this.addAll(arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.contains=function(y){for(var x=0,T=this.array_.length;x<T;x++)if(this.array_[x]===y)return!0;return!1},h.prototype.add=function(y){return!this.contains(y)&&(this.array_.push(y),!0)},h.prototype.addAll=function(y){for(var x=y.iterator();x.hasNext();)this.add(x.next());return!0},h.prototype.remove=function(y){throw new Error},h.prototype.size=function(){return this.array_.length},h.prototype.isEmpty=function(){return 0===this.array_.length},h.prototype.toArray=function(){for(var y=[],x=0,T=this.array_.length;x<T;x++)y.push(this.array_[x]);return y},h.prototype.iterator=function(){return new He(this)},h}(ve),He=function(u){function h(y){u.call(this),this.hashSet_=y,this.position_=0}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new lt;return this.hashSet_.array_[this.position_++]},h.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},h.prototype.remove=function(){throw new p},h}(As),nt=0;(Ot.prototype=new ne).get=function(u){for(var h=this.root_;null!==h;){var y=u.compareTo(h.key);if(y<0)h=h.left;else{if(!(y>0))return h.value;h=h.right}}return null},Ot.prototype.put=function(u,h){if(null===this.root_)return this.root_={key:u,value:h,left:null,right:null,parent:null,color:nt,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var y,x,T=this.root_;do{if(y=T,(x=u.compareTo(T.key))<0)T=T.left;else{if(!(x>0)){var k=T.value;return T.value=h,k}T=T.right}}while(null!==T);var G={key:u,left:null,right:null,value:h,parent:y,color:nt,getValue:function(){return this.value},getKey:function(){return this.key}};return x<0?y.left=G:y.right=G,this.fixAfterInsertion(G),this.size_++,null},Ot.prototype.fixAfterInsertion=function(u){for(u.color=1;null!=u&&u!==this.root_&&1===u.parent.color;)if(ut(u)===Ct(ut(ut(u)))){var h=Yt(ut(ut(u)));1===$e(h)?(ft(ut(u),nt),ft(h,nt),ft(ut(ut(u)),1),u=ut(ut(u))):(u===Yt(ut(u))&&(u=ut(u),this.rotateLeft(u)),ft(ut(u),nt),ft(ut(ut(u)),1),this.rotateRight(ut(ut(u))))}else{var y=Ct(ut(ut(u)));1===$e(y)?(ft(ut(u),nt),ft(y,nt),ft(ut(ut(u)),1),u=ut(ut(u))):(u===Ct(ut(u))&&(u=ut(u),this.rotateRight(u)),ft(ut(u),nt),ft(ut(ut(u)),1),this.rotateLeft(ut(ut(u))))}this.root_.color=nt},Ot.prototype.values=function(){var u=new gn,h=this.getFirstEntry();if(null!==h)for(u.add(h.value);null!==(h=Ot.successor(h));)u.add(h.value);return u},Ot.prototype.entrySet=function(){var u=new Oe,h=this.getFirstEntry();if(null!==h)for(u.add(h);null!==(h=Ot.successor(h));)u.add(h);return u},Ot.prototype.rotateLeft=function(u){if(null!=u){var h=u.right;u.right=h.left,null!=h.left&&(h.left.parent=u),h.parent=u.parent,null===u.parent?this.root_=h:u.parent.left===u?u.parent.left=h:u.parent.right=h,h.left=u,u.parent=h}},Ot.prototype.rotateRight=function(u){if(null!=u){var h=u.left;u.left=h.right,null!=h.right&&(h.right.parent=u),h.parent=u.parent,null===u.parent?this.root_=h:u.parent.right===u?u.parent.right=h:u.parent.left=h,h.right=u,u.parent=h}},Ot.prototype.getFirstEntry=function(){var u=this.root_;if(null!=u)for(;null!=u.left;)u=u.left;return u},Ot.successor=function(u){if(null===u)return null;if(null!==u.right){for(var h=u.right;null!==h.left;)h=h.left;return h}for(var y=u.parent,x=u;null!==y&&x===y.right;)x=y,y=y.parent;return y},Ot.prototype.size=function(){return this.size_};var bt=function(){};bt.prototype.interfaces_=function(){return[]},bt.prototype.getClass=function(){return bt},xt.prototype=new ve,(Ut.prototype=new xt).contains=function(u){for(var h=0,y=this.array_.length;h<y;h++)if(0===this.array_[h].compareTo(u))return!0;return!1},Ut.prototype.add=function(u){if(this.contains(u))return!1;for(var h=0,y=this.array_.length;h<y;h++)if(1===this.array_[h].compareTo(u))return this.array_.splice(h,0,u),!0;return this.array_.push(u),!0},Ut.prototype.addAll=function(u){for(var h=u.iterator();h.hasNext();)this.add(h.next());return!0},Ut.prototype.remove=function(u){throw new p},Ut.prototype.size=function(){return this.array_.length},Ut.prototype.isEmpty=function(){return 0===this.array_.length},Ut.prototype.toArray=function(){for(var u=[],h=0,y=this.array_.length;h<y;h++)u.push(this.array_[h]);return u},Ut.prototype.iterator=function(){return new yt(this)};var yt=function(u){this.treeSet_=u,this.position_=0};yt.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new lt;return this.treeSet_.array_[this.position_++]},yt.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},yt.prototype.remove=function(){throw new p};var at=function(){};at.sort=function(){var u,h,y,T=arguments[0];if(1===arguments.length)T.sort(function(G,K){return G.compareTo(K)});else if(2===arguments.length)y=arguments[1],T.sort(function(G,K){return y.compare(G,K)});else if(3===arguments.length){(h=T.slice(arguments[1],arguments[2])).sort();var k=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length));for(T.splice(0,T.length),u=0;u<k.length;u++)T.push(k[u])}else if(4===arguments.length)for(h=T.slice(arguments[1],arguments[2]),y=arguments[3],h.sort(function(G,K){return y.compare(G,K)}),k=T.slice(0,arguments[1]).concat(h,T.slice(arguments[2],T.length)),T.splice(0,T.length),u=0;u<k.length;u++)T.push(k[u])},at.asList=function(u){for(var h=new gn,y=0,x=u.length;y<x;y++)h.add(u[y]);return h};var st=function(){},Xt={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Xt.P.get=function(){return 0},Xt.L.get=function(){return 1},Xt.A.get=function(){return 2},Xt.FALSE.get=function(){return-1},Xt.TRUE.get=function(){return-2},Xt.DONTCARE.get=function(){return-3},Xt.SYM_FALSE.get=function(){return"F"},Xt.SYM_TRUE.get=function(){return"T"},Xt.SYM_DONTCARE.get=function(){return"*"},Xt.SYM_P.get=function(){return"0"},Xt.SYM_L.get=function(){return"1"},Xt.SYM_A.get=function(){return"2"},st.prototype.interfaces_=function(){return[]},st.prototype.getClass=function(){return st},st.toDimensionSymbol=function(u){switch(u){case st.FALSE:return st.SYM_FALSE;case st.TRUE:return st.SYM_TRUE;case st.DONTCARE:return st.SYM_DONTCARE;case st.P:return st.SYM_P;case st.L:return st.SYM_L;case st.A:return st.SYM_A}throw new Y("Unknown dimension value: "+u)},st.toDimensionValue=function(u){switch(dt.toUpperCase(u)){case st.SYM_FALSE:return st.FALSE;case st.SYM_TRUE:return st.TRUE;case st.SYM_DONTCARE:return st.DONTCARE;case st.SYM_P:return st.P;case st.SYM_L:return st.L;case st.SYM_A:return st.A}throw new Y("Unknown dimension symbol: "+u)},Object.defineProperties(st,Xt);var yn=function(){};yn.prototype.filter=function(u){},yn.prototype.interfaces_=function(){return[]},yn.prototype.getClass=function(){return yn};var tn=function(){};tn.prototype.filter=function(u,h){},tn.prototype.isDone=function(){},tn.prototype.isGeometryChanged=function(){},tn.prototype.interfaces_=function(){return[]},tn.prototype.getClass=function(){return tn};var zn=function(u){function h(x,T){if(u.call(this,T),this._geometries=x||[],u.hasNullElements(this._geometries))throw new Y("geometries must not contain null elements")}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){for(var x=new hn,T=0;T<this._geometries.length;T++)x.expandToInclude(this._geometries[T].getEnvelopeInternal());return x},h.prototype.getGeometryN=function(x){return this._geometries[x]},h.prototype.getSortIndex=function(){return u.SORTINDEX_GEOMETRYCOLLECTION},h.prototype.getCoordinates=function(){for(var x=new Array(this.getNumPoints()).fill(null),T=-1,k=0;k<this._geometries.length;k++)for(var G=this._geometries[k].getCoordinates(),K=0;K<G.length;K++)x[++T]=G[K];return x},h.prototype.getArea=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getArea();return x},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var k=x;if(this._geometries.length!==k._geometries.length)return!1;for(var G=0;G<this._geometries.length;G++)if(!this._geometries[G].equalsExact(k._geometries[G],T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<this._geometries.length;x++)this._geometries[x].normalize();at.sort(this._geometries)},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},h.prototype.getBoundaryDimension=function(){for(var x=st.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getBoundaryDimension());return x},h.prototype.getDimension=function(){for(var x=st.FALSE,T=0;T<this._geometries.length;T++)x=Math.max(x,this._geometries[T].getDimension());return x},h.prototype.getLength=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=0,T=0;T<this._geometries.length;T++)x+=this._geometries[T].getNumPoints();return x},h.prototype.getNumGeometries=function(){return this._geometries.length},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)T[k]=this._geometries[k].reverse();return this.getFactory().createGeometryCollection(T)},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0],T=new Ut(at.asList(this._geometries)),k=new Ut(at.asList(x._geometries));return this.compare(T,k)}if(2===arguments.length){for(var K=arguments[1],re=arguments[0],et=this.getNumGeometries(),Ft=re.getNumGeometries(),$t=0;$t<et&&$t<Ft;){var gt=this.getGeometryN($t),nn=re.getGeometryN($t),Un=gt.compareToSameClass(nn,K);if(0!==Un)return Un;$t++}return $t<et?1:$t<Ft?-1:0}},h.prototype.apply=function(){if(At(arguments[0],qr))for(var x=arguments[0],T=0;T<this._geometries.length;T++)this._geometries[T].apply(x);else if(At(arguments[0],tn)){var k=arguments[0];if(0===this._geometries.length)return null;for(var G=0;G<this._geometries.length&&(this._geometries[G].apply(k),!k.isDone());G++);k.isGeometryChanged()&&this.geometryChanged()}else if(At(arguments[0],yn)){var K=arguments[0];K.filter(this);for(var re=0;re<this._geometries.length;re++)this._geometries[re].apply(K)}else if(At(arguments[0],lr)){var et=arguments[0];et.filter(this);for(var Ft=0;Ft<this._geometries.length;Ft++)this._geometries[Ft].apply(et)}},h.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),ae.shouldNeverReachHere(),null},h.prototype.clone=function(){var x=u.prototype.clone.call(this);x._geometries=new Array(this._geometries.length).fill(null);for(var T=0;T<this._geometries.length;T++)x._geometries[T]=this._geometries[T].clone();return x},h.prototype.getGeometryType=function(){return"GeometryCollection"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.isEmpty=function(){for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isEmpty())return!1;return!0},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(h,y),h}(En),$n=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return En.SORTINDEX_MULTILINESTRING},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?st.FALSE:0},h.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var x=0;x<this._geometries.length;x++)if(!this._geometries[x].isClosed())return!1;return!0},h.prototype.getDimension=function(){return 1},h.prototype.reverse=function(){for(var x=this._geometries.length,T=new Array(x).fill(null),k=0;k<this._geometries.length;k++)T[x-1-k]=this._geometries[k].reverse();return this.getFactory().createMultiLineString(T)},h.prototype.getBoundary=function(){return new Fn(this).getBoundary()},h.prototype.getGeometryType=function(){return"MultiLineString"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[bt]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(h,y),h}(zn),Fn=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,1===arguments.length){var u=arguments[0],h=ui.MOD2_BOUNDARY_RULE;this._geom=u,this._geomFact=u.getFactory(),this._bnRule=h}else if(2===arguments.length){var y=arguments[0],x=arguments[1];this._geom=y,this._geomFact=y.getFactory(),this._bnRule=x}};Fn.prototype.boundaryMultiLineString=function(u){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var h=this.computeBoundaryCoordinates(u);return 1===h.length?this._geomFact.createPoint(h[0]):this._geomFact.createMultiPointFromCoords(h)},Fn.prototype.getBoundary=function(){return this._geom instanceof dr?this.boundaryLineString(this._geom):this._geom instanceof $n?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()},Fn.prototype.boundaryLineString=function(u){return this._geom.isEmpty()?this.getEmptyMultiPoint():u.isClosed()?this._bnRule.isInBoundary(2)?u.getStartPoint():this._geomFact.createMultiPoint():this._geomFact.createMultiPoint([u.getStartPoint(),u.getEndPoint()])},Fn.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()},Fn.prototype.computeBoundaryCoordinates=function(u){var h=new gn;this._endpointMap=new Ot;for(var y=0;y<u.getNumGeometries();y++){var x=u.getGeometryN(y);0!==x.getNumPoints()&&(this.addEndpoint(x.getCoordinateN(0)),this.addEndpoint(x.getCoordinateN(x.getNumPoints()-1)))}for(var T=this._endpointMap.entrySet().iterator();T.hasNext();){var k=T.next(),G=k.getValue().count;this._bnRule.isInBoundary(G)&&h.add(k.getKey())}return _r.toCoordinateArray(h)},Fn.prototype.addEndpoint=function(u){var h=this._endpointMap.get(u);null===h&&(h=new or,this._endpointMap.put(u,h)),h.count++},Fn.prototype.interfaces_=function(){return[]},Fn.prototype.getClass=function(){return Fn},Fn.getBoundary=function(){return 1===arguments.length?new Fn(arguments[0]).getBoundary():2===arguments.length?new Fn(arguments[0],arguments[1]).getBoundary():void 0};var or=function(){this.count=null};or.prototype.interfaces_=function(){return[]},or.prototype.getClass=function(){return or};var nr=function(){},ci={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};nr.prototype.interfaces_=function(){return[]},nr.prototype.getClass=function(){return nr},nr.chars=function(u,h){for(var y=new Array(h).fill(null),x=0;x<h;x++)y[x]=u;return String(y)},nr.getStackTrace=function(){if(1===arguments.length){var u=arguments[0],h=new function(){},y=new function(){}(h);return u.printStackTrace(y),h.toString()}if(2===arguments.length){for(var T=arguments[1],k="",G=new function(){}(new function(){}(nr.getStackTrace(arguments[0]))),K=0;K<T;K++)try{k+=G.readLine()+nr.NEWLINE}catch(re){if(!(re instanceof pn))throw re;ae.shouldNeverReachHere()}return k}},nr.split=function(u,h){for(var y=h.length,x=new gn,T=""+u,k=T.indexOf(h);k>=0;){var G=T.substring(0,k);x.add(G),k=(T=T.substring(k+y)).indexOf(h)}T.length>0&&x.add(T);for(var K=new Array(x.size()).fill(null),re=0;re<K.length;re++)K[re]=x.get(re);return K},nr.toString=function(){if(1===arguments.length)return nr.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},nr.spaces=function(u){return nr.chars(" ",u)},ci.NEWLINE.get=function(){return vn.getProperty("line.separator")},ci.SIMPLE_ORDINATE_FORMAT.get=function(){return new function(){}("0.#")},Object.defineProperties(nr,ci);var Nn=function(){};Nn.prototype.interfaces_=function(){return[]},Nn.prototype.getClass=function(){return Nn},Nn.copyCoord=function(u,h,y,x){for(var T=Math.min(u.getDimension(),y.getDimension()),k=0;k<T;k++)y.setOrdinate(x,k,u.getOrdinate(h,k))},Nn.isRing=function(u){var h=u.size();return 0===h||!(h<=3)&&u.getOrdinate(0,Lt.X)===u.getOrdinate(h-1,Lt.X)&&u.getOrdinate(0,Lt.Y)===u.getOrdinate(h-1,Lt.Y)},Nn.isEqual=function(u,h){var y=u.size();if(y!==h.size())return!1;for(var x=Math.min(u.getDimension(),h.getDimension()),T=0;T<y;T++)for(var k=0;k<x;k++){var G=u.getOrdinate(T,k),K=h.getOrdinate(T,k);if(!(u.getOrdinate(T,k)===h.getOrdinate(T,k)||ce.isNaN(G)&&ce.isNaN(K)))return!1}return!0},Nn.extend=function(u,h,y){var x=u.create(y,h.getDimension()),T=h.size();if(Nn.copy(h,0,x,0,T),T>0)for(var k=T;k<y;k++)Nn.copy(h,T-1,x,k,1);return x},Nn.reverse=function(u){for(var h=u.size()-1,y=Math.trunc(h/2),x=0;x<=y;x++)Nn.swap(u,x,h-x)},Nn.swap=function(u,h,y){if(h===y)return null;for(var x=0;x<u.getDimension();x++){var T=u.getOrdinate(h,x);u.setOrdinate(h,x,u.getOrdinate(y,x)),u.setOrdinate(y,x,T)}},Nn.copy=function(u,h,y,x,T){for(var k=0;k<T;k++)Nn.copyCoord(u,h+k,y,x+k)},Nn.toString=function(){if(1===arguments.length){var u=arguments[0],h=u.size();if(0===h)return"()";var y=u.getDimension(),x=new Me;x.append("(");for(var T=0;T<h;T++){T>0&&x.append(" ");for(var k=0;k<y;k++)k>0&&x.append(","),x.append(nr.toString(u.getOrdinate(T,k)))}return x.append(")"),x.toString()}},Nn.ensureValidRing=function(u,h){var y=h.size();return 0===y?h:y<=3?Nn.createClosedRing(u,h,4):h.getOrdinate(0,Lt.X)===h.getOrdinate(y-1,Lt.X)&&h.getOrdinate(0,Lt.Y)===h.getOrdinate(y-1,Lt.Y)?h:Nn.createClosedRing(u,h,y+1)},Nn.createClosedRing=function(u,h,y){var x=u.create(y,h.getDimension()),T=h.size();Nn.copy(h,0,x,0,T);for(var k=T;k<y;k++)Nn.copy(h,0,x,k,1);return x};var dr=function(u){function h(x,T){u.call(this,T),this._points=null,this.init(x)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new hn:this._points.expandEnvelope(new hn)},h.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},h.prototype.getSortIndex=function(){return u.SORTINDEX_LINESTRING},h.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var k=x;if(this._points.size()!==k._points.size())return!1;for(var G=0;G<this._points.size();G++)if(!this.equal(this._points.getCoordinate(G),k._points.getCoordinate(G),T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){for(var x=0;x<Math.trunc(this._points.size()/2);x++){var T=this._points.size()-1-x;if(!this._points.getCoordinate(x).equals(this._points.getCoordinate(T)))return this._points.getCoordinate(x).compareTo(this._points.getCoordinate(T))>0&&Nn.reverse(this._points),null}},h.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},h.prototype.getBoundaryDimension=function(){return this.isClosed()?st.FALSE:0},h.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},h.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},h.prototype.getDimension=function(){return 1},h.prototype.getLength=function(){return Gt.computeLength(this._points)},h.prototype.getNumPoints=function(){return this._points.size()},h.prototype.reverse=function(){var x=this._points.copy();return Nn.reverse(x),this.getFactory().createLineString(x)},h.prototype.compareToSameClass=function(){if(1===arguments.length){for(var x=arguments[0],T=0,k=0;T<this._points.size()&&k<x._points.size();){var G=this._points.getCoordinate(T).compareTo(x._points.getCoordinate(k));if(0!==G)return G;T++,k++}return T<this._points.size()?1:k<x._points.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this._points,arguments[0]._points)},h.prototype.apply=function(){if(At(arguments[0],qr))for(var x=arguments[0],T=0;T<this._points.size();T++)x.filter(this._points.getCoordinate(T));else if(At(arguments[0],tn)){var k=arguments[0];if(0===this._points.size())return null;for(var G=0;G<this._points.size()&&(k.filter(this._points,G),!k.isDone());G++);k.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],yn)||At(arguments[0],lr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return new Fn(this).getBoundary()},h.prototype.isEquivalentClass=function(x){return x instanceof h},h.prototype.clone=function(){var x=u.prototype.clone.call(this);return x._points=this._points.clone(),x},h.prototype.getCoordinateN=function(x){return this._points.getCoordinate(x)},h.prototype.getGeometryType=function(){return"LineString"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._points},h.prototype.isEmpty=function(){return 0===this._points.size()},h.prototype.init=function(x){if(null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),1===x.size())throw new Y("Invalid number of points in LineString (found "+x.size()+" - must be 0 or >= 2)");this._points=x},h.prototype.isCoordinate=function(x){for(var T=0;T<this._points.size();T++)if(this._points.getCoordinate(T).equals(x))return!0;return!1},h.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},h.prototype.getPointN=function(x){return this.getFactory().createPoint(this._points.getCoordinate(x))},h.prototype.interfaces_=function(){return[bt]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(h,y),h}(En),_i=function(){};_i.prototype.interfaces_=function(){return[]},_i.prototype.getClass=function(){return _i};var ps=function(u){function h(x,T){u.call(this,T),this._coordinates=x||null,this.init(this._coordinates)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new hn;var x=new hn;return x.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),x},h.prototype.getSortIndex=function(){return u.SORTINDEX_POINT},h.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&(!(!this.isEmpty()||!x.isEmpty())||this.isEmpty()===x.isEmpty()&&this.equal(x.getCoordinate(),this.getCoordinate(),T))}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){},h.prototype.getCoordinate=function(){return 0!==this._coordinates.size()?this._coordinates.getCoordinate(0):null},h.prototype.getBoundaryDimension=function(){return st.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getNumPoints=function(){return this.isEmpty()?0:1},h.prototype.reverse=function(){return this.copy()},h.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},h.prototype.compareToSameClass=function(){if(1===arguments.length){var x=arguments[0];return this.getCoordinate().compareTo(x.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this._coordinates,arguments[0]._coordinates)},h.prototype.apply=function(){if(At(arguments[0],qr)){var x=arguments[0];if(this.isEmpty())return null;x.filter(this.getCoordinate())}else if(At(arguments[0],tn)){var T=arguments[0];if(this.isEmpty())return null;T.filter(this._coordinates,0),T.isGeometryChanged()&&this.geometryChanged()}else(At(arguments[0],yn)||At(arguments[0],lr))&&arguments[0].filter(this)},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.clone=function(){var x=u.prototype.clone.call(this);return x._coordinates=this._coordinates.clone(),x},h.prototype.getGeometryType=function(){return"Point"},h.prototype.copy=function(){return new h(this._coordinates.copy(),this._factory)},h.prototype.getCoordinateSequence=function(){return this._coordinates},h.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},h.prototype.isEmpty=function(){return 0===this._coordinates.size()},h.prototype.init=function(x){null===x&&(x=this.getFactory().getCoordinateSequenceFactory().create([])),ae.isTrue(x.size()<=1),this._coordinates=x},h.prototype.isSimple=function(){return!0},h.prototype.interfaces_=function(){return[_i]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(h,y),h}(En),fa=function(){};fa.prototype.interfaces_=function(){return[]},fa.prototype.getClass=function(){return fa};var Rt=function(u){function h(x,T,k){if(u.call(this,k),this._shell=null,this._holes=null,null===x&&(x=this.getFactory().createLinearRing()),null===T&&(T=[]),u.hasNullElements(T))throw new Y("holes must not contain null elements");if(x.isEmpty()&&u.hasNonEmptyElements(T))throw new Y("shell is empty but holes are not");this._shell=x,this._holes=T}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},h.prototype.getSortIndex=function(){return u.SORTINDEX_POLYGON},h.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var x=new Array(this.getNumPoints()).fill(null),T=-1,k=this._shell.getCoordinates(),G=0;G<k.length;G++)x[++T]=k[G];for(var K=0;K<this._holes.length;K++)for(var re=this._holes[K].getCoordinates(),et=0;et<re.length;et++)x[++T]=re[et];return x},h.prototype.getArea=function(){var x=0;x+=Math.abs(Gt.signedArea(this._shell.getCoordinateSequence()));for(var T=0;T<this._holes.length;T++)x-=Math.abs(Gt.signedArea(this._holes[T].getCoordinateSequence()));return x},h.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing()||null===this._shell||5!==this._shell.getNumPoints())return!1;for(var x=this._shell.getCoordinateSequence(),T=this.getEnvelopeInternal(),k=0;k<5;k++){var G=x.getX(k);if(G!==T.getMinX()&&G!==T.getMaxX())return!1;var K=x.getY(k);if(K!==T.getMinY()&&K!==T.getMaxY())return!1}for(var re=x.getX(0),et=x.getY(0),Ft=1;Ft<=4;Ft++){var $t=x.getX(Ft),gt=x.getY(Ft);if($t!==re==(gt!==et))return!1;re=$t,et=gt}return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];if(!this.isEquivalentClass(x))return!1;var k=x;if(!this._shell.equalsExact(k._shell,T)||this._holes.length!==k._holes.length)return!1;for(var re=0;re<this._holes.length;re++)if(!this._holes[re].equalsExact(k._holes[re],T))return!1;return!0}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.normalize=function(){if(0===arguments.length){this.normalize(this._shell,!0);for(var x=0;x<this._holes.length;x++)this.normalize(this._holes[x],!1);at.sort(this._holes)}else if(2===arguments.length){var T=arguments[0],k=arguments[1];if(T.isEmpty())return null;var G=new Array(T.getCoordinates().length-1).fill(null);vn.arraycopy(T.getCoordinates(),0,G,0,G.length);var K=_r.minCoordinate(T.getCoordinates());_r.scroll(G,K),vn.arraycopy(G,0,T.getCoordinates(),0,G.length),T.getCoordinates()[G.length]=G[0],Gt.isCCW(T.getCoordinates())===k&&_r.reverse(T.getCoordinates())}},h.prototype.getCoordinate=function(){return this._shell.getCoordinate()},h.prototype.getNumInteriorRing=function(){return this._holes.length},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.getLength=function(){var x=0;x+=this._shell.getLength();for(var T=0;T<this._holes.length;T++)x+=this._holes[T].getLength();return x},h.prototype.getNumPoints=function(){for(var x=this._shell.getNumPoints(),T=0;T<this._holes.length;T++)x+=this._holes[T].getNumPoints();return x},h.prototype.reverse=function(){var x=this.copy();x._shell=this._shell.copy().reverse(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].copy().reverse();return x},h.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},h.prototype.compareToSameClass=function(){if(1===arguments.length)return this._shell.compareToSameClass(arguments[0]._shell);if(2===arguments.length){var K=arguments[1],re=arguments[0],$t=this._shell.compareToSameClass(re._shell,K);if(0!==$t)return $t;for(var gt=this.getNumInteriorRing(),nn=re.getNumInteriorRing(),Un=0;Un<gt&&Un<nn;){var Qn=this.getInteriorRingN(Un),Sr=re.getInteriorRingN(Un),Bo=Qn.compareToSameClass(Sr,K);if(0!==Bo)return Bo;Un++}return Un<gt?1:Un<nn?-1:0}},h.prototype.apply=function(x){if(At(x,qr)){this._shell.apply(x);for(var T=0;T<this._holes.length;T++)this._holes[T].apply(x)}else if(At(x,tn)){if(this._shell.apply(x),!x.isDone())for(var k=0;k<this._holes.length&&(this._holes[k].apply(x),!x.isDone());k++);x.isGeometryChanged()&&this.geometryChanged()}else if(At(x,yn))x.filter(this);else if(At(x,lr)){x.filter(this),this._shell.apply(x);for(var G=0;G<this._holes.length;G++)this._holes[G].apply(x)}},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var x=new Array(this._holes.length+1).fill(null);x[0]=this._shell;for(var T=0;T<this._holes.length;T++)x[T+1]=this._holes[T];return x.length<=1?this.getFactory().createLinearRing(x[0].getCoordinateSequence()):this.getFactory().createMultiLineString(x)},h.prototype.clone=function(){var x=u.prototype.clone.call(this);x._shell=this._shell.clone(),x._holes=new Array(this._holes.length).fill(null);for(var T=0;T<this._holes.length;T++)x._holes[T]=this._holes[T].clone();return x},h.prototype.getGeometryType=function(){return"Polygon"},h.prototype.copy=function(){for(var x=this._shell.copy(),T=new Array(this._holes.length).fill(null),k=0;k<T.length;k++)T[k]=this._holes[k].copy();return new h(x,T,this._factory)},h.prototype.getExteriorRing=function(){return this._shell},h.prototype.isEmpty=function(){return this._shell.isEmpty()},h.prototype.getInteriorRingN=function(x){return this._holes[x]},h.prototype.interfaces_=function(){return[fa]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(h,y),h}(En),Na=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return En.SORTINDEX_MULTIPOINT},h.prototype.isValid=function(){return!0},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getCoordinate=function(){return 1===arguments.length?this._geometries[arguments[0]].getCoordinate():u.prototype.getCoordinate.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return st.FALSE},h.prototype.getDimension=function(){return 0},h.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},h.prototype.getGeometryType=function(){return"MultiPoint"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[_i]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(h,y),h}(zn),go=function(u){function h(x,T){x instanceof J&&T instanceof pr&&(x=T.getCoordinateSequenceFactory().create(x)),u.call(this,x,T),this.validateConstruction()}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return En.SORTINDEX_LINEARRING},h.prototype.getBoundaryDimension=function(){return st.FALSE},h.prototype.isClosed=function(){return!!this.isEmpty()||u.prototype.isClosed.call(this)},h.prototype.reverse=function(){var x=this._points.copy();return Nn.reverse(x),this.getFactory().createLinearRing(x)},h.prototype.validateConstruction=function(){if(!this.isEmpty()&&!u.prototype.isClosed.call(this))throw new Y("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<h.MINIMUM_VALID_SIZE)throw new Y("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},h.prototype.getGeometryType=function(){return"LinearRing"},h.prototype.copy=function(){return new h(this._points.copy(),this._factory)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.MINIMUM_VALID_SIZE.get=function(){return 4},y.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(h,y),h}(dr),ra=function(u){function h(){u.apply(this,arguments)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={serialVersionUID:{configurable:!0}};return h.prototype.getSortIndex=function(){return En.SORTINDEX_MULTIPOLYGON},h.prototype.equalsExact=function(){if(2===arguments.length){var x=arguments[0],T=arguments[1];return!!this.isEquivalentClass(x)&&u.prototype.equalsExact.call(this,x,T)}return u.prototype.equalsExact.apply(this,arguments)},h.prototype.getBoundaryDimension=function(){return 1},h.prototype.getDimension=function(){return 2},h.prototype.reverse=function(){for(var T=new Array(this._geometries.length).fill(null),k=0;k<this._geometries.length;k++)T[k]=this._geometries[k].reverse();return this.getFactory().createMultiPolygon(T)},h.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var x=new gn,T=0;T<this._geometries.length;T++)for(var k=this._geometries[T].getBoundary(),G=0;G<k.getNumGeometries();G++)x.add(k.getGeometryN(G));var K=new Array(x.size()).fill(null);return this.getFactory().createMultiLineString(x.toArray(K))},h.prototype.getGeometryType=function(){return"MultiPolygon"},h.prototype.copy=function(){for(var x=new Array(this._geometries.length).fill(null),T=0;T<x.length;T++)x[T]=this._geometries[T].copy();return new h(x,this._factory)},h.prototype.interfaces_=function(){return[fa]},h.prototype.getClass=function(){return h},y.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(h,y),h}(zn),Di=function(u){this._factory=u||null,this._isUserDataCopied=!1},uu={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Di.prototype.setCopyUserData=function(u){this._isUserDataCopied=u},Di.prototype.edit=function(u,h){if(null===u)return null;var y=this.editInternal(u,h);return this._isUserDataCopied&&y.setUserData(u.getUserData()),y},Di.prototype.editInternal=function(u,h){return null===this._factory&&(this._factory=u.getFactory()),u instanceof zn?this.editGeometryCollection(u,h):u instanceof Rt?this.editPolygon(u,h):u instanceof ps||u instanceof dr?h.edit(u,this._factory):(ae.shouldNeverReachHere("Unsupported Geometry class: "+u.getClass().getName()),null)},Di.prototype.editGeometryCollection=function(u,h){for(var y=h.edit(u,this._factory),x=new gn,T=0;T<y.getNumGeometries();T++){var k=this.edit(y.getGeometryN(T),h);null===k||k.isEmpty()||x.add(k)}return y.getClass()===Na?this._factory.createMultiPoint(x.toArray([])):y.getClass()===$n?this._factory.createMultiLineString(x.toArray([])):y.getClass()===ra?this._factory.createMultiPolygon(x.toArray([])):this._factory.createGeometryCollection(x.toArray([]))},Di.prototype.editPolygon=function(u,h){var y=h.edit(u,this._factory);if(null===y&&(y=this._factory.createPolygon(null)),y.isEmpty())return y;var x=this.edit(y.getExteriorRing(),h);if(null===x||x.isEmpty())return this._factory.createPolygon();for(var T=new gn,k=0;k<y.getNumInteriorRing();k++){var G=this.edit(y.getInteriorRingN(k),h);null===G||G.isEmpty()||T.add(G)}return this._factory.createPolygon(x,T.toArray([]))},Di.prototype.interfaces_=function(){return[]},Di.prototype.getClass=function(){return Di},Di.GeometryEditorOperation=function(){},uu.NoOpGeometryOperation.get=function(){return Yu},uu.CoordinateOperation.get=function(){return Vl},uu.CoordinateSequenceOperation.get=function(){return di},Object.defineProperties(Di,uu);var Yu=function(){};Yu.prototype.edit=function(u,h){return u},Yu.prototype.interfaces_=function(){return[Di.GeometryEditorOperation]},Yu.prototype.getClass=function(){return Yu};var Vl=function(){};Vl.prototype.edit=function(u,h){var y=this.editCoordinates(u.getCoordinates(),u);return null===y?u:u instanceof go?h.createLinearRing(y):u instanceof dr?h.createLineString(y):u instanceof ps?y.length>0?h.createPoint(y[0]):h.createPoint():u},Vl.prototype.interfaces_=function(){return[Di.GeometryEditorOperation]},Vl.prototype.getClass=function(){return Vl};var di=function(){};di.prototype.edit=function(u,h){return u instanceof go?h.createLinearRing(this.edit(u.getCoordinateSequence(),u)):u instanceof dr?h.createLineString(this.edit(u.getCoordinateSequence(),u)):u instanceof ps?h.createPoint(this.edit(u.getCoordinateSequence(),u)):u},di.prototype.interfaces_=function(){return[Di.GeometryEditorOperation]},di.prototype.getClass=function(){return di};var un=function(){if(this._dimension=3,this._coordinates=null,1===arguments.length){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var u=arguments[0];this._coordinates=new Array(u).fill(null);for(var h=0;h<u;h++)this._coordinates[h]=new J}else if(At(arguments[0],Lt)){var y=arguments[0];if(null===y)return this._coordinates=new Array(0).fill(null),null;this._dimension=y.getDimension(),this._coordinates=new Array(y.size()).fill(null);for(var x=0;x<this._coordinates.length;x++)this._coordinates[x]=y.getCoordinateCopy(x)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var T=arguments[0],k=arguments[1];this._coordinates=T,this._dimension=k,null===T&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var G=arguments[0],K=arguments[1];this._coordinates=new Array(G).fill(null),this._dimension=K;for(var re=0;re<G;re++)this._coordinates[re]=new J}},qn={serialVersionUID:{configurable:!0}};un.prototype.setOrdinate=function(u,h,y){switch(h){case Lt.X:this._coordinates[u].x=y;break;case Lt.Y:this._coordinates[u].y=y;break;case Lt.Z:this._coordinates[u].z=y;break;default:throw new Y("invalid ordinateIndex")}},un.prototype.size=function(){return this._coordinates.length},un.prototype.getOrdinate=function(u,h){switch(h){case Lt.X:return this._coordinates[u].x;case Lt.Y:return this._coordinates[u].y;case Lt.Z:return this._coordinates[u].z}return ce.NaN},un.prototype.getCoordinate=function(){if(1===arguments.length)return this._coordinates[arguments[0]];if(2===arguments.length){var h=arguments[0],y=arguments[1];y.x=this._coordinates[h].x,y.y=this._coordinates[h].y,y.z=this._coordinates[h].z}},un.prototype.getCoordinateCopy=function(u){return new J(this._coordinates[u])},un.prototype.getDimension=function(){return this._dimension},un.prototype.getX=function(u){return this._coordinates[u].x},un.prototype.clone=function(){for(var u=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)u[h]=this._coordinates[h].clone();return new un(u,this._dimension)},un.prototype.expandEnvelope=function(u){for(var h=0;h<this._coordinates.length;h++)u.expandToInclude(this._coordinates[h]);return u},un.prototype.copy=function(){for(var u=new Array(this.size()).fill(null),h=0;h<this._coordinates.length;h++)u[h]=this._coordinates[h].copy();return new un(u,this._dimension)},un.prototype.toString=function(){if(this._coordinates.length>0){var u=new Me(17*this._coordinates.length);u.append("("),u.append(this._coordinates[0]);for(var h=1;h<this._coordinates.length;h++)u.append(", "),u.append(this._coordinates[h]);return u.append(")"),u.toString()}return"()"},un.prototype.getY=function(u){return this._coordinates[u].y},un.prototype.toCoordinateArray=function(){return this._coordinates},un.prototype.interfaces_=function(){return[Lt,Ee]},un.prototype.getClass=function(){return un},qn.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(un,qn);var vr=function(){},Cu={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};vr.prototype.readResolve=function(){return vr.instance()},vr.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new un(arguments[0]);if(At(arguments[0],Lt))return new un(arguments[0])}else if(2===arguments.length){var y=arguments[0],x=arguments[1];return x>3&&(x=3),x<2?new un(y):new un(y,x)}},vr.prototype.interfaces_=function(){return[qe,Ee]},vr.prototype.getClass=function(){return vr},vr.instance=function(){return vr.instanceObject},Cu.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Cu.instanceObject.get=function(){return new vr},Object.defineProperties(vr,Cu);var pl=function(u){function h(){u.call(this),this.map_=new Map}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.get=function(y){return this.map_.get(y)||null},h.prototype.put=function(y,x){return this.map_.set(y,x),x},h.prototype.values=function(){for(var y=new gn,x=this.map_.values(),T=x.next();!T.done;)y.add(T.value),T=x.next();return y},h.prototype.entrySet=function(){var y=new Oe;return this.map_.entries().forEach(function(x){return y.add(x)}),y},h.prototype.size=function(){return this.map_.size()},h}(W),Qt=function u(){if(this._modelType=null,this._scale=null,0===arguments.length)this._modelType=u.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Hs){var h=arguments[0];this._modelType=h,h===u.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var y=arguments[0];this._modelType=u.FIXED,this.setScale(y)}else if(arguments[0]instanceof u){var x=arguments[0];this._modelType=x._modelType,this._scale=x._scale}},gl={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Qt.prototype.equals=function(u){return u instanceof Qt&&this._modelType===u._modelType&&this._scale===u._scale},Qt.prototype.compareTo=function(u){var h=u,y=this.getMaximumSignificantDigits(),x=h.getMaximumSignificantDigits();return new tt(y).compareTo(new tt(x))},Qt.prototype.getScale=function(){return this._scale},Qt.prototype.isFloating=function(){return this._modelType===Qt.FLOATING||this._modelType===Qt.FLOATING_SINGLE},Qt.prototype.getType=function(){return this._modelType},Qt.prototype.toString=function(){var u="UNKNOWN";return this._modelType===Qt.FLOATING?u="Floating":this._modelType===Qt.FLOATING_SINGLE?u="Floating-Single":this._modelType===Qt.FIXED&&(u="Fixed (Scale="+this.getScale()+")"),u},Qt.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var u=arguments[0];return ce.isNaN(u)||this._modelType===Qt.FLOATING_SINGLE?u:this._modelType===Qt.FIXED?Math.round(u*this._scale)/this._scale:u}if(arguments[0]instanceof J){var h=arguments[0];if(this._modelType===Qt.FLOATING)return null;h.x=this.makePrecise(h.x),h.y=this.makePrecise(h.y)}},Qt.prototype.getMaximumSignificantDigits=function(){var u=16;return this._modelType===Qt.FLOATING?u=16:this._modelType===Qt.FLOATING_SINGLE?u=6:this._modelType===Qt.FIXED&&(u=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),u},Qt.prototype.setScale=function(u){this._scale=Math.abs(u)},Qt.prototype.interfaces_=function(){return[Ee,de]},Qt.prototype.getClass=function(){return Qt},Qt.mostPrecise=function(u,h){return u.compareTo(h)>=0?u:h},gl.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},gl.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Qt,gl);var Hs=function u(h){this._name=h||null,u.nameToTypeMap.put(h,this)},hc={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Hs.prototype.readResolve=function(){return Hs.nameToTypeMap.get(this._name)},Hs.prototype.toString=function(){return this._name},Hs.prototype.interfaces_=function(){return[Ee]},Hs.prototype.getClass=function(){return Hs},hc.serialVersionUID.get=function(){return-552860263173159e4},hc.nameToTypeMap.get=function(){return new pl},Object.defineProperties(Hs,hc),Qt.Type=Hs,Qt.FIXED=new Hs("FIXED"),Qt.FLOATING=new Hs("FLOATING"),Qt.FLOATING_SINGLE=new Hs("FLOATING SINGLE");var pr=function u(){this._precisionModel=new Qt,this._SRID=0,this._coordinateSequenceFactory=u.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?At(arguments[0],qe)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof Qt&&(this._precisionModel=arguments[0]):2===arguments.length?(this._precisionModel=arguments[0],this._SRID=arguments[1]):3===arguments.length&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},xn={serialVersionUID:{configurable:!0}};pr.prototype.toGeometry=function(u){return u.isNull()?this.createPoint(null):u.getMinX()===u.getMaxX()&&u.getMinY()===u.getMaxY()?this.createPoint(new J(u.getMinX(),u.getMinY())):u.getMinX()===u.getMaxX()||u.getMinY()===u.getMaxY()?this.createLineString([new J(u.getMinX(),u.getMinY()),new J(u.getMaxX(),u.getMaxY())]):this.createPolygon(this.createLinearRing([new J(u.getMinX(),u.getMinY()),new J(u.getMinX(),u.getMaxY()),new J(u.getMaxX(),u.getMaxY()),new J(u.getMaxX(),u.getMinY()),new J(u.getMinX(),u.getMinY())]),null)},pr.prototype.createLineString=function(u){return u?u instanceof Array?new dr(this.getCoordinateSequenceFactory().create(u),this):At(u,Lt)?new dr(u,this):void 0:new dr(this.getCoordinateSequenceFactory().create([]),this)},pr.prototype.createMultiLineString=function(){return 0===arguments.length?new $n(null,this):1===arguments.length?new $n(arguments[0],this):void 0},pr.prototype.buildGeometry=function(u){for(var h=null,y=!1,x=!1,T=u.iterator();T.hasNext();){var k=T.next(),G=k.getClass();null===h&&(h=G),G!==h&&(y=!0),k.isGeometryCollectionOrDerived()&&(x=!0)}if(null===h)return this.createGeometryCollection();if(y||x)return this.createGeometryCollection(pr.toGeometryArray(u));var K=u.iterator().next();if(u.size()>1){if(K instanceof Rt)return this.createMultiPolygon(pr.toPolygonArray(u));if(K instanceof dr)return this.createMultiLineString(pr.toLineStringArray(u));if(K instanceof ps)return this.createMultiPoint(pr.toPointArray(u));ae.shouldNeverReachHere("Unhandled class: "+K.getClass().getName())}return K},pr.prototype.createMultiPointFromCoords=function(u){return this.createMultiPoint(null!==u?this.getCoordinateSequenceFactory().create(u):null)},pr.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof J){var u=arguments[0];return this.createPoint(null!==u?this.getCoordinateSequenceFactory().create([u]):null)}if(At(arguments[0],Lt))return new ps(arguments[0],this)}},pr.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory},pr.prototype.createPolygon=function(){if(0===arguments.length)return new Rt(null,null,this);if(1===arguments.length){if(At(arguments[0],Lt))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof go)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new Rt(arguments[0],arguments[1],this)},pr.prototype.getSRID=function(){return this._SRID},pr.prototype.createGeometryCollection=function(){return 0===arguments.length?new zn(null,this):1===arguments.length?new zn(arguments[0],this):void 0},pr.prototype.createGeometry=function(u){return new Di(this).edit(u,{edit:function(){if(2===arguments.length)return this._coordinateSequenceFactory.create(arguments[0])}})},pr.prototype.getPrecisionModel=function(){return this._precisionModel},pr.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var u=arguments[0];return this.createLinearRing(null!==u?this.getCoordinateSequenceFactory().create(u):null)}if(At(arguments[0],Lt))return new go(arguments[0],this)}},pr.prototype.createMultiPolygon=function(){return 0===arguments.length?new ra(null,this):1===arguments.length?new ra(arguments[0],this):void 0},pr.prototype.createMultiPoint=function(){if(0===arguments.length)return new Na(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Na(arguments[0],this);if(arguments[0]instanceof Array){var h=arguments[0];return this.createMultiPoint(null!==h?this.getCoordinateSequenceFactory().create(h):null)}if(At(arguments[0],Lt)){var y=arguments[0];if(null===y)return this.createMultiPoint(new Array(0).fill(null));for(var x=new Array(y.size()).fill(null),T=0;T<y.size();T++){var k=this.getCoordinateSequenceFactory().create(1,y.getDimension());Nn.copy(y,T,k,0,1),x[T]=this.createPoint(k)}return this.createMultiPoint(x)}}},pr.prototype.interfaces_=function(){return[Ee]},pr.prototype.getClass=function(){return pr},pr.toMultiPolygonArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toGeometryArray=function(u){if(null===u)return null;var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.getDefaultCoordinateSequenceFactory=function(){return vr.instance()},pr.toMultiLineStringArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toLineStringArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toMultiPointArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toLinearRingArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toPointArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.toPolygonArray=function(u){var h=new Array(u.size()).fill(null);return u.toArray(h)},pr.createPointFromInternalCoord=function(u,h){return h.getPrecisionModel().makePrecise(u),h.getFactory().createPoint(u)},xn.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(pr,xn);var Uh=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],gr=function(u){this.geometryFactory=u||new pr};gr.prototype.read=function(u){var h,y=(h="string"==typeof u?JSON.parse(u):u).type;if(!Kr[y])throw new Error("Unknown GeoJSON type: "+h.type);return-1!==Uh.indexOf(y)?Kr[y].apply(this,[h.coordinates]):Kr[y].apply(this,"GeometryCollection"===y?[h.geometries]:[h])},gr.prototype.write=function(u){var h=u.getGeometryType();if(!gs[h])throw new Error("Geometry is not supported");return gs[h].apply(this,[u])};var Kr={Feature:function(u){var h={};for(var y in u)h[y]=u[y];if(u.geometry){if(!Kr[u.geometry.type])throw new Error("Unknown GeoJSON type: "+u.type);h.geometry=this.read(u.geometry)}return u.bbox&&(h.bbox=Kr.bbox.apply(this,[u.bbox])),h},FeatureCollection:function(u){var h={};if(u.features){h.features=[];for(var y=0;y<u.features.length;++y)h.features.push(this.read(u.features[y]))}return u.bbox&&(h.bbox=this.parse.bbox.apply(this,[u.bbox])),h},coordinates:function(u){for(var h=[],y=0;y<u.length;++y){var x=u[y];h.push(new J(x[0],x[1]))}return h},bbox:function(u){return this.geometryFactory.createLinearRing([new J(u[0],u[1]),new J(u[2],u[1]),new J(u[2],u[3]),new J(u[0],u[3]),new J(u[0],u[1])])},Point:function(u){var h=new J(u[0],u[1]);return this.geometryFactory.createPoint(h)},MultiPoint:function(u){for(var h=[],y=0;y<u.length;++y)h.push(Kr.Point.apply(this,[u[y]]));return this.geometryFactory.createMultiPoint(h)},LineString:function(u){var h=Kr.coordinates.apply(this,[u]);return this.geometryFactory.createLineString(h)},MultiLineString:function(u){for(var h=[],y=0;y<u.length;++y)h.push(Kr.LineString.apply(this,[u[y]]));return this.geometryFactory.createMultiLineString(h)},Polygon:function(u){for(var h=Kr.coordinates.apply(this,[u[0]]),y=this.geometryFactory.createLinearRing(h),x=[],T=1;T<u.length;++T){var G=Kr.coordinates.apply(this,[u[T]]),K=this.geometryFactory.createLinearRing(G);x.push(K)}return this.geometryFactory.createPolygon(y,x)},MultiPolygon:function(u){for(var h=[],y=0;y<u.length;++y)h.push(Kr.Polygon.apply(this,[u[y]]));return this.geometryFactory.createMultiPolygon(h)},GeometryCollection:function(u){for(var h=[],y=0;y<u.length;++y)h.push(this.read(u[y]));return this.geometryFactory.createGeometryCollection(h)}},gs={coordinate:function(u){return[u.x,u.y]},Point:function(u){return{type:"Point",coordinates:gs.coordinate.apply(this,[u.getCoordinate()])}},MultiPoint:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=gs.Point.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPoint",coordinates:h}},LineString:function(u){for(var h=[],y=u.getCoordinates(),x=0;x<y.length;++x)h.push(gs.coordinate.apply(this,[y[x]]));return{type:"LineString",coordinates:h}},MultiLineString:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=gs.LineString.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiLineString",coordinates:h}},Polygon:function(u){var h=[],y=gs.LineString.apply(this,[u._shell]);h.push(y.coordinates);for(var x=0;x<u._holes.length;++x){var k=gs.LineString.apply(this,[u._holes[x]]);h.push(k.coordinates)}return{type:"Polygon",coordinates:h}},MultiPolygon:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var T=gs.Polygon.apply(this,[u._geometries[y]]);h.push(T.coordinates)}return{type:"MultiPolygon",coordinates:h}},GeometryCollection:function(u){for(var h=[],y=0;y<u._geometries.length;++y){var x=u._geometries[y],T=x.getGeometryType();h.push(gs[T].apply(this,[x]))}return{type:"GeometryCollection",geometries:h}}},Vh=function(u){this.geometryFactory=u||new pr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new gr(this.geometryFactory)};Vh.prototype.read=function(u){var h=this.parser.read(u);return this.precisionModel.getType()===Qt.FIXED&&this.reducePrecision(h),h},Vh.prototype.reducePrecision=function(u){var h,y;if(u.coordinate)this.precisionModel.makePrecise(u.coordinate);else if(u.points)for(h=0,y=u.points.length;h<y;h++)this.precisionModel.makePrecise(u.points[h]);else if(u.geometries)for(h=0,y=u.geometries.length;h<y;h++)this.reducePrecision(u.geometries[h])};var ch=function(){this.parser=new gr(this.geometryFactory)};ch.prototype.write=function(u){return this.parser.write(u)};var mn=function(){},Ps={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};mn.prototype.interfaces_=function(){return[]},mn.prototype.getClass=function(){return mn},mn.opposite=function(u){return u===mn.LEFT?mn.RIGHT:u===mn.RIGHT?mn.LEFT:u},Ps.ON.get=function(){return 0},Ps.LEFT.get=function(){return 1},Ps.RIGHT.get=function(){return 2},Object.defineProperties(mn,Ps),(he.prototype=new Error).name="EmptyStackException",(Ie.prototype=new ts).add=function(u){return this.array_.push(u),!0},Ie.prototype.get=function(u){if(u<0||u>=this.size())throw new Error;return this.array_[u]},Ie.prototype.push=function(u){return this.array_.push(u),u},Ie.prototype.pop=function(u){if(0===this.array_.length)throw new he;return this.array_.pop()},Ie.prototype.peek=function(){if(0===this.array_.length)throw new he;return this.array_[this.array_.length-1]},Ie.prototype.empty=function(){return 0===this.array_.length},Ie.prototype.isEmpty=function(){return this.empty()},Ie.prototype.search=function(u){return this.array_.indexOf(u)},Ie.prototype.size=function(){return this.array_.length},Ie.prototype.toArray=function(){for(var u=[],h=0,y=this.array_.length;h<y;h++)u.push(this.array_[h]);return u};var ka=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};ka.prototype.getCoordinate=function(){return this._minCoord},ka.prototype.getRightmostSide=function(u,h){var y=this.getRightmostSideOfSegment(u,h);return y<0&&(y=this.getRightmostSideOfSegment(u,h-1)),y<0&&(this._minCoord=null,this.checkForRightmostCoordinate(u)),y},ka.prototype.findRightmostEdgeAtVertex=function(){var u=this._minDe.getEdge().getCoordinates();ae.isTrue(this._minIndex>0&&this._minIndex<u.length,"rightmost point expected to be interior vertex of edge");var h=u[this._minIndex-1],y=u[this._minIndex+1],x=Gt.computeOrientation(this._minCoord,y,h),T=!1;(h.y<this._minCoord.y&&y.y<this._minCoord.y&&x===Gt.COUNTERCLOCKWISE||h.y>this._minCoord.y&&y.y>this._minCoord.y&&x===Gt.CLOCKWISE)&&(T=!0),T&&(this._minIndex=this._minIndex-1)},ka.prototype.getRightmostSideOfSegment=function(u,h){var y=u.getEdge().getCoordinates();if(h<0||h+1>=y.length||y[h].y===y[h+1].y)return-1;var x=mn.LEFT;return y[h].y<y[h+1].y&&(x=mn.RIGHT),x},ka.prototype.getEdge=function(){return this._orientedDe},ka.prototype.checkForRightmostCoordinate=function(u){for(var h=u.getEdge().getCoordinates(),y=0;y<h.length-1;y++)(null===this._minCoord||h[y].x>this._minCoord.x)&&(this._minDe=u,this._minIndex=y,this._minCoord=h[y])},ka.prototype.findRightmostEdgeAtNode=function(){var u=this._minDe.getNode().getEdges();this._minDe=u.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)},ka.prototype.findEdge=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next();y.isForward()&&this.checkForRightmostCoordinate(y)}ae.isTrue(0!==this._minIndex||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),0===this._minIndex?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe,this.getRightmostSide(this._minDe,this._minIndex)===mn.LEFT&&(this._orientedDe=this._minDe.getSym())},ka.prototype.interfaces_=function(){return[]},ka.prototype.getClass=function(){return ka};var ba=function(u){function h(y,x){u.call(this,h.msgWithCoord(y,x)),this.pt=x?new J(x):null,this.name="TopologyException"}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getCoordinate=function(){return this.pt},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.msgWithCoord=function(y,x){return x?y:y+" [ "+x+" ]"},h}(ye),ia=function(){this.array_=[]};ia.prototype.addLast=function(u){this.array_.push(u)},ia.prototype.removeFirst=function(){return this.array_.shift()},ia.prototype.isEmpty=function(){return 0===this.array_.length};var Ur=function(){this._finder=null,this._dirEdgeList=new gn,this._nodes=new gn,this._rightMostCoord=null,this._env=null,this._finder=new ka};Ur.prototype.clearVisitedEdges=function(){for(var u=this._dirEdgeList.iterator();u.hasNext();)u.next().setVisited(!1)},Ur.prototype.getRightmostCoordinate=function(){return this._rightMostCoord},Ur.prototype.computeNodeDepth=function(u){for(var h=null,y=u.getEdges().iterator();y.hasNext();){var x=y.next();if(x.isVisited()||x.getSym().isVisited()){h=x;break}}if(null===h)throw new ba("unable to find edge to compute depths at "+u.getCoordinate());u.getEdges().computeDepths(h);for(var T=u.getEdges().iterator();T.hasNext();){var k=T.next();k.setVisited(!0),this.copySymDepths(k)}},Ur.prototype.computeDepth=function(u){this.clearVisitedEdges();var h=this._finder.getEdge();h.setEdgeDepths(mn.RIGHT,u),this.copySymDepths(h),this.computeDepths(h)},Ur.prototype.create=function(u){this.addReachable(u),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()},Ur.prototype.findResultEdges=function(){for(var u=this._dirEdgeList.iterator();u.hasNext();){var h=u.next();h.getDepth(mn.RIGHT)>=1&&h.getDepth(mn.LEFT)<=0&&!h.isInteriorAreaEdge()&&h.setInResult(!0)}},Ur.prototype.computeDepths=function(u){var h=new Oe,y=new ia,x=u.getNode();for(y.addLast(x),h.add(x),u.setVisited(!0);!y.isEmpty();){var T=y.removeFirst();h.add(T),this.computeNodeDepth(T);for(var k=T.getEdges().iterator();k.hasNext();){var G=k.next().getSym();if(!G.isVisited()){var K=G.getNode();h.contains(K)||(y.addLast(K),h.add(K))}}}},Ur.prototype.compareTo=function(u){return this._rightMostCoord.x<u._rightMostCoord.x?-1:this._rightMostCoord.x>u._rightMostCoord.x?1:0},Ur.prototype.getEnvelope=function(){if(null===this._env){for(var u=new hn,h=this._dirEdgeList.iterator();h.hasNext();)for(var y=h.next().getEdge().getCoordinates(),x=0;x<y.length-1;x++)u.expandToInclude(y[x]);this._env=u}return this._env},Ur.prototype.addReachable=function(u){var h=new Ie;for(h.add(u);!h.empty();){var y=h.pop();this.add(y,h)}},Ur.prototype.copySymDepths=function(u){var h=u.getSym();h.setDepth(mn.LEFT,u.getDepth(mn.RIGHT)),h.setDepth(mn.RIGHT,u.getDepth(mn.LEFT))},Ur.prototype.add=function(u,h){u.setVisited(!0),this._nodes.add(u);for(var y=u.getEdges().iterator();y.hasNext();){var x=y.next();this._dirEdgeList.add(x);var T=x.getSym().getNode();T.isVisited()||h.push(T)}},Ur.prototype.getNodes=function(){return this._nodes},Ur.prototype.getDirectedEdges=function(){return this._dirEdgeList},Ur.prototype.interfaces_=function(){return[de]},Ur.prototype.getClass=function(){return Ur};var oo=function u(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var y=arguments[0];this.init(1),this.location[mn.ON]=y}else if(arguments[0]instanceof u){var x=arguments[0];if(this.init(x.location.length),null!==x)for(var T=0;T<this.location.length;T++)this.location[T]=x.location[T]}}else if(3===arguments.length){var k=arguments[0],G=arguments[1],K=arguments[2];this.init(3),this.location[mn.ON]=k,this.location[mn.LEFT]=G,this.location[mn.RIGHT]=K}};oo.prototype.setAllLocations=function(u){for(var h=0;h<this.location.length;h++)this.location[h]=u},oo.prototype.isNull=function(){for(var u=0;u<this.location.length;u++)if(this.location[u]!==ue.NONE)return!1;return!0},oo.prototype.setAllLocationsIfNull=function(u){for(var h=0;h<this.location.length;h++)this.location[h]===ue.NONE&&(this.location[h]=u)},oo.prototype.isLine=function(){return 1===this.location.length},oo.prototype.merge=function(u){if(u.location.length>this.location.length){var h=new Array(3).fill(null);h[mn.ON]=this.location[mn.ON],h[mn.LEFT]=ue.NONE,h[mn.RIGHT]=ue.NONE,this.location=h}for(var y=0;y<this.location.length;y++)this.location[y]===ue.NONE&&y<u.location.length&&(this.location[y]=u.location[y])},oo.prototype.getLocations=function(){return this.location},oo.prototype.flip=function(){if(this.location.length<=1)return null;var u=this.location[mn.LEFT];this.location[mn.LEFT]=this.location[mn.RIGHT],this.location[mn.RIGHT]=u},oo.prototype.toString=function(){var u=new Me;return this.location.length>1&&u.append(ue.toLocationSymbol(this.location[mn.LEFT])),u.append(ue.toLocationSymbol(this.location[mn.ON])),this.location.length>1&&u.append(ue.toLocationSymbol(this.location[mn.RIGHT])),u.toString()},oo.prototype.setLocations=function(u,h,y){this.location[mn.ON]=u,this.location[mn.LEFT]=h,this.location[mn.RIGHT]=y},oo.prototype.get=function(u){return u<this.location.length?this.location[u]:ue.NONE},oo.prototype.isArea=function(){return this.location.length>1},oo.prototype.isAnyNull=function(){for(var u=0;u<this.location.length;u++)if(this.location[u]===ue.NONE)return!0;return!1},oo.prototype.setLocation=function(){1===arguments.length?this.setLocation(mn.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},oo.prototype.init=function(u){this.location=new Array(u).fill(null),this.setAllLocations(ue.NONE)},oo.prototype.isEqualOnSide=function(u,h){return this.location[h]===u.location[h]},oo.prototype.allPositionsEqual=function(u){for(var h=0;h<this.location.length;h++)if(this.location[h]!==u)return!1;return!0},oo.prototype.interfaces_=function(){return[]},oo.prototype.getClass=function(){return oo};var gi=function u(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var h=arguments[0];this.elt[0]=new oo(h),this.elt[1]=new oo(h)}else if(arguments[0]instanceof u){var y=arguments[0];this.elt[0]=new oo(y.elt[0]),this.elt[1]=new oo(y.elt[1])}}else if(2===arguments.length){var x=arguments[0],T=arguments[1];this.elt[0]=new oo(ue.NONE),this.elt[1]=new oo(ue.NONE),this.elt[x].setLocation(T)}else if(3===arguments.length){var k=arguments[0],G=arguments[1],K=arguments[2];this.elt[0]=new oo(k,G,K),this.elt[1]=new oo(k,G,K)}else if(4===arguments.length){var re=arguments[0],et=arguments[1],Ft=arguments[2],$t=arguments[3];this.elt[0]=new oo(ue.NONE,ue.NONE,ue.NONE),this.elt[1]=new oo(ue.NONE,ue.NONE,ue.NONE),this.elt[re].setLocations(et,Ft,$t)}};gi.prototype.getGeometryCount=function(){var u=0;return this.elt[0].isNull()||u++,this.elt[1].isNull()||u++,u},gi.prototype.setAllLocations=function(u,h){this.elt[u].setAllLocations(h)},gi.prototype.isNull=function(u){return this.elt[u].isNull()},gi.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var u=arguments[0];this.setAllLocationsIfNull(0,u),this.setAllLocationsIfNull(1,u)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},gi.prototype.isLine=function(u){return this.elt[u].isLine()},gi.prototype.merge=function(u){for(var h=0;h<2;h++)null===this.elt[h]&&null!==u.elt[h]?this.elt[h]=new oo(u.elt[h]):this.elt[h].merge(u.elt[h])},gi.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},gi.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(mn.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},gi.prototype.toString=function(){var u=new Me;return null!==this.elt[0]&&(u.append("A:"),u.append(this.elt[0].toString())),null!==this.elt[1]&&(u.append(" B:"),u.append(this.elt[1].toString())),u.toString()},gi.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},gi.prototype.isAnyNull=function(u){return this.elt[u].isAnyNull()},gi.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(mn.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},gi.prototype.isEqualOnSide=function(u,h){return this.elt[0].isEqualOnSide(u.elt[0],h)&&this.elt[1].isEqualOnSide(u.elt[1],h)},gi.prototype.allPositionsEqual=function(u,h){return this.elt[u].allPositionsEqual(h)},gi.prototype.toLine=function(u){this.elt[u].isArea()&&(this.elt[u]=new oo(this.elt[u].location[0]))},gi.prototype.interfaces_=function(){return[]},gi.prototype.getClass=function(){return gi},gi.toLineLabel=function(u){for(var h=new gi(ue.NONE),y=0;y<2;y++)h.setLocation(y,u.getLocation(y));return h};var hi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new gn,this._pts=new gn,this._label=new gi(ue.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new gn,this._geometryFactory=null;var u=arguments[0];this._geometryFactory=arguments[1],this.computePoints(u),this.computeRing()};hi.prototype.computeRing=function(){if(null!==this._ring)return null;for(var u=new Array(this._pts.size()).fill(null),h=0;h<this._pts.size();h++)u[h]=this._pts.get(h);this._ring=this._geometryFactory.createLinearRing(u),this._isHole=Gt.isCCW(this._ring.getCoordinates())},hi.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},hi.prototype.computePoints=function(u){this._startDe=u;var h=u,y=!0;do{if(null===h)throw new ba("Found null DirectedEdge");if(h.getEdgeRing()===this)throw new ba("Directed Edge visited twice during ring-building at "+h.getCoordinate());this._edges.add(h);var x=h.getLabel();ae.isTrue(x.isArea()),this.mergeLabel(x),this.addPoints(h.getEdge(),h.isForward(),y),y=!1,this.setEdgeRing(h,this),h=this.getNext(h)}while(h!==this._startDe)},hi.prototype.getLinearRing=function(){return this._ring},hi.prototype.getCoordinate=function(u){return this._pts.get(u)},hi.prototype.computeMaxNodeDegree=function(){this._maxNodeDegree=0;var u=this._startDe;do{var h=u.getNode().getEdges().getOutgoingDegree(this);h>this._maxNodeDegree&&(this._maxNodeDegree=h),u=this.getNext(u)}while(u!==this._startDe);this._maxNodeDegree*=2},hi.prototype.addPoints=function(u,h,y){var x=u.getCoordinates();if(h){var T=1;y&&(T=0);for(var k=T;k<x.length;k++)this._pts.add(x[k])}else{var G=x.length-2;y&&(G=x.length-1);for(var K=G;K>=0;K--)this._pts.add(x[K])}},hi.prototype.isHole=function(){return this._isHole},hi.prototype.setInResult=function(){var u=this._startDe;do{u.getEdge().setInResult(!0),u=u.getNext()}while(u!==this._startDe)},hi.prototype.containsPoint=function(u){var h=this.getLinearRing();if(!h.getEnvelopeInternal().contains(u)||!Gt.isPointInRing(u,h.getCoordinates()))return!1;for(var y=this._holes.iterator();y.hasNext();)if(y.next().containsPoint(u))return!1;return!0},hi.prototype.addHole=function(u){this._holes.add(u)},hi.prototype.isShell=function(){return null===this._shell},hi.prototype.getLabel=function(){return this._label},hi.prototype.getEdges=function(){return this._edges},hi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree},hi.prototype.getShell=function(){return this._shell},hi.prototype.mergeLabel=function(){if(1===arguments.length){var u=arguments[0];this.mergeLabel(u,0),this.mergeLabel(u,1)}else if(2===arguments.length){var y=arguments[1],x=arguments[0].getLocation(y,mn.RIGHT);if(x===ue.NONE)return null;if(this._label.getLocation(y)===ue.NONE)return this._label.setLocation(y,x),null}},hi.prototype.setShell=function(u){this._shell=u,null!==u&&u.addHole(this)},hi.prototype.toPolygon=function(u){for(var h=new Array(this._holes.size()).fill(null),y=0;y<this._holes.size();y++)h[y]=this._holes.get(y).getLinearRing();return u.createPolygon(this.getLinearRing(),h)},hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi};var lu=function(u){function h(){u.call(this,arguments[0],arguments[1])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.setEdgeRing=function(y,x){y.setMinEdgeRing(x)},h.prototype.getNext=function(y){return y.getNextMin()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(hi),ad=function(u){function h(){u.call(this,arguments[0],arguments[1])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.buildMinimalRings=function(){var y=new gn,x=this._startDe;do{if(null===x.getMinEdgeRing()){var T=new lu(x,this._geometryFactory);y.add(T)}x=x.getNext()}while(x!==this._startDe);return y},h.prototype.setEdgeRing=function(y,x){y.setEdgeRing(x)},h.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var y=this._startDe;do{y.getNode().getEdges().linkMinimalDirectedEdges(this),y=y.getNext()}while(y!==this._startDe)},h.prototype.getNext=function(y){return y.getNext()},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(hi),Rs=function(){this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,0!==arguments.length&&1===arguments.length&&(this._label=arguments[0])};Rs.prototype.setVisited=function(u){this._isVisited=u},Rs.prototype.setInResult=function(u){this._isInResult=u},Rs.prototype.isCovered=function(){return this._isCovered},Rs.prototype.isCoveredSet=function(){return this._isCoveredSet},Rs.prototype.setLabel=function(u){this._label=u},Rs.prototype.getLabel=function(){return this._label},Rs.prototype.setCovered=function(u){this._isCovered=u,this._isCoveredSet=!0},Rs.prototype.updateIM=function(u){ae.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(u)},Rs.prototype.isInResult=function(){return this._isInResult},Rs.prototype.isVisited=function(){return this._isVisited},Rs.prototype.interfaces_=function(){return[]},Rs.prototype.getClass=function(){return Rs};var ms=function(u){function h(){u.call(this),this._coord=null,this._edges=null;var x=arguments[1];this._coord=arguments[0],this._edges=x,this._label=new gi(0,ue.NONE)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isIncidentEdgeInResult=function(){for(var y=this.getEdges().getEdges().iterator();y.hasNext();)if(y.next().getEdge().isInResult())return!0;return!1},h.prototype.isIsolated=function(){return 1===this._label.getGeometryCount()},h.prototype.getCoordinate=function(){return this._coord},h.prototype.print=function(y){y.println("node "+this._coord+" lbl: "+this._label)},h.prototype.computeIM=function(y){},h.prototype.computeMergedLocation=function(y,x){var T=ue.NONE;if(T=this._label.getLocation(x),!y.isNull(x)){var k=y.getLocation(x);T!==ue.BOUNDARY&&(T=k)}return T},h.prototype.setLabel=function(){if(2!==arguments.length)return u.prototype.setLabel.apply(this,arguments);var y=arguments[0],x=arguments[1];null===this._label?this._label=new gi(y,x):this._label.setLocation(y,x)},h.prototype.getEdges=function(){return this._edges},h.prototype.mergeLabel=function(){if(arguments[0]instanceof h)this.mergeLabel(arguments[0]._label);else if(arguments[0]instanceof gi)for(var x=arguments[0],T=0;T<2;T++){var k=this.computeMergedLocation(x,T);this._label.getLocation(T)===ue.NONE&&this._label.setLocation(T,k)}},h.prototype.add=function(y){this._edges.insert(y),y.setNode(this)},h.prototype.setLabelBoundary=function(y){if(null===this._label)return null;var x=ue.NONE;null!==this._label&&(x=this._label.getLocation(y)),this._label.setLocation(y,x===ue.BOUNDARY?ue.INTERIOR:ue.BOUNDARY)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Rs),Fa=function(){this.nodeMap=new Ot,this.nodeFact=null,this.nodeFact=arguments[0]};Fa.prototype.find=function(u){return this.nodeMap.get(u)},Fa.prototype.addNode=function(){if(arguments[0]instanceof J){var u=arguments[0],h=this.nodeMap.get(u);return null===h&&(h=this.nodeFact.createNode(u),this.nodeMap.put(u,h)),h}if(arguments[0]instanceof ms){var y=arguments[0],x=this.nodeMap.get(y.getCoordinate());return null===x?(this.nodeMap.put(y.getCoordinate(),y),y):(x.mergeLabel(y),x)}},Fa.prototype.print=function(u){for(var h=this.iterator();h.hasNext();)h.next().print(u)},Fa.prototype.iterator=function(){return this.nodeMap.values().iterator()},Fa.prototype.values=function(){return this.nodeMap.values()},Fa.prototype.getBoundaryNodes=function(u){for(var h=new gn,y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().getLocation(u)===ue.BOUNDARY&&h.add(x)}return h},Fa.prototype.add=function(u){var h=u.getCoordinate();this.addNode(h).add(u)},Fa.prototype.interfaces_=function(){return[]},Fa.prototype.getClass=function(){return Fa};var Vr=function(){},li={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Vr.prototype.interfaces_=function(){return[]},Vr.prototype.getClass=function(){return Vr},Vr.isNorthern=function(u){return u===Vr.NE||u===Vr.NW},Vr.isOpposite=function(u,h){return u!==h&&(u-h+4)%4==2},Vr.commonHalfPlane=function(u,h){if(u===h)return u;if((u-h+4)%4==2)return-1;var y=u<h?u:h;return 0===y&&3===(u>h?u:h)?3:y},Vr.isInHalfPlane=function(u,h){return h===Vr.SE?u===Vr.SE||u===Vr.SW:u===h||u===h+1},Vr.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1];if(0===u&&0===h)throw new Y("Cannot compute the quadrant for point ( "+u+", "+h+" )");return u>=0?h>=0?Vr.NE:Vr.SE:h>=0?Vr.NW:Vr.SW}if(arguments[0]instanceof J&&arguments[1]instanceof J){var y=arguments[0],x=arguments[1];if(x.x===y.x&&x.y===y.y)throw new Y("Cannot compute the quadrant for two identical points "+y);return x.x>=y.x?x.y>=y.y?Vr.NE:Vr.SE:x.y>=y.y?Vr.NW:Vr.SW}},li.NE.get=function(){return 0},li.NW.get=function(){return 1},li.SW.get=function(){return 2},li.SE.get=function(){return 3},Object.defineProperties(Vr,li);var Ci=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,1===arguments.length)this._edge=arguments[0];else if(3===arguments.length){var y=arguments[1],x=arguments[2];this._edge=arguments[0],this.init(y,x),this._label=null}else if(4===arguments.length){var k=arguments[1],G=arguments[2],K=arguments[3];this._edge=arguments[0],this.init(k,G),this._label=K}};Ci.prototype.compareDirection=function(u){return this._dx===u._dx&&this._dy===u._dy?0:this._quadrant>u._quadrant?1:this._quadrant<u._quadrant?-1:Gt.computeOrientation(u._p0,u._p1,this._p1)},Ci.prototype.getDy=function(){return this._dy},Ci.prototype.getCoordinate=function(){return this._p0},Ci.prototype.setNode=function(u){this._node=u},Ci.prototype.print=function(u){var h=Math.atan2(this._dy,this._dx),y=this.getClass().getName(),x=y.lastIndexOf("."),T=y.substring(x+1);u.print("  "+T+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+h+"   "+this._label)},Ci.prototype.compareTo=function(u){return this.compareDirection(u)},Ci.prototype.getDirectedCoordinate=function(){return this._p1},Ci.prototype.getDx=function(){return this._dx},Ci.prototype.getLabel=function(){return this._label},Ci.prototype.getEdge=function(){return this._edge},Ci.prototype.getQuadrant=function(){return this._quadrant},Ci.prototype.getNode=function(){return this._node},Ci.prototype.toString=function(){var u=Math.atan2(this._dy,this._dx),h=this.getClass().getName(),y=h.lastIndexOf(".");return"  "+h.substring(y+1)+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+u+"   "+this._label},Ci.prototype.computeLabel=function(u){},Ci.prototype.init=function(u,h){this._p0=u,this._p1=h,this._dx=h.x-u.x,this._dy=h.y-u.y,this._quadrant=Vr.quadrant(this._dx,this._dy),ae.isTrue(!(0===this._dx&&0===this._dy),"EdgeEnd with identical endpoints found")},Ci.prototype.interfaces_=function(){return[de]},Ci.prototype.getClass=function(){return Ci};var jh=function(u){function h(){var y=arguments[0],x=arguments[1];if(u.call(this,y),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=x,x)this.init(y.getCoordinate(0),y.getCoordinate(1));else{var T=y.getNumPoints()-1;this.init(y.getCoordinate(T),y.getCoordinate(T-1))}this.computeDirectedLabel()}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getNextMin=function(){return this._nextMin},h.prototype.getDepth=function(y){return this._depth[y]},h.prototype.setVisited=function(y){this._isVisited=y},h.prototype.computeDirectedLabel=function(){this._label=new gi(this._edge.getLabel()),this._isForward||this._label.flip()},h.prototype.getNext=function(){return this._next},h.prototype.setDepth=function(y,x){if(-999!==this._depth[y]&&this._depth[y]!==x)throw new ba("assigned depths do not match",this.getCoordinate());this._depth[y]=x},h.prototype.isInteriorAreaEdge=function(){for(var y=!0,x=0;x<2;x++)this._label.isArea(x)&&this._label.getLocation(x,mn.LEFT)===ue.INTERIOR&&this._label.getLocation(x,mn.RIGHT)===ue.INTERIOR||(y=!1);return y},h.prototype.setNextMin=function(y){this._nextMin=y},h.prototype.print=function(y){u.prototype.print.call(this,y),y.print(" "+this._depth[mn.LEFT]+"/"+this._depth[mn.RIGHT]),y.print(" ("+this.getDepthDelta()+")"),this._isInResult&&y.print(" inResult")},h.prototype.setMinEdgeRing=function(y){this._minEdgeRing=y},h.prototype.isLineEdge=function(){var y=this._label.isLine(0)||this._label.isLine(1),x=!this._label.isArea(0)||this._label.allPositionsEqual(0,ue.EXTERIOR),T=!this._label.isArea(1)||this._label.allPositionsEqual(1,ue.EXTERIOR);return y&&x&&T},h.prototype.setEdgeRing=function(y){this._edgeRing=y},h.prototype.getMinEdgeRing=function(){return this._minEdgeRing},h.prototype.getDepthDelta=function(){var y=this._edge.getDepthDelta();return this._isForward||(y=-y),y},h.prototype.setInResult=function(y){this._isInResult=y},h.prototype.getSym=function(){return this._sym},h.prototype.isForward=function(){return this._isForward},h.prototype.getEdge=function(){return this._edge},h.prototype.printEdge=function(y){this.print(y),y.print(" "),this._isForward?this._edge.print(y):this._edge.printReverse(y)},h.prototype.setSym=function(y){this._sym=y},h.prototype.setVisitedEdge=function(y){this.setVisited(y),this._sym.setVisited(y)},h.prototype.setEdgeDepths=function(y,x){var T=this.getEdge().getDepthDelta();this._isForward||(T=-T);var k=1;y===mn.LEFT&&(k=-1);var G=mn.opposite(y),K=x+T*k;this.setDepth(y,x),this.setDepth(G,K)},h.prototype.getEdgeRing=function(){return this._edgeRing},h.prototype.isInResult=function(){return this._isInResult},h.prototype.setNext=function(y){this._next=y},h.prototype.isVisited=function(){return this._isVisited},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.depthFactor=function(y,x){return y===ue.EXTERIOR&&x===ue.INTERIOR?1:y===ue.INTERIOR&&x===ue.EXTERIOR?-1:0},h}(Ci),fc=function(){};fc.prototype.createNode=function(u){return new ms(u,null)},fc.prototype.interfaces_=function(){return[]},fc.prototype.getClass=function(){return fc};var kn=function(){this._edges=new gn,this._nodes=null,this._edgeEndList=new gn,0===arguments.length?this._nodes=new Fa(new fc):1===arguments.length&&(this._nodes=new Fa(arguments[0]))};kn.prototype.printEdges=function(u){u.println("Edges:");for(var h=0;h<this._edges.size();h++){u.println("edge "+h+":");var y=this._edges.get(h);y.print(u),y.eiList.print(u)}},kn.prototype.find=function(u){return this._nodes.find(u)},kn.prototype.addNode=function(){return arguments[0]instanceof ms||arguments[0]instanceof J?this._nodes.addNode(arguments[0]):void 0},kn.prototype.getNodeIterator=function(){return this._nodes.iterator()},kn.prototype.linkResultDirectedEdges=function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkResultDirectedEdges()},kn.prototype.debugPrintln=function(u){vn.out.println(u)},kn.prototype.isBoundaryNode=function(u,h){var y=this._nodes.find(h);if(null===y)return!1;var x=y.getLabel();return null!==x&&x.getLocation(u)===ue.BOUNDARY},kn.prototype.linkAllDirectedEdges=function(){for(var u=this._nodes.iterator();u.hasNext();)u.next().getEdges().linkAllDirectedEdges()},kn.prototype.matchInSameDirection=function(u,h,y,x){return!!u.equals(y)&&Gt.computeOrientation(u,h,x)===Gt.COLLINEAR&&Vr.quadrant(u,h)===Vr.quadrant(y,x)},kn.prototype.getEdgeEnds=function(){return this._edgeEndList},kn.prototype.debugPrint=function(u){vn.out.print(u)},kn.prototype.getEdgeIterator=function(){return this._edges.iterator()},kn.prototype.findEdgeInSameDirection=function(u,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(this.matchInSameDirection(u,h,T[0],T[1])||this.matchInSameDirection(u,h,T[T.length-1],T[T.length-2]))return x}return null},kn.prototype.insertEdge=function(u){this._edges.add(u)},kn.prototype.findEdgeEnd=function(u){for(var h=this.getEdgeEnds().iterator();h.hasNext();){var y=h.next();if(y.getEdge()===u)return y}return null},kn.prototype.addEdges=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next();this._edges.add(y);var x=new jh(y,!0),T=new jh(y,!1);x.setSym(T),T.setSym(x),this.add(x),this.add(T)}},kn.prototype.add=function(u){this._nodes.add(u),this._edgeEndList.add(u)},kn.prototype.getNodes=function(){return this._nodes.values()},kn.prototype.findEdge=function(u,h){for(var y=0;y<this._edges.size();y++){var x=this._edges.get(y),T=x.getCoordinates();if(u.equals(T[0])&&h.equals(T[1]))return x}return null},kn.prototype.interfaces_=function(){return[]},kn.prototype.getClass=function(){return kn},kn.linkResultDirectedEdges=function(u){for(var h=u.iterator();h.hasNext();)h.next().getEdges().linkResultDirectedEdges()};var ws=function(){this._geometryFactory=null,this._shellList=new gn,this._geometryFactory=arguments[0]};ws.prototype.sortShellsAndHoles=function(u,h,y){for(var x=u.iterator();x.hasNext();){var T=x.next();T.isHole()?y.add(T):h.add(T)}},ws.prototype.computePolygons=function(u){for(var h=new gn,y=u.iterator();y.hasNext();){var x=y.next().toPolygon(this._geometryFactory);h.add(x)}return h},ws.prototype.placeFreeHoles=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next();if(null===x.getShell()){var T=this.findEdgeRingContaining(x,u);if(null===T)throw new ba("unable to assign hole to a shell",x.getCoordinate(0));x.setShell(T)}}},ws.prototype.buildMinimalEdgeRings=function(u,h,y){for(var x=new gn,T=u.iterator();T.hasNext();){var k=T.next();if(k.getMaxNodeDegree()>2){k.linkDirectedEdgesForMinimalEdgeRings();var G=k.buildMinimalRings(),K=this.findShell(G);null!==K?(this.placePolygonHoles(K,G),h.add(K)):y.addAll(G)}else x.add(k)}return x},ws.prototype.containsPoint=function(u){for(var h=this._shellList.iterator();h.hasNext();)if(h.next().containsPoint(u))return!0;return!1},ws.prototype.buildMaximalEdgeRings=function(u){for(var h=new gn,y=u.iterator();y.hasNext();){var x=y.next();if(x.isInResult()&&x.getLabel().isArea()&&null===x.getEdgeRing()){var T=new ad(x,this._geometryFactory);h.add(T),T.setInResult()}}return h},ws.prototype.placePolygonHoles=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next();x.isHole()&&x.setShell(u)}},ws.prototype.getPolygons=function(){return this.computePolygons(this._shellList)},ws.prototype.findEdgeRingContaining=function(u,h){for(var y=u.getLinearRing(),x=y.getEnvelopeInternal(),T=y.getCoordinateN(0),k=null,G=null,K=h.iterator();K.hasNext();){var re=K.next(),et=re.getLinearRing(),Ft=et.getEnvelopeInternal();null!==k&&(G=k.getLinearRing().getEnvelopeInternal());var $t=!1;Ft.contains(x)&&Gt.isPointInRing(T,et.getCoordinates())&&($t=!0),$t&&(null===k||G.contains(Ft))&&(k=re)}return k},ws.prototype.findShell=function(u){for(var h=0,y=null,x=u.iterator();x.hasNext();){var T=x.next();T.isHole()||(y=T,h++)}return ae.isTrue(h<=1,"found two shells in MinimalEdgeRing list"),y},ws.prototype.add=function(){if(1===arguments.length){var u=arguments[0];this.add(u.getEdgeEnds(),u.getNodes())}else if(2===arguments.length){var h=arguments[0];kn.linkResultDirectedEdges(arguments[1]);var x=this.buildMaximalEdgeRings(h),T=new gn,k=this.buildMinimalEdgeRings(x,this._shellList,T);this.sortShellsAndHoles(k,this._shellList,T),this.placeFreeHoles(this._shellList,T)}},ws.prototype.interfaces_=function(){return[]},ws.prototype.getClass=function(){return ws};var Ea=function(){};Ea.prototype.getBounds=function(){},Ea.prototype.interfaces_=function(){return[]},Ea.prototype.getClass=function(){return Ea};var Ca=function(){this._bounds=null,this._item=null;var h=arguments[1];this._bounds=arguments[0],this._item=h};Ca.prototype.getItem=function(){return this._item},Ca.prototype.getBounds=function(){return this._bounds},Ca.prototype.interfaces_=function(){return[Ea,Ee]},Ca.prototype.getClass=function(){return Ca};var Su=function(){this._size=null,this._items=null,this._size=0,this._items=new gn,this._items.add(null)};Su.prototype.poll=function(){if(this.isEmpty())return null;var u=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),u},Su.prototype.size=function(){return this._size},Su.prototype.reorder=function(u){for(var h=null,y=this._items.get(u);2*u<=this._size&&((h=2*u)!==this._size&&this._items.get(h+1).compareTo(this._items.get(h))<0&&h++,this._items.get(h).compareTo(y)<0);u=h)this._items.set(u,this._items.get(h));this._items.set(u,y)},Su.prototype.clear=function(){this._size=0,this._items.clear()},Su.prototype.isEmpty=function(){return 0===this._size},Su.prototype.add=function(u){this._items.add(null),this._size+=1;var h=this._size;for(this._items.set(0,u);u.compareTo(this._items.get(Math.trunc(h/2)))<0;h/=2)this._items.set(h,this._items.get(Math.trunc(h/2)));this._items.set(h,u)},Su.prototype.interfaces_=function(){return[]},Su.prototype.getClass=function(){return Su};var za=function(){};za.prototype.visitItem=function(u){},za.prototype.interfaces_=function(){return[]},za.prototype.getClass=function(){return za};var dc=function(){};dc.prototype.insert=function(u,h){},dc.prototype.remove=function(u,h){},dc.prototype.query=function(){},dc.prototype.interfaces_=function(){return[]},dc.prototype.getClass=function(){return dc};var cs=function(){this._childBoundables=new gn,this._bounds=null,this._level=null,0!==arguments.length&&1===arguments.length&&(this._level=arguments[0])},ml={serialVersionUID:{configurable:!0}};cs.prototype.getLevel=function(){return this._level},cs.prototype.size=function(){return this._childBoundables.size()},cs.prototype.getChildBoundables=function(){return this._childBoundables},cs.prototype.addChildBoundable=function(u){ae.isTrue(null===this._bounds),this._childBoundables.add(u)},cs.prototype.isEmpty=function(){return this._childBoundables.isEmpty()},cs.prototype.getBounds=function(){return null===this._bounds&&(this._bounds=this.computeBounds()),this._bounds},cs.prototype.interfaces_=function(){return[Ea,Ee]},cs.prototype.getClass=function(){return cs},ml.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(cs,ml);var $o=function(){};$o.reverseOrder=function(){return{compare:function(u,h){return h.compareTo(u)}}},$o.min=function(u){return $o.sort(u),u.get(0)},$o.sort=function(u,h){var y=u.toArray();h?at.sort(y,h):at.sort(y);for(var x=u.iterator(),T=0,k=y.length;T<k;T++)x.next(),x.set(y[T])},$o.singletonList=function(u){var h=new gn;return h.add(u),h};var bo=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var h=arguments[1],y=arguments[2];this._boundable1=arguments[0],this._boundable2=h,this._itemDistance=y,this._distance=this.distance()};bo.prototype.expandToQueue=function(u,h){var y=bo.isComposite(this._boundable1),x=bo.isComposite(this._boundable2);if(y&&x)return bo.area(this._boundable1)>bo.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,u,h),null):(this.expand(this._boundable2,this._boundable1,u,h),null);if(y)return this.expand(this._boundable1,this._boundable2,u,h),null;if(x)return this.expand(this._boundable2,this._boundable1,u,h),null;throw new Y("neither boundable is composite")},bo.prototype.isLeaves=function(){return!(bo.isComposite(this._boundable1)||bo.isComposite(this._boundable2))},bo.prototype.compareTo=function(u){return this._distance<u._distance?-1:this._distance>u._distance?1:0},bo.prototype.expand=function(u,h,y,x){for(var T=u.getChildBoundables().iterator();T.hasNext();){var k=T.next(),G=new bo(k,h,this._itemDistance);G.getDistance()<x&&y.add(G)}},bo.prototype.getBoundable=function(u){return 0===u?this._boundable1:this._boundable2},bo.prototype.getDistance=function(){return this._distance},bo.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())},bo.prototype.interfaces_=function(){return[de]},bo.prototype.getClass=function(){return bo},bo.area=function(u){return u.getBounds().getArea()},bo.isComposite=function(u){return u instanceof cs};var Eo=function u(){if(this._root=null,this._built=!1,this._itemBoundables=new gn,this._nodeCapacity=null,0===arguments.length)this._nodeCapacity=u.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var y=arguments[0];ae.isTrue(y>1,"Node capacity must be greater than 1"),this._nodeCapacity=y}},Bc={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Eo.prototype.getNodeCapacity=function(){return this._nodeCapacity},Eo.prototype.lastNode=function(u){return u.get(u.size()-1)},Eo.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this._root));if(1===arguments.length){for(var u=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();y instanceof cs?u+=this.size(y):y instanceof Ca&&(u+=1)}return u}},Eo.prototype.removeItem=function(u,h){for(var y=null,x=u.getChildBoundables().iterator();x.hasNext();){var T=x.next();T instanceof Ca&&T.getItem()===h&&(y=T)}return null!==y&&(u.getChildBoundables().remove(y),!0)},Eo.prototype.itemsTree=function(){if(0===arguments.length){this.build();var u=this.itemsTree(this._root);return null===u?new gn:u}if(1===arguments.length){for(var h=arguments[0],y=new gn,x=h.getChildBoundables().iterator();x.hasNext();){var T=x.next();if(T instanceof cs){var k=this.itemsTree(T);null!==k&&y.add(k)}else T instanceof Ca?y.add(T.getItem()):ae.shouldNeverReachHere()}return y.size()<=0?null:y}},Eo.prototype.insert=function(u,h){ae.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new Ca(u,h))},Eo.prototype.boundablesAtLevel=function(){if(1===arguments.length){var u=arguments[0],h=new gn;return this.boundablesAtLevel(u,this._root,h),h}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];if(ae.isTrue(y>-2),x.getLevel()===y)return T.add(x),null;for(var k=x.getChildBoundables().iterator();k.hasNext();){var G=k.next();G instanceof cs?this.boundablesAtLevel(y,G,T):(ae.isTrue(G instanceof Ca),-1===y&&T.add(G))}return null}},Eo.prototype.query=function(){if(1===arguments.length){var u=arguments[0];this.build();var h=new gn;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.query(u,this._root,h),h}if(2===arguments.length){var y=arguments[0],x=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),y)&&this.query(y,this._root,x)}else if(3===arguments.length)if(At(arguments[2],za)&&arguments[0]instanceof Object&&arguments[1]instanceof cs)for(var T=arguments[0],G=arguments[2],K=arguments[1].getChildBoundables(),re=0;re<K.size();re++){var et=K.get(re);this.getIntersectsOp().intersects(et.getBounds(),T)&&(et instanceof cs?this.query(T,et,G):et instanceof Ca?G.visitItem(et.getItem()):ae.shouldNeverReachHere())}else if(At(arguments[2],ts)&&arguments[0]instanceof Object&&arguments[1]instanceof cs)for(var Ft=arguments[0],gt=arguments[2],nn=arguments[1].getChildBoundables(),Un=0;Un<nn.size();Un++){var Qn=nn.get(Un);this.getIntersectsOp().intersects(Qn.getBounds(),Ft)&&(Qn instanceof cs?this.query(Ft,Qn,gt):Qn instanceof Ca?gt.add(Qn.getItem()):ae.shouldNeverReachHere())}},Eo.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0},Eo.prototype.getRoot=function(){return this.build(),this._root},Eo.prototype.remove=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this._root.getBounds(),u)&&this.remove(u,this._root,h)}if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2],k=this.removeItem(x,T);if(k)return!0;for(var G=null,K=x.getChildBoundables().iterator();K.hasNext();){var re=K.next();if(this.getIntersectsOp().intersects(re.getBounds(),y)&&re instanceof cs&&(k=this.remove(y,re,T))){G=re;break}}return null!==G&&G.getChildBoundables().isEmpty()&&x.getChildBoundables().remove(G),k}},Eo.prototype.createHigherLevels=function(u,h){ae.isTrue(!u.isEmpty());var y=this.createParentBoundables(u,h+1);return 1===y.size()?y.get(0):this.createHigherLevels(y,h+1)},Eo.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(1===arguments.length){for(var u=0,h=arguments[0].getChildBoundables().iterator();h.hasNext();){var y=h.next();if(y instanceof cs){var x=this.depth(y);x>u&&(u=x)}}return u+1}},Eo.prototype.createParentBoundables=function(u,h){ae.isTrue(!u.isEmpty());var y=new gn;y.add(this.createNode(h));var x=new gn(u);$o.sort(x,this.getComparator());for(var T=x.iterator();T.hasNext();){var k=T.next();this.lastNode(y).getChildBoundables().size()===this.getNodeCapacity()&&y.add(this.createNode(h)),this.lastNode(y).addChildBoundable(k)}return y},Eo.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()},Eo.prototype.interfaces_=function(){return[Ee]},Eo.prototype.getClass=function(){return Eo},Eo.compareDoubles=function(u,h){return u>h?1:u<h?-1:0},Bc.IntersectsOp.get=function(){return wr},Bc.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},Bc.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(Eo,Bc);var wr=function(){},da=function(){};da.prototype.distance=function(u,h){},da.prototype.interfaces_=function(){return[]},da.prototype.getClass=function(){return da};var Sf=function(u){function h(x){u.call(this,x=x||h.DEFAULT_NODE_CAPACITY)}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return h.prototype.createParentBoundablesFromVerticalSlices=function(x,T){ae.isTrue(x.length>0);for(var k=new gn,G=0;G<x.length;G++)k.addAll(this.createParentBoundablesFromVerticalSlice(x[G],T));return k},h.prototype.createNode=function(x){return new Sa(x)},h.prototype.size=function(){return 0===arguments.length?u.prototype.size.call(this):u.prototype.size.apply(this,arguments)},h.prototype.insert=function(){if(2!==arguments.length)return u.prototype.insert.apply(this,arguments);var x=arguments[0],T=arguments[1];if(x.isNull())return null;u.prototype.insert.call(this,x,T)},h.prototype.getIntersectsOp=function(){return h.intersectsOp},h.prototype.verticalSlices=function(x,T){for(var k=Math.trunc(Math.ceil(x.size()/T)),G=new Array(T).fill(null),K=x.iterator(),re=0;re<T;re++){G[re]=new gn;for(var et=0;K.hasNext()&&et<k;){var Ft=K.next();G[re].add(Ft),et++}}return G},h.prototype.query=function(){if(1===arguments.length)return u.prototype.query.call(this,arguments[0]);2===arguments.length?u.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(At(arguments[2],za)&&arguments[0]instanceof Object&&arguments[1]instanceof cs||At(arguments[2],ts)&&arguments[0]instanceof Object&&arguments[1]instanceof cs)&&u.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},h.prototype.getComparator=function(){return h.yComparator},h.prototype.createParentBoundablesFromVerticalSlice=function(x,T){return u.prototype.createParentBoundables.call(this,x,T)},h.prototype.remove=function(){return 2===arguments.length?u.prototype.remove.call(this,arguments[0],arguments[1]):u.prototype.remove.apply(this,arguments)},h.prototype.depth=function(){return 0===arguments.length?u.prototype.depth.call(this):u.prototype.depth.apply(this,arguments)},h.prototype.createParentBoundables=function(x,T){ae.isTrue(!x.isEmpty());var k=Math.trunc(Math.ceil(x.size()/this.getNodeCapacity())),G=new gn(x);$o.sort(G,h.xComparator);var K=this.verticalSlices(G,Math.trunc(Math.ceil(Math.sqrt(k))));return this.createParentBoundablesFromVerticalSlices(K,T)},h.prototype.nearestNeighbour=function(){if(1===arguments.length){if(At(arguments[0],da)){var x=arguments[0],T=new bo(this.getRoot(),this.getRoot(),x);return this.nearestNeighbour(T)}if(arguments[0]instanceof bo)return this.nearestNeighbour(arguments[0],ce.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof h&&At(arguments[1],da)){var G=arguments[0],K=arguments[1],re=new bo(this.getRoot(),G.getRoot(),K);return this.nearestNeighbour(re)}if(arguments[0]instanceof bo&&"number"==typeof arguments[1]){var et=arguments[0],Ft=arguments[1],$t=null,gt=new Su;for(gt.add(et);!gt.isEmpty()&&Ft>0;){var nn=gt.poll(),Un=nn.getDistance();if(Un>=Ft)break;nn.isLeaves()?(Ft=Un,$t=nn):nn.expandToQueue(gt,Ft)}return[$t.getBoundable(0).getItem(),$t.getBoundable(1).getItem()]}}else if(3===arguments.length){var Bo=arguments[2],xs=new Ca(arguments[0],arguments[1]),Ss=new bo(this.getRoot(),xs,Bo);return this.nearestNeighbour(Ss)[0]}},h.prototype.interfaces_=function(){return[dc,Ee]},h.prototype.getClass=function(){return h},h.centreX=function(x){return h.avg(x.getMinX(),x.getMaxX())},h.avg=function(x,T){return(x+T)/2},h.centreY=function(x){return h.avg(x.getMinY(),x.getMaxY())},y.STRtreeNode.get=function(){return Sa},y.serialVersionUID.get=function(){return 0x39920f7d5f261e0},y.xComparator.get=function(){return{interfaces_:function(){return[we]},compare:function(x,T){return u.compareDoubles(h.centreX(x.getBounds()),h.centreX(T.getBounds()))}}},y.yComparator.get=function(){return{interfaces_:function(){return[we]},compare:function(x,T){return u.compareDoubles(h.centreY(x.getBounds()),h.centreY(T.getBounds()))}}},y.intersectsOp.get=function(){return{interfaces_:function(){return[u.IntersectsOp]},intersects:function(x,T){return x.intersects(T)}}},y.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(h,y),h}(Eo),Sa=function(u){function h(){u.call(this,arguments[0])}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.computeBounds=function(){for(var y=null,x=this.getChildBoundables().iterator();x.hasNext();){var T=x.next();null===y?y=new hn(T.getBounds()):y.expandToInclude(T.getBounds())}return y},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(cs),Xs=function(){};Xs.prototype.interfaces_=function(){return[]},Xs.prototype.getClass=function(){return Xs},Xs.relativeSign=function(u,h){return u<h?-1:u>h?1:0},Xs.compare=function(u,h,y){if(h.equals2D(y))return 0;var x=Xs.relativeSign(h.x,y.x),T=Xs.relativeSign(h.y,y.y);switch(u){case 0:return Xs.compareValue(x,T);case 1:return Xs.compareValue(T,x);case 2:return Xs.compareValue(T,-x);case 3:return Xs.compareValue(-x,T);case 4:return Xs.compareValue(-x,-T);case 5:return Xs.compareValue(-T,-x);case 6:return Xs.compareValue(-T,x);case 7:return Xs.compareValue(x,-T)}return ae.shouldNeverReachHere("invalid octant value"),0},Xs.compareValue=function(u,h){return u<0?-1:u>0?1:h<0?-1:h>0?1:0};var Ku=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var u=arguments[0],h=arguments[1],y=arguments[2],x=arguments[3];this._segString=u,this.coord=new J(h),this.segmentIndex=y,this._segmentOctant=x,this._isInterior=!h.equals2D(u.getCoordinate(y))};Ku.prototype.getCoordinate=function(){return this.coord},Ku.prototype.print=function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex)},Ku.prototype.compareTo=function(u){var h=u;return this.segmentIndex<h.segmentIndex?-1:this.segmentIndex>h.segmentIndex?1:this.coord.equals2D(h.coord)?0:Xs.compare(this._segmentOctant,this.coord,h.coord)},Ku.prototype.isEndPoint=function(u){return 0===this.segmentIndex&&!this._isInterior||this.segmentIndex===u},Ku.prototype.isInterior=function(){return this._isInterior},Ku.prototype.interfaces_=function(){return[de]},Ku.prototype.getClass=function(){return Ku};var Jr=function(){this._nodeMap=new Ot,this._edge=null,this._edge=arguments[0]};Jr.prototype.getSplitCoordinates=function(){var u=new No;this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next();this.addEdgeCoordinates(y,x,u),y=x}return u.toCoordinateArray()},Jr.prototype.addCollapsedNodes=function(){var u=new gn;this.findCollapsesFromInsertedNodes(u),this.findCollapsesFromExistingVertices(u);for(var h=u.iterator();h.hasNext();){var y=h.next().intValue();this.add(this._edge.getCoordinate(y),y)}},Jr.prototype.print=function(u){u.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(u)},Jr.prototype.findCollapsesFromExistingVertices=function(u){for(var h=0;h<this._edge.size()-2;h++){var y=this._edge.getCoordinate(h),x=this._edge.getCoordinate(h+2);y.equals2D(x)&&u.add(new tt(h+1))}},Jr.prototype.addEdgeCoordinates=function(u,h,y){var x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);y.add(new J(u.coord),!1);for(var k=u.segmentIndex+1;k<=h.segmentIndex;k++)y.add(this._edge.getCoordinate(k));T&&y.add(new J(h.coord))},Jr.prototype.iterator=function(){return this._nodeMap.values().iterator()},Jr.prototype.addSplitEdges=function(u){this.addEndpoints(),this.addCollapsedNodes();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);u.add(T),y=x}},Jr.prototype.findCollapseIndex=function(u,h,y){if(!u.coord.equals2D(h.coord))return!1;var x=h.segmentIndex-u.segmentIndex;return h.isInterior()||x--,1===x&&(y[0]=u.segmentIndex+1,!0)},Jr.prototype.findCollapsesFromInsertedNodes=function(u){for(var h=new Array(1).fill(null),y=this.iterator(),x=y.next();y.hasNext();){var T=y.next();this.findCollapseIndex(x,T,h)&&u.add(new tt(h[0])),x=T}},Jr.prototype.getEdge=function(){return this._edge},Jr.prototype.addEndpoints=function(){var u=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(u),u)},Jr.prototype.createSplitEdge=function(u,h){var y=h.segmentIndex-u.segmentIndex+2,x=this._edge.getCoordinate(h.segmentIndex),T=h.isInterior()||!h.coord.equals2D(x);T||y--;var k=new Array(y).fill(null),G=0;k[G++]=new J(u.coord);for(var K=u.segmentIndex+1;K<=h.segmentIndex;K++)k[G++]=this._edge.getCoordinate(K);return T&&(k[G]=new J(h.coord)),new mo(k,this._edge.getData())},Jr.prototype.add=function(u,h){var y=new Ku(this._edge,u,h,this._edge.getSegmentOctant(h)),x=this._nodeMap.get(y);return null!==x?(ae.isTrue(x.coord.equals2D(u),"Found equal nodes with different coordinates"),x):(this._nodeMap.put(y,y),y)},Jr.prototype.checkSplitEdgesCorrectness=function(u){var h=this._edge.getCoordinates(),y=u.get(0).getCoordinate(0);if(!y.equals2D(h[0]))throw new ye("bad split edge start point at "+y);var x=u.get(u.size()-1).getCoordinates(),T=x[x.length-1];if(!T.equals2D(h[h.length-1]))throw new ye("bad split edge end point at "+T)},Jr.prototype.interfaces_=function(){return[]},Jr.prototype.getClass=function(){return Jr};var jl=function(){};jl.prototype.interfaces_=function(){return[]},jl.prototype.getClass=function(){return jl},jl.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var u=arguments[0],h=arguments[1];if(0===u&&0===h)throw new Y("Cannot compute the octant for point ( "+u+", "+h+" )");var y=Math.abs(u),x=Math.abs(h);return u>=0?h>=0?y>=x?0:1:y>=x?7:6:h>=0?y>=x?3:2:y>=x?4:5}if(arguments[0]instanceof J&&arguments[1]instanceof J){var T=arguments[0],k=arguments[1],G=k.x-T.x,K=k.y-T.y;if(0===G&&0===K)throw new Y("Cannot compute the octant for two identical points "+T);return jl.octant(G,K)}};var Iu=function(){};Iu.prototype.getCoordinates=function(){},Iu.prototype.size=function(){},Iu.prototype.getCoordinate=function(u){},Iu.prototype.isClosed=function(){},Iu.prototype.setData=function(u){},Iu.prototype.getData=function(){},Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu};var Ju=function(){};Ju.prototype.addIntersection=function(u,h){},Ju.prototype.interfaces_=function(){return[Iu]},Ju.prototype.getClass=function(){return Ju};var mo=function(){this._nodeList=new Jr(this),this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};mo.prototype.getCoordinates=function(){return this._pts},mo.prototype.size=function(){return this._pts.length},mo.prototype.getCoordinate=function(u){return this._pts[u]},mo.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},mo.prototype.getSegmentOctant=function(u){return u===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(u),this.getCoordinate(u+1))},mo.prototype.setData=function(u){this._data=u},mo.prototype.safeOctant=function(u,h){return u.equals2D(h)?0:jl.octant(u,h)},mo.prototype.getData=function(){return this._data},mo.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var x=arguments[1],k=new J(arguments[0].getIntersection(arguments[3]));this.addIntersection(k,x)}},mo.prototype.toString=function(){return _t.toLineString(new un(this._pts))},mo.prototype.getNodeList=function(){return this._nodeList},mo.prototype.addIntersectionNode=function(u,h){var y=h,x=y+1;return x<this._pts.length&&u.equals2D(this._pts[x])&&(y=x),this._nodeList.add(u,y)},mo.prototype.addIntersections=function(u,h,y){for(var x=0;x<u.getIntersectionNum();x++)this.addIntersection(u,h,y,x)},mo.prototype.interfaces_=function(){return[Ju]},mo.prototype.getClass=function(){return mo},mo.getNodedSubstrings=function(){if(1===arguments.length){var u=arguments[0],h=new gn;return mo.getNodedSubstrings(u,h),h}if(2===arguments.length)for(var x=arguments[1],T=arguments[0].iterator();T.hasNext();)T.next().getNodeList().addSplitEdges(x)};var Wn=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new J,this.p1=new J;else if(1===arguments.length){var u=arguments[0];this.p0=new J(u.p0),this.p1=new J(u.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var x=arguments[2],T=arguments[3];this.p0=new J(arguments[0],arguments[1]),this.p1=new J(x,T)}},Gl={serialVersionUID:{configurable:!0}};Wn.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},Wn.prototype.orientationIndex=function(){if(arguments[0]instanceof Wn){var u=arguments[0],h=Gt.orientationIndex(this.p0,this.p1,u.p0),y=Gt.orientationIndex(this.p0,this.p1,u.p1);return h>=0&&y>=0||h<=0&&y<=0?Math.max(h,y):0}if(arguments[0]instanceof J)return Gt.orientationIndex(this.p0,this.p1,arguments[0])},Wn.prototype.toGeometry=function(u){return u.createLineString([this.p0,this.p1])},Wn.prototype.isVertical=function(){return this.p0.x===this.p1.x},Wn.prototype.equals=function(u){if(!(u instanceof Wn))return!1;var h=u;return this.p0.equals(h.p0)&&this.p1.equals(h.p1)},Wn.prototype.intersection=function(u){var h=new Bt;return h.computeIntersection(this.p0,this.p1,u.p0,u.p1),h.hasIntersection()?h.getIntersection(0):null},Wn.prototype.project=function(){if(arguments[0]instanceof J){var u=arguments[0];if(u.equals(this.p0)||u.equals(this.p1))return new J(u);var h=this.projectionFactor(u),y=new J;return y.x=this.p0.x+h*(this.p1.x-this.p0.x),y.y=this.p0.y+h*(this.p1.y-this.p0.y),y}if(arguments[0]instanceof Wn){var x=arguments[0],T=this.projectionFactor(x.p0),k=this.projectionFactor(x.p1);if(T>=1&&k>=1||T<=0&&k<=0)return null;var G=this.project(x.p0);T<0&&(G=this.p0),T>1&&(G=this.p1);var K=this.project(x.p1);return k<0&&(K=this.p0),k>1&&(K=this.p1),new Wn(G,K)}},Wn.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},Wn.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},Wn.prototype.getCoordinate=function(u){return 0===u?this.p0:this.p1},Wn.prototype.distancePerpendicular=function(u){return Gt.distancePointLinePerpendicular(u,this.p0,this.p1)},Wn.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},Wn.prototype.midPoint=function(){return Wn.midPoint(this.p0,this.p1)},Wn.prototype.projectionFactor=function(u){if(u.equals(this.p0))return 0;if(u.equals(this.p1))return 1;var h=this.p1.x-this.p0.x,y=this.p1.y-this.p0.y,x=h*h+y*y;return x<=0?ce.NaN:((u.x-this.p0.x)*h+(u.y-this.p0.y)*y)/x},Wn.prototype.closestPoints=function(u){var h=this.intersection(u);if(null!==h)return[h,h];var y=new Array(2).fill(null),x=ce.MAX_VALUE,T=null,k=this.closestPoint(u.p0);x=k.distance(u.p0),y[0]=k,y[1]=u.p0;var G=this.closestPoint(u.p1);(T=G.distance(u.p1))<x&&(x=T,y[0]=G,y[1]=u.p1);var K=u.closestPoint(this.p0);(T=K.distance(this.p0))<x&&(x=T,y[0]=this.p0,y[1]=K);var re=u.closestPoint(this.p1);return(T=re.distance(this.p1))<x&&(x=T,y[0]=this.p1,y[1]=re),y},Wn.prototype.closestPoint=function(u){var h=this.projectionFactor(u);return h>0&&h<1?this.project(u):this.p0.distance(u)<this.p1.distance(u)?this.p0:this.p1},Wn.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},Wn.prototype.getLength=function(){return this.p0.distance(this.p1)},Wn.prototype.compareTo=function(u){var h=u,y=this.p0.compareTo(h.p0);return 0!==y?y:this.p1.compareTo(h.p1)},Wn.prototype.reverse=function(){var u=this.p0;this.p0=this.p1,this.p1=u},Wn.prototype.equalsTopo=function(u){return this.p0.equals(u.p0)&&(this.p1.equals(u.p1)||this.p0.equals(u.p1))&&this.p1.equals(u.p0)},Wn.prototype.lineIntersection=function(u){try{return Sn.intersection(this.p0,this.p1,u.p0,u.p1)}catch(h){if(!(h instanceof Bn))throw h}return null},Wn.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},Wn.prototype.pointAlongOffset=function(u,h){var y=this.p0.x+u*(this.p1.x-this.p0.x),x=this.p0.y+u*(this.p1.y-this.p0.y),T=this.p1.x-this.p0.x,k=this.p1.y-this.p0.y,G=Math.sqrt(T*T+k*k),K=0,re=0;if(0!==h){if(G<=0)throw new Error("Cannot compute offset from zero-length line segment");K=h*T/G,re=h*k/G}return new J(y-re,x+K)},Wn.prototype.setCoordinates=function(){if(1===arguments.length){var u=arguments[0];this.setCoordinates(u.p0,u.p1)}else if(2===arguments.length){var h=arguments[0],y=arguments[1];this.p0.x=h.x,this.p0.y=h.y,this.p1.x=y.x,this.p1.y=y.y}},Wn.prototype.segmentFraction=function(u){var h=this.projectionFactor(u);return h<0?h=0:(h>1||ce.isNaN(h))&&(h=1),h},Wn.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},Wn.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},Wn.prototype.distance=function(){if(arguments[0]instanceof Wn){var u=arguments[0];return Gt.distanceLineLine(this.p0,this.p1,u.p0,u.p1)}if(arguments[0]instanceof J)return Gt.distancePointLine(arguments[0],this.p0,this.p1)},Wn.prototype.pointAlong=function(u){var h=new J;return h.x=this.p0.x+u*(this.p1.x-this.p0.x),h.y=this.p0.y+u*(this.p1.y-this.p0.y),h},Wn.prototype.hashCode=function(){var u=ce.doubleToLongBits(this.p0.x);u^=31*ce.doubleToLongBits(this.p0.y);var h=Math.trunc(u)^Math.trunc(u>>32),y=ce.doubleToLongBits(this.p1.x);return y^=31*ce.doubleToLongBits(this.p1.y),h^Math.trunc(y)^Math.trunc(y>>32)},Wn.prototype.interfaces_=function(){return[de,Ee]},Wn.prototype.getClass=function(){return Wn},Wn.midPoint=function(u,h){return new J((u.x+h.x)/2,(u.y+h.y)/2)},Gl.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(Wn,Gl);var pc=function(){this.tempEnv1=new hn,this.tempEnv2=new hn,this._overlapSeg1=new Wn,this._overlapSeg2=new Wn};pc.prototype.overlap=function(){if(2!==arguments.length&&4===arguments.length){var y=arguments[2],x=arguments[3];arguments[0].getLineSegment(arguments[1],this._overlapSeg1),y.getLineSegment(x,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}},pc.prototype.interfaces_=function(){return[]},pc.prototype.getClass=function(){return pc};var ns=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var h=arguments[1],y=arguments[2],x=arguments[3];this._pts=arguments[0],this._start=h,this._end=y,this._context=x};ns.prototype.getLineSegment=function(u,h){h.p0=this._pts[u],h.p1=this._pts[u+1]},ns.prototype.computeSelect=function(u,h,y,x){if(x.tempEnv1.init(this._pts[h],this._pts[y]),y-h==1)return x.select(this,h),null;if(!u.intersects(x.tempEnv1))return null;var G=Math.trunc((h+y)/2);h<G&&this.computeSelect(u,h,G,x),G<y&&this.computeSelect(u,G,y,x)},ns.prototype.getCoordinates=function(){for(var u=new Array(this._end-this._start+1).fill(null),h=0,y=this._start;y<=this._end;y++)u[h++]=this._pts[y];return u},ns.prototype.computeOverlaps=function(u,h){this.computeOverlapsInternal(this._start,this._end,u,u._start,u._end,h)},ns.prototype.setId=function(u){this._id=u},ns.prototype.select=function(u,h){this.computeSelect(u,this._start,this._end,h)},ns.prototype.getEnvelope=function(){return null===this._env&&(this._env=new hn(this._pts[this._start],this._pts[this._end])),this._env},ns.prototype.getEndIndex=function(){return this._end},ns.prototype.getStartIndex=function(){return this._start},ns.prototype.getContext=function(){return this._context},ns.prototype.getId=function(){return this._id},ns.prototype.computeOverlapsInternal=function(u,h,y,x,T,k){var G=this._pts[u],K=this._pts[h],re=y._pts[x],et=y._pts[T];if(h-u==1&&T-x==1)return k.overlap(this,u,y,x),null;if(k.tempEnv1.init(G,K),k.tempEnv2.init(re,et),!k.tempEnv1.intersects(k.tempEnv2))return null;var Ft=Math.trunc((u+h)/2),$t=Math.trunc((x+T)/2);u<Ft&&(x<$t&&this.computeOverlapsInternal(u,Ft,y,x,$t,k),$t<T&&this.computeOverlapsInternal(u,Ft,y,$t,T,k)),Ft<h&&(x<$t&&this.computeOverlapsInternal(Ft,h,y,x,$t,k),$t<T&&this.computeOverlapsInternal(Ft,h,y,$t,T,k))},ns.prototype.interfaces_=function(){return[]},ns.prototype.getClass=function(){return ns};var jr=function(){};jr.prototype.interfaces_=function(){return[]},jr.prototype.getClass=function(){return jr},jr.getChainStartIndices=function(u){var h=0,y=new gn;y.add(new tt(h));do{var x=jr.findChainEnd(u,h);y.add(new tt(x)),h=x}while(h<u.length-1);return jr.toIntArray(y)},jr.findChainEnd=function(u,h){for(var y=h;y<u.length-1&&u[y].equals2D(u[y+1]);)y++;if(y>=u.length-1)return u.length-1;for(var x=Vr.quadrant(u[y],u[y+1]),T=h+1;T<u.length&&(u[T-1].equals2D(u[T])||Vr.quadrant(u[T-1],u[T])===x);)T++;return T-1},jr.getChains=function(){if(1===arguments.length)return jr.getChains(arguments[0],null);if(2===arguments.length){for(var h=arguments[0],y=arguments[1],x=new gn,T=jr.getChainStartIndices(h),k=0;k<T.length-1;k++){var G=new ns(h,T[k],T[k+1],y);x.add(G)}return x}},jr.toIntArray=function(u){for(var h=new Array(u.size()).fill(null),y=0;y<h.length;y++)h[y]=u.get(y).intValue();return h};var cu=function(){};cu.prototype.computeNodes=function(u){},cu.prototype.getNodedSubstrings=function(){},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu};var Tu=function(){this._segInt=null,0!==arguments.length&&1===arguments.length&&this.setSegmentIntersector(arguments[0])};Tu.prototype.setSegmentIntersector=function(u){this._segInt=u},Tu.prototype.interfaces_=function(){return[cu]},Tu.prototype.getClass=function(){return Tu};var Nu=function(u){function h(x){x?u.call(this,x):u.call(this),this._monoChains=new gn,this._index=new Sf,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h;var y={SegmentOverlapAction:{configurable:!0}};return h.prototype.getMonotoneChains=function(){return this._monoChains},h.prototype.getNodedSubstrings=function(){return mo.getNodedSubstrings(this._nodedSegStrings)},h.prototype.getIndex=function(){return this._index},h.prototype.add=function(x){for(var T=jr.getChains(x.getCoordinates(),x).iterator();T.hasNext();){var k=T.next();k.setId(this._idCounter++),this._index.insert(k.getEnvelope(),k),this._monoChains.add(k)}},h.prototype.computeNodes=function(x){this._nodedSegStrings=x;for(var T=x.iterator();T.hasNext();)this.add(T.next());this.intersectChains()},h.prototype.intersectChains=function(){for(var x=new hh(this._segInt),T=this._monoChains.iterator();T.hasNext();)for(var k=T.next(),G=this._index.query(k.getEnvelope()).iterator();G.hasNext();){var K=G.next();if(K.getId()>k.getId()&&(k.computeOverlaps(K,x),this._nOverlaps++),this._segInt.isDone())return null}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},y.SegmentOverlapAction.get=function(){return hh},Object.defineProperties(h,y),h}(Tu),hh=function(u){function h(){u.call(this),this._si=null,this._si=arguments[0]}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.overlap=function(){if(4!==arguments.length)return u.prototype.overlap.apply(this,arguments);var x=arguments[1],T=arguments[2],k=arguments[3],G=arguments[0].getContext(),K=T.getContext();this._si.processIntersections(G,x,K,k)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(pc),Pn=function u(){if(this._quadrantSegments=u.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=u.CAP_ROUND,this._joinStyle=u.JOIN_ROUND,this._mitreLimit=u.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=u.DEFAULT_SIMPLIFY_FACTOR,0!==arguments.length)if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var x=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(x)}else if(4===arguments.length){var k=arguments[1],G=arguments[2],K=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(k),this.setJoinStyle(G),this.setMitreLimit(K)}},Ha={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Pn.prototype.getEndCapStyle=function(){return this._endCapStyle},Pn.prototype.isSingleSided=function(){return this._isSingleSided},Pn.prototype.setQuadrantSegments=function(u){this._quadrantSegments=u,0===this._quadrantSegments&&(this._joinStyle=Pn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Pn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),u<=0&&(this._quadrantSegments=1),this._joinStyle!==Pn.JOIN_ROUND&&(this._quadrantSegments=Pn.DEFAULT_QUADRANT_SEGMENTS)},Pn.prototype.getJoinStyle=function(){return this._joinStyle},Pn.prototype.setJoinStyle=function(u){this._joinStyle=u},Pn.prototype.setSimplifyFactor=function(u){this._simplifyFactor=u<0?0:u},Pn.prototype.getSimplifyFactor=function(){return this._simplifyFactor},Pn.prototype.getQuadrantSegments=function(){return this._quadrantSegments},Pn.prototype.setEndCapStyle=function(u){this._endCapStyle=u},Pn.prototype.getMitreLimit=function(){return this._mitreLimit},Pn.prototype.setMitreLimit=function(u){this._mitreLimit=u},Pn.prototype.setSingleSided=function(u){this._isSingleSided=u},Pn.prototype.interfaces_=function(){return[]},Pn.prototype.getClass=function(){return Pn},Pn.bufferDistanceError=function(u){var h=Math.PI/2/u;return 1-Math.cos(h/2)},Ha.CAP_ROUND.get=function(){return 1},Ha.CAP_FLAT.get=function(){return 2},Ha.CAP_SQUARE.get=function(){return 3},Ha.JOIN_ROUND.get=function(){return 1},Ha.JOIN_MITRE.get=function(){return 2},Ha.JOIN_BEVEL.get=function(){return 3},Ha.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Ha.DEFAULT_MITRE_LIMIT.get=function(){return 5},Ha.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(Pn,Ha);var rr=function(u){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=Gt.COUNTERCLOCKWISE,this._inputLine=u||null},ku={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};rr.prototype.isDeletable=function(u,h,y,x){var T=this._inputLine[u],k=this._inputLine[h],G=this._inputLine[y];return!!this.isConcave(T,k,G)&&!!this.isShallow(T,k,G,x)&&this.isShallowSampled(T,k,u,y,x)},rr.prototype.deleteShallowConcavities=function(){for(var u=1,h=this.findNextNonDeletedIndex(u),y=this.findNextNonDeletedIndex(h),x=!1;y<this._inputLine.length;){var T=!1;this.isDeletable(u,h,y,this._distanceTol)&&(this._isDeleted[h]=rr.DELETE,T=!0,x=!0),h=this.findNextNonDeletedIndex(u=T?y:h),y=this.findNextNonDeletedIndex(h)}return x},rr.prototype.isShallowConcavity=function(u,h,y,x){return Gt.computeOrientation(u,h,y)===this._angleOrientation&&Gt.distancePointLine(h,u,y)<x},rr.prototype.isShallowSampled=function(u,h,y,x,T){var k=Math.trunc((x-y)/rr.NUM_PTS_TO_CHECK);k<=0&&(k=1);for(var G=y;G<x;G+=k)if(!this.isShallow(u,h,this._inputLine[G],T))return!1;return!0},rr.prototype.isConcave=function(u,h,y){return Gt.computeOrientation(u,h,y)===this._angleOrientation},rr.prototype.simplify=function(u){this._distanceTol=Math.abs(u),u<0&&(this._angleOrientation=Gt.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var h=!1;do{h=this.deleteShallowConcavities()}while(h);return this.collapseLine()},rr.prototype.findNextNonDeletedIndex=function(u){for(var h=u+1;h<this._inputLine.length&&this._isDeleted[h]===rr.DELETE;)h++;return h},rr.prototype.isShallow=function(u,h,y,x){return Gt.distancePointLine(h,u,y)<x},rr.prototype.collapseLine=function(){for(var u=new No,h=0;h<this._inputLine.length;h++)this._isDeleted[h]!==rr.DELETE&&u.add(this._inputLine[h]);return u.toCoordinateArray()},rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr},rr.simplify=function(u,h){return new rr(u).simplify(h)},ku.INIT.get=function(){return 0},ku.DELETE.get=function(){return 1},ku.KEEP.get=function(){return 1},ku.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(rr,ku);var Is=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new gn},hu={COORDINATE_ARRAY_TYPE:{configurable:!0}};Is.prototype.getCoordinates=function(){return this._ptList.toArray(Is.COORDINATE_ARRAY_TYPE)},Is.prototype.setPrecisionModel=function(u){this._precisionModel=u},Is.prototype.addPt=function(u){var h=new J(u);if(this._precisionModel.makePrecise(h),this.isRedundant(h))return null;this._ptList.add(h)},Is.prototype.revere=function(){},Is.prototype.addPts=function(u,h){if(h)for(var y=0;y<u.length;y++)this.addPt(u[y]);else for(var x=u.length-1;x>=0;x--)this.addPt(u[x])},Is.prototype.isRedundant=function(u){if(this._ptList.size()<1)return!1;var h=this._ptList.get(this._ptList.size()-1);return u.distance(h)<this._minimimVertexDistance},Is.prototype.toString=function(){return(new pr).createLineString(this.getCoordinates()).toString()},Is.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var u=new J(this._ptList.get(0)),h=this._ptList.get(this._ptList.size()-1);if(u.equals(h))return null;this._ptList.add(u)},Is.prototype.setMinimumVertexDistance=function(u){this._minimimVertexDistance=u},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is},hu.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Is,hu);var Gr=function(){},ni={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Gr.prototype.interfaces_=function(){return[]},Gr.prototype.getClass=function(){return Gr},Gr.toDegrees=function(u){return 180*u/Math.PI},Gr.normalize=function(u){for(;u>Math.PI;)u-=Gr.PI_TIMES_2;for(;u<=-Math.PI;)u+=Gr.PI_TIMES_2;return u},Gr.angle=function(){if(1===arguments.length){var u=arguments[0];return Math.atan2(u.y,u.x)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return Math.atan2(y.y-h.y,y.x-h.x)}},Gr.isAcute=function(u,h,y){return(u.x-h.x)*(y.x-h.x)+(u.y-h.y)*(y.y-h.y)>0},Gr.isObtuse=function(u,h,y){return(u.x-h.x)*(y.x-h.x)+(u.y-h.y)*(y.y-h.y)<0},Gr.interiorAngle=function(u,h,y){var x=Gr.angle(h,u),T=Gr.angle(h,y);return Math.abs(T-x)},Gr.normalizePositive=function(u){if(u<0){for(;u<0;)u+=Gr.PI_TIMES_2;u>=Gr.PI_TIMES_2&&(u=0)}else{for(;u>=Gr.PI_TIMES_2;)u-=Gr.PI_TIMES_2;u<0&&(u=0)}return u},Gr.angleBetween=function(u,h,y){var x=Gr.angle(h,u),T=Gr.angle(h,y);return Gr.diff(x,T)},Gr.diff=function(u,h){var y=null;return(y=u<h?h-u:u-h)>Math.PI&&(y=2*Math.PI-y),y},Gr.toRadians=function(u){return u*Math.PI/180},Gr.getTurn=function(u,h){var y=Math.sin(h-u);return y>0?Gr.COUNTERCLOCKWISE:y<0?Gr.CLOCKWISE:Gr.NONE},Gr.angleBetweenOriented=function(u,h,y){var x=Gr.angle(h,u),T=Gr.angle(h,y)-x;return T<=-Math.PI?T+Gr.PI_TIMES_2:T>Math.PI?T-Gr.PI_TIMES_2:T},ni.PI_TIMES_2.get=function(){return 2*Math.PI},ni.PI_OVER_2.get=function(){return Math.PI/2},ni.PI_OVER_4.get=function(){return Math.PI/4},ni.COUNTERCLOCKWISE.get=function(){return Gt.COUNTERCLOCKWISE},ni.CLOCKWISE.get=function(){return Gt.CLOCKWISE},ni.NONE.get=function(){return Gt.COLLINEAR},Object.defineProperties(Gr,ni);var Si=function u(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Wn,this._seg1=new Wn,this._offset0=new Wn,this._offset1=new Wn,this._side=0,this._hasNarrowConcaveAngle=!1;var y=arguments[1],x=arguments[2];this._precisionModel=arguments[0],this._bufParams=y,this._li=new Bt,this._filletAngleQuantum=Math.PI/2/y.getQuadrantSegments(),y.getQuadrantSegments()>=8&&y.getJoinStyle()===Pn.JOIN_ROUND&&(this._closingSegLengthFactor=u.MAX_CLOSING_SEG_LEN_FACTOR),this.init(x)},Xa={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Si.prototype.addNextSegment=function(u,h){if(this._s0=this._s1,this._s1=this._s2,this._s2=u,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var y=Gt.computeOrientation(this._s0,this._s1,this._s2),x=y===Gt.CLOCKWISE&&this._side===mn.LEFT||y===Gt.COUNTERCLOCKWISE&&this._side===mn.RIGHT;0===y?this.addCollinear(h):x?this.addOutsideTurn(y,h):this.addInsideTurn(y,h)},Si.prototype.addLineEndCap=function(u,h){var y=new Wn(u,h),x=new Wn;this.computeOffsetSegment(y,mn.LEFT,this._distance,x);var T=new Wn;this.computeOffsetSegment(y,mn.RIGHT,this._distance,T);var K=Math.atan2(h.y-u.y,h.x-u.x);switch(this._bufParams.getEndCapStyle()){case Pn.CAP_ROUND:this._segList.addPt(x.p1),this.addFilletArc(h,K+Math.PI/2,K-Math.PI/2,Gt.CLOCKWISE,this._distance),this._segList.addPt(T.p1);break;case Pn.CAP_FLAT:this._segList.addPt(x.p1),this._segList.addPt(T.p1);break;case Pn.CAP_SQUARE:var re=new J;re.x=Math.abs(this._distance)*Math.cos(K),re.y=Math.abs(this._distance)*Math.sin(K);var et=new J(x.p1.x+re.x,x.p1.y+re.y),Ft=new J(T.p1.x+re.x,T.p1.y+re.y);this._segList.addPt(et),this._segList.addPt(Ft)}},Si.prototype.getCoordinates=function(){return this._segList.getCoordinates()},Si.prototype.addMitreJoin=function(u,h,y,x){var T=!0,k=null;try{k=Sn.intersection(h.p0,h.p1,y.p0,y.p1),(x<=0?1:k.distance(u)/Math.abs(x))>this._bufParams.getMitreLimit()&&(T=!1)}catch(G){if(!(G instanceof Bn))throw G;k=new J(0,0),T=!1}T?this._segList.addPt(k):this.addLimitedMitreJoin(h,y,x,this._bufParams.getMitreLimit())},Si.prototype.addFilletCorner=function(u,h,y,x,T){var K=Math.atan2(h.y-u.y,h.x-u.x),Ft=Math.atan2(y.y-u.y,y.x-u.x);x===Gt.CLOCKWISE?K<=Ft&&(K+=2*Math.PI):K>=Ft&&(K-=2*Math.PI),this._segList.addPt(h),this.addFilletArc(u,K,Ft,x,T),this._segList.addPt(y)},Si.prototype.addOutsideTurn=function(u,h){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Si.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Pn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Pn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(h&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,u,this._distance),this._segList.addPt(this._offset1.p0))},Si.prototype.createSquare=function(u){this._segList.addPt(new J(u.x+this._distance,u.y+this._distance)),this._segList.addPt(new J(u.x+this._distance,u.y-this._distance)),this._segList.addPt(new J(u.x-this._distance,u.y-this._distance)),this._segList.addPt(new J(u.x-this._distance,u.y+this._distance)),this._segList.closeRing()},Si.prototype.addSegments=function(u,h){this._segList.addPts(u,h)},Si.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)},Si.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)},Si.prototype.initSideSegments=function(u,h,y){this._s1=u,this._s2=h,this._side=y,this._seg1.setCoordinates(u,h),this.computeOffsetSegment(this._seg1,y,this._distance,this._offset1)},Si.prototype.addLimitedMitreJoin=function(u,h,y,x){var T=this._seg0.p1,k=Gr.angle(T,this._seg0.p0),G=Gr.angleBetweenOriented(this._seg0.p0,T,this._seg1.p1)/2,K=Gr.normalize(k+G),re=Gr.normalize(K+Math.PI),et=x*y,Ft=y-et*Math.abs(Math.sin(G)),$t=T.x+et*Math.cos(re),gt=T.y+et*Math.sin(re),nn=new J($t,gt),Un=new Wn(T,nn),Qn=Un.pointAlongOffset(1,Ft),Sr=Un.pointAlongOffset(1,-Ft);this._side===mn.LEFT?(this._segList.addPt(Qn),this._segList.addPt(Sr)):(this._segList.addPt(Sr),this._segList.addPt(Qn))},Si.prototype.computeOffsetSegment=function(u,h,y,x){var T=h===mn.LEFT?1:-1,k=u.p1.x-u.p0.x,G=u.p1.y-u.p0.y,K=Math.sqrt(k*k+G*G),re=T*y*k/K,et=T*y*G/K;x.p0.x=u.p0.x-et,x.p0.y=u.p0.y+re,x.p1.x=u.p1.x-et,x.p1.y=u.p1.y+re},Si.prototype.addFilletArc=function(u,h,y,x,T){var k=x===Gt.CLOCKWISE?-1:1,G=Math.abs(h-y),K=Math.trunc(G/this._filletAngleQuantum+.5);if(K<1)return null;for(var re=G/K,et=0,Ft=new J;et<G;){var $t=h+k*et;Ft.x=u.x+T*Math.cos($t),Ft.y=u.y+T*Math.sin($t),this._segList.addPt(Ft),et+=re}},Si.prototype.addInsideTurn=function(u,h){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Si.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var y=new J((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(y);var x=new J((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(x)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}},Si.prototype.createCircle=function(u){var h=new J(u.x+this._distance,u.y);this._segList.addPt(h),this.addFilletArc(u,0,2*Math.PI,-1,this._distance),this._segList.closeRing()},Si.prototype.addBevelJoin=function(u,h){this._segList.addPt(u.p1),this._segList.addPt(h.p0)},Si.prototype.init=function(u){this._distance=u,this._maxCurveSegmentError=u*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Is,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(u*Si.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Si.prototype.addCollinear=function(u){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2),this._li.getIntersectionNum()>=2&&(this._bufParams.getJoinStyle()===Pn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Pn.JOIN_MITRE?(u&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,Gt.CLOCKWISE,this._distance))},Si.prototype.closeRing=function(){this._segList.closeRing()},Si.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle},Si.prototype.interfaces_=function(){return[]},Si.prototype.getClass=function(){return Si},Xa.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Xa.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Xa.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Xa.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Si,Xa);var Mo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var h=arguments[1];this._precisionModel=arguments[0],this._bufParams=h};Mo.prototype.getOffsetCurve=function(u,h){if(this._distance=h,0===h)return null;var y=h<0,x=Math.abs(h),T=this.getSegGen(x);u.length<=1?this.computePointCurve(u[0],T):this.computeOffsetCurve(u,y,T);var k=T.getCoordinates();return y&&_r.reverse(k),k},Mo.prototype.computeSingleSidedBufferCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);if(h){y.addSegments(u,!0);var T=rr.simplify(u,-x),k=T.length-1;y.initSideSegments(T[k],T[k-1],mn.LEFT),y.addFirstSegment();for(var G=k-2;G>=0;G--)y.addNextSegment(T[G],!0)}else{y.addSegments(u,!1);var K=rr.simplify(u,x),re=K.length-1;y.initSideSegments(K[0],K[1],mn.LEFT),y.addFirstSegment();for(var et=2;et<=re;et++)y.addNextSegment(K[et],!0)}y.addLastSegment(),y.closeRing()},Mo.prototype.computeRingBufferCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);h===mn.RIGHT&&(x=-x);var T=rr.simplify(u,x),k=T.length-1;y.initSideSegments(T[k-1],T[0],h);for(var G=1;G<=k;G++)y.addNextSegment(T[G],1!==G);y.closeRing()},Mo.prototype.computeLineBufferCurve=function(u,h){var y=this.simplifyTolerance(this._distance),x=rr.simplify(u,y),T=x.length-1;h.initSideSegments(x[0],x[1],mn.LEFT);for(var k=2;k<=T;k++)h.addNextSegment(x[k],!0);h.addLastSegment(),h.addLineEndCap(x[T-1],x[T]);var G=rr.simplify(u,-y),K=G.length-1;h.initSideSegments(G[K],G[K-1],mn.LEFT);for(var re=K-2;re>=0;re--)h.addNextSegment(G[re],!0);h.addLastSegment(),h.addLineEndCap(G[1],G[0]),h.closeRing()},Mo.prototype.computePointCurve=function(u,h){switch(this._bufParams.getEndCapStyle()){case Pn.CAP_ROUND:h.createCircle(u);break;case Pn.CAP_SQUARE:h.createSquare(u)}},Mo.prototype.getLineCurve=function(u,h){if(this._distance=h,h<0&&!this._bufParams.isSingleSided()||0===h)return null;var y=Math.abs(h),x=this.getSegGen(y);return u.length<=1?this.computePointCurve(u[0],x):this._bufParams.isSingleSided()?this.computeSingleSidedBufferCurve(u,h<0,x):this.computeLineBufferCurve(u,x),x.getCoordinates()},Mo.prototype.getBufferParameters=function(){return this._bufParams},Mo.prototype.simplifyTolerance=function(u){return u*this._bufParams.getSimplifyFactor()},Mo.prototype.getRingCurve=function(u,h,y){if(this._distance=y,u.length<=2)return this.getLineCurve(u,y);if(0===y)return Mo.copyCoordinates(u);var x=this.getSegGen(y);return this.computeRingBufferCurve(u,h,x),x.getCoordinates()},Mo.prototype.computeOffsetCurve=function(u,h,y){var x=this.simplifyTolerance(this._distance);if(h){var T=rr.simplify(u,-x),k=T.length-1;y.initSideSegments(T[k],T[k-1],mn.LEFT),y.addFirstSegment();for(var G=k-2;G>=0;G--)y.addNextSegment(T[G],!0)}else{var K=rr.simplify(u,x),re=K.length-1;y.initSideSegments(K[0],K[1],mn.LEFT),y.addFirstSegment();for(var et=2;et<=re;et++)y.addNextSegment(K[et],!0)}y.addLastSegment()},Mo.prototype.getSegGen=function(u){return new Si(this._precisionModel,this._bufParams,u)},Mo.prototype.interfaces_=function(){return[]},Mo.prototype.getClass=function(){return Mo},Mo.copyCoordinates=function(u){for(var h=new Array(u.length).fill(null),y=0;y<h.length;y++)h[y]=new J(u[y]);return h};var gc=function(){this._subgraphs=null,this._seg=new Wn,this._cga=new Gt,this._subgraphs=arguments[0]},Gh={DepthSegment:{configurable:!0}};gc.prototype.findStabbedSegments=function(){if(1===arguments.length){for(var u=arguments[0],h=new gn,y=this._subgraphs.iterator();y.hasNext();){var x=y.next(),T=x.getEnvelope();u.y<T.getMinY()||u.y>T.getMaxY()||this.findStabbedSegments(u,x.getDirectedEdges(),h)}return h}if(3===arguments.length)if(At(arguments[2],ts)&&arguments[0]instanceof J&&arguments[1]instanceof jh){for(var k=arguments[0],G=arguments[1],K=arguments[2],re=G.getEdge().getCoordinates(),et=0;et<re.length-1;et++)if(this._seg.p0=re[et],this._seg.p1=re[et+1],this._seg.p0.y>this._seg.p1.y&&this._seg.reverse(),!(Math.max(this._seg.p0.x,this._seg.p1.x)<k.x||this._seg.isHorizontal()||k.y<this._seg.p0.y||k.y>this._seg.p1.y||Gt.computeOrientation(this._seg.p0,this._seg.p1,k)===Gt.RIGHT)){var Ft=G.getDepth(mn.LEFT);this._seg.p0.equals(re[et])||(Ft=G.getDepth(mn.RIGHT));var $t=new oa(this._seg,Ft);K.add($t)}}else if(At(arguments[2],ts)&&arguments[0]instanceof J&&At(arguments[1],ts))for(var gt=arguments[0],Un=arguments[2],Qn=arguments[1].iterator();Qn.hasNext();){var Sr=Qn.next();Sr.isForward()&&this.findStabbedSegments(gt,Sr,Un)}},gc.prototype.getDepth=function(u){var h=this.findStabbedSegments(u);return 0===h.size()?0:$o.min(h)._leftDepth},gc.prototype.interfaces_=function(){return[]},gc.prototype.getClass=function(){return gc},Gh.DepthSegment.get=function(){return oa},Object.defineProperties(gc,Gh);var oa=function(){this._upwardSeg=null,this._leftDepth=null;var h=arguments[1];this._upwardSeg=new Wn(arguments[0]),this._leftDepth=h};oa.prototype.compareTo=function(u){var h=u;if(this._upwardSeg.minX()>=h._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=h._upwardSeg.minX())return-1;var y=this._upwardSeg.orientationIndex(h._upwardSeg);return 0!==y||0!=(y=-1*h._upwardSeg.orientationIndex(this._upwardSeg))?y:this._upwardSeg.compareTo(h._upwardSeg)},oa.prototype.compareX=function(u,h){var y=u.p0.compareTo(h.p0);return 0!==y?y:u.p1.compareTo(h.p1)},oa.prototype.toString=function(){return this._upwardSeg.toString()},oa.prototype.interfaces_=function(){return[de]},oa.prototype.getClass=function(){return oa};var $r=function(u,h,y){this.p0=u||null,this.p1=h||null,this.p2=y||null};$r.prototype.area=function(){return $r.area(this.p0,this.p1,this.p2)},$r.prototype.signedArea=function(){return $r.signedArea(this.p0,this.p1,this.p2)},$r.prototype.interpolateZ=function(u){if(null===u)throw new Y("Supplied point is null.");return $r.interpolateZ(u,this.p0,this.p1,this.p2)},$r.prototype.longestSideLength=function(){return $r.longestSideLength(this.p0,this.p1,this.p2)},$r.prototype.isAcute=function(){return $r.isAcute(this.p0,this.p1,this.p2)},$r.prototype.circumcentre=function(){return $r.circumcentre(this.p0,this.p1,this.p2)},$r.prototype.area3D=function(){return $r.area3D(this.p0,this.p1,this.p2)},$r.prototype.centroid=function(){return $r.centroid(this.p0,this.p1,this.p2)},$r.prototype.inCentre=function(){return $r.inCentre(this.p0,this.p1,this.p2)},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.area=function(u,h,y){return Math.abs(((y.x-u.x)*(h.y-u.y)-(h.x-u.x)*(y.y-u.y))/2)},$r.signedArea=function(u,h,y){return((y.x-u.x)*(h.y-u.y)-(h.x-u.x)*(y.y-u.y))/2},$r.det=function(u,h,y,x){return u*x-h*y},$r.interpolateZ=function(u,h,y,x){var T=h.x,k=h.y,G=y.x-T,K=x.x-T,re=y.y-k,et=x.y-k,Ft=G*et-K*re,$t=u.x-T,gt=u.y-k;return h.z+(et*$t-K*gt)/Ft*(y.z-h.z)+(-re*$t+G*gt)/Ft*(x.z-h.z)},$r.longestSideLength=function(u,h,y){var x=u.distance(h),T=h.distance(y),k=y.distance(u),G=x;return T>G&&(G=T),k>G&&(G=k),G},$r.isAcute=function(u,h,y){return!!Gr.isAcute(u,h,y)&&!!Gr.isAcute(h,y,u)&&!!Gr.isAcute(y,u,h)},$r.circumcentre=function(u,h,y){var x=y.x,T=y.y,k=u.x-x,G=u.y-T,K=h.x-x,re=h.y-T,et=2*$r.det(k,G,K,re),Ft=$r.det(G,k*k+G*G,re,K*K+re*re),$t=$r.det(k,k*k+G*G,K,K*K+re*re);return new J(x-Ft/et,T+$t/et)},$r.perpendicularBisector=function(u,h){var y=h.x-u.x,x=h.y-u.y,T=new Sn(u.x+y/2,u.y+x/2,1),k=new Sn(u.x-x+y/2,u.y+y+x/2,1);return new Sn(T,k)},$r.angleBisector=function(u,h,y){var x=h.distance(u),T=x/(x+h.distance(y));return new J(u.x+T*(y.x-u.x),u.y+T*(y.y-u.y))},$r.area3D=function(u,h,y){var x=h.x-u.x,T=h.y-u.y,k=h.z-u.z,G=y.x-u.x,K=y.y-u.y,re=y.z-u.z,et=T*re-k*K,Ft=k*G-x*re,$t=x*K-T*G;return Math.sqrt(et*et+Ft*Ft+$t*$t)/2},$r.centroid=function(u,h,y){return new J((u.x+h.x+y.x)/3,(u.y+h.y+y.y)/3)},$r.inCentre=function(u,h,y){var x=h.distance(y),T=u.distance(y),k=u.distance(h),G=x+T+k;return new J((x*u.x+T*h.x+k*y.x)/G,(x*u.y+T*h.y+k*y.y)/G)};var Hr=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new gn;var h=arguments[1],y=arguments[2];this._inputGeom=arguments[0],this._distance=h,this._curveBuilder=y};Hr.prototype.addPoint=function(u){if(this._distance<=0)return null;var h=u.getCoordinates(),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,ue.EXTERIOR,ue.INTERIOR)},Hr.prototype.addPolygon=function(u){var h=this._distance,y=mn.LEFT;this._distance<0&&(h=-this._distance,y=mn.RIGHT);var x=u.getExteriorRing(),T=_r.removeRepeatedPoints(x.getCoordinates());if(this._distance<0&&this.isErodedCompletely(x,this._distance)||this._distance<=0&&T.length<3)return null;this.addPolygonRing(T,h,y,ue.EXTERIOR,ue.INTERIOR);for(var k=0;k<u.getNumInteriorRing();k++){var G=u.getInteriorRingN(k),K=_r.removeRepeatedPoints(G.getCoordinates());this._distance>0&&this.isErodedCompletely(G,-this._distance)||this.addPolygonRing(K,h,mn.opposite(y),ue.INTERIOR,ue.EXTERIOR)}},Hr.prototype.isTriangleErodedCompletely=function(u,h){var y=new $r(u[0],u[1],u[2]),x=y.inCentre();return Gt.distancePointLine(x,y.p0,y.p1)<Math.abs(h)},Hr.prototype.addLineString=function(u){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var h=_r.removeRepeatedPoints(u.getCoordinates()),y=this._curveBuilder.getLineCurve(h,this._distance);this.addCurve(y,ue.EXTERIOR,ue.INTERIOR)},Hr.prototype.addCurve=function(u,h,y){if(null===u||u.length<2)return null;var x=new mo(u,new gi(0,ue.BOUNDARY,h,y));this._curveList.add(x)},Hr.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList},Hr.prototype.addPolygonRing=function(u,h,y,x,T){if(0===h&&u.length<go.MINIMUM_VALID_SIZE)return null;var k=x,G=T;u.length>=go.MINIMUM_VALID_SIZE&&Gt.isCCW(u)&&(k=T,G=x,y=mn.opposite(y));var K=this._curveBuilder.getRingCurve(u,y,h);this.addCurve(K,k,G)},Hr.prototype.add=function(u){if(u.isEmpty())return null;u instanceof Rt?this.addPolygon(u):u instanceof dr?this.addLineString(u):u instanceof ps?this.addPoint(u):(u instanceof Na||u instanceof $n||u instanceof ra||u instanceof zn)&&this.addCollection(u)},Hr.prototype.isErodedCompletely=function(u,h){var y=u.getCoordinates();if(y.length<4)return h<0;if(4===y.length)return this.isTriangleErodedCompletely(y,h);var x=u.getEnvelopeInternal(),T=Math.min(x.getHeight(),x.getWidth());return h<0&&2*Math.abs(h)>T},Hr.prototype.addCollection=function(u){for(var h=0;h<u.getNumGeometries();h++){var y=u.getGeometryN(h);this.add(y)}},Hr.prototype.interfaces_=function(){return[]},Hr.prototype.getClass=function(){return Hr};var Fu=function(){};Fu.prototype.locate=function(u){},Fu.prototype.interfaces_=function(){return[]},Fu.prototype.getClass=function(){return Fu};var Ia=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var u=arguments[0];this._parent=u,this._atStart=!0,this._index=0,this._max=u.getNumGeometries()};Ia.prototype.next=function(){if(this._atStart)return this._atStart=!1,Ia.isAtomic(this._parent)&&this._index++,this._parent;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new lt;var u=this._parent.getGeometryN(this._index++);return u instanceof zn?(this._subcollectionIterator=new Ia(u),this._subcollectionIterator.next()):u},Ia.prototype.remove=function(){throw new Error(this.getClass().getName())},Ia.prototype.hasNext=function(){if(this._atStart)return!0;if(null!==this._subcollectionIterator){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)},Ia.prototype.interfaces_=function(){return[As]},Ia.prototype.getClass=function(){return Ia},Ia.isAtomic=function(u){return!(u instanceof zn)};var Zs=function(){this._geom=null,this._geom=arguments[0]};Zs.prototype.locate=function(u){return Zs.locate(u,this._geom)},Zs.prototype.interfaces_=function(){return[Fu]},Zs.prototype.getClass=function(){return Zs},Zs.isPointInRing=function(u,h){return!!h.getEnvelopeInternal().intersects(u)&&Gt.isPointInRing(u,h.getCoordinates())},Zs.containsPointInPolygon=function(u,h){if(h.isEmpty())return!1;var y=h.getExteriorRing();if(!Zs.isPointInRing(u,y))return!1;for(var x=0;x<h.getNumInteriorRing();x++){var T=h.getInteriorRingN(x);if(Zs.isPointInRing(u,T))return!1}return!0},Zs.containsPoint=function(u,h){if(h instanceof Rt)return Zs.containsPointInPolygon(u,h);if(h instanceof zn)for(var y=new Ia(h);y.hasNext();){var x=y.next();if(x!==h&&Zs.containsPoint(u,x))return!0}return!1},Zs.locate=function(u,h){return h.isEmpty()?ue.EXTERIOR:Zs.containsPoint(u,h)?ue.INTERIOR:ue.EXTERIOR};var ys=function(){this._edgeMap=new Ot,this._edgeList=null,this._ptInAreaLocation=[ue.NONE,ue.NONE]};ys.prototype.getNextCW=function(u){this.getEdges();var h=this._edgeList.indexOf(u),y=h-1;return 0===h&&(y=this._edgeList.size()-1),this._edgeList.get(y)},ys.prototype.propagateSideLabels=function(u){for(var h=ue.NONE,y=this.iterator();y.hasNext();){var x=y.next().getLabel();x.isArea(u)&&x.getLocation(u,mn.LEFT)!==ue.NONE&&(h=x.getLocation(u,mn.LEFT))}if(h===ue.NONE)return null;for(var T=h,k=this.iterator();k.hasNext();){var G=k.next(),K=G.getLabel();if(K.getLocation(u,mn.ON)===ue.NONE&&K.setLocation(u,mn.ON,T),K.isArea(u)){var re=K.getLocation(u,mn.LEFT),et=K.getLocation(u,mn.RIGHT);if(et!==ue.NONE){if(et!==T)throw new ba("side location conflict",G.getCoordinate());re===ue.NONE&&ae.shouldNeverReachHere("found single null side (at "+G.getCoordinate()+")"),T=re}else ae.isTrue(K.getLocation(u,mn.LEFT)===ue.NONE,"found single null side"),K.setLocation(u,mn.RIGHT,T),K.setLocation(u,mn.LEFT,T)}}},ys.prototype.getCoordinate=function(){var u=this.iterator();return u.hasNext()?u.next().getCoordinate():null},ys.prototype.print=function(u){vn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var h=this.iterator();h.hasNext();)h.next().print(u)},ys.prototype.isAreaLabelsConsistent=function(u){return this.computeEdgeEndLabels(u.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},ys.prototype.checkAreaLabelsConsistent=function(u){var h=this.getEdges();if(h.size()<=0)return!0;var y=h.size()-1,x=h.get(y).getLabel().getLocation(u,mn.LEFT);ae.isTrue(x!==ue.NONE,"Found unlabelled area edge");for(var T=x,k=this.iterator();k.hasNext();){var G=k.next().getLabel();ae.isTrue(G.isArea(u),"Found non-area edge");var K=G.getLocation(u,mn.LEFT),re=G.getLocation(u,mn.RIGHT);if(K===re||re!==T)return!1;T=K}return!0},ys.prototype.findIndex=function(u){this.iterator();for(var h=0;h<this._edgeList.size();h++)if(this._edgeList.get(h)===u)return h;return-1},ys.prototype.iterator=function(){return this.getEdges().iterator()},ys.prototype.getEdges=function(){return null===this._edgeList&&(this._edgeList=new gn(this._edgeMap.values())),this._edgeList},ys.prototype.getLocation=function(u,h,y){return this._ptInAreaLocation[u]===ue.NONE&&(this._ptInAreaLocation[u]=Zs.locate(h,y[u].getGeometry())),this._ptInAreaLocation[u]},ys.prototype.toString=function(){var u=new Me;u.append("EdgeEndStar:   "+this.getCoordinate()),u.append("\n");for(var h=this.iterator();h.hasNext();){var y=h.next();u.append(y),u.append("\n")}return u.toString()},ys.prototype.computeEdgeEndLabels=function(u){for(var h=this.iterator();h.hasNext();)h.next().computeLabel(u)},ys.prototype.computeLabelling=function(u){this.computeEdgeEndLabels(u[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var h=[!1,!1],y=this.iterator();y.hasNext();)for(var x=y.next().getLabel(),T=0;T<2;T++)x.isLine(T)&&x.getLocation(T)===ue.BOUNDARY&&(h[T]=!0);for(var k=this.iterator();k.hasNext();)for(var G=k.next(),K=G.getLabel(),re=0;re<2;re++)if(K.isAnyNull(re)){var et=ue.NONE;if(h[re])et=ue.EXTERIOR;else{var Ft=G.getCoordinate();et=this.getLocation(re,Ft,u)}K.setAllLocationsIfNull(re,et)}},ys.prototype.getDegree=function(){return this._edgeMap.size()},ys.prototype.insertEdgeEnd=function(u,h){this._edgeMap.put(u,h),this._edgeList=null},ys.prototype.interfaces_=function(){return[]},ys.prototype.getClass=function(){return ys};var zu=function(u){function h(){u.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var y=null,x=null,T=this._SCANNING_FOR_INCOMING,k=0;k<this._resultAreaEdgeList.size();k++){var G=this._resultAreaEdgeList.get(k),K=G.getSym();if(G.getLabel().isArea())switch(null===y&&G.isInResult()&&(y=G),T){case this._SCANNING_FOR_INCOMING:if(!K.isInResult())continue;x=K,T=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(!G.isInResult())continue;x.setNext(G),T=this._SCANNING_FOR_INCOMING}}if(T===this._LINKING_TO_OUTGOING){if(null===y)throw new ba("no outgoing dirEdge found",this.getCoordinate());ae.isTrue(y.isInResult(),"unable to link last incoming dirEdge"),x.setNext(y)}},h.prototype.insert=function(y){this.insertEdgeEnd(y,y)},h.prototype.getRightmostEdge=function(){var y=this.getEdges(),x=y.size();if(x<1)return null;var T=y.get(0);if(1===x)return T;var k=y.get(x-1),G=T.getQuadrant(),K=k.getQuadrant();return Vr.isNorthern(G)&&Vr.isNorthern(K)?T:Vr.isNorthern(G)||Vr.isNorthern(K)?0!==T.getDy()?T:0!==k.getDy()?k:(ae.shouldNeverReachHere("found two horizontal edges incident on node"),null):k},h.prototype.print=function(y){vn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var x=this.iterator();x.hasNext();){var T=x.next();y.print("out "),T.print(y),y.println(),y.print("in "),T.getSym().print(y),y.println()}},h.prototype.getResultAreaEdges=function(){if(null!==this._resultAreaEdgeList)return this._resultAreaEdgeList;this._resultAreaEdgeList=new gn;for(var y=this.iterator();y.hasNext();){var x=y.next();(x.isInResult()||x.getSym().isInResult())&&this._resultAreaEdgeList.add(x)}return this._resultAreaEdgeList},h.prototype.updateLabelling=function(y){for(var x=this.iterator();x.hasNext();){var T=x.next().getLabel();T.setAllLocationsIfNull(0,y.getLocation(0)),T.setAllLocationsIfNull(1,y.getLocation(1))}},h.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var y=null,x=null,T=this._edgeList.size()-1;T>=0;T--){var k=this._edgeList.get(T),G=k.getSym();null===x&&(x=G),null!==y&&G.setNext(y),y=k}x.setNext(y)},h.prototype.computeDepths=function(){if(1===arguments.length){var y=arguments[0],x=this.findIndex(y),T=y.getDepth(mn.LEFT),k=y.getDepth(mn.RIGHT),G=this.computeDepths(x+1,this._edgeList.size(),T);if(this.computeDepths(0,x,G)!==k)throw new ba("depth mismatch at "+y.getCoordinate())}else if(3===arguments.length){for(var re=arguments[1],et=arguments[2],Ft=arguments[0];Ft<re;Ft++){var $t=this._edgeList.get(Ft);$t.setEdgeDepths(mn.RIGHT,et),et=$t.getDepth(mn.LEFT)}return et}},h.prototype.mergeSymLabels=function(){for(var y=this.iterator();y.hasNext();){var x=y.next();x.getLabel().merge(x.getSym().getLabel())}},h.prototype.linkMinimalDirectedEdges=function(y){for(var x=null,T=null,k=this._SCANNING_FOR_INCOMING,G=this._resultAreaEdgeList.size()-1;G>=0;G--){var K=this._resultAreaEdgeList.get(G),re=K.getSym();switch(null===x&&K.getEdgeRing()===y&&(x=K),k){case this._SCANNING_FOR_INCOMING:if(re.getEdgeRing()!==y)continue;T=re,k=this._LINKING_TO_OUTGOING;break;case this._LINKING_TO_OUTGOING:if(K.getEdgeRing()!==y)continue;T.setNextMin(K),k=this._SCANNING_FOR_INCOMING}}k===this._LINKING_TO_OUTGOING&&(ae.isTrue(null!==x,"found null for first outgoing dirEdge"),ae.isTrue(x.getEdgeRing()===y,"unable to link last incoming dirEdge"),T.setNextMin(x))},h.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var y=0,x=this.iterator();x.hasNext();)x.next().isInResult()&&y++;return y}if(1===arguments.length){for(var T=arguments[0],k=0,G=this.iterator();G.hasNext();)G.next().getEdgeRing()===T&&k++;return k}},h.prototype.getLabel=function(){return this._label},h.prototype.findCoveredLineEdges=function(){for(var y=ue.NONE,x=this.iterator();x.hasNext();){var T=x.next(),k=T.getSym();if(!T.isLineEdge()){if(T.isInResult()){y=ue.INTERIOR;break}if(k.isInResult()){y=ue.EXTERIOR;break}}}if(y===ue.NONE)return null;for(var G=y,K=this.iterator();K.hasNext();){var re=K.next(),et=re.getSym();re.isLineEdge()?re.getEdge().setCovered(G===ue.INTERIOR):(re.isInResult()&&(G=ue.EXTERIOR),et.isInResult()&&(G=ue.INTERIOR))}},h.prototype.computeLabelling=function(y){u.prototype.computeLabelling.call(this,y),this._label=new gi(ue.NONE);for(var x=this.iterator();x.hasNext();)for(var T=x.next().getEdge().getLabel(),k=0;k<2;k++){var G=T.getLocation(k);G!==ue.INTERIOR&&G!==ue.BOUNDARY||this._label.setLocation(k,ue.INTERIOR)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(ys),mc=function(u){function h(){u.apply(this,arguments)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.createNode=function(y){return new ms(y,new zu)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(fc),yl=function u(){this._pts=null,this._orientation=null;var h=arguments[0];this._pts=h,this._orientation=u.orientation(h)};yl.prototype.compareTo=function(u){return yl.compareOriented(this._pts,this._orientation,u._pts,u._orientation)},yl.prototype.interfaces_=function(){return[de]},yl.prototype.getClass=function(){return yl},yl.orientation=function(u){return 1===_r.increasingDirection(u)},yl.compareOriented=function(u,h,y,x){for(var T=h?1:-1,k=x?1:-1,G=h?u.length:-1,K=x?y.length:-1,re=h?0:u.length-1,et=x?0:y.length-1;;){var Ft=u[re].compareTo(y[et]);if(0!==Ft)return Ft;var $t=(re+=T)===G,gt=(et+=k)===K;if($t&&!gt)return-1;if(!$t&&gt)return 1;if($t&&gt)return 0}};var _s=function(){this._edges=new gn,this._ocaMap=new Ot};_s.prototype.print=function(u){u.print("MULTILINESTRING ( ");for(var h=0;h<this._edges.size();h++){var y=this._edges.get(h);h>0&&u.print(","),u.print("(");for(var x=y.getCoordinates(),T=0;T<x.length;T++)T>0&&u.print(","),u.print(x[T].x+" "+x[T].y);u.println(")")}u.print(")  ")},_s.prototype.addAll=function(u){for(var h=u.iterator();h.hasNext();)this.add(h.next())},_s.prototype.findEdgeIndex=function(u){for(var h=0;h<this._edges.size();h++)if(this._edges.get(h).equals(u))return h;return-1},_s.prototype.iterator=function(){return this._edges.iterator()},_s.prototype.getEdges=function(){return this._edges},_s.prototype.get=function(u){return this._edges.get(u)},_s.prototype.findEqualEdge=function(u){var h=new yl(u.getCoordinates());return this._ocaMap.get(h)},_s.prototype.add=function(u){this._edges.add(u);var h=new yl(u.getCoordinates());this._ocaMap.put(h,u)},_s.prototype.interfaces_=function(){return[]},_s.prototype.getClass=function(){return _s};var Du=function(){};Du.prototype.processIntersections=function(u,h,y,x){},Du.prototype.isDone=function(){},Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du};var pa=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this._li=arguments[0]};pa.prototype.isTrivialIntersection=function(u,h,y,x){if(u===y&&1===this._li.getIntersectionNum()){if(pa.isAdjacentSegments(h,x))return!0;if(u.isClosed()){var T=u.size()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},pa.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},pa.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},pa.prototype.getLineIntersector=function(){return this._li},pa.prototype.hasProperIntersection=function(){return this._hasProper},pa.prototype.processIntersections=function(u,h,y,x){if(u===y&&h===x)return null;this.numTests++;var T=u.getCoordinates()[h],k=u.getCoordinates()[h+1],G=y.getCoordinates()[x],K=y.getCoordinates()[x+1];this._li.computeIntersection(T,k,G,K),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(u,h,y,x)||(this._hasIntersection=!0,u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))},pa.prototype.hasIntersection=function(){return this._hasIntersection},pa.prototype.isDone=function(){return!1},pa.prototype.hasInteriorIntersection=function(){return this._hasInterior},pa.prototype.interfaces_=function(){return[Du]},pa.prototype.getClass=function(){return pa},pa.isAdjacentSegments=function(u,h){return 1===Math.abs(u-h)};var Ta=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var h=arguments[1],y=arguments[2];this.coord=new J(arguments[0]),this.segmentIndex=h,this.dist=y};Ta.prototype.getSegmentIndex=function(){return this.segmentIndex},Ta.prototype.getCoordinate=function(){return this.coord},Ta.prototype.print=function(u){u.print(this.coord),u.print(" seg # = "+this.segmentIndex),u.println(" dist = "+this.dist)},Ta.prototype.compareTo=function(u){return this.compare(u.segmentIndex,u.dist)},Ta.prototype.isEndPoint=function(u){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===u},Ta.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Ta.prototype.getDistance=function(){return this.dist},Ta.prototype.compare=function(u,h){return this.segmentIndex<u?-1:this.segmentIndex>u?1:this.dist<h?-1:this.dist>h?1:0},Ta.prototype.interfaces_=function(){return[de]},Ta.prototype.getClass=function(){return Ta};var Ls=function(){this._nodeMap=new Ot,this.edge=null,this.edge=arguments[0]};Ls.prototype.print=function(u){u.println("Intersections:");for(var h=this.iterator();h.hasNext();)h.next().print(u)},Ls.prototype.iterator=function(){return this._nodeMap.values().iterator()},Ls.prototype.addSplitEdges=function(u){this.addEndpoints();for(var h=this.iterator(),y=h.next();h.hasNext();){var x=h.next(),T=this.createSplitEdge(y,x);u.add(T),y=x}},Ls.prototype.addEndpoints=function(){var u=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[u],u,0)},Ls.prototype.createSplitEdge=function(u,h){var y=h.segmentIndex-u.segmentIndex+2,T=h.dist>0||!h.coord.equals2D(this.edge.pts[h.segmentIndex]);T||y--;var k=new Array(y).fill(null),G=0;k[G++]=new J(u.coord);for(var K=u.segmentIndex+1;K<=h.segmentIndex;K++)k[G++]=this.edge.pts[K];return T&&(k[G]=h.coord),new xi(k,new gi(this.edge._label))},Ls.prototype.add=function(u,h,y){var x=new Ta(u,h,y),T=this._nodeMap.get(x);return null!==T?T:(this._nodeMap.put(x,x),x)},Ls.prototype.isIntersection=function(u){for(var h=this.iterator();h.hasNext();)if(h.next().coord.equals(u))return!0;return!1},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls};var ga=function(){};ga.prototype.getChainStartIndices=function(u){var h=0,y=new gn;y.add(new tt(h));do{var x=this.findChainEnd(u,h);y.add(new tt(x)),h=x}while(h<u.length-1);return ga.toIntArray(y)},ga.prototype.findChainEnd=function(u,h){for(var y=Vr.quadrant(u[h],u[h+1]),x=h+1;x<u.length&&Vr.quadrant(u[x-1],u[x])===y;)x++;return x-1},ga.prototype.interfaces_=function(){return[]},ga.prototype.getClass=function(){return ga},ga.toIntArray=function(u){for(var h=new Array(u.size()).fill(null),y=0;y<h.length;y++)h[y]=u.get(y).intValue();return h};var fu=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new hn,this.env2=new hn;var u=arguments[0];this.e=u,this.pts=u.getCoordinates();var h=new ga;this.startIndex=h.getChainStartIndices(this.pts)};fu.prototype.getCoordinates=function(){return this.pts},fu.prototype.getMaxX=function(u){var h=this.pts[this.startIndex[u]].x,y=this.pts[this.startIndex[u+1]].x;return h>y?h:y},fu.prototype.getMinX=function(u){var h=this.pts[this.startIndex[u]].x,y=this.pts[this.startIndex[u+1]].x;return h<y?h:y},fu.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var u=arguments[0],h=arguments[1],y=arguments[2];this.computeIntersectsForChain(this.startIndex[u],this.startIndex[u+1],h,h.startIndex[y],h.startIndex[y+1],arguments[3])}else if(6===arguments.length){var T=arguments[0],k=arguments[1],G=arguments[2],K=arguments[3],re=arguments[4],et=arguments[5],Ft=this.pts[T],$t=this.pts[k],gt=G.pts[K],nn=G.pts[re];if(k-T==1&&re-K==1)return et.addIntersections(this.e,T,G.e,K),null;if(this.env1.init(Ft,$t),this.env2.init(gt,nn),!this.env1.intersects(this.env2))return null;var Un=Math.trunc((T+k)/2),Qn=Math.trunc((K+re)/2);T<Un&&(K<Qn&&this.computeIntersectsForChain(T,Un,G,K,Qn,et),Qn<re&&this.computeIntersectsForChain(T,Un,G,Qn,re,et)),Un<k&&(K<Qn&&this.computeIntersectsForChain(Un,k,G,K,Qn,et),Qn<re&&this.computeIntersectsForChain(Un,k,G,Qn,re,et))}},fu.prototype.getStartIndexes=function(){return this.startIndex},fu.prototype.computeIntersects=function(u,h){for(var y=0;y<this.startIndex.length-1;y++)for(var x=0;x<u.startIndex.length-1;x++)this.computeIntersectsForChain(y,u,x,h)},fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu};var vi=function u(){this._depth=Array(2).fill().map(function(){return Array(3)});for(var h=0;h<2;h++)for(var y=0;y<3;y++)this._depth[h][y]=u.NULL_VALUE},ma={NULL_VALUE:{configurable:!0}};vi.prototype.getDepth=function(u,h){return this._depth[u][h]},vi.prototype.setDepth=function(u,h,y){this._depth[u][h]=y},vi.prototype.isNull=function(){if(0===arguments.length){for(var u=0;u<2;u++)for(var h=0;h<3;h++)if(this._depth[u][h]!==vi.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._depth[arguments[0]][1]===vi.NULL_VALUE:2===arguments.length?this._depth[arguments[0]][arguments[1]]===vi.NULL_VALUE:void 0},vi.prototype.normalize=function(){for(var u=0;u<2;u++)if(!this.isNull(u)){var h=this._depth[u][1];this._depth[u][2]<h&&(h=this._depth[u][2]),h<0&&(h=0);for(var y=1;y<3;y++){var x=0;this._depth[u][y]>h&&(x=1),this._depth[u][y]=x}}},vi.prototype.getDelta=function(u){return this._depth[u][mn.RIGHT]-this._depth[u][mn.LEFT]},vi.prototype.getLocation=function(u,h){return this._depth[u][h]<=0?ue.EXTERIOR:ue.INTERIOR},vi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]},vi.prototype.add=function(){if(1===arguments.length)for(var u=arguments[0],h=0;h<2;h++)for(var y=1;y<3;y++){var x=u.getLocation(h,y);x!==ue.EXTERIOR&&x!==ue.INTERIOR||(this.isNull(h,y)?this._depth[h][y]=vi.depthAtLocation(x):this._depth[h][y]+=vi.depthAtLocation(x))}else 3===arguments.length&&arguments[2]===ue.INTERIOR&&this._depth[arguments[0]][arguments[1]]++},vi.prototype.interfaces_=function(){return[]},vi.prototype.getClass=function(){return vi},vi.depthAtLocation=function(u){return u===ue.EXTERIOR?0:u===ue.INTERIOR?1:vi.NULL_VALUE},ma.NULL_VALUE.get=function(){return-1},Object.defineProperties(vi,ma);var xi=function(u){function h(){if(u.call(this),this.pts=null,this._env=null,this.eiList=new Ls(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new vi,this._depthDelta=0,1===arguments.length)h.call(this,arguments[0],null);else if(2===arguments.length){var T=arguments[1];this.pts=arguments[0],this._label=T}}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.getDepth=function(){return this._depth},h.prototype.getCollapsedEdge=function(){var y=new Array(2).fill(null);return y[0]=this.pts[0],y[1]=this.pts[1],new h(y,gi.toLineLabel(this._label))},h.prototype.isIsolated=function(){return this._isIsolated},h.prototype.getCoordinates=function(){return this.pts},h.prototype.setIsolated=function(y){this._isIsolated=y},h.prototype.setName=function(y){this._name=y},h.prototype.equals=function(y){if(!(y instanceof h))return!1;var x=y;if(this.pts.length!==x.pts.length)return!1;for(var T=!0,k=!0,G=this.pts.length,K=0;K<this.pts.length;K++)if(this.pts[K].equals2D(x.pts[K])||(T=!1),this.pts[K].equals2D(x.pts[--G])||(k=!1),!T&&!k)return!1;return!0},h.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},h.prototype.print=function(y){y.print("edge "+this._name+": "),y.print("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.print(","),y.print(this.pts[x].x+" "+this.pts[x].y);y.print(")  "+this._label+" "+this._depthDelta)},h.prototype.computeIM=function(y){h.updateIM(this._label,y)},h.prototype.isCollapsed=function(){return!!this._label.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},h.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},h.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},h.prototype.getDepthDelta=function(){return this._depthDelta},h.prototype.getNumPoints=function(){return this.pts.length},h.prototype.printReverse=function(y){y.print("edge "+this._name+": ");for(var x=this.pts.length-1;x>=0;x--)y.print(this.pts[x]+" ");y.println("")},h.prototype.getMonotoneChainEdge=function(){return null===this._mce&&(this._mce=new fu(this)),this._mce},h.prototype.getEnvelope=function(){if(null===this._env){this._env=new hn;for(var y=0;y<this.pts.length;y++)this._env.expandToInclude(this.pts[y])}return this._env},h.prototype.addIntersection=function(y,x,T,k){var G=new J(y.getIntersection(k)),K=x,re=y.getEdgeDistance(T,k),et=K+1;et<this.pts.length&&G.equals2D(this.pts[et])&&(K=et,re=0),this.eiList.add(G,K,re)},h.prototype.toString=function(){var y=new Me;y.append("edge "+this._name+": "),y.append("LINESTRING (");for(var x=0;x<this.pts.length;x++)x>0&&y.append(","),y.append(this.pts[x].x+" "+this.pts[x].y);return y.append(")  "+this._label+" "+this._depthDelta),y.toString()},h.prototype.isPointwiseEqual=function(y){if(this.pts.length!==y.pts.length)return!1;for(var x=0;x<this.pts.length;x++)if(!this.pts[x].equals2D(y.pts[x]))return!1;return!0},h.prototype.setDepthDelta=function(y){this._depthDelta=y},h.prototype.getEdgeIntersectionList=function(){return this.eiList},h.prototype.addIntersections=function(y,x,T){for(var k=0;k<y.getIntersectionNum();k++)this.addIntersection(y,x,T,k)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.updateIM=function(){if(2!==arguments.length)return u.prototype.updateIM.apply(this,arguments);var y=arguments[0],x=arguments[1];x.setAtLeastIfValid(y.getLocation(0,mn.ON),y.getLocation(1,mn.ON),1),y.isArea()&&(x.setAtLeastIfValid(y.getLocation(0,mn.LEFT),y.getLocation(1,mn.LEFT),2),x.setAtLeastIfValid(y.getLocation(0,mn.RIGHT),y.getLocation(1,mn.RIGHT),2))},h}(Rs),mi=function(u){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new _s,this._bufParams=u||null};mi.prototype.setWorkingPrecisionModel=function(u){this._workingPrecisionModel=u},mi.prototype.insertUniqueEdge=function(u){var h=this._edgeList.findEqualEdge(u);if(null!==h){var y=h.getLabel(),x=u.getLabel();h.isPointwiseEqual(u)||(x=new gi(u.getLabel())).flip(),y.merge(x);var T=mi.depthDelta(x),k=h.getDepthDelta()+T;h.setDepthDelta(k)}else this._edgeList.add(u),u.setDepthDelta(mi.depthDelta(u.getLabel()))},mi.prototype.buildSubgraphs=function(u,h){for(var y=new gn,x=u.iterator();x.hasNext();){var T=x.next(),k=T.getRightmostCoordinate(),G=new gc(y).getDepth(k);T.computeDepth(G),T.findResultEdges(),y.add(T),h.add(T.getDirectedEdges(),T.getNodes())}},mi.prototype.createSubgraphs=function(u){for(var h=new gn,y=u.getNodes().iterator();y.hasNext();){var x=y.next();if(!x.isVisited()){var T=new Ur;T.create(x),h.add(T)}}return $o.sort(h,$o.reverseOrder()),h},mi.prototype.createEmptyResultGeometry=function(){return this._geomFact.createPolygon()},mi.prototype.getNoder=function(u){if(null!==this._workingNoder)return this._workingNoder;var h=new Nu,y=new Bt;return y.setPrecisionModel(u),h.setSegmentIntersector(new pa(y)),h},mi.prototype.buffer=function(u,h){var y=this._workingPrecisionModel;null===y&&(y=u.getPrecisionModel()),this._geomFact=u.getFactory();var x=new Mo(y,this._bufParams),T=new Hr(u,h,x).getCurves();if(T.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(T,y),this._graph=new kn(new mc),this._graph.addEdges(this._edgeList.getEdges());var k=this.createSubgraphs(this._graph),G=new ws(this._geomFact);this.buildSubgraphs(k,G);var K=G.getPolygons();return K.size()<=0?this.createEmptyResultGeometry():this._geomFact.buildGeometry(K)},mi.prototype.computeNodedEdges=function(u,h){var y=this.getNoder(h);y.computeNodes(u);for(var x=y.getNodedSubstrings().iterator();x.hasNext();){var T=x.next(),k=T.getCoordinates();if(2!==k.length||!k[0].equals2D(k[1])){var G=T.getData(),K=new xi(T.getCoordinates(),new gi(G));this.insertUniqueEdge(K)}}},mi.prototype.setNoder=function(u){this._workingNoder=u},mi.prototype.interfaces_=function(){return[]},mi.prototype.getClass=function(){return mi},mi.depthDelta=function(u){var h=u.getLocation(0,mn.LEFT),y=u.getLocation(0,mn.RIGHT);return h===ue.INTERIOR&&y===ue.EXTERIOR?1:h===ue.EXTERIOR&&y===ue.INTERIOR?-1:0},mi.convertSegStrings=function(u){for(var h=new pr,y=new gn;u.hasNext();){var x=u.next(),T=h.createLineString(x.getCoordinates());y.add(T)}return h.buildGeometry(y)};var hs=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,2===arguments.length){var h=arguments[1];this._noder=arguments[0],this._scaleFactor=h,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(4===arguments.length){var x=arguments[1],T=arguments[2],k=arguments[3];this._noder=arguments[0],this._scaleFactor=x,this._offsetX=T,this._offsetY=k,this._isScaled=!this.isIntegerPrecision()}};hs.prototype.rescale=function(){if(At(arguments[0],oi))for(var u=arguments[0].iterator();u.hasNext();){var h=u.next();this.rescale(h.getCoordinates())}else if(arguments[0]instanceof Array){for(var y=arguments[0],x=0;x<y.length;x++)y[x].x=y[x].x/this._scaleFactor+this._offsetX,y[x].y=y[x].y/this._scaleFactor+this._offsetY;2===y.length&&y[0].equals2D(y[1])&&vn.out.println(y)}},hs.prototype.scale=function(){if(At(arguments[0],oi)){for(var u=arguments[0],h=new gn,y=u.iterator();y.hasNext();){var x=y.next();h.add(new mo(this.scale(x.getCoordinates()),x.getData()))}return h}if(arguments[0]instanceof Array){for(var T=arguments[0],k=new Array(T.length).fill(null),G=0;G<T.length;G++)k[G]=new J(Math.round((T[G].x-this._offsetX)*this._scaleFactor),Math.round((T[G].y-this._offsetY)*this._scaleFactor),T[G].z);return _r.removeRepeatedPoints(k)}},hs.prototype.isIntegerPrecision=function(){return 1===this._scaleFactor},hs.prototype.getNodedSubstrings=function(){var u=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(u),u},hs.prototype.computeNodes=function(u){var h=u;this._isScaled&&(h=this.scale(u)),this._noder.computeNodes(h)},hs.prototype.interfaces_=function(){return[cu]},hs.prototype.getClass=function(){return hs};var Ws=function(){this._li=new Bt,this._segStrings=null,this._segStrings=arguments[0]},Za={fact:{configurable:!0}};Ws.prototype.checkEndPtVertexIntersections=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var h=u.next().getCoordinates();this.checkEndPtVertexIntersections(h[0],this._segStrings),this.checkEndPtVertexIntersections(h[h.length-1],this._segStrings)}else if(2===arguments.length)for(var y=arguments[0],x=arguments[1].iterator();x.hasNext();)for(var T=x.next().getCoordinates(),k=1;k<T.length-1;k++)if(T[k].equals(y))throw new ye("found endpt/interior pt intersection at index "+k+" :pt "+y)},Ws.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();)for(var h=u.next(),y=this._segStrings.iterator();y.hasNext();){var x=y.next();this.checkInteriorIntersections(h,x)}else if(2===arguments.length)for(var T=arguments[0],k=arguments[1],G=T.getCoordinates(),K=k.getCoordinates(),re=0;re<G.length-1;re++)for(var et=0;et<K.length-1;et++)this.checkInteriorIntersections(T,re,k,et);else if(4===arguments.length){var Ft=arguments[0],$t=arguments[1],gt=arguments[2],nn=arguments[3];if(Ft===gt&&$t===nn)return null;var Un=Ft.getCoordinates()[$t],Qn=Ft.getCoordinates()[$t+1],Sr=gt.getCoordinates()[nn],Bo=gt.getCoordinates()[nn+1];if(this._li.computeIntersection(Un,Qn,Sr,Bo),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,Un,Qn)||this.hasInteriorIntersection(this._li,Sr,Bo)))throw new ye("found non-noded intersection at "+Un+"-"+Qn+" and "+Sr+"-"+Bo)}},Ws.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},Ws.prototype.checkCollapses=function(){if(0===arguments.length)for(var u=this._segStrings.iterator();u.hasNext();){var h=u.next();this.checkCollapses(h)}else if(1===arguments.length)for(var y=arguments[0].getCoordinates(),x=0;x<y.length-2;x++)this.checkCollapse(y[x],y[x+1],y[x+2])},Ws.prototype.hasInteriorIntersection=function(u,h,y){for(var x=0;x<u.getIntersectionNum();x++){var T=u.getIntersection(x);if(!T.equals(h)&&!T.equals(y))return!0}return!1},Ws.prototype.checkCollapse=function(u,h,y){if(u.equals(y))throw new ye("found non-noded collapse at "+Ws.fact.createLineString([u,h,y]))},Ws.prototype.interfaces_=function(){return[]},Ws.prototype.getClass=function(){return Ws},Za.fact.get=function(){return new pr},Object.defineProperties(Ws,Za);var Co=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var u=arguments[0],h=arguments[1],y=arguments[2];if(this._originalPt=u,this._pt=u,this._scaleFactor=h,this._li=y,h<=0)throw new Y("Scale factor must be non-zero");1!==h&&(this._pt=new J(this.scale(u.x),this.scale(u.y)),this._p0Scaled=new J,this._p1Scaled=new J),this.initCorners(this._pt)},Hn={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Co.prototype.intersectsScaled=function(u,h){var y=Math.min(u.x,h.x),x=Math.max(u.x,h.x),T=Math.min(u.y,h.y),k=Math.max(u.y,h.y),G=this._maxx<y||this._minx>x||this._maxy<T||this._miny>k;if(G)return!1;var K=this.intersectsToleranceSquare(u,h);return ae.isTrue(!(G&&K),"Found bad envelope test"),K},Co.prototype.initCorners=function(u){this._minx=u.x-.5,this._maxx=u.x+.5,this._miny=u.y-.5,this._maxy=u.y+.5,this._corner[0]=new J(this._maxx,this._maxy),this._corner[1]=new J(this._minx,this._maxy),this._corner[2]=new J(this._minx,this._miny),this._corner[3]=new J(this._maxx,this._miny)},Co.prototype.intersects=function(u,h){return 1===this._scaleFactor?this.intersectsScaled(u,h):(this.copyScaled(u,this._p0Scaled),this.copyScaled(h,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))},Co.prototype.scale=function(u){return Math.round(u*this._scaleFactor)},Co.prototype.getCoordinate=function(){return this._originalPt},Co.prototype.copyScaled=function(u,h){h.x=this.scale(u.x),h.y=this.scale(u.y)},Co.prototype.getSafeEnvelope=function(){if(null===this._safeEnv){var u=Co.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new hn(this._originalPt.x-u,this._originalPt.x+u,this._originalPt.y-u,this._originalPt.y+u)}return this._safeEnv},Co.prototype.intersectsPixelClosure=function(u,h){return this._li.computeIntersection(u,h,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[1],this._corner[2]),this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[2],this._corner[3]),this._li.hasIntersection()||(this._li.computeIntersection(u,h,this._corner[3],this._corner[0]),this._li.hasIntersection()))))},Co.prototype.intersectsToleranceSquare=function(u,h){var y=!1,x=!1;return this._li.computeIntersection(u,h,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(u,h,this._corner[1],this._corner[2]),this._li.isProper()||(this._li.hasIntersection()&&(y=!0),this._li.computeIntersection(u,h,this._corner[2],this._corner[3]),this._li.isProper()||(this._li.hasIntersection()&&(x=!0),this._li.computeIntersection(u,h,this._corner[3],this._corner[0]),this._li.isProper()||y&&x||u.equals(this._pt)||h.equals(this._pt)))))},Co.prototype.addSnappedNode=function(u,h){var y=u.getCoordinate(h),x=u.getCoordinate(h+1);return!!this.intersects(y,x)&&(u.addIntersection(this.getCoordinate(),h),!0)},Co.prototype.interfaces_=function(){return[]},Co.prototype.getClass=function(){return Co},Hn.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(Co,Hn);var Nr=function(){this.tempEnv1=new hn,this.selectedSegment=new Wn};Nr.prototype.select=function(){1!==arguments.length&&2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},Nr.prototype.interfaces_=function(){return[]},Nr.prototype.getClass=function(){return Nr};var ko=function(){this._index=null,this._index=arguments[0]},Wa={HotPixelSnapAction:{configurable:!0}};ko.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2],T=h.getSafeEnvelope(),k=new $l(h,y,x);return this._index.query(T,{interfaces_:function(){return[za]},visitItem:function(G){G.select(T,k)}}),k.isNodeAdded()}},ko.prototype.interfaces_=function(){return[]},ko.prototype.getClass=function(){return ko},Wa.HotPixelSnapAction.get=function(){return $l},Object.defineProperties(ko,Wa);var $l=function(u){function h(){u.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var x=arguments[1],T=arguments[2];this._hotPixel=arguments[0],this._parentEdge=x,this._hotPixelVertexIndex=T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.isNodeAdded=function(){return this._isNodeAdded},h.prototype.select=function(){if(2!==arguments.length)return u.prototype.select.apply(this,arguments);var x=arguments[1],T=arguments[0].getContext();if(null!==this._parentEdge&&T===this._parentEdge&&x===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(T,x)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Nr),rs=function(){this._li=null,this._interiorIntersections=null,this._li=arguments[0],this._interiorIntersections=new gn};rs.prototype.processIntersections=function(u,h,y,x){if(u===y&&h===x)return null;var T=u.getCoordinates()[h],k=u.getCoordinates()[h+1],G=y.getCoordinates()[x],K=y.getCoordinates()[x+1];if(this._li.computeIntersection(T,k,G,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var re=0;re<this._li.getIntersectionNum();re++)this._interiorIntersections.add(this._li.getIntersection(re));u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)}},rs.prototype.isDone=function(){return!1},rs.prototype.getInteriorIntersections=function(){return this._interiorIntersections},rs.prototype.interfaces_=function(){return[Du]},rs.prototype.getClass=function(){return rs};var Ys=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var u=arguments[0];this._pm=u,this._li=new Bt,this._li.setPrecisionModel(u),this._scaleFactor=u.getScale()};Ys.prototype.checkCorrectness=function(u){var h=mo.getNodedSubstrings(u),y=new Ws(h);try{y.checkValid()}catch(x){if(!(x instanceof Rn))throw x;x.printStackTrace()}},Ys.prototype.getNodedSubstrings=function(){return mo.getNodedSubstrings(this._nodedSegStrings)},Ys.prototype.snapRound=function(u,h){var y=this.findInteriorIntersections(u,h);this.computeIntersectionSnaps(y),this.computeVertexSnaps(u)},Ys.prototype.findInteriorIntersections=function(u,h){var y=new rs(h);return this._noder.setSegmentIntersector(y),this._noder.computeNodes(u),y.getInteriorIntersections()},Ys.prototype.computeVertexSnaps=function(){if(At(arguments[0],oi))for(var u=arguments[0].iterator();u.hasNext();){var h=u.next();this.computeVertexSnaps(h)}else if(arguments[0]instanceof mo)for(var y=arguments[0],x=y.getCoordinates(),T=0;T<x.length;T++){var k=new Co(x[T],this._scaleFactor,this._li);this._pointSnapper.snap(k,y,T)&&y.addIntersection(x[T],T)}},Ys.prototype.computeNodes=function(u){this._nodedSegStrings=u,this._noder=new Nu,this._pointSnapper=new ko(this._noder.getIndex()),this.snapRound(u,this._li)},Ys.prototype.computeIntersectionSnaps=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next(),x=new Co(y,this._scaleFactor,this._li);this._pointSnapper.snap(x)}},Ys.prototype.interfaces_=function(){return[cu]},Ys.prototype.getClass=function(){return Ys};var ri=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Pn,this._resultGeometry=null,this._saveException=null,1===arguments.length)this._argGeom=arguments[0];else if(2===arguments.length){var y=arguments[1];this._argGeom=arguments[0],this._bufParams=y}},Bu={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ri.prototype.bufferFixedPrecision=function(u){var h=new hs(new Ys(new Qt(1)),u.getScale()),y=new mi(this._bufParams);y.setWorkingPrecisionModel(u),y.setNoder(h),this._resultGeometry=y.buffer(this._argGeom,this._distance)},ri.prototype.bufferReducedPrecision=function(){var u=this;if(0===arguments.length){for(var h=ri.MAX_PRECISION_DIGITS;h>=0;h--){try{u.bufferReducedPrecision(h)}catch(k){if(!(k instanceof ba))throw k;u._saveException=k}if(null!==u._resultGeometry)return null}throw this._saveException}if(1===arguments.length){var x=ri.precisionScaleFactor(this._argGeom,this._distance,arguments[0]),T=new Qt(x);this.bufferFixedPrecision(T)}},ri.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this._resultGeometry)return null;var u=this._argGeom.getFactory().getPrecisionModel();u.getType()===Qt.FIXED?this.bufferFixedPrecision(u):this.bufferReducedPrecision()},ri.prototype.setQuadrantSegments=function(u){this._bufParams.setQuadrantSegments(u)},ri.prototype.bufferOriginalPrecision=function(){try{var u=new mi(this._bufParams);this._resultGeometry=u.buffer(this._argGeom,this._distance)}catch(h){if(!(h instanceof ye))throw h;this._saveException=h}},ri.prototype.getResultGeometry=function(u){return this._distance=u,this.computeGeometry(),this._resultGeometry},ri.prototype.setEndCapStyle=function(u){this._bufParams.setEndCapStyle(u)},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri},ri.bufferOp=function(){if(2===arguments.length){var h=arguments[1];return new ri(arguments[0]).getResultGeometry(h)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof En&&"number"==typeof arguments[1]){var x=arguments[1],T=arguments[2],k=new ri(arguments[0]);return k.setQuadrantSegments(T),k.getResultGeometry(x)}if(arguments[2]instanceof Pn&&arguments[0]instanceof En&&"number"==typeof arguments[1]){var K=arguments[1];return new ri(arguments[0],arguments[2]).getResultGeometry(K)}}else if(4===arguments.length){var Ft=arguments[1],$t=arguments[2],gt=arguments[3],nn=new ri(arguments[0]);return nn.setQuadrantSegments($t),nn.setEndCapStyle(gt),nn.getResultGeometry(Ft)}},ri.precisionScaleFactor=function(u,h,y){var x=u.getEnvelopeInternal(),T=Pe.max(Math.abs(x.getMaxX()),Math.abs(x.getMaxY()),Math.abs(x.getMinX()),Math.abs(x.getMinY()))+2*(h>0?h:0),k=y-Math.trunc(Math.log(T)/Math.log(10)+1);return Math.pow(10,k)},Bu.CAP_ROUND.get=function(){return Pn.CAP_ROUND},Bu.CAP_BUTT.get=function(){return Pn.CAP_FLAT},Bu.CAP_FLAT.get=function(){return Pn.CAP_FLAT},Bu.CAP_SQUARE.get=function(){return Pn.CAP_SQUARE},Bu.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(ri,Bu);var qo=function(){this._pt=[new J,new J],this._distance=ce.NaN,this._isNull=!0};qo.prototype.getCoordinates=function(){return this._pt},qo.prototype.getCoordinate=function(u){return this._pt[u]},qo.prototype.setMinimum=function(){if(1===arguments.length){var u=arguments[0];this.setMinimum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},qo.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var u=arguments[0],h=arguments[1];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(h),this._distance=u.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},qo.prototype.getDistance=function(){return this._distance},qo.prototype.setMaximum=function(){if(1===arguments.length){var u=arguments[0];this.setMaximum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},qo.prototype.interfaces_=function(){return[]},qo.prototype.getClass=function(){return qo};var Rr=function(){};Rr.prototype.interfaces_=function(){return[]},Rr.prototype.getClass=function(){return Rr},Rr.computeDistance=function(){if(arguments[2]instanceof qo&&arguments[0]instanceof dr&&arguments[1]instanceof J)for(var h=arguments[1],y=arguments[2],x=arguments[0].getCoordinates(),T=new Wn,k=0;k<x.length-1;k++){T.setCoordinates(x[k],x[k+1]);var G=T.closestPoint(h);y.setMinimum(G,h)}else if(arguments[2]instanceof qo&&arguments[0]instanceof Rt&&arguments[1]instanceof J){var K=arguments[0],re=arguments[1],et=arguments[2];Rr.computeDistance(K.getExteriorRing(),re,et);for(var Ft=0;Ft<K.getNumInteriorRing();Ft++)Rr.computeDistance(K.getInteriorRingN(Ft),re,et)}else if(arguments[2]instanceof qo&&arguments[0]instanceof En&&arguments[1]instanceof J){var $t=arguments[0],gt=arguments[1],nn=arguments[2];if($t instanceof dr)Rr.computeDistance($t,gt,nn);else if($t instanceof Rt)Rr.computeDistance($t,gt,nn);else if($t instanceof zn)for(var Un=$t,Qn=0;Qn<Un.getNumGeometries();Qn++){var Sr=Un.getGeometryN(Qn);Rr.computeDistance(Sr,gt,nn)}else nn.setMinimum($t.getCoordinate(),gt)}else if(arguments[2]instanceof qo&&arguments[0]instanceof Wn&&arguments[1]instanceof J){var xs=arguments[1],Ss=arguments[2],Va=arguments[0].closestPoint(xs);Ss.setMinimum(Va,xs)}};var Qu=function(u){this._maxPtDist=new qo,this._inputGeom=u||null},ql={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};Qu.prototype.computeMaxMidpointDistance=function(u){var h=new Ba(this._inputGeom);u.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},Qu.prototype.computeMaxVertexDistance=function(u){var h=new _l(this._inputGeom);u.apply(h),this._maxPtDist.setMaximum(h.getMaxPointDistance())},Qu.prototype.findDistance=function(u){return this.computeMaxVertexDistance(u),this.computeMaxMidpointDistance(u),this._maxPtDist.getDistance()},Qu.prototype.getDistancePoints=function(){return this._maxPtDist},Qu.prototype.interfaces_=function(){return[]},Qu.prototype.getClass=function(){return Qu},ql.MaxPointDistanceFilter.get=function(){return _l},ql.MaxMidpointDistanceFilter.get=function(){return Ba},Object.defineProperties(Qu,ql);var _l=function(u){this._maxPtDist=new qo,this._minPtDist=new qo,this._geom=u||null};_l.prototype.filter=function(u){this._minPtDist.initialize(),Rr.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},_l.prototype.getMaxPointDistance=function(){return this._maxPtDist},_l.prototype.interfaces_=function(){return[qr]},_l.prototype.getClass=function(){return _l};var Ba=function(u){this._maxPtDist=new qo,this._minPtDist=new qo,this._geom=u||null};Ba.prototype.filter=function(u,h){if(0===h)return null;var y=u.getCoordinate(h-1),x=u.getCoordinate(h),T=new J((y.x+x.x)/2,(y.y+x.y)/2);this._minPtDist.initialize(),Rr.computeDistance(this._geom,T,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},Ba.prototype.isDone=function(){return!1},Ba.prototype.isGeometryChanged=function(){return!1},Ba.prototype.getMaxPointDistance=function(){return this._maxPtDist},Ba.prototype.interfaces_=function(){return[tn]},Ba.prototype.getClass=function(){return Ba};var Fo=function(u){this._comps=u||null};Fo.prototype.filter=function(u){u instanceof Rt&&this._comps.add(u)},Fo.prototype.interfaces_=function(){return[yn]},Fo.prototype.getClass=function(){return Fo},Fo.getPolygons=function(){if(1===arguments.length)return Fo.getPolygons(arguments[0],new gn);if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof Rt?y.add(h):h instanceof zn&&h.apply(new Fo(y)),y}};var Ho=function(){if(this._lines=null,this._isForcedToLineString=!1,1===arguments.length)this._lines=arguments[0];else if(2===arguments.length){var y=arguments[1];this._lines=arguments[0],this._isForcedToLineString=y}};Ho.prototype.filter=function(u){if(this._isForcedToLineString&&u instanceof go){var h=u.getFactory().createLineString(u.getCoordinateSequence());return this._lines.add(h),null}u instanceof dr&&this._lines.add(u)},Ho.prototype.setForceToLineString=function(u){this._isForcedToLineString=u},Ho.prototype.interfaces_=function(){return[lr]},Ho.prototype.getClass=function(){return Ho},Ho.getGeometry=function(){if(1===arguments.length){var u=arguments[0];return u.getFactory().buildGeometry(Ho.getLines(u))}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().buildGeometry(Ho.getLines(h,y))}},Ho.getLines=function(){if(1===arguments.length)return Ho.getLines(arguments[0],!1);if(2===arguments.length){if(At(arguments[0],oi)&&At(arguments[1],oi)){for(var y=arguments[1],x=arguments[0].iterator();x.hasNext();){var T=x.next();Ho.getLines(T,y)}return y}if(arguments[0]instanceof En&&"boolean"==typeof arguments[1]){var k=arguments[0],G=arguments[1],K=new gn;return k.apply(new Ho(K,G)),K}if(arguments[0]instanceof En&&At(arguments[1],oi)){var re=arguments[0],et=arguments[1];return re instanceof dr?et.add(re):re.apply(new Ho(et)),et}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&At(arguments[0],oi)&&At(arguments[1],oi)){for(var $t=arguments[1],gt=arguments[2],nn=arguments[0].iterator();nn.hasNext();){var Un=nn.next();Ho.getLines(Un,$t,gt)}return $t}if("boolean"==typeof arguments[2]&&arguments[0]instanceof En&&At(arguments[1],oi)){var Sr=arguments[1];return arguments[0].apply(new Ho(Sr,arguments[2])),Sr}}};var Os=function(){if(this._boundaryRule=ui.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,0!==arguments.length&&1===arguments.length){var u=arguments[0];if(null===u)throw new Y("Rule must be non-null");this._boundaryRule=u}};Os.prototype.locateInternal=function(){if(arguments[0]instanceof J&&arguments[1]instanceof Rt){var u=arguments[0],h=arguments[1];if(h.isEmpty())return ue.EXTERIOR;var y=h.getExteriorRing(),x=this.locateInPolygonRing(u,y);if(x===ue.EXTERIOR)return ue.EXTERIOR;if(x===ue.BOUNDARY)return ue.BOUNDARY;for(var T=0;T<h.getNumInteriorRing();T++){var k=h.getInteriorRingN(T),G=this.locateInPolygonRing(u,k);if(G===ue.INTERIOR)return ue.EXTERIOR;if(G===ue.BOUNDARY)return ue.BOUNDARY}return ue.INTERIOR}if(arguments[0]instanceof J&&arguments[1]instanceof dr){var K=arguments[0],re=arguments[1];if(!re.getEnvelopeInternal().intersects(K))return ue.EXTERIOR;var et=re.getCoordinates();return re.isClosed()||!K.equals(et[0])&&!K.equals(et[et.length-1])?Gt.isOnLine(K,et)?ue.INTERIOR:ue.EXTERIOR:ue.BOUNDARY}if(arguments[0]instanceof J&&arguments[1]instanceof ps){var Ft=arguments[0];return arguments[1].getCoordinate().equals2D(Ft)?ue.INTERIOR:ue.EXTERIOR}},Os.prototype.locateInPolygonRing=function(u,h){return h.getEnvelopeInternal().intersects(u)?Gt.locatePointInRing(u,h.getCoordinates()):ue.EXTERIOR},Os.prototype.intersects=function(u,h){return this.locate(u,h)!==ue.EXTERIOR},Os.prototype.updateLocationInfo=function(u){u===ue.INTERIOR&&(this._isIn=!0),u===ue.BOUNDARY&&this._numBoundaries++},Os.prototype.computeLocation=function(u,h){if(h instanceof ps&&this.updateLocationInfo(this.locateInternal(u,h)),h instanceof dr)this.updateLocationInfo(this.locateInternal(u,h));else if(h instanceof Rt)this.updateLocationInfo(this.locateInternal(u,h));else if(h instanceof $n)for(var y=h,x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.updateLocationInfo(this.locateInternal(u,T))}else if(h instanceof ra)for(var k=h,G=0;G<k.getNumGeometries();G++){var K=k.getGeometryN(G);this.updateLocationInfo(this.locateInternal(u,K))}else if(h instanceof zn)for(var re=new Ia(h);re.hasNext();){var et=re.next();et!==h&&this.computeLocation(u,et)}},Os.prototype.locate=function(u,h){return h.isEmpty()?ue.EXTERIOR:h instanceof dr||h instanceof Rt?this.locateInternal(u,h):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(u,h),this._boundaryRule.isInBoundary(this._numBoundaries)?ue.BOUNDARY:this._numBoundaries>0||this._isIn?ue.INTERIOR:ue.EXTERIOR)},Os.prototype.interfaces_=function(){return[]},Os.prototype.getClass=function(){return Os};var Ao=function u(){if(this._component=null,this._segIndex=null,this._pt=null,2===arguments.length)u.call(this,arguments[0],u.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var T=arguments[1],k=arguments[2];this._component=arguments[0],this._segIndex=T,this._pt=k}},yc={INSIDE_AREA:{configurable:!0}};Ao.prototype.isInsideArea=function(){return this._segIndex===Ao.INSIDE_AREA},Ao.prototype.getCoordinate=function(){return this._pt},Ao.prototype.getGeometryComponent=function(){return this._component},Ao.prototype.getSegmentIndex=function(){return this._segIndex},Ao.prototype.interfaces_=function(){return[]},Ao.prototype.getClass=function(){return Ao},yc.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Ao,yc);var Uu=function(u){this._pts=u||null};Uu.prototype.filter=function(u){u instanceof ps&&this._pts.add(u)},Uu.prototype.interfaces_=function(){return[yn]},Uu.prototype.getClass=function(){return Uu},Uu.getPoints=function(){if(1===arguments.length){var u=arguments[0];return u instanceof ps?$o.singletonList(u):Uu.getPoints(u,new gn)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h instanceof ps?y.add(h):h instanceof zn&&h.apply(new Uu(y)),y}};var Mi=function(){this._locations=null,this._locations=arguments[0]};Mi.prototype.filter=function(u){(u instanceof ps||u instanceof dr||u instanceof Rt)&&this._locations.add(new Ao(u,0,u.getCoordinate()))},Mi.prototype.interfaces_=function(){return[yn]},Mi.prototype.getClass=function(){return Mi},Mi.getLocations=function(u){var h=new gn;return u.apply(new Mi(h)),h};var is=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new Os,this._minDistanceLocation=null,this._minDistance=ce.MAX_VALUE,2===arguments.length)this._geom=[arguments[0],arguments[1]],this._terminateDistance=0;else if(3===arguments.length){var y=arguments[0],x=arguments[1],T=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=y,this._geom[1]=x,this._terminateDistance=T}};is.prototype.computeContainmentDistance=function(){if(0===arguments.length){var u=new Array(2).fill(null);if(this.computeContainmentDistance(0,u),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=1-h,T=Fo.getPolygons(this._geom[h]);if(T.size()>0){var k=Mi.getLocations(this._geom[x]);if(this.computeContainmentDistance(k,T,y),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[x]=y[0],this._minDistanceLocation[h]=y[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&At(arguments[0],ts)&&At(arguments[1],ts)){for(var G=arguments[0],K=arguments[1],re=arguments[2],et=0;et<G.size();et++)for(var Ft=G.get(et),$t=0;$t<K.size();$t++)if(this.computeContainmentDistance(Ft,K.get($t),re),this._minDistance<=this._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ao&&arguments[1]instanceof Rt){var gt=arguments[0],nn=arguments[1],Un=arguments[2],Qn=gt.getCoordinate();if(ue.EXTERIOR!==this._ptLocator.locate(Qn,nn))return this._minDistance=0,Un[0]=gt,Un[1]=new Ao(nn,Qn),null}},is.prototype.computeMinDistanceLinesPoints=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),k=0;k<h.size();k++){var G=h.get(k);if(this.computeMinDistance(T,G,y),this._minDistance<=this._terminateDistance)return null}},is.prototype.computeFacetDistance=function(){var u=new Array(2).fill(null),h=Ho.getLines(this._geom[0]),y=Ho.getLines(this._geom[1]),x=Uu.getPoints(this._geom[0]),T=Uu.getPoints(this._geom[1]);return this.computeMinDistanceLines(h,y,u),this.updateMinDistance(u,!1),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistanceLinesPoints(h,T,u),this.updateMinDistance(u,!1),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistanceLinesPoints(y,x,u),this.updateMinDistance(u,!0),this._minDistance<=this._terminateDistance?null:(u[0]=null,u[1]=null,this.computeMinDistancePoints(x,T,u),void this.updateMinDistance(u,!1))))},is.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation},is.prototype.updateMinDistance=function(u,h){if(null===u[0])return null;h?(this._minDistanceLocation[0]=u[1],this._minDistanceLocation[1]=u[0]):(this._minDistanceLocation[0]=u[0],this._minDistanceLocation[1]=u[1])},is.prototype.nearestPoints=function(){return this.computeMinDistance(),[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()]},is.prototype.computeMinDistance=function(){if(0===arguments.length){if(null!==this._minDistanceLocation||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof dr&&arguments[1]instanceof ps){var u=arguments[0],h=arguments[1],y=arguments[2];if(u.getEnvelopeInternal().distance(h.getEnvelopeInternal())>this._minDistance)return null;for(var x=u.getCoordinates(),T=h.getCoordinate(),k=0;k<x.length-1;k++){var G=Gt.distancePointLine(T,x[k],x[k+1]);if(G<this._minDistance){this._minDistance=G;var K=new Wn(x[k],x[k+1]).closestPoint(T);y[0]=new Ao(u,k,K),y[1]=new Ao(h,0,T)}if(this._minDistance<=this._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof dr&&arguments[1]instanceof dr){var re=arguments[0],et=arguments[1],Ft=arguments[2];if(re.getEnvelopeInternal().distance(et.getEnvelopeInternal())>this._minDistance)return null;for(var $t=re.getCoordinates(),gt=et.getCoordinates(),nn=0;nn<$t.length-1;nn++)for(var Un=0;Un<gt.length-1;Un++){var Qn=Gt.distanceLineLine($t[nn],$t[nn+1],gt[Un],gt[Un+1]);if(Qn<this._minDistance){this._minDistance=Qn;var Sr=new Wn($t[nn],$t[nn+1]),Bo=new Wn(gt[Un],gt[Un+1]),xs=Sr.closestPoints(Bo);Ft[0]=new Ao(re,nn,xs[0]),Ft[1]=new Ao(et,Un,xs[1])}if(this._minDistance<=this._terminateDistance)return null}}},is.prototype.computeMinDistancePoints=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),k=0;k<h.size();k++){var G=h.get(k),K=T.getCoordinate().distance(G.getCoordinate());if(K<this._minDistance&&(this._minDistance=K,y[0]=new Ao(T,0,T.getCoordinate()),y[1]=new Ao(G,0,G.getCoordinate())),this._minDistance<=this._terminateDistance)return null}},is.prototype.distance=function(){if(null===this._geom[0]||null===this._geom[1])throw new Y("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)},is.prototype.computeMinDistanceLines=function(u,h,y){for(var x=0;x<u.size();x++)for(var T=u.get(x),k=0;k<h.size();k++){var G=h.get(k);if(this.computeMinDistance(T,G,y),this._minDistance<=this._terminateDistance)return null}},is.prototype.interfaces_=function(){return[]},is.prototype.getClass=function(){return is},is.distance=function(u,h){return new is(u,h).distance()},is.isWithinDistance=function(u,h,y){return new is(u,h,y).distance()<=y},is.nearestPoints=function(u,h){return new is(u,h).nearestPoints()};var Xo=function(){this._pt=[new J,new J],this._distance=ce.NaN,this._isNull=!0};Xo.prototype.getCoordinates=function(){return this._pt},Xo.prototype.getCoordinate=function(u){return this._pt[u]},Xo.prototype.setMinimum=function(){if(1===arguments.length){var u=arguments[0];this.setMinimum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x<this._distance&&this.initialize(h,y,x)}},Xo.prototype.initialize=function(){if(0===arguments.length)this._isNull=!0;else if(2===arguments.length){var u=arguments[0],h=arguments[1];this._pt[0].setCoordinate(u),this._pt[1].setCoordinate(h),this._distance=u.distance(h),this._isNull=!1}else if(3===arguments.length){var x=arguments[1],T=arguments[2];this._pt[0].setCoordinate(arguments[0]),this._pt[1].setCoordinate(x),this._distance=T,this._isNull=!1}},Xo.prototype.toString=function(){return _t.toLineString(this._pt[0],this._pt[1])},Xo.prototype.getDistance=function(){return this._distance},Xo.prototype.setMaximum=function(){if(1===arguments.length){var u=arguments[0];this.setMaximum(u._pt[0],u._pt[1])}else if(2===arguments.length){var h=arguments[0],y=arguments[1];if(this._isNull)return this.initialize(h,y),null;var x=h.distance(y);x>this._distance&&this.initialize(h,y,x)}},Xo.prototype.interfaces_=function(){return[]},Xo.prototype.getClass=function(){return Xo};var Ua=function(){};Ua.prototype.interfaces_=function(){return[]},Ua.prototype.getClass=function(){return Ua},Ua.computeDistance=function(){if(arguments[2]instanceof Xo&&arguments[0]instanceof dr&&arguments[1]instanceof J)for(var u=arguments[0],h=arguments[1],y=arguments[2],x=new Wn,T=u.getCoordinates(),k=0;k<T.length-1;k++){x.setCoordinates(T[k],T[k+1]);var G=x.closestPoint(h);y.setMinimum(G,h)}else if(arguments[2]instanceof Xo&&arguments[0]instanceof Rt&&arguments[1]instanceof J){var K=arguments[0],re=arguments[1],et=arguments[2];Ua.computeDistance(K.getExteriorRing(),re,et);for(var Ft=0;Ft<K.getNumInteriorRing();Ft++)Ua.computeDistance(K.getInteriorRingN(Ft),re,et)}else if(arguments[2]instanceof Xo&&arguments[0]instanceof En&&arguments[1]instanceof J){var $t=arguments[0],gt=arguments[1],nn=arguments[2];if($t instanceof dr)Ua.computeDistance($t,gt,nn);else if($t instanceof Rt)Ua.computeDistance($t,gt,nn);else if($t instanceof zn)for(var Un=$t,Qn=0;Qn<Un.getNumGeometries();Qn++){var Sr=Un.getGeometryN(Qn);Ua.computeDistance(Sr,gt,nn)}else nn.setMinimum($t.getCoordinate(),gt)}else if(arguments[2]instanceof Xo&&arguments[0]instanceof Wn&&arguments[1]instanceof J){var xs=arguments[1],Ss=arguments[2],Va=arguments[0].closestPoint(xs);Ss.setMinimum(Va,xs)}};var os=function(){this._g0=null,this._g1=null,this._ptDist=new Xo,this._densifyFrac=0;var h=arguments[1];this._g0=arguments[0],this._g1=h},Vu={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};os.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()},os.prototype.setDensifyFraction=function(u){if(u>1||u<=0)throw new Y("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=u},os.prototype.compute=function(u,h){this.computeOrientedDistance(u,h,this._ptDist),this.computeOrientedDistance(h,u,this._ptDist)},os.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()},os.prototype.computeOrientedDistance=function(u,h,y){var x=new du(h);if(u.apply(x),y.setMaximum(x.getMaxPointDistance()),this._densifyFrac>0){var T=new so(h,this._densifyFrac);u.apply(T),y.setMaximum(T.getMaxPointDistance())}},os.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()},os.prototype.interfaces_=function(){return[]},os.prototype.getClass=function(){return os},os.distance=function(){if(2===arguments.length)return new os(arguments[0],arguments[1]).distance();if(3===arguments.length){var T=arguments[2],k=new os(arguments[0],arguments[1]);return k.setDensifyFraction(T),k.distance()}},Vu.MaxPointDistanceFilter.get=function(){return du},Vu.MaxDensifiedByFractionDistanceFilter.get=function(){return so},Object.defineProperties(os,Vu);var du=function(){this._maxPtDist=new Xo,this._minPtDist=new Xo,this._euclideanDist=new Ua,this._geom=null,this._geom=arguments[0]};du.prototype.filter=function(u){this._minPtDist.initialize(),Ua.computeDistance(this._geom,u,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)},du.prototype.getMaxPointDistance=function(){return this._maxPtDist},du.prototype.interfaces_=function(){return[qr]},du.prototype.getClass=function(){return du};var so=function(){this._maxPtDist=new Xo,this._minPtDist=new Xo,this._geom=null,this._numSubSegs=0;var h=arguments[1];this._geom=arguments[0],this._numSubSegs=Math.trunc(Math.round(1/h))};so.prototype.filter=function(u,h){if(0===h)return null;for(var y=u.getCoordinate(h-1),x=u.getCoordinate(h),T=(x.x-y.x)/this._numSubSegs,k=(x.y-y.y)/this._numSubSegs,G=0;G<this._numSubSegs;G++){var et=new J(y.x+G*T,y.y+G*k);this._minPtDist.initialize(),Ua.computeDistance(this._geom,et,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)}},so.prototype.isDone=function(){return!1},so.prototype.isGeometryChanged=function(){return!1},so.prototype.getMaxPointDistance=function(){return this._maxPtDist},so.prototype.interfaces_=function(){return[tn]},so.prototype.getClass=function(){return so};var Lr=function(u,h,y){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=u||null,this._bufDistance=h||null,this._result=y||null},vs={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Lr.prototype.checkMaximumDistance=function(u,h,y){var x=new os(h,u);if(x.setDensifyFraction(.25),this._maxDistanceFound=x.orientedDistance(),this._maxDistanceFound>y){this._isValid=!1;var T=x.getCoordinates();this._errorLocation=T[1],this._errorIndicator=u.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+_t.toLineString(T[0],T[1])+")"}},Lr.prototype.isValid=function(){var u=Math.abs(this._bufDistance),h=Lr.MAX_DISTANCE_DIFF_FRAC*u;return this._minValidDistance=u-h,this._maxValidDistance=u+h,!(!this._input.isEmpty()&&!this._result.isEmpty())||(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Lr.VERBOSE&&vn.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)},Lr.prototype.checkNegativeValid=function(){if(!(this._input instanceof Rt||this._input instanceof ra||this._input instanceof zn))return null;var u=this.getPolygonLines(this._input);if(this.checkMinimumDistance(u,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(u,this._result,this._maxValidDistance)},Lr.prototype.getErrorIndicator=function(){return this._errorIndicator},Lr.prototype.checkMinimumDistance=function(u,h,y){var x=new is(u,h,y);if(this._minDistanceFound=x.distance(),this._minDistanceFound<y){this._isValid=!1;var T=x.nearestPoints();this._errorLocation=x.nearestPoints()[1],this._errorIndicator=u.getFactory().createLineString(T),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+_t.toLineString(T[0],T[1])+" )"}},Lr.prototype.checkPositiveValid=function(){var u=this._result.getBoundary();if(this.checkMinimumDistance(this._input,u,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,u,this._maxValidDistance)},Lr.prototype.getErrorLocation=function(){return this._errorLocation},Lr.prototype.getPolygonLines=function(u){for(var h=new gn,y=new Ho(h),x=Fo.getPolygons(u).iterator();x.hasNext();)x.next().apply(y);return u.getFactory().buildGeometry(h)},Lr.prototype.getErrorMessage=function(){return this._errMsg},Lr.prototype.interfaces_=function(){return[]},Lr.prototype.getClass=function(){return Lr},vs.VERBOSE.get=function(){return!1},vs.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Lr,vs);var vo=function(u,h,y){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=u||null,this._distance=h||null,this._result=y||null},Uc={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};vo.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid},vo.prototype.checkEnvelope=function(){if(this._distance<0)return null;var u=this._distance*vo.MAX_ENV_DIFF_FRAC;0===u&&(u=.001);var h=new hn(this._input.getEnvelopeInternal());h.expandBy(this._distance);var y=new hn(this._result.getEnvelopeInternal());y.expandBy(u),y.contains(h)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(y)),this.report("Envelope")},vo.prototype.checkDistance=function(){var u=new Lr(this._input,this._distance,this._result);u.isValid()||(this._isValid=!1,this._errorMsg=u.getErrorMessage(),this._errorLocation=u.getErrorLocation(),this._errorIndicator=u.getErrorIndicator()),this.report("Distance")},vo.prototype.checkArea=function(){var u=this._input.getArea(),h=this._result.getArea();this._distance>0&&u>h&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&u<h&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")},vo.prototype.checkPolygonal=function(){this._result instanceof Rt||this._result instanceof ra||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")},vo.prototype.getErrorIndicator=function(){return this._errorIndicator},vo.prototype.getErrorLocation=function(){return this._errorLocation},vo.prototype.checkExpectedEmpty=function(){return this._input.getDimension()>=2||this._distance>0?null:(this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),void this.report("ExpectedEmpty"))},vo.prototype.report=function(u){if(!vo.VERBOSE)return null;vn.out.println("Check "+u+": "+(this._isValid?"passed":"FAILED"))},vo.prototype.getErrorMessage=function(){return this._errorMsg},vo.prototype.interfaces_=function(){return[]},vo.prototype.getClass=function(){return vo},vo.isValidMsg=function(u,h,y){var x=new vo(u,h,y);return x.isValid()?null:x.getErrorMessage()},vo.isValid=function(u,h,y){return!!new vo(u,h,y).isValid()},Uc.VERBOSE.get=function(){return!1},Uc.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(vo,Uc);var Ts=function(){this._pts=null,this._data=null;var h=arguments[1];this._pts=arguments[0],this._data=h};Ts.prototype.getCoordinates=function(){return this._pts},Ts.prototype.size=function(){return this._pts.length},Ts.prototype.getCoordinate=function(u){return this._pts[u]},Ts.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])},Ts.prototype.getSegmentOctant=function(u){return u===this._pts.length-1?-1:jl.octant(this.getCoordinate(u),this.getCoordinate(u+1))},Ts.prototype.setData=function(u){this._data=u},Ts.prototype.getData=function(){return this._data},Ts.prototype.toString=function(){return _t.toLineString(new un(this._pts))},Ts.prototype.interfaces_=function(){return[Iu]},Ts.prototype.getClass=function(){return Ts};var fs=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new gn,this._intersectionCount=0,this._keepIntersections=!0,this._li=arguments[0],this._interiorIntersection=null};fs.prototype.getInteriorIntersection=function(){return this._interiorIntersection},fs.prototype.setCheckEndSegmentsOnly=function(u){this._isCheckEndSegmentsOnly=u},fs.prototype.getIntersectionSegments=function(){return this._intSegments},fs.prototype.count=function(){return this._intersectionCount},fs.prototype.getIntersections=function(){return this._intersections},fs.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u},fs.prototype.setKeepIntersections=function(u){this._keepIntersections=u},fs.prototype.processIntersections=function(u,h,y,x){if(!this._findAllIntersections&&this.hasIntersection()||u===y&&h===x||this._isCheckEndSegmentsOnly&&!this.isEndSegment(u,h)&&!this.isEndSegment(y,x))return null;var T=u.getCoordinates()[h],k=u.getCoordinates()[h+1],G=y.getCoordinates()[x],K=y.getCoordinates()[x+1];this._li.computeIntersection(T,k,G,K),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=T,this._intSegments[1]=k,this._intSegments[2]=G,this._intSegments[3]=K,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)},fs.prototype.isEndSegment=function(u,h){return 0===h||h>=u.size()-2},fs.prototype.hasIntersection=function(){return null!==this._interiorIntersection},fs.prototype.isDone=function(){return!this._findAllIntersections&&null!==this._interiorIntersection},fs.prototype.interfaces_=function(){return[Du]},fs.prototype.getClass=function(){return fs},fs.createAllIntersectionsFinder=function(u){var h=new fs(u);return h.setFindAllIntersections(!0),h},fs.createAnyIntersectionFinder=function(u){return new fs(u)},fs.createIntersectionCounter=function(u){var h=new fs(u);return h.setFindAllIntersections(!0),h.setKeepIntersections(!1),h};var ss=function(){this._li=new Bt,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0,this._segStrings=arguments[0]};ss.prototype.execute=function(){if(null!==this._segInt)return null;this.checkInteriorIntersections()},ss.prototype.getIntersections=function(){return this._segInt.getIntersections()},ss.prototype.isValid=function(){return this.execute(),this._isValid},ss.prototype.setFindAllIntersections=function(u){this._findAllIntersections=u},ss.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new fs(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var u=new Nu;if(u.setSegmentIntersector(this._segInt),u.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null},ss.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new ba(this.getErrorMessage(),this._segInt.getInteriorIntersection())},ss.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var u=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+_t.toLineString(u[0],u[1])+" and "+_t.toLineString(u[2],u[3])},ss.prototype.interfaces_=function(){return[]},ss.prototype.getClass=function(){return ss},ss.computeIntersections=function(u){var h=new ss(u);return h.setFindAllIntersections(!0),h.isValid(),h.getIntersections()};var el=function u(){this._nv=null,this._nv=new ss(u.toSegmentStrings(arguments[0]))};el.prototype.checkValid=function(){this._nv.checkValid()},el.prototype.interfaces_=function(){return[]},el.prototype.getClass=function(){return el},el.toSegmentStrings=function(u){for(var h=new gn,y=u.iterator();y.hasNext();){var x=y.next();h.add(new Ts(x.getCoordinates(),x))}return h},el.checkValid=function(u){new el(u).checkValid()};var Hl=function(u){this._mapOp=u};Hl.prototype.map=function(u){for(var h=new gn,y=0;y<u.getNumGeometries();y++){var x=this._mapOp.map(u.getGeometryN(y));x.isEmpty()||h.add(x)}return u.getFactory().createGeometryCollection(pr.toGeometryArray(h))},Hl.prototype.interfaces_=function(){return[]},Hl.prototype.getClass=function(){return Hl},Hl.map=function(u,h){return new Hl(h).map(u)};var Da=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new gn,this._resultLineList=new gn;var h=arguments[1],y=arguments[2];this._op=arguments[0],this._geometryFactory=h,this._ptLocator=y};Da.prototype.collectLines=function(u){for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next();this.collectLineEdge(y,u,this._lineEdgesList),this.collectBoundaryTouchEdge(y,u,this._lineEdgesList)}},Da.prototype.labelIsolatedLine=function(u,h){var y=this._ptLocator.locate(u.getCoordinate(),this._op.getArgGeometry(h));u.getLabel().setLocation(h,y)},Da.prototype.build=function(u){return this.findCoveredLineEdges(),this.collectLines(u),this.buildLines(u),this._resultLineList},Da.prototype.collectLineEdge=function(u,h,y){var x=u.getLabel(),T=u.getEdge();u.isLineEdge()&&(u.isVisited()||!br.isResultOfOp(x,h)||T.isCovered()||(y.add(T),u.setVisitedEdge(!0)))},Da.prototype.findCoveredLineEdges=function(){for(var u=this._op.getGraph().getNodes().iterator();u.hasNext();)u.next().getEdges().findCoveredLineEdges();for(var h=this._op.getGraph().getEdgeEnds().iterator();h.hasNext();){var y=h.next(),x=y.getEdge();if(y.isLineEdge()&&!x.isCoveredSet()){var T=this._op.isCoveredByA(y.getCoordinate());x.setCovered(T)}}},Da.prototype.labelIsolatedLines=function(u){for(var h=u.iterator();h.hasNext();){var y=h.next(),x=y.getLabel();y.isIsolated()&&(x.isNull(0)?this.labelIsolatedLine(y,0):this.labelIsolatedLine(y,1))}},Da.prototype.buildLines=function(u){for(var h=this._lineEdgesList.iterator();h.hasNext();){var y=h.next(),x=this._geometryFactory.createLineString(y.getCoordinates());this._resultLineList.add(x),y.setInResult(!0)}},Da.prototype.collectBoundaryTouchEdge=function(u,h,y){var x=u.getLabel();return u.isLineEdge()||u.isVisited()||u.isInteriorAreaEdge()||u.getEdge().isInResult()?null:(ae.isTrue(!(u.isInResult()||u.getSym().isInResult())||!u.getEdge().isInResult()),void(br.isResultOfOp(x,h)&&h===br.INTERSECTION&&(y.add(u.getEdge()),u.setVisitedEdge(!0))))},Da.prototype.interfaces_=function(){return[]},Da.prototype.getClass=function(){return Da};var ju=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new gn;var h=arguments[1];this._op=arguments[0],this._geometryFactory=h};ju.prototype.filterCoveredNodeToPoint=function(u){var h=u.getCoordinate();if(!this._op.isCoveredByLA(h)){var y=this._geometryFactory.createPoint(h);this._resultPointList.add(y)}},ju.prototype.extractNonCoveredResultNodes=function(u){for(var h=this._op.getGraph().getNodes().iterator();h.hasNext();){var y=h.next();if(!(y.isInResult()||y.isIncidentEdgeInResult()||0!==y.getEdges().getDegree()&&u!==br.INTERSECTION)){var x=y.getLabel();br.isResultOfOp(x,u)&&this.filterCoveredNodeToPoint(y)}}},ju.prototype.build=function(u){return this.extractNonCoveredResultNodes(u),this._resultPointList},ju.prototype.interfaces_=function(){return[]},ju.prototype.getClass=function(){return ju};var bs=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};bs.prototype.transformPoint=function(u,h){return this._factory.createPoint(this.transformCoordinates(u.getCoordinateSequence(),u))},bs.prototype.transformPolygon=function(u,h){var y=!0,x=this.transformLinearRing(u.getExteriorRing(),u);null!==x&&x instanceof go&&!x.isEmpty()||(y=!1);for(var T=new gn,k=0;k<u.getNumInteriorRing();k++){var G=this.transformLinearRing(u.getInteriorRingN(k),u);null===G||G.isEmpty()||(G instanceof go||(y=!1),T.add(G))}if(y)return this._factory.createPolygon(x,T.toArray([]));var K=new gn;return null!==x&&K.add(x),K.addAll(T),this._factory.buildGeometry(K)},bs.prototype.createCoordinateSequence=function(u){return this._factory.getCoordinateSequenceFactory().create(u)},bs.prototype.getInputGeometry=function(){return this._inputGeom},bs.prototype.transformMultiLineString=function(u,h){for(var y=new gn,x=0;x<u.getNumGeometries();x++){var T=this.transformLineString(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},bs.prototype.transformCoordinates=function(u,h){return this.copy(u)},bs.prototype.transformLineString=function(u,h){return this._factory.createLineString(this.transformCoordinates(u.getCoordinateSequence(),u))},bs.prototype.transformMultiPoint=function(u,h){for(var y=new gn,x=0;x<u.getNumGeometries();x++){var T=this.transformPoint(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},bs.prototype.transformMultiPolygon=function(u,h){for(var y=new gn,x=0;x<u.getNumGeometries();x++){var T=this.transformPolygon(u.getGeometryN(x),u);null!==T&&(T.isEmpty()||y.add(T))}return this._factory.buildGeometry(y)},bs.prototype.copy=function(u){return u.copy()},bs.prototype.transformGeometryCollection=function(u,h){for(var y=new gn,x=0;x<u.getNumGeometries();x++){var T=this.transform(u.getGeometryN(x));null!==T&&(this._pruneEmptyGeometry&&T.isEmpty()||y.add(T))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(pr.toGeometryArray(y)):this._factory.buildGeometry(y)},bs.prototype.transform=function(u){if(this._inputGeom=u,this._factory=u.getFactory(),u instanceof ps)return this.transformPoint(u,null);if(u instanceof Na)return this.transformMultiPoint(u,null);if(u instanceof go)return this.transformLinearRing(u,null);if(u instanceof dr)return this.transformLineString(u,null);if(u instanceof $n)return this.transformMultiLineString(u,null);if(u instanceof Rt)return this.transformPolygon(u,null);if(u instanceof ra)return this.transformMultiPolygon(u,null);if(u instanceof zn)return this.transformGeometryCollection(u,null);throw new Y("Unknown Geometry subtype: "+u.getClass().getName())},bs.prototype.transformLinearRing=function(u,h){var y=this.transformCoordinates(u.getCoordinateSequence(),u);if(null===y)return this._factory.createLinearRing(null);var x=y.size();return x>0&&x<4&&!this._preserveType?this._factory.createLineString(y):this._factory.createLinearRing(y)},bs.prototype.interfaces_=function(){return[]},bs.prototype.getClass=function(){return bs};var pu=function u(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Wn,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof dr&&"number"==typeof arguments[1]){var y=arguments[1];u.call(this,arguments[0].getCoordinates(),y)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var x=arguments[0],T=arguments[1];this._srcPts=x,this._isClosed=u.isClosed(x),this._snapTolerance=T}};pu.prototype.snapVertices=function(u,h){for(var y=this._isClosed?u.size()-1:u.size(),x=0;x<y;x++){var T=u.get(x),k=this.findSnapForVertex(T,h);null!==k&&(u.set(x,new J(k)),0===x&&this._isClosed&&u.set(u.size()-1,new J(k)))}},pu.prototype.findSnapForVertex=function(u,h){for(var y=0;y<h.length;y++){if(u.equals2D(h[y]))return null;if(u.distance(h[y])<this._snapTolerance)return h[y]}return null},pu.prototype.snapTo=function(u){var h=new No(this._srcPts);return this.snapVertices(h,u),this.snapSegments(h,u),h.toCoordinateArray()},pu.prototype.snapSegments=function(u,h){if(0===h.length)return null;var y=h.length;h[0].equals2D(h[h.length-1])&&(y=h.length-1);for(var x=0;x<y;x++){var T=h[x],k=this.findSegmentIndexToSnap(T,u);k>=0&&u.add(k+1,new J(T),!1)}},pu.prototype.findSegmentIndexToSnap=function(u,h){for(var y=ce.MAX_VALUE,x=-1,T=0;T<h.size()-1;T++){if(this._seg.p0=h.get(T),this._seg.p1=h.get(T+1),this._seg.p0.equals2D(u)||this._seg.p1.equals2D(u)){if(this._allowSnappingToSourceVertices)continue;return-1}var k=this._seg.distance(u);k<this._snapTolerance&&k<y&&(y=k,x=T)}return x},pu.prototype.setAllowSnappingToSourceVertices=function(u){this._allowSnappingToSourceVertices=u},pu.prototype.interfaces_=function(){return[]},pu.prototype.getClass=function(){return pu},pu.isClosed=function(u){return!(u.length<=1)&&u[0].equals2D(u[u.length-1])};var zo=function(u){this._srcGeom=u||null},fh={SNAP_PRECISION_FACTOR:{configurable:!0}};zo.prototype.snapTo=function(u,h){var y=this.extractTargetCoordinates(u);return new vl(h,y).transform(this._srcGeom)},zo.prototype.snapToSelf=function(u,h){var y=this.extractTargetCoordinates(this._srcGeom),x=new vl(u,y,!0).transform(this._srcGeom),T=x;return h&&At(T,fa)&&(T=x.buffer(0)),T},zo.prototype.computeSnapTolerance=function(u){return this.computeMinimumSegmentLength(u)/10},zo.prototype.extractTargetCoordinates=function(u){for(var h=new Ut,y=u.getCoordinates(),x=0;x<y.length;x++)h.add(y[x]);return h.toArray(new Array(0).fill(null))},zo.prototype.computeMinimumSegmentLength=function(u){for(var h=ce.MAX_VALUE,y=0;y<u.length-1;y++){var x=u[y].distance(u[y+1]);x<h&&(h=x)}return h},zo.prototype.interfaces_=function(){return[]},zo.prototype.getClass=function(){return zo},zo.snap=function(u,h,y){var x=new Array(2).fill(null),T=new zo(u);x[0]=T.snapTo(h,y);var k=new zo(h);return x[1]=k.snapTo(x[0],y),x},zo.computeOverlaySnapTolerance=function(){if(1===arguments.length){var u=arguments[0],h=zo.computeSizeBasedSnapTolerance(u),y=u.getPrecisionModel();if(y.getType()===Qt.FIXED){var x=1/y.getScale()*2/1.415;x>h&&(h=x)}return h}if(2===arguments.length){var k=arguments[1];return Math.min(zo.computeOverlaySnapTolerance(arguments[0]),zo.computeOverlaySnapTolerance(k))}},zo.computeSizeBasedSnapTolerance=function(u){var h=u.getEnvelopeInternal();return Math.min(h.getHeight(),h.getWidth())*zo.SNAP_PRECISION_FACTOR},zo.snapToSelf=function(u,h,y){return new zo(u).snapToSelf(h,y)},fh.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(zo,fh);var vl=function(u){function h(y,x,T){u.call(this),this._snapTolerance=y||null,this._snapPts=x||null,this._isSelfSnap=void 0!==T&&T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.snapLine=function(y,x){var T=new pu(y,this._snapTolerance);return T.setAllowSnappingToSourceVertices(this._isSelfSnap),T.snapTo(x)},h.prototype.transformCoordinates=function(y,x){var T=y.toCoordinateArray(),k=this.snapLine(T,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(k)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(bs),Ds=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};Ds.prototype.getCommon=function(){return ce.longBitsToDouble(this._commonBits)},Ds.prototype.add=function(u){var h=ce.doubleToLongBits(u);return this._isFirst?(this._commonBits=h,this._commonSignExp=Ds.signExpBits(this._commonBits),this._isFirst=!1,null):Ds.signExpBits(h)!==this._commonSignExp?(this._commonBits=0,null):(this._commonMantissaBitsCount=Ds.numCommonMostSigMantissaBits(this._commonBits,h),void(this._commonBits=Ds.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))))},Ds.prototype.toString=function(){if(1===arguments.length){var u=arguments[0],h=ce.longBitsToDouble(u),y="0000000000000000000000000000000000000000000000000000000000000000"+ce.toBinaryString(u),x=y.substring(y.length-64);return x.substring(0,1)+"  "+x.substring(1,12)+"(exp) "+x.substring(12)+" [ "+h+" ]"}},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds},Ds.getBit=function(u,h){return 0!=(u&1<<h)?1:0},Ds.signExpBits=function(u){return u>>52},Ds.zeroLowerBits=function(u,h){return u&~((1<<h)-1)},Ds.numCommonMostSigMantissaBits=function(u,h){for(var y=0,x=52;x>=0;x--){if(Ds.getBit(u,x)!==Ds.getBit(h,x))return y;y++}return 52};var Tn=function(){this._commonCoord=null,this._ccFilter=new Xl},Ya={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Tn.prototype.addCommonBits=function(u){var h=new xl(this._commonCoord);u.apply(h),u.geometryChanged()},Tn.prototype.removeCommonBits=function(u){if(0===this._commonCoord.x&&0===this._commonCoord.y)return u;var h=new J(this._commonCoord);h.x=-h.x,h.y=-h.y;var y=new xl(h);return u.apply(y),u.geometryChanged(),u},Tn.prototype.getCommonCoordinate=function(){return this._commonCoord},Tn.prototype.add=function(u){u.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()},Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Ya.CommonCoordinateFilter.get=function(){return Xl},Ya.Translater.get=function(){return xl},Object.defineProperties(Tn,Ya);var Xl=function(){this._commonBitsX=new Ds,this._commonBitsY=new Ds};Xl.prototype.filter=function(u){this._commonBitsX.add(u.x),this._commonBitsY.add(u.y)},Xl.prototype.getCommonCoordinate=function(){return new J(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())},Xl.prototype.interfaces_=function(){return[qr]},Xl.prototype.getClass=function(){return Xl};var xl=function(){this.trans=null,this.trans=arguments[0]};xl.prototype.filter=function(u,h){var y=u.getOrdinate(h,0)+this.trans.x,x=u.getOrdinate(h,1)+this.trans.y;u.setOrdinate(h,0,y),u.setOrdinate(h,1,x)},xl.prototype.isDone=function(){return!1},xl.prototype.isGeometryChanged=function(){return!0},xl.prototype.interfaces_=function(){return[tn]},xl.prototype.getClass=function(){return xl};var Es=function(u,h){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=u,this._geom[1]=h,this.computeSnapTolerance()};Es.prototype.selfSnap=function(u){return new zo(u).snapTo(u,this._snapTolerance)},Es.prototype.removeCommonBits=function(u){this._cbr=new Tn,this._cbr.add(u[0]),this._cbr.add(u[1]);var h=new Array(2).fill(null);return h[0]=this._cbr.removeCommonBits(u[0].copy()),h[1]=this._cbr.removeCommonBits(u[1].copy()),h},Es.prototype.prepareResult=function(u){return this._cbr.addCommonBits(u),u},Es.prototype.getResultGeometry=function(u){var h=this.snap(this._geom),y=br.overlayOp(h[0],h[1],u);return this.prepareResult(y)},Es.prototype.checkValid=function(u){u.isValid()||vn.out.println("Snapped geometry is invalid")},Es.prototype.computeSnapTolerance=function(){this._snapTolerance=zo.computeOverlaySnapTolerance(this._geom[0],this._geom[1])},Es.prototype.snap=function(u){var h=this.removeCommonBits(u);return zo.snap(h[0],h[1],this._snapTolerance)},Es.prototype.interfaces_=function(){return[]},Es.prototype.getClass=function(){return Es},Es.overlayOp=function(u,h,y){return new Es(u,h).getResultGeometry(y)},Es.union=function(u,h){return Es.overlayOp(u,h,br.UNION)},Es.intersection=function(u,h){return Es.overlayOp(u,h,br.INTERSECTION)},Es.symDifference=function(u,h){return Es.overlayOp(u,h,br.SYMDIFFERENCE)},Es.difference=function(u,h){return Es.overlayOp(u,h,br.DIFFERENCE)};var as=function(u,h){this._geom=new Array(2).fill(null),this._geom[0]=u,this._geom[1]=h};as.prototype.getResultGeometry=function(u){var h=null,y=!1,x=null;try{h=br.overlayOp(this._geom[0],this._geom[1],u),y=!0}catch(T){if(!(T instanceof ye))throw T;x=T}if(!y)try{h=Es.overlayOp(this._geom[0],this._geom[1],u)}catch(T){throw T instanceof ye?x:T}return h},as.prototype.interfaces_=function(){return[]},as.prototype.getClass=function(){return as},as.overlayOp=function(u,h,y){return new as(u,h).getResultGeometry(y)},as.union=function(u,h){return as.overlayOp(u,h,br.UNION)},as.intersection=function(u,h){return as.overlayOp(u,h,br.INTERSECTION)},as.symDifference=function(u,h){return as.overlayOp(u,h,br.SYMDIFFERENCE)},as.difference=function(u,h){return as.overlayOp(u,h,br.DIFFERENCE)};var _c=function(){this.mce=null,this.chainIndex=null;var h=arguments[1];this.mce=arguments[0],this.chainIndex=h};_c.prototype.computeIntersections=function(u,h){this.mce.computeIntersectsForChain(this.chainIndex,u.mce,u.chainIndex,h)},_c.prototype.interfaces_=function(){return[]},_c.prototype.getClass=function(){return _c};var Ns=function u(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,2===arguments.length){var h=arguments[0],y=arguments[1];this._eventType=u.DELETE,this._xValue=h,this._insertEvent=y}else if(3===arguments.length){var x=arguments[0],T=arguments[1],k=arguments[2];this._eventType=u.INSERT,this._label=x,this._xValue=T,this._obj=k}},$h={INSERT:{configurable:!0},DELETE:{configurable:!0}};Ns.prototype.isDelete=function(){return this._eventType===Ns.DELETE},Ns.prototype.setDeleteEventIndex=function(u){this._deleteEventIndex=u},Ns.prototype.getObject=function(){return this._obj},Ns.prototype.compareTo=function(u){return this._xValue<u._xValue?-1:this._xValue>u._xValue?1:this._eventType<u._eventType?-1:this._eventType>u._eventType?1:0},Ns.prototype.getInsertEvent=function(){return this._insertEvent},Ns.prototype.isInsert=function(){return this._eventType===Ns.INSERT},Ns.prototype.isSameLabel=function(u){return null!==this._label&&this._label===u._label},Ns.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex},Ns.prototype.interfaces_=function(){return[de]},Ns.prototype.getClass=function(){return Ns},$h.INSERT.get=function(){return 1},$h.DELETE.get=function(){return 2},Object.defineProperties(Ns,$h);var Vc=function(){};Vc.prototype.interfaces_=function(){return[]},Vc.prototype.getClass=function(){return Vc};var ks=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var h=arguments[1],y=arguments[2];this._li=arguments[0],this._includeProper=h,this._recordIsolated=y};ks.prototype.isTrivialIntersection=function(u,h,y,x){if(u===y&&1===this._li.getIntersectionNum()){if(ks.isAdjacentSegments(h,x))return!0;if(u.isClosed()){var T=u.getNumPoints()-1;if(0===h&&x===T||0===x&&h===T)return!0}}return!1},ks.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint},ks.prototype.setIsDoneIfProperInt=function(u){this._isDoneWhenProperInt=u},ks.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior},ks.prototype.isBoundaryPointInternal=function(u,h){for(var y=h.iterator();y.hasNext();){var x=y.next().getCoordinate();if(u.isIntersection(x))return!0}return!1},ks.prototype.hasProperIntersection=function(){return this._hasProper},ks.prototype.hasIntersection=function(){return this._hasIntersection},ks.prototype.isDone=function(){return this._isDone},ks.prototype.isBoundaryPoint=function(u,h){return!(null===h||!this.isBoundaryPointInternal(u,h[0])&&!this.isBoundaryPointInternal(u,h[1]))},ks.prototype.setBoundaryNodes=function(u,h){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=u,this._bdyNodes[1]=h},ks.prototype.addIntersections=function(u,h,y,x){if(u===y&&h===x)return null;this.numTests++;var T=u.getCoordinates()[h],k=u.getCoordinates()[h+1],G=y.getCoordinates()[x],K=y.getCoordinates()[x+1];this._li.computeIntersection(T,k,G,K),this._li.hasIntersection()&&(this._recordIsolated&&(u.setIsolated(!1),y.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(u,h,y,x)||(this._hasIntersection=!0,!this._includeProper&&this._li.isProper()||(u.addIntersections(this._li,h,0),y.addIntersections(this._li,x,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))},ks.prototype.interfaces_=function(){return[]},ks.prototype.getClass=function(){return ks},ks.isAdjacentSegments=function(u,h){return 1===Math.abs(u-h)};var Gu=function(u){function h(){u.call(this),this.events=new gn,this.nOverlaps=null}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.prepareEvents=function(){$o.sort(this.events);for(var y=0;y<this.events.size();y++){var x=this.events.get(y);x.isDelete()&&x.getInsertEvent().setDeleteEventIndex(y)}},h.prototype.computeIntersections=function(){if(1===arguments.length){var y=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var x=0;x<this.events.size();x++){var T=this.events.get(x);if(T.isInsert()&&this.processOverlaps(x,T.getDeleteEventIndex(),T,y),y.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof ks&&At(arguments[0],ts)&&At(arguments[1],ts)){var k=arguments[0],G=arguments[1],K=arguments[2];this.addEdges(k,k),this.addEdges(G,G),this.computeIntersections(K)}else if("boolean"==typeof arguments[2]&&At(arguments[0],ts)&&arguments[1]instanceof ks){var re=arguments[0],et=arguments[1];arguments[2]?this.addEdges(re,null):this.addEdges(re),this.computeIntersections(et)}},h.prototype.addEdge=function(y,x){for(var T=y.getMonotoneChainEdge(),k=T.getStartIndexes(),G=0;G<k.length-1;G++){var K=new _c(T,G),re=new Ns(x,T.getMinX(G),K);this.events.add(re),this.events.add(new Ns(T.getMaxX(G),re))}},h.prototype.processOverlaps=function(y,x,T,k){for(var G=T.getObject(),K=y;K<x;K++){var re=this.events.get(K);if(re.isInsert()){var et=re.getObject();T.isSameLabel(re)||(G.computeIntersections(et,k),this.nOverlaps++)}}},h.prototype.addEdges=function(){if(1===arguments.length)for(var y=arguments[0].iterator();y.hasNext();){var x=y.next();this.addEdge(x,x)}else if(2===arguments.length)for(var k=arguments[1],G=arguments[0].iterator();G.hasNext();){var K=G.next();this.addEdge(K,k)}},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Vc),Ks=function(){this._min=ce.POSITIVE_INFINITY,this._max=ce.NEGATIVE_INFINITY},Cs={NodeComparator:{configurable:!0}};Ks.prototype.getMin=function(){return this._min},Ks.prototype.intersects=function(u,h){return!(this._min>h||this._max<u)},Ks.prototype.getMax=function(){return this._max},Ks.prototype.toString=function(){return _t.toLineString(new J(this._min,0),new J(this._max,0))},Ks.prototype.interfaces_=function(){return[]},Ks.prototype.getClass=function(){return Ks},Cs.NodeComparator.get=function(){return wl},Object.defineProperties(Ks,Cs);var wl=function(){};wl.prototype.compare=function(u,h){var T=(u._min+u._max)/2,k=(h._min+h._max)/2;return T<k?-1:T>k?1:0},wl.prototype.interfaces_=function(){return[we]},wl.prototype.getClass=function(){return wl};var ud=function(u){function h(){u.call(this),this._item=null;var x=arguments[1],T=arguments[2];this._min=arguments[0],this._max=x,this._item=T}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;T.visitItem(this._item)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ks),qh=function(u){function h(){u.call(this),this._node1=null,this._node2=null;var x=arguments[1];this._node1=arguments[0],this._node2=x,this.buildExtent(this._node1,this._node2)}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.buildExtent=function(y,x){this._min=Math.min(y._min,x._min),this._max=Math.max(y._max,x._max)},h.prototype.query=function(y,x,T){if(!this.intersects(y,x))return null;null!==this._node1&&this._node1.query(y,x,T),null!==this._node2&&this._node2.query(y,x,T)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(Ks),Ka=function(){this._leaves=new gn,this._root=null,this._level=0};Ka.prototype.buildTree=function(){$o.sort(this._leaves,new Ks.NodeComparator);for(var u=this._leaves,h=null,y=new gn;;){if(this.buildLevel(u,y),1===y.size())return y.get(0);h=u,u=y,y=h}},Ka.prototype.insert=function(u,h,y){if(null!==this._root)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new ud(u,h,y))},Ka.prototype.query=function(u,h,y){this.init(),this._root.query(u,h,y)},Ka.prototype.buildRoot=function(){if(null!==this._root)return null;this._root=this.buildTree()},Ka.prototype.printNode=function(u){vn.out.println(_t.toLineString(new J(u._min,this._level),new J(u._max,this._level)))},Ka.prototype.init=function(){if(null!==this._root)return null;this.buildRoot()},Ka.prototype.buildLevel=function(u,h){this._level++,h.clear();for(var y=0;y<u.size();y+=2){var x=u.get(y);if(null===(y+1<u.size()?u.get(y):null))h.add(x);else{var T=new qh(u.get(y),u.get(y+1));h.add(T)}}},Ka.prototype.interfaces_=function(){return[]},Ka.prototype.getClass=function(){return Ka};var Zl=function(){this._items=new gn};Zl.prototype.visitItem=function(u){this._items.add(u)},Zl.prototype.getItems=function(){return this._items},Zl.prototype.interfaces_=function(){return[za]},Zl.prototype.getClass=function(){return Zl};var bl=function(){this._index=null;var u=arguments[0];if(!At(u,fa))throw new Y("Argument must be Polygonal");this._index=new Fs(u)},Wl={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};bl.prototype.locate=function(u){var h=new sn(u),y=new tl(h);return this._index.query(u.y,u.y,y),h.getLocation()},bl.prototype.interfaces_=function(){return[Fu]},bl.prototype.getClass=function(){return bl},Wl.SegmentVisitor.get=function(){return tl},Wl.IntervalIndexedGeometry.get=function(){return Fs},Object.defineProperties(bl,Wl);var tl=function(){this._counter=null,this._counter=arguments[0]};tl.prototype.visitItem=function(u){var h=u;this._counter.countSegment(h.getCoordinate(0),h.getCoordinate(1))},tl.prototype.interfaces_=function(){return[za]},tl.prototype.getClass=function(){return tl};var Fs=function(){this._index=new Ka,this.init(arguments[0])};Fs.prototype.init=function(u){for(var h=Ho.getLines(u).iterator();h.hasNext();){var y=h.next().getCoordinates();this.addLine(y)}},Fs.prototype.addLine=function(u){for(var h=1;h<u.length;h++){var y=new Wn(u[h-1],u[h]),x=Math.min(y.p0.y,y.p1.y),T=Math.max(y.p0.y,y.p1.y);this._index.insert(x,T,y)}},Fs.prototype.query=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=new Zl;return this._index.query(u,h,y),y.getItems()}3===arguments.length&&this._index.query(arguments[0],arguments[1],arguments[2])},Fs.prototype.interfaces_=function(){return[]},Fs.prototype.getClass=function(){return Fs};var vc=function(u){function h(){if(u.call(this),this._parentGeom=null,this._lineEdgeMap=new pl,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new Os,2===arguments.length){var x=arguments[1],T=ui.OGC_SFS_BOUNDARY_RULE;this._argIndex=arguments[0],this._parentGeom=x,this._boundaryNodeRule=T,null!==x&&this.add(x)}else if(3===arguments.length){var G=arguments[1],K=arguments[2];this._argIndex=arguments[0],this._parentGeom=G,this._boundaryNodeRule=K,null!==G&&this.add(G)}}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.insertBoundaryPoint=function(y,x){var T=this._nodes.addNode(x).getLabel(),k=1;T.getLocation(y,mn.ON)===ue.BOUNDARY&&k++;var G=h.determineBoundary(this._boundaryNodeRule,k);T.setLocation(y,G)},h.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var k=arguments[1],G=arguments[2],K=new ks(arguments[0],!0,!1);return K.setIsDoneIfProperInt(G),this.createEdgeSetIntersector().computeIntersections(this._edges,K,k||!(this._parentGeom instanceof go||this._parentGeom instanceof Rt||this._parentGeom instanceof ra)),this.addSelfIntersectionNodes(this._argIndex),K}},h.prototype.computeSplitEdges=function(y){for(var x=this._edges.iterator();x.hasNext();)x.next().eiList.addSplitEdges(y)},h.prototype.computeEdgeIntersections=function(y,x,T){var k=new ks(x,T,!0);return k.setBoundaryNodes(this.getBoundaryNodes(),y.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this._edges,y._edges,k),k},h.prototype.getGeometry=function(){return this._parentGeom},h.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},h.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},h.prototype.addPoint=function(){if(arguments[0]instanceof ps){var y=arguments[0].getCoordinate();this.insertPoint(this._argIndex,y,ue.INTERIOR)}else arguments[0]instanceof J&&this.insertPoint(this._argIndex,arguments[0],ue.INTERIOR)},h.prototype.addPolygon=function(y){this.addPolygonRing(y.getExteriorRing(),ue.EXTERIOR,ue.INTERIOR);for(var x=0;x<y.getNumInteriorRing();x++){var T=y.getInteriorRingN(x);this.addPolygonRing(T,ue.INTERIOR,ue.EXTERIOR)}},h.prototype.addEdge=function(y){this.insertEdge(y);var x=y.getCoordinates();this.insertPoint(this._argIndex,x[0],ue.BOUNDARY),this.insertPoint(this._argIndex,x[x.length-1],ue.BOUNDARY)},h.prototype.addLineString=function(y){var x=_r.removeRepeatedPoints(y.getCoordinates());if(x.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=x[0],null;var T=new xi(x,new gi(this._argIndex,ue.INTERIOR));this._lineEdgeMap.put(y,T),this.insertEdge(T),ae.isTrue(x.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,x[0]),this.insertBoundaryPoint(this._argIndex,x[x.length-1])},h.prototype.getInvalidPoint=function(){return this._invalidPoint},h.prototype.getBoundaryPoints=function(){for(var y=this.getBoundaryNodes(),x=new Array(y.size()).fill(null),T=0,k=y.iterator();k.hasNext();){var G=k.next();x[T++]=G.getCoordinate().copy()}return x},h.prototype.getBoundaryNodes=function(){return null===this._boundaryNodes&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},h.prototype.addSelfIntersectionNode=function(y,x,T){if(this.isBoundaryNode(y,x))return null;T===ue.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(y,x):this.insertPoint(y,x,T)},h.prototype.addPolygonRing=function(y,x,T){if(y.isEmpty())return null;var k=_r.removeRepeatedPoints(y.getCoordinates());if(k.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=k[0],null;var G=x,K=T;Gt.isCCW(k)&&(G=T,K=x);var re=new xi(k,new gi(this._argIndex,ue.BOUNDARY,G,K));this._lineEdgeMap.put(y,re),this.insertEdge(re),this.insertPoint(this._argIndex,k[0],ue.BOUNDARY)},h.prototype.insertPoint=function(y,x,T){var k=this._nodes.addNode(x),G=k.getLabel();null===G?k._label=new gi(y,T):G.setLocation(y,T)},h.prototype.createEdgeSetIntersector=function(){return new Gu},h.prototype.addSelfIntersectionNodes=function(y){for(var x=this._edges.iterator();x.hasNext();)for(var T=x.next(),k=T.getLabel().getLocation(y),G=T.eiList.iterator();G.hasNext();){var K=G.next();this.addSelfIntersectionNode(y,K.coord,k)}},h.prototype.add=function(){if(1!==arguments.length)return u.prototype.add.apply(this,arguments);var y=arguments[0];if(y.isEmpty())return null;if(y instanceof ra&&(this._useBoundaryDeterminationRule=!1),y instanceof Rt)this.addPolygon(y);else if(y instanceof dr)this.addLineString(y);else if(y instanceof ps)this.addPoint(y);else if(y instanceof Na)this.addCollection(y);else if(y instanceof $n)this.addCollection(y);else if(y instanceof ra)this.addCollection(y);else{if(!(y instanceof zn))throw new Error(y.getClass().getName());this.addCollection(y)}},h.prototype.addCollection=function(y){for(var x=0;x<y.getNumGeometries();x++){var T=y.getGeometryN(x);this.add(T)}},h.prototype.locate=function(y){return At(this._parentGeom,fa)&&this._parentGeom.getNumGeometries()>50?(null===this._areaPtLocator&&(this._areaPtLocator=new bl(this._parentGeom)),this._areaPtLocator.locate(y)):this._ptLocator.locate(y,this._parentGeom)},h.prototype.findEdge=function(){return 1===arguments.length?this._lineEdgeMap.get(arguments[0]):u.prototype.findEdge.apply(this,arguments)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h.determineBoundary=function(y,x){return y.isInBoundary(x)?ue.BOUNDARY:ue.INTERIOR},h}(kn),nl=function(){if(this._li=new Bt,this._resultPrecisionModel=null,this._arg=null,1===arguments.length){var u=arguments[0];this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new vc(0,u)}else if(2===arguments.length){var h=arguments[0],y=arguments[1],x=ui.OGC_SFS_BOUNDARY_RULE;h.getPrecisionModel().compareTo(y.getPrecisionModel())>=0?this.setComputationPrecision(h.getPrecisionModel()):this.setComputationPrecision(y.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new vc(0,h,x),this._arg[1]=new vc(1,y,x)}else if(3===arguments.length){var T=arguments[0],k=arguments[1],G=arguments[2];T.getPrecisionModel().compareTo(k.getPrecisionModel())>=0?this.setComputationPrecision(T.getPrecisionModel()):this.setComputationPrecision(k.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new vc(0,T,G),this._arg[1]=new vc(1,k,G)}};nl.prototype.getArgGeometry=function(u){return this._arg[u].getGeometry()},nl.prototype.setComputationPrecision=function(u){this._resultPrecisionModel=u,this._li.setPrecisionModel(this._resultPrecisionModel)},nl.prototype.interfaces_=function(){return[]},nl.prototype.getClass=function(){return nl};var us=function(){};us.prototype.interfaces_=function(){return[]},us.prototype.getClass=function(){return us},us.map=function(){if(arguments[0]instanceof En&&At(arguments[1],us.MapOp)){for(var u=arguments[0],h=arguments[1],y=new gn,x=0;x<u.getNumGeometries();x++){var T=h.map(u.getGeometryN(x));null!==T&&y.add(T)}return u.getFactory().buildGeometry(y)}if(At(arguments[0],oi)&&At(arguments[1],us.MapOp)){for(var k=arguments[0],G=arguments[1],K=new gn,re=k.iterator();re.hasNext();){var et=re.next(),Ft=G.map(et);null!==Ft&&K.add(Ft)}return K}},us.MapOp=function(){};var br=function(u){function h(){var y=arguments[0];u.call(this,y,arguments[1]),this._ptLocator=new Os,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new _s,this._resultPolyList=new gn,this._resultLineList=new gn,this._resultPointList=new gn,this._graph=new kn(new mc),this._geomFact=y.getFactory()}return u&&(h.__proto__=u),(h.prototype=Object.create(u&&u.prototype)).constructor=h,h.prototype.insertUniqueEdge=function(y){var x=this._edgeList.findEqualEdge(y);if(null!==x){var T=x.getLabel(),k=y.getLabel();x.isPointwiseEqual(y)||(k=new gi(y.getLabel())).flip();var G=x.getDepth();G.isNull()&&G.add(T),G.add(k),T.merge(k)}else this._edgeList.add(y)},h.prototype.getGraph=function(){return this._graph},h.prototype.cancelDuplicateResultEdges=function(){for(var y=this._graph.getEdgeEnds().iterator();y.hasNext();){var x=y.next(),T=x.getSym();x.isInResult()&&T.isInResult()&&(x.setInResult(!1),T.setInResult(!1))}},h.prototype.isCoveredByLA=function(y){return!!this.isCovered(y,this._resultLineList)||!!this.isCovered(y,this._resultPolyList)},h.prototype.computeGeometry=function(y,x,T,k){var G=new gn;return G.addAll(y),G.addAll(x),G.addAll(T),G.isEmpty()?h.createEmptyResult(k,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(G)},h.prototype.mergeSymLabels=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().mergeSymLabels()},h.prototype.isCovered=function(y,x){for(var T=x.iterator();T.hasNext();){var k=T.next();if(this._ptLocator.locate(y,k)!==ue.EXTERIOR)return!0}return!1},h.prototype.replaceCollapsedEdges=function(){for(var y=new gn,x=this._edgeList.iterator();x.hasNext();){var T=x.next();T.isCollapsed()&&(x.remove(),y.add(T.getCollapsedEdge()))}this._edgeList.addAll(y)},h.prototype.updateNodeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getEdges().getLabel();x.getLabel().merge(T)}},h.prototype.getResultGeometry=function(y){return this.computeOverlay(y),this._resultGeom},h.prototype.insertUniqueEdges=function(y){for(var x=y.iterator();x.hasNext();){var T=x.next();this.insertUniqueEdge(T)}},h.prototype.computeOverlay=function(y){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var x=new gn;this._arg[0].computeSplitEdges(x),this._arg[1].computeSplitEdges(x),this.insertUniqueEdges(x),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),el.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(y),this.cancelDuplicateResultEdges();var T=new ws(this._geomFact);T.add(this._graph),this._resultPolyList=T.getPolygons();var k=new Da(this,this._geomFact,this._ptLocator);this._resultLineList=k.build(y);var G=new ju(this,this._geomFact,this._ptLocator);this._resultPointList=G.build(y),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,y)},h.prototype.labelIncompleteNode=function(y,x){var T=this._ptLocator.locate(y.getCoordinate(),this._arg[x].getGeometry());y.getLabel().setLocation(x,T)},h.prototype.copyPoints=function(y){for(var x=this._arg[y].getNodeIterator();x.hasNext();){var T=x.next();this._graph.addNode(T.getCoordinate()).setLabel(y,T.getLabel().getLocation(y))}},h.prototype.findResultAreaEdges=function(y){for(var x=this._graph.getEdgeEnds().iterator();x.hasNext();){var T=x.next(),k=T.getLabel();k.isArea()&&!T.isInteriorAreaEdge()&&h.isResultOfOp(k.getLocation(0,mn.RIGHT),k.getLocation(1,mn.RIGHT),y)&&T.setInResult(!0)}},h.prototype.computeLabelsFromDepths=function(){for(var y=this._edgeList.iterator();y.hasNext();){var x=y.next(),T=x.getLabel(),k=x.getDepth();if(!k.isNull()){k.normalize();for(var G=0;G<2;G++)T.isNull(G)||!T.isArea()||k.isNull(G)||(0===k.getDelta(G)?T.toLine(G):(ae.isTrue(!k.isNull(G,mn.LEFT),"depth of LEFT side has not been initialized"),T.setLocation(G,mn.LEFT,k.getLocation(G,mn.LEFT)),ae.isTrue(!k.isNull(G,mn.RIGHT),"depth of RIGHT side has not been initialized"),T.setLocation(G,mn.RIGHT,k.getLocation(G,mn.RIGHT))))}}},h.prototype.computeLabelling=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();)y.next().getEdges().computeLabelling(this._arg);this.mergeSymLabels(),this.updateNodeLabelling()},h.prototype.labelIncompleteNodes=function(){for(var y=this._graph.getNodes().iterator();y.hasNext();){var x=y.next(),T=x.getLabel();x.isIsolated()&&(T.isNull(0)?this.labelIncompleteNode(x,0):this.labelIncompleteNode(x,1)),x.getEdges().updateLabelling(T)}},h.prototype.isCoveredByA=function(y){return!!this.isCovered(y,this._resultPolyList)},h.prototype.interfaces_=function(){return[]},h.prototype.getClass=function(){return h},h}(nl);br.overlayOp=function(u,h,y){return new br(u,h).getResultGeometry(y)},br.intersection=function(u,h){if(u.isEmpty()||h.isEmpty())return br.createEmptyResult(br.INTERSECTION,u,h,u.getFactory());if(u.isGeometryCollection()){var y=h;return Hl.map(u,{interfaces_:function(){return[us.MapOp]},map:function(x){return x.intersection(y)}})}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),as.overlayOp(u,h,br.INTERSECTION)},br.symDifference=function(u,h){if(u.isEmpty()||h.isEmpty()){if(u.isEmpty()&&h.isEmpty())return br.createEmptyResult(br.SYMDIFFERENCE,u,h,u.getFactory());if(u.isEmpty())return h.copy();if(h.isEmpty())return u.copy()}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),as.overlayOp(u,h,br.SYMDIFFERENCE)},br.resultDimension=function(u,h,y){var x=h.getDimension(),T=y.getDimension(),k=-1;switch(u){case br.INTERSECTION:k=Math.min(x,T);break;case br.UNION:k=Math.max(x,T);break;case br.DIFFERENCE:k=x;break;case br.SYMDIFFERENCE:k=Math.max(x,T)}return k},br.createEmptyResult=function(u,h,y,x){var T=null;switch(br.resultDimension(u,h,y)){case-1:T=x.createGeometryCollection(new Array(0).fill(null));break;case 0:T=x.createPoint();break;case 1:T=x.createLineString();break;case 2:T=x.createPolygon()}return T},br.difference=function(u,h){return u.isEmpty()?br.createEmptyResult(br.DIFFERENCE,u,h,u.getFactory()):h.isEmpty()?u.copy():(u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),as.overlayOp(u,h,br.DIFFERENCE))},br.isResultOfOp=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=u.getLocation(0),x=u.getLocation(1);return br.isResultOfOp(y,x,h)}if(3===arguments.length){var T=arguments[0],k=arguments[1];switch(T===ue.BOUNDARY&&(T=ue.INTERIOR),k===ue.BOUNDARY&&(k=ue.INTERIOR),arguments[2]){case br.INTERSECTION:return T===ue.INTERIOR&&k===ue.INTERIOR;case br.UNION:return T===ue.INTERIOR||k===ue.INTERIOR;case br.DIFFERENCE:return T===ue.INTERIOR&&k!==ue.INTERIOR;case br.SYMDIFFERENCE:return T===ue.INTERIOR&&k!==ue.INTERIOR||T!==ue.INTERIOR&&k===ue.INTERIOR}return!1}},br.INTERSECTION=1,br.UNION=2,br.DIFFERENCE=3,br.SYMDIFFERENCE=4;var sa=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new Os,this._seg=new Wn;var u=arguments[0],h=arguments[1];this._g=u,this._boundaryDistanceTolerance=h,this._linework=this.extractLinework(u)};sa.prototype.isWithinToleranceOfBoundary=function(u){for(var h=0;h<this._linework.getNumGeometries();h++)for(var y=this._linework.getGeometryN(h).getCoordinateSequence(),x=0;x<y.size()-1;x++)if(y.getCoordinate(x,this._seg.p0),y.getCoordinate(x+1,this._seg.p1),this._seg.distance(u)<=this._boundaryDistanceTolerance)return!0;return!1},sa.prototype.getLocation=function(u){return this.isWithinToleranceOfBoundary(u)?ue.BOUNDARY:this._ptLocator.locate(u,this._g)},sa.prototype.extractLinework=function(u){var h=new Js;u.apply(h);var y=h.getLinework(),x=pr.toLineStringArray(y);return u.getFactory().createMultiLineString(x)},sa.prototype.interfaces_=function(){return[]},sa.prototype.getClass=function(){return sa};var Js=function(){this._linework=null,this._linework=new gn};Js.prototype.getLinework=function(){return this._linework},Js.prototype.filter=function(u){if(u instanceof Rt){var h=u;this._linework.add(h.getExteriorRing());for(var y=0;y<h.getNumInteriorRing();y++)this._linework.add(h.getInteriorRingN(y))}},Js.prototype.interfaces_=function(){return[yn]},Js.prototype.getClass=function(){return Js};var $u=function(){this._g=null,this._doLeft=!0,this._doRight=!0,this._g=arguments[0]};$u.prototype.extractPoints=function(u,h,y){for(var x=u.getCoordinates(),T=0;T<x.length-1;T++)this.computeOffsetPoints(x[T],x[T+1],h,y)},$u.prototype.setSidesToGenerate=function(u,h){this._doLeft=u,this._doRight=h},$u.prototype.getPoints=function(u){for(var h=new gn,y=Ho.getLines(this._g).iterator();y.hasNext();){var x=y.next();this.extractPoints(x,u,h)}return h},$u.prototype.computeOffsetPoints=function(u,h,y,x){var T=h.x-u.x,k=h.y-u.y,G=Math.sqrt(T*T+k*k),K=y*T/G,re=y*k/G,et=(h.x+u.x)/2,Ft=(h.y+u.y)/2;if(this._doLeft){var $t=new J(et-re,Ft+K);x.add($t)}if(this._doRight){var gt=new J(et+re,Ft-K);x.add(gt)}},$u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u};var zs=function u(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=u.TOLERANCE,this._testCoords=new gn;var h=arguments[0],y=arguments[1],x=arguments[2];this._boundaryDistanceTolerance=u.computeBoundaryDistanceTolerance(h,y),this._geom=[h,y,x],this._locFinder=[new sa(this._geom[0],this._boundaryDistanceTolerance),new sa(this._geom[1],this._boundaryDistanceTolerance),new sa(this._geom[2],this._boundaryDistanceTolerance)]},El={TOLERANCE:{configurable:!0}};zs.prototype.reportResult=function(u,h,y){vn.out.println("Overlay result invalid - A:"+ue.toLocationSymbol(h[0])+" B:"+ue.toLocationSymbol(h[1])+" expected:"+(y?"i":"e")+" actual:"+ue.toLocationSymbol(h[2]))},zs.prototype.isValid=function(u){return this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]),this.checkValid(u)},zs.prototype.checkValid=function(){if(1===arguments.length){for(var u=arguments[0],h=0;h<this._testCoords.size();h++){var y=this._testCoords.get(h);if(!this.checkValid(u,y))return this._invalidLocation=y,!1}return!0}if(2===arguments.length){var x=arguments[0],T=arguments[1];return this._location[0]=this._locFinder[0].getLocation(T),this._location[1]=this._locFinder[1].getLocation(T),this._location[2]=this._locFinder[2].getLocation(T),!!zs.hasLocation(this._location,ue.BOUNDARY)||this.isValidResult(x,this._location)}},zs.prototype.addTestPts=function(u){var h=new $u(u);this._testCoords.addAll(h.getPoints(5*this._boundaryDistanceTolerance))},zs.prototype.isValidResult=function(u,h){var y=br.isResultOfOp(h[0],h[1],u),x=!(y^h[2]===ue.INTERIOR);return x||this.reportResult(u,h,y),x},zs.prototype.getInvalidLocation=function(){return this._invalidLocation},zs.prototype.interfaces_=function(){return[]},zs.prototype.getClass=function(){return zs},zs.hasLocation=function(u,h){for(var y=0;y<3;y++)if(u[y]===h)return!0;return!1},zs.computeBoundaryDistanceTolerance=function(u,h){return Math.min(zo.computeSizeBasedSnapTolerance(u),zo.computeSizeBasedSnapTolerance(h))},zs.isValid=function(u,h,y,x){return new zs(u,h,x).isValid(y)},El.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(zs,El);var Po=function u(h){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=u.extractFactory(h),this._inputGeoms=h};Po.prototype.extractElements=function(u,h){if(null===u)return null;for(var y=0;y<u.getNumGeometries();y++){var x=u.getGeometryN(y);this._skipEmpty&&x.isEmpty()||h.add(x)}},Po.prototype.combine=function(){for(var u=new gn,h=this._inputGeoms.iterator();h.hasNext();){var y=h.next();this.extractElements(y,u)}return 0===u.size()?null!==this._geomFactory?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(u)},Po.prototype.interfaces_=function(){return[]},Po.prototype.getClass=function(){return Po},Po.combine=function(){return 1===arguments.length?new Po(arguments[0]).combine():2===arguments.length?new Po(Po.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Po(Po.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Po.extractFactory=function(u){return u.isEmpty()?null:u.iterator().next().getFactory()},Po.createList=function(){if(2===arguments.length){var u=arguments[0],h=arguments[1],y=new gn;return y.add(u),y.add(h),y}if(3===arguments.length){var x=arguments[0],T=arguments[1],k=arguments[2],G=new gn;return G.add(x),G.add(T),G.add(k),G}};var Zo=function(){this._inputPolys=null,this._geomFactory=null,this._inputPolys=arguments[0],null===this._inputPolys&&(this._inputPolys=new gn)},Bs={STRTREE_NODE_CAPACITY:{configurable:!0}};Zo.prototype.reduceToGeometries=function(u){for(var h=new gn,y=u.iterator();y.hasNext();){var x=y.next(),T=null;At(x,ts)?T=this.unionTree(x):x instanceof En&&(T=x),h.add(T)}return h},Zo.prototype.extractByEnvelope=function(u,h,y){for(var x=new gn,T=0;T<h.getNumGeometries();T++){var k=h.getGeometryN(T);k.getEnvelopeInternal().intersects(u)?x.add(k):y.add(k)}return this._geomFactory.buildGeometry(x)},Zo.prototype.unionOptimized=function(u,h){var y=u.getEnvelopeInternal(),x=h.getEnvelopeInternal();if(!y.intersects(x))return Po.combine(u,h);if(u.getNumGeometries()<=1&&h.getNumGeometries()<=1)return this.unionActual(u,h);var T=y.intersection(x);return this.unionUsingEnvelopeIntersection(u,h,T)},Zo.prototype.union=function(){if(null===this._inputPolys)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var u=new Sf(Zo.STRTREE_NODE_CAPACITY),h=this._inputPolys.iterator();h.hasNext();){var y=h.next();u.insert(y.getEnvelopeInternal(),y)}this._inputPolys=null;var x=u.itemsTree();return this.unionTree(x)},Zo.prototype.binaryUnion=function(){if(1===arguments.length){var u=arguments[0];return this.binaryUnion(u,0,u.size())}if(3===arguments.length){var h=arguments[0],y=arguments[1],x=arguments[2];if(x-y<=1){var T=Zo.getGeometry(h,y);return this.unionSafe(T,null)}if(x-y==2)return this.unionSafe(Zo.getGeometry(h,y),Zo.getGeometry(h,y+1));var k=Math.trunc((x+y)/2),G=this.binaryUnion(h,y,k),K=this.binaryUnion(h,k,x);return this.unionSafe(G,K)}},Zo.prototype.repeatedUnion=function(u){for(var h=null,y=u.iterator();y.hasNext();){var x=y.next();h=null===h?x.copy():h.union(x)}return h},Zo.prototype.unionSafe=function(u,h){return null===u&&null===h?null:null===u?h.copy():null===h?u.copy():this.unionOptimized(u,h)},Zo.prototype.unionActual=function(u,h){return Zo.restrictToPolygons(u.union(h))},Zo.prototype.unionTree=function(u){var h=this.reduceToGeometries(u);return this.binaryUnion(h)},Zo.prototype.unionUsingEnvelopeIntersection=function(u,h,y){var x=new gn,T=this.extractByEnvelope(y,u,x),k=this.extractByEnvelope(y,h,x),G=this.unionActual(T,k);return x.add(G),Po.combine(x)},Zo.prototype.bufferUnion=function(){if(1===arguments.length){var u=arguments[0];return u.get(0).getFactory().buildGeometry(u).buffer(0)}if(2===arguments.length){var h=arguments[0],y=arguments[1];return h.getFactory().createGeometryCollection([h,y]).buffer(0)}},Zo.prototype.interfaces_=function(){return[]},Zo.prototype.getClass=function(){return Zo},Zo.restrictToPolygons=function(u){if(At(u,fa))return u;var h=Fo.getPolygons(u);return 1===h.size()?h.get(0):u.getFactory().createMultiPolygon(pr.toPolygonArray(h))},Zo.getGeometry=function(u,h){return h>=u.size()?null:u.get(h)},Zo.union=function(u){return new Zo(u).union()},Bs.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Zo,Bs);var xc=function(){};xc.prototype.interfaces_=function(){return[]},xc.prototype.getClass=function(){return xc},xc.union=function(u,h){if(u.isEmpty()||h.isEmpty()){if(u.isEmpty()&&h.isEmpty())return br.createEmptyResult(br.UNION,u,h,u.getFactory());if(u.isEmpty())return h.copy();if(h.isEmpty())return u.copy()}return u.checkNotGeometryCollection(u),u.checkNotGeometryCollection(h),as.overlayOp(u,h,br.UNION)},je.GeoJSONReader=Vh,je.GeoJSONWriter=ch,je.OverlayOp=br,je.UnionOp=xc,je.BufferOp=ri,Object.defineProperty(je,"__esModule",{value:!0})}(vt)}},an=>{an(an.s=7521)}]);